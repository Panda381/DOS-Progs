
; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°
;
;                              F I L E  -  3
;
;                   Obsluha soubor– - Ru¨en¡ (s nulov n¡m)
;
; =============================================================================
;
; Bˆhem obsluhy je ve FileOPth uschov n aktivn¡ adres © na ru¨en‚m disku !
; Buffer CilPath se pou‘¡v  k sestaven¡ p©echodn‚ho jm‚na p©i nulov n¡ soubor–.
;
; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°

INCLUDE  ASM\DEF.ASM

CodeFil  SEGMENT   BYTE PUBLIC
         ASSUME    cs:CodeFil,ds:Data

; *****************************************************************************
;
;                          Ru¨en¡ soubor–
;
; *****************************************************************************
;þ
AWMMnuSR LABEL     FAR

; ------ dek¢dov n¡ nulovac¡ho bajtu

         mov       al,ds:[NulFBajt]         ; nulovac¡ bajt
         mov       ah,0                     ; nen¡ barva
         push      ds
         pop       es
         mov       di,offset SNMnVPl1       ; buffer k dek¢dov n¡ bajtu
         call      far ptr DekHByte         ; dek¢dov n¡ bajtu nulov n¡

; ------ nastaven¡ p©ep¡na‡– menu

         mov       dl,ds:[RusParm2]         ; parametry
         call      far ptr SetSwch          ; nastaven¡ p©ep¡na‡e

; ------ obsluha menu

         mov       ax,word ptr ds:[SMnuVert+MnuPoz] ; pozice p©edchoz¡ho okna
         add       ax,807h                  ; posun okna
         mov       word ptr ds:[si+MnuPoz],ax        ; pozice okna
         jmp       far ptr VertMenu

; ------ zad n¡ bajtu k nulov n¡

RusSoNB  PROC      FAR

         push      si
         push      ds
         pop       es
         mov       dx,word ptr ds:[si+MnuPoz]
         add       dx,1*HI+16
         mov       si,offset SNMnVHl1
         mov       di,offset SNMnVPl1
         call      far ptr MenBHex          ; zad n¡ nov‚ hodnoty ‡¡sla
         mov       ds:[NulFBajt],al         ; nov  hodnota bajtu
         pop       si
RusSoNB2:call      far ptr DispMnu          ; nov‚ zobrazen¡ menu
         ret

RusSoNB  ENDP

; ------ p©ep¡na‡ nulov n¡

RusSoNN: xor       byte ptr ds:[RusParm2],bit0 ; zmˆna p©¡znaku
         or        byte ptr ds:[RusParm2],bit1
RusSoNN2:mov       dl,ds:[RusParm2]
         call      far ptr SetSwch          ; nov‚ nastaven¡ p©ep¡na‡–
         jmp       short RusSoNB2

; ------ p©ep¡na‡ ru¨en¡

RusSoNR: xor       byte ptr ds:[RusParm2],bit1 ; zmˆna p©¡znaku
         or        byte ptr ds:[RusParm2],bit0
         jmp       short RusSoNN2

RusSouTb db        bit0 + bit4 + bit6 + bit7 ; kurzor
         db        bit1 + bit4 + bit6 + bit7 ; ozna‡en‚
         db        bit3 + bit4 + bit6        ; zadan‚

; ------ zah jen¡ operace

RusSoub: add       sp,4                     ; zru¨en¡ n vratov‚ adresy

         mov       al,ds:[RusParm2]         ; aktu ln¡ nastaven¡ parametr–
         and       al,bit0+bit1             ; p©¡znak nulov n¡ a ru¨en¡
         and       byte ptr ds:[RusParm0],not bit0+bit1
         or        ds:[RusParm0],al         ; p©¡znak nulov n¡ a ru¨en¡
         mov       bx,ds:[si+MnuAkt]        ; aktivn¡ zvolen  polo‘ka
         mov       al,cs:[bx+RusSouTb-1-3]  ; parametry pro v˜bˆr polo‘ek
         jmp       short RusSou01

; ------ vstupn¡ bod z funk‡n¡ kl vesy (AL=typ operace)

RusSoubF LABEL     FAR

         or        byte ptr ds:[RusParm0],bit1 ; prov d¡ se ru¨en¡
         and       byte ptr ds:[RusParm0],not bit0 ; nen¡ nulov n¡

RusSou01:call      far ptr ClosMnuA         ; uzav©en¡ v¨ech oken menu
         call      far ptr InitFFil         ; inicializace vyhled v n¡
         jc        RusSoub0                 ; nen¡ ‘ dn  polo‘ka k operaci
         mov       byte ptr ds:[RusParm],0  ; inicializace parametr–
         and       byte ptr ds:[RusParm0],not bit7 ; nen¡ uschov n aktivn¡ adres ©

; ------ vytvo©en¡ datov‚ho bufferu pro nulov n¡

         test      byte ptr ds:[RusParm0],bit0 ; je nulov n¡ ?
         jz        RusSou03                 ; nen¡ nulov n¡
         call      far ptr CreatBuf         ; vytvo©en¡ datov‚ho bufferu
         jc        RusSoub0                 ; nedostatek pamˆti
         call      far ptr GetBuff          ; poskytnut¡ bufferu -> ES
         xor       di,di                    ; DI <- 0
         mov       cx,ds:[BuffSize]         ; velikost bufferu
         cld
         mov       al,ds:[NulFBajt]         ; nulovac¡ bajt
         rep       stosb                    ; vynulov n¡ bufferu

; ------ p©¡prava parametr– menu (BX=index typu operace)

RusSou03:mov       ax,ds:[bx+RusSTabH-2]    ; adresa n povˆdy
         mov       word ptr ds:[SR1MnLin+MnuHlp],ax
         mov       ax,ds:[bx+RusSTb2H-2]    ; adresa n povˆdy
         mov       word ptr ds:[SR3MnLin+MnuHlp],ax
         mov       ax,ds:[bx+RusSTabP-2]    ; adresa polo‘ky
         mov       word ptr ds:[SR1MnLin+MnuPol],ax
         mov       ax,ds:[bx+RusSTb2P-2]    ; adresa polo‘ky
         mov       word ptr ds:[SR3MnLin+MnuPol],ax

; ------ zad n¡ soubor– textem

         test      byte ptr ds:[FileTyp],bit3 ; je specifikace textem ?
         jz        RusSoub2                 ; nen¡ specifikace textem

RusSou00:mov       si,offset SRZMLin        ; menu zad n¡ soubor–
         call      far ptr Lin0Menu         ; obsluha volby
         jnc       RusSoub1                 ; volba OK

; ------ n vrat z operace

RusSoub0:jmp       far ptr Main0

; ------ rozbor zad n¡ parametr– operace

RusSoub1:call      far ptr RozborZ          ; rozbor zad n¡ parametr– operace
         jc        RusSoub0                 ; p©eru¨en¡ operace
         jnz       RusSou00                 ; opakov n¡ zad n¡

; ------ doplnˆn¡ na plnou cestu

         call      far ptr RozbFPth         ; doplnˆn¡ na pln‚ jm‚no
         jmp       short RusSou28

; ------ zobrazen¡ hl ¨en¡

RusSoub2:mov       si,offset SR1MnLin
         call      far ptr Lin0MenF         ; potvrzen¡ volby
         jc        RusSoub0                 ; p©eru¨en¡
         test      byte ptr ds:[FileTyp],bit1+bit2 ; jsou ozna‡en‚/v¨echny polo‘ky ?
         jz        RusSou28                 ; nejsou ozna‡en‚/v¨echny polo‘ky
         mov       si,offset SR3MnLin
         call      far ptr Lin0MenF         ; potvrzen¡
         jc        RusSoub0                 ; p©eru¨en¡

; ------ posledn¡ varov n¡ p©i nulov n¡ soubor–

RusSou28:test      byte ptr ds:[RusParm0],bit0 ; prov d¡ se nulov n¡ ?
         jz        RusSou29                 ; nen¡ nulov n¡ dat
         mov       si,offset SN3MnLin
         call      far ptr Lin0MenF
         jc        RusSoub0                 ; p©eru¨en¡

; ------ zobrazen¡ £vodn¡ho hl ¨en¡ (nevad¡ ‘e je stejn‚ pro ru¨en¡ i nulov n¡)

RusSou29:call      far ptr HistADir         ; ulo‘en¡ adres ©e do historie
         mov       si,offset RusimTxt       ; text "Ru¨¡m"
         call      far ptr InfDisp0         ; zobrazen¡ hl ¨en¡
         call      far ptr InitFSet         ; inicializace ozna‡en¡ polo‘ek

; ------ na‡ten¡ diskov˜ch informac¡ (pot©ebuje se zn t velikost alok. bloku)

         mov       al,ds:[FilePath]         ; disk
         sub       al,"A"                   ; korekce na ‡¡slo disku
         call      far ptr GetDInfo         ; diskov‚ informace

; ------ v˜po‡et velikosti aloka‡n¡ho bloku

         mul       cx                       ; v˜po‡et po‡tu bajt– na blok
         or        dx,dx
         jz        RusSou2A                 ; nen¡ v¡ce ne‘ 64 KB
         mov       ax,-1                    ; omezen¡ velikosti bloku
RusSou2A:mov       ds:[NulClust],ax         ; velikost bloku dat
         or        byte ptr ds:[FileParm],bit2 ; p©¡znak povolen¡ adres ©– stromu

; ------ nalezen¡ dal¨¡ho souboru ke zru¨en¡

RusSoub3:call      far ptr DispTime         ; obsluha zobrazen¡ ‡asu
         call      far ptr DarkNul          ; nulov n¡ stm¡va‡e obrazovky
         call      far ptr TestBEsc         ; test p©eru¨en¡ operace
         jc        RusSou31                 ; p©eru¨en¡ operace
         call      far ptr GetFFil          ; poskytnut¡ dal¨¡ho souboru
         jnc       RusSou32
RusSou31:jmp       RusSoub9                 ; nen¡ dal¨¡ soubor

; ------ zobrazen¡ aktivn¡ho okna

RusSou32:call      far ptr DispAAWn         ; zobrazen¡ aktivn¡ho okna

; ------ z kaz ru¨en¡ ROOT disku

         cmp       word ptr ds:[si+1],"\:"  ; je to ROOT adres © disku ?
         jne       RusSo314
         cmp       byte ptr ds:[si+3],0
         jne       RusSo314                 ; nen¡ to ROOT adres © disku

         mov       si,offset RotMnLin       ; chybov‚ hl ¨en¡
         call      far ptr Lin0MenF         ; chybov‚ hl ¨en¡
         jc        RusSou31                 ; p©eru¨en¡ operace
         jmp       RusSou44                 ; z kaz ru¨en¡ ROOT disku

; ------ £schova aktivn¡ho adres ©e disku (ES=DS !)

RusSo314:test      byte ptr ds:[RusParm0],bit7 ; uschov n aktivn¡ adres © ?
         jnz       RusSo320                 ; aktivn¡ adres © ji‘ byl uschov n

         mov       al,ds:[si]               ; ozna‡en¡ disku
         sub       al,"A"                   ; korekce na ‡¡slo disku
         mov       di,offset FileOPth       ; buffer adres ©e
         call      far ptr GetDir           ; na‡ten¡ aktivn¡ho adres ©e
         mov       ds:[FileOPtN],cx         ; d‚lka textu adres ©e
         call      far ptr TestBEsc         ; je p©eru¨en¡ operace ?
         jc        RusSou31                 ; p©eru¨en¡ operace

; ------ zobrazen¡ hl ¨en¡ o ru¨en¡ polo‘ky

RusSo320:test      byte ptr ds:[RusParm0],bit0 ; je nulov n¡ ?
         jz        RusSo321                 ; nen¡ nulov n¡
         mov       di,offset NulujTxt       ; text "Nuluji"
         call      far ptr InfKFile         ; zobrazen¡ hl ¨en¡
         jmp       short RusSo322

RusSo321:mov       di,offset RusimTxt       ; text "Ru¨¡m"
         call      far ptr InfFile          ; zobrazen¡ jm‚na souboru

; ------ potvrzen¡ ru¨en¡ v p©¡padˆ zad n¡ parametrem

RusSo322:test      byte ptr ds:[FileParm],bit3 ; je adres © p©i n vratu ?
         jnz       RusSou34                 ; p©i n vratu se nepotvrzuje
         test      byte ptr ds:[FileTyp],bit3 ; je specifikace textem ?
         jz        RusSou33                 ; nen¡ specifikace textem
         call      ZrusZad                  ; test zru¨en¡ polo‘ky zad n¡m
         jnc       RusSou33                 ; polo‘ka se ru¨¡
RusSo326:jmp       RusSou44                 ; polo‘ka se neru¨¡ - dal¨¡ polo‘ka

; ------ test, zda se ru¨¡ polo‘ka R/O

RusSou33:test      byte ptr ds:[FileFAtr],RO ; je polo‘ka R/O ?
         jz        RusSou34                 ; nen¡ polo‘ka R/O
         call      ZrusRO                   ; test zru¨en¡ polo‘ky R/O
         jc        RusSo326                 ; polo‘ka se neru¨¡ - dal¨¡

; ------ polo‘ka se ru¨¡ - odstranˆn¡ atributu R/O

         mov       ch,0
         mov       cl,ds:[FileFAtr]         ; atributy polo‘ky
         and       cl,not RO                ; nulov n¡ atributu R/O
         call      far ptr SetAFile         ; nulov n¡ atribut– polo‘ky

; ------ test, zda je soubor

RusSou34:test      byte ptr ds:[FileFAtr],DIR ; je to adres © ?
         jnz       RusSoub4                 ; byl nalezen adres ©

; ------ nulov n¡ souboru

         test      byte ptr ds:[RusParm0],bit0 ; nuluje se soubor ?
         jz        RusSou35                 ; nenuluje se
         call      NulFile                  ; nulov n¡ souboru nebo adres ©e
         jmp       short RusSou36

; ------ zru¨en¡ souboru

RusSou35:test      byte ptr ds:[RusParm0],bit1 ; ru¨¡ se soubor ?
         jz        RusSou38                 ; neru¨¡ se soubor
         call      far ptr DelFile          ; zru¨en¡ souboru ES:SI
RusSou36:jnc       RusSoub6                 ; soubor zru¨en OK

; ------ chyba - soubor nelze zru¨it

RusSou38:jmp       RusSoub7

; ------ test, zda je ru¨en aktivn¡ adres © disku

RusSoub4:test      byte ptr ds:[RusParm0],bit1 ; ru¨¡ se ?
         jz        RusSou44                 ; neru¨¡ se

         mov       ax,ds:[FileFilN]         ; d‚lka jm‚na adres ©e
         cmp       ax,ds:[FileOPtN]         ; je to aktivn¡ adres © ?
         jne       RusSou43                 ; nen¡ to aktivn¡ adres ©

; ------ zkr cen¡ d‚lky aktivn¡ho adres ©e

         add       ax,offset FileOPth       ; konec cesty
         xchg      ax,di                    ; DI <- adresa konce cesty
RusSou41:cmp       di,offset FileOPth+3     ; je ji‘ minim ln¡ d‚lka ?
         jbe       RusSou42                 ; je ji‘ minim ln¡ d‚lka
         dec       di                       ; sn¡‘en¡ ukazatele cesty
         dec       word ptr ds:[FileOPtN]   ; sn¡‘en¡ ‡¡ta‡e d‚lky cesty
         cmp       byte ptr ds:[di],"\"     ; je ji‘ oddˆlova‡ cesty ?
         jne       RusSou41                 ; nalezen¡ oddˆlova‡e cesty

; ------ nastaven¡ nov‚ho aktivn¡ho adres ©e (ES=DS !)

RusSou42:mov       byte ptr ds:[di],0       ; ozna‡en¡ konce cesty
         push      si
         mov       si,offset FileOPth       ; nov  cesta
         call      far ptr SetDir           ; nastaven¡ nov‚ho aktivn¡ho adres ©e
         pop       si

; ------ zru¨en¡ adres ©e

RusSou43:call      far ptr DelDir           ; zru¨en¡ adres ©e
         jnc       RusSoub6                 ; adres © zru¨en OK
         test      byte ptr ds:[FileTyp],bit3 ; je zad n¡ textem ?
         jnz       RusSoub7                 ; zad n¡ textem - neru¨¡ se hloubˆji
         test      byte ptr ds:[FileParm],bit3 ; je adres © pri n vratu ?
         jnz       RusSoub7                 ; je adres © p©i n vratu

; ------ u vno©en‚ho okna se dotaz neprov d¡

         cmp       word ptr ds:[FileWNum],0 ; je vno©en‚ okno ?
         jne       RusSoub5                 ; ru¨¡ se bez dotazu

; ------ dotaz, zda se m  ru¨it nepr zdn˜ adres ©

         call      ZrusDir                  ; zru¨en¡ nepr zdn‚ho adres ©e
         jnc       RusSoub5                 ; adres © se ru¨¡ OK

; ------ polo‘ka se NERU›‹ - z kaz vno©en¡ do podadres ©e

RusSou44:or        byte ptr ds:[FileParm],bit5 ; z kaz vno©en¡ do adres ©e
         jmp       short RusSoub7           ; adres © se neru¨¡

; ------ zru¨en¡ polo‘ek v nepr zdn‚m podadres ©i

RusSoub5:test      byte ptr ds:[RusParm0],bit0 ; je nulov n¡ ?
         jnz       RusSoub7                 ; je nulov n¡, neru¨¡ se hromadnˆ
         test      byte ptr ds:[RusParm0],bit1 ; je ru¨en¡ ?
         jz        RusSoub7                 ; neru¨¡ se
         call      ZrusVse                  ; zru¨en¡ nalezen‚ polo‘ky
         jmp       short RusSoub7

; ------ polo‘ka zru¨ena OK (soubor nebo adres ©)

RusSoub6:call      far ptr ResFFil          ; nulov n¡ ozna‡en¡ polo‘ky
         mov       si,offset FilePath       ; jm‚no ru¨en‚ polo‘ky
         push      ds
         pop       es
         mov       cx,ds:[FilePthN]         ; d‚lka textu cesty
         mov       di,offset FileFPol       ; vzor polo‘ky
         mov       dx,ds                    ; DX <- segment vzoru polo‘ky
         call      far ptr DelWFile         ; zru¨en¡ polo‘ky z oken
         call      far ptr DispAAWn         ; zobrazen¡ aktivn¡ho okna
         call      far ptr DispNAWn         ; zobrazen¡ neaktivn¡ho okna
         jmp       short RusSou72

; ------ aktualizace okna

RusSoub7:mov       si,offset FilePath       ; jm‚no ru¨en‚ polo‘ky
         push      ds
         pop       es                       ; ES <- datov˜ segment
         call      far ptr ModiWDir         ; aktualizace oken

; ------ test, zda je p©eru¨en¡ operace

RusSou72:call      far ptr TestBEsc         ; je p©eru¨en¡ operace ?
         jc        RusSoub9                 ; je p©eru¨en¡ operace
         jmp       RusSoub3                 ; dal¨¡ soubor

; ------ uzav©en¡ re‘imu ru¨en¡

RusSoub9:jmp       RusSoub0

; -----------------------------------------------------------------------------
;                                  ZrusVse
;          hromadn‚ zru¨en¡ soubor– v nalezen‚m adres ©i FILEPATH
; -----------------------------------------------------------------------------
;þ
ZrusVse  PROC      NEAR

; ------ £schova registr–

         push      ax
         push      bx
         push      cx
         push      dx
         push      si
         push      di
         push      bp
         push      es
         mov       bp,sp
         sub       sp,FileMax               ; buffer k £schovˆ adres ©e

; ------ p©¡prava ‡¡sla disku

         mov       al,ds:[FilePath]         ; disk
         add       al, -"A" + 1             ; korekce na ‡¡slo disku
         mov       ds:[FCBAll],al           ; ‡¡slo po‘adovan‚ho disku

; ------ £schova aktivn¡ho adres ©e disku

         dec       ax                       ; korekce ‡¡sla disku
         push      ss
         pop       es
         mov       di,sp                    ; buffer k £schovˆ aktiv. adres ©e
         call      far ptr GetDir           ; poskytnut¡ aktivn¡ho adres ©e
         jc        ZrusVse9

; ------ nastaven¡ po‘adovan‚ho aktivn¡ho adres ©e

         push      ds
         pop       es
         mov       si,offset FilePath       ; adres ©
         call      far ptr SetDir           ; nastaven¡ adres ©e
         jc        ZrusVse9                 ; chyba

; ------ zru¨en¡ v¨ech polo‘ek v adres ©i

         call      far ptr TestBreak        ; je p©eru¨en¡ ?
         jc        ZrusVse8                 ; je p©eru¨en¡
         mov       dx,offset FCBAll         ; specifikace - v¨echny soubory
         mov       ah,13h
         int       21h                      ; zru¨en¡ v¨ech soubor–

; ------ n vrat p–vodn¡ho aktivn¡ho adres ©e

ZrusVse8:call      far ptr ZapKrit          ; zapnut¡ kritick‚ sekce
         push      ss
         pop       es
         mov       si,sp                    ; p–vodn¡ aktivn¡ adres ©
         call      far ptr SetDir           ; n vrat aktivn¡ho adres ©e
         call      far ptr VypKrit          ; vypnut¡ kritick‚ sekce

; ------ n vrat registr–

ZrusVse9:mov       sp,bp
         pop       es
         pop       bp
         pop       di
         pop       si
         pop       dx
         pop       cx
         pop       bx
         pop       ax
         ret

ZrusVse  ENDP

; -----------------------------------------------------------------------------
;                                  ZrusZad
;                dotaz, zda se bude nalezen  polo‘ka ru¨it
; -----------------------------------------------------------------------------
; VSTUP: parametry souboru ve FILEPATH atd.
; VSTUP: CY=polo‘ka se neru¨¡ (nebo p©eru¨en¡ operace)
; -----------------------------------------------------------------------------
;þ
ZrusZad  PROC      NEAR

; ------ £schova registr–

         push      bx
         push      dx
         push      si

; ------ test, zda se ru¨¡ v¨echny polo‘ky

         test      byte ptr ds:[FileFAtr],DIR ; byl nalezen adres © ?
         jnz       ZrusZad2                 ; byl nalezen adres ©
         test      byte ptr ds:[RusParm],bit4 ; ru¨¡ se v¨echny soubory ?
         jz        ZrusZad3                 ; neru¨¡ se
ZrusZad1:jmp       short ZrusZad9

ZrusZad2:test      byte ptr ds:[RusParm],bit5 ; ru¨¡ se v¨echny adres ©e ?
         jnz       ZrusZad1                 ; ru¨¡ se v¨echny adres ©e

; ------ dotaz na zru¨en¡ polo‘ky

ZrusZad3:call      far ptr DekFParm         ; dek¢dov n¡ parametr– polo‘ky
         mov       si,offset SR4MnLin       ; menu pro soubor
         test      byte ptr ds:[FileFAtr],DIR ; byl nalezen adres © ?
         jz        ZrusZad5                 ; byl nalezen soubor
         mov       si,offset SR5MnLin       ; menu pro adres ©
ZrusZad5:call      far ptr Lin0MenF         ; zad n¡ volby
         call      far ptr JumpBX

         dw        1,ZrusZad7               ; polo‘ka se ru¨¡
         dw        2,ZrusZd72               ; ru¨¡ se v¨echny polo‘ky
         dw        3,ZrusZd54               ; dal¨¡
         dw        0,ZrusZd52               ; ESC

; ------ polo‘ka se neru¨¡ (je ESC)

ZrusZd52:call      far ptr SetEsc           ; nastaven¡ p©¡znaku p©eru¨en¡ ESC
ZrusZd54:stc                                ; polo‘ka se neru¨¡
         jmp       short ZrusZad8           ; p©eru¨en¡ operace

; ------ ru¨¡ se v¨echny n sleduj¡c¡ polo‘ky

ZrusZd72:test      byte ptr ds:[FileFAtr],DIR ; byl nalezen adres © ?
         jnz       ZrusZd74                 ; byl nalezen adres ©
         or        byte ptr ds:[RusParm],bit4 ; ru¨¡ se v¨echny soubory
         jmp       short ZrusZad7
ZrusZd74:or        byte ptr ds:[RusParm],bit5 ; ru¨¡ se v¨echny adres ©e

; ------ polo‘ka se ru¨¡

ZrusZad7:clc                                ; p©¡znak ru¨en¡ polo‘ky

; ------ obnoven¡ informa‡n¡ho © dku

ZrusZad8:pushf
         call      far ptr InfoDisp         ; obnoven¡ informa‡n¡ho © dku
         popf

; ------ n vrat registr–

ZrusZad9:pop       si
         pop       dx
         pop       bx
         ret

ZrusZad  ENDP

; -----------------------------------------------------------------------------
;                                  ZrusDir
;                dotaz, zda se bude nalezen˜ nepr zdn˜ adres © ru¨it
; -----------------------------------------------------------------------------
; VSTUP: parametry souboru ve FILEPATH atd.
; VSTUP: CY=adres © se neru¨¡ (nebo p©eru¨en¡ operace)
; -----------------------------------------------------------------------------
;þ
ZrusDir  PROC      NEAR

; ------ £schova registr–

         push      bx
         push      dx
         push      si

; ------ test, zda se ru¨¡ v¨echny adres ©e

         test      byte ptr ds:[RusParm],bit6 ; ru¨¡ se v¨echny adres ©e ?
         jnz       ZrusDir9                 ; ru¨¡ se v¨echny adres ©e
         test      byte ptr ds:[RusParm],bit7 ; p©esko‡¡ se v¨echny adres ©e ?
         stc
         jnz       ZrusDir9                 ; p©esko‡¡ se v¨echny adres ©e

; ------ dotaz na zru¨en¡ nepr zdn‚ho adres ©e

         call      far ptr DekFParm         ; dek¢dov n¡ parametr– polo‘ky
         mov       si,offset SR8MnLin       ; menu pro soubor
         call      far ptr Lin0MenF         ; zad n¡ volby
         call      far ptr JumpBX

         dw        1,ZrusDir7               ; zru¨it
         dw        2,ZrusDir6               ; v¨echny
         dw        3,ZrusDir5               ; dal¨¡
         dw        4,ZrusDir4               ; neru¨it
         dw        0,ZrusDir3               ; p©eru¨en¡

; ------ p©eru¨en¡ operace

ZrusDir3:call      far ptr SetEsc           ; nastaven¡ p©¡znaku p©eru¨en¡ ESC
         jmp       short ZrusDir9           ; p©eru¨en¡ operace

; ------ p©esko‡en¡ v¨ech n sleduj¡c¡ch adres ©–

ZrusDir4:or        byte ptr ds:[RusParm],bit7 ; p©esko‡¡ se v¨echny adres ©e
ZrusDir5:stc                                ; p©¡znak p©esko‡en¡ polo‘ky
         jmp       short ZrusDir8

; ------ ru¨¡ se v¨echny n sleduj¡c¡ adres ©e

ZrusDir6:or        byte ptr ds:[RusParm],bit6 ; ru¨¡ se v¨echny adres ©e
ZrusDir7:clc                                ; p©¡znak zru¨en¡ polo‘ky

; ------ obnoven¡ informa‡n¡ho © dku

ZrusDir8:pushf
         call      far ptr InfoDisp         ; obnoven¡ informa‡n¡ho © dku
         popf                               ; p©¡znak ru¨en¡ polo‘ky

; ------ n vrat registr–

ZrusDir9:pop       si
         pop       dx
         pop       bx
         ret

ZrusDir  ENDP

; -----------------------------------------------------------------------------
;                               ZrusRO
;                   test, zda se polo‘ka R/O m  ru¨it
; -----------------------------------------------------------------------------
; VSTUP: FILEPATH=jm‚no polo‘ky
;        DS=datov˜ segment
; VSTUP: CY=polo‘ka se neru¨¡ (nebo p©eru¨en¡ operace)
; -----------------------------------------------------------------------------
;þ
ZrusRO   PROC      NEAR

; ------ £schova registr–

         push      bx
         push      dx
         push      si

; ------ test, zda se ru¨¡ v¨echny polo‘ky

         test      byte ptr ds:[FileFAtr],DIR ; byl nalezen adres © ?
         jnz       ZrusRO2                  ; byl nalezen adres ©

         test      byte ptr ds:[RusParm],bit0 ; ru¨¡ se v¨echny soubory ?
         jnz       ZrusRO1                  ; soubory se ru¨¡
         test      byte ptr ds:[RusParm],bit1 ; p©esko‡¡ se v¨echny soubory ?
         jz        ZrusRO3                  ; nep©esko‡¡ se v¨echny soubory
ZrusRO0: stc                                ; p©¡znak p©esko‡en¡ polo‘ky
ZrusRO1: jmp       short ZrusRO9

ZrusRO2: test      byte ptr ds:[RusParm],bit2 ; ru¨¡ se v¨echny adres ©e ?
         jnz       ZrusRO1                  ; ru¨¡ se v¨echny adres ©e
         test      byte ptr ds:[RusParm],bit3 ; p©esko‡¡ se v¨echny adres ©e ?
         jnz       ZrusRO0                  ; p©esko‡¡ se v¨echny adres ©e

; ------ dotaz na zru¨en¡ polo‘ky

ZrusRO3: call      far ptr DekFParm         ; dek¢dov n¡ parametr– polo‘ky
         mov       si,offset SR6MnLin       ; menu pro soubor
         test      byte ptr ds:[FileFAtr],DIR ; byl nalezen adres © ?
         jz        ZrusRO4                  ; byl nalezen soubor
         mov       si,offset SR7MnLin       ; menu pro adres ©
ZrusRO4: call      far ptr Lin0MenF         ; zad n¡ volby
         call      far ptr JumpBX

         dw        1,ZrusRO74               ; zru¨it
         dw        2,ZrusRO7                ; v¨echny
         dw        3,ZrusRO64               ; dal¨¡
         dw        4,ZrusRO6                ; neru¨it
         dw        0,ZrusRO5                ; p©eru¨en¡

; ------ p©eru¨en¡ volby

ZrusRO5: call      far ptr SetEsc           ; nastaven¡ p©¡znaku p©eru¨en¡ ESC
         jmp       short ZrusRO9

; ------ p©esko‡¡ se v¨echny n sleduj¡c¡ polo‘ky

ZrusRO6: test      byte ptr ds:[FileFAtr],DIR ; byl nalezen adres © ?
         jnz       ZrusRO62                ; byl nalezen adres ©
         or        byte ptr ds:[RusParm],bit1 ; p©esko‡¡ se v¨echny soubory
         jmp       short ZrusRO64
ZrusRO62:or        byte ptr ds:[RusParm],bit3 ; p©esko‡¡ se v¨echny adres ©e
ZrusRO64:stc                                ; polo‘ka se p©esko‡¡
         jmp       short ZrusRO8

; ------ ru¨¡ se v¨echny n sleduj¡c¡ polo‘ky

ZrusRO7: test      byte ptr ds:[FileFAtr],DIR ; byl nalezen adres © ?
         jnz       ZrusRO72                ; byl nalezen adres ©
         or        byte ptr ds:[RusParm],bit0 ; ru¨¡ se v¨echny soubory
         jmp       short ZrusRO74
ZrusRO72:or        byte ptr ds:[RusParm],bit2 ; ru¨¡ se v¨echny adres ©e
ZrusRO74:clc                                ; p©¡znak zru¨en¡ polo‘ky

; ------ obnoven¡ informa‡n¡ho © dku

ZrusRO8: pushf
         call      far ptr InfoDisp         ; obnoven¡ informa‡n¡ho © dku
         popf

; ------ n vrat registr–

ZrusRO9: pop       si
         pop       dx
         pop       bx
         ret

ZrusRO   ENDP

; -----------------------------------------------------------------------------
;                                NulFile
;                      nulov n¡ nalezen‚ho souboru
; -----------------------------------------------------------------------------
; VSTUP: DS=datov˜ segment
;        FILEPATH=nalezen˜ soubor
; VSTUP: CY=soubor nebyl vynulov n
; -----------------------------------------------------------------------------
;þ
NulFile  PROC      NEAR

; ------ £schova registr–

         push      ax
         push      bx
         push      cx
         push      dx
         push      si
         push      di
         push      es

; ------ jm‚no souboru

         push      ds
         pop       es
         mov       si,offset FilePath       ; jm‚no souboru

; ------ p©¡prava velikosti dat k z pisu -> DX:BX

         mov       ax,word ptr ds:[FileFSiz]; velikost souboru LOW
         mov       dx,word ptr ds:[FileFSiz+2] ; velikost souboru HIGH
         mov       cx,ds:[NulClust]         ; po‡et bajt– na blok
         dec       cx                       ; po‡et bajt– na blok - 1
         add       ax,cx                    ; zarovn n¡ nahoru
         adc       dx,0
         inc       cx
         cmp       dx,cx
         jae       NulFil12
         div       cx
         mul       cx                       ; zaokrouhlen¡ na bloky
NulFil12:xchg      ax,bx                    ; BX <- velikost dat LOW

; ------ otev©en¡ souboru ES:SI pro z pis

         call      far ptr OpenRW           ; otev©en¡ souboru pro z pis
         jnc       NulFile1
         jmp       NulFile9                 ; chyba operace

; ------ adresa datov‚ho bufferu -> ES

NulFile1:call      far ptr GetBuff          ; adresa datov‚ho bufferu
         mov       cx,ds:[BuffSize]         ; velikost bufferu

; ------ stanoven¡ velikosti bloku dat k z pisu

NulFile2:or        dx,dx                    ; je v¡ce ne‘ 64 KB ?
         jnz       NulFile3                 ; zb˜v  v¡ce ne‘ 64 KB
         cmp       cx,bx                    ; je buffer men¨¡ ?
         jbe       NulFile3                 ; buffer je men¨¡
         mov       cx,bx                    ; omezen¡ velikosti dat
NulFile3:sub       bx,cx                    ; sn¡‘en¡ ‡¡ta‡e zbyl˜ch dat
         sbb       dx,0                     ; p©enos HIGH
         jcxz      NulFile4                 ; konec dat

; ------ z pis jednoho bloku dat (p©i pln‚m disku je CX=0)

         xor       si,si
         call      far ptr WritFile         ; z pis bloku dat
         call      far ptr InfoKurz         ; zobrazen¡ kurzoru operace
         jmp       short NulFile2

; ------ useknut¡ dat (zde je CX=0)

NulFile4:test      byte ptr ds:[RusParm0],bit1 ; prov d¡ se ru¨en¡ ?
         jz        NulFil42                 ; soubor se neru¨¡
         xor       dx,dx                    ; ukazatel souboru na za‡ tek
         call      far ptr SetUFile         ; nastaven¡ ukazatele v souboru
         call      far ptr WritFile         ; useknut¡ dat (z pisem 0)

; ------ nulov n¡ data a ‡asu souboru

NulFil42:xor       cx,cx                    ; ‡as souboru
         xor       dx,dx                    ; datum souboru
         call      far ptr SetDFile         ; nastaven¡ data a ‡asu souboru

; ------ uzav©en¡ souboru

         call      far ptr ClosFile         ; uzav©en¡ souboru

; ------ nulov n¡ atribut– souboru

         xor       cx,cx                    ; CX <- 0 atributy
         push      ds
         pop       es
         mov       si,offset FilePath       ; jm‚no souboru
         call      far ptr SetAFile         ; nulov n¡ atribut– souboru

; ------ p©enos textu cesty do c¡lov‚ho bufferu

         mov       di,offset CilPath        ; buffer c¡lov‚ cesty
         mov       cx,ds:[FilePthN]         ; d‚lka textu cesty
         cld
         rep       movsb                    ; p©enos textu cesty
         mov       al,"\"
         dec       di
         scasb                              ; kon‡¡ cesta znakem "\" ?
         je        NulFile5                 ; kon‡¡ znakem "\"
         stosb                              ; ulo‘en¡ oddˆlova‡e "\"

; ------ p©id n¡ jm‚na souboru

NulFile5:mov       al,"$"                   ; jm‚no bude "$000"
         stosb
         mov       al,"0"
         stosb
         stosb
         stosb
         mov       bx,di                    ; BX <- £schova konce jm‚na
         mov       al,0
         stosb                              ; ukon‡ovac¡ 0

; ------ test, zda je chybov‚ p©eru¨en¡ operace

NulFile6:call      far ptr TestBEsc         ; test chyby
         jc        NulFile9                 ; chyba - p©eru¨en¡ operace

; ------ test, zda m  b˜t ru¨en¡ souboru

         test      byte ptr ds:[RusParm0],bit1 ; prov d¡ se ru¨en¡ ?
         stc                                ; p©¡znak, ‘e soubor nebyl zru¨en
         jz        NulFile9                 ; soubor se neru¨¡

; ------ p©ejmenov n¡ souboru

         mov       si,offset FilePath       ; star‚ jm‚no souboru
         mov       di,offset CilPath        ; nov‚ jm‚no souboru
         mov       dx,ds                    ; DX <- segment nov‚ho jm‚na
         call      far ptr RenFile          ; p©ejmenov n¡ souboru
         jnc       NulFile8                 ; soubor p©ejmenov n OK

; ------ zmˆna jm‚na souboru

         mov       di,bx                    ; konec cesty
NulFile7:dec       di
         inc       byte ptr ds:[di]         ; zv˜¨en¡ ‡¡slice
         cmp       byte ptr ds:[di],"9"+1   ; p©ete‡en¡ ?
         jne       NulFile6                 ; dal¨¡ pokus
         mov       byte ptr ds:[di],"0"
         cmp       byte ptr ds:[di-1],"$"
         jne       NulFile7
         mov       di,si                    ; DI <- p–vodn¡ jm‚no souboru

; ------ zru¨en¡ souboru

NulFile8:mov       si,di                    ; SI <- nov‚ jm‚no souboru
         call      far ptr ZapKrit          ; zapnut¡ kritick‚ sekce
         call      far ptr DelFile          ; zru¨en¡ souboru
         call      far ptr VypKrit          ; vypnut¡ kritick‚ sekce

; ------ n vrat registr–

NulFile9:pop       es
         pop       di
         pop       si
         pop       dx
         pop       cx
         pop       bx
         pop       ax
         ret

NulFile  ENDP

;         mov       ax,word ptr ds:[FileFSiz]
;         mov       word ptr ds:[CopyDRea],ax
;         mov       ax,word ptr ds:[FileFSiz+2]
;         mov       word ptr ds:[CopyDRea+2],ax
;         test      byte ptr ds:[FileFAtr],DIR
;         jz        RusSou62
;;         mov       ax,word ptr ds:[CopyDBlk]
;         mov       ax,ds:[NulClust]
;         mov       word ptr ds:[CopyDRea],ax
;;         mov       ax,word ptr ds:[CopyDBlk+2]
;;         mov       word ptr ds:[CopyDRea+2],ax
;RusSou62:mov       bp,offset FilePath
;         mov       cx,ds:[FilePthN]
;
;         call      far ptr AWDAkAW          ; aktualizace okna

;; -----------------------------------------------------------------------------
;;        aktualizace oken po zru¨en¡ souboru
;; -----------------------------------------------------------------------------
;; VSTUP: DS:BP=jm‚no souboru ASCIIZ
;;        CX=d‚lka textu adres ©e (bez jm‚na souboru)
;; -----------------------------------------------------------------------------
;
;AWDAkAW  PROC      FAR
;
;         push      ax
;
;         mov       ax,ds:[SegmRAdr]
;         cmp       ax,ds:[SegmAkt]
;         je        AWDAkAW1
;         cmp       ax,ds:[SegmNAkt]
;         je        AWDAkAW1
;         call      AWDAktW          ; aktualizace obsahu okna
;
;AWDAkAW1:mov       ax,ds:[SegmLAdr]
;         cmp       ax,ds:[SegmAkt]
;         je        AWDAkAW2
;         cmp       ax,ds:[SegmNAkt]
;         je        AWDAkAW2
;         call      AWDAktW          ; aktualizace obsahu okna
;
;AWDAkAW2:mov       ax,ds:[SegmAkt]
;         call      AWDAktW          ; aktualizace obsahu okna
;         call      far ptr DispAWin
;
;         mov       ax,ds:[SegmNAkt]
;         call      AWDAktW
;         call      far ptr DispAWin
;
;         cmp       word ptr ds:[FileWNum],0
;         je        AWDAkAW3
;         mov       ax,ds:[FileWSeg] ; adresa prvn¡ho okna
;         cmp       ax,ds:[SegmAkt]
;         je        AWDAkAW3
;         call      AWDAktW
;AWDAkAW3:
;         pop       ax
;         ret
;
;AWDAkAW  ENDP
;
;
;AWDAktW  PROC      NEAR
;
;         push      bx
;         push      cx
;         push      dx
;         push      si
;         push      di
;         push      es
;
;         call      far ptr GetDat           ; poskytnut¡ adresy okna
;         jnc       AWDAktW1
;AWDAktW0:jmp       AWDAktW9
;
;; ------ test, zda odpov¡d  disk
;
;AWDAktW1:mov       si,bp                    ; zadan‚ jm‚no adres ©e
;         mov       di,AWinDir               ; adres © okna
;         mov       bl,ds:[si]               ; ozna‡en¡ disku
;         cmp       bl,es:[AWinDir]          ; souhlas¡ disk ?
;         jne       AWDAktW0                 ; disk nesouhlas¡
;
;; ------ aktualizace diskov˜ch informac¡ okna
;
;         push      ax
;         push      dx
;
;         mov       ax,word ptr ds:[CopyDRea] ; ukazatel na‡ten˜ch dat
;         mov       dx,word ptr ds:[CopyDRea+2]
;         mov       bx,es:[AWinAlok]          ; velikost bloku
;         dec       bx
;         add       ax,bx                    ; zaokrouhlen¡ nahoru
;         adc       dx,0
;         inc       bx
;         cmp       dx,bx
;         jae       AWDAkW11
;         div       bx                       ; AX <- po‡et blok–
;         mul       bx                       ; DX:AX <- zaokrouhlen  velikost
;         add       word ptr es:[AWinDFre],ax ; oprava voln‚ho m¡sta
;         adc       word ptr es:[AWinDFre+2],dx
;
;AWDAkW11:pop       dx
;         pop       ax
;
;; ------ test, zda je adres ©
;
;         mov       bh,es:[AWinPrm1]         ; parametry
;         test      bh,bit3                  ; je to adres © ?
;         jz        AWDAktW0                 ; nen¡ to adres ©
;
;; ------ kontrola, zda se adres © shoduje
;
;AWDAkW14:cmp       cx,es:[AWinDNum]         ; souhlas¡ d‚lka adres ©e ?
;         jne       AWDAktW0                 ; adres © nesouhlas¡
;         cld
;         repe      cmpsb                    ; porovn n¡ adres ©–
;         jne       AWDAktW0                 ; adres © se neshoduje
;         mov       bx,si
;
;; ------ test, zda soubor existuje
;
;         push      ds
;         pop       es
;         mov       si,bp                    ; jm‚no souboru
;         call      far ptr ExisFile         ; test, zda soubor existuje
;         jnc       AWDAktW9                 ; soubor nalezen - to je chyba
;
;; ------ konverze jm‚na nalezen‚ho souboru ES:SI na tvar FCB
;
;         mov       si,bx                    ; jm‚no souboru
;         cmp       byte ptr ds:[si],"\"
;         jne       AWDAkW15
;         inc       si
;AWDAkW15:sub       si,offset DTAName        ; fiktivin¡ polo‘ka DTA
;         call      far ptr GetBFCB          ; konverze na tvar FCB
;
;; ------ nalezen¡ polo‘ky v seznamu (-> ES:SI adresa)
;
;         call      far ptr TestWPol         ; test polo‘ky FCB, zda je v oknˆ
;         jc        AWDAktW9                 ; polo‘ka v oknˆ nenalezena OK
;
;; ------ zru¨en¡ polo‘ky ES:SI ze seznamu
;
;         call      far ptr DelWFile         ; zru¨en¡ polo‘ky ze seznamu
;
;; ------ n vrat registr–
;
;AWDAktW9:pop       es
;         pop       di
;         pop       si
;         pop       dx
;         pop       cx
;         pop       bx
;         ret
;
;AWDAktW  ENDP

CodeFil  ENDS

; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°
;
;
;                                 Data
;
;
; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°
;þ
Data     SEGMENT

; -----------------------------------------------------------------------------
;        menu volby soubor– k ru¨en¡
; -----------------------------------------------------------------------------

SRMnVert label     BYTE

         db        2                        ; typ menu - vertik ln¡ podmenu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        6                        ; po‡et platn˜ch polo‘ek menu
         dw        7                        ; celkov˜ po‡et polo‘ek menu

         dw        SRMnVPol                 ; defini‡n¡ tabulka polo‘ek
         dw        SRMnVHlp                 ; n povˆda
         dw        Hlp@MenuRuseniANulovaniSouboru ; ‡¡slo str nky velk‚ n povˆdy
         dw        SRMnVBlk                 ; blokovac¡ tabulka
         dw        SRMnVSwc                 ; p©ep¡na‡e
         dw        SRMnVTit                 ; adresa titulu okna
         dw        SRMnVExe                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        36                       ; po‡ te‡n¡ pozice
         db        8                        ; po‡ te‡n¡ © dek
         db        20                       ; ¨¡©ka okna
         db        9                        ; v˜¨ka okna

SRMnVPol db        1,16,'Bajt nulov n¡ '
SNMnVPl1 db        '  '
         db        bit7+1,8,'Nulov n¡'
         db        bit7+1,6,'Ru¨en¡'
         db        bit6+bit7,0
         db        1,6,'Kurzor'
         db        1,8,'Ozna‡en‚'
         db        1,6,'Zadan‚'

; Polo‘ky modifikovan‚ p©i inicializaci programu !

SRMnVBlk db        0,0,0,0,0,0
SRMnVSwc db        0,0

SRMnVTit db        6,'ru¨en¡'

HelpS    SEGMENT   BYTE PUBLIC
SRMnVHlp db        63,'Zad n¡ bajtu k vynulov n¡ dat souboru (00 a‘ FF v HEX k¢du)'
         db        66,'Vynulov n¡ souboru p©ed zru¨en¡m - soubor nelze ji‘ zpˆtnˆ obnovit'
         db        59,'Bude prov dˆno ru¨en¡ soubor– (jinak jen vynulov n¡ obsahu)'
         db        53,'Zru¨en¡ souboru nebo adres ©e pod kurzorem (Alt-F8)'
         db        44,'Zru¨en¡ ozna‡en˜ch soubor– a adres ©– (F8)'
         db        53,'Zru¨en¡ soubor– podle bli‘¨¡ specifikace (Shift-F8)'
SNMnVHl1 db        70,'Zadejte hodnotu bajtu k nulov n¡ dat souboru (00 a‘ FF v HEX k¢du)'
HelpS    ENDS

SRMnVExe label     dword                    ; obsluhy voleb
         dd        RusSoNB                  ; bajt
         dd        RusSoNN                  ; nulov n¡
         dd        RusSoNR                  ; ru¨en¡
         dd        RusSoub                  ; kurzor
         dd        RusSoub                  ; ozna‡en‚
         dd        RusSoub                  ; zadan‚

; -----------------------------------------------------------------------------
;       Volba soubor– ke zru¨en¡ (p©i zad n¡ textem)
; -----------------------------------------------------------------------------

SRZMLin  label     byte

         db        3                        ; typ menu - © dkov‚ podmenu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka menu
         dw        3                        ; po‡et platn˜ch polo‘ek menu
         dw        5                        ; celkov˜ po‡et polo‘ek menu

         dw        SRZMLPol                 ; za‡ tek definice polo‘ek menu
         dw        SRZMLHlp                 ; adresa tabulky text– n povˆdy
         dw        Hlp@VyberSouboru         ; ‡¡slo str nky velk‚ n povˆdy
         dw        SRZMLBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        SRZMLTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        23                       ; po‡ te‡n¡ pozice okna
         db        7                        ; po‡ te‡n¡ © dek okna
         db        45                       ; ¨¡©ka okna
         db        8                        ; v˜¨ka okna

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        1                        ; celkov˜ po‡et © dk–
         dw        1                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; zak zan‚ znaky

         db        HistFile                 ; identifik tor historie
         db        1                        ; po‡et p©edvoleb

         dw        3                        ; d‚lka p©edvolby
         dd        All                      ; p©edvolba

; ------ polo‘ky voleb

SRZMLPol db        bit6,19,'Soubory ke zru¨en¡:'
         db        0,0
         db        bit6+bit7,0
         db        1,6,'Proveƒ'
         db        1,6,'N vrat'

SRZMLBlk db        0,0,0                    ; blokovac¡ tabulka

SRZMLTit db        6,'zadan‚'

; ------ n povˆda

HelpS    SEGMENT   BYTE PUBLIC
SRZMLHlp db        3,1
         dw        MenuFndH
         db        51,'Zru¨en¡ soubor– a adres ©– podle zadan‚ specifikace'
         db        3,1
         dw        MenuHlP1
HelpS    ENDS

; -----------------------------------------------------------------------------
;        hl ¨en¡ o ru¨en¡ soubor– nebo adres ©–
; -----------------------------------------------------------------------------

SR1MnLin label     byte

         db        3                        ; typ menu - © dkov‚ menu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        2                        ; po‡et platn˜ch polo‘ek menu
         dw        4                        ; celkov˜ po‡et polo‘ek menu

         dw        SR1MnPl1                 ; adresa defini‡n¡ tabulky polo‘ek
         dw        SR1MnHl1                 ; adresa tabulky text– n povˆdy
         dw        Hlp@RuseniSouboru        ; ‡¡slo str nky velk‚ n povˆdy
         dw        SR1MnBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        SR1MnTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        6                        ; po‡ te‡n¡ pozice
         db        7                        ; po‡ te‡n¡ © dek
         db        50                       ; ¨¡©ka
         db        7                        ; v˜¨ka

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        0                        ; celkov˜ po‡et © dk–
         dw        0                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; dopl¤uj¡c¡ zak zan‚ znaky

         db        0                        ; identifik tor historie
         db        0                        ; po‡et p©edvoleb

SR1MnPl1 db        bit6,33,'Varov n¡ - zru¨¡m soubor '
         db        4,0,1
         dw        FileTxtP                 ; buffer jm‚na souboru
         db        0,' !'

         db        bit6+bit7,0
         db        1,5,'Ru¨it'
         db        1,7,'Neru¨it'

SR1MnPl2 db        bit6,34,'Varov n¡ - zru¨¡m adres © '
         db        4,0,1
         dw        FileTxtP                 ; buffer jm‚na adres ©e
         db        0,' !'

         db        bit6+bit7,0
         db        1,5,'Ru¨it'
         db        1,7,'Neru¨it'

SR1MnBlk db        0,0

SR1MnTit db        6,'ru¨en¡'

HelpS    SEGMENT   BYTE PUBLIC
SR1MnHl1 db        28,'Zru¨en¡ po‘adovan‚ho souboru'
         db        3,1
         dw        MenuHlP2

SR1MnHl2 db        50,'Zru¨en¡ po‘adovan‚ho adres ©e (v‡etnˆ podadres ©–)'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

; ------ 1 ozna‡en  polo‘ka

SR2MnPl1 db        bit6,42,'Ozna‡en '
         db        0,1
         dw        FileTxtP                 ; buffer ‡¡sla po‡tu soubor–
         db        0,' soubor/adres © ke zru¨en¡...'
         db        bit6+bit7,0
         db        1,10,'Pokra‡ovat'
         db        1,7,'Neru¨it'

; ------ 2 a‘ 4 ozna‡en‚ polo‘ky

SR2MnPl2 db        bit6,45,'Ozna‡eny '
         db        0,1
         dw        FileTxtP                 ; buffer ‡¡sla po‡tu soubor–
         db        0,' soubory/adres ©e ke zru¨en¡...'

         db        bit6+bit7,0
         db        1,10,'Pokra‡ovat'
         db        1,7,'Neru¨it'

; ------ 5 a v¡ce ozna‡en˜ch polo‘ek

SR2MnPl3 db        bit6,45,'Ozna‡eno '
         db        0,1
         dw        FileTxtP                 ; buffer ‡¡sla po‡tu soubor–
         db        0,' soubor–/adres ©– ke zru¨en¡...'

         db        bit6+bit7,0
         db        1,10,'Pokra‡ovat'
         db        1,7,'Neru¨it'

; ------ v¨echny adres ©e v oknˆ

SR2MnPl4 db        bit6,43,'Budou zru¨eny v¨echny soubory a adres ©e...'

         db        bit6+bit7,0
         db        1,5,'Ru¨it'
         db        1,7,'Neru¨it'

HelpS    SEGMENT   BYTE PUBLIC
SR2MnHl1 db        37,'Ozna‡en˜ soubor/adres © se bude ru¨it'
         db        3,1
         dw        MenuHlP2

SR2MnHl2 db        42,'Ozna‡en‚ soubory a adres ©e se budou ru¨it'
         db        3,1
         dw        MenuHlP2

SR2MnHl3 db        48,'V¨echny soubory a adres ©e v oknˆ se budou ru¨it'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

RusSTabH label     word                     ; tabulka n povˆd menu
         dw        SR1MnHl1                 ; kurzor - soubor
         dw        SR1MnHl2                 ; kurzor - adres ©
         dw        SR2MnHl1                 ; ozna‡en˜ soubor/adres ©
         dw        SR2MnHl2                 ; 2 a‘ 4 ozna‡en‚ polo‘ky
         dw        SR2MnHl2                 ; 5 a v¡ce ozna‡en˜ch polo‘ek
         dw        SR2MnHl3                 ; ... (v¨echny soubory)
         dw        SR2MnHl3                 ; v¨echny soubory a adres ©e
         dw        SR2MnHl3                 ; ... (zadan‚)

RusSTabP label     word                     ; tabulka polo‘ek menu
         dw        SR1MnPl1                 ; kurzor - soubor
         dw        SR1MnPl2                 ; kurzor - adres ©
         dw        SR2MnPl1                 ; ozna‡en˜ soubor/adres ©
         dw        SR2MnPl2                 ; 2 a‘ 4 ozna‡en‚ polo‘ky
         dw        SR2MnPl3                 ; 5 a v¡ce ozna‡en˜ch polo‘ek
         dw        SR2MnPl4                 ; ... (v¨echny soubory)
         dw        SR2MnPl4                 ; v¨echny soubory a adres ©e
         dw        SR2MnPl4                 ; ... (zadan‚)

; -----------------------------------------------------------------------------
;        varov n¡ p©ed zru¨en¡m ozna‡en˜ch polo‘ek
; -----------------------------------------------------------------------------

SR3MnLin label     byte

         db        3                        ; typ menu - © dkov‚ menu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        2                        ; po‡et platn˜ch polo‘ek menu
         dw        5                        ; celkov˜ po‡et polo‘ek menu

         dw        SR3MnPl1                 ; adresa defini‡n¡ tabulky polo‘ek
         dw        SR3MnHl1                 ; adresa tabulky text– n povˆdy
         dw        Hlp@RuseniSouboru        ; ‡¡slo str nky velk‚ n povˆdy
         dw        SR1MnBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        SR1MnTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        6                        ; po‡ te‡n¡ pozice
         db        7                        ; po‡ te‡n¡ © dek
         db        48                       ; ¨¡©ka
         db        8                        ; v˜¨ka

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        0                        ; celkov˜ po‡et © dk–
         dw        0                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; dopl¤uj¡c¡ zak zan‚ znaky

         db        0                        ; identifik tor historie
         db        0                        ; po‡et p©edvoleb

; ------ 1 ozna‡en  polo‘ka

SR3MnPl1 db        bit6,9,0,'VAROVN‹'
         db        bit6,38,'Zru¨¡m '
         db        0,1
         dw        FileTxtP                 ; buffer ‡¡sla po‡tu soubor–
         db        0,' ozna‡en˜ soubor/adres © !'
         db        bit6+bit7,0
         db        1,5,'Ru¨it'
         db        1,7,'Neru¨it'

; ------ 2 a‘ 4 ozna‡en‚ polo‘ky

SR3MnPl2 db        bit6,9,0,'VAROVN‹'
         db        bit6,40,'Zru¨¡m '
         db        0,1
         dw        FileTxtP                 ; buffer ‡¡sla po‡tu soubor–
         db        0,' ozna‡en‚ soubory/adres ©e !'

         db        bit6+bit7,0
         db        1,5,'Ru¨it'
         db        1,7,'Neru¨it'

; ------ 5 a v¡ce ozna‡en˜ch polo‘ek

SR3MnPl3 db        bit6,9,0,'VAROVN‹'
         db        bit6,42,'Zru¨¡m '
         db        0,1
         dw        FileTxtP                 ; buffer ‡¡sla po‡tu soubor–
         db        0,' ozna‡en˜ch soubor–/adres ©– !'

         db        bit6+bit7,0
         db        1,5,'Ru¨it'
         db        1,7,'Neru¨it'

; ------ v¨echny soubory a adres ©e

SR3MnPl4 db        bit6,9,0,'VAROVN‹'
         db        bit6,42,'Zru¨¡m v¨echny soubory a adres ©e v oknˆ !'

         db        bit6+bit7,0
         db        1,5,'Ru¨it'
         db        1,7,'Neru¨it'


HelpS    SEGMENT   BYTE PUBLIC
SR3MnHl1 db        35,'Zru¨en¡ ozna‡en‚ho souboru/adres ©e'
         db        3,1
         dw        MenuHlP2

SR3MnHl2 db        37,'Zru¨en¡ ozna‡en˜ch soubor– a adres ©–'
         db        3,1
         dw        MenuHlP2

SR3MnHl3 db        39,'Zru¨en¡ v¨ech soubor– a adres ©– v oknˆ'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

RusSTb2H label     word                     ; tabulka n povˆd menu - potvrzen¡
         dw        0                        ; kurzor - soubor
         dw        0                        ; kurzor - adres ©
         dw        SR3MnHl1                 ; ozna‡en˜ soubor/adres ©
         dw        SR3MnHl2                 ; 2 a‘ 4 ozna‡en‚ polo‘ky
         dw        SR3MnHl2                 ; 5 a v¡ce ozna‡en˜ch polo‘ek
         dw        SR3MnHl3                 ; v¨echny soubory
         dw        SR3MnHl3                 ; v¨echny soubory a adres ©e
         dw        0                        ; zadan‚

RusSTb2P label     word                     ; tabulka polo‘ek menu - potvrzen¡
         dw        0                        ; kurzor - soubor
         dw        0                        ; kurzor - adres ©
         dw        SR3MnPl1                 ; ozna‡en˜ soubor/adres ©
         dw        SR3MnPl2                 ; 2 a‘ 4 ozna‡en‚ polo‘ky
         dw        SR3MnPl3                 ; 5 a v¡ce ozna‡en˜ch polo‘ek
         dw        SR3MnPl4                 ; v¨echny soubory
         dw        SR3MnPl4                 ; v¨echny soubory a adres ©e
         dw        0                        ; zadan‚

; -----------------------------------------------------------------------------
;        nalezen¡ souboru bˆhem ru¨en¡ se zad n¡m textem
; -----------------------------------------------------------------------------

SR4MnLin label     byte

         db        3                        ; typ menu - © dkov‚ menu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        4                        ; po‡et platn˜ch polo‘ek menu
         dw        12                       ; celkov˜ po‡et polo‘ek menu

         dw        SR4MnPol                 ; adresa defini‡n¡ tabulky polo‘ek
         dw        SR4MnHlp                 ; adresa tabulky text– n povˆdy
         dw        Hlp@RuseniSouboru        ; ‡¡slo str nky velk‚ n povˆdy
         dw        SR4MnBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        SR4MnTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        6                        ; po‡ te‡n¡ pozice
         db        7                        ; po‡ te‡n¡ © dek
         db        54                       ; ¨¡©ka
         db        13                       ; v˜¨ka

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        0                        ; celkov˜ po‡et © dk–
         dw        0                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; dopl¤uj¡c¡ zak zan‚ znaky

         db        0                        ; identifik tor historie
         db        0                        ; po‡et p©edvoleb

SR4MnPol db        bit6,32,'Nalezen soubor ',0,1
         dw        SRMnuFil                 ; buffer jm‚na souboru
         db        0,' ke zru¨en¡.'

         db        bit6,0

         db        bit6,14,'Velikost: ',0,1
         dw        SRMnuSiz                 ; buffer velikosti

         db        bit6,14,'   Datum: ',0,1
         dw        SRMnuDat                 ; buffer data

         db        bit6,14,'     €as: ',0,1
         dw        SRMnuTim                 ; buffer ‡asu

         db        bit6,0

         db        bit6,32,'P©ejete si tento soubor zru¨it ?'

         db        bit6+bit7,0
         db        1,6,'Zru¨it'
         db        1,7,'V¨echny'
         db        1,5,'Dal¨¡'
         db        1,8,'P©eru¨it'

SR4MnBlk db        0,0,0,0

SR4MnTit db        6,'ru¨en¡'

HelpS    SEGMENT   BYTE PUBLIC
SR4MnHlp db        26,'Zru¨en¡ nalezen‚ho souboru'
         db        46,'Zru¨en¡ v¨ech n sleduj¡c¡ch soubor– bez dotazu'
         db        47,'Pokra‡ov n¡ d le bez zru¨en¡ nalezen‚ho souboru'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

; -----------------------------------------------------------------------------
;        nalezen¡ adres ©e bˆhem ru¨en¡ se zad n¡m textem
; -----------------------------------------------------------------------------

SR5MnLin label     byte

         db        3                        ; typ menu - © dkov‚ menu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        4                        ; po‡et platn˜ch polo‘ek menu
         dw        11                       ; celkov˜ po‡et polo‘ek menu

         dw        SR5MnPol                 ; adresa defini‡n¡ tabulky polo‘ek
         dw        SR5MnHlp                 ; adresa tabulky text– n povˆdy
         dw        Hlp@RuseniSouboru        ; ‡¡slo str nky velk‚ n povˆdy
         dw        SR4MnBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        SR4MnTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        6                        ; po‡ te‡n¡ pozice
         db        7                        ; po‡ te‡n¡ © dek
         db        54                       ; ¨¡©ka
         db        12                       ; v˜¨ka

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        0                        ; celkov˜ po‡et © dk–
         dw        0                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; dopl¤uj¡c¡ zak zan‚ znaky

         db        0                        ; identifik tor historie
         db        0                        ; po‡et p©edvoleb

SR5MnPol db        bit6,33,'Nalezen adres © ',0,1
         dw        SRMnuFil                 ; buffer jm‚na souboru
         db        0,' ke zru¨en¡.'

         db        bit6,0

         db        bit6,14,'   Datum: ',0,1
         dw        SRMnuDat                 ; buffer data

         db        bit6,14,'     €as: ',0,1
         dw        SRMnuTim                 ; buffer ‡asu

         db        bit6,0

         db        bit6,33,'P©ejete si tento adres © zru¨it ?'

         db        bit6+bit7,0
         db        1,6,'Zru¨it'
         db        1,7,'V¨echny'
         db        1,5,'Dal¨¡'
         db        1,8,'P©eru¨it'

HelpS    SEGMENT   BYTE PUBLIC
SR5MnHlp db        27,'Zru¨en¡ nalezen‚ho adres ©e'
         db        47,'Zru¨en¡ v¨ech n sleduj¡c¡ch adres ©– bez dotazu'
         db        48,'Pokra‡ov n¡ d le bez zru¨en¡ nalezen‚ho adres ©e'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

; -----------------------------------------------------------------------------
;        nalezen soubor chr nˆn atributem R/O
; -----------------------------------------------------------------------------

SR6MnLin label     byte

         db        3                        ; typ menu - © dkov‚ menu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        5                        ; po‡et platn˜ch polo‘ek menu
         dw        8                        ; celkov˜ po‡et polo‘ek menu

         dw        SR6MnPol                 ; adresa defini‡n¡ tabulky polo‘ek
         dw        SR6MnHlp                 ; adresa tabulky text– n povˆdy
         dw        Hlp@RuseniSouboru        ; ‡¡slo str nky velk‚ n povˆdy
         dw        SR6MnBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        SR6MnTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        6                        ; po‡ te‡n¡ pozice
         db        7                        ; po‡ te‡n¡ © dek
         db        62                       ; ¨¡©ka
         db        8                        ; v˜¨ka

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        0                        ; celkov˜ po‡et © dk–
         dw        0                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; dopl¤uj¡c¡ zak zan‚ znaky

         db        0                        ; identifik tor historie
         db        0                        ; po‡et p©edvoleb

SR6MnPol db        bit6,52,'Soubor ',0,1
         dw        SRMnuFil                 ; buffer jm‚na souboru
         db        0,' je chr nˆn proti zru¨en¡ atributem R/O.'

         db        bit6,32,'P©ejete si jej i p©esto zru¨it ?'

         db        bit6+bit7,0
         db        1,6,'Zru¨it'
         db        1,7,'V¨echny'
         db        1,5,'Dal¨¡'
         db        1,7,'Neru¨it'
         db        1,8,'P©eru¨it'

SR6MnBlk db        0,0,0,0,0

SR6MnTit db        11,'atribut R/O'

HelpS    SEGMENT   BYTE PUBLIC
SR6MnHlp db        53,'Zru¨en¡ tohoto souboru (s ignorov n¡m atributu R/O)'
         db        64,'Zru¨en¡ v¨ech n sleduj¡c¡ch soubor– s atributem R/O bez dotazu'
         db        43,'Pokra‡ov n¡ d le bez zru¨en¡ tohoto souboru'
         db        64,'Neru¨it ‘ dn˜ z n sleduj¡c¡ch soubor– ozna‡en˜ch atributem R/O'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

; -----------------------------------------------------------------------------
;        nalezen¡ adres ©e s atributem R/O
; -----------------------------------------------------------------------------

SR7MnLin label     byte

         db        3                        ; typ menu - © dkov‚ menu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        5                        ; po‡et platn˜ch polo‘ek menu
         dw        8                        ; celkov˜ po‡et polo‘ek menu

         dw        SR7MnPol                 ; adresa defini‡n¡ tabulky polo‘ek
         dw        SR7MnHlp                 ; adresa tabulky text– n povˆdy
         dw        Hlp@RuseniSouboru        ; ‡¡slo str nky velk‚ n povˆdy
         dw        SR6MnBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        SR6MnTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        6                        ; po‡ te‡n¡ pozice
         db        7                        ; po‡ te‡n¡ © dek
         db        62                       ; ¨¡©ka
         db        8                        ; v˜¨ka

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        0                        ; celkov˜ po‡et © dk–
         dw        0                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; dopl¤uj¡c¡ zak zan‚ znaky

         db        0                        ; identifik tor historie
         db        0                        ; po‡et p©edvoleb

SR7MnPol db        bit6,53,'Adres © ',0,1
         dw        SRMnuFil                 ; buffer jm‚na souboru
         db        0,' je chr nˆn proti zru¨en¡ atributem R/O.'

         db        bit6,32,'P©ejete si jej i p©esto zru¨it ?'

         db        bit6+bit7,0
         db        1,6,'Zru¨it'
         db        1,7,'V¨echny'
         db        1,5,'Dal¨¡'
         db        1,7,'Neru¨it'
         db        1,8,'P©eru¨it'

HelpS    SEGMENT   BYTE PUBLIC
SR7MnHlp db        54,'Zru¨en¡ tohoto adres ©e (s ignorov n¡m atributu R/O)'
         db        65,'Zru¨en¡ v¨ech n sleduj¡c¡ch adres ©– s atributem R/O bez dotazu'
         db        44,'Pokra‡ov n¡ d le bez zru¨en¡ tohoto adres ©e'
         db        65,'Neru¨it ‘ dn˜ z n sleduj¡c¡ch adres ©– ozna‡en˜ch atributem R/O'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

; -----------------------------------------------------------------------------
;        nalezen¡ nepr zdn‚ho adres ©e
; -----------------------------------------------------------------------------

SR8MnLin label     byte

         db        3                        ; typ menu - © dkov‚ menu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        5                        ; po‡et platn˜ch polo‘ek menu
         dw        8                        ; celkov˜ po‡et polo‘ek menu

         dw        SR8MnPol                 ; adresa defini‡n¡ tabulky polo‘ek
         dw        SR8MnHlp                 ; adresa tabulky text– n povˆdy
         dw        Hlp@RuseniSouboru        ; ‡¡slo str nky velk‚ n povˆdy
         dw        SR8MnBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        SR8MnTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        6                        ; po‡ te‡n¡ pozice
         db        7                        ; po‡ te‡n¡ © dek
         db        61                       ; ¨¡©ka
         db        8                        ; v˜¨ka

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        0                        ; celkov˜ po‡et © dk–
         dw        0                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; dopl¤uj¡c¡ zak zan‚ znaky

         db        0                        ; identifik tor historie
         db        0                        ; po‡et p©edvoleb

SR8MnPol db        bit6,27,'Adres © ',0,1
         dw        SRMnuFil                 ; buffer jm‚na souboru
         db        0,' nen¡ pr zdn˜.'

         db        bit6,32,'P©ejete si jej i p©esto zru¨it ?'

         db        bit6+bit7,0
         db        1,6,'Zru¨it'
         db        1,7,'V¨echny'
         db        1,5,'Dal¨¡'
         db        1,7,'Neru¨it'
         db        1,8,'P©eru¨it'

SR8MnTit db        17,'nepr zdn˜ adres ©'

HelpS    SEGMENT   BYTE PUBLIC
SR8MnHlp db        55,'Zru¨en¡ tohoto adres ©e v‡etnˆ v¨ech soubor– v adres ©i'
         db        59,'Zru¨en¡ v¨ech n sleduj¡c¡ch nepr zdn˜ch adres ©– bez dotazu'
         db        44,'Pokra‡ov n¡ d le bez zru¨en¡ tohoto adres ©e'
         db        50,'Neru¨it ‘ dn˜ z n sleduj¡c¡ch nepr zdn˜ch adres ©–'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

; Tabulka modifikov na p©i inicializaci programu !

SR8MnBlk db        0,0,0,0,0

; -----------------------------------------------------------------------------
;        varov n¡ p©ed nulov n¡m
; -----------------------------------------------------------------------------

SN3MnLin label     byte

         db        3                        ; typ menu - © dkov‚ menu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        2                        ; po‡et platn˜ch polo‘ek menu
         dw        6                        ; celkov˜ po‡et polo‘ek menu

         dw        SN3MnPol                 ; adresa defini‡n¡ tabulky polo‘ek
         dw        SN3MnHlp                 ; adresa tabulky text– n povˆdy
         dw        Hlp@MenuRuseniANulovaniSouboru ; ‡¡slo str nky velk‚ n povˆdy
         dw        SR1MnBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        SNMnVTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        6                        ; po‡ te‡n¡ pozice
         db        7                        ; po‡ te‡n¡ © dek
         db        44                       ; ¨¡©ka
         db        9                        ; v˜¨ka

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        0                        ; celkov˜ po‡et © dk–
         dw        0                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; dopl¤uj¡c¡ zak zan‚ znaky

         db        0                        ; identifik tor historie
         db        0                        ; po‡et p©edvoleb

SN3MnPol db        bit6,9,0,'VAROVN‹'
         db        bit6,32,'Zvolen‚ soubory a adres ©e budou'
         db        bit6,30,'nulov n¡m nen vratnˆ zni‡eny !'
         db        bit6+bit7,0
         db        1,7,'Nulovat'
         db        1,8,'P©eru¨it'

HelpS    SEGMENT   BYTE PUBLIC
SN3MnHlp db        54,'Zah jen¡ operace ru¨en¡ soubor– a adres ©– s nulov n¡m'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

SNMnVTit db        8,'nulov n¡'

; -----------------------------------------------------------------------------
;        ru¨en ROOT adres © disku
; -----------------------------------------------------------------------------

RotMnLin label     byte

         db        3                        ; typ menu - © dkov‚ menu

         db        0                        ; hladina k zobrazen¡ menu
         dw        1                        ; aktivn¡ polo‘ka volby
         dw        2                        ; po‡et platn˜ch polo‘ek menu
         dw        6                        ; celkov˜ po‡et polo‘ek menu

         dw        RotMnPol                 ; adresa defini‡n¡ tabulky polo‘ek
         dw        RotMnHlp                 ; adresa tabulky text– n povˆdy
         dw        Hlp@MenuRuseniANulovaniSouboru ; ‡¡slo str nky velk‚ n povˆdy
         dw        RotMnBlk                 ; adresa blokovac¡ tabulky
         dw        0                        ; adresa tabulky p©ep¡na‡–
         dw        RotMnTit                 ; adresa titulu okna
         dw        LinMenTE                 ; tabulka obsluh voleb menu
         dw        LinMenTM                 ; tabulka adres podmenu
         dd        0                        ; n vratov  adresa p©i p©eru¨en¡

         db        6                        ; po‡ te‡n¡ pozice
         db        7                        ; po‡ te‡n¡ © dek
         db        44                       ; ¨¡©ka
         db        9                        ; v˜¨ka

         dw        255                      ; maxim ln¡ d‚lka © dku
         dw        0                        ; prvn¡ zobrazen˜ © dek
         dw        0                        ; aktivn¡ zobrazen˜ © dek
         dw        0                        ; celkov˜ po‡et © dk–
         dw        0                        ; po‡et zobrazen˜ch © dk–

         db        bit2                     ; maska zad van˜ch znak–
         db        0,'      '               ; dopl¤uj¡c¡ zak zan‚ znaky

         db        0                        ; identifik tor historie
         db        0                        ; po‡et p©edvoleb

RotMnPol db        bit6,9,0,'VAROVN‹'
         db        bit6,31,'ROOT disku nen¡ povoleno ru¨it!'
         db        bit6,0
         db        bit6+bit7,0
         db        1,5,'Dal¨¡'
         db        1,8,'P©eru¨it'

HelpS    SEGMENT   BYTE PUBLIC
RotMnHlp db        38,'Pokra‡ov n¡ v operaci dal¨¡m adres ©em'
         db        3,1
         dw        MenuHlP2
HelpS    ENDS

RotMnBlk db        0,0                      ; blokovac¡ tabulka
RotMnTit db        10,'ru¨en ROOT'

; -----------------------------------------------------------------------------
;        data pro ru¨en¡ soubor–
; -----------------------------------------------------------------------------

;NulFBajt db        0                        ; nulovac¡ bajt soubor–
NulClust dw        0                        ; po‡et bajt– na aloka‡n¡ blok

RusimTxt db        7,'Ru¨¡m ',0

NulujTxt db        8,'Nuluji ',0

FCBAll   db        0                        ; disk
         db        '????????'               ; jm‚no souboru
         db        '???'                    ; p©¡pona jm‚na souboru
         db        25 dup(0)                ; ostatn¡ parametry FCB

RusParm  db        0                        ; parametry pro ru¨en¡
                                            ;   bit 0: 1=ru¨it soubory R/O
                                            ;   bit 1: 1=p©esko‡it soubory R/O
                                            ;   bit 2: 1=ru¨it adres ©e R/O
                                            ;   bit 3: 1=p©esko‡it adres ©e R/O
                                            ;   bit 4: 1=ru¨it v¨echny soubory
                                            ;   bit 5: 1=ru¨it v¨echny adres ©e
                                            ;   bit 6: 1=ru¨it nepr zdn‚ adres.
                                            ;   bit 7: 1=p©esko‡it nepr zdn‚ adr.

RusParm0 db        bit1                     ; aktu ln¡ nastaven¡ parametr–
                                            ;   bit 0: 1=prov d¡ se nulov n¡
                                            ;   bit 1: 1=prov d¡ se ru¨en¡

                                            ;   bit 7: 1=uschov n aktivn¡ adres ©
                                            ;            (buffer FileOPth,
                                            ;             d‚lka v FileOPtN)

;RusParm2 db        bit1                     ; parametry pro ru¨en¡ (z menu)
;                                            ;   bit 0: 1=prov d¡ se nulov n¡ dat
;                                            ;   bit 1: 1=prov d¡ se ru¨en¡

Data     ENDS
         END


; -----------------------------------------------------------------------------
;        rozk¢dov n¡ textu DS:AX (po 0)
; -----------------------------------------------------------------------------

12B3:0000 53             PUSH   BX 
12B3:0001 51             PUSH   CX 
12B3:0002 52             PUSH   DX 
12B3:0003 56             PUSH   SI 
12B3:0004 57             PUSH   DI 
12B3:0005 55             PUSH   BP 
12B3:0006 89E5           MOV    BP,SP 
12B3:0008 50             PUSH   AX 
12B3:0009 50             PUSH   AX 
12B3:000A 89C7           MOV    DI,AX 
12B3:000C 89C3           MOV    BX,AX 
12B3:000E BE9206         MOV    SI,0692 
12B3:0011 F7D8           NEG    AX 
12B3:0013 01F8           ADD    AX,DI 
12B3:0015 8946FC         MOV    [BP-04],AX 
12B3:0018 EB3E           JMP    0058 

12B3:001A 89F8         * MOV    AX,DI
12B3:001C E84D0B         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX
12B3:001F 0346FC         ADD    AX,[BP-04] 
12B3:0022 31D2           XOR    DX,DX 
12B3:0024 B90700         MOV    CX,0007 
12B3:0027 F7F1           DIV    CX 
12B3:0029 89D0           MOV    AX,DX 
12B3:002B 40             INC    AX 
12B3:002C BA0800         MOV    DX,0008 
12B3:002F 29C2           SUB    DX,AX 
12B3:0031 8A27           MOV    AH,[BX] 
12B3:0033 8866FE         MOV    [BP-02],AH 
12B3:0036 C646FF00       MOV    Byte Ptr [BP-01],00 
12B3:003A 88D1           MOV    CL,DL 
12B3:003C 8B56FE         MOV    DX,[BP-02] 
12B3:003F D3E2           SHL    DX,CL 
12B3:0041 8956FE         MOV    [BP-02],DX 
12B3:0044 88E2           MOV    DL,AH 
12B3:0046 30F6           XOR    DH,DH 
12B3:0048 88C1           MOV    CL,AL 
12B3:004A D3FA           SAR    DX,CL 
12B3:004C 8B46FE         MOV    AX,[BP-02] 
12B3:004F 09D0           OR     AX,DX 
12B3:0051 8804           MOV    [SI],AL 
12B3:0053 FF46FC         INC    Word Ptr [BP-04] 
12B3:0056 43             INC    BX 
12B3:0057 46             INC    SI 

12B3:0058 803F00         CMP    Byte Ptr [BX],00
12B3:005B 75BD           JNZ    001A 
12B3:005D C60400         MOV    Byte Ptr [SI],00 
12B3:0060 B89206         MOV    AX,0692 

12B3:0063 89EC           MOV    SP,BP
12B3:0065 5D             POP    BP 
12B3:0066 5F             POP    DI 
12B3:0067 E9CF01         JMP    0239 

; -----------------------------------------------------------------------------
;        dek¢dov n¡ chybov‚ho textu s ‡¡slem AX
; -----------------------------------------------------------------------------

12B3:006A 53             PUSH   BX
12B3:006B 89C3           MOV    BX,AX       ; ‡¡slo hl ¨en¡
12B3:006D D1E3           SHL    BX,1        ; offset v tabulce adres
12B3:006F A17200         MOV    AX,[0072]   ; adresa tabulky text– 02fh
12B3:0072 D1E0           SHL    AX,1        ; * 2 = 3eh
12B3:0074 81C07600       ADD    AX,0076     ; + konstanta = 0d4h
12B3:0078 03877600       ADD    AX,[BX+0076] ; p©i‡ten¡ offsetu hl ¨en¡
12B3:007C E881FF         CALL   0000        ; dek¢dov n¡ textu DS:AX
12B3:007F 5B             POP    BX 
12B3:0080 C3             RET     

; -----------------------------------------------------------------------------
;        zobrazen¡ chybov‚ho hl ¨en¡ DS:AX
; -----------------------------------------------------------------------------

12B3:0081 53             PUSH   BX
12B3:0082 51             PUSH   CX 
12B3:0083 52             PUSH   DX 
12B3:0084 89C2           MOV    DX,AX 
12B3:0086 E8E30A         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX

12B3:0089 BB0100         MOV    BX,0001     ; konzola
12B3:008C 89C1           MOV    CX,AX       ; d‚lka textu
12B3:008E B440           MOV    AH,40                         ;'@' 
12B3:0090 CD21           INT    21          ; z pis na konzolu
12B3:0092 19D2           SBB    DX,DX 
12B3:0094 E9A704         JMP    053E

; -----------------------------------------------------------------------------
;        zobrazen¡ textu s k¢dem AX
; -----------------------------------------------------------------------------

12B3:0097 E8D0FF         CALL   006A        ; adresa chybov‚ho textu AX
12B3:009A EBE5           JMP    0081        ; zobrazen¡ chybov‚ho hl ¨en¡ DS:AX

; -----------------------------------------------------------------------------
;        zobrazen¡ n povˆdy
; -----------------------------------------------------------------------------

12B3:009C B80300         MOV    AX,0003
12B3:009F E8F5FF         CALL   0097
12B3:00A2 B80500         MOV    AX,0005
12B3:00A5 E8EFFF         CALL   0097
12B3:00A8 B80600         MOV    AX,0006
12B3:00AB E8E9FF         CALL   0097
12B3:00AE B80900         MOV    AX,0009
12B3:00B1 E8E3FF         CALL   0097
12B3:00B4 B80A00         MOV    AX,000A
12B3:00B7 E8DDFF         CALL   0097
12B3:00BA B80C00         MOV    AX,000C
12B3:00BD E8D7FF         CALL   0097
12B3:00C0 B80D00         MOV    AX,000D
12B3:00C3 E8D1FF         CALL   0097
12B3:00C6 B80E00         MOV    AX,000E
12B3:00C9 E8CBFF         CALL   0097
12B3:00CC B81000         MOV    AX,0010
12B3:00CF E8C5FF         CALL   0097
12B3:00D2 B81300         MOV    AX,0013

12B3:00D5 E8BFFF         CALL   0097
12B3:00D8 B80100         MOV    AX,0001 
12B3:00DB E9A80A         JMP    0B86 

; -----------------------------------------------------------------------------
;        dek¢dov n¡ zad n¡ ‡¡sla z p©¡kazov‚ho © dku
; -----------------------------------------------------------------------------

12B3:00DE 53             PUSH   BX
12B3:00DF 51             PUSH   CX 
12B3:00E0 56             PUSH   SI 
12B3:00E1 57             PUSH   DI 
12B3:00E2 55             PUSH   BP 
12B3:00E3 89E5           MOV    BP,SP 
12B3:00E5 83EC08         SUB    SP,+08 
12B3:00E8 89C7           MOV    DI,AX 
12B3:00EA 89D6           MOV    SI,DX 
12B3:00EC EB01           JMP    00EF 

; ------ p©esko‡en¡ po‡ te‡n¡ch mezer

12B3:00EE 47           * INC    DI
12B3:00EF 803D00       * CMP    Byte Ptr [DI],00
12B3:00F2 7405           JZ     00F9 
12B3:00F4 803D20         CMP    Byte Ptr [DI],20              ;' ' 
12B3:00F7 76F5           JBE    00EE 

12B3:00F9 31C0         * XOR    AX,AX
12B3:00FB 8904           MOV    [SI],AX 
12B3:00FD 894402         MOV    [SI+02],AX 
12B3:0100 8946F8         MOV    [BP-08],AX 
12B3:0103 897EFA         MOV    [BP-06],DI 
12B3:0106 EB34           JMP    013C 

12B3:0108 8B5EFA       * MOV    BX,[BP-06]
12B3:010B 8A07           MOV    AL,[BX] 
12B3:010D 8846FC         MOV    [BP-04],AL 
12B3:0110 31C0           XOR    AX,AX 
12B3:0112 8846FD         MOV    [BP-03],AL 
12B3:0115 8946FE         MOV    [BP-02],AX 
12B3:0118 8B04           MOV    AX,[SI] 
12B3:011A 8B5402         MOV    DX,[SI+02] 
12B3:011D BB0A00         MOV    BX,000A 
12B3:0120 31C9           XOR    CX,CX 
12B3:0122 E87D0A         CALL   0BA2
12B3:0125 0346FC         ADD    AX,[BP-04] 
12B3:0128 1356FE         ADC    DX,[BP-02] 
12B3:012B 05D0FF         ADD    AX,FFD0 
12B3:012E 8904           MOV    [SI],AX 
12B3:0130 83D2FF         ADC    DX,-01 
12B3:0133 895402         MOV    [SI+02],DX 
12B3:0136 FF46FA         INC    Word Ptr [BP-06] 
12B3:0139 FF46F8         INC    Word Ptr [BP-08] 
12B3:013C 89F8         * MOV    AX,DI
12B3:013E E82B0A         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX
12B3:0141 3B46F8         CMP    AX,[BP-08] 
12B3:0144 77C2           JA     0108 
12B3:0146 89EC         * MOV    SP,BP
12B3:0148 5D             POP    BP 
12B3:0149 5F             POP    DI 
12B3:014A 5E             POP    SI 
12B3:014B 59             POP    CX 
12B3:014C 5B             POP    BX 
12B3:014D C3             RET     

; -----------------------------------------------------------------------------
;        Dek¢dov n¡ zad n¡ parametr–
; -----------------------------------------------------------------------------

12B3:014E 53             PUSH   BX
12B3:014F 51             PUSH   CX 
12B3:0150 52             PUSH   DX 
12B3:0151 56             PUSH   SI 
12B3:0152 55             PUSH   BP 
12B3:0153 89E5           MOV    BP,SP 
12B3:0155 83EC18         SUB    SP,+18 
12B3:0158 89C3           MOV    BX,AX 
12B3:015A EB01           JMP    015D 

; ------ p©esko‡en¡ po‡ te‡n¡ch mezer

12B3:015C 43           * INC    BX
12B3:015D 803F00       * CMP    Byte Ptr [BX],00
12B3:0160 7405           JZ     0167 
12B3:0162 803F20         CMP    Byte Ptr [BX],20              ;' ' 
12B3:0165 76F5           JBE    015C 

12B3:0167 803F00       * CMP    Byte Ptr [BX],00
12B3:016A 7416           JZ     0182        ; konec textu - konec dek¢dov n¡

; ------ kontrola, zda je platn˜ prvn¡ znak "+"

12B3:016C 8A07           MOV    AL,[BX]
12B3:016E 2C2B           SUB    AL,2B
12B3:0170 7413           JZ     0185        ; je znak "+" - OK
12B3:0172 FEC8           DEC    AL 
12B3:0174 FEC8           DEC    AL 
12B3:0176 740D           JZ     0185        ; je znak "-" - OK
12B3:0178 FEC8           DEC    AL 
12B3:017A FEC8           DEC    AL 
12B3:017C 7407           JZ     0185        ; je znak "/" - OK
12B3:017E 2C10           SUB    AL,10 
12B3:0180 7445           JZ     01C7        ; je znak "?" - zobrazen¡ n povˆdy

12B3:0182 E9B100       * JMP    0236        ; jinak konec dek¢dov n¡ parametr–

; ------ rozli¨en¡, zda je prvn¡m znakem "+" nebo "-"

12B3:0185 803F2B         CMP    Byte Ptr [BX],2B ; je "+" ?
12B3:0188 7505           JNZ    018F        ; nen¡ "+"
12B3:018A B80100         MOV    AX,0001
12B3:018D EB02           JMP    0191        ; p©¡znak "+"
12B3:018F 31C0         * XOR    AX,AX       ; jinak p©¡znak "-"
12B3:0191 89C1         * MOV    CX,AX       ; p©¡znak znaku "+" nebo "-"
12B3:0193 E99700         JMP    022D 

; ------ dek¢dov n¡ druh‚ho znaku

12B3:0196 8A07           MOV    AL,[BX]     ; n sleduj¡c¡ znak
12B3:0198 24DF           AND    AL,DF       ; korekce na velk‚ p¡smeno
12B3:019A 2C1F           SUB    AL,1F
12B3:019C 742C           JZ     01CA        ; je znak "?" - zobrazen¡ n povˆdy
12B3:019E 2C24           SUB    AL,24
12B3:01A0 74E0           JZ     0182        ; je znak "C" - konec dek¢dov n¡
12B3:01A2 2C05           SUB    AL,05
12B3:01A4 7424           JZ     01CA        ; je znak "H" - zobrazen¡ n povˆdy
12B3:01A6 2C05           SUB    AL,05 
12B3:01A8 740D           JZ     01B7        ; je znak "M" - nastaven¡ pamˆti
12B3:01AA 2C0B           SUB    AL,0B 
12B3:01AC 7460           JZ     020E        ; je znak "X" - verze EXTENDED
12B3:01AE FEC8           DEC    AL 
12B3:01B0 FEC8           DEC    AL 
12B3:01B2 7463           JZ     0217        ; je znak "Z"
12B3:01B4 E97600         JMP    022D        ; jinak dal¨¡ znak

; ------ parametr "M" - nastaven¡ voln‚ pamˆti

12B3:01B7 8D76E8         LEA    SI,[BP-18]
12B3:01BA 43             INC    BX 
12B3:01BB 8D46E8         LEA    AX,[BP-18] 
12B3:01BE F7D8           NEG    AX 
12B3:01C0 8D56E8         LEA    DX,[BP-18] 
12B3:01C3 01D0           ADD    AX,DX 
12B3:01C5 EB0C           JMP    01D3 

12B3:01C7 E96400       * JMP    022E

12B3:01CA EB5C         * JMP    0228        ; zobrazen¡ n povˆdy

12B3:01CC 8A17           MOV    DL,[BX] 
12B3:01CE 8814           MOV    [SI],DL 
12B3:01D0 40             INC    AX 
12B3:01D1 46             INC    SI 
12B3:01D2 43             INC    BX 

; ------ dek¢dov n¡ ‡¡sla parametru "M"

12B3:01D3 803F20         CMP    Byte Ptr [BX],20              ;' '
12B3:01D6 7605           JBE    01DD 
12B3:01D8 3D1400         CMP    AX,0014 
12B3:01DB 7CEF           JL     01CC 
12B3:01DD C60400         MOV    Byte Ptr [SI],00 
12B3:01E0 8D46E8         LEA    AX,[BP-18] 
12B3:01E3 E88609         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX
12B3:01E6 85C0           TEST   AX,AX 
12B3:01E8 7443           JZ     022D 
12B3:01EA 8D46E8         LEA    AX,[BP-18] 
12B3:01ED 8D56FC         LEA    DX,[BP-04] 
12B3:01F0 E8EBFE         CALL   00DE        ; dek¢dov n¡ ‡¡sla
12B3:01F3 837EFE00       CMP    Word Ptr [BP-02],+00 
12B3:01F7 7507           JNZ    0200 
12B3:01F9 817EFC007D     CMP    Word Ptr [BP-04],7D00 ; je 32000 ?
12B3:01FE 7605           JBE    0205 
12B3:0200 B8007D         MOV    AX,7D00     ; omezen¡ na 32000
12B3:0203 EB03           JMP    0208
12B3:0205 8B46FC         MOV    AX,[BP-04]
12B3:0208 A33A00       * MOV    [003A],AX   ; omezen¡ pamˆti "M"
12B3:020B 4B             DEC    BX 
12B3:020C EB1F           JMP    022D 

; ------ parametr "X" - pou‘ite se EMS

12B3:020E 85C9           TEST   CX,CX
12B3:0210 7407           JZ     0219 
12B3:0212 B80100         MOV    AX,0001 
12B3:0215 EB04           JMP    021B 
12B3:0217 EB07           JMP    0220        ; je parametr "Z"
12B3:0219 31C0         * XOR    AX,AX
12B3:021B A23600       * MOV    [0036],AL   ; p©¡znak parametru "X"
12B3:021E EB0D           JMP    022D 

; ------ parametr "Z" - nevyhled v  se v PATH

12B3:0220 C70638000100   MOV    Word Ptr [0038],0001 ; p©¡znak parametru "Z"
12B3:0226 EB05           JMP    022D 

; ------ zobrazen¡ n povˆdy

12B3:0228 E871FE         CALL   009C        ; zobrazen¡ n povˆdy
12B3:022B EB09           JMP    0236 

12B3:022D 43           * INC    BX          ; zv˜¨en¡ ukazatele na druh˜ znak
12B3:022E 803F00         CMP    Byte Ptr [BX],00 ; je konec ?
12B3:0231 7403           JZ     0236        ; je konec
12B3:0233 E960FF         JMP    0196        ; dek¢dov n¡ parametru

12B3:0236 89EC           MOV    SP,BP
12B3:0238 5D             POP    BP 
12B3:0239 5E             POP    SI 
12B3:023A E90103         JMP    053E 

; -----------------------------------------------------------------------------
;       Dek¢dov n¡ parametr– (AX=adresa jm‚na programu PROSDEMO.EXE)
; -----------------------------------------------------------------------------

12B3:023D 53             PUSH   BX
12B3:023E 51             PUSH   CX 
12B3:023F 52             PUSH   DX 
12B3:0240 56             PUSH   SI 
12B3:0241 57             PUSH   DI 
12B3:0242 55             PUSH   BP 
12B3:0243 89E5           MOV    BP,SP 
12B3:0245 81EC0201       SUB    SP,0102 

; ------ £schova jm‚na programu do bufferu

12B3:0249 89C6           MOV    SI,AX       ; adresa jm‚na programu
12B3:024B 8B14           MOV    DX,[SI]     ; jm‚no programu
12B3:024D B8FC07         MOV    AX,07FC     ; jm‚no programu PROSDEMO.EXE
12B3:0250 E86709         CALL   0BBA        ; kopie ©etˆzce ASCIIZ DX do AX

; ------ nalezen¡ parametru z prost©ed¡ FOXPROSWX

12B3:0253 46             INC    SI 
12B3:0254 46             INC    SI 
12B3:0255 B81600         MOV    AX,0016 
12B3:0258 E80FFE         CALL   006A        ; dek¢dov n¡ textu "FOXPROSWX"
12B3:025B E88509         CALL   0BE3        ; nalezen¡ param.prost©ed¡ FOXPROSWX
12B3:025E 89C3           MOV    BX,AX       ; adresa parametru
12B3:0260 EB3D           JMP    029F 

; ------ dek¢dov n¡ parametru FOXPROSWX

12B3:0262 895EFE         MOV    [BP-02],BX  ; adresa parametru
12B3:0265 EB03           JMP    026A

; ------ nalezen¡ konce parametru

12B3:0267 FF46FE       * INC    Word Ptr [BP-02]
12B3:026A 8B7EFE         MOV    DI,[BP-02]  ; ukazatel parametru
12B3:026D 8A05           MOV    AL,[DI]     ; znak parametru
12B3:026F 30E4           XOR    AH,AH 
12B3:0271 89C1           MOV    CX,AX       ; znak parametru
12B3:0273 85C0           TEST   AX,AX 
12B3:0275 7404           JZ     027B 
12B3:0277 3C20           CMP    AL,20       ; je mezera ?
12B3:0279 77EC           JA     0267        ; nen¡ mezera - dal¨¡ znak

; ------ p©enos parametru do bufferu

12B3:027B 8B7EFE       * MOV    DI,[BP-02]  ; konec textu parametru
12B3:027E 29DF           SUB    DI,BX       ; d‚lka textu parametru
12B3:0280 8D86FEFE       LEA    AX,[BP+FEFE] ; buffer
12B3:0284 89DA           MOV    DX,BX       ; za‡ tek textu parametru
12B3:0286 89FB           MOV    BX,DI       ; d‚lka textu parametru
12B3:0288 E8B509         CALL   0C40        ; p©enos textu parametru
12B3:028B C683FEFE00     MOV    Byte Ptr [BP+DI+FEFE],00 ; ozna‡en¡ konce textu

; ------ dek¢dov n¡ parametr–

12B3:0290 8D86FEFE       LEA    AX,[BP+FEFE] ; text parametru
12B3:0294 E8B7FE         CALL   014E        ; dek¢dov n¡ parametr– FORPROSWX
12B3:0297 85C9           TEST   CX,CX
12B3:0299 7424           JZ     02BF 
12B3:029B 8B5EFE         MOV    BX,[BP-02]  ; ukazatel textu
12B3:029E 43             INC    BX 

; ------ test, zda je dal¨¡ text parametru

12B3:029F 85DB           TEST   BX,BX       ; byl nalezen parametr FOXPROSWX ?
12B3:02A1 741C           JZ     02BF        ; nebyl nalezen parametr FOXPROSWX
12B3:02A3 803F00         CMP    Byte Ptr [BX],00 ; je parametr platn˜ ?
12B3:02A6 75BA           JNZ    0262        ; je platn˜
12B3:02A8 EB15           JMP    02BF 

; ------ dek¢dov n¡ p©¡kazov‚ho © dku

12B3:02AA 8B1E3000     * MOV    BX,[0030]
12B3:02AE D1E3           SHL    BX,1 
12B3:02B0 8B04           MOV    AX,[SI] 
12B3:02B2 89877A06       MOV    [BX+067A],AX 
12B3:02B6 FF063000       INC    Word Ptr [0030] 
12B3:02BA E891FE         CALL   014E        ; dek¢dov n¡ p©¡kazov‚ho © dku
12B3:02BD 46             INC    SI 
12B3:02BE 46             INC    SI 

12B3:02BF 833C00       * CMP    Word Ptr [SI],+00
12B3:02C2 75E6           JNZ    02AA        ; dek¢dov n¡ dal¨¡ho parametru
12B3:02C4 E99CFD         JMP    0063        ; n vrat z procedury

; -----------------------------------------------------------------------------
;        Porovn n¡ jm‚na nalezen‚ho souboru a jeho uchov n¡ do bufferu
; -----------------------------------------------------------------------------

12B3:02C7 56             PUSH   SI
12B3:02C8 57             PUSH   DI 
12B3:02C9 89C7           MOV    DI,AX 
12B3:02CB 89D6           MOV    SI,DX 
12B3:02CD E89C08         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX
12B3:02D0 89C2           MOV    DX,AX 
12B3:02D2 89D8           MOV    AX,BX 
12B3:02D4 E89508         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX
12B3:02D7 39C2           CMP    DX,AX 
12B3:02D9 7404           JZ     02DF 
12B3:02DB 31C0           XOR    AX,AX 
12B3:02DD EB2A           JMP    0309 
12B3:02DF 89F8           MOV    AX,DI 
12B3:02E1 89DA           MOV    DX,BX 
12B3:02E3 E8A809         CALL   0C8E 
12B3:02E6 85C0           TEST   AX,AX 
12B3:02E8 75F1           JNZ    02DB 
12B3:02EA 803C00         CMP    Byte Ptr [SI],00 
12B3:02ED 7405           JZ     02F4 
12B3:02EF B80100         MOV    AX,0001 
12B3:02F2 EB15           JMP    0309 
12B3:02F4 89F0           MOV    AX,SI 
12B3:02F6 89CA           MOV    DX,CX 
12B3:02F8 E8BF08         CALL   0BBA        ; kopie ©etˆzce ASCIIZ DX do AX
12B3:02FB 89F0           MOV    AX,SI 
12B3:02FD 89DA           MOV    DX,BX 
12B3:02FF E8B609         CALL   0CB8        ; p©id n¡ textu DS:DX k textu DS:AX
12B3:0302 B80100         MOV    AX,0001 
12B3:0305 01063200       ADD    [0032],AX   ; zv˜¨en¡ ‡¡ta‡e nalezen˜ch soubor–
12B3:0309 5F             POP    DI 
12B3:030A 5E             POP    SI 
12B3:030B C3             RET     

; -----------------------------------------------------------------------------
;  Nalezen¡ programu FOXPRO*.ESL (DS:AX=adres ©, DX=parametr "X": 2=je, 1=nen¡)
; -----------------------------------------------------------------------------

12B3:030C 53           * PUSH   BX
12B3:030D 51             PUSH   CX 
12B3:030E 56             PUSH   SI 
12B3:030F 57             PUSH   DI 
12B3:0310 55             PUSH   BP 
12B3:0311 89E5           MOV    BP,SP

; ------ stanoven¡ d‚lky textu adres ©e

12B3:0313 81ECB000       SUB    SP,00B0     ; buffer pro DTA
12B3:0317 89C6           MOV    SI,AX       ; text adres ©e
12B3:0319 89D7           MOV    DI,DX       ; p©¡znak parametru "X"
12B3:031B E84E08         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX

; ------ ukon‡en¡ textu znakem "\" (pokud nen¡)

12B3:031E 89F3           MOV    BX,SI       ; za‡ tek textu
12B3:0320 01C3           ADD    BX,AX       ; konec textu
12B3:0322 8A47FF         MOV    AL,[BX-01]  ; posledn¡ znak
12B3:0325 3C5C           CMP    AL,5C       ; je ozna‡en¡ adres ©e "\" ?
12B3:0327 7411           JZ     033A        ; je znak "\"
12B3:0329 3C3A           CMP    AL,3A       ; je ozna‡en¡ disku ":" ?
12B3:032B 740D           JZ     033A        ; je ozna‡en¡ disku ":"
12B3:032D B81900         MOV    AX,0019
12B3:0330 E837FD         CALL   006A        ; dek¢dov n¡ textu "\"
12B3:0333 89C2           MOV    DX,AX 
12B3:0335 89F0           MOV    AX,SI       ; text adres ©e
12B3:0337 E87E09         CALL   0CB8        ; p©id n¡ textu DS:DX k textu DS:AX

; ------ kopie textu adres ©e do pracovn¡ho bufferu

12B3:033A 8D8650FF     * LEA    AX,[BP+FF50] ; pracovn¡ buffer textu adres ©e
12B3:033E 89F2           MOV    DX,SI       ; text adres ©e
12B3:0340 E87708         CALL   0BBA        ; kopie ©etˆzce ASCIIZ DX do AX

; ------ p©id n¡ textu "FOXPRO*.ESL" k textu adres ©e

12B3:0343 B81800         MOV    AX,0018
12B3:0346 E821FD         CALL   006A        ; dek¢dov n¡ textu "FOXPRO*.ESL"
12B3:0349 89C2           MOV    DX,AX       ; text "FOXPRO*.ESL"
12B3:034B 8D8650FF       LEA    AX,[BP+FF50] ; pracovn¡ buffer
12B3:034F E86609         CALL   0CB8        ; p©id n¡ textu DS:DX k textu DS:AX

; ------ nastaven¡ pracovn¡ adresy DTA

12B3:0352 8D56D4         LEA    DX,[BP-2C]  ; adresa DTA
12B3:0355 B41A           MOV    AH,1A 
12B3:0357 CD21           INT    21          ; nastaven¡ adresy DTA

; ------ nalezen¡ po‘adovan‚ho souboru

12B3:0359 8D9650FF       LEA    DX,[BP+FF50] ; jm‚no souboru
12B3:035D 30C9           XOR    CL,CL 
12B3:035F B44E           MOV    AH,4E                         ;'N' 
12B3:0361 CD21           INT    21          ; nalezen¡ souboru
12B3:0363 19D2           SBB    DX,DX       ; navr cen˜ k¢d

; ------ vyhodnocen¡ v˜sledku hled n¡

12B3:0365 85D2           TEST   DX,DX
12B3:0367 7F02           JG     036B 
12B3:0369 7505           JNZ    0370        ; nenalezeno
12B3:036B B80100       * MOV    AX,0001     ; byl nalezen
12B3:036E EB5C           JMP    03CC 
12B3:0370 31C0         * XOR    AX,AX
12B3:0372 EB58           JMP    03CC        ; nebyl nalezen

; ------ vyhled v n¡ p©¡padn‚ho dal¨¡ho souboru

12B3:0374 3B3E3200     * CMP    DI,[0032]   ; je mo‘n˜ dal¨¡ soubor ?
12B3:0378 7F03           JG     037D        ; nejsou je¨tˆ v¨echny soubory
12B3:037A E9C9FD         JMP    0146 

12B3:037D 803E350000   * CMP    Byte Ptr [0035],00 ; kontroluje se jm‚no FOX ?
12B3:0382 7438           JZ     03BC        ; nekontroluje se

; ------ kontrola, zda je program "FOXPRO.ESL"

12B3:0384 803E360001     CMP    Byte Ptr [0036],01 ; je verze "X" ?
12B3:0389 7417           JZ     03A2        ; je verze "X"
12B3:038B B81E00         MOV    AX,001E
12B3:038E E8D9FC         CALL   006A        ; dek¢dov n¡ textu "FOXPRO.ESL"
12B3:0391 89C3           MOV    BX,AX 
12B3:0393 8D46F2         LEA    AX,[BP-0E]  ; jm‚no nalezen‚ho souboru
12B3:0396 BAF606         MOV    DX,06F6     ; buffer
12B3:0399 89F1           MOV    CX,SI       ; adresa adres ©e
12B3:039B E829FF         CALL   02C7        ; porovn n¡ jm‚na a p©¡p. sestaven¡
12B3:039E 85C0           TEST   AX,AX 
12B3:03A0 751A           JNZ    03BC        ; nesouhlas¡

; ------ kontrola, zda je program "FOXPROX.ESL"

12B3:03A2 803E360000     CMP    Byte Ptr [0036],00 ; je verze "X" ?
12B3:03A7 7413           JZ     03BC        ; nen¡ verze "X"
12B3:03A9 B81F00         MOV    AX,001F
12B3:03AC E8BBFC         CALL   006A        ; dek¢dov n¡ textu "FOXPROX.ESL"
12B3:03AF 89C3           MOV    BX,AX 
12B3:03B1 8D46F2         LEA    AX,[BP-0E] 
12B3:03B4 BA7907         MOV    DX,0779     ; buffer
12B3:03B7 89F1           MOV    CX,SI       ; adresa adres ©e
12B3:03B9 E80BFF         CALL   02C7        ; porovn n¡ jm‚na a p©¡p. sestaven¡

; ------ vyhled n¡ dal¨¡ho souboru

12B3:03BC B44F         * MOV    AH,4F                         ;'O'
12B3:03BE CD21           INT    21          ; nalezen¡ dal¨¡ho souboru
12B3:03C0 19D2           SBB    DX,DX       ; p©i CY je DX=0ffffh, jinak =0000h
12B3:03C2 85D2           TEST   DX,DX       ; nalezen ?
12B3:03C4 7F02           JG     03C8
12B3:03C6 7502           JNZ    03CA        ; nenalezen
12B3:03C8 EBA1         * JMP    036B        ; nalezen OK

12B3:03CA 31C0         * XOR    AX,AX       ; soubor nalezen
12B3:03CC 85C0         * TEST   AX,AX       ; byl soubor nalezen ?
12B3:03CE 75A4           JNZ    0374        ; nalezen - test dal¨¡ho
12B3:03D0 E973FD         JMP    0146        ; n vrat z procedury

; -----------------------------------------------------------------------------
;        nalezen¡ programu FOXPRO*.ESL
; -----------------------------------------------------------------------------

12B3:03D3 53             PUSH   BX
12B3:03D4 51             PUSH   CX 
12B3:03D5 52             PUSH   DX 
12B3:03D6 56             PUSH   SI 
12B3:03D7 57             PUSH   DI 
12B3:03D8 55             PUSH   BP 
12B3:03D9 89E5           MOV    BP,SP 

12B3:03DB 81EC8600       SUB    SP,0086     ; m¡sto pro lok ln¡ promˆnn‚
12B3:03DF 81ED8000       SUB    BP,0080 
12B3:03E3 B90200         MOV    CX,0002     ; p©¡znak parametru "X"
12B3:03E6 803E3600FF     CMP    Byte Ptr [0036],FF ; p©¡znak parametru "X"
12B3:03EB 7403           JZ     03F0        ; je parametr "X"
12B3:03ED B90100         MOV    CX,0001

; ------ nastaven¡ ozna‡en¡ aktivn¡ho disku

12B3:03F0 B419         * MOV    AH,19
12B3:03F2 CD21           INT    21          ; poskytnut¡ aktivn¡ho disku
12B3:03F4 88C3           MOV    BL,AL       ; aktivn¡ disk
12B3:03F6 30FF           XOR    BH,BH
12B3:03F8 8D4741         LEA    AX,[BX+41]  ; p©evod na ozna‡en¡ disku
12B3:03FB 8846FA         MOV    [BP-06],AL  ; ozna‡en¡ disku znakem
12B3:03FE C646FB3A       MOV    Byte Ptr [BP-05],3A           ;':' 
12B3:0402 C646FC5C       MOV    Byte Ptr [BP-04],5C           ;'\' 
12B3:0406 C646FD00       MOV    Byte Ptr [BP-03],00 
12B3:040A 43             INC    BX

; ------ na‡ten¡ aktivn¡ho adres ©e

12B3:040B 8D46FA         LEA    AX,[BP-06]  ; adresa textu "disk:\"
12B3:040E E85B07         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu DS:AX
12B3:0411 8D76FA         LEA    SI,[BP-06]
12B3:0414 01C6           ADD    SI,AX       ; adresa konce textu
12B3:0416 88DA           MOV    DL,BL       ; aktivn¡ disk
12B3:0418 B447           MOV    AH,47
12B3:041A CD21           INT    21          ; poskytnut¡ aktivn¡ho adres ©e

; ------ nalezen¡ programu FOXPRO*.ESL v aktivn¡m adres ©i

12B3:041C 19D2           SBB    DX,DX
12B3:041E 8D46FA         LEA    AX,[BP-06]  ; za‡ tek textu adres ©e
12B3:0421 89CA           MOV    DX,CX       ; p©¡znak parametru "X" (2=je)
12B3:0423 E8E6FE         CALL   030C        ; nalezen¡ programu v adres ©i
12B3:0426 3B0E3200       CMP    CX,[0032]   ; jsou ji‘ v¨echny soubory ?
12B3:042A 7E5A           JLE    0486        ; jsou ji‘ v¨echny soubory
12B3:042C 833E380000     CMP    Word Ptr [0038],+00 ; p©¡znak parametru "Z"
12B3:0431 7553           JNZ    0486        ; je parametr "Z" - nehled  PATH

12B3:0433 B81500         MOV    AX,0015
12B3:0436 E831FC         CALL   006A        ; dek¢dov n¡ textu "PATH"
12B3:0439 E8A707         CALL   0BE3        ; nalezen¡ param. prost©ed¡ PATH
12B3:043C 89C3           MOV    BX,AX       ; adresa PATH
12B3:043E EB3D           JMP    047D 

; ------ sestaven¡ jednoho adres ©e z PATH

12B3:0440 89DE           MOV    SI,BX
12B3:0442 EB01           JMP    0445 
12B3:0444 46             INC    SI 
12B3:0445 8A04           MOV    AL,[SI] 
12B3:0447 30E4           XOR    AH,AH 
12B3:0449 89467E         MOV    [BP+7E],AX 
12B3:044C 85C0           TEST   AX,AX 
12B3:044E 7404           JZ     0454 
12B3:0450 3C3B           CMP    AL,3B                         ;';' 
12B3:0452 75F0           JNZ    0444 
12B3:0454 89F7           MOV    DI,SI 
12B3:0456 29DF           SUB    DI,BX 

; ------ prohled n¡ jednoho adres ©e z PATH

12B3:0458 8D46FA         LEA    AX,[BP-06]
12B3:045B 89DA           MOV    DX,BX 
12B3:045D 89FB           MOV    BX,DI 
12B3:045F E8DE07         CALL   0C40        ; dek¢dov n¡ parametru FOXPROSWX
12B3:0462 C643FA00       MOV    Byte Ptr [BP+DI-06],00 
12B3:0466 8D46FA         LEA    AX,[BP-06] 
12B3:0469 89CA           MOV    DX,CX 
12B3:046B E89EFE         CALL   030C        ; prohled n¡ adres ©e

; ------ kontrola, zda bude dal¨¡ hled n¡

12B3:046E 3B0E3200       CMP    CX,[0032]   ; jsou ji‘ v¨echny soubory ?
12B3:0472 7E12           JLE    0486        ; jsou ji‘ v¨echny soubory
12B3:0474 837E7E00       CMP    Word Ptr [BP+7E],+00 
12B3:0478 740C           JZ     0486 
12B3:047A 8D5C01         LEA    BX,[SI+01] 

12B3:047D 85DB           TEST   BX,BX
12B3:047F 7405           JZ     0486 
12B3:0481 803F00         CMP    Byte Ptr [BX],00 
12B3:0484 75BA           JNZ    0440 

12B3:0486 81C58000     * ADD    BP,0080
12B3:048A E9D6FB         JMP    0063        ; n vrat

; -----------------------------------------------------------------------------
;        kontrola, zda je to platn˜ soubor EXE
; -----------------------------------------------------------------------------

12B3:048D 53             PUSH   BX
12B3:048E 51             PUSH   CX 
12B3:048F 56             PUSH   SI 
12B3:0490 57             PUSH   DI 
12B3:0491 55             PUSH   BP 
12B3:0492 89E5           MOV    BP,SP 
12B3:0494 83EC12         SUB    SP,+12      ; lok ln¡ promˆnn‚
12B3:0497 89C6           MOV    SI,AX       ; identifik tor souboru
12B3:0499 8856FE         MOV    [BP-02],DL  ; offset

12B3:049C 89C3           MOV    BX,AX       ; identifik tor souboru
12B3:049E 31D2           XOR    DX,DX 
12B3:04A0 31C9           XOR    CX,CX 
12B3:04A2 B002           MOV    AL,02       ; ukazatel na konec
12B3:04A4 B442           MOV    AH,42
12B3:04A6 CD21           INT    21          ; zji¨tˆn¡ velikosti souboru
12B3:04A8 13D2           ADC    DX,DX 
12B3:04AA D1CA           ROR    DX,1 
12B3:04AC 8946FC         MOV    [BP-04],AX  ; velikost LOW
12B3:04AF 89D7           MOV    DI,DX       ; velikost HIGH

; ------ vymaz n¡ bufferu jm‚na bajtem 0

12B3:04B1 8D46EE         LEA    AX,[BP-12]  ; adresa bufferu
12B3:04B4 31D2           XOR    DX,DX       ; nulovac¡ bajt
12B3:04B6 BB0E00         MOV    BX,000E     ; po‡et bajt–
12B3:04B9 E82F08         CALL   0CEB        ; vymaz n¡ bufferu DS:AX

; ------ kontrola, zda je platn  adresa v souboru

12B3:04BC 8B56F8       * MOV    DX,[BP-08]  ; DX <- 0 offset LOW
12B3:04BF 83C20E         ADD    DX,+0E      ; zv˜¨en¡ adresy o 14 bajt–
12B3:04C2 8B46FA         MOV    AX,[BP-06]  ; offset HIGH
12B3:04C5 150000         ADC    AX,0000     ; p©enos do HIGH
12B3:04C8 39C7           CMP    DI,AX       ; kontrola HIGH
12B3:04CA 7C54           JL     0520 
12B3:04CC 7505           JNZ    04D3 
12B3:04CE 3B56FC         CMP    DX,[BP-04]  ; kontrola LOW
12B3:04D1 774D           JA     0520        ; ukazatel je ji‘ mimo soubor

12B3:04D3 8B46F8       * MOV    AX,[BP-08]  ; offset LOW
12B3:04D6 2946FC         SUB    [BP-04],AX  ; sn¡‘en¡ velikosti souboru LOW
12B3:04D9 1B7EFA         SBB    DI,[BP-06]  ; p©enos HIGH

; ------ nastaven¡ ukazatele na dal¨¡ popisova‡ 14 bajt–

12B3:04DC 8B56FC         MOV    DX,[BP-04]  ; offset
12B3:04DF 83C2F2         ADD    DX,-0E      ; offset LOW
12B3:04E2 89F9           MOV    CX,DI 
12B3:04E4 83D1FF         ADC    CX,-01      ; offset HIGH
12B3:04E7 89F3           MOV    BX,SI       ; identifik tor souboru
12B3:04E9 30C0           XOR    AL,AL       ; p©esun od za‡ tku
12B3:04EB B442           MOV    AH,42
12B3:04ED CD21           INT    21          ; nastaven¡ ukazatele v souboru
12B3:04EF 13D2           ADC    DX,DX

12B3:04F1 D1CA           ROR    DX,1 
12B3:04F3 89F3           MOV    BX,SI       ; identifik tor souboru
12B3:04F5 8D56EE         LEA    DX,[BP-12]  ; buffer ke ‡ten¡ dat
12B3:04F8 B90E00         MOV    CX,000E     ; po‡et bajt– popisova‡e
12B3:04FB B43F           MOV    AH,3F
12B3:04FD CD21           INT    21          ; ‡ten¡ popisova‡e z konce souboru
12B3:04FF 19D2           SBB    DX,DX

12B3:0501 8B46EE         MOV    AX,[BP-12]  ; prvn¡ 2 znaky z bufferu
12B3:0504 81E80083       SUB    AX,8300     ; kontrola popisova‡e
12B3:0508 7408           JZ     0512        ; je platn˜ popisova‡
12B3:050A 81E88600       SUB    AX,0086     ; alternativnˆ 8386h
12B3:050E 74AC           JZ     04BC        ; bude dal¨¡ popisova‡
12B3:0510 EB0E           JMP    0520        ; neplatn˜ popisova‡

12B3:0512 8A46F0       * MOV    AL,[BP-10]  ;
12B3:0515 3A46FE         CMP    AL,[BP-02] 
12B3:0518 75A2           JNZ    04BC        ; nen¡ to hledan˜ znak
12B3:051A B80100         MOV    AX,0001     ; p©¡znak souboru OK
12B3:051D E926FC         JMP    0146 

12B3:0520 31C0         * XOR    AX,AX       ; chyba - neplatn˜ soubor
12B3:0522 E921FC         JMP    0146 

; -----------------------------------------------------------------------------
;        Kontrola programu PROSDEMO, zda je to platn˜ soubor
; -----------------------------------------------------------------------------

12B3:0525 53             PUSH   BX
12B3:0526 51             PUSH   CX 
12B3:0527 52             PUSH   DX 
12B3:0528 BAFC07         MOV    DX,07FC     ; jm‚no souboru PROSDEMO.EXE
12B3:052B 30C0           XOR    AL,AL       ; m¢d ‡ten¡
12B3:052D B43D           MOV    AH,3D
12B3:052F CD21           INT    21          ; otev©en¡ souboru pro ‡ten¡
12B3:0531 19D2           SBB    DX,DX 
12B3:0533 89C3           MOV    BX,AX       ; identifik tor
12B3:0535 99             CWD     
12B3:0536 85D2           TEST   DX,DX 
12B3:0538 7F08           JG     0542
12B3:053A 7406           JZ     0542        ; soubor otev©en OK

12B3:053C 31C0           XOR    AX,AX       ; chyba souboru

12B3:053E 5A           * POP    DX
12B3:053F 59             POP    CX 
12B3:0540 5B             POP    BX 
12B3:0541 C3             RET     

; ------ kontorola, zda je to platn˜ program EXE

12B3:0542 89D8         * MOV    AX,BX       ; identifik tor souboru
12B3:0544 BA4100         MOV    DX,0041     ; identifik tor popisova‡e
12B3:0547 E843FF         CALL   048D        ; kontrola platnosti souboru EXE
12B3:054A 89C1           MOV    CX,AX
12B3:054C B43E           MOV    AH,3E
12B3:054E CD21           INT    21          ; uzav©en¡ souboru
12B3:0550 19D2           SBB    DX,DX 
12B3:0552 89C8           MOV    AX,CX 
12B3:0554 EBE8           JMP    053E 

; -----------------------------------------------------------------------------
;        vol n¡ slu‘by XMS
; -----------------------------------------------------------------------------

12B3:0556 53             PUSH   BX
12B3:0557 51             PUSH   CX 
12B3:0558 52             PUSH   DX 
12B3:0559 56             PUSH   SI 
12B3:055A 57             PUSH   DI 
12B3:055B BF7606         MOV    DI,0676     ; adresa obsluhy XMS
12B3:055E 89C6           MOV    SI,AX       ; tabulka parametr– XMS
12B3:0560 8B04           MOV    AX,[SI] 
12B3:0562 8B5C02         MOV    BX,[SI+02] 
12B3:0565 8B5406         MOV    DX,[SI+06] 
12B3:0568 FF1D           CALL   FAR [DI]    ; obsluha XMS
12B3:056A 895406         MOV    [SI+06],DX 
12B3:056D 895C02         MOV    [SI+02],BX 
12B3:0570 8904           MOV    [SI],AX 
12B3:0572 E9F1FA         JMP    0066 

; -----------------------------------------------------------------------------
;    zji¨tˆn¡ voln‚ pamˆti XMS (v KB)
; -----------------------------------------------------------------------------

12B3:0575 53             PUSH   BX
12B3:0576 51             PUSH   CX 
12B3:0577 52             PUSH   DX 
12B3:0578 55             PUSH   BP 
12B3:0579 89E5           MOV    BP,SP 
12B3:057B 83EC16         SUB    SP,+16 
12B3:057E 803ECC0503     CMP    Byte Ptr [05CC],03 ; verze syst‚mu min. 3.00
12B3:0583 7304           JNB    0589        ; verze syst‚mu je OK

12B3:0585 31C0         * XOR    AX,AX
12B3:0587 EB59           JMP    05E2 

; ------ test instalace XMS

12B3:0589 C746EA0043     MOV    Word Ptr [BP-16],4300 ; ‡¡slo slu‘by AX=4300h
12B3:058E 8D46F8         LEA    AX,[BP-08]  ; adresa bufferu segment–
12B3:0591 E8F709         CALL   0F8B        ; £schova segmentov˜ch registr–
12B3:0594 B82F00         MOV    AX,002F     ; p©eru¨en¡ 2Fh
12B3:0597 8D56EA         LEA    DX,[BP-16]  ; vstupn¡ tabulka registr–
12B3:059A 8D5EEA         LEA    BX,[BP-16]  ; v˜stupn¡ tabulka registr–
12B3:059D 8D4EF8         LEA    CX,[BP-08] 
12B3:05A0 E8000A         CALL   0FA3        ; p©eru¨en¡ INT 2fh - test XMS
12B3:05A3 807EEA80       CMP    Byte Ptr [BP-16],80  ; je XMS (AL=80h) ?
12B3:05A7 75DC           JNZ    0585        ; nen¡ ovlada‡ XMS

; ------ poskytnut¡ adresy ovlada‡e XMS

12B3:05A9 C746EA1043     MOV    Word Ptr [BP-16],4310 ; slu‘ba AX=4310h
12B3:05AE 8D46F8         LEA    AX,[BP-08]
12B3:05B1 E8D709         CALL   0F8B        ; £schova segmentov˜ch registr–
12B3:05B4 B82F00         MOV    AX,002F     ; p©eru¨en¡ INT 2fh
12B3:05B7 8D56EA         LEA    DX,[BP-16] 
12B3:05BA 8D5EEA         LEA    BX,[BP-16] 
12B3:05BD 8D4EF8         LEA    CX,[BP-08] 
12B3:05C0 E8E009         CALL   0FA3        ; zji¨tˆn¡ adresy obsluhy XMS
12B3:05C3 8B46EC         MOV    AX,[BP-14]
12B3:05C6 A37606         MOV    [0676],AX   ; adresa obsluhy XMS
12B3:05C9 8B46F8         MOV    AX,[BP-08]
12B3:05CC A37806         MOV    [0678],AX 

; ------ zji¨tˆn¡ voln‚ pamˆti XMS v KB

12B3:05CF C646EB08       MOV    Byte Ptr [BP-15],08 ; ‡¡slo slu‘by AH=8
12B3:05D3 8D46EA         LEA    AX,[BP-16]  ; tabulka regisr–
12B3:05D6 E87DFF         CALL   0556 
12B3:05D9 837EEA00       CMP    Word Ptr [BP-16],+00 ; AX=0 (je voln˜ blok) ?
12B3:05DD 74A6           JZ     0585        ; nen¡ voln  pamˆŸ XMS
12B3:05DF 8B46F0         MOV    AX,[BP-10]  ; celkov  voln  pamˆŸ v KB
12B3:05E2 89EC         * MOV    SP,BP
12B3:05E4 5D             POP    BP 
12B3:05E5 E956FF         JMP    053E 

; -----------------------------------------------------------------------------
;        test instalace ovlada‡e ochrann‚ho m¢du DOS
; -----------------------------------------------------------------------------

12B3:05E8 53             PUSH   BX
12B3:05E9 51             PUSH   CX 
12B3:05EA 52             PUSH   DX 
12B3:05EB 56             PUSH   SI 
12B3:05EC 57             PUSH   DI 
12B3:05ED 803ECC0503     CMP    Byte Ptr [05CC],03 ; verze syst‚mu
12B3:05F2 720F           JB     0603        ; n¡zk  verze - nen¡ ovlada‡ DOS
12B3:05F4 B88716         MOV    AX,1687 
12B3:05F7 CD2F           INT    2F          ; test instalace ovlad. ochrann‚ho m¢du
12B3:05F9 85C0           TEST   AX,AX 
12B3:05FB 7506           JNZ    0603        ; nen¡ ovlada‡ ochrann‚ho m¢du
12B3:05FD B80100         MOV    AX,0001     ; p©¡znak ovlada‡e ochrann‚ho m¢du
12B3:0600 E963FA         JMP    0066 
12B3:0603 31C0         * XOR    AX,AX       ; nen¡ ovlada‡ ochrann‚ho m¢du
12B3:0605 E95EFA         JMP    0066 

; -----------------------------------------------------------------------------
;    zji¨tˆn¡ velikosti roz¨¡©en‚ pamˆti ROM-BIOS
; -----------------------------------------------------------------------------

12B3:0608 53             PUSH   BX
12B3:0609 51             PUSH   CX 
12B3:060A 52             PUSH   DX 
12B3:060B 55             PUSH   BP 
12B3:060C 89E5           MOV    BP,SP 
12B3:060E 83EC16         SUB    SP,+16 
12B3:0611 803ECC0503     CMP    Byte Ptr [05CC],03 
12B3:0616 7304           JNB    061C 
12B3:0618 31C0           XOR    AX,AX 
12B3:061A EBC6           JMP    05E2 

12B3:061C C646EB88       MOV    Byte Ptr [BP-15],88 ; slu‘ba AH=88h
12B3:0620 8D46F8         LEA    AX,[BP-08] 
12B3:0623 E86509         CALL   0F8B        ; £schova segmentov˜ch registr–
12B3:0626 B81500         MOV    AX,0015 
12B3:0629 8D56EA         LEA    DX,[BP-16] 
12B3:062C 8D5EEA         LEA    BX,[BP-16] 
12B3:062F 8D4EF8         LEA    CX,[BP-08] 
12B3:0632 E86E09         CALL   0FA3        ; vol n¡ INT 15h/AH=88h, roz¨¡©.pamˆŸ
12B3:0635 8B46EA         MOV    AX,[BP-16]  ; voln  pamˆŸ v KB
12B3:0638 EBA8           JMP    05E2 

; -----------------------------------------------------------------------------
;    zji¨tˆn¡ voln‚ pamˆti EMS (v KB)
; -----------------------------------------------------------------------------

12B3:063A 53             PUSH   BX
12B3:063B 51             PUSH   CX 
12B3:063C 52             PUSH   DX 
12B3:063D 56             PUSH   SI 
12B3:063E 55             PUSH   BP 
12B3:063F 89E5           MOV    BP,SP 
12B3:0641 83EC20         SUB    SP,+20 

; ------ poskytnut¡ adresy INT 67h

12B3:0644 C646E135       MOV    Byte Ptr [BP-1F],35 ; AH=35h
12B3:0648 C646E067       MOV    Byte Ptr [BP-20],67 ; AL=67h
12B3:064C 8D46F8         LEA    AX,[BP-08]  ; tabulka segmentov˜ch registr–
12B3:064F E83909         CALL   0F8B        ; £schova segmentov˜ch registr–
12B3:0652 B82100         MOV    AX,0021     ; ‡¡slo p©eru¨en¡ (INT 21h)
12B3:0655 8D56E0         LEA    DX,[BP-20]  ; vstupn¡ tabulka registr–
12B3:0658 8D5EE0         LEA    BX,[BP-20]  ; v˜stupn¡ tabulka registr–
12B3:065B 8D4EF8         LEA    CX,[BP-08]  ; tabulka segmentov˜ch registr–
12B3:065E E84209         CALL   0FA3        ; vol n¡ p©eru¨en¡ INT 21h

; ------ porovn n¡ ovlada‡e, zda je to EMMXXXX0 (ES:10h - identifika‡n¡ text)

12B3:0661 B81400         MOV    AX,0014 
12B3:0664 E803FA         CALL   006A        ; dek¢dov n¡ textu "EMMXXXX0"
12B3:0667 89C2           MOV    DX,AX       ; text EMMXXXX0
12B3:0669 8D46EE         LEA    AX,[BP-12] 
12B3:066C E84B05         CALL   0BBA        ; kopie ©etˆzce ASCIIZ DX do AX
12B3:066F 31F6           XOR    SI,SI 
12B3:0671 BB0A00         MOV    BX,000A     ; adresa v segmentu p©eru¨en¡
12B3:0674 8E46F8         MOV    ES,[BP-08] 
12B3:0677 268A07       * MOV    AL,ES:[BX]
12B3:067A 3A42EE         CMP    AL,[BP+SI-12] 
12B3:067D 7405           JZ     0684 
12B3:067F 31C0         * XOR    AX,AX
12B3:0681 E9B2FB         JMP    0236        ; nen¡ ovlada‡ EMS
12B3:0684 43           * INC    BX
12B3:0685 46             INC    SI 
12B3:0686 83FE08         CMP    SI,+08 
12B3:0689 7CEC           JL     0677 

; ------ test stavu EMS (slu‘ba 40h, INT 67h)

12B3:068B C646E140       MOV    Byte Ptr [BP-1F],40 ; ‡¡slo slu‘by AH=40h
12B3:068F 8D46F8         LEA    AX,[BP-08]  ; tabulka segmentov˜ch registr–
12B3:0692 E8F608         CALL   0F8B        ; £schova segmentov˜ch registr–
12B3:0695 B86700         MOV    AX,0067     ; p©eru¨en¡ INT 67h
12B3:0698 8D56E0         LEA    DX,[BP-20] 
12B3:069B 8D5EE0         LEA    BX,[BP-20] 
12B3:069E 8D4EF8         LEA    CX,[BP-08] 
12B3:06A1 E8FF08         CALL   0FA3        ; vol n¡ INT 67h/AH=40h, test stavu
12B3:06A4 807EE100       CMP    Byte Ptr [BP-1F],00 ; AH=mus¡ b˜t 0
12B3:06A8 75D5           JNZ    067F        ; nen¡ ovlada‡ EMS
;þ
; ------ stanoven¡ po‡tu voln˜ch str nek EMS

12B3:06AA C646E142       MOV    Byte Ptr [BP-1F],42 ; ‡¡slo slu‘by AH=42h
12B3:06AE 8D46F8         LEA    AX,[BP-08]  ; tabulka segmentov˜ch registr–
12B3:06B1 E8D708         CALL   0F8B        ; £schova segmentov˜ch registr–
12B3:06B4 B86700         MOV    AX,0067     ; ‡¡slo p©eru¨en¡ INT 67h
12B3:06B7 8D56E0         LEA    DX,[BP-20] 
12B3:06BA 8D5EE0         LEA    BX,[BP-20] 
12B3:06BD 8D4EF8         LEA    CX,[BP-08] 
12B3:06C0 E8E008         CALL   0FA3        ; vol n¡ INT 67h/AH=42h, voln  pamˆŸ
12B3:06C3 807EE100       CMP    Byte Ptr [BP-1F],00 ; je OK ?
12B3:06C7 75B6           JNZ    067F        ; chyba ovlada‡e EMS
12B3:06C9 B104           MOV    CL,04
12B3:06CB 8B46E2         MOV    AX,[BP-1E]  ; po‡et voln˜ch str nek EMS
12B3:06CE D3E0           SHL    AX,CL       ; p©epo‡et str nek EMS na kilobajty
12B3:06D0 E963FB         JMP    0236

; -----------------------------------------------------------------------------
;    test instalace VCPI
; -----------------------------------------------------------------------------

12B3:06D3 53             PUSH   BX
12B3:06D4 51             PUSH   CX 
12B3:06D5 52             PUSH   DX 
12B3:06D6 56             PUSH   SI 
12B3:06D7 55             PUSH   BP 
12B3:06D8 89E5           MOV    BP,SP 
12B3:06DA 83EC16         SUB    SP,+16 

; ------ p©idˆlen¡ 1 str nky XMS

12B3:06DD C646EB43       MOV    Byte Ptr [BP-15],43 ; slu‘ba AH=43h
12B3:06E1 C746EC0100     MOV    Word Ptr [BP-14],0001 ; BX=1
12B3:06E6 8D46F8         LEA    AX,[BP-08]  ; tabulka segmentov˜ch registr–
12B3:06E9 E89F08         CALL   0F8B        ; £schova segmentov˜ch registr–
12B3:06EC B86700         MOV    AX,0067     ; ‡¡slo p©eru¨en¡ - INT 67h
12B3:06EF 8D56EA         LEA    DX,[BP-16]  ; vstupn¡ tabulka registr–
12B3:06F2 8D5EEA         LEA    BX,[BP-16]  ; v˜stupn¡ tabulka registr–
12B3:06F5 8D4EF8         LEA    CX,[BP-08]  ; tabulka segmentov˜ch registr–
12B3:06F8 E8A808         CALL   0FA3        ; vol n¡ p©eru¨en¡ INT 67h
12B3:06FB 807EEB00       CMP    Byte Ptr [BP-15],00 ; je stav OK ?
12B3:06FF 7405           JZ     0706 
12B3:0701 31C0         * XOR    AX,AX
12B3:0703 E930FB         JMP    0236 

; ------ kontrola instalace VCPI

12B3:0706 8B76F0         MOV    SI,[BP-10]
12B3:0709 C746EA00DE     MOV    Word Ptr [BP-16],DE00 ; AX=0de00h
12B3:070E 8D46F8         LEA    AX,[BP-08] 
12B3:0711 E87708         CALL   0F8B        ; £schova segmentov˜ch registr–
12B3:0714 B86700         MOV    AX,0067 
12B3:0717 8D56EA         LEA    DX,[BP-16] 
12B3:071A 8D5EEA         LEA    BX,[BP-16] 
12B3:071D 8D4EF8         LEA    CX,[BP-08] 
12B3:0720 E88008         CALL   0FA3        ; slu‘ba INT 67h/AX=0de00h
12B3:0723 807EEB00       CMP    Byte Ptr [BP-15],00 ; je VCPI instalov n (AH=0) ?
12B3:0727 75D8           JNZ    0701        ; nen¡ instalov n

; ------ uvolnˆn¡ p©idˆlen‚ho bloku XMS

12B3:0729 C646EB45       MOV    Byte Ptr [BP-15],45           ;'E'
12B3:072D 8976F0         MOV    [BP-10],SI 
12B3:0730 8D46F8         LEA    AX,[BP-08] 
12B3:0733 E85508         CALL   0F8B        ; £schova segmentov˜ch registr–
12B3:0736 B86700         MOV    AX,0067 
12B3:0739 8D56EA         LEA    DX,[BP-16] 
12B3:073C 8D5EEA         LEA    BX,[BP-16] 
12B3:073F 8D4EF8         LEA    CX,[BP-08] 
12B3:0742 E85E08         CALL   0FA3 
12B3:0745 B80100         MOV    AX,0001 
12B3:0748 E9EBFA         JMP    0236 

; -----------------------------------------------------------------------------
;        Kontrola hardwarov˜ch podm¡nek programu (procesor, pamˆŸ)
; -----------------------------------------------------------------------------
;þ
12B3:074B 53             PUSH   BX
12B3:074C 51             PUSH   CX 
12B3:074D 52             PUSH   DX 

; ------ kontrola verze syst‚mu (mus¡ b˜t alespo¤ 3.00)

12B3:074E 803ECC0503     CMP    Byte Ptr [05CC],03 ; je verze syst‚mu 3.xx ?
12B3:0753 7303           JNB    0758        ; je verze 3.00 nebo vy¨¨¡ - OK
12B3:0755 E9E4FD         JMP    053C        ; ni‘¨¡ - chyba

; ------ test typu procesoru (mus¡ b˜t alespo¤ 80386)

12B3:0758 0E           * PUSH   CS
12B3:0759 E84410         CALL   17A0        ; test typu procesoru
12B3:075C 90             NOP     
12B3:075D 3D0300         CMP    AX,0003     ; je alespo¤ 80386 ?
12B3:0760 7D03           JGE    0765        ; je 386 nebo vy¨¨¡ - OK
12B3:0762 E9D7FD         JMP    053C        ; ni‘¨¡ CPU - chyba

; ------ test, zda je ovlada‡ ochrann‚ho m¢du DOS (nesm¡ b˜t nainstalov n)

12B3:0765 E880FE       * CALL   05E8        ; test instalace ochran. m¢du DOS
12B3:0768 85C0           TEST   AX,AX       ; je ovlada‡ nainstalov n ?
12B3:076A 7403           JZ     076F        ; nen¡ nainstalov n - to je OK
12B3:076C E9CDFD         JMP    053C        ; je nainstalov n - chyba

; ------ test, zda je voln  pamˆŸ EMS

12B3:076F E8C8FE         CALL   063A        ; zji¨tˆn¡ voln‚ pamˆti EMS
12B3:0772 85C0           TEST   AX,AX       ; je nˆjak  pamˆŸ EMS ?
12B3:0774 740F           JZ     0785        ; nen¡ ‘ dn  voln  pamˆŸ EMS
12B3:0776 3B063A00       CMP    AX,[003A]   ; voln  pamˆŸ OK ?
12B3:077A 7303           JNB    077F        ; voln  pamˆŸ je OK
12B3:077C E9BDFD         JMP    053C        ; chyba - m lo pamˆti EMS

; ------ EMS je OK - test instalace VCPI

12B3:077F E851FF         CALL   06D3        ; test instalace VCPI
12B3:0782 E9B9FD         JMP    053E        ; n vrat

; ------ test, zda m–‘e b˜t pamˆŸ XMS

12B3:0785 0F01E0         SMSW   AX
12B3:0788 250100         AND    AX,0001
12B3:078B 85C0           TEST   AX,AX 
12B3:078D 7403           JZ     0792 
12B3:078F E9AAFD         JMP    053C        ; nen¡ roz¨¡©en  pamˆŸ

; ------ zji¨tˆn¡ voln‚ pamˆti XMS

12B3:0792 E8E0FD       * CALL   0575        ; stanoven¡ voln‚ pamˆti XMS
12B3:0795 3B063A00       CMP    AX,[003A]   ; je dostatek voln‚ pamˆti XNS ?
12B3:0799 7206           JB     07A1        ; nen¡ voln  pamˆŸ XMS
12B3:079B B80100       * MOV    AX,0001     ; pamˆŸ je OK
12B3:079E E99DFD         JMP    053E 

; ------ zji¨tˆn¡ voln‚ roz¨¡©en‚ pamˆti ROM-BIOS

12B3:07A1 E864FE         CALL   0608        ; test voln‚ pamˆti ROM BIOS
12B3:07A4 3B063A00       CMP    AX,[003A]   ; je dostatek voln‚ pamˆti ?
12B3:07A8 73F1           JNB    079B        ; OK
12B3:07AA E98FFD         JMP    053C        ; nen¡ roz¨¡©en  pamˆŸ

; -----------------------------------------------------------------------------
;        Test nalezen¡ spr vn‚ verze FOXPRO*.ESL
; -----------------------------------------------------------------------------

12B3:07AD 53             PUSH   BX
12B3:07AE 56             PUSH   SI 
12B3:07AF 89C6           MOV    SI,AX 
12B3:07B1 89D3           MOV    BX,DX 
12B3:07B3 803E360000     CMP    Byte Ptr [0036],00    ; je parametr "X" ?
12B3:07B8 7419           JZ     07D3             ; nen¡ parametr "X"

12B3:07BA A03600         MOV    AL,[0036] 
12B3:07BD FEC8           DEC    AL 
12B3:07BF 7519           JNZ    07DA 
12B3:07C1 80BF830000     CMP    Byte Ptr [BX+0083],00 
12B3:07C6 7449           JZ     0811 
12B3:07C8 81C38300       ADD    BX,0083 
12B3:07CC 891C           MOV    [SI],BX 
12B3:07CE B80100         MOV    AX,0001 
12B3:07D1 EB40           JMP    0813 

12B3:07D3 803F00       * CMP    Byte Ptr [BX],00
12B3:07D6 75F4           JNZ    07CC 
12B3:07D8 EB37           JMP    0811 
12B3:07DA 833E380000     CMP    Word Ptr [0038],+00 ; je parametr "Z" ?
12B3:07DF 7405           JZ     07E6 
12B3:07E1 803F00         CMP    Byte Ptr [BX],00 
12B3:07E4 75E6           JNZ    07CC 

; ------ test hardware po‡¡ta‡e (zda m  b˜t X)

12B3:07E6 803E3700FF   * CMP    Byte Ptr [0037],FF ; testuje se hardware ?
12B3:07EB 7511           JNZ    07FE        ; bylo ji‘ testov no
12B3:07ED E85BFF         CALL   074B        ; kontrola hardwarov˜ch podm¡nek
12B3:07F0 85C0           TEST   AX,AX       ; m–‘e b˜t roz¨¡©en˜ m¢d ?
12B3:07F2 7405           JZ     07F9        ; nen¡ mo‘n˜ parametr X
12B3:07F4 B80100         MOV    AX,0001 
12B3:07F7 EB02           JMP    07FB        ; je mo‘n˜ X
12B3:07F9 31C0           XOR    AX,AX
12B3:07FB A23700       * MOV    [0037],AL   ; p©¡znak vhodnosti hardware (1="X")

12B3:07FE 80BF830000     CMP    Byte Ptr [BX+0083],00
12B3:0803 7407           JZ     080C 
12B3:0805 803E370001     CMP    Byte Ptr [0037],01 
12B3:080A 74BC           JZ     07C8 
12B3:080C 803F00       * CMP    Byte Ptr [BX],00
12B3:080F 75BB           JNZ    07CC 
12B3:0811 31C0           XOR    AX,AX 
12B3:0813 5E             POP    SI 
12B3:0814 5B             POP    BX 
12B3:0815 C3             RET     

; -----------------------------------------------------------------------------
;        Test nalezen¡ spr vn‚ verze FOXPRO*.ESL
; -----------------------------------------------------------------------------

12B3:0816 52             PUSH   DX
12B3:0817 803E350001     CMP    Byte Ptr [0035],01    ; p©¡znak testu jm. FOXPRO
12B3:081C 7508           JNZ    0826        ; netestuje se
12B3:081E BAF606         MOV    DX,06F6     ; jm‚no souboru FOXPRO.ESL
12B3:0821 E889FF         CALL   07AD        ; test spr vn‚ verze FOXPRO*.ESL
12B3:0824 EB18           JMP    083E 

12B3:0826 803E350000   * CMP    Byte Ptr [0035],00
12B3:082B 740F           JZ     083C 
12B3:082D BAF606         MOV    DX,06F6 
12B3:0830 E87AFF         CALL   07AD
12B3:0833 85C0           TEST   AX,AX 
12B3:0835 7405           JZ     083C 
12B3:0837 B80100         MOV    AX,0001 
12B3:083A EB02           JMP    083E 

12B3:083C 31C0           XOR    AX,AX
12B3:083E 5A           * POP    DX
12B3:083F C3             RET     

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

12B3:0840 53             PUSH   BX
12B3:0841 52             PUSH   DX 
12B3:0842 56             PUSH   SI 
12B3:0843 57             PUSH   DI 
12B3:0844 89C6           MOV    SI,AX 
12B3:0846 89C3           MOV    BX,AX 
12B3:0848 803F00         CMP    Byte Ptr [BX],00 
12B3:084B 7443           JZ     0890 
12B3:084D 803F5C         CMP    Byte Ptr [BX],5C              ;'\' 
12B3:0850 7523           JNZ    0875 
12B3:0852 807F012E       CMP    Byte Ptr [BX+01],2E           ;'.' 
12B3:0856 751D           JNZ    0875 
12B3:0858 807F025C       CMP    Byte Ptr [BX+02],5C           ;'\' 
12B3:085C 7406           JZ     0864 
12B3:085E 807F022E       CMP    Byte Ptr [BX+02],2E           ;'.' 
12B3:0862 7511           JNZ    0875 
12B3:0864 43             INC    BX 
12B3:0865 43             INC    BX 
12B3:0866 803F2E         CMP    Byte Ptr [BX],2E              ;'.' 
12B3:0869 75DD           JNZ    0848 
12B3:086B 43             INC    BX 
12B3:086C 807CFF3A       CMP    Byte Ptr [SI-01],3A           ;':' 
12B3:0870 750B           JNZ    087D 
12B3:0872 83EB03         SUB    BX,+03 
12B3:0875 8A17           MOV    DL,[BX] 
12B3:0877 8814           MOV    [SI],DL 
12B3:0879 46             INC    SI 
12B3:087A 43             INC    BX 
12B3:087B EBCB           JMP    0848 
12B3:087D 89F7           MOV    DI,SI 
12B3:087F 4E             DEC    SI 
12B3:0880 803D00         CMP    Byte Ptr [DI],00 
12B3:0883 74C3           JZ     0848 
12B3:0885 39C6           CMP    SI,AX 
12B3:0887 74E9           JZ     0872 
12B3:0889 803C5C         CMP    Byte Ptr [SI],5C              ;'\' 
12B3:088C 74BA           JZ     0848 
12B3:088E EBED           JMP    087D 
12B3:0890 C60400         MOV    Byte Ptr [SI],00 
12B3:0893 5F             POP    DI 
12B3:0894 5E             POP    SI 
12B3:0895 5A             POP    DX 
12B3:0896 5B             POP    BX 
12B3:0897 C3             RET     

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

12B3:0898 53             PUSH   BX
12B3:0899 52             PUSH   DX 
12B3:089A 56             PUSH   SI 
12B3:089B 55             PUSH   BP 
12B3:089C 89E5           MOV    BP,SP 
12B3:089E 81ECC200       SUB    SP,00C2 
12B3:08A2 81EDBE00       SUB    BP,00BE 
12B3:08A6 89C3           MOV    BX,AX 
12B3:08A8 807F013A       CMP    Byte Ptr [BX+01],3A           ;':' 
12B3:08AC 755D           JNZ    090B 
12B3:08AE 807F025C       CMP    Byte Ptr [BX+02],5C           ;'\' 
12B3:08B2 7457           JZ     090B 
12B3:08B4 C6467E00       MOV    Byte Ptr [BP+7E],00 
12B3:08B8 8A17           MOV    DL,[BX] 
12B3:08BA 80EA40         SUB    DL,40                         ;'@' 
12B3:08BD 8D767E         LEA    SI,[BP+7E] 
12B3:08C0 B447           MOV    AH,47
12B3:08C2 CD21           INT    21          ; poskytnut¡ aktivn¡ho adres ©e
12B3:08C4 19D2           SBB    DX,DX 
12B3:08C6 85D2           TEST   DX,DX 
12B3:08C8 7F02           JG     08CC 
12B3:08CA 753F           JNZ    090B 
12B3:08CC 8A07           MOV    AL,[BX] 
12B3:08CE 8846FC         MOV    [BP-04],AL 
12B3:08D1 C646FD3A       MOV    Byte Ptr [BP-03],3A           ;':' 
12B3:08D5 C646FE5C       MOV    Byte Ptr [BP-02],5C           ;'\' 
12B3:08D9 C646FF00       MOV    Byte Ptr [BP-01],00 
12B3:08DD 807E7E00       CMP    Byte Ptr [BP+7E],00 
12B3:08E1 7412           JZ     08F5 
12B3:08E3 8D46FC         LEA    AX,[BP-04] 
12B3:08E6 8D567E         LEA    DX,[BP+7E] 
12B3:08E9 E8CC03         CALL   0CB8        ; p©id n¡ textu DS:DX k textu DS:AX
12B3:08EC 8D46FC         LEA    AX,[BP-04] 
12B3:08EF BA2400         MOV    DX,0024 
12B3:08F2 E8C303         CALL   0CB8        ; p©id n¡ textu DS:DX k textu DS:AX
12B3:08F5 8D5702         LEA    DX,[BX+02] 
12B3:08F8 8D46FC         LEA    AX,[BP-04] 
12B3:08FB E8BA03         CALL   0CB8        ; p©id n¡ textu DS:DX k textu DS:AX
12B3:08FE 89D8           MOV    AX,BX 
12B3:0900 8D56FC         LEA    DX,[BP-04] 
12B3:0903 E8B402         CALL   0BBA        ; kopie ©etˆzce ASCIIZ DX do AX
12B3:0906 89D8           MOV    AX,BX 
12B3:0908 E835FF         CALL   0840 
12B3:090B 81C5BE00       ADD    BP,00BE 
12B3:090F 89EC           MOV    SP,BP 
12B3:0911 5D             POP    BP 
12B3:0912 EB80           JMP    0894 

; -----------------------------------------------------------------------------
;        kontrola platnosti programu PROSDEMO
; -----------------------------------------------------------------------------

12B3:0914 53             PUSH   BX
12B3:0915 52             PUSH   DX 
12B3:0916 A37A06         MOV    [067A],AX 
12B3:0919 E809FC         CALL   0525        ; kontrola platnosti progr. PROSDEMO
12B3:091C 85C0           TEST   AX,AX 
12B3:091E 7432           JZ     0952        ; soubor je neplatn˜

12B3:0920 833E30000A     CMP    Word Ptr [0030],+0A
12B3:0925 7E06           JLE    092D 
12B3:0927 C70630000A00   MOV    Word Ptr [0030],000A ; minim lnˆ 10
12B3:092D A13000       * MOV    AX,[0030]

12B3:0930 89C3           MOV    BX,AX
12B3:0932 D1E3           SHL    BX,1 
12B3:0934 EB0B           JMP    0941 

12B3:0936 8B977806     * MOV    DX,[BX+0678]
12B3:093A 89977A06       MOV    [BX+067A],DX 
12B3:093E 4B             DEC    BX 
12B3:093F 4B             DEC    BX 
12B3:0940 48             DEC    AX 
12B3:0941 83FB02       * CMP    BX,+02
12B3:0944 7FF0           JG     0936 
12B3:0946 C7067C06FC07   MOV    Word Ptr [067C],07FC ; jm‚no programu PROSDEMO.EXE
12B3:094C FF063000       INC    Word Ptr [0030] 
12B3:0950 EB06           JMP    0958 

12B3:0952 B82C00         MOV    AX,002C     ; chybov‚ hl ¨en¡
12B3:0955 E97DF7         JMP    00D5 

12B3:0958 8B1E3000       MOV    BX,[0030]
12B3:095C D1E3           SHL    BX,1 
12B3:095E C7877A062600   MOV    Word Ptr [BX+067A],0026 
12B3:0964 5A             POP    DX 
12B3:0965 5B             POP    BX 
12B3:0966 C3             RET

; -----------------------------------------------------------------------------
;        Spu¨tˆn¡ programu
; -----------------------------------------------------------------------------

12B3:0967 53             PUSH   BX 
12B3:0968 52             PUSH   DX 
12B3:0969 BA7A06         MOV    DX,067A 
12B3:096C 31DB           XOR    BX,BX 
12B3:096E E84200         CALL   09B3 
12B3:0971 5A             POP    DX 
12B3:0972 5B             POP    BX 
12B3:0973 C3             RET

; -----------------------------------------------------------------------------
;        pokra‡ov n¡ hlavn¡ obsluhy (DS:DX=jm‚no programu)
; -----------------------------------------------------------------------------
;þ
12B3:0974 55             PUSH   BP 
12B3:0975 89E5           MOV    BP,SP 
12B3:0977 50             PUSH   AX

; ------ kontrola verze syst‚mu (mus¡ b˜t alespo¤ 3.xx)

12B3:0978 803ECC0503     CMP    Byte Ptr [05CC],03    ; verze syst‚mu 3.xx ?
12B3:097D 7306           JNB    0985        ; verze syst‚mu je OK
12B3:097F B82D00         MOV    AX,002D     ; k¢d textu "Cannot run under DOS.."
12B3:0982 E950F7         JMP    00D5        ; chybov˜ n vrat

; ------ dek¢dov n¡ zadan˜ch parametr–

12B3:0985 89D0           MOV    AX,DX       ; jm‚no programu
12B3:0987 E8B3F8         CALL   023D        ; dek¢dov n¡ zadan˜ch parametr–

; ------ nalezen¡ programu FOXPRO?.ESL

12B3:098A E846FA         CALL   03D3        ; nalezen¡ programu FOXPRO

; ------ test nalezen¡ spr vn‚ verze FOXPRO*.ESL

12B3:098D 8D46FE         LEA    AX,[BP-02] 
12B3:0990 E883FE         CALL   0816        ; test nalezen¡ spr vn‚ verze FOXPRO
12B3:0993 85C0           TEST   AX,AX 
12B3:0995 7506           JNZ    099D        ; odpov¡d  OK
12B3:0997 B82E00         MOV    AX,002E
12B3:099A E938F7         JMP    00D5        ; chyba - nenalezen

; ------ sestaven¡ jm‚na programu a jeho kontrola

12B3:099D 8B46FE         MOV    AX,[BP-02]
12B3:09A0 E8F5FE         CALL   0898        ; sestaven¡ jm‚na souboru
12B3:09A3 8B46FE         MOV    AX,[BP-02] 
12B3:09A6 E86BFF         CALL   0914        ; kontrola platnosti progr. PROSDEMO
12B3:09A9 8B46FE         MOV    AX,[BP-02] 

; ------ spu¨tˆn¡ programu FOXPRO

12B3:09AC E8B8FF         CALL   0967        ; spu¨tˆn¡ programu FOXPRO
12B3:09AF 89EC           MOV    SP,BP
12B3:09B1 5D             POP    BP 
12B3:09B2 C3             RET     

; -----------------------------------------------------------------------------
;        Spu¨tˆn¡ programu FOXPRO
; -----------------------------------------------------------------------------

; ------ kontrola z sobn¡ku

12B3:09B3 50             PUSH   AX
12B3:09B4 B8F200         MOV    AX,00F2     ; prostor pro lok ln¡ promˆnn‚
12B3:09B7 E86606         CALL   1020        ; kontrola z sobn¡ku
12B3:09BA 58             POP    AX 

; ------ p©¡prava prost©ed¡ pro program

12B3:09BB 51             PUSH   CX
12B3:09BC 56             PUSH   SI 
12B3:09BD 55             PUSH   BP 
12B3:09BE 89E5           MOV    BP,SP 
12B3:09C0 81ECE200       SUB    SP,00E2 
12B3:09C4 81ED8000       SUB    BP,0080 
12B3:09C8 89C6           MOV    SI,AX 
12B3:09CA 89D0           MOV    AX,DX 
12B3:09CC 89DA           MOV    DX,BX 
12B3:09CE 31DB           XOR    BX,BX 
12B3:09D0 53             PUSH   BX 
12B3:09D1 8D5E9E         LEA    BX,[BP-62] 
12B3:09D4 53             PUSH   BX 
12B3:09D5 8D5E7E         LEA    BX,[BP+7E] 
12B3:09D8 8D4E7C         LEA    CX,[BP+7C] 
12B3:09DB E87106         CALL   104F        ; sestaven¡ prost©ed¡
12B3:09DE 3DFFFF         CMP    AX,FFFF 
12B3:09E1 7506           JNZ    09E9 
12B3:09E3 B8FFFF         MOV    AX,FFFF 
12B3:09E6 E97200         JMP    0A5B 

12B3:09E9 89F0           MOV    AX,SI
12B3:09EB E87E01         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX
12B3:09EE 83C007         ADD    AX,+07 
12B3:09F1 89C3           MOV    BX,AX 
12B3:09F3 E8A307         CALL   1199        ; vytvo©en¡ datov‚ho bloku velik. AX
12B3:09F6 89C2           MOV    DX,AX 
12B3:09F8 89C1           MOV    CX,AX 
12B3:09FA 85C0           TEST   AX,AX 
12B3:09FC 7522           JNZ    0A20 
12B3:09FE E85809         CALL   1359 
12B3:0A01 39C3           CMP    BX,AX 
12B3:0A03 730B           JNB    0A10 
12B3:0A05 8D4701         LEA    AX,[BX+01] 
12B3:0A08 24FE           AND    AL,FE 
12B3:0A0A 29C4           SUB    SP,AX 
12B3:0A0C 89E0           MOV    AX,SP 
12B3:0A0E EB02           JMP    0A12 
12B3:0A10 31C0           XOR    AX,AX 
12B3:0A12 89C3           MOV    BX,AX 
12B3:0A14 85C0           TEST   AX,AX 
12B3:0A16 750A           JNZ    0A22 
12B3:0A18 8B467E         MOV    AX,[BP+7E] 
12B3:0A1B E84209         CALL   1360        ; zru¨en¡ datov‚ho bufferu AX
12B3:0A1E EBC3           JMP    09E3 
12B3:0A20 89D3           MOV    BX,DX 
12B3:0A22 8D461E         LEA    AX,[BP+1E] 
12B3:0A25 FF16F405       CALL   [05F4]      ; vol n¡ 1467 = RET
12B3:0A29 89D8           MOV    AX,BX 
12B3:0A2B 89F2           MOV    DX,SI 
12B3:0A2D E88A01         CALL   0BBA        ; kopie ©etˆzce ASCIIZ DX do AX

;þ

; ------ spu¨tˆn¡ programu

12B3:0A30 FF767C         PUSH   [BP+7C]     ; segment prost©ed¡
12B3:0A33 8D469E         LEA    AX,[BP-62]  ; adresa p©¡kazov‚ho © dku
12B3:0A36 50             PUSH   AX          ; offset p©¡kazov‚ho © dku
12B3:0A37 53             PUSH   BX          ; offset jm‚na programu ke spu¨tˆn¡
12B3:0A38 31C0           XOR    AX,AX       ; p©ep¡na‡ - metoda spu¨tˆn¡ 0
12B3:0A3A 50             PUSH   AX          ; p©ep¡na‡ typu spu¨tˆn¡ programu
12B3:0A3B E8340A         CALL   1472        ; spu¨tˆn¡ programu

; ------ n vrat buffer–

12B3:0A3E 83C408         ADD    SP,+08
12B3:0A41 89C2           MOV    DX,AX 
12B3:0A43 85C9           TEST   CX,CX 
12B3:0A45 7405           JZ     0A4C 
12B3:0A47 89C8           MOV    AX,CX 
12B3:0A49 E81409         CALL   1360        ; zru¨en¡ datov‚ho bufferu AX
12B3:0A4C 8B467E         MOV    AX,[BP+7E] 
12B3:0A4F E80E09         CALL   1360        ; zru¨en¡ datov‚ho bufferu AX
12B3:0A52 8D461E         LEA    AX,[BP+1E] 
12B3:0A55 FF16F605       CALL   [05F6]      ; RET
12B3:0A59 89D0           MOV    AX,DX 
12B3:0A5B 81C58000       ADD    BP,0080 
12B3:0A5F 89EC           MOV    SP,BP 
12B3:0A61 5D             POP    BP 
12B3:0A62 5E             POP    SI 
12B3:0A63 59             POP    CX 
12B3:0A64 C3             RET     

; *****************************************************************************
;
;                      Hlavn¡ procedura MAIN
;
; -----------------------------------------------------------------------------
; VSTUP: DX:AX=adresa p©¡kazov‚ho © dku
;        CX:BX (DS:SI) =adresa jm‚na tohoto programu (z prost©ed¡)
; *****************************************************************************
;þ
12B3:0A65 53             PUSH   BX
12B3:0A66 51             PUSH   CX 
12B3:0A67 56             PUSH   SI 
12B3:0A68 57             PUSH   DI 

12B3:0A69 89C1           MOV    CX,AX       ; offset p©¡kazov‚ho © dku
12B3:0A6B 89D7           MOV    DI,DX       ; segment p©¡kazov‚ho © dku
12B3:0A6D 31D2           XOR    DX,DX 

12B3:0A6F E83400         CALL   0AA6        ; se‡ten¡ d‚lek text– p©¡kaz. © dku
12B3:0A72 40             INC    AX
12B3:0A73 89C6           MOV    SI,AX 
12B3:0A75 D1E0           SHL    AX,1 
12B3:0A77 83C002         ADD    AX,+02 

; ------ vytvo©en¡ bloku pro uschov n¡ parametr–

12B3:0A7A E81C07         CALL   1199        ; vytvo©en¡ datov‚ho bloku velik. AX
12B3:0A7D 89C3           MOV    BX,AX       ; datov˜ blok pro text
12B3:0A7F 85C0           TEST   AX,AX
12B3:0A81 7503           JNZ    0A86        ; blok byl vytvo©en OK
12B3:0A83 E88503         CALL   0E0B        ; chyba - nedostatek pamˆti

12B3:0A86 893F         * MOV    [BX],DI     ; segment p©¡kazov‚ho © dku
12B3:0A88 8D5702         LEA    DX,[BX+02]
12B3:0A8B 89C8           MOV    AX,CX       ; p©¡kazov˜ © dek
12B3:0A8D E81600         CALL   0AA6        ; p©enos text–

12B3:0A90 89F7           MOV    DI,SI       ; jm‚no souboru
12B3:0A92 D1E7           SHL    DI,1 
12B3:0A94 01DF           ADD    DI,BX 
12B3:0A96 C7050000       MOV    Word Ptr [DI],0000 
12B3:0A9A 89F0           MOV    AX,SI 
12B3:0A9C 89DA           MOV    DX,BX       ; jm‚no programu
12B3:0A9E E8D3FE         CALL   0974        ; pokra‡ov n¡ v hlavn¡ obsluze

12B3:0AA1 5F             POP    DI
12B3:0AA2 5E             POP    SI 
12B3:0AA3 59             POP    CX 
12B3:0AA4 5B             POP    BX 
12B3:0AA5 C3             RET     

; -----------------------------------------------------------------------------
;        Se‡ten¡ d‚lek textu p©¡kazov‚ho © dku, nebo p©enos text– (DX>0)
;  (DS:AX=p©¡kazov˜ © dek, DS:SI=adresa bufferu k p©enosu, DX=p©¡znak p©enosu)
; -----------------------------------------------------------------------------
;þ
12B3:0AA6 53             PUSH   BX
12B3:0AA7 51             PUSH   CX 
12B3:0AA8 56             PUSH   SI 
12B3:0AA9 57             PUSH   DI 
12B3:0AAA 55             PUSH   BP 
12B3:0AAB 89E5           MOV    BP,SP 
12B3:0AAD 50             PUSH   AX 
12B3:0AAE 50             PUSH   AX 
12B3:0AAF 89C3           MOV    BX,AX       ; offset p©¡kazov‚ho © dku
12B3:0AB1 C746FC0000   * MOV    Word Ptr [BP-04],0000
12B3:0AB6 E99300         JMP    0B4C 

; ------ test konce textu p©¡kazov‚ho © dku

12B3:0AB9 803F00         CMP    Byte Ptr [BX],00
12B3:0ABC 7435           JZ     0AF3             ; konec textu

; ------ text v uvozovk ch

12B3:0ABE 803F22         CMP    Byte Ptr [BX],22
12B3:0AC1 7533           JNZ    0AF6        ; nen¡ text v uvozovk ch

12B3:0AC3 89F3           MOV    BX,SI       ; jm‚no programu
12B3:0AC5 89F1           MOV    CX,SI 

12B3:0AC7 803F22       * CMP    Byte Ptr [BX],22              ;'"'
12B3:0ACA 7454           JZ     0B20        ; konec textu v uvozovk ch
12B3:0ACC 803F00         CMP    Byte Ptr [BX],00 
12B3:0ACF 744F           JZ     0B20        ; konec textu
12B3:0AD1 803F5C         CMP    Byte Ptr [BX],5C              ;'\' 
12B3:0AD4 750D           JNZ    0AE3 
12B3:0AD6 807F0122       CMP    Byte Ptr [BX+01],22           ;'"' 
12B3:0ADA 7406           JZ     0AE2 
12B3:0ADC 807F015C       CMP    Byte Ptr [BX+01],5C           ;'\' 
12B3:0AE0 7501           JNZ    0AE3 
12B3:0AE2 43           * INC    BX

12B3:0AE3 8D4701       * LEA    AX,[BX+01]  ; n sleduj¡c¡ adresa
12B3:0AE6 85D2           TEST   DX,DX 
12B3:0AE8 7405           JZ     0AEF 
12B3:0AEA 8A1F           MOV    BL,[BX]     ; p©enesen¡ znaku jm‚na programu
12B3:0AEC 881C           MOV    [SI],BL 
12B3:0AEE 46             INC    SI 
12B3:0AEF 89C3         * MOV    BX,AX       ; n sleduj¡c¡ adresa
12B3:0AF1 EBD4           JMP    0AC7 

12B3:0AF3 E96D00       * JMP    0B63

12B3:0AF6 89D9           MOV    CX,BX       ; ukazatel p©¡kazov‚ho © dku
12B3:0AF8 89DE           MOV    SI,BX

; ------ nalezen¡ konce jednoho £seku textu

12B3:0AFA 803F00       * CMP    Byte Ptr [BX],00
12B3:0AFD 7421           JZ     0B20        ; konec textu
12B3:0AFF 803F20         CMP    Byte Ptr [BX],20              ;' ' 
12B3:0B02 741C           JZ     0B20        ; oddˆlovac¡ mezera
12B3:0B04 803F5C         CMP    Byte Ptr [BX],5C              ;'\' 
12B3:0B07 7507           JNZ    0B10        ; nen¡ oddˆlova‡ "\"

12B3:0B09 807F0122       CMP    Byte Ptr [BX+01],22 ; n sleduj¡ uvozovky ?
12B3:0B0D 7501           JNZ    0B10        ; nebudou uvozovky
12B3:0B0F 43             INC    BX          ; budou uvozovky - neplatn˜ znak

; ------ n sleduj¡c¡ znak + p©¡padn˜ p©enos znaku

12B3:0B10 8D4701       * LEA    AX,[BX+01]  ; n sleduj¡c¡ znak
12B3:0B13 85D2           TEST   DX,DX
12B3:0B15 7405           JZ     0B1C 
12B3:0B17 8A1F           MOV    BL,[BX] 
12B3:0B19 881C           MOV    [SI],BL 
12B3:0B1B 46             INC    SI 
12B3:0B1C 89C3         * MOV    BX,AX       ; n sleduj¡c¡ znak
12B3:0B1E EBDA           JMP    0AFA 


12B3:0B20 8D4701         LEA    AX,[BX+01]  ; n sleduj¡c¡ adresa
12B3:0B23 8B7EFC         MOV    DI,[BP-04]  ; ukl dac¡ adresa textu
12B3:0B26 47             INC    DI
12B3:0B27 897EFE         MOV    [BP-02],DI  ; n sleduj¡c¡ adresa
12B3:0B2A 85D2           TEST   DX,DX 
12B3:0B2C 742D           JZ     0B5B 

12B3:0B2E 8B7EFC         MOV    DI,[BP-04]
12B3:0B31 D1E7           SHL    DI,1 
12B3:0B33 01D7           ADD    DI,DX 
12B3:0B35 890D           MOV    [DI],CX 
12B3:0B37 8B4EFE         MOV    CX,[BP-02] 
12B3:0B3A 894EFC         MOV    [BP-04],CX 
12B3:0B3D 803F00         CMP    Byte Ptr [BX],00 
12B3:0B40 7505           JNZ    0B47 
12B3:0B42 C60400         MOV    Byte Ptr [SI],00 
12B3:0B45 EB1C           JMP    0B63 

12B3:0B47 C60400       * MOV    Byte Ptr [SI],00
12B3:0B4A 89C3           MOV    BX,AX 
12B3:0B4C 8D7701       * LEA    SI,[BX+01]
12B3:0B4F 803F20         CMP    Byte Ptr [BX],20              ;' ' 
12B3:0B52 7403           JZ     0B57 
12B3:0B54 E962FF         JMP    0AB9 
12B3:0B57 89F3           MOV    BX,SI 
12B3:0B59 EBF1           JMP    0B4C 

12B3:0B5B 897EFC       * MOV    [BP-04],DI
12B3:0B5E 803F00         CMP    Byte Ptr [BX],00 
12B3:0B61 75E7           JNZ    0B4A 

12B3:0B63 8B46FC         MOV    AX,[BP-04]
12B3:0B66 89EC           MOV    SP,BP 
12B3:0B68 5D             POP    BP 
12B3:0B69 E935FF         JMP    0AA1 

; -----------------------------------------------------------------------------
;        zji¨tˆn¡ d‚lky textu ASCIIZ   DS:AX -> AX
; -----------------------------------------------------------------------------

12B3:0B6C 51           * PUSH   CX
12B3:0B6D 57             PUSH   DI 
12B3:0B6E 06             PUSH   ES 
12B3:0B6F 89C7           MOV    DI,AX 
12B3:0B71 8CD8           MOV    AX,DS 
12B3:0B73 8EC0           MOV    ES,AX 
12B3:0B75 B9FFFF         MOV    CX,FFFF 
12B3:0B78 31C0           XOR    AX,AX 
12B3:0B7A F2             REPNZ  
12B3:0B7B AE             SCASB   
12B3:0B7C F7D1           NOT    CX 
12B3:0B7E 49             DEC    CX 
12B3:0B7F 89C8           MOV    AX,CX 
12B3:0B81 07             POP    ES 
12B3:0B82 5F             POP    DI 
12B3:0B83 59             POP    CX 
12B3:0B84 C3             RET     


12B3:0B85 C3             RET


12B3:0B86 89C2           MOV    DX,AX 
12B3:0B88 FF16C005       CALL   [05C0] 
12B3:0B8C FF16BE05       CALL   [05BE] 
12B3:0B90 89D0           MOV    AX,DX 
12B3:0B92 89C2           MOV    DX,AX 
12B3:0B94 FF16C205       CALL   [05C2] 
12B3:0B98 FF16C405       CALL   [05C4] 
12B3:0B9C 89D0           MOV    AX,DX 
12B3:0B9E E86E03         CALL   0F0F 
12B3:0BA1 00935092       ADD    [BP+DI+9250],DL 

; -----------------------------------------------------------------------------
;        p©id n¡ ‡¡slice z p©¡kazov‚ho © dku k st©ada‡i ‡¡sla
; -----------------------------------------------------------------------------

12B3:0BA2 93             XCHG   AX,BX
12B3:0BA3 50             PUSH   AX
12B3:0BA4 92             XCHG   AX,DX
12B3:0BA5 0BC0           OR     AX,AX
12B3:0BA7 7402           JZ     0BAB 
12B3:0BA9 F7E2           MUL    DX 
12B3:0BAB 91           * XCHG   AX,CX
12B3:0BAC 0BC0           OR     AX,AX 
12B3:0BAE 7404           JZ     0BB4 
12B3:0BB0 F7E3           MUL    BX 
12B3:0BB2 03C8           ADD    CX,AX 
12B3:0BB4 58           * POP    AX
12B3:0BB5 F7E3           MUL    BX 
12B3:0BB7 03D1           ADD    DX,CX 
12B3:0BB9 C3             RET     

; -----------------------------------------------------------------------------
;        kopie ©etˆzce ASCIIZ  DS:DX do DS:AX
; -----------------------------------------------------------------------------

12B3:0BBA 56             PUSH   SI
12B3:0BBB 57             PUSH   DI 
12B3:0BBC 06             PUSH   ES 
12B3:0BBD 89C7           MOV    DI,AX 
12B3:0BBF 89D6           MOV    SI,DX 
12B3:0BC1 8CD8           MOV    AX,DS 
12B3:0BC3 8EC0           MOV    ES,AX 
12B3:0BC5 57             PUSH   DI 
12B3:0BC6 AD           * LODSW
12B3:0BC7 84C0           TEST   AL,AL 
12B3:0BC9 7410           JZ     0BDB 
12B3:0BCB AB             STOSW   
12B3:0BCC 84E4           TEST   AH,AH 
12B3:0BCE 740C           JZ     0BDC 
12B3:0BD0 AD             LODSW   
12B3:0BD1 84C0           TEST   AL,AL 
12B3:0BD3 7406           JZ     0BDB 
12B3:0BD5 AB             STOSW   
12B3:0BD6 84E4           TEST   AH,AH 
12B3:0BD8 75EC           JNZ    0BC6 
12B3:0BDA A8AA         * TEST   AL,AA
12B3:0BDC 5F             POP    DI 
12B3:0BDD 89F8           MOV    AX,DI 
12B3:0BDF 07             POP    ES 
12B3:0BE0 5F             POP    DI 
12B3:0BE1 5E             POP    SI 
12B3:0BE2 C3             RET     

; -----------------------------------------------------------------------------
;        nalezen¡ parametru prost©ed¡ AX (v˜stup AX=adresa textu parametru)
; -----------------------------------------------------------------------------

12B3:0BE3 53             PUSH   BX
12B3:0BE4 51             PUSH   CX 
12B3:0BE5 52             PUSH   DX 
12B3:0BE6 56             PUSH   SI 
12B3:0BE7 57             PUSH   DI 
12B3:0BE8 06             PUSH   ES 
12B3:0BE9 55             PUSH   BP 
12B3:0BEA 89E5           MOV    BP,SP 
12B3:0BEC 50             PUSH   AX 
12B3:0BED 8B363006       MOV    SI,[0630]   ; tabulka adres parametr– prost©ed¡
12B3:0BF1 85F6           TEST   SI,SI 
12B3:0BF3 743F           JZ     0C34
12B3:0BF5 85C0           TEST   AX,AX       ; je nˆjak˜ ©etˆzec ?
12B3:0BF7 743B           JZ     0C34        ; nen¡ ‘ dn˜ ©etˆzec

; ------ zji¨tˆn¡ d‚lky hledan‚ho jm‚na parametru

12B3:0BF9 89C7           MOV    DI,AX       ; adresa ©etˆzce
12B3:0BFB 8CD8           MOV    AX,DS
12B3:0BFD 8EC0           MOV    ES,AX       ; ES <- DS
12B3:0BFF B9FFFF         MOV    CX,FFFF
12B3:0C02 31C0           XOR    AX,AX 
12B3:0C04 F2             REPNZ  
12B3:0C05 AE             SCASB              ; nalezen¡ koncov‚ 0 ©etˆzce
12B3:0C06 F7D1           NOT    CX 
12B3:0C08 49             DEC    CX          ; d‚lka
12B3:0C09 89CF           MOV    DI,CX       ; d‚lka ©etˆzce
12B3:0C0B EB21           JMP    0C2E 

; ------ porovn n¡ jm‚na parametru prost©ed¡

12B3:0C0D 89CB         * MOV    BX,CX       ; adresa referen‡n¡ho ©etˆzec
12B3:0C0F 01FB           ADD    BX,DI       ; p©¡padn˜ konec z hlav¡ v ©etˆzci
12B3:0C11 803F3D         CMP    Byte Ptr [BX],3D ; je oddˆlova‡ "=" ?
12B3:0C14 7515           JNZ    0C2B        ; nen¡ - ©etˆzec nesouhlas¡
12B3:0C16 89C8           MOV    AX,CX       ; text 1
12B3:0C18 8B56FE         MOV    DX,[BP-02]  ; text 2
12B3:0C1B 89FB           MOV    BX,DI       ; d‚lka
12B3:0C1D E83809         CALL   1558        ; porovn n¡ text– ASCIIZ (jm‚no)
12B3:0C20 85C0           TEST   AX,AX       ; souhlas¡ jm‚no promˆnn‚ ?
12B3:0C22 7507           JNZ    0C2B        ; nesouhlas¡
12B3:0C24 8D4501         LEA    AX,[DI+01]  ; offset za‡ tku textu parametru
12B3:0C27 01C8           ADD    AX,CX       ; adresa za‡ tku texty parametru
12B3:0C29 EB0B           JMP    0C36 

; ------ dal¨¡ parametr prost©ed¡

12B3:0C2B 83C602       * ADD    SI,+02      ; zv˜¨en¡ ukazatele v tabulce
12B3:0C2E 8B0C         * MOV    CX,[SI]     ; adresa ©etˆzce
12B3:0C30 85C9           TEST   CX,CX       ; je ji‘ 0 ?
12B3:0C32 75D9           JNZ    0C0D        ; je dal¨¡ ©etˆzec

12B3:0C34 31C0         * XOR    AX,AX
12B3:0C36 89EC           MOV    SP,BP 
12B3:0C38 5D             POP    BP 
12B3:0C39 07             POP    ES 
12B3:0C3A 5F             POP    DI 
12B3:0C3B 5E             POP    SI 
12B3:0C3C 5A             POP    DX 
12B3:0C3D 59             POP    CX 
12B3:0C3E 5B             POP    BX 
12B3:0C3F C3             RET

; -----------------------------------------------------------------------------
;        Dek¢dov n¡ textu parametru FOXPROSWX (AX=buffer, DX=text, BX=d‚lka)
; -----------------------------------------------------------------------------

12B3:0C40 51             PUSH   CX
12B3:0C41 56             PUSH   SI 
12B3:0C42 57             PUSH   DI 
12B3:0C43 06             PUSH   ES 
12B3:0C44 55             PUSH   BP 
12B3:0C45 89E5           MOV    BP,SP 
12B3:0C47 50             PUSH   AX 

12B3:0C48 89D9           MOV    CX,BX       ; d‚lka textu
12B3:0C4A 39C2           CMP    DX,AX       ; je nˆjak˜ text ?
12B3:0C4C 7438           JZ     0C86        ; nen¡ ‘ dn˜ text
12B3:0C4E 7322           JNB    0C72 

12B3:0C50 89D6           MOV    SI,DX       ; adresa textu parametru
12B3:0C52 01CE           ADD    SI,CX       ; adresa konce textu parametru
12B3:0C54 39C6           CMP    SI,AX       ; je konec ?
12B3:0C56 761A           JBE    0C72        ; nen¡ konec
12B3:0C58 4E             DEC    SI 
12B3:0C59 89C7           MOV    DI,AX 
12B3:0C5B 01CF           ADD    DI,CX 
12B3:0C5D 4F             DEC    DI 
12B3:0C5E 8CD8           MOV    AX,DS 
12B3:0C60 8EC0           MOV    ES,AX 
12B3:0C62 FD             STD     
12B3:0C63 4E             DEC    SI 
12B3:0C64 4F             DEC    DI 
12B3:0C65 D1E9           SHR    CX,1 
12B3:0C67 F3             REPZ   
12B3:0C68 A5             MOVSW              ; p©enos textu
12B3:0C69 11C9           ADC    CX,CX 
12B3:0C6B 46             INC    SI 
12B3:0C6C 47             INC    DI 
12B3:0C6D F3             REPZ   
12B3:0C6E A4             MOVSB   
12B3:0C6F FC             CLD     
12B3:0C70 EB11           JMP    0C83 

12B3:0C72 8CD8         * MOV    AX,DS
12B3:0C74 8B7EFE         MOV    DI,[BP-02] 
12B3:0C77 8EC0           MOV    ES,AX 
12B3:0C79 89D6           MOV    SI,DX 
12B3:0C7B D1E9           SHR    CX,1 
12B3:0C7D F3             REPZ   
12B3:0C7E A5             MOVSW   
12B3:0C7F 11C9           ADC    CX,CX 
12B3:0C81 F3             REPZ   
12B3:0C82 A4             MOVSB   

12B3:0C83 8B46FE         MOV    AX,[BP-02]

12B3:0C86 89EC         * MOV    SP,BP
12B3:0C88 5D             POP    BP 
12B3:0C89 07             POP    ES 
12B3:0C8A 5F             POP    DI 
12B3:0C8B 5E             POP    SI 
12B3:0C8C 59             POP    CX 
12B3:0C8D C3             RET     


12B3:0C8E 51             PUSH   CX
12B3:0C8F 56             PUSH   SI 
12B3:0C90 57             PUSH   DI 
12B3:0C91 06             PUSH   ES 
12B3:0C92 89C6           MOV    SI,AX 
12B3:0C94 89D7           MOV    DI,DX 
12B3:0C96 8CD8           MOV    AX,DS 
12B3:0C98 8EC0           MOV    ES,AX 
12B3:0C9A A6             CMPSB   
12B3:0C9B 7511           JNZ    0CAE 
12B3:0C9D 4F             DEC    DI 
12B3:0C9E 4E             DEC    SI 
12B3:0C9F B9FFFF         MOV    CX,FFFF 
12B3:0CA2 31C0           XOR    AX,AX 
12B3:0CA4 F2             REPNZ  
12B3:0CA5 AE             SCASB   
12B3:0CA6 F7D1           NOT    CX 
12B3:0CA8 29CF           SUB    DI,CX 
12B3:0CAA F3             REPZ   
12B3:0CAB A6             CMPSB   
12B3:0CAC 7405           JZ     0CB3 
12B3:0CAE 19C0           SBB    AX,AX 
12B3:0CB0 1DFFFF         SBB    AX,FFFF 
12B3:0CB3 07             POP    ES 
12B3:0CB4 5F             POP    DI 
12B3:0CB5 5E             POP    SI 
12B3:0CB6 59             POP    CX 
12B3:0CB7 C3             RET     

; -----------------------------------------------------------------------------
;        p©id n¡ textu DS:DX k textu DS:AX
; -----------------------------------------------------------------------------

12B3:0CB8 51           * PUSH   CX
12B3:0CB9 56             PUSH   SI 
12B3:0CBA 57             PUSH   DI 
12B3:0CBB 06             PUSH   ES 
12B3:0CBC 89C7           MOV    DI,AX       ; adresa bufferu k ulo‘en¡
12B3:0CBE 89D6           MOV    SI,DX       ; adresa textu k p©enesen¡
12B3:0CC0 57             PUSH   DI          ; adresa bufferu
12B3:0CC1 8CD8           MOV    AX,DS 
12B3:0CC3 8EC0           MOV    ES,AX       ; ES <- DS

; ------ nalezen¡ konce textu v c¡lov‚m bufferu

12B3:0CC5 B9FFFF         MOV    CX,FFFF
12B3:0CC8 31C0           XOR    AX,AX 
12B3:0CCA F2             REPNZ  
12B3:0CCB AE             SCASB              ; nalezen¡ konce textu
12B3:0CCC 4F             DEC    DI          ; n vrat posledn¡ 0 textu

; ------ p©enesen¡ 2 znak–

12B3:0CCD AD           * LODSW              ; na‡ten¡ 2 znak–
12B3:0CCE 84C0           TEST   AL,AL 
12B3:0CD0 7410           JZ     0CE2        ; konec textu - bajt 0 se ulo‘¡
12B3:0CD2 AB             STOSW              ; ulo‘en¡ obou znak–
12B3:0CD3 84E4           TEST   AH,AH       ; byl druh˜ znak 0 ?
12B3:0CD5 740C           JZ     0CE3        ; byl 0 a je ji‘ ulo‘en

12B3:0CD7 AD             LODSW              ; na‡ten¡ dal¨¡ch 2 znak–
12B3:0CD8 84C0           TEST   AL,AL       ; je 0 ?
12B3:0CDA 7406           JZ     0CE2        ; je 0 a p©enese se
12B3:0CDC AB             STOSW              ; ulo‘en¡ dal¨¡ch 2 znak–
12B3:0CDD 84E4           TEST   AH,AH       ; nyla 0 ?
12B3:0CDF 75EC           JNZ    0CCD        ; nebyla 0

;12B3:0CE1 A8AA           TEST   AL,AA      ; tady se ji‘ nic neulo‘¡

12B3:0CE2 AA           * STOSB
12B3:0CE3 5F           * POP    DI
12B3:0CE4 89F8           MOV    AX,DI       ; adresa c¡lov‚ho bufferu
12B3:0CE6 07             POP    ES 
12B3:0CE7 5F             POP    DI 
12B3:0CE8 5E             POP    SI 
12B3:0CE9 59             POP    CX 
12B3:0CEA C3             RET     

; -----------------------------------------------------------------------------
;        vymaz n¡ bufferu DS:AX (BX=po‡et bajt–, DL=mazac¡ bajt)
; -----------------------------------------------------------------------------

12B3:0CEB 51             PUSH   CX
12B3:0CEC 57             PUSH   DI 
12B3:0CED 06             PUSH   ES 
12B3:0CEE 89C7           MOV    DI,AX       ; offset adresy bufferu
12B3:0CF0 88D0           MOV    AL,DL       ; mazac¡ znak
12B3:0CF2 89D9           MOV    CX,BX       ; po‡et bajt–
12B3:0CF4 57             PUSH   DI 
12B3:0CF5 1E             PUSH   DS 
12B3:0CF6 07             POP    ES
12B3:0CF7 88C4           MOV    AH,AL       ; mazac¡ znak
12B3:0CF9 D1E9           SHR    CX,1        ; p©evod na slova
12B3:0CFB F2             REPNZ  
12B3:0CFC AB             STOSW              ; vymaz n¡ bufferu slovy
12B3:0CFD 11C9           ADC    CX,CX       ; lich˜ bajt
12B3:0CFF F2             REPNZ  
12B3:0D00 AA             STOSB              ; vymaz n¡ lich˜m bajtem
12B3:0D01 5F             POP    DI 
12B3:0D02 89F8           MOV    AX,DI       ; adresa bufferu
12B3:0D04 07             POP    ES 
12B3:0D05 5F             POP    DI 
12B3:0D06 59             POP    CX 
12B3:0D07 C3             RET     

; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°
;
;                            Start programu
;
; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°

;þ

12B3:0D08 E9CB00         JMP    0DD6

12B3:0D00  AA 5F 89 F8 07 5F 59 C3-E9 CB 00 57 41 54 43 4F  *_.x._YCiK.WATCO
12B3:0D10  4D 20 43 20 52 75 6E 2D-54 69 6D 65 20 73 79 73  M C Run-Time sys
12B3:0D20  74 65 6D 20 63 6F 64 65-20 69 73 20 70 72 6F 76  tem code is prov
12B3:0D30  69 64 65 64 20 6F 6E 20-61 6E 20 22 61 73 20 69  ided on an "as i
12B3:0D40  73 22 20 62 61 73 69 73-20 61 6E 64 20 69 73 20  s" basis and is 
12B3:0D50  28 63 29 20 43 6F 70 79-72 69 67 68 74 20 62 79  (c) Copyright by
12B3:0D60  20 57 41 54 43 4F 4D 20-53 79 73 74 65 6D 73 20   WATCOM Systems 
12B3:0D70  49 6E 63 2E 20 31 39 38-38 2C 20 31 39 38 39 2C  Inc. 1988, 1989,
12B3:0D80  20 31 39 39 30 2E 20 41-6C 6C 20 72 69 67 68 74   1990. All right
12B3:0D90  73 20 72 65 73 65 72 76-65 64 2E 0D 0A 2A 2A 2A  s reserved...***
12B3:0DA0  20 4E 55 4C 4C 20 61 73-73 69 67 6E 6D 65 6E 74   NULL assignment
12B3:0DB0  20 64 65 74 65 63 74 65-64 0D 0A 00 4E 6F 74 20   detected...Not 

12b3:0dbc     db   'Not enough memory',13,10,0
12b3:0DD0     db   'con',0,0,0

; ------ inicializace segment– a ukazatel–

12B3:0DD6 FB           * STI
12B3:0DD7 B93214         MOV    CX,1432     ; datov˜ segment
12B3:0DDA BB9008         MOV    BX,0890     ; d‚lka datov‚ho segmentu
12B3:0DDD 8EC1           MOV    ES,CX       ; datov˜ segment
12B3:0DDF 268C1ECA05     MOV    ES:[05CA],DS ; £schova PSP
12B3:0DE4 03DC           ADD    BX,SP       ; p©i‡ten¡ velikosti z sobn¡ku 800h
12B3:0DE6 8ED1           MOV    SS,CX       ; z sobn¡k v datov‚m segmentu
12B3:0DE8 8BE3           MOV    SP,BX       ; konec z sobn¡ku
12B3:0DEA 26891ED205     MOV    ES:[05D2],BX ; offset konce datov‚ho segmentu

; ------ kontrola voln‚ pamˆti

12B3:0DEF 83C30F         ADD    BX,+0F      ; zaokrouhlen¡ na odstavec
12B3:0DF2 83E3F0         AND    BX,0FFF0h   ; zarovn n¡ na odstavec
12B3:0DF5 8BD3           MOV    DX,BX       ; konec datov‚ho segmentu
12B3:0DF7 D1EA           SHR    DX,1 
12B3:0DF9 D1EA           SHR    DX,1 
12B3:0DFB D1EA           SHR    DX,1 
12B3:0DFD D1EA           SHR    DX,1        ; velikost segmentu v odstavc¡ch
12B3:0DFF 8B0E0200       MOV    CX,[0002]   ; segment konce aloka‡n¡ho bloku
12B3:0E03 8CC0           MOV    AX,ES       ; datov˜ segment
12B3:0E05 2BC8           SUB    CX,AX       ; voln‚ m¡sto s datov˜m segmentem
12B3:0E07 3BD1           CMP    DX,CX       ; je m¡sto pro datov˜ segment ?
12B3:0E09 720B           JB     0E16        ; je dost m¡sta pro datov˜ segment

; ------ chyba - nedostatek pamˆti

12B3:0E0B BB0100         MOV    BX,0001     ; n vratov˜ k¢d
12B3:0E0E B8BC0D         MOV    AX,0DBC     ; text "Nedostatek pamˆti"
12B3:0E11 8CCA           MOV    DX,CS
12B3:0E13 E91801         JMP    0F2E        ; konec programu s chybov˜m hl ¨en¡m

; ------ konec datov‚ho segmentu

12B3:0E16 8CC0         * MOV    AX,ES       ; datov˜ segment
12B3:0E18 8BDA           MOV    BX,DX       ; velikost dat. segm. v odstavc¡ch
12B3:0E1A D1E3           SHL    BX,1 
12B3:0E1C D1E3           SHL    BX,1 
12B3:0E1E D1E3           SHL    BX,1 
12B3:0E20 D1E3           SHL    BX,1        ; velikost dat. segmentu v bajtech
12B3:0E22 7503           JNZ    0E27        ; nen¡ 1000h
12B3:0E24 BBFEFF         MOV    BX,FFFE     ; omezen¡ na 0fffeh
12B3:0E27 26891EC805   * MOV    ES:[05C8],BX ; zarovnan˜ konec datov‚ho segmentu

; ------ zmen¨en¡ pamˆŸov‚ho bloku programu na minimum

12B3:0E2C 8BDA           MOV    BX,DX       ; offset konce datov‚ho segmentu
12B3:0E2E 03D8           ADD    BX,AX       ; p©i‡ten¡ CS = adresa konce segm.
12B3:0E30 26A1CA05       MOV    AX,ES:[05CA] ; segment PSP
12B3:0E34 8EC0           MOV    ES,AX       ; segment PSP
12B3:0E36 2BD8           SUB    BX,AX       ; velikost programu s daty
12B3:0E38 B44A           MOV    AH,4A
12B3:0E3A CD21           INT    21          ; zmen¨en¡ bloku na minimum

; ------ nalezen¡ za‡ tku textu v p©¡kazov‚m © dku

12B3:0E3C BF8100         MOV    DI,0081     ; za‡ tek textu p©¡kazov‚ho © dku
12B3:0E3F 8A4DFF         MOV    CL,[DI-01]  ; d‚lka textu p©¡kazov‚ho © dku
12B3:0E42 B500           MOV    CH,00
12B3:0E44 FC             CLD     
12B3:0E45 B020           MOV    AL,20
12B3:0E47 F3AE           REPE   SCASB       ; nalezen¡ za‡ tku textu

; ------ p©enesen¡ textu z p©¡kazov‚ho © dku do bufferu

12B3:0E49 8D75FF         LEA    SI,[DI-01]  ; za‡ tek zadan‚ho textu
12B3:0E4C BA3214         MOV    DX,1432     ; datov˜ segment
12B3:0E4F 8EC2           MOV    ES,DX       ; datov˜ segment
12B3:0E51 BF9008         MOV    DI,0890     ; buffer textu z p©¡kaz. © dku
12B3:0E54 7403           JZ     0E59        ; ‘ dn˜ text nebyl nalezen
12B3:0E56 41             INC    CX 
12B3:0E57 F3             REPZ   
12B3:0E58 A4             MOVSB              ; p©esun textu do bufferu

; ------ ozna‡en¡ konce textu v p©¡kazov‚m © dku

12B3:0E59 2AC0         * SUB    AL,AL       ; AL <- koncov  0
12B3:0E5B AA             STOSB              ; ozna‡en¡ konce textu
12B3:0E5C B000           MOV    AL,00 
12B3:0E5E AA             STOSB
12B3:0E5F 4F             DEC    DI          ; konec za textem z p©¡kaz. © dku

; ------ zji¨tˆn¡ verze syst‚mu

12B3:0E60 B430           MOV    AH,30                         ;'0' 
12B3:0E62 CD21           INT    21 
12B3:0E64 26A2CC05       MOV    ES:[05CC],AL ; verze syst‚mu
12B3:0E68 268826CD05     MOV    ES:[05CD],AH ; podverze syst‚mu

; ------ kontrola verze syst‚mu

12B3:0E6D 8BCF           MOV    CX,DI       ; konec za zadan˜m textem
12B3:0E6F 3C03           CMP    AL,03       ; je verze syst‚mu alespo¤ 3.xx ?
12B3:0E71 722F           JB     0EA2        ; je n¡zk  verze syst‚mu

; ------ bude prohled v no prost©ed¡

12B3:0E73 8E1E2C00       MOV    DS,[002C]   ; segment prost©ed¡
12B3:0E77 2BF6           SUB    SI,SI       ; SI <- 0
12B3:0E79 33ED           XOR    BP,BP       ; BP <- 0 p©¡znak parametru "NO87"

; ------ test, zda je parametr "NO87"

12B3:0E7B 8B04         * MOV    AX,[SI]     ; prvn¡ 2 znaky z prost©ed¡
12B3:0E7D 0D2020         OR     AX,2020     ; p©evod na mal  p¡smena
12B3:0E80 3D6E6F         CMP    AX,6F6E     ; je text "NO" ?
12B3:0E83 7509           JNZ    0E8E        ; nen¡ text "NO"
12B3:0E85 8B4402         MOV    AX,[SI+02]  ; dal¨¡ 2 znaky z prost©ed¡
12B3:0E88 3D3837         CMP    AX,3738     ; je text "NO87" ?
12B3:0E8B 7501           JNZ    0E8E        ; nen¡ text "NO87"

12B3:0E8D 45             INC    BP          ; p©¡znak parametru "NO87"

; ------ nalezen¡ konce prost©ed¡

12B3:0E8E 803C00       * CMP    Byte Ptr [SI],00 ; je konec ©etˆzce ?
12B3:0E91 AC             LODSB
12B3:0E92 75FA           JNZ    0E8E        ; nalezen¡ konce ©etˆzce
12B3:0E94 803C00         CMP    Byte Ptr [SI],00 ; byl to posledn¡ ©etˆzec ?
12B3:0E97 75E2           JNZ    0E7B        ; nen¡ posledn¡ - dal¨¡ ©etˆzec
12B3:0E99 AC             LODSB              ; p©esko‡en¡ posledn¡ 0

; ------ p©enesen¡ jm‚na programu z prost©ed¡

12B3:0E9A 46             INC    SI 
12B3:0E9B 46             INC    SI          ; p©esko‡en¡ po‡tu ©etˆzc–
12B3:0E9C 803C00       * CMP    Byte Ptr [SI],00
12B3:0E9F A4             MOVSB   
12B3:0EA0 75FA           JNZ    0E9C        ; p©enesen¡ textu do bufferu

; ------ £schova registr–

12B3:0EA2 8BF1         * MOV    SI,CX       ; adresa za‡ tku jm‚na programu
12B3:0EA4 26A1CA05       MOV    AX,ES:[05CA] ; segment PSP
12B3:0EA8 8EC0           MOV    ES,AX       ; segment PSP
12B3:0EAA 8BDC           MOV    BX,SP       ; konec z sobn¡ku
12B3:0EAC BA3214         MOV    DX,1432     ; datov˜ segment
12B3:0EAF 8EDA           MOV    DS,DX       ; datov˜ segment
12B3:0EB1 8EC2           MOV    ES,DX       ; datov˜ segment
12B3:0EB3 892ED605       MOV    [05D6],BP   ; p©¡znak parametru "NO87"
12B3:0EB7 893ED005       MOV    [05D0],DI   ; konec bufferu se jm‚nem programu
12B3:0EBB 891EC605       MOV    [05C6],BX   ; uschovan˜ registr SP

; ------ vymaz n¡ bufferu

12B3:0EBF B98408         MOV    CX,0884     ; konec bufferu
12B3:0EC2 BF7606         MOV    DI,0676     ; za‡ tek bufferu
12B3:0EC5 2BCF           SUB    CX,DI       ; d‚lka (020eh bajt–)
12B3:0EC7 B000           MOV    AL,00 
12B3:0EC9 F3             REPZ   
12B3:0ECA AA             STOSB              ; vymaz n¡ bufferu


12B3:0ECB 833ED80500     CMP    Word Ptr [05D8],+00 ; byla ji‘ inicializace ?
12B3:0ED0 7511           JNZ    0EE3 
12B3:0ED2 B8710F         MOV    AX,0F71     ; obsluha
12B3:0ED5 A3D805         MOV    [05D8],AX 
12B3:0ED8 8C0EDA05       MOV    [05DA],CS 
12B3:0EDC A3DC05         MOV    [05DC],AX 
12B3:0EDF 8C0EDE05       MOV    [05DE],CS 

12B3:0EE3 B8700F       * MOV    AX,0F70
12B3:0EE6 A3E005         MOV    [05E0],AX 
12B3:0EE9 8C0EE205       MOV    [05E2],CS 
12B3:0EED 2E8C1ED40D     MOV    CS:[0DD4],DS

12B3:0EF2 B87606         MOV    AX,0676     ; adresa obsluhy EMS
12B3:0EF5 3D7606         CMP    AX,0676 
12B3:0EF8 7406           JZ     0F00 

12B3:0EFA FF167606       CALL   [0676]      ; adresa obsluhy EMS
12B3:0EFE EB00           JMP    0F00 

12B3:0F00 E86F00       * CALL   0F72        ; vytvo©en¡ tabulky prost©ed¡ EMS
12B3:0F03 B89008         MOV    AX,0890     ; offset p©¡kazov‚ho © dku
12B3:0F06 8CD2           MOV    DX,SS       ; segment p©¡kazov‚ho © dku
12B3:0F08 8BDE           MOV    BX,SI       ; adresa jm‚na programu
12B3:0F0A 8CD1           MOV    CX,SS       ; segment jm‚na programu
12B3:0F0C E89006         CALL   159F        ; start hlavn¡ procedury MAIN

; ------ kontrola identifik tor– soubor– p©i n vratu

12B3:0F0F 50             PUSH   AX          ; n vratov˜ k¢d
12B3:0F10 BA3214         MOV    DX,1432     ; datov˜ segment
12B3:0F13 8EDA           MOV    DS,DX       ; datov˜ segment
12B3:0F15 FC             CLD
12B3:0F16 8D3E0000       LEA    DI,[0000]   ; za‡ tek datov‚ho segmentu
12B3:0F1A 8EC2           MOV    ES,DX       ; datov˜ segment
12B3:0F1C B91000         MOV    CX,0010     ; d‚lka tabulky soubor–
12B3:0F1F B80101         MOV    AX,0101 
12B3:0F22 F3             REPZ   
12B3:0F23 AF             SCASW              ; jsou v¨echny idnetifik. 1 ?
12B3:0F24 58             POP    AX          ; n vratov˜ k¢d programu
12B3:0F25 7430           JZ     0F57        ; konec programu OK

; ------ chyba - neuzav©en˜ soubor

12B3:0F27 8BD8           MOV    BX,AX
12B3:0F29 B89B0D         MOV    AX,0D9B     ; text "***NULL assignment detected"
12B3:0F2C 8CCA           MOV    DX,CS 

; -----------------------------------------------------------------------------
;        n vrat z programu s chybov˜m hl ¨en¡m
; -----------------------------------------------------------------------------
; VSTUP: BL=n vratov˜ k¢d
;        DX:AX=text k zobrazen¡
; -----------------------------------------------------------------------------

12B3:0F2E BC1009         MOV    SP,0910     ; pracovn¡ z sobn¡k

; ------ otev©en¡ za©¡zen¡ CON pro z pis

12B3:0F31 53             PUSH   BX          ; n vratov˜ k¢d
12B3:0F32 50             PUSH   AX          ; offset adresy chyby
12B3:0F33 52             PUSH   DX          ; segment adresy chyby
12B3:0F34 BAB312         MOV    DX,12B3     ; segment programu CS
12B3:0F37 8EDA           MOV    DS,DX       ; segment programu CS
12B3:0F39 BAD00D         MOV    DX,0DD0     ; jm‚no za©¡zen¡ "CON"
12B3:0F3C B8013D         MOV    AX,3D01
12B3:0F3F CD21           INT    21          ; otev©en¡ pro z pis
12B3:0F41 8BD8           MOV    BX,AX       ; identifik tor za©¡zen¡
12B3:0F43 1F             POP    DS          ;
12B3:0F44 5A             POP    DX          ; offset adresy chyby

; ------ zji¨tˆn¡ d‚lky textu k zobrazen¡

12B3:0F45 8BF2           MOV    SI,DX       ; adresa textu k zobrazen¡
12B3:0F47 FC             CLD     
12B3:0F48 AC           * LODSB              ; na‡ten¡ znaku textu
12B3:0F49 3C00           CMP    AL,00
12B3:0F4B 75FB           JNZ    0F48        ; nalezen¡ konce textu
12B3:0F4D 8BCE           MOV    CX,SI       ; konec textu
12B3:0F4F 2BCA           SUB    CX,DX       ; d‚lka textu
12B3:0F51 49             DEC    CX

; ------ zobrazen¡ chybov‚ho textu

12B3:0F52 B440           MOV    AH,40
12B3:0F54 CD21           INT    21          ; z pis na konzolu

; ------ konec programu

12B3:0F56 58             POP    AX          ; n vratov˜ k¢d

12B3:0F57 BA0600         MOV    DX,0006     ;
12B3:0F5A 81FA0600       CMP    DX,0006 
12B3:0F5E 7406           JZ     0F66 

12B3:0F60 50             PUSH   AX
12B3:0F61 FF167806       CALL   [0678] 
12B3:0F65 58             POP    AX 

12B3:0F66 B44C         * MOV    AH,4C                         ;'L'
12B3:0F68 CD21           INT    21 

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

12B3:0F6A 2E8E1ED40D     MOV    DS,CS:[0DD4]
12B3:0F6F C3             RET     

12B3:0F70 CB             RETF


12B3:0F71 CB             RETF

; -----------------------------------------------------------------------------
;        obsluha vytvo©en¡ tabulky prost©ed¡
; -----------------------------------------------------------------------------

12B3:0F72 56             PUSH   SI
12B3:0F73 BE7406         MOV    SI,0674 
12B3:0F76 BF7606         MOV    DI,0676     ; adresa obsluhy EMS
12B3:0F79 3BF7         * CMP    SI,DI
12B3:0F7B 730C           JAE    0F89
12B3:0F7D 4F             DEC    DI 
12B3:0F7E 4F             DEC    DI 
12B3:0F7F 8B05           MOV    AX,[DI] 
12B3:0F81 0BC0           OR     AX,AX 
12B3:0F83 74F4           JZ     0F79 
12B3:0F85 FFD0           CALL   AX          ; vytvo©en¡ tabulky prost©ed¡
12B3:0F87 EBF0           JMP    0F79 
12B3:0F89 5E           * POP    SI
12B3:0F8A C3             RET

; -----------------------------------------------------------------------------
;        £schova segmentov˜ch registr– do bufferu DS:BX
; -----------------------------------------------------------------------------

12B3:0F8B 53             PUSH   BX 
12B3:0F8C 89C3           MOV    BX,AX       ; offset bufferu
12B3:0F8E 8CC8           MOV    AX,CS 
12B3:0F90 894702         MOV    [BX+02],AX  ; CS
12B3:0F93 8CD8           MOV    AX,DS 
12B3:0F95 894706         MOV    [BX+06],AX  ; DS
12B3:0F98 8CC0           MOV    AX,ES 
12B3:0F9A 8907           MOV    [BX],AX     ; ES
12B3:0F9C 8CD0           MOV    AX,SS 
12B3:0F9E 894704         MOV    [BX+04],AX  ; SS
12B3:0FA1 5B             POP    BX 
12B3:0FA2 C3             RET     

; -----------------------------------------------------------------------------
;        vol n¡ p©eru¨en¡ ‡¡slo AX (DS:DX=vstupn¡ tabulka registr–, BX=v˜stupn¡)
;        (DS:CX=tabulka segmentov˜ch registr–)
; -----------------------------------------------------------------------------
; 00h: AX                   00h: ES
; 02h: BX                   02h: CS
; 04h: CX                   04h: SS
; 06h: DX                   06h: DS
; 08h: SI
; 0ah: DI
; -----------------------------------------------------------------------------

12B3:0FA3 56             PUSH   SI
12B3:0FA4 57             PUSH   DI 
12B3:0FA5 55             PUSH   BP 
12B3:0FA6 89E5           MOV    BP,SP 
12B3:0FA8 53             PUSH   BX          ; v˜stupn¡ tabulka registr–
12B3:0FA9 89CB           MOV    BX,CX 
12B3:0FAB 89C6           MOV    SI,AX       ; ‡¡slo p©eru¨en¡
12B3:0FAD 89D7           MOV    DI,DX       ; offset adresy tabulky registr–
12B3:0FAF 8B56FE         MOV    DX,[BP-02]  ; v˜stupn¡ tabulka registr–
12B3:0FB2 55             PUSH   BP 
12B3:0FB3 06             PUSH   ES 
12B3:0FB4 53             PUSH   BX 
12B3:0FB5 1E             PUSH   DS 
12B3:0FB6 52             PUSH   DX          ;
12B3:0FB7 8CDA           MOV    DX,DS       ; segment tabulky registr–
12B3:0FB9 8E07           MOV    ES,[BX]
12B3:0FBB 8B6F06         MOV    BP,[BX+06]  ; po‘adovan  hodnota registru DS

; ------ nastaven¡ ukazatele na adresu p©eru¨en¡

12B3:0FBE 2BC0           SUB    AX,AX       ; AX <- 0
12B3:0FC0 8ED8           MOV    DS,AX       ; DS <- 0
12B3:0FC2 D1E6           SHL    SI,1 
12B3:0FC4 D1E6           SHL    SI,1        ; ‡¡slo p©eru¨en¡ * 4
12B3:0FC6 EB1C           JMP    0FE4 

; ------ vol n¡ p©eru¨en¡ - nastaven¡ registr– podle tabulky

12B3:0FC8 FF7402         PUSH   [SI+02]     ; segment adresy p©eru¨en¡
12B3:0FCB FF34           PUSH   [SI]        ; offset adresy p©eru¨en¡
12B3:0FCD 8EDA           MOV    DS,DX       ; segment tabulky registr–
12B3:0FCF 8B05           MOV    AX,[DI]     ; AX
12B3:0FD1 8B5D02         MOV    BX,[DI+02]  ; BX
12B3:0FD4 8B4D04         MOV    CX,[DI+04]  ; CX
12B3:0FD7 8B5506         MOV    DX,[DI+06]  ; DX
12B3:0FDA 8B7508         MOV    SI,[DI+08]  ; SI
12B3:0FDD 8B7D0A         MOV    DI,[DI+0A]  ; DI
12B3:0FE0 8EDD           MOV    DS,BP       ; DS
12B3:0FE2 FA             CLI                ; z kaz p©eru¨en¡
12B3:0FE3 CB             RETF               ; skok do p©eru¨en¡

; ------ vol n¡ p©eru¨en¡

12B3:0FE4 9C             PUSHF              ; p©ednastaven¡ pro IRET
12B3:0FE5 0E             PUSH   CS          ; simulace CALL FAR
12B3:0FE6 E8DFFF         CALL   0FC8        ; vol n¡ obsluhy p©eru¨en¡

; ------ ulo‘en¡ registr– do v˜stupn¡ tabulky registr–

12B3:0FE9 1E             PUSH   DS
12B3:0FEA 57             PUSH   DI
12B3:0FEB 89E5           MOV    BP,SP
12B3:0FED 8B7E04         MOV    DI,[BP+04]  ; v˜stupn¡ tabulka registr–
12B3:0FF0 8E5E06         MOV    DS,[BP+06]  ; datov˜ segment
12B3:0FF3 8905           MOV    [DI],AX 
12B3:0FF5 895D02         MOV    [DI+02],BX 
12B3:0FF8 894D04         MOV    [DI+04],CX 
12B3:0FFB 895506         MOV    [DI+06],DX 
12B3:0FFE 897508         MOV    [DI+08],SI 
12B3:1001 8F450A         POP    [DI+0A]     ; DI
12B3:1004 58             POP    AX
12B3:1005 5B             POP    BX 
12B3:1006 5B             POP    BX 
12B3:1007 5B             POP    BX 
12B3:1008 894706         MOV    [BX+06],AX 
12B3:100B 8C07           MOV    [BX],ES 
12B3:100D 1BC0           SBB    AX,AX 
12B3:100F 07             POP    ES 
12B3:1010 5D             POP    BP 
12B3:1011 8B5EFE         MOV    BX,[BP-02] 
12B3:1014 89470C         MOV    [BX+0C],AX 
12B3:1017 8B07           MOV    AX,[BX] 
12B3:1019 89EC           MOV    SP,BP 
12B3:101B 5D             POP    BP 
12B3:101C 5F             POP    DI 
12B3:101D 5E             POP    SI 
12B3:101E C3             RET     

101f     db        0

; -----------------------------------------------------------------------------
;        kontrola z sobn¡ku (AX=velikost lok ln¡ch promˆnn˜ch)
; -----------------------------------------------------------------------------

12B3:1020 3BC4           CMP    AX,SP       ; v p©¡padˆ velk‚ho bufferu
12B3:1022 730B           JAE    102F        ; je p©ete‡en¡
12B3:1024 2BC4           SUB    AX,SP       ; posun z sobn¡ku o lok. pronmˆnn‚
12B3:1026 F7D8           NEG    AX          ; nov˜ konec z sobn¡ku
12B3:1028 3B06D005       CMP    AX,[05D0]   ; je kolize s koncem dat ?
12B3:102C 7601           JBE    102F        ; je kolize - hav rie
12B3:102E C3             RET     

12B3:102F 0E             PUSH   CS
12B3:1030 1F             POP    DS 
12B3:1031 BA3D10         MOV    DX,103D 
12B3:1034 B409           MOV    AH,09 
12B3:1036 CD21           INT    21          ; hl ¨en¡ - p©ete‡en¡ z sobn¡ku
12B3:1038 B8014C         MOV    AX,4C01 
12B3:103B CD21           INT    21          ; n vrat z programu s chybou

103d     db        'Stack overflow!',13,10,'$'

; -----------------------------------------------------------------------------
;        Sestaven¡ bufferu prost©ed¡ pro program
; -----------------------------------------------------------------------------

12B3:104F 56             PUSH   SI
12B3:1050 57             PUSH   DI 
12B3:1051 55             PUSH   BP 
12B3:1052 89E5           MOV    BP,SP 
12B3:1054 83EC06         SUB    SP,+06 
12B3:1057 89C6           MOV    SI,AX 
12B3:1059 895EFC         MOV    [BP-04],BX 
12B3:105C 894EFA         MOV    [BP-06],CX 
12B3:105F 85D2           TEST   DX,DX 
12B3:1061 7504           JNZ    1067 
12B3:1063 8B163006       MOV    DX,[0630]   ; tabulka adres ©etˆzc– prost©ed¡
12B3:1067 C746FE0000   * MOV    Word Ptr [BP-02],0000
12B3:106C 85D2           TEST   DX,DX 
12B3:106E 7414           JZ     1084 
12B3:1070 89D3           MOV    BX,DX 
12B3:1072 EB0B           JMP    107F 
12B3:1074 8B07           MOV    AX,[BX] 
12B3:1076 E8F3FA         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX
12B3:1079 40             INC    AX 
12B3:107A 0146FE         ADD    [BP-02],AX 
12B3:107D 43             INC    BX 
12B3:107E 43             INC    BX 
12B3:107F 833F00         CMP    Word Ptr [BX],+00 
12B3:1082 75F0           JNZ    1074 

12B3:1084 FF46FE         INC    Word Ptr [BP-02]
12B3:1087 837E0A00       CMP    Word Ptr [BP+0A],+00 
12B3:108B 740B           JZ     1098 
12B3:108D 8B04           MOV    AX,[SI] 
12B3:108F E8DAFA         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX
12B3:1092 83C003         ADD    AX,+03 
12B3:1095 0146FE         ADD    [BP-02],AX 
12B3:1098 8B0E3206       MOV    CX,[0632] 
12B3:109C C70632061000   MOV    Word Ptr [0632],0010 
12B3:10A2 8346FE0F       ADD    Word Ptr [BP-02],+0F 
12B3:10A6 8B46FE         MOV    AX,[BP-02] 
12B3:10A9 E8ED00         CALL   1199        ; vytvo©en¡ datov‚ho bloku velik. AX
12B3:10AC 85C0           TEST   AX,AX 
12B3:10AE 7528           JNZ    10D8 
12B3:10B0 8B46FE         MOV    AX,[BP-02] 
12B3:10B3 E8E300         CALL   1199        ; vytvo©en¡ datov‚ho bloku velik. AX
12B3:10B6 89C3           MOV    BX,AX 
12B3:10B8 85C0           TEST   AX,AX 
12B3:10BA 751E           JNZ    10DA 
12B3:10BC E82005         CALL   15DF 
12B3:10BF 89C3           MOV    BX,AX 
12B3:10C1 C7070500       MOV    Word Ptr [BX],0005 
12B3:10C5 E81B05         CALL   15E3 
12B3:10C8 89C3           MOV    BX,AX 
12B3:10CA C7070800       MOV    Word Ptr [BX],0008 
12B3:10CE 890E3206       MOV    [0632],CX 
12B3:10D2 B8FFFF         MOV    AX,FFFF 
12B3:10D5 E9B900         JMP    1191 
12B3:10D8 89C3           MOV    BX,AX 
12B3:10DA 890E3206       MOV    [0632],CX 
12B3:10DE 8B7EFC         MOV    DI,[BP-04] 
12B3:10E1 891D           MOV    [DI],BX 
12B3:10E3 83C30F         ADD    BX,+0F 
12B3:10E6 80E3F0         AND    BL,F0 
12B3:10E9 8CD8           MOV    AX,DS 
12B3:10EB B104           MOV    CL,04 
12B3:10ED 89DF           MOV    DI,BX 
12B3:10EF D3EF           SHR    DI,CL 
12B3:10F1 89F9           MOV    CX,DI 
12B3:10F3 01C1           ADD    CX,AX 
12B3:10F5 8B7EFA         MOV    DI,[BP-06] 
12B3:10F8 890D           MOV    [DI],CX 
12B3:10FA 85D2           TEST   DX,DX 
12B3:10FC 741A           JZ     1118 
12B3:10FE 89D7           MOV    DI,DX 
12B3:1100 EB11           JMP    1113 
12B3:1102 8B15           MOV    DX,[DI] 
12B3:1104 89D8           MOV    AX,BX 
12B3:1106 E8B1FA         CALL   0BBA        ; kopie ©etˆzce ASCIIZ DX do AX
12B3:1109 31D2           XOR    DX,DX       ; hledan˜ bajt 0
12B3:110B E8D904         CALL   15E7        ; nalezen¡ znaku DL v textu DS:AX
12B3:110E 89C3           MOV    BX,AX 
12B3:1110 43             INC    BX 
12B3:1111 47             INC    DI 
12B3:1112 47             INC    DI 
12B3:1113 833D00         CMP    Word Ptr [DI],+00 
12B3:1116 75EA           JNZ    1102 
12B3:1118 C60700         MOV    Byte Ptr [BX],00 
12B3:111B 43             INC    BX 
12B3:111C 837E0A00       CMP    Word Ptr [BP+0A],+00 
12B3:1120 7408           JZ     112A 
12B3:1122 8B14           MOV    DX,[SI] 
12B3:1124 8D4702         LEA    AX,[BX+02] 
12B3:1127 E890FA         CALL   0BBA        ; kopie ©etˆzce ASCIIZ DX do AX
12B3:112A 8B5E08         MOV    BX,[BP+08] 
12B3:112D 43             INC    BX 
12B3:112E 833C00         CMP    Word Ptr [SI],+00 
12B3:1131 7446           JZ     1179 
12B3:1133 EB3C           JMP    1171 
12B3:1135 C60720         MOV    Byte Ptr [BX],20              ;' ' 
12B3:1138 43             INC    BX 
12B3:1139 89D0           MOV    AX,DX 
12B3:113B E82EFA         CALL   0B6C        ; zji¨tˆn¡ d‚lky textu ASCIIZ DS:AX
12B3:113E 01D8           ADD    AX,BX 
12B3:1140 2B4608         SUB    AX,[BP+08] 
12B3:1143 3D7E00         CMP    AX,007E 
12B3:1146 7E1D           JLE    1165 
12B3:1148 E89404         CALL   15DF 
12B3:114B 89C3           MOV    BX,AX 
12B3:114D C7070200       MOV    Word Ptr [BX],0002 
12B3:1151 E88F04         CALL   15E3 
12B3:1154 89C3           MOV    BX,AX 
12B3:1156 C7070A00       MOV    Word Ptr [BX],000A 
12B3:115A 8B5EFC         MOV    BX,[BP-04] 
12B3:115D 8B07           MOV    AX,[BX] 
12B3:115F E8FE01         CALL   1360        ; zru¨en¡ datov‚ho bufferu AX
12B3:1162 E96DFF         JMP    10D2 
12B3:1165 89D8           MOV    AX,BX 
12B3:1167 E850FA         CALL   0BBA        ; kopie ©etˆzce ASCIIZ DX do AX
12B3:116A 31D2           XOR    DX,DX       ; hledan˜ bajt 0
12B3:116C E87804         CALL   15E7        ; nalezen¡ znaku DL v textu DS:AX
12B3:116F 89C3           MOV    BX,AX 
12B3:1171 46             INC    SI 
12B3:1172 46             INC    SI 
12B3:1173 8B14           MOV    DX,[SI] 
12B3:1175 85D2           TEST   DX,DX 
12B3:1177 75BC           JNZ    1135 
12B3:1179 8A4608         MOV    AL,[BP+08] 
12B3:117C FEC0           INC    AL 
12B3:117E 88DC           MOV    AH,BL 
12B3:1180 28C4           SUB    AH,AL 
12B3:1182 8B7608         MOV    SI,[BP+08] 
12B3:1185 8824           MOV    [SI],AH 
12B3:1187 C6070D         MOV    Byte Ptr [BX],0D 
12B3:118A B104           MOV    CL,04 
12B3:118C 8B46FE         MOV    AX,[BP-02] 
12B3:118F D3E8           SHR    AX,CL 
12B3:1191 89EC           MOV    SP,BP 
12B3:1193 5D             POP    BP 
12B3:1194 5F             POP    DI 
12B3:1195 5E             POP    SI 
12B3:1196 C20400         RET    0004 

; -----------------------------------------------------------------------------
;        p©idˆlen¡ bufferu o velikosti AX (v˜stup AX=adresa, 0=nevytvo©en)
; -----------------------------------------------------------------------------

12B3:1199 53             PUSH   BX
12B3:119A 51             PUSH   CX 
12B3:119B 52             PUSH   DX 
12B3:119C 56             PUSH   SI 
12B3:119D 57             PUSH   DI 

12B3:119E 85C0           TEST   AX,AX       ; velikost po‘adovan‚ho bufferu
12B3:11A0 7452           JZ     11F4        ; nen¡ nic po‘adov no - konec

; ------ zaokrouhlen¡ velikosti bufferu

12B3:11A2 89C2           MOV    DX,AX       ; velikost bufferu
12B3:11A4 83C203         ADD    DX,+03      ; zaokrouhlen¡ + 1 slovo rezerva
12B3:11A7 80E2FE         AND    DL,FE       ; zarovn n¡
12B3:11AA 39C2           CMP    DX,AX       ; je p©ete‡en¡ velikosti ?
12B3:11AC 7246           JB     11F4        ; p©ete‡en¡ velikosti

; ------ minim ln¡ velikost bufferu bude 6 bajt– (pro popisova‡e bufferu)

12B3:11AE 83FA06         CMP    DX,+06      ; minim ln¡ velikost 6 bajt–
12B3:11B1 7303           JAE    11B6
12B3:11B3 BA0600         MOV    DX,0006     ; omezen¡ - minim lnˆ 6
12B3:11B6 31C9         * XOR    CX,CX

12B3:11B8 3B16F205       CMP    DX,[05F2]
12B3:11BC 7606           JBE    11C4 

12B3:11BE 8B1EEC05       MOV    BX,[05EC]
12B3:11C2 EB6A           JMP    122E 

12B3:11C4 890EF205     * MOV    [05F2],CX
12B3:11C8 8B1EEA05       MOV    BX,[05EA] 
12B3:11CC EB60           JMP    122E 

12B3:11CE FF0EF005       DEC    Word Ptr [05F0]
12B3:11D2 8B7F04         MOV    DI,[BX+04] 
12B3:11D5 8B7702         MOV    SI,[BX+02] 
12B3:11D8 897C04         MOV    [SI+04],DI 
12B3:11DB 897502         MOV    [DI+02],SI 
12B3:11DE 8936EC05       MOV    [05EC],SI 

12B3:11E2 FF06EE05     * INC    Word Ptr [05EE]
12B3:11E6 800F01         OR     Byte Ptr [BX],01 
12B3:11E9 C606340601     MOV    Byte Ptr [0634],01 
12B3:11EE 8D4702         LEA    AX,[BX+02] 
12B3:11F1 E98500         JMP    1279 

12B3:11F4 E98000       * JMP    1277        ; konec

12B3:11F7 8B37         * MOV    SI,[BX]
12B3:11F9 3B36F205       CMP    SI,[05F2] 
12B3:11FD 7604           JBE    1203 
12B3:11FF 8936F205       MOV    [05F2],SI 
12B3:1203 8B5F04         MOV    BX,[BX+04] 
12B3:1206 39C3           CMP    BX,AX 
12B3:1208 7526           JNZ    1230 
12B3:120A 85C9           TEST   CX,CX 
12B3:120C 7509           JNZ    1217 
12B3:120E 89D0           MOV    AX,DX 
12B3:1210 E88600         CALL   1299 
12B3:1213 85C0           TEST   AX,AX 
12B3:1215 754D           JNZ    1264 
12B3:1217 89D0           MOV    AX,DX 
12B3:1219 E8F903         CALL   1615 
12B3:121C 85C0           TEST   AX,AX 
12B3:121E 7457           JZ     1277 
12B3:1220 31C9           XOR    CX,CX 
12B3:1222 890EF205       MOV    [05F2],CX 
12B3:1226 8B1EEA05       MOV    BX,[05EA] 

12B3:122A 891EEC05     * MOV    [05EC],BX
12B3:122E 89D8         * MOV    AX,BX
12B3:1230 3B17           CMP    DX,[BX] 
12B3:1232 77C3           JA     11F7 
12B3:1234 8B07           MOV    AX,[BX] 
12B3:1236 29D0           SUB    AX,DX 
12B3:1238 3D0600         CMP    AX,0006 
12B3:123B 7691           JBE    11CE 
12B3:123D 89DE           MOV    SI,BX 
12B3:123F 01D6           ADD    SI,DX 
12B3:1241 8904           MOV    [SI],AX 
12B3:1243 8B4702         MOV    AX,[BX+02] 
12B3:1246 894402         MOV    [SI+02],AX 
12B3:1249 8B4704         MOV    AX,[BX+04] 
12B3:124C 894404         MOV    [SI+04],AX 
12B3:124F 8B7C02         MOV    DI,[SI+02] 
12B3:1252 897504         MOV    [DI+04],SI 
12B3:1255 8B7C04         MOV    DI,[SI+04] 
12B3:1258 897502         MOV    [DI+02],SI 
12B3:125B 8936EC05       MOV    [05EC],SI 
12B3:125F 8917           MOV    [BX],DX 
12B3:1261 E97EFF         JMP    11E2 

12B3:1264 B90100         MOV    CX,0001
12B3:1267 8B1EE805       MOV    BX,[05E8] 
12B3:126B 817F02E605     CMP    Word Ptr [BX+02],05E6 
12B3:1270 74B8           JZ     122A 
12B3:1272 8B5F02         MOV    BX,[BX+02] 
12B3:1275 EBB3           JMP    122A 

12B3:1277 31C0         * XOR    AX,AX
12B3:1279 5F             POP    DI 
12B3:127A 5E             POP    SI 
12B3:127B 5A             POP    DX 
12B3:127C 59             POP    CX 
12B3:127D 5B             POP    BX 
12B3:127E C3             RET     

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

12B3:127F 53             PUSH   BX
12B3:1280 8B1EE805       MOV    BX,[05E8]   ; tabulka adres
12B3:1284 8B07           MOV    AX,[BX] 
12B3:1286 01D8           ADD    AX,BX 
12B3:1288 83C002         ADD    AX,+02 
12B3:128B 3B06C805       CMP    AX,[05C8] 
12B3:128F 7504           JNZ    1295 
12B3:1291 8B07           MOV    AX,[BX] 
12B3:1293 EB02           JMP    1297 
12B3:1295 31C0         * XOR    AX,AX
12B3:1297 5B           * POP    BX
12B3:1298 C3             RET     

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

12B3:1299 53             PUSH   BX
12B3:129A 51             PUSH   CX 
12B3:129B 52             PUSH   DX 
12B3:129C 56             PUSH   SI 
12B3:129D 57             PUSH   DI 
12B3:129E 89C2           MOV    DX,AX 
12B3:12A0 833EC805FE     CMP    Word Ptr [05C8],0fffeh ; konec datov‚ho segmentu
12B3:12A5 7504           JNZ    12AB        ; nen¡ je¨tˆ maxim ln¡ konec

12B3:12A7 31C0         * XOR    AX,AX       ; nen¡ voln‚ m¡sto
12B3:12A9 EBCE           JMP    1279 

12B3:12AB E8D1FF         CALL   127F        ;
12B3:12AE 29C2           SUB    DX,AX 
12B3:12B0 89D0           MOV    AX,DX 
12B3:12B2 83C008         ADD    AX,+08 
12B3:12B5 39D0           CMP    AX,DX 
12B3:12B7 72EE           JB     12A7 
12B3:12B9 89C2           MOV    DX,AX 
12B3:12BB 3B063206       CMP    AX,[0632] 
12B3:12BF 7307           JNB    12C8 
12B3:12C1 8B163206       MOV    DX,[0632] 
12B3:12C5 80E2FE         AND    DL,FE 
12B3:12C8 0316C805       ADD    DX,[05C8] 
12B3:12CC 3B16C805       CMP    DX,[05C8] 
12B3:12D0 7303           JNB    12D5 
12B3:12D2 BAFEFF         MOV    DX,FFFE 
12B3:12D5 89D0           MOV    AX,DX 
12B3:12D7 E84203         CALL   161C        ; nastaven¡ nov‚ velikosti dat.bloku
12B3:12DA 89C3           MOV    BX,AX 
12B3:12DC 3DFFFF         CMP    AX,FFFF 
12B3:12DF 74C6           JZ     12A7 
12B3:12E1 89DE           MOV    SI,BX 
12B3:12E3 83FBF8         CMP    BX,-08 
12B3:12E6 77BF           JA     12A7 
12B3:12E8 39DA           CMP    DX,BX 
12B3:12EA 76BB           JBE    12A7 
12B3:12EC 29DA           SUB    DX,BX 
12B3:12EE 89D0           MOV    AX,DX 
12B3:12F0 83EA02         SUB    DX,+02 
12B3:12F3 39C2           CMP    DX,AX 
12B3:12F5 77B0           JA     12A7 
12B3:12F7 89D0           MOV    AX,DX 
12B3:12F9 833EE40500     CMP    Word Ptr [05E4],+00 
12B3:12FE 7416           JZ     1316 
12B3:1300 8B3EE405       MOV    DI,[05E4] 
12B3:1304 89F9           MOV    CX,DI 
12B3:1306 030D           ADD    CX,[DI] 
12B3:1308 83EB02         SUB    BX,+02 
12B3:130B 39CB           CMP    BX,CX 
12B3:130D 7507           JNZ    1316 
12B3:130F 83C002         ADD    AX,+02 
12B3:1312 0105           ADD    [DI],AX 
12B3:1314 EB28           JMP    133E 
12B3:1316 89F3           MOV    BX,SI 
12B3:1318 C744020000     MOV    Word Ptr [SI+02],0000 
12B3:131D 8B16E405       MOV    DX,[05E4] 
12B3:1321 895404         MOV    [SI+04],DX 
12B3:1324 8904           MOV    [SI],AX 
12B3:1326 833EE40500     CMP    Word Ptr [05E4],+00 
12B3:132B 7407           JZ     1334 
12B3:132D 8B3EE405       MOV    DI,[05E4] 
12B3:1331 897502         MOV    [DI+02],SI 
12B3:1334 891EE405       MOV    [05E4],BX 
12B3:1338 83E806         SUB    AX,+06 
12B3:133B 83C306         ADD    BX,+06 
12B3:133E 89C2           MOV    DX,AX 
12B3:1340 80CA01         OR     DL,01 
12B3:1343 8917           MOV    [BX],DX 
12B3:1345 89DE           MOV    SI,BX 
12B3:1347 01C6           ADD    SI,AX 
12B3:1349 C704FFFF       MOV    Word Ptr [SI],FFFF 
12B3:134D 8D4702         LEA    AX,[BX+02] 
12B3:1350 E80D00         CALL   1360        ; zru¨en¡ datov‚ho bufferu AX
12B3:1353 B80100         MOV    AX,0001 
12B3:1356 E920FF         JMP    1279 
12B3:1359 89E0           MOV    AX,SP 
12B3:135B 2B06D005       SUB    AX,[05D0] 
12B3:135F C3             RET     

; -----------------------------------------------------------------------------
;        zru¨en¡ datov‚ho bufferu AX
; -----------------------------------------------------------------------------

12B3:1360 53             PUSH   BX
12B3:1361 51             PUSH   CX 
12B3:1362 52             PUSH   DX 
12B3:1363 56             PUSH   SI 
12B3:1364 57             PUSH   DI 
12B3:1365 55             PUSH   BP 
12B3:1366 89E5           MOV    BP,SP 
12B3:1368 50             PUSH   AX 
12B3:1369 85C0           TEST   AX,AX 
12B3:136B 7441           JZ     13AE 
12B3:136D 83E802         SUB    AX,+02 
12B3:1370 8946FE         MOV    [BP-02],AX 
12B3:1373 89C6           MOV    SI,AX 
12B3:1375 8B0C           MOV    CX,[SI] 
12B3:1377 F6C101         TEST   CL,01 
12B3:137A 7432           JZ     13AE 
12B3:137C 80E1FE         AND    CL,FE 
12B3:137F 31F6           XOR    SI,SI 
12B3:1381 8B46FE         MOV    AX,[BP-02] 
12B3:1384 01C8           ADD    AX,CX 
12B3:1386 89C7           MOV    DI,AX 
12B3:1388 F60501         TEST   Byte Ptr [DI],01 
12B3:138B 7524           JNZ    13B1 
12B3:138D 030D           ADD    CX,[DI] 
12B3:138F 8B5D04         MOV    BX,[DI+04] 
12B3:1392 8B7502         MOV    SI,[DI+02] 
12B3:1395 895C04         MOV    [SI+04],BX 
12B3:1398 897702         MOV    [BX+02],SI 
12B3:139B 8B7EFE         MOV    DI,[BP-02] 
12B3:139E 3B3EEC05       CMP    DI,[05EC] 
12B3:13A2 7304           JNB    13A8 
12B3:13A4 893EEC05       MOV    [05EC],DI 
12B3:13A8 FF0EF005       DEC    Word Ptr [05F0] 
12B3:13AC EBD3           JMP    1381 
12B3:13AE E9AD00         JMP    145E 
12B3:13B1 8B7EFE         MOV    DI,[BP-02] 
12B3:13B4 890D           MOV    [DI],CX 
12B3:13B6 85F6           TEST   SI,SI 
12B3:13B8 7539           JNZ    13F3 
12B3:13BA 8B1EF005       MOV    BX,[05F0] 
12B3:13BE 43             INC    BX 
12B3:13BF A1EE05         MOV    AX,[05EE] 
12B3:13C2 31D2           XOR    DX,DX 
12B3:13C4 F7F3           DIV    BX 
12B3:13C6 3B06F005       CMP    AX,[05F0] 
12B3:13CA 732E           JNB    13FA 
12B3:13CC 3B3EEC05       CMP    DI,[05EC] 
12B3:13D0 7304           JNB    13D6 
12B3:13D2 893EEC05       MOV    [05EC],DI 
12B3:13D6 8B5EFE         MOV    BX,[BP-02] 
12B3:13D9 01CB           ADD    BX,CX 
12B3:13DB 8B0F           MOV    CX,[BX] 
12B3:13DD F6C101         TEST   CL,01 
12B3:13E0 7505           JNZ    13E7 
12B3:13E2 8B7702         MOV    SI,[BX+02] 
12B3:13E5 EB3F           JMP    1426 
12B3:13E7 83F9FF         CMP    CX,-01 
12B3:13EA 7509           JNZ    13F5 
12B3:13EC BBE605         MOV    BX,05E6 
12B3:13EF 8B36E805       MOV    SI,[05E8] 
12B3:13F3 EB31           JMP    1426 
12B3:13F5 80E1FE         AND    CL,FE 
12B3:13F8 EBDF           JMP    13D9 
12B3:13FA 3B3EE805       CMP    DI,[05E8] 
12B3:13FE 77EC           JA     13EC 
12B3:1400 3B3EEC05       CMP    DI,[05EC] 
12B3:1404 730D           JNB    1413 
12B3:1406 BEE605         MOV    SI,05E6 
12B3:1409 8B1EEA05       MOV    BX,[05EA] 
12B3:140D 893EEC05       MOV    [05EC],DI 
12B3:1411 EB07           JMP    141A 
12B3:1413 8B36EC05       MOV    SI,[05EC] 
12B3:1417 8B5C04         MOV    BX,[SI+04] 
12B3:141A 3B5EFE         CMP    BX,[BP-02] 
12B3:141D 7307           JNB    1426 
12B3:141F 89DE           MOV    SI,BX 
12B3:1421 8B5F04         MOV    BX,[BX+04] 
12B3:1424 EBF4           JMP    141A 
12B3:1426 8B04           MOV    AX,[SI] 
12B3:1428 01F0           ADD    AX,SI 
12B3:142A 3B46FE         CMP    AX,[BP-02] 
12B3:142D 7513           JNZ    1442 
12B3:142F 8B5EFE         MOV    BX,[BP-02] 
12B3:1432 8B07           MOV    AX,[BX] 
12B3:1434 0104           ADD    [SI],AX 
12B3:1436 3B36EC05       CMP    SI,[05EC] 
12B3:143A 7319           JNB    1455 
12B3:143C 8936EC05       MOV    [05EC],SI 
12B3:1440 EB13           JMP    1455 

12B3:1442 FF06F005       INC    Word Ptr [05F0]
12B3:1446 8B7EFE         MOV    DI,[BP-02] 
12B3:1449 895D04         MOV    [DI+04],BX 
12B3:144C 897502         MOV    [DI+02],SI 
12B3:144F 897C04         MOV    [SI+04],DI 
12B3:1452 897F02         MOV    [BX+02],DI 
12B3:1455 C606340601   * MOV    Byte Ptr [0634],01
12B3:145A FF0EEE05       DEC    Word Ptr [05EE] 
12B3:145E 89EC           MOV    SP,BP 
12B3:1460 5D             POP    BP 
12B3:1461 5F             POP    DI 
12B3:1462 5E             POP    SI 
12B3:1463 5A             POP    DX 
12B3:1464 59             POP    CX 
12B3:1465 5B             POP    BX 
12B3:1466 C3             RET     

12B3:1467 C3             RET

1468     dw        0                        ; £schova SP p©i startu programu
146a     dw        0                        ; £schova SS p©i startu programu
146c     dw        0                        ; £schova promˆnn‚ 002eh LOW
146e     dw        0                        ; £schova promˆnn‚ 002eh HIGH
1470     dw        0                        ; £schova DS p©i startu programu

; -----------------------------------------------------------------------------
;        spu¨tˆn¡ programu
; -----------------------------------------------------------------------------
; parametry v z sobn¡ku: SS:[BP+0ah] (2) segment prost©ed¡
;                        SS:[BP+08h] (2) offset p©¡kazov‚ho © dku
;                        SS:[BP+06h] (2) offset jm‚na programu k spu¨tˆn¡
;                        SS:[BP+04h] (2) p©ep¡na‡ typu spu¨tˆn¡ programu
;                                              1 = volbou 4
;                                          jinak = volbou 0
; -----------------------------------------------------------------------------

; ------ £schova registr–

12B3:1472 55             PUSH   BP
12B3:1473 8BEC           MOV    BP,SP 
12B3:1475 56             PUSH   SI 
12B3:1476 57             PUSH   DI 
12B3:1477 52             PUSH   DX 
12B3:1478 51             PUSH   CX 
12B3:1479 53             PUSH   BX 
12B3:147A 06             PUSH   ES 
12B3:147B 1E             PUSH   DS 

12B3:147C 8CD0           MOV    AX,SS       ; datov˜ segment
12B3:147E 8ED8           MOV    DS,AX       ; datov˜ segment

; ------ nastaven¡ adresy prost©ed¡ a p©¡kazov‚ho © dku

12B3:1480 8B460A         MOV    AX,[BP+0A]  ; segment prost©ed¡
12B3:1483 A31806         MOV    [0618],AX   ; segment prost©ed¡
12B3:1486 8B4608         MOV    AX,[BP+08]  ; offset p©¡kazov‚ho © dku
12B3:1489 A31A06         MOV    [061A],AX   ; adresa p©¡kazov‚ho © dku
12B3:148C 8C1E1C06       MOV    [061C],DS   ; segment p©¡kazov‚ho © dku
12B3:1490 8C1E2406       MOV    [0624],DS   ; segment FCB2
12B3:1494 1E             PUSH   DS 
12B3:1495 07             POP    ES          ; ES <- DS
12B3:1496 8BF0           MOV    SI,AX 
12B3:1498 46             INC    SI          ; za‡ tek p©¡kazov‚ho © dku

; ------ rozbor p©¡kazov‚ho © dku do FCB1

12B3:1499 BFF805         MOV    DI,05F8     ; ukazatel na FCB1
12B3:149C 893E1E06       MOV    [061E],DI   ; offset FCB1
12B3:14A0 8C1E2006       MOV    [0620],DS   ; segment FCB1
12B3:14A4 B001           MOV    AL,01       ; p©¡znaky - ignorov n¡ mezer
12B3:14A6 B429           MOV    AH,29
12B3:14A8 CD21           INT    21          ; rozbor jm‚na souboru

; ------ rozbor p©¡kazov‚ho © dku do FCB2

12B3:14AA BF0806         MOV    DI,0608     ; ukazatel na FCB2
12B3:14AD 893E2206       MOV    [0622],DI   ; offset FCB2
12B3:14B1 8C1E2406       MOV    [0624],DS   ; segment FCB2
12B3:14B5 B001           MOV    AL,01       ; p©¡znaky - ignorov n¡ mezer
12B3:14B7 B429           MOV    AH,29
12B3:14B9 CD21           INT    21          ; rozbor jm‚na souboru

; ------ £schova registr– pro start programu

12B3:14BB 55             PUSH   BP          ; £schova BP p©i startu programu
12B3:14BC 06             PUSH   ES          ; £schova ES p©i startu programu
12B3:14BD 1E             PUSH   DS
12B3:14BE 2E8C166A14     MOV    CS:[146A],SS ; £schova SS p©i startu programu
12B3:14C3 2E89266814     MOV    CS:[1468],SP ; £schova SP p©i startu programu
12B3:14C8 2E8C1E7014     MOV    CS:[1470],DS ; £schova DS p©i startu programu

; ------ pro verzi syst‚mu 2.xx £schova promˆnn‚ 002eh

12B3:14CD 803ECC0502     CMP    Byte Ptr [05CC],02 ; je verze syst‚mu 2 ?
12B3:14D2 7512           JNZ    14E6        ; nen¡ verze syst‚mu 2
12B3:14D4 BF2E00         MOV    DI,002E     ;
12B3:14D7 8B35           MOV    SI,[DI] 
12B3:14D9 2E89366C14     MOV    CS:[146C],SI 
12B3:14DE 8B7502         MOV    SI,[DI+02] 
12B3:14E1 2E89366E14     MOV    CS:[146E],SI 

; ------ rozli¨en¡ typu spu¨tˆn¡ programu

12B3:14E6 BB1806       * MOV    BX,0618     ; adresa bloku parametr–
12B3:14E9 837E0401       CMP    Word Ptr [BP+04],+01
12B3:14ED 7506           JNZ    14F5 
12B3:14EF B004           MOV    AL,04       ;
12B3:14F1 33C9           XOR    CX,CX 
12B3:14F3 EB02           JMP    14F7 

; ------ test kl vesnice pro mo‘nost p©eru¨en¡ programu z konzoly

12B3:14F5 32C0         * XOR    AL,AL
12B3:14F7 F8           * CLC
12B3:14F8 50             PUSH   AX 
12B3:14F9 B40B           MOV    AH,0B 
12B3:14FB CD21           INT    21          ; test stavu stand. vstupu
12B3:14FD 58             POP    AX

; ------ na‡ten¡ a spu¨tˆn¡ programu

12B3:14FE C706D4050100   MOV    Word Ptr [05D4],0001 ; p©¡znak startu programu
12B3:1504 8B5606         MOV    DX,[BP+06]  ; ukazatel na jm‚no programu DS:DX
12B3:1507 B44B           MOV    AH,4B                         ;'K' 
12B3:1509 CD21           INT    21          ; start programu

; ------ text verze syst‚mu

12B3:150B 50             PUSH   AX          ; £schova n vratov‚ho k¢du
12B3:150C 9F             LAHF               ; £schova navr cen‚ho p©¡znaku
12B3:150D 50             PUSH   AX
12B3:150E B430           MOV    AH,30
12B3:1510 CD21           INT    21          ; poskytnut¡ verze syst‚mu
12B3:1512 3C02           CMP    AL,02       ; je verze syst‚mu alespo¤ 2.00 ?
12B3:1514 58             POP    AX          ; p©¡znak operace
12B3:1515 5B             POP    BX          ; chybov˜ k¢d

; ------ n vrat registr–

12B3:1516 2E8E166A14     MOV    SS,CS:[146A] ; n vrat registru SS
12B3:151B 2E8B266814     MOV    SP,CS:[1468] ; n vrat registru SP
12B3:1520 2E8E1E7014     MOV    DS,CS:[1470] ; n vrat registru DS
12B3:1525 7512           JNZ    1539        ; nen¡ verze syst‚mu 2.xx

; ------ pro verzi syst‚mu 2.xx n vrat promˆnn‚ 002eh

12B3:1527 BF2E00         MOV    DI,002E
12B3:152A 2E8B366E14     MOV    SI,CS:[146E] 
12B3:152F 897502         MOV    [DI+02],SI 
12B3:1532 2E8B366C14     MOV    SI,CS:[146C] 
12B3:1537 8935           MOV    [DI],SI 

; ------ n vrat registr– pro ukon‡en¡ programu

12B3:1539 9E             SAHF               ; n vrat registru p©¡znak–
12B3:153A 93             XCHG   AX,BX       ; AX <- k¢d chyby
12B3:153B 1F             POP    DS
12B3:153C C706D4050000   MOV    Word Ptr [05D4],0000 ; p©¡znak ukon‡en¡ programu
12B3:1542 07             POP    ES 
12B3:1543 5D             POP    BP 

; ------ zji¨tˆn¡ n vratov‚ho k¢du programu (jen je-li operace OK)

12B3:1544 7204           JB     154A
12B3:1546 B44D           MOV    AH,4D
12B3:1548 CD21           INT    21          ; poskytnut¡ n vratov‚ho k¢du

; ------

12B3:154A 1BD2         * SBB    DX,DX
12B3:154C E82201         CALL   1671        ;

; ------ n vrat registr–

12B3:154F 1F             POP    DS
12B3:1550 07             POP    ES 
12B3:1551 5B             POP    BX 
12B3:1552 59             POP    CX 
12B3:1553 5A             POP    DX 
12B3:1554 5F             POP    DI 
12B3:1555 5E             POP    SI 
12B3:1556 5D             POP    BP 
12B3:1557 C3             RET     

; -----------------------------------------------------------------------------
;        porovn n¡ text– ASCIIZ  DS:AX s DS:DX (maxim ln¡ d‚lka BX)
; -----------------------------------------------------------------------------

12B3:1558 56             PUSH   SI
12B3:1559 57             PUSH   DI 
12B3:155A 89C7           MOV    DI,AX       ; text 1
12B3:155C 89D6           MOV    SI,DX       ; text 2

; ------ test, zda je dal¨¡ znak

12B3:155E 85DB         * TEST   BX,BX       ; je dal¨¡ znak ?
12B3:1560 7504           JNZ    1566        ; je dal¨¡ znak - pokra‡ov n¡

; ------ ©etˆzce jsou shodn‚

12B3:1562 31C0         * XOR    AX,AX       ; p©¡znak shody ©etˆzc–
12B3:1564 EB36           JMP    159C 

; ------ korekce znaku textu 1 na mal‚ p¡smeno

12B3:1566 8A05         * MOV    AL,[DI]
12B3:1568 3C41           CMP    AL,41                         ;'A' 
12B3:156A 7206           JB     1572 
12B3:156C 3C5A           CMP    AL,5A                         ;'Z' 
12B3:156E 7702           JA     1572 
12B3:1570 0420           ADD    AL,20                         ;' ' 

; ------ korekce znaku textu 2 na mal‚ p¡smeno

12B3:1572 8A24         * MOV    AH,[SI]
12B3:1574 80FC41         CMP    AH,41                         ;'A' 
12B3:1577 7208           JB     1581 
12B3:1579 80FC5A         CMP    AH,5A                         ;'Z' 
12B3:157C 7703           JA     1581 
12B3:157E 80C420         ADD    AH,20                         ;' ' 

; ------ porovn n¡ znak– text–

12B3:1581 38E0           CMP    AL,AH
12B3:1583 740E           JZ     1593        ; je shoda

; ------ nen¡ shoda text–

12B3:1585 88C3           MOV    BL,AL       ; znak textu 1
12B3:1587 30FF           XOR    BH,BH       ; BX=znak textu 1
12B3:1589 88E0           MOV    AL,AH       ; znak textu 2
12B3:158B 30E4           XOR    AH,AH       ; AX=znak textu 2
12B3:158D 29C3           SUB    BX,AX       ; rozd¡l textu 1 a textu 2
12B3:158F 89D8           MOV    AX,BX       ; rozd¡l posledn¡ho znaku text–
12B3:1591 EB09           JMP    159C 

; ------ test, zda je ji‘ konec text–

12B3:1593 3C00           CMP    AL,00       ; je ji‘ konec text– ?
12B3:1595 74CB           JZ     1562        ; je ji‘ konec - ©etˆzce jsou shodn‚

; ------ p©¡prava pro dal¨¡ znak

12B3:1597 4B             DEC    BX          ; sn¡‘en¡ ‡¡ta‡e d‚lky text–
12B3:1598 46             INC    SI          ; zv˜¨en¡ ukazatele textu 2
12B3:1599 47             INC    DI          ; zv˜¨en¡ ukazatele textu 1
12B3:159A EBC2           JMP    155E        ; porovn n¡ dal¨¡ho znaku

12B3:159C 5F           * POP    DI
12B3:159D 5E             POP    SI 
12B3:159E C3             RET     

; -----------------------------------------------------------------------------
;        start hlavn¡ procedury
; -----------------------------------------------------------------------------

12B3:159F 89C2           MOV    DX,AX       ; offset p©¡kazov‚ho © dku
12B3:15A1 C70632060100   MOV    Word Ptr [0632],0001
12B3:15A7 E81400         CALL   15BE        ; inicial. tabulky stand. za©¡zen¡
12B3:15AA C70632060020   MOV    Word Ptr [0632],2000 
12B3:15B0 89D0           MOV    AX,DX       ; offset p©¡kazov‚ho © dku
12B3:15B2 89DA           MOV    DX,BX       ; segment p©¡kazov‚ho © dku
12B3:15B4 FF162200       CALL   [0022]      ; hlavn¡ procedura MAIN 0a65h
12B3:15B8 E9CBF5         JMP    0B86        ; n vrat stavu programu
12B3:15BB E9B6F3         JMP    0974 

; -----------------------------------------------------------------------------
;        rozli¨en¡ standardn¡ch za©¡zen¡, zda to jsou soubory
; -----------------------------------------------------------------------------

12B3:15BE 53             PUSH   BX
12B3:15BF 52             PUSH   DX 
12B3:15C0 31D2           XOR    DX,DX       ; identifik tor za©¡zen¡
12B3:15C2 31DB           XOR    BX,BX       ; ukazatel v tabulce
12B3:15C4 89D0         * MOV    AX,DX
12B3:15C6 E8BA01         CALL   1783        ; test, zda je soubor znak. za©¡zen¡
12B3:15C9 85C0           TEST   AX,AX 
12B3:15CB 7405           JZ     15D2        ; nen¡ - je to diskov˜ soubor
12B3:15CD 808F4D0620     OR     Byte Ptr [BX+064D],20 ; p©¡znak znakov‚ho za©¡z.
12B3:15D2 83C302       * ADD    BX,+02      ; zv˜¨en¡ ukazatele v tabulce
12B3:15D5 42             INC    DX 
12B3:15D6 83FA05         CMP    DX,+05 
12B3:15D9 7CE9           JL     15C4 
12B3:15DB 5A             POP    DX 
12B3:15DC 5B             POP    BX 
12B3:15DD C3             RET     

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

12B3:15DE C3             RET

12B3:15DF B88008         MOV    AX,0880     ; minim. velikost datov‚ho bloku
12B3:15E2 C3             RET     

12B3:15E3 B88208         MOV    AX,0882
12B3:15E6 C3             RET     

; -----------------------------------------------------------------------------
;        nalezen¡ znaku DL v textu ASCIIZ  DS:AX
; -----------------------------------------------------------------------------

12B3:15E7 56             PUSH   SI
12B3:15E8 89C6           MOV    SI,AX       ; adresa prohled van‚ho textu

; ------ test prvn¡ho znaku

12B3:15EA AD             LODSW              ; 2 znaky textu
12B3:15EB 38D0           CMP    AL,DL       ; je prvn¡ znak hledan˜ znak ?
12B3:15ED 7420           JZ     160F        ; znak nalezen
12B3:15EF 84C0           TEST   AL,AL       ; je konec textu ?
12B3:15F1 7419           JZ     160C        ; konec textu

; ------ test druh‚ho znaku

12B3:15F3 38D4           CMP    AH,DL       ; je druh˜ znak hledan˜ znak ?
12B3:15F5 7419           JZ     1610        ; znak nalezen
12B3:15F7 84E4           TEST   AH,AH       ; je konec textu ?
12B3:15F9 7411           JZ     160C        ; konec textu

; ------ test t©et¡ho znaku

12B3:15FB AD             LODSW              ; 2 znaky textu
12B3:15FC 38D0           CMP    AL,DL       ; je prvn¡ znak hledan˜ znak ?
12B3:15FE 740F           JZ     160F        ; znak nalezen
12B3:1600 84C0           TEST   AL,AL       ; je konec textu ?
12B3:1602 7408           JZ     160C        ; konec textu

; ------ test ‡tvrt‚ho znaku                

12B3:1604 38D4           CMP    AH,DL       ; je druh˜ znak hledan˜ znak ?
12B3:1606 7408           JZ     1610        ; znak nalezen
12B3:1608 84E4           TEST   AH,AH       ; je konec textu ?
12B3:160A 75DE           JNZ    15EA        ; nen¡ konec textu

12B3:160C 31F6           XOR    SI,SI       ; p©¡znak - znak nenalezen

;12B3:160E A94E4E         TEST   AX,4E4E

12B3:160F 4E             DEC    SI          ; n vrat adresy znaku
12B3:1610 4E             DEC    SI
12B3:1611 89F0           MOV    AX,SI       ; adresa nalezen‚ho znaku
12B3:1613 5E             POP    SI 
12B3:1614 C3             RET     


12B3:1615 31C0           XOR    AX,AX
12B3:1617 C3             RET     

12B3:1618 0306C805       ADD    AX,[05C8] 

; -----------------------------------------------------------------------------
;        nastaven¡ nov‚ velikosti datov‚ho bloku programu
; -----------------------------------------------------------------------------

12B3:161C 53             PUSH   BX
12B3:161D 51             PUSH   CX 
12B3:161E 52             PUSH   DX 
12B3:161F 06             PUSH   ES 
12B3:1620 89C2           MOV    DX,AX       ; nov  po‘adovan  velikost bloku
12B3:1622 3B06D205       CMP    AX,[05D2]   ; je nad minim ln¡m koncem ?
12B3:1626 7310           JNB    1638        ; je nad minim. koncem OK

12B3:1628 E8B4FF       * CALL   15DF        ; adresa po‡ tku dat haldy
12B3:162B 89C3           MOV    BX,AX       ; adresa po‡ tku haldy
12B3:162D C7070500       MOV    Word Ptr [BX],0005 
12B3:1631 8B07           MOV    AX,[BX] 
12B3:1633 B8FFFF         MOV    AX,FFFF     ; p©¡znak chyby
12B3:1636 EB2D           JMP    1665

; ------ p©¡prava nov‚ velikosti datov‚ho bloku

12B3:1638 89D3           MOV    BX,DX       ; nov  velikost v bajtech
12B3:163A 83C30F         ADD    BX,+0F      ; zaokrouhlen¡
12B3:163D B104           MOV    CL,04       ; po‡et rotac¡
12B3:163F D3EB           SHR    BX,CL       ; p©evod na odstavce
12B3:1641 85DB           TEST   BX,BX       ; byl to blok 64 KB ?
12B3:1643 7503           JNZ    1648        ; nebyl
12B3:1645 BB0010         MOV    BX,1000     ; oprava na blok 64 KB

; ------ nastaven¡ nov‚ velikosti bloku programu

12B3:1648 8CD0         * MOV    AX,SS       ; segment datov‚ho segmentu
12B3:164A 2B06CA05       SUB    AX,[05CA]   ; segment PSP -> velikost programu
12B3:164E 01C3           ADD    BX,AX       ; nov  velikost bloku s daty
12B3:1650 8E06CA05       MOV    ES,[05CA]   ; segment PSP
12B3:1654 B44A           MOV    AH,4A                         ;'J' 
12B3:1656 CD21           INT    21          ; modifikace alok. bloku
12B3:1658 1BC0           SBB    AX,AX       ; n vratov˜ k¢d

12B3:165A 85C0           TEST   AX,AX
12B3:165C 75CA           JNZ    1628        ; byla chyba operace

12B3:165E A1C805         MOV    AX,[05C8]   ; p–vodn¡ adresa konce programu
12B3:1661 8916C805       MOV    [05C8],DX   ; nov˜ konec bloku programu
12B3:1665 07             POP    ES 
12B3:1666 5A             POP    DX 
12B3:1667 59             POP    CX 
12B3:1668 5B             POP    BX 
12B3:1669 C3             RET     

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

12B3:166A 85D2           TEST   DX,DX
12B3:166C 7503           JNZ    1671 
12B3:166E 31C0           XOR    AX,AX 
12B3:1670 C3             RET     

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

12B3:1671 85D2           TEST   DX,DX
12B3:1673 7503           JNZ    1678 
12B3:1675 C3             RET     

12B3:1676 30E4           XOR    AH,AH

12B3:1678 53             PUSH   BX
12B3:1679 51             PUSH   CX 
12B3:167A 52             PUSH   DX 
12B3:167B 56             PUSH   SI 
12B3:167C 89C2           MOV    DX,AX 
12B3:167E 88C3           MOV    BL,AL 
12B3:1680 30E4           XOR    AH,AH 
12B3:1682 89C1           MOV    CX,AX 
12B3:1684 E85CFF         CALL   15E3 
12B3:1687 89C6           MOV    SI,AX 
12B3:1689 890C           MOV    [SI],CX 
12B3:168B 81FA0001       CMP    DX,0100 
12B3:168F 733A           JNB    16CB 
12B3:1691 803ECC0503     CMP    Byte Ptr [05CC],03 
12B3:1696 7221           JB     16B9 
12B3:1698 80FB22         CMP    BL,22                         ;'"' 
12B3:169B 7215           JB     16B2 
12B3:169D B313           MOV    BL,13 
12B3:169F EB18           JMP    16B9 
12B3:16A1 53             PUSH   BX 
12B3:16A2 E83AFF         CALL   15DF 
12B3:16A5 89C3           MOV    BX,AX 
12B3:16A7 C7070900       MOV    Word Ptr [BX],0009 
12B3:16AB 8B1F           MOV    BX,[BX] 
12B3:16AD B8FFFF         MOV    AX,FFFF 
12B3:16B0 5B             POP    BX 
12B3:16B1 C3             RET     
12B3:16B2 80FB20         CMP    BL,20                         ;' ' 
12B3:16B5 7202           JB     16B9 
12B3:16B7 B305           MOV    BL,05 
12B3:16B9 80FB13       * CMP    BL,13
12B3:16BC 7602           JBE    16C0 
12B3:16BE B313           MOV    BL,13 
12B3:16C0 30FF           XOR    BH,BH 
12B3:16C2 8A873606       MOV    AL,[BX+0636] 
12B3:16C6 98             CBW     
12B3:16C7 89C2           MOV    DX,AX 
12B3:16C9 EB04           JMP    16CF 
12B3:16CB 88F2           MOV    DL,DH 
12B3:16CD 30F6           XOR    DH,DH 
12B3:16CF E80DFF         CALL   15DF 
12B3:16D2 89C3           MOV    BX,AX 
12B3:16D4 8917           MOV    [BX],DX 
12B3:16D6 8B07           MOV    AX,[BX] 
12B3:16D8 B8FFFF         MOV    AX,FFFF 
12B3:16DB 5E             POP    SI 
12B3:16DC 5A             POP    DX 
12B3:16DD 59             POP    CX 
12B3:16DE 5B             POP    BX 
12B3:16DF C3             RET     

; -----------------------------------------------------------------------------
;        vytvo©en¡ tabulky parametr– prost©ed¡
; -----------------------------------------------------------------------------

12B3:16E0 53             PUSH   BX
12B3:16E1 51             PUSH   CX 
12B3:16E2 52             PUSH   DX 
12B3:16E3 56             PUSH   SI 
12B3:16E4 57             PUSH   DI 
12B3:16E5 06             PUSH   ES 
12B3:16E6 55             PUSH   BP 
12B3:16E7 89E5           MOV    BP,SP       ; ukazatel lok ln¡ch promˆnn˜ch
12B3:16E9 50             PUSH   AX

12B3:16EA 833E300600     CMP    Word Ptr [0630],+00 ; tabulka adres parametr– prost©ed¡
12B3:16EF 752D           JNZ    171E        ; tabulka je ji‘ vytvo©ena

; ------ stanoven¡ po‡tu ©etˆzc– v prost©ed¡

12B3:16F1 8E06CA05       MOV    ES,[05CA]   ; segment PSP
12B3:16F5 BB2C00         MOV    BX,002C     ; adresa ukazatele prost©ed¡
12B3:16F8 268B0F         MOV    CX,ES:[BX]  ; segment prost©ed¡
12B3:16FB 894EFE         MOV    [BP-02],CX  ; segment prost©ed¡
12B3:16FE 31FF           XOR    DI,DI       ; za‡ tek prost©ed¡
12B3:1700 31D2           XOR    DX,DX       ; ‡¡ta‡ ©etˆzc–
12B3:1702 31DB           XOR    BX,BX       ; ukazatel v prost©ed¡
12B3:1704 8EC1           MOV    ES,CX       ; segment prost©ed¡
12B3:1706 26803F00     * CMP    Byte Ptr ES:[BX],00
12B3:170A 7414           JZ     1720        ; konec prost©ed¡
12B3:170C 8D7701       * LEA    SI,[BX+01]  ; konec textu
12B3:170F 26803F00       CMP    Byte Ptr ES:[BX],00
12B3:1713 7404           JZ     1719        ; konec ©etˆzce
12B3:1715 89F3           MOV    BX,SI
12B3:1717 EBF3           JMP    170C 
12B3:1719 89F3         * MOV    BX,SI       ; adresa dal¨¡ho textu
12B3:171B 42             INC    DX          ; zv˜¨en¡ ‡¡ta‡e ©etˆzc–
12B3:171C EBE8           JMP    1706        ;

12B3:171E EB59         * JMP    1779

; ------ vytvo©en¡ bufferu pro £schov– ©etˆzc– prost©ed¡

12B3:1720 89D8         * MOV    AX,BX       ; konec prost©ed¡
12B3:1722 29F8           SUB    AX,DI       ; d‚lka prost©ed¡
12B3:1724 E872FA         CALL   1199        ; p©idˆlen¡ bufferu pro prost©ed¡
12B3:1727 89C1           MOV    CX,AX       ; adresa bufferu prost©ed¡
12B3:1729 89C3           MOV    BX,AX 
12B3:172B 85C0           TEST   AX,AX       ; byl bufferu vytvo©en ?
12B3:172D 744A           JZ     1779        ; nebyl vytvo©en - nedostatek m¡sta

; ------ vytvo©en¡ buffer– pro tabulku adres ©etˆzc– prost©ed¡

12B3:172F 89D0           MOV    AX,DX       ; po‡et ©etˆzc–
12B3:1731 D1E0           SHL    AX,1        ; velikost tabulky adres
12B3:1733 83C002         ADD    AX,+02      ; + koncov‚ slovo 0
12B3:1736 E860FA         CALL   1199        ; p©idˆlen¡ bufferu pro tabulku
12B3:1739 A33006         MOV    [0630],AX   ; tabulka adres parametr– prost©ed¡
12B3:173C 85C0           TEST   AX,AX       ; byl buffer pro tabulku vytvo©en ?
12B3:173E 7434           JZ     1774        ; buffer nebyl vytvo©en

; ------ £schova ©etˆzc– prost©ed¡

12B3:1740 31C9           XOR    CX,CX       ; ‡¡ta‡ po‡tu ©etˆzc–
12B3:1742 89FE           MOV    SI,DI       ; ukazatel za‡ tku v prost©ed¡
12B3:1744 8E46FE         MOV    ES,[BP-02]  ; segment prost©ed¡
12B3:1747 31D2           XOR    DX,DX       ; offset v tabulce adres prost©ed¡
12B3:1749 8B3E3006       MOV    DI,[0630]   ; tabulka adres parametr– prost©ed¡
12B3:174D 01D7           ADD    DI,DX       ; adresa v tabulce adres
12B3:174F 891D           MOV    [DI],BX     ; adresa ©etˆzce
12B3:1751 268A04       * MOV    AL,ES:[SI]  ; bajt ©etˆzce z prost©ed¡
12B3:1754 8807           MOV    [BX],AL     ; p©enos bajtu
12B3:1756 43             INC    BX 
12B3:1757 46             INC    SI 
12B3:1758 3C00           CMP    AL,00       ; konec ?
12B3:175A 75F5           JNZ    1751        ; nen¡ konec - dal¨¡ bajt
12B3:175C 83C202         ADD    DX,+02      ; zv˜¨en¡ offsetu v tabulce adres
12B3:175F 41             INC    CX          ; zv˜¨en¡ ‡¡ta‡e ©etˆzc–
12B3:1760 26803C00       CMP    Byte Ptr ES:[SI],00 ; je konec prost©ed¡ ?
12B3:1764 75E3           JNZ    1749        ; nen¡ konec - dal¨¡ ©etˆzec
12B3:1766 D1E1           SHL    CX,1        ; po‡et ©etˆzc– * 2
12B3:1768 8B1E3006       MOV    BX,[0630]   ; tabulka adres parametr– prost©ed¡
12B3:176C 01CB           ADD    BX,CX       ; konec tabulky adres parametr–
12B3:176E C7070000       MOV    Word Ptr [BX],0000 ; ozna‡en¡ konce tabulky
12B3:1772 EB05           JMP    1779 

; ------ p©i chybˆ zru¨en¡ vytvo©en‚ho bufferu prost©ed¡

12B3:1774 89C8           MOV    AX,CX       ; p©i chybˆ zru¨en¡ buff. prost©ed¡
12B3:1776 E8E7FB         CALL   1360        ; zru¨en¡ datov‚ho bufferu

12B3:1779 89EC         * MOV    SP,BP
12B3:177B 5D             POP    BP 
12B3:177C 07             POP    ES 
12B3:177D 5F             POP    DI 
12B3:177E 5E             POP    SI 
12B3:177F 5A             POP    DX 
12B3:1780 59             POP    CX 
12B3:1781 5B             POP    BX 
12B3:1782 C3             RET     

; -----------------------------------------------------------------------------
;        test, zda je soubor znakov‚ za©¡zen¡ (AX=1 je)
; -----------------------------------------------------------------------------

12B3:1783 53           * PUSH   BX
12B3:1784 51             PUSH   CX 
12B3:1785 52             PUSH   DX 
12B3:1786 89C3           MOV    BX,AX       ; identifik tor souboru
12B3:1788 B80044         MOV    AX,4400 
12B3:178B CD21           INT    21          ; poskytnut¡ informac¡ o souboru
12B3:178D 19C9           SBB    CX,CX       ; CX <- chybov˜ k¢d
12B3:178F F6C280         TEST   DL,80       ; je to soubor na disku ?
12B3:1792 7405           JZ     1799        ; je to soubor
12B3:1794 B80100         MOV    AX,0001     ; je to za©¡zen¡
12B3:1797 EB02           JMP    179B 
12B3:1799 31C0         * XOR    AX,AX
12B3:179B 5A           * POP    DX
12B3:179C 59             POP    CX 
12B3:179D 5B             POP    BX 
12B3:179E C3             RET

; -----------------------------------------------------------------------------
;        test typu procesoru (0=8086, 1=80186, 2=80286, 3=80386, 4=80486)
; -----------------------------------------------------------------------------

179f 00

12b3:17a0 53             PUSH   BX
12b3:17a1 51             PUSH   CX
12B3:17A2 52             PUSH   DX 

; ------ test, zda je 80186 a ni‘¨¡ (bity 12 a‘ 15 registru p©¡znak– st le "1")

12B3:17A3 9C             PUSHF              ; £schova F
12B3:17A4 33C0           XOR    AX,AX       ; AX <- 0
12B3:17A6 50             PUSH   AX 
12B3:17A7 9D             POPF               ; F <- 0
12B3:17A8 9C             PUSHF              ; F do z sobn¡ku
12B3:17A9 58             POP    AX          ; AX <- F
12B3:17AA 2500F0         AND    AX,F000
12B3:17AD 3D00F0         CMP    AX,F000     ; je 8086 nebo 80186 ?
12B3:17B0 7436           JZ     17E8

; ------ test, zda je 80286 (bity 12 a‘ 15 registru p©¡znak– st le "0")

12B3:17B2 B800F0         MOV    AX,F000     ; AX <- 0f000h
12B3:17B5 50             PUSH   AX 
12B3:17B6 9D             POPF               ; F <- 0f000h
12B3:17B7 9C             PUSHF   
12B3:17B8 58             POP    AX          ; AX <- F
12B3:17B9 2500F0         AND    AX,F000     ; je 80286 ?
12B3:17BC 7425           JZ     17E3        ; je 80286

; ------ test, zda je 80486 a vy¨¨¡ (bit 19 dvojregistru p©¡znak– lze mˆnit)

12B3:17BE 8BDC           MOV    BX,SP       ; £schova SP
12B3:17C0 83E4FC         AND    SP,0fffch   ; zarovn n¡ SP na dvojslovo
12B3:17C3 669C           PUSHFD             ; £schova dvojslova F
12B3:17C5 5A             POP    DX          ; DX <- F LOW
12B3:17C6 58             POP    AX          ; AX <- F HIGH
12B3:17C7 8BC8           MOV    CX,AX       ; £schova F HIGH
12B3:17C9 350400         XOR    AX,0004     ; zmˆna p©¡znakov‚ho bitu 19
12B3:17CC 50             PUSH   AX          ; n vrat F HIGH
12B3:17CD 52             PUSH   DX          ; n vrat F LOW
12B3:17CE 669D           POPFD              ; F <- p–vodn¡ stav, zmˆnˆn bit 19
12B3:17D0 669C           PUSHFD             ; F do z sobn¡ku
12B3:17D2 5A             POP    DX          ; DX <- F LOW
12B3:17D3 58             POP    AX          ; AX <- nov˜ stav F HIGH
12B3:17D4 33C1           XOR    AX,CX       ; byla zmˆna bitu 19 ?
12B3:17D6 C1E802         SHR    AX,02       ; zmˆnˆn˜ bit do bitu 0
12B3:17D9 250100         AND    AX,0001     ; 0 (=80386) nebo 1 (=80486)
12B3:17DC 8BE3           MOV    SP,BX       ; n vrat SP
12B3:17DE 050300         ADD    AX,0003     ; 3 (=80386) nebo 4 (=80486)
12B3:17E1 EB07           JMP    17EA        ; je 80386 nebo 80486

; ------ je 80286

12B3:17E3 B80200       * MOV    AX,0002
12B3:17E6 EB02           JMP    17EA 

; ------ je CPU 8086 a‘ 80186

12B3:17E8 33C0         * XOR    AX,AX

12B3:17EA 9D           * POPF
12B3:17EB 5A             POP    DX
12B3:17EC 59             POP    CX 
12B3:17ED 5B             POP    BX 
12B3:17EE CB             RETF    

17ff     db        0

; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°
;
;                            Datov˜ segment
;
; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°

;þ

0000     db        20h dup(1)               ; identifik. soubor–

0020     dw        0

1432:0020  00 00 65 0A 5C 00 00 00-00 00 00 00 00 00 00 00  ..e.\...........

0022     dw        0a65h                    ; adresa hlavn¡ procedury MAIN

002e     dd        0

0032     dw        0                        ; ‡¡ta‡ nalezen˜ch soubor–

0035     db        1                        ; p©ep¡na‡ - test jm‚na programu FOX

1432:0030  01 00 00 00 FF 01 FF FF-00 00 D0 07 2D 63 25 37  ..........P.-c%7

0036     db        0ffh                     ; 1=p©¡znak parametru "X"
0037     db        0ffh                     ; 1=p©¡znak vhodnosti hardware pro X
0038     dw        0                        ; p©¡znak parametru "Z"
003a     dw        2000                     ; voln  pamˆŸ (parametr "Mn")

1432:0040  23 00 64 95 65 33 93 73-43 43 13 76 66 26 26 26  #.d.e3.sCC.vf&&&
1432:0050  26 57 36 00 64 95 D4 33-83 43 93 23 63 F6 57 86  &W6.d.T3.C.#cvW.
1432:0060  26 26 26 B7 26 00 3D 3D-46 58 53 54 3D 3D 01 00  &&&7&.==FXST==..
1432:0070  07 00 2F 00 EA 04 00 00-12 00 28 00 36 00 41 00  ../.j.....(.6.A.

; -----------------------------------------------------------------------------
;        tabulka adres zak¢dovan˜ch text–
; -----------------------------------------------------------------------------

0072     dw        002fh                    ; adresa tabulky

                                            ; tabulka adres chyb. hl ¨en¡
0076     dw        0
         dw        12h
         dw        28h
         dw        36h
         ....
         a‘ po 00d4h (hl ¨en¡ 0 a‘ 2eh)

1432:0080  4E 00 82 00 8D 00 D0 00-17 01 5F 01 A2 01 E6 01  N.....P..._.".f.
1432:0090  05 02 3C 02 75 02 8A 02-A5 02 B8 02 DE 02 EA 02  ..<.u...%.8.^.j.
1432:00A0  F3 02 F8 02 02 03 0C 03-18 03 1A 03 25 03 31 03  s.x.........%.1.
1432:00B0  3D 03 4A 03 55 03 61 03-64 03 79 03 81 03 89 03  =.J.U.a.d.y.....
1432:00C0  97 03 9F 03 AD 03 BB 03-C5 03 CF 03 D3 03 D6 03  ....-.;.E.O.S.V.
1432:00D0  F1 03 18 04

; -----------------------------------------------------------------------------
;        zak¢dovan‚ texty a hl ¨en¡
; -----------------------------------------------------------------------------

00d4

db 'FOXL - FoxPro/LAN',0                    ; 0
db 'FOXR - FoxPro Runtime',0                ; 1
db 'FOXS - FoxPro',0                        ; 2
db 'FoxPro EXE',0                           ; 3
db 'FOX - FoxPro',0                         ; 4
db ' Loader - V2.0 - (c) Copyright Fox Holdings 1991 ',13,10,10,0 ; 5
db 'Options:',13,10,0                       ; 6
db '    +L    Load LAN version          -L    Don't load LAN version',13,10,0 ; 7
db '    +R    Load runtime version      -R    Don't load runtime version',13,10,0 ; 8
db '    +X    Load extended version     -X    Don't load extended version',13,10,0 ; 9
db '    -M<n> With <n> Kb memory free, run X version (Default: 2000)',13,10,0 ; 0ah
db '    -Y    Exits with errorlevel = 1 if computer can run X version',13,10,0 ; 0bh
db '    /?    Display help text',13,10,0    ; 0ch
db 'All other command line options are passed to FoxPro',13,10,0 ; 0dh
db 'If none of the above are specified, the first found of',13,10,0 ; 0eh
db 'FOXPROLX and FOXPROL',0                 ; 0fh
db 'FOXPROX.ESL and FOXPRO.ESL',0           ; 10h
db 'FOXPROX and FOXPRO',0                   ; 11h
db 'FOXPROLX, FOXPROL, FOXPRO and FOXPRO',0 ; 12h
db ' is used.',13,10,0                      ; 13h
db 'EMMXXXX0',0                             ; 14h
db 'PATH',0                                 ; 15h
db 'FOXPROSWX',0                            ; 16h
db 'FOXPRO*.*',0                            ; 17h
db 'FOXPRO*.ESL',0                          ; 18h
db '\',0                                    ; 19h
db 'FOXPRO.EXE',0                           ; 1ah
db 'FOXPROX.EXE',0                          ; 1bh
db 'FOXPROL.EXE',0                          ; 1ch
db 'FOXPROLX.EXE',0                         ; 1dh
db 'FOXPRO.ESL',0                           ; 1eh
db 'FOXPROX.ESL',0                          ; 1fh
db 13,10,0                                  ; 20h
db 'Processor (80x86) : ',0                 ; 21h
db 'DPMI : ',0                              ; 22h
db 'VCPI : ',0                              ; 23h
db 'EMS (in K) : ',0                        ; 24h
db 'PM   : ',0                              ; 25h
db 'XMS (in K) : ',0                        ; 26h
db 'Ext (in K) : ',0                        ; 27h
db 'Found :',13,10,0                        ; 28h
db 'FoxPro : ',0                            ; 29h
db 'Yes',0                                  ; 2ah
db 'No',0                                   ; 2bh
db 'Invalid compact EXE file',13,10,0       ; 2ch
db 'Cannot run on DOS before version 3.0',13,10,0 ; 2dh
db 'Cannot locate the desired version of FoxPro',13,10,0 ; 2eh

                                         00 00 00 00 00 00  ..7pA.v!........
1432:0520  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0530  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0540  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0550  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0560  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0570  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0580  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0590  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:05A0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:05B0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 85 0B  ................
1432:05C0  85 0B 85 0B 85 0B 00 00-00 00 00 00 00 00 00 00  ................

05c6     dw        0                        ; uschovan˜ registr SP (konec dat)
05c8     dw        0                        ; zarovnan˜ konec datov‚ho segmentu
                                            ; (sou‡asn˜ konec datov‚ haldy v B)

05ca     dw        0                        ; £schova PSP

05cc     db        0                        ; verze syst‚mu
05cd     db        0                        ; podverze syst‚mu

05ce     dw        0

05d0     dw        0                        ; maxim ln¡ spodn¡ hranice z sobn¡ku

05d2     dw        0                        ; offset konce datov‚ho segmentu
                                            ; (se z sobn¡kem)

05d4     dw        0                        ; p©¡znak prov dˆn¡ ext. programu

05d6     dw        0                        ; p©¡znak parametru "NO87"
05d8     dw        0

1432:05D0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:05E0  00 00 00 00 00 00 00 00-E6 05 E6 05 E6 05 00 00  ........f.f.f...

05e8     dw        5e6h

1432:05F0  00 00 00 00 67 14 67 14-00 00 00 00 00 00 00 00  ....g.g.........

05f2     dw        0                        ; ukazatel konce haldy buffer–

; ------ FCB soubor–

05f8     db        10h dup(0)               ; FCB1
0608     db        10h dup(0)               ; FCB2

; ------ tabulka bloku parametr– pro start programu

0618     dw        0                        ; segment prost©ed¡
061a     dd        0                        ; adresa p©¡kazov‚ho © dku
061e     dd        0                        ; adresa FCB1
0622     dd        0                        ; adresa FCB2

1432:0620  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0630  00 00 00 20 01 00 00 09-01 01 0B 06 04 05 05 05  ... ............

0630                                        ; tabulka adres parametr– prost©ed¡

1432:0640  02 03 FF FF FF 08 06 08-01 FF 14 00 01 00 02 00  ................

; ------ tabulka standardn¡ch za©¡zen¡ (bit 6=p©¡znak znakov‚ho za©¡zen¡)

064c     dw        1
064e     dw        2
0650     dw        2
0652     dw        3
0654     dw        2

1432:0650  02 00 03 00 02 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0660  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
1432:0670  00 00 00 00 E0 16 FE F2-FF FF 0A 02 06 00 00 00  ....`.~r........

0674     dw        16e0h                    ; obsluha vytvo©en¡ tabulky prost©ed¡

0676     db        20eh dup(?)              ; adresa obsluhy ovlada‡e XMS

06f6     db                                 ; jm‚no nalezen‚ho soub. FOXPRO.ESL
0779     db                                 ; jm‚no nalezen‚ho soub. FOXPROX.ESL


07fc     db                                 ; jm‚no programu PROSDEMO.EXE

1432:0890                                   ; buffer textu z p©¡kazov‚ho © dku

; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°
;
;                        Segment z sobn¡ku
;
; °°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°

14BB:0000          db     800h dup(?)       ; z sobn¡k

CONTEXT   0 241   2   3  72






; *****************************************************************************
;
;                              Modul TDOS.SYS
;
; *****************************************************************************

0000:0000 E90F41         JMP    4112             ; start a inicializace modulu

                                               ;* po‡ te‡n¡ ovlada‡ (CON)
0000:0003                db     3,'DEV'
0000:0007                dd     ffff:ffff
0000:000b                db     5

0000:000d                db     0                ; <- 3
0000:000E                db     0                ; <- 2
0000:000f                db     0                ; <- 0
0000:0010                db     0                ; <- 0

0000:0011                db     7 dup(0)         ; jm‚no za©¡zen¡

0000:0018                db     12 dup(0)

0000:0024                db     0                ; <- 0c3h

0000:0025                dd     0                ; adresa za©¡zen¡ CON


0000:0020  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:0030  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:0040  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:0050  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:0060  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:0070  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:0080  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:0090  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:00A0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:00B0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:00C0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:00D0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 03 80  ................

0000:00d5                db     0                ; (073f)
0000:00d6                dw     0                ; n vratov˜ k¢d z programu

0000:00da                db     0                ; bit 0: p©¡znak ^P
0000:00db                db     0                ; bit 0: p©ep¡na‡ VERIFY

0000:00df                dd     0                ; adresa diskov˜ch p©enos– DTA

0000:00E0  00 00 00 00 00 2F FF 00-00 00 00 00 00 00 00 00  ...../..........

0000:00e3                dw     0                ; velikost pamˆti v odstavc¡ch
0000:00e5                db     "/"              ; oddˆlovac¡ znak parametr–

0000:00e7                dw     0                ; 1. nalezen˜ dosta‡.alok.blok
0000:00e9                dw     0                ; nejmen¨¡ dostate‡. alok. blok
0000:00eb                dw     0                ; posledn¡ nalezen˜ alok. blok

0000:00ed                db     0                ; strategie p©idˆlov n¡ pamˆti
                                                 ;  0=pou‘¡t prvn¡ dosta‡. blok
                                                 ;  1=pou‘¡t nejmen¨¡ dost. blok
                                                 ;  2=nejvy¨¨¡ ‡ st posl. bloku
0000:00ee                dw     0                ; segment 1. alok. bloku pamˆti
                                               ;* defini‡n¡ tabulka DOS
0000:00f0                dd     0                ; 0: adr. ©¡d. blok– za©. DOS
0000:00f4                dd     7                ; 4: adresa tabulky soub. DOS
0000:00f8                dd     0                ; 8: adresa za©¡zen¡ CLOCK$
0000:00fc                dd     0                ; 0ch: adresa za©¡zen¡ CON
0000:0100                db     0                ; 10h: po‡et instal. log.disk–
0000:0101                dw     0                ; 11h: maxim ln¡ velik. sektoru
0000:0103                dd     0                ; 13h: prvn¡ diskov˜ buffer


                                               ;* za‡ tek ©etˆzce za©¡zen¡
                                               ;* (nulov‚ za©¡zen¡ NUL)
0000:0107                dd     0                ; ukazatel na za©¡zen¡ CON
0000:010b                dw     8004h            ; atributy - nulov‚ za©¡zen¡
0000:010d                dw     8cch             ; rutina strategie NUL
0000:010f                dw     8d7h             ; rutina p©eru¨en¡ NUL
0000:0111                db     'NUL     '

0000:0119                db     0                ; aktu ln¡ den
0000:011a                db     0                ; aktu ln¡ mˆs¡c
0000:011b                dw     0                ; aktu ln¡ rok

0000:011f                db     0                ; aktu ln¡ den v t˜dnu


0000:0110  08 4E 55 4C 20 20 20 20-20 00 00 00 00 FF FF 00  .NUL     .......
0000:0120  00 00 00 00 00 FF 00 01-00 FF FF FF FF 00 00 00  ................

0000:0120                db     0                ; aktivn¡ logick˜ disk
0000:0121                dw     0                ; po‡ te‡n¡ sektor ROOT
0000:0123                db     0                ; p©¡znak obsluhy DOS

0000:0124                db     0                ; p©¡znak z sobn¡ku znak.funkc¡
0000:0125                db     0ffh             ; disk
0000:0126                db     0                ; (0736)
0000:0127                db     1                ; (073a)
0000:0128                db     0                ; p©ep¡na‡ BREAK
0000:0129                dd     -1               ; ukaz.bufferu posledn¡ operace

                                               ;* z hlav¡ za©¡zen¡
0000:012d                db     0                ; 0: d‚lka z hlav¡
0000:012e                db     0                ; 1: ‡¡slo jednotky
0000:012f                db     0                ; 2: k¢d povelu
0000:0130                dw     0                ; 3: stavov‚ slovo za©¡zen¡
0000:0132                db     8 dup(0)         ; 5: rezervov no

0000:013a                db     0                ; 0dh: po‡et instalov. disk–
0000:013b                db     0                ; 0eh: p©¡znak zmˆny m‚dia

0000:013f                dd     0                ; 12h: adresa bloku param. BPB

0000:0130  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:0140  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................

0000:0143                dd     0                ; adresa obsluhy za©¡zen¡

0000:0147                                        ; z hlav¡ za©¡zen¡ pro konzolu

0000:014a                dw     0                ; stavov‚ slovo za©¡z. (konz.)

0000:0150  00 00 00 00 00 00 00 00-00 00 00 00 00 0E 00 05  ................

0000:0154                db     0                ; popisova‡ m‚dia (konzola)
0000:0155                dd     0                ; adr. DTA pro obsluhu konzoly

                                               ;* z hlav¡ za©¡zen¡ pro CON
0000:015d                db     0eh              ; d‚lka po‘adavku za©¡zen¡
0000:015e                db     0                ; (‡¡slo jednotky - nedef.)
0000:015f                db     5                ; k¢d povelu
0000:0160                dw     0                ; stavov‚ slovo za©¡zen¡


0000:0160  00 00 00 00 00 00 00 00-00 00 00 E9 03 00 00 01  ...........i....

0000:016d                dw     0                ; segment za‡ tku TDOS (=CS)

0000:0170  00 00 00 C8 A6 C8 A5 C8-A5 C8 A5 1F 1C 1F 1E 1F  ...H&H%H%H%.....
0000:0180  1E 1F 1F 1E 1F 1E 1F FF-FF FF FF 00 00 00 93 07  ................

0000:0187                dd     -1               ; adresa instalovateln‚ slu‘by

0000:018b                dw     0                ; segment aktivn¡ho PSP
0000:018d                db     0                ; FF=zad na specifikace PSP

0000:018e                dw     793h             ; adresa

0000:0190                db     13,10,'Divide overflow',13,10

0000:01a3                db     13h

0000:01a4                dw     1a8h             ; adr. tab. n rodn¡ch informac¡

                                               ;* tabulky n rodnost. informac¡

                                               ;* USA
0000:01a6                db     18h              ; -2 : d‚lka tabulky
                         db     1                ; -1 : k¢d zemˆ
0000:01a8                dw     0                ; 00h: form t data
                         db     '$',0,0,0,0      ; 02h: znak mˆny
                         db     ',',0            ; 07h: oddˆlova‡ tis¡c–
                         db     '.',0            ; 09h: oddˆlova‡ desetin
                         db     '-',0            ; 0bh: oddˆlova‡ data
                         db     ':',0            ; 0dh: oddˆlova‡ ‡asu
                         db     0                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     0                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ',',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* Francie
0000:01c0                db     18h              ; -2 : d‚lka tabulky
                         db     33               ; -1 : k¢d zemˆ
0000:01c2                dw     1                ; 00h: form t data
                         db     'F',0,0,0,0      ; 02h: znak mˆny
                         db     ' ',0            ; 07h: oddˆlova‡ tis¡c–
                         db     ',',0            ; 09h: oddˆlova‡ desetin
                         db     '/',0            ; 0bh: oddˆlova‡ data
                         db     ':',0            ; 0dh: oddˆlova‡ ‡asu
                         db     3                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ';',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* ›panˆlsko
0000:01da                db     18h              ; -2 : d‚lka tabulky
                         db     34               ; -1 : k¢d zemˆ
0000:01dc                dw     1                ; 00h: form t data
                         db     'ž',0,0,0,0      ; 02h: znak mˆny (Pt)
                         db     '.',0            ; 07h: oddˆlova‡ tis¡c–
                         db     ',',0            ; 09h: oddˆlova‡ desetin
                         db     '/',0            ; 0bh: oddˆlova‡ data
                         db     ':',0            ; 0dh: oddˆlova‡ ‡asu
                         db     3                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ';',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* It lie
0000:01f4                db     18h              ; -2 : d‚lka tabulky
                         db     39               ; -1 : k¢d zemˆ
0000:01f6                dw     1                ; 00h: form t data
                         db     'Lit.',0         ; 02h: znak mˆny
                         db     '.',0            ; 07h: oddˆlova‡ tis¡c–
                         db     ',',0            ; 09h: oddˆlova‡ desetin
                         db     '/',0            ; 0bh: oddˆlova‡ data
                         db     ':',0            ; 0dh: oddˆlova‡ ‡asu
                         db     1                ; 0fh: form t mˆny
                         db     0                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ';',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* Spojen‚ kr lovstv¡
0000:020e                db     18h              ; -2 : d‚lka tabulky
                         db     44               ; -1 : k¢d zemˆ
0000:0210                dw     1                ; 00h: form t data
                         db     'œ',0,0,0,0      ; 02h: znak mˆny (libra)
                         db     ',',0            ; 07h: oddˆlova‡ tis¡c–
                         db     '.',0            ; 09h: oddˆlova‡ desetin
                         db     '-',0            ; 0bh: oddˆlova‡ data
                         db     ':',0            ; 0dh: oddˆlova‡ ‡asu
                         db     0                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ',',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* ›v‚dsko
0000:0228                db     18h              ; -2 : d‚lka tabulky
                         db     46               ; -1 : k¢d zemˆ
0000:022a                dw     2                ; 00h: form t data
                         db     'SEK',0,0        ; 02h: znak mˆny
                         db     '.',0            ; 07h: oddˆlova‡ tis¡c–
                         db     ',',0            ; 09h: oddˆlova‡ desetin
                         db     '-',0            ; 0bh: oddˆlova‡ data
                         db     '.',0            ; 0dh: oddˆlova‡ ‡asu
                         db     2                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ';',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* Nˆmecko
0000:0242                db     18h              ; -2 : d‚lka tabulky
                         db     49               ; -1 : k¢d zemˆ
0000:0244                dw     1                ; 00h: form t data
                         db     'DM',0,0,0       ; 02h: znak mˆny
                         db     '.',0            ; 07h: oddˆlova‡ tis¡c–
                         db     ',',0            ; 09h: oddˆlova‡ desetin
                         db     '.',0            ; 0bh: oddˆlova‡ data
                         db     '.',0            ; 0dh: oddˆlova‡ ‡asu
                         db     0                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ';',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* D nsko
0000:025c                db     18h              ; -2 : d‚lka tabulky
                         db     45               ; -1 : k¢d zemˆ
0000:025e                dw     1                ; 00h: form t data
                         db     'DKR',0,0        ; 02h: znak mˆny
                         db     '.',0            ; 07h: oddˆlova‡ tis¡c–
                         db     ',',0            ; 09h: oddˆlova‡ desetin
                         db     '/',0            ; 0bh: oddˆlova‡ data
                         db     '.',0            ; 0dh: oddˆlova‡ ‡asu
                         db     3                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ';',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* ›v˜carsko
0000:0276                db     18h              ; -2 : d‚lka tabulky
                         db     41               ; -1 : k¢d zemˆ
0000:0278                dw     1                ; 00h: form t data
                         db     'Fr',0,0,0       ; 02h: znak mˆny
                         db     ',',0            ; 07h: oddˆlova‡ tis¡c–
                         db     '.',0            ; 09h: oddˆlova‡ desetin
                         db     '.',0            ; 0bh: oddˆlova‡ data
                         db     '.',0            ; 0dh: oddˆlova‡ ‡asu
                         db     2                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ',',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* Norsko
0000:0290                db     18h              ; -2 : d‚lka tabulky
                         db     47               ; -1 : k¢d zemˆ
0000:0292                dw     1                ; 00h: form t data
                         db     'KR',0,0,0       ; 02h: znak mˆny
                         db     '.',0            ; 07h: oddˆlova‡ tis¡c–
                         db     ',',0            ; 09h: oddˆlova‡ desetin
                         db     '/',0            ; 0bh: oddˆlova‡ data
                         db     '.',0            ; 0dh: oddˆlova‡ ‡asu
                         db     2                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ';',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;*
0000:02aa                db     18h              ; -2 : d‚lka tabulky
                         db     240              ; -1 : k¢d zemˆ
0000:02ac                dw     1                ; 00h: form t data
                         db     'œ',0,0,0,0      ; 02h: znak mˆny (libra)
                         db     ',',0            ; 07h: oddˆlova‡ tis¡c–
                         db     '.',0            ; 09h: oddˆlova‡ desetin
                         db     '-',0            ; 0bh: oddˆlova‡ data
                         db     ':',0            ; 0dh: oddˆlova‡ ‡asu
                         db     0                ; 0fh: form t mˆny
                         db     2                ; 10h: po‡et desetin. m¡st mˆny
                         db     0                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ',',0            ; 16h: oddˆlova‡ seznamu dat

                                               ;* Japonsko
0000:02c4                db     18h              ; -2 : d‚lka tabulky
                         db     81               ; -1 : k¢d zemˆ
0000:02c6                dw     2                ; 00h: form t data
                         db     '',0,0,0,0      ; 02h: znak mˆny (yeny)
                         db     ',',0            ; 07h: oddˆlova‡ tis¡c–
                         db     '.',0            ; 09h: oddˆlova‡ desetin
                         db     '-',0            ; 0bh: oddˆlova‡ data
                         db     ':',0            ; 0dh: oddˆlova‡ ‡asu
                         db     0                ; 0fh: form t mˆny
                         db     0                ; 10h: po‡et desetin. m¡st mˆny
                         db     1                ; 11h: form t ‡asu
                         dd     962h             ; 12h: adresa mapov n¡ znak–
                         dw     ',',0            ; 16h: oddˆlova‡ seznamu dat

0000:02dc                db     0,0ffh           ; konec tabulek

0000:02df                db     0

0000:02e0                db     80h dup(0)       ; vzorov˜ PSP

0000:03E0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:03F0  00 00 00 00 00 00 2E 8B-26 F0 03 2E 8E 16 F2 03  ........&p....r.

0000:03e9                dw     0                ; buffer pro obsluhu konzoly

0000:03ef                                        ; jm‚no obsluhovan‚ho za©¡zen¡



0000:03f0                dd     0                ; z sobn¡k pro n vrat do IO.SYS

0000:03f4                dw     0                ; d‚lka modulu TDOS.SYS
; -----------------------------------------------------------------------------
;         N vrat do modulu TBIOS.SYS
; -----------------------------------------------------------------------------
0000:03F6 2E8B26F003     MOV    SP,CS:[03F0]     ; z sobn¡k pro n vrat do IO.SYS
0000:03FB 2E8E16F203     MOV    SS,CS:[03F2]
0000:0400 F3             REPZ
0000:0401 A4             MOVSB                   ; p©esun tabulek disk– na m¡sto
0000:0402 FC             CLD
0000:0403 268916E100     MOV    ES:[00E1],DX     ; segment bloku DTA
0000:0408 8B36F000       MOV    SI,[00F0]        ; adresa tabulky disk. za©¡zen¡
0000:040C 268C06F200     MOV    ES:[00F2],ES     ; CS
0000:0411 268C06F600     MOV    ES:[00F6],ES     ; CS

                                               ;* nastaven¡ adres tab. disk–
0000:0416 8A0E0001       MOV    CL,[0100]        ; po‡et instalovan˜ch log.disk–
0000:041A 32ED           XOR    CH,CH            ; CX = po‡et disk–
0000:041C 268C441A     * MOV    ES:[SI+1A],ES    ;
0000:0420 26C64417FF     MOV    Byte Ptr ES:[SI+17],FF
0000:0425 83C65E         ADD    SI,+5E
0000:0428 E2F2           LOOP   041C
0000:042A 83EE5E         SUB    SI,+5E
0000:042D 26C7441AFFFF   MOV    Word Ptr ES:[SI+1A],FFFF

0000:0433 8B3EF403       MOV    DI,[03F4]        ; d‚lka modulu TDOS.SYS
0000:0437 268C060501     MOV    ES:[0105],ES     ; prvn¡ diskov˜ buffer
0000:043C 26893E0301     MOV    ES:[0103],DI     ; prvn¡ diskov˜ buffer
0000:0441 26C74504FF00   MOV    Word Ptr ES:[DI+04],00FF
0000:0447 26C6450600     MOV    Byte Ptr ES:[DI+06],00
0000:044C 26C705FFFF     MOV    Word Ptr ES:[DI],FFFF
0000:0451 26C74502FFFF   MOV    Word Ptr ES:[DI+02],FFFF
0000:0457 06             PUSH   ES
0000:0458 42             INC    DX               ; adresa k vytvo©en¡ PSP
0000:0459 C6068D01FF     MOV    Byte Ptr [018D],FF ; p©¡znak nucen‚ho vytvo©en¡
0000:045E E88907         CALL   0BEA             ; vytvo©en¡ segmentu PSP
0000:0461 07             POP    ES
0000:0462 50             PUSH   AX
0000:0463 2EA18B01       MOV    AX,CS:[018B]     ; segment aktivn¡ho PSP
0000:0467 26A38B01       MOV    ES:[018B],AX     ; segment aktivn¡ho PSP
0000:046B 26C6068D0100   MOV    Byte Ptr ES:[018D],00
0000:0471 48             DEC    AX
0000:0472 26A3EE00       MOV    ES:[00EE],AX     ; prvn¡ alok. blok pamˆti
0000:0476 1E             PUSH   DS
0000:0477 8ED8           MOV    DS,AX            ; prvn¡ alok. blok pamˆti
0000:0479 C60600005A     MOV    Byte Ptr [0000],5A ; ozna‡en jako posledn¡ blok
0000:047E C70601000000   MOV    Word Ptr [0001],0000 ; je to voln˜ blok
0000:0484 262B06E300     SUB    AX,ES:[00E3]     ; -velikost bloku
0000:0489 F7D8           NEG    AX               ; velikost bloku
0000:048B 48             DEC    AX               ; ode‡ten¡ popisova‡e bloku
0000:048C A30300         MOV    [0003],AX        ; nastaven¡ velikost bloku
0000:048F 1F             POP    DS
0000:0490 58             POP    AX
0000:0491 BF0D00         MOV    DI,000D
0000:0494 B003           MOV    AL,03
0000:0496 AA             STOSB
0000:0497 BFF000         MOV    DI,00F0          ; adresa tabulky disk. za©¡zen¡
0000:049A CB             RETF                    ; n vrat do TBIOS.SYS
                                               ;* VSTUP: ES:DI=def.tab.DOS

0000:03f7                db                      ; 01h: jm‚no souboru


0000:03fb                db                      ; atributy nalezen‚ho souboru

0000:0405                dw


0000:0417                db                      ; 1.bajt zadan‚ho FCB

0000:041b                dd                      ; £schova SS:SP pro slu‘by DOS
                                                 ; (£schova n vratov‚ adresy)

0000:0424                db                      ; chyba ‡ten¡=0, z pisu=1
0000:0425                db                      ; pracovn¡ logick˜ disk
0000:0426                dd                      ; adresa z hlav¡ za©¡zen¡

0000:042a                db                      ; po‡et sektor– na blok
0000:042b                db                      ; zadan˜ disk adres ©e

0000:0435                dw                      ; alok. blok 0 (popisov. m‚dia)
0000:0437                dd                      ; adresa z hlav¡ znak. za©¡zen¡

0000:043d

0000:044b                dw                      ; po‡ te‡n¡ sektor adres ©e
                                                 ; aktu l. aloka‡n¡ blok
0000:044d                db                      ; popisova‡ m‚dia
0000:044e                db                      ; p©¡znak v˜mˆny m‚dia

0000:0469                dd                      ; ukazatel posledn¡ho bufferu

0000:046e                dd                      ; adresa z hlav¡ za©¡zen¡

0000:0478                dd                      ; ukazatel na ovlada‡ za©¡zen¡

0000:047c                dw                      ; £schova registru BX
0000:047e                dw                      ; £schova registru DS
0000:0480                dw                      ; u‘ivatelsk˜ z sobn¡k SP
0000:0482                dw                      ; n vratov˜ k¢d procesu
0000:0484                dw                      ;

0000:0490  58 BF 0D 00 B0 03 AA BF-F0 00 CB 00 00 00 00 00  X?..0.*?p.K.....


0000:04a6                db     80h dup(0)       ; z sobn¡k pro INT 21h
0000:0526                                        ; konec z sobn¡ku pro INT 21h

                         dw     50h dup(0)       ; z sobn¡k pro INT 25h, INT 26h
0000:05c6                                        ; konec z sobn¡ku INT 25h, 26h

0000:05D0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:05E0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................


0000:05e6                db     80h dup(0)       ; z sobn¡k

0000:0666                dd     0                ; n vratov  adresa z INT 21h

0000:0670  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0000:0680  00 00 00 00 00 00 00 00-00 00 00 0D 24 4D 53 2D  ............$MS-

                                               ;* £schova registr– pro slu‘by
                                               ;* 3fh, 40h
0000:0683                dw     0                ; £schova n vratov‚ adresy
0000:0685                dw     0                ; £schova ES
0000:0687                dw     0                ; £schova BX
0000:0689                dw     0                ; po‡et bajt– k z pisu/‡ten¡

0000:068b                db     13,'$'

0000:068d                db     'MS-DOS   Ver 2.11',13,10
0000:06a0                db     'Copyright 1983,84 Microsoft Corp.  '
                         db     13,10,10,'$'

; -----------------------------------------------------------------------------
;         Obsluha INT 20h - ukon‡en¡ programu
; -----------------------------------------------------------------------------
0000:06C7 B400           MOV    AH,01
0000:06C9 EB28           JMP    06F3

; -----------------------------------------------------------------------------
;         Obsluha INT 21h
; -----------------------------------------------------------------------------
0000:06CB 80FCF8         CMP    AH,F8
0000:06CE 7203           JB     06D3             ; ‡¡slo slu‘by men¨¡ ne‘ 0f8h
0000:06D0 E9CA01         JMP    089D             ; obsluha slu‘by 0f8h a vy¨¨¡
0000:06D3 80FC58       * CMP    AH,58            ; kontrola maxim. ‡¡sla slu‘by
0000:06D6 90             NOP
0000:06D7 761A           JBE    06F3             ; ‡¡slo slu‘by je OK

0000:06D9 B000         * MOV    AL,00            ; n vrat. k¢d

; -----------------------------------------------------------------------------
;         Obsluha INT 23h, INT 24h, INT 28h
; -----------------------------------------------------------------------------
0000:06DB CF             IRET
; -----------------------------------------------------------------------------
;         Obsluha slu‘by DOS (vol na jako CALL 5 v PSP)
; -----------------------------------------------------------------------------
                                               ;* skok do slu‘by DOS
                                                 ; (skok se prov d¡ instrukc¡
                                                 ; JMP z adresy 0000:00c0h)

0000:06DC 58             POP    AX               ; zru¨en¡ offsetu n vrat. adr.
0000:06DD 58             POP    AX               ; zru¨en¡ segmentu n vrat. adr.
0000:06DE 2E8F061B04     POP    CS:[041B]        ; £schova n vrat. adresy NEAR
0000:06E3 9C             PUSHF                   ; ulo‘en¡ F pro simulaci IRET
0000:06E4 FA             CLI                     ; z kaz p©eru¨en¡
0000:06E5 50             PUSH   AX               ; segment n vratov‚ adresy
0000:06E6 2EFF361B04     PUSH   CS:[041B]        ; offset NEAR n vratov‚ adresy
0000:06EB 80F924         CMP    CL,24            ; max. ‡¡slo slu‘bu 24h
0000:06EE 90             NOP
0000:06EF 77E8           JA     06D9             ; p©¡li¨ velk‚ ‡¡slo slu‘by
0000:06F1 8AE1           MOV    AH,CL            ; ‡¡slo po‘adovan‚ slu‘by

                                               ;* v AH ‡¡slo slu‘by (‡¡slo OK)
0000:06F3 E8DC00       * CALL   07D2             ; £schova v¨ech registr–
0000:06F6 2E8C1E7E04     MOV    CS:[047E],DS     ; £schova DS
0000:06FB 2E891E7C04     MOV    CS:[047C],BX     ; £schova BX
0000:0700 8CCB           MOV    BX,CS
0000:0702 8EDB           MOV    DS,BX            ; DS <- CS
0000:0704 FE062301       INC    Byte Ptr [0123]  ; p©¡znak obsluhy DOS
0000:0708 A11B04         MOV    AX,[041B]
0000:070B A36806         MOV    [0668],AX        ; n vratov  adresa z INT 21h
0000:070E A11D04         MOV    AX,[041D]
0000:0711 A36606         MOV    [0666],AX
0000:0714 58             POP    AX               ; ‡¡slo funkce (AX)
0000:0715 50             PUSH   AX
0000:0716 89261B04       MOV    [041B],SP        ; £schova SP
0000:071A 8C161D04       MOV    [041D],SS        ; £schova SS
0000:071E 8E1E8B01       MOV    DS,[018B]        ; segment aktivn¡ho PSP
0000:0722 89262E00       MOV    [002E],SP        ; £schova SP
0000:0726 8C163000       MOV    [0030],SS        ; £schova SS
0000:072A 8CCB           MOV    BX,CS
0000:072C 8ED3           MOV    SS,BX            ; SS <- CS
0000:072E BC2605         MOV    SP,0526          ; z sobn¡k pro INT 21h
0000:0731 FB             STI                     ; povolen¡ p©eru¨en¡
0000:0732 0E             PUSH   CS
0000:0733 1F             POP    DS               ; DS <- CS
0000:0734 32FF           XOR    BH,BH            ; BH <- 0
0000:0736 883E2601       MOV    [0126],BH        ; <- 0
0000:073A C606270101     MOV    Byte Ptr [0127],01 ; <- 1
0000:073F C606D50000     MOV    Byte Ptr [00D5],00 ; <- 0
0000:0744 8ADC           MOV    BL,AH            ; ‡¡slo funkce
0000:0746 D1E3           SHL    BX,1             ; ‡¡slo funkce * 2
0000:0748 FC             CLD
0000:0749 0AE4           OR     AH,AH            ; je funkce 0 ?
0000:074B 741B           JZ     0768             ; je funkce 0
0000:074D 80FC0C         CMP    AH,0C            ; je znakov  funkce ?
0000:0750 760A           JBE    075C             ; je znakov  funkce
0000:0752 80FC51         CMP    AH,51            ;
0000:0755 7405           JZ     075C             ; poskytnut¡ tabulky DOS
0000:0757 80FC50         CMP    AH,50
0000:075A 750C           JNZ    0768
                                               ;* opakovanˆ volateln‚ funkce
0000:075C 803E240100   * CMP    Byte Ptr [0124],00 ; p©¡znak z sobn¡ku znak.funkc¡
0000:0761 751E           JNZ    0781             ; blokov n¡ z sobn¡ku znak.funkc¡
0000:0763 BC6606         MOV    SP,0666          ; z sobn¡k
0000:0766 EB19           JMP    0781

                                               ;* nejsou znakov‚ funkce
0000:0768 C606240100   * MOV    Byte Ptr [0124],00 ; p©¡znak z sobn¡ku znak.funkc¡
0000:076D C6062501FF     MOV    Byte Ptr [0125],FF ; disk
0000:0772 BCC605         MOV    SP,05C6          ; z sobn¡k pro diskov‚ operace
0000:0775 F6062801FF     TEST   Byte Ptr [0128],FF ; p©ep¡na‡ BREAK
0000:077A 7405           JZ     0781             ; nen¡ p©ep¡na‡ BREAK
0000:077C 50             PUSH   AX               ; £schova povelu AX
0000:077D E87324         CALL   2BF3             ; obsluha p©eru¨en¡ BREAK
0000:0780 58             POP    AX               ; n vrat povelu AX

0000:0781 FF368E01     * PUSH   [018E]           ; adresa pokra‡ov n¡ 0793h
0000:0785 2EFFB7E807     PUSH   CS:[BX+07E8]     ; adresa skoku do slu‘by
0000:078A 8B1E7C04       MOV    BX,[047C]        ; n vrat BX
0000:078E 8E1E7E04       MOV    DS,[047E]        ; n vrat DS
0000:0792 C3             RET                     ; skok do slu‘by DOS


                                               ;* n vrat ze slu‘by DOS
0000:0793 FA             CLI                     ; z kaz p©eru¨en¡
0000:0794 2EFE0E2301     DEC    Byte Ptr CS:[0123] ; p©¡znak obsluhy DOS
0000:0799 2E8B261B04     MOV    SP,CS:[041B]     ; n vrat SP
0000:079E 2E8E161D04     MOV    SS,CS:[041D]     ; n vrat SS
0000:07A3 8BEC           MOV    BP,SP
0000:07A5 884600         MOV    [BP+00],AL       ; navr cen˜ AL
0000:07A8 2EA16806       MOV    AX,CS:[0668]     ;
0000:07AC 2EA31B04       MOV    CS:[041B],AX     ; n vrat
0000:07B0 2EA16606       MOV    AX,CS:[0666]
0000:07B4 2EA31D04       MOV    CS:[041D],AX
0000:07B8 E80300         CALL   07BE             ; n vrat v¨ech registr–
0000:07BB CF             IRET

0000:07BC 0000           dw     0                ; mezi£schova n vratov‚ adresy
; -----------------------------------------------------------------------------
;         N vrat v¨ech registr– ze z sobn¡ku
; -----------------------------------------------------------------------------
0000:07BE 2E8F06BC07     POP    CS:[07BC]        ; £schova n vratov‚ adresy
0000:07C3 58             POP    AX
0000:07C4 5B             POP    BX
0000:07C5 59             POP    CX
0000:07C6 5A             POP    DX
0000:07C7 5E             POP    SI
0000:07C8 5F             POP    DI
0000:07C9 5D             POP    BP
0000:07CA 1F             POP    DS
0000:07CB 07             POP    ES
0000:07CC 2EFF36BC07   * PUSH   CS:[07BC]        ; n vratov  adresa
0000:07D1 C3             RET                     ; n vrat z podprogramu
; -----------------------------------------------------------------------------
;         —schova v¨ech registr– do z sobn¡ku
; -----------------------------------------------------------------------------
0000:07D2 2E8F06BC07     POP    CS:[07BC]        ; £schova n vratov‚ adresy
0000:07D7 06             PUSH   ES
0000:07D8 1E             PUSH   DS
0000:07D9 55             PUSH   BP
0000:07DA 57             PUSH   DI
0000:07DB 56             PUSH   SI
0000:07DC 52             PUSH   DX
0000:07DD 51             PUSH   CX
0000:07DE 53             PUSH   BX
0000:07DF 50             PUSH   AX
0000:07E0 EBEA           JMP    07CC             ; n vrat
; -----------------------------------------------------------------------------
;         Nastaven¡ ukazatele na registry
; -----------------------------------------------------------------------------
                                                 ; [SI+00h] AX
                                                 ; [SI+02h] BX
                                                 ; [SI+04h] CX
                                                 ; [SI+06h] DX
                                                 ; [SI+08h] SI
                                                 ; [SI+0ah] DI
                                                 ; [SI+0ch] BP
                                                 ; [SI+0eh] DS
                                                 ; [SI+10h] ES
                                                 ; [SI+12h] IP
                                                 ; [SI+14h] CS
                                                 ; [SI+16h] F

0000:07E2 2EC5361B04     LDS    SI,CS:[041B]     ; ukazatel z sobn¡ku
0000:07E7 C3             RET
; -----------------------------------------------------------------------------
;         Tabulka adres obsluh slu‘eb DOS
; -----------------------------------------------------------------------------
0000:07e8                dw     0a0dh            ; 0
                         dw     35a2h            ; 1
                         dw     35abh            ; 2
                         dw     363eh            ; 3
0000:07f0                dw     365bh            ; 4
                         dw     3661h            ; 5
                         dw     0b4dh            ; 6
                         dw     0b79h            ; 7
0000:07f8                dw     3675h            ; 8
                         dw     3684h            ; 9
                         dw     3690h            ; 0ah
                         dw     3851h            ; 0bh
0000:0800                dw     385bh            ; 0ch
                         dw     0b1fh            ; 0dh
                         dw     0dd7h            ; 0eh
                         dw     2a61h            ; 0fh
0000:0808                dw     2ac7h            ; 10h
                         dw     0a37h            ; 11h
                         dw     0a98h            ; 12h
                         dw     2957h            ; 13h
0000:0810                dw     28e7h            ; 14h
                         dw     28efh            ; 15h
                         dw     2b39h            ; 16h
                         dw     29d5h            ; 17h
0000:0818                dw     089ah            ; 18h
                         dw     0dd2h            ; 19h
                         dw     0daah            ; 1ah
                         dw     09dbh            ; 1bh
0000:0820                dw     09ddh            ; 1ch
                         dw     089ah            ; 1dh
                         dw     089ah            ; 1eh
                         dw     0db5h            ; 1fh
0000:0828                dw     089ah            ; 20h
                         dw     28ffh            ; 21h
                         dw     2907h            ; 22h
                         dw     0aceh            ; 23h
0000:0830                dw     0b0ch            ; 24h
                         dw     0df5h            ; 25h
                         dw     0beah            ; 26h
                         dw     290fh            ; 27h
0000:0838                dw     2917h            ; 28h
                         dw     0bd9h            ; 29h
                         dw     2852h            ; 2ah
                         dw     286fh            ; 2bh
0000:0840                dw     288fh            ; 2ch
                         dw     28a0h            ; 2dh
                         dw     0d19h            ; 2eh
                         dw     0d96h            ; 2fh
0000:0848                dw     0c9fh            ; 30h
                         dw     3547h            ; 31h
                         dw     0db7h            ; 32h
                         dw     0d20h            ; 33h
0000:0850                dw     0d3fh            ; 34h
                         dw     0de5h            ; 35h
                         dw     0d57h            ; 36h
                         dw     0e0bh            ; 37h
0000:0858                dw     0cb8h            ; 38h
                         dw     0ea6h            ; 39h
                         dw     1076h            ; 3ah
                         dw     0f56h            ; 3bh
0000:0860                dw     3b95h            ; 3ch
                         dw     3a81h            ; 3dh
                         dw     3ea5h            ; 3eh
                         dw     3f45h            ; 3fh
0000:0868                dw     3f72h            ; 40h
                         dw     3b5eh            ; 41h
                         dw     3f9bh            ; 42h
                         dw     3c12h            ; 43h
0000:0870                dw     3fedh            ; 44h
                         dw     3bd5h            ; 45h
                         dw     3bfch            ; 46h
                         dw     3c61h            ; 47h
0000:0878                dw     117dh            ; 48h
                         dw     128bh            ; 49h
                         dw     126ah            ; 4ah
                         dw     30eeh            ; 4bh
0000:0880                dw     357dh            ; 4ch
                         dw     30a8h            ; 4dh
                         dw     3d5eh            ; 4eh
                         dw     3e0eh            ; 4fh
0000:0888                dw     08bah            ; 50h
                         dw     08c0h            ; 51h
                         dw     0d4bh            ; 52h
                         dw     0e3dh            ; 53h
0000:0890                dw     0d14h            ; 54h
                         dw     0be4h            ; 55h
                         dw     3cach            ; 56h
                         dw     40d9h            ; 57h
0000:0898                dw     12a2h            ; 58h
; -----------------------------------------------------------------------------
;         Slu‘by 18h,1dh,1eh,20h - rezervov no, neobsluhovan  slu‘ba
; -----------------------------------------------------------------------------
0000:089a 32C0           XOR    AL,AL            ; p©¡znak-neobsluhovan  slu‘ba
0000:089c C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 0f8h - nastaven¡ adresy instalovateln‚ obsluhy
; -----------------------------------------------------------------------------
0000:089d 750b           JNZ    08AA             ; nen¡ slu‘ba 0f8h (je vy¨¨¡)
0000:089f 2E89168701     MOV    CS:[0187],DX     ; adresa instalovateln‚ slu‘by
0000:08A4 2E8C1E8901     MOV    CS:[0189],DS
0000:08A9 CF             IRET
; -----------------------------------------------------------------------------
;         Slu‘by 0f9h a vy¨¨¡ - instalovateln‚ obsluhy
; -----------------------------------------------------------------------------
0000:08AA 2E833E8701FF   CMP    Word Ptr CS:[0187],-01 ; je slu‘ba instal. ?
0000:08B0 7503           JNZ    08B5             ; je nainstalovan 
0000:08B2 E924FE         JMP    06D9             ; slu‘ba neinstalov na
0000:08B5 2EFF2E8701   * JMP    FAR CS:[0187]    ; proveden¡ obsluhy
; -----------------------------------------------------------------------------
;         Slu‘ba 50h - nastaven¡ segmentu nov‚ho aktivn¡ho PSP
; -----------------------------------------------------------------------------
0000:08BA 2E891E8B01     MOV    CS:[018B],BX     ; segment aktivn¡ho PSP
0000:08BF C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 51h - poskytnut¡ segmentu aktivn¡ho PSP
; -----------------------------------------------------------------------------
0000:08C0 E81FFF         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:08C3 2EFF368B01     PUSH   CS:[018B]        ; segment aktivn¡ho PSP
0000:08C8 8F4402         POP    [SI+02]          ; nastaven¡ registru BX
0000:08CB C3             RET
; -----------------------------------------------------------------------------
;         Obsluha rutiny strategie NUL
; -----------------------------------------------------------------------------
                                               ;* rutina strategie NUL
0000:08CC 2E891E6E04     MOV    CS:[046E],BX     ; adresa z hlav¡ za©¡zen¡
0000:08D1 2E8C067004     MOV    CS:[0470],ES
0000:08D6 CB             RETF
; -----------------------------------------------------------------------------
;         Obsluha rutiny p©eru¨en¡ NUL
; -----------------------------------------------------------------------------
                                               ;* rutina p©eru¨en¡ NUL
0000:08D7 06             PUSH   ES
0000:08D8 53             PUSH   BX
0000:08D9 2EC41E6E04     LES    BX,CS:[046E]     ; adresa z hlav¡ za©¡zen¡
0000:08DE 26814F030001   OR     Word Ptr ES:[BX+03],0100 ; p©¡znak - akce OK
0000:08E4 5B             POP    BX
0000:08E5 07             POP    ES
0000:08E6 CB             RETF
; -----------------------------------------------------------------------------
;         Obsluha INT 25h
; -----------------------------------------------------------------------------
0000:08E7 FA             CLI                     ; z kaz p©eru¨en¡
0000:08E8 2E8C161D04     MOV    CS:[041D],SS     ; £schova SS
0000:08ED 2E89261B04     MOV    CS:[041B],SP     ; £schova SP
0000:08F2 0E             PUSH   CS
0000:08F3 17             POP    SS               ; SS <- CS
0000:08F4 BCC605         MOV    SP,05C6          ; vlastn¡ z sobn¡k pro INT 25h
0000:08F7 36FE062301     INC    Byte Ptr SS:[0123] ; p©¡znak obsluhy DOS
0000:08FC FB             STI                     ; povolen¡ p©eru¨en¡
0000:08FD FC             CLD                     ; smˆr nahoru
0000:08FE 06             PUSH   ES               ; £schova ES
0000:08FF 1E             PUSH   DS               ; £schova DS
0000:0900 16             PUSH   SS
0000:0901 1F             POP    DS               ; DS <- CS
0000:0902 E8500B         CALL   1455             ; nalezen¡ adresy driveru disku
0000:0905 1F             POP    DS               ; n vrat DS
0000:0906 7206           JB     090E             ; chyba zad n¡ disku
0000:0908 E81714         CALL   1D22             ; operace ‡ten¡ z disku
0000:090B 7401         * JZ     090E             ; operace OK
0000:090D F9             STC                     ; p©¡znak chyby operace
0000:090E 07           * POP    ES
0000:090F FA             CLI
0000:0910 36FE0E2301     DEC    Byte Ptr SS:[0123] ; p©¡znak obsluhy DOS
0000:0915 368B261B04     MOV    SP,SS:[041B]     ; n vrat z sobn¡ku
0000:091A 368E161D04     MOV    SS,SS:[041D]
0000:091F FB             STI                     ; povolen¡ p©eru¨en¡
0000:0920 CB             RETF                    ; n vrat FAR, v z sobn¡ku je F
; -----------------------------------------------------------------------------
;         Obsluha INT 26h
; -----------------------------------------------------------------------------
0000:0921 FA             CLI                     ; z kaz p©eru¨en¡
0000:0922 2E8C161D04     MOV    CS:[041D],SS     ; £schova SS
0000:0927 2E89261B04     MOV    CS:[041B],SP     ; £schova SP
0000:092C 0E             PUSH   CS
0000:092D 17             POP    SS               ; SS <- CS
0000:092E BCC605         MOV    SP,05C6          ; vlastn¡ z sobn¡k INT 25h, 26h
0000:0931 36FE062301     INC    Byte Ptr SS:[0123] ; p©¡znak obsluhy DOS
0000:0936 FB             STI                     ; povolen¡ p©eru¨en¡
0000:0937 FC             CLD                     ; smˆr nahoru
0000:0938 06             PUSH   ES               ; £schova ES
0000:0939 1E             PUSH   DS               ; £schova DS
0000:093A 16             PUSH   SS
0000:093B 1F             POP    DS               ; DS <- CS
0000:093C E8160B         CALL   1455             ; nalezen¡ adresy driveru disku
0000:093F 1F             POP    DS               ; n vrat DS
0000:0940 72CC           JB     090E             ; chyba zad n¡ disku
0000:0942 E80114         CALL   1D46             ; operace z pis na disk
0000:0945 EBC4           JMP    090B             ; n vrat z obsluhy
; -----------------------------------------------------------------------------
;         N vrat z INT 21h s funkc¡ OK
; -----------------------------------------------------------------------------
0000:0947 E898FE       * CALL   07E2             ; nastaven¡ ukazat. na registry
0000:094A FF7416         PUSH   [SI+16]          ; registr p©¡znak–
0000:094D 9D             POPF                    ; n vrat registru p©¡znak–
0000:094E F8             CLC                     ; p©¡znak - operace OK
0000:094F EB0A           JMP    095B             ; ulo‘en¡ registr–
; -----------------------------------------------------------------------------
;         N vrat z INT 21h s chybou CY
; -----------------------------------------------------------------------------
0000:0951 32E4           XOR    AH,AH            ; AX = k¢d chyby
0000:0953 E88CFE         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0956 FF7416         PUSH   [SI+16]          ; registr p©¡znak–
0000:0959 9D             POPF                    ; n vrat registru p©¡znak–
0000:095A F9             STC                     ; p©¡znak chyby operace
0000:095B 8904         * MOV    [SI],AX          ; nastaven¡ registru AX
0000:095D 9C             PUSHF                   ; £schova registru p©¡znak–
0000:095E 8F4416         POP    [SI+16]          ; nastaven¡ reg. p©¡znak–
0000:0961 C3             RET
; -----------------------------------------------------------------------------
;         Procedura pro mapov n¡ n rodn¡ch znak– (USA)
; -----------------------------------------------------------------------------
0000:0962 3C80           CMP    AL,80            ; je n rodn¡ znak ?
0000:0964 7210           JB     0976             ; nen¡ n rodn¡ znak
0000:0966 3CA7           CMP    AL,A7            ; je speci ln¡ znak ?
0000:0968 770C           JA     0976             ; je speci ln¡ (graf.) znak
0000:096A 2C80           SUB    AL,80            ; offset v mapovac¡ tabulce
0000:096C 1E             PUSH   DS               ; £schova DS
0000:096D 53             PUSH   BX               ; £schova BX
0000:096E 0E             PUSH   CS
0000:096F 1F             POP    DS               ; DS <- CS
0000:0970 BB7709         MOV    BX,0977          ; p©evodn¡ tabulka znak–
0000:0973 D7             XLAT                    ; p©evod znaku
0000:0974 5B             POP    BX               ; n vrat BX
0000:0975 1F             POP    DS               ; n vrat DS
0000:0976 CB           * RETF                    ; n vrat FAR
; -----------------------------------------------------------------------------
;         P©evodn¡ tabulka pro mapov n¡ n rodnostn¡ch znak– USA
; -----------------------------------------------------------------------------
0000:0977                db     80h              ; 80h
                         db     9ah              ; 81h
                         db     45h              ; 82h
                         db     41h              ; 83h
                         db     8eh              ; 84h
                         db     41h              ; 85h
                         db     8fh              ; 86h
                         db     80h              ; 87h
                         db     45h              ; 88h
                         db     45h              ; 89h
                         db     45h              ; 8ah
                         db     49h              ; 8bh
                         db     49h              ; 8ch
                         db     49h              ; 8dh
                         db     8eh              ; 8eh
                         db     8fh              ; 8fh
                         db     90h              ; 90h
                         db     92h              ; 91h
                         db     92h              ; 92h
                         db     4fh              ; 93h
                         db     99h              ; 94h
                         db     4fh              ; 95h
                         db     55h              ; 96h
                         db     55h              ; 97h
                         db     59h              ; 98h
                         db     99h              ; 99h
                         db     9ah              ; 9ah
                         db     9bh              ; 9bh
                         db     9ch              ; 9ch
                         db     9dh              ; 9dh
                         db     9eh              ; 9eh
                         db     9fh              ; 9fh
                         db     41h              ; a0h
                         db     49h              ; a1h
                         db     4fh              ; a2h
                         db     55h              ; a3h
                         db     95h              ; a4h
                         db     95h              ; a5h
                         db     96h              ; a6h
                         db     97h              ; a7h

0000:099F 00404D         ADD    [BX+SI+4D],AL


0000:09A2 3B533C         CMP    DX,[BP+DI+3C]
0000:09A5 3E3D3D3F       CMP    AX,3F3D
0000:09A9 4B             DEC    BX
0000:09AA 52             PUSH   DX
0000:09AB 41             INC    CX
0000:09AC 41             INC    CX

0000:09AD CB             RETF
0000:09AE 36BB3744       MOV    BX,4437
0000:09B2 385037         CMP    SS:[BX+SI+37],DL
0000:09B5 3038           XOR    [BX+SI],BH
0000:09B7 3D37C2         CMP    AX,C237
0000:09BA 37             AAA
0000:09BB F5             CMC
0000:09BC 37             AAA
0000:09BD C837EB37       ENTER  EB37,37                       ;'7'
0000:09C1 CD37CD         ESC    19,BP
0000:09C4 37             AAA
0000:09C5 4C             DEC    SP
0000:09C6 38E8           CMP    AL,CH
0000:09C8 AB             STOSW
0000:09C9 2CB1           SUB    AL,B1
0000:09CB 0D57BF         OR     AX,BF57

0000:09CE A009F2         MOV    AL,[F209]
0000:09D1 AE             SCASB
0000:09D2 5F             POP    DI
0000:09D3 D1E1           SHL    CX,1
0000:09D5 8BE9           MOV    BP,CX
0000:09D7 FFA6AD09       JMP    [BP+09AD]
; -----------------------------------------------------------------------------
;         Slu‘ba 1bh - poskytnut¡ informac¡ FAT aktivn¡ho disku
; -----------------------------------------------------------------------------
0000:09DB B200           MOV    DL,00            ; aktivn¡ disk
; -----------------------------------------------------------------------------
;         Slu‘ba 1ch - poskytnut¡ informac¡ FAT specifikovan‚ho disku
; -----------------------------------------------------------------------------
0000:09DD 16             PUSH   SS
0000:09DE 1F             POP    DS               ; DS <- CS
0000:09DF 8AC2           MOV    AL,DL            ; po‘adovan˜ disk
0000:09E1 E8B312         CALL   1C97             ; nastav. pracovn¡ho log. disku
0000:09E4 B0FF           MOV    AL,FF            ; p©¡znak chyby operace
0000:09E6 7215           JB     09FD             ; chyba zad n¡ disku
0000:09E8 E8F818         CALL   22E3             ; poskytnut¡ tabulky disku
0000:09EB 268B560D       MOV    DX,ES:[BP+0D]    ; max. ‡¡slo datov‚ho bloku
0000:09EF 4A             DEC    DX               ; po‡et aloka‡n¡ch blok–
0000:09F0 268A4604       MOV    AL,ES:[BP+04]    ; posledn¡ sektor v bloku
0000:09F4 FEC0           INC    AL               ; po‡et sektor– na blok
0000:09F6 268B4E02       MOV    CX,ES:[BP+02]    ; po‡et bajt– na sektor
0000:09FA 83C516         ADD    BP,+16           ; adresa popisova‡e m‚dia
0000:09FD E8E2FD       * CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0A00 894C04         MOV    [SI+04],CX       ; velikost sektoru v bajtech
0000:0A03 895406         MOV    [SI+06],DX       ; celkov˜ po‡et blok– disku
0000:0A06 896C02         MOV    [SI+02],BP       ; offset ukazatele na popisova‡
0000:0A09 8C440E         MOV    [SI+0E],ES       ; segment ukazatele popisova‡e
0000:0A0C C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 00h - ukon‡en¡ programu
; -----------------------------------------------------------------------------
0000:0A0D 32C0           XOR    AL,AL            ; AL <- 0
0000:0A0F 36C606840400   MOV    Byte Ptr SS:[0484],00

0000:0A15 368A268404     MOV    AH,SS:[0484]
0000:0A1A 36A38204       MOV    SS:[0482],AX
0000:0A1E E8C1FD         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0A21 8E5C14         MOV    DS,[SI+14]       ; CS (adresa PSP programu)
0000:0A24 33C0           XOR    AX,AX            ; AX <- 0
0000:0A26 8EC0           MOV    ES,AX            ; ES <- 0
0000:0A28 BE0A00         MOV    SI,000A          ; adresa s uschovan˜mi vektory
0000:0A2B BF8800         MOV    DI,0088          ; adresa INT 22h
0000:0A2E A5             MOVSW
0000:0A2F A5             MOVSW                   ; n vrat INT 22h
0000:0A30 A5             MOVSW
0000:0A31 A5             MOVSW                   ; n vrat INT 23h
0000:0A32 A5             MOVSW
0000:0A33 A5             MOVSW                   ; n vrat INT 24h
0000:0A34 E90F24         JMP    2E46             ; ukon‡en¡ programu
; -----------------------------------------------------------------------------
;         Slu‘ba 11h - nalezen¡ prvn¡ho souboru s pou‘it¡m FCB
; -----------------------------------------------------------------------------
0000:0A37 E81F0B         CALL   1559             ; nalezen¡ prvn¡ho souboru

0000:0A3A B200         * MOV    DL,00
0000:0A3C 7252           JB     0A90             ; soubor nenalezen
                                               ;* p©evzet¡ diskov˜ch parametr–
0000:0A3E 0AE4           OR     AH,AH            ; nalezen soubor ?
0000:0A40 7805           JS     0A47             ; soubor nenalezen
0000:0A42 A12101         MOV    AX,[0121]        ; po‡ te‡n¡ sektor ROOT
0000:0A45 FEC2           INC    DL               ; aktivn¡ disk
0000:0A47 26894510     * MOV    ES:[DI+10],AX    ; po‡ te‡n¡ sektor ROOT
0000:0A4B A12604         MOV    AX,[0426]        ; adresa ovlada‡e za©¡zen¡
0000:0A4E 26894512       MOV    ES:[DI+12],AX
0000:0A52 A12804         MOV    AX,[0428]
0000:0A55 26894514       MOV    ES:[DI+14],AX
0000:0A59 A14D04         MOV    AX,[044D]        ; popisov.m‚dia, p©¡znak v˜mˆny
0000:0A5C 26894516       MOV    ES:[DI+16],AX    ; popisov.m‚dia, p©¡znak v˜mˆny
0000:0A60 8BF3           MOV    SI,BX
                                               ;* parametry roz¨¡©en‚ho FCB
0000:0A62 C43EDF00       LES    DI,[00DF]        ; adresa diskov˜ch p©enos– DTA
0000:0A66 B8FF00         MOV    AX,00FF          ; roz¨¡©en˜ FCB
0000:0A69 3A061704       CMP    AL,[0417]        ; byl roz¨¡©en˜ FCB ?
0000:0A6D 7509           JNZ    0A78             ; nebyl roz¨¡©en˜ FCB
0000:0A6F AB             STOSW                   ; identif. 0ffh a 0
0000:0A70 FEC0           INC    AL               ; AX <- 0
0000:0A72 AB             STOSW
0000:0A73 AB             STOSW
0000:0A74 A0FB03         MOV    AL,[03FB]        ; atributy souboru
0000:0A77 AA             STOSB
                                               ;* p©enos zbytku FCB
0000:0A78 A02504       * MOV    AL,[0425]        ; pracovn¡ logick˜ disk
0000:0A7B FEC0           INC    AL               ; ‡¡slo disku + 1
0000:0A7D AA             STOSB                   ; ‡¡slo disku se souborem
0000:0A7E 0AD2           OR     DL,DL            ;
0000:0A80 7404           JZ     0A86
0000:0A82 8E1E6B04       MOV    DS,[046B]        ; segment nalezen‚ho FCB
0000:0A86 B91000       * MOV    CX,0010
0000:0A89 F3             REPZ
0000:0A8A A5             MOVSW                   ; p©enos nalezen‚ho FCB
0000:0A8B 32C0           XOR    AL,AL            ; p©¡znak - operace OK
0000:0A8D C3             RET
                                               ;* soubor nenalezen
0000:0A8E 1E           * PUSH   DS
0000:0A8F 07             POP    ES
0000:0A90 B8FFFF       * MOV    AX,FFFF          ; p©¡znak - soub. nenalezen
0000:0A93 26894510       MOV    ES:[DI+10],AX    ; zru¨en¡ sektoru ROOT
0000:0A97 C3           * RET
; -----------------------------------------------------------------------------
;         Slu‘ba 12h - nalezen¡ dal¨¡ho souboru s pou‘it¡m FCB
; -----------------------------------------------------------------------------
0000:0A98 E83825         CALL   2FD3             ; nalezen¡ dal¨¡ho souboru
0000:0A9B 8BFA           MOV    DI,DX
0000:0A9D 72EF           JB     0A8E             ; soubor nenalezen
0000:0A9F 8B4510         MOV    AX,[DI+10]       ; po‡ te‡n¡ sektor ROOT
0000:0AA2 C46D12         LES    BP,[DI+12]       ; adresa ovlada‡e disku
0000:0AA5 0BC0           OR     AX,AX
0000:0AA7 78E5           JS     0A8E             ; soubor nenalezen
0000:0AA9 8B5D16         MOV    BX,[DI+16]       ; popis. m‚dia, p©¡znak v˜mˆny
0000:0AAC 52             PUSH   DX
0000:0AAD 1E             PUSH   DS
0000:0AAE 50             PUSH   AX
0000:0AAF 36892E2604     MOV    SS:[0426],BP     ; adresa z hlav¡ za©¡zen¡
0000:0AB4 368C062804     MOV    SS:[0428],ES
0000:0AB9 E8190C         CALL   16D5             ; inicializace parametr– bloku
0000:0ABC 58             POP    AX
0000:0ABD C7066104FFFF   MOV    Word Ptr [0461],FFFF
0000:0AC3 E8510B         CALL   1617
0000:0AC6 E8F00A         CALL   15B9
0000:0AC9 07             POP    ES
0000:0ACA 5F             POP    DI
0000:0ACB E96CFF         JMP    0A3A             ; ulo‘en¡ parametr–
; -----------------------------------------------------------------------------
;         Slu‘ba 23h - poskytnut¡ velikosti souboru s pou‘it¡m FCB
; -----------------------------------------------------------------------------
0000:0ACE E8880A         CALL   1559             ; poskytnut¡ velikosti souboru
0000:0AD1 B0FF           MOV    AL,FF            ; p©¡znak chyby operace
0000:0AD3 72C2           JB     0A97             ; chyba operace
0000:0AD5 83C721         ADD    DI,+21           ; polo‘ka FCB - relativn¡ z znam
0000:0AD8 268B4DED       MOV    CX,ES:[DI-13]    ; 0eh: d‚lka z znamu souboru
0000:0ADC 0BC9           OR     CX,CX            ; je z znam definovan˜ ?
0000:0ADE 7503           JNZ    0AE3             ; z znam je definovan˜
0000:0AE0 B98000         MOV    CX,0080          ; velikost z znamu 128 bajt–
0000:0AE3 33D2         * XOR    DX,DX            ; DX <- 0
0000:0AE5 46             INC    SI
0000:0AE6 46             INC    SI               ; adresa velikosti souboru
0000:0AE7 8E1E6B04       MOV    DS,[046B]        ; segment s polo‘kou souboru
0000:0AEB 8B4402         MOV    AX,[SI+02]       ; vy¨¨¡ slovo velikosti souboru
0000:0AEE F7F1           DIV    CX               ; p©epo‡et na z znamy
0000:0AF0 50             PUSH   AX               ; £schova vy¨¨¡ho slova z znam–
0000:0AF1 AD             LODSW                   ; ni‘¨¡ slovo velikosti souboru
0000:0AF2 F7F1           DIV    CX               ; p©epo‡et na z znamu
0000:0AF4 0BD2           OR     DX,DX            ; zbytek v z znamu
0000:0AF6 5A             POP    DX               ; n vrat vy¨¨¡ho slova z znam–
0000:0AF7 7404           JZ     0AFD             ; nen¡ zbytek v z znamu
0000:0AF9 40             INC    AX               ; zaokrouhlen¡ na z znamy
0000:0AFA 7501           JNZ    0AFD             ; nen¡ p©enos
0000:0AFC 42             INC    DX               ; p©enos do vy¨¨¡ho slova
0000:0AFD AB           * STOSW                   ; ni‘¨¡ slovo po‡tu z znam–
0000:0AFE 8BC2           MOV    AX,DX            ; vy¨¨¡ slovo po‡tu z znam–
0000:0B00 AA             STOSB                   ; vy¨¨¡ bajt po‡tu z znam–
0000:0B01 B000           MOV    AL,00            ; 4.bajt po‡tu z znam–
0000:0B03 83F940         CMP    CX,+40           ; je z znam men¨¡ ne‘ 64 Bajt–?
0000:0B06 7303           JNB    0B0B             ; z znam nen¡ men¨¡ ne‘ 64 B
0000:0B08 268825         MOV    ES:[DI],AH       ; nulov n¡ 4. bajtu pro 64 B
0000:0B0B C3           * RET
; -----------------------------------------------------------------------------
;         Slu‘ba 24h - nastaven¡ rel. z znamu s pou‘it¡m FCB
; -----------------------------------------------------------------------------
                                               ;* p©evod aktual. z znamu na rel.
0000:0B0C E8751A         CALL   2584             ; poskytnut¡ aktu ln¡ho z znamu
0000:0B0F 894521         MOV    [DI+21],AX       ; nastaven¡ relativn¡ho z znamu
0000:0B12 885523         MOV    [DI+23],DL
0000:0B15 837D0E40       CMP    Word Ptr [DI+0E],+40 ; d‚lka z znamu > 64 ?
0000:0B19 7303           JNB    0B1E             ; d‚lka z znamu >= 64
0000:0B1B 887524         MOV    [DI+24],DH       ; po‡et z znam– je 4-bajtov˜
0000:0B1E C3           * RET
; -----------------------------------------------------------------------------
;         Slu‘ba 0dh - resetov n¡ diskov‚ho syst‚mu
; -----------------------------------------------------------------------------
0000:0B1F 16             PUSH   SS
0000:0B20 1F             POP    DS               ; DS <- CS
0000:0B21 B0FF           MOV    AL,FF            ; po‘adov ny v¨echny disky
0000:0B23 E8B51C         CALL   27DB             ; ulo‘en¡ modifik. sektor–
0000:0B26 C7062B01FFFF   MOV    Word Ptr [012B],FFFF ; zru¨en¡ aktu l. bufferu
0000:0B2C C7062901FFFF   MOV    Word Ptr [0129],FFFF ; zru¨en¡ aktu l. bufferu
0000:0B32 E82E1B         CALL   2663             ; nulov n¡ v¨ech disk. buffer–
0000:0B35 C6450701     * MOV    Byte Ptr [DI+07],01
0000:0B39 807D04FF       CMP    Byte Ptr [DI+04],FF ; je buffer voln˜ ?
0000:0B3D 7408           JZ     0B47             ; je voln˜
0000:0B3F C74504FF00     MOV    Word Ptr [DI+04],00FF ; je voln˜ a nen¡ modifik.
0000:0B44 E8451B         CALL   268C             ; buffer na konec, dal¨¡ buffer
0000:0B47 E8321B       * CALL   267C             ; nalezen¡ neozna‡en‚ho bufferu
0000:0B4A 75E9           JNZ    0B35             ; uvolnˆn¡ dal¨¡ho bufferu
0000:0B4C C3           * RET

; -----------------------------------------------------------------------------
;         Slu‘ba 06h - p©¡m˜ vstup/v˜stup znaku na konzolu
; -----------------------------------------------------------------------------
0000:0B4D 8AC2           MOV    AL,DL            ; znak k v˜stupu nebo 0ffh
0000:0B4F 3CFF           CMP    AL,FF            ; je po‘adov n vstup ?
0000:0B51 753A           JNZ    0B8D             ; je v˜stup znaku
                                               ;* je vstup znaku
0000:0B53 36C43E1B04     LES    DI,SS:[041B]     ; ukazatel dat v z sobn¡ku
0000:0B58 33DB           XOR    BX,BX            ; identifik tor stand. vstupu
0000:0B5A E82711         CALL   1C84             ; nalezen¡ popisova‡e souboru
0000:0B5D 72ED           JB     0B4C             ; chyba - popisova‡ nenalezen
0000:0B5F B401           MOV    AH,01            ; funkce - nedestr. vstup
0000:0B61 E85A07         CALL   12BE             ; test stavu za©¡zen¡
0000:0B64 750B           JNZ    0B71             ; je p©ipraven znak
0000:0B66 E8FE20         CALL   2C67             ; obsluha ‡ek n¡ - INT 28h
0000:0B69 26804D1640     OR     Byte Ptr ES:[DI+16],40 ; p©¡znak ZY=nen¡ znak
0000:0B6E 32C0           XOR    AL,AL            ; nen¡ ‘ dn˜ znak
0000:0B70 C3           * RET

0000:0B71 26806516BF   * AND    Byte Ptr ES:[DI+16],BF ; p©¡znak NZ=je znak
0000:0B76 E8EE20       * CALL   2C67             ; obsluha ‡ek n¡ - INT 28h

; -----------------------------------------------------------------------------
;         Slu‘ba 07h - ©¡zen˜ vstup znaku z konzoly bez echa
; -----------------------------------------------------------------------------
0000:0B79 33DB           XOR    BX,BX            ; identif.- stand. vstup. za©.
0000:0B7B E80611         CALL   1C84             ; nalezen¡ popisova‡e souboru
0000:0B7E 72F0           JB     0B70             ; chyba
0000:0B80 B401           MOV    AH,01            ; funkce - nedestr. vstup
0000:0B82 E83907         CALL   12BE             ; test stavu konzoly
0000:0B85 74EF           JZ     0B76             ; nen¡ p©ipraven znak - ‡ek n¡
0000:0B87 32E4           XOR    AH,AH            ; funkce - vstup znaku
0000:0B89 E83207         CALL   12BE             ; vstup znaku z konzoly
0000:0B8C C3             RET
; -----------------------------------------------------------------------------
;         V˜stup znaku na displej
; -----------------------------------------------------------------------------
0000:0B8D 53           * PUSH   BX               ; £schova BX
0000:0B8E BB0100         MOV    BX,0001          ; identif.- stand. v˜stup. za©.
0000:0B91 E8F010         CALL   1C84             ; nalezen¡ popis. souboru FCB
0000:0B94 721B           JB     0BB1             ; popisova‡ nenalezen
0000:0B96 F6441880       TEST   Byte Ptr [SI+18],80 ; je to blokov‚ za©¡zen¡ ?
0000:0B9A 7411           JZ     0BAD             ; je to blokov‚ za©¡zen¡
0000:0B9C 1E             PUSH   DS
0000:0B9D 56             PUSH   SI
0000:0B9E C57419         LDS    SI,[SI+19]       ; ukazatel na ovlada‡ za©¡zen¡
0000:0BA1 F6440410       TEST   Byte Ptr [SI+04],10 ; je to
0000:0BA5 5E             POP    SI
0000:0BA6 1F             POP    DS
0000:0BA7 7404           JZ     0BAD
0000:0BA9 CD29           INT    29               ; zobrazen¡ znaku na displej
0000:0BAB EB03           JMP    0BB0

0000:0BAD E80800       * CALL   0BB8             ; v˜stup znaku na konzolu
0000:0BB0 F8           * CLC
0000:0BB1 5B           * POP    BX               ; n vrat BX
0000:0BB2 C3           * RET
; -----------------------------------------------------------------------------
                                               ; v˜stup znaku na konzolu
0000:0BB3 E8CE10         CALL   1C84             ; nalezen¡ popisova‡e souboru
0000:0BB6 72FA           JB     0BB2             ; popisova‡ nenalezen

                                               ;* v˜stup znaku na konzolu
0000:0BB8 50           * PUSH   AX               ; £schova znaku k v˜stupu
0000:0BB9 EB03           JMP    0BBE
0000:0BBB E8A920       * CALL   2C67             ; obsluha ‡ek n¡ - INT 28h
0000:0BBE B403         * MOV    AH,03            ; funkce - test v˜stupu na za©.
0000:0BC0 E8FB06         CALL   12BE             ; test stavu konzoly
0000:0BC3 74F6           JZ     0BBB             ; nen¡ p©ipravena pro v˜stup
0000:0BC5 58             POP    AX               ; znak k v˜stupu
0000:0BC6 B402           MOV    AH,02            ; funkce z pisu znaku
0000:0BC8 E8F306         CALL   12BE             ; funkce - z pis za za©¡zen¡
0000:0BCB F8             CLC
0000:0BCC C3           * RET
; -----------------------------------------------------------------------------
;         Zobrazen¡ textu CS:SI
; -----------------------------------------------------------------------------
0000:0BCD 2EAC           LODSB  CS:              ; znak k zobrazen¡
0000:0BCF 3C24           CMP    AL,24            ; je konec ?
0000:0BD1 74F9           JZ     0BCC             ; je konec textu
0000:0BD3 E8D729         CALL   35AD             ; zobrazen¡ znaku
0000:0BD6 EBF5           JMP    0BCD             ; dal¨¡ znak
0000:0BD8 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 29h - rozbor jm‚na souboru
; -----------------------------------------------------------------------------
0000:0BD9 E8DF22         CALL   2EBB             ; rozbor jm‚na souboru
0000:0BDC 56             PUSH   SI               ; konec rozboru ©etˆzce
0000:0BDD E802FC         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0BE0 8F4408         POP    [SI+08]          ; konec rozboru ©etˆzce
0000:0BE3 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 55h - vytvo©en¡ segmentu PSP podle aktivn¡ho PSP
; -----------------------------------------------------------------------------
                                               ;* VSTUP: DX=segment k vytvo©.PSP

0000:0BE4 36C6068D01FF   MOV    Byte Ptr SS:[018D],FF ; p©¡znak aktivn¡ho PSP
; -----------------------------------------------------------------------------
;         Slu‘ba 26h - vytvo©en¡ programov‚ho segmentu PSP podle CS:0
; -----------------------------------------------------------------------------
                                               ;* VSTUP: DX=segment k vytvo©.PSP
0000:0BEA 8EC2           MOV    ES,DX            ; segment k vytvo©en¡ PSP
0000:0BEC 2EF6068D01FF   TEST   Byte Ptr CS:[018D],FF ; pou‘ije se aktivn¡ PSP ?
0000:0BF2 7407           JZ     0BFB             ; nepou‘ije se aktivn¡ PSP
0000:0BF4 2E8E1E8B01     MOV    DS,CS:[018B]     ; segment aktivn¡ho PSP
0000:0BF9 EB06           JMP    0C01
                                               ;* vzor PSP je v CS:0
0000:0BFB E8E4FB       * CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0BFE 8E5C14         MOV    DS,[SI+14]       ; segment CS programu (PSP)
                                               ;* kopie vzoru PSP na novou adr.
0000:0C01 33F6         * XOR    SI,SI            ; SI <- 0
0000:0C03 8BFE           MOV    DI,SI            ; DI <- 0
0000:0C05 B98000         MOV    CX,0080          ; d‚lka PSP
0000:0C08 F3             REPZ
0000:0C09 A5             MOVSW                   ; kopie PSP na zadanou adresu
0000:0C0A 2EF6068D01FF   TEST   Byte Ptr CS:[018D],FF ; je aktivn¡ PSP ?
0000:0C10 7436           JZ     0C48             ; nen¡ aktivn¡ PSP
                                               ;* je aktivn¡ PSP - inic.
0000:0C12 0E             PUSH   CS
0000:0C13 1F             POP    DS               ; DS <- CS
0000:0C14 33DB           XOR    BX,BX            ; BX <- 0
0000:0C16 B91400         MOV    CX,0014          ; po‡et bajt– p©¡znak–

0000:0C19 06           * PUSH   ES
0000:0C1A E87632         CALL   3E93             ; adresa popisova‡e soub. v PSP
0000:0C1D 7214           JB     0C33
0000:0C1F 06             PUSH   ES
0000:0C20 57             PUSH   DI               ; adresa popisova‡e souboru
0000:0C21 E85B32         CALL   3E7F             ; nalezen¡ tabulky souboru
0000:0C24 7203           JB     0C29             ; popisova‡ nenalezen
0000:0C26 26FE05         INC    Byte Ptr ES:[DI]
0000:0C29 5F           * POP    DI
0000:0C2A 07             POP    ES
0000:0C2B 268A05         MOV    AL,ES:[DI]
0000:0C2E 07             POP    ES
0000:0C2F 06             PUSH   ES
0000:0C30 268A07         MOV    AL,ES:[BX]
0000:0C33 07           * POP    ES
0000:0C34 43             INC    BX
0000:0C35 E2E2           LOOP   0C19             ; dal¨¡ p©¡znak

0000:0C37 FF368B01       PUSH   [018B]           ; segment aktivn¡ho PSP
0000:0C3B 5B             POP    BX
0000:0C3C 53             PUSH   BX
0000:0C3D 268F061600     POP    ES:[0016]
0000:0C42 8C068B01       MOV    [018B],ES        ; segment aktivn¡ho PSP
0000:0C46 8EDB           MOV    DS,BX

0000:0C48 2EC6068D0100 * MOV    Byte Ptr CS:[018D],00 ; zru¨en¡ p©¡znaku specif.
0000:0C4E A10200         MOV    AX,[0002]        ; konec voln‚ pamˆti

                                               ;* inicializace obsahu PSP
0000:0C51 33C9           XOR    CX,CX
0000:0C53 8ED9           MOV    DS,CX            ; DS <- 0
0000:0C55 8EC2           MOV    ES,DX            ; ES <- seg. nov‚ho PSP
0000:0C57 BE8800         MOV    SI,0088          ; adresa INT 22h
0000:0C5A BF0A00         MOV    DI,000A          ; adresa k £schovˆ INT 22h
0000:0C5D B90600         MOV    CX,0006          ; po‡et slov k p©enosu
0000:0C60 F3             REPZ
0000:0C61 A5             MOVSW                   ; £schova adres INT 22h-24h
0000:0C62 26A30200       MOV    ES:[0002],AX     ; konec p©idˆlen‚ho bloku
0000:0C66 2BC2           SUB    AX,DX            ; velikost bloku
0000:0C68 3DFF0F         CMP    AX,0FFF          ; je velikost vˆt¨¡ ne‘ 64 KB ?
0000:0C6B 7603           JBE    0C70             ; blok nen¡ vˆt¨¡ ne‘ 64 KB
0000:0C6D B8FF0F         MOV    AX,0FFF          ; omezen¡ na 64 KB
0000:0C70 BB0C00       * MOV    BX,000C
0000:0C73 2BD8           SUB    BX,AX
0000:0C75 B104           MOV    CL,04
0000:0C77 D3E0           SHL    AX,CL
0000:0C79 8EDA           MOV    DS,DX            ; segment nov‚ho PSP
0000:0C7B A30600         MOV    [0006],AX        ; adresa skoku podle CP/M
0000:0C7E 891E0800       MOV    [0008],BX        ; segment skoku podle CP/M
0000:0C82 C7060000CD20   MOV    Word Ptr [0000],20CD  ; instrukce INT 20h
0000:0C88 C60605009A     MOV    Byte Ptr [0005],9A    ; instrukce CALL FAR
0000:0C8D C7065000CD21   MOV    Word Ptr [0050],21CD  ; instrukce INT 21h
0000:0C93 C6065200CB     MOV    Byte Ptr [0052],CB    ; instrukce RETF
0000:0C98 C3             RET

0000:0c99                db     0,0,0            ; u‘ivatelsk‚ ‡¡slo

0000:0c9c                db     29h              ; ‡¡slo firmy (29h = TOSHIBA)

0000:0C9D 020B           db     2,11             ; ‡¡slo verze DOS

; -----------------------------------------------------------------------------
;         Slu‘ba 30h - poskytnut¡ ‡¡sla verze DOS
; -----------------------------------------------------------------------------
0000:0C9F 16             PUSH   SS
0000:0CA0 1F             POP    DS               ; DS <- CS
0000:0CA1 8B1E9B0C       MOV    BX,[0C9B]        ; BH=OEM, BL=vy¨¨¡ bajt u‘iv.
0000:0CA5 8B0E990C       MOV    CX,[0C99]        ; ni‘¨¡ slovo u‘iv. ‡¡sla
0000:0CA9 A19D0C         MOV    AX,[0C9D]        ; ‡¡slo verze DOS (2.11)
0000:0CAC E833FB         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0CAF 895C02         MOV    [SI+02],BX       ; registr BX
0000:0CB2 894C04         MOV    [SI+04],CX       ; registr CX
0000:0CB5 8904           MOV    [SI],AX          ; registr AX
0000:0CB7 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 38h - poskytnut¡/nastaven¡ n rodnostn¡ch informac¡
; -----------------------------------------------------------------------------
0000:0CB8 8AD8           MOV    BL,AL            ; k¢d po‘adovan‚ zemˆ
0000:0CBA 1E             PUSH   DS
0000:0CBB 07             POP    ES               ; ES <- segment bufferu
0000:0CBC 52             PUSH   DX
0000:0CBD 5F             POP    DI               ; DI <- offset bufferu
0000:0CBE 16             PUSH   SS
0000:0CBF 1F             POP    DS               ; DS <- CS
0000:0CC0 83FFFF         CMP    DI,-01           ; bude nastaven¡ k¢du zemˆ ?
0000:0CC3 7440           JZ     0D05             ; je nastaven¡ k¢du zemˆ
0000:0CC5 0ADB           OR     BL,BL            ; je implicitn¡ zemˆ ?
0000:0CC7 750B           JNZ    0CD4             ; zemˆ je specifikovan 
                                               ;* implicitn¡ zemˆ
0000:0CC9 8B36A401       MOV    SI,[01A4]        ; adr. tab. n rodn¡ch informac¡
0000:0CCD 8B44FE         MOV    AX,[SI-02]       ; k¢d zemˆ a d‚lka tabulky
0000:0CD0 8ADC           MOV    BL,AH            ; k¢d zemˆ, AL = d‚lka tabulky
0000:0CD2 EB1E           JMP    0CF2             ; p©enesen¡ k¢du zemˆ

                                               ;* zadan  zemˆ - nalezen¡ v tab.
0000:0CD4 E80700       * CALL   0CDE             ; nalezen¡ specifikovan‚ zemˆ
0000:0CD7 7319           JNB    0CF2             ; zemˆ nalezena - p©enesen¡
0000:0CD9 B002           MOV    AL,02            ; chyba - zemˆ nenalezena
0000:0CDB E973FC         JMP    0951             ; n vrat z INT 21h s chybou CY

                                               ;* nalezen¡ specifikovan‚ zemˆ
0000:0CDE BEA601         MOV    SI,01A6          ; tabulka n rod. informac¡
0000:0CE1 AD             LODSW                   ; na‡ten¡ d‚lky a k¢du zemˆ
0000:0CE2 3CFF           CMP    AL,FF            ; je konec tabulky ?
0000:0CE4 7502           JNZ    0CE8             ; nen¡ konec tabulky
0000:0CE6 F9             STC                     ; chyba - tabulka nenalezena
0000:0CE7 C3           * RET
0000:0CE8 3ADC         * CMP    BL,AH            ; je to hledan  zemˆ ?
0000:0CEA 74FB           JZ     0CE7             ; je to hledan  zemˆ
0000:0CEC 32E4           XOR    AH,AH            ; AX = d‚lka tabulky
0000:0CEE 03F0           ADD    SI,AX            ; adresa dal¨¡ tabulky
0000:0CF0 EBEF           JMP    0CE1

                                               ;* p©enesen¡ tabulky
0000:0CF2 8AC8         * MOV    CL,AL            ; d‚lka tabulky
0000:0CF4 32ED           XOR    CH,CH            ; CX = d‚lka tabulky
0000:0CF6 57             PUSH   DI               ; £schova offsetu bufferu
0000:0CF7 F3             REPZ
0000:0CF8 A4             MOVSB                   ; p©enos tabulky do bufferu
0000:0CF9 5F             POP    DI               ; n vrat offsetu tabulky
0000:0CFA 268C4D14       MOV    ES:[DI+14],CS    ; segment mapovac¡ procedury
0000:0CFE 33C0         * XOR    AX,AX
0000:0D00 8AC3           MOV    AL,BL            ; k¢d nov‚ zemˆ
0000:0D02 E942FC         JMP    0947             ; n vrat z INT 21h s funkc¡ OK

                                               ;* nastaven¡ k¢du nov‚ zemˆ
0000:0D05 E8D6FF       * CALL   0CDE             ; nalezen¡ zemˆ v tabulce
0000:0D08 7304           JNB    0D0E             ; tabulka nalezena OK
0000:0D0A B002           MOV    AL,02            ; chyba - zemˆ nenalezena
0000:0D0C EBCD           JMP    0CDB             ; n vrat z INT 21h s chybou
0000:0D0E 8936A401     * MOV    [01A4],SI        ; adr. tab. n rodn¡ch informac¡
0000:0D12 EBEA           JMP    0CFE             ; n vrat OK
; -----------------------------------------------------------------------------
;         Slu‘ba 54h - poskytnut¡ p©ep¡na‡e VERIFY
; -----------------------------------------------------------------------------
0000:0D14 36A0DB00       MOV    AL,SS:[00DB]     ; bit 0: p©ep¡na‡ VERIFY
0000:0D18 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 2eh - nastaven¡ p©ep¡na‡e VERIFY
; -----------------------------------------------------------------------------
0000:0D19 2401           AND    AL,01            ; maska bitu 0
0000:0D1B 36A2DB00       MOV    SS:[00DB],AL     ; bit 0: p©ep¡na‡ VERIFY
0000:0D1F C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 33h - poskytnut¡ nebo nastaven¡ p©ep¡na‡e BREAK
; -----------------------------------------------------------------------------
0000:0D20 0AC0           OR     AL,AL            ; je nastaven¡ BREAK ?
0000:0D22 750B           JNZ    0D2F             ; je nastaven¡ BREAK
0000:0D24 E8BBFA         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0D27 36A02801       MOV    AL,SS:[0128]     ; p©ep¡na‡ BREAK
0000:0D2B 884406         MOV    [SI+06],AL       ; DL <- stav p©ep¡na‡e BREAK
0000:0D2E C3             RET

0000:0D2F FEC8         * DEC    AL               ; je 01 = nastaven¡ BREAK ?
0000:0D31 7509           JNZ    0D3C             ; nen¡ nastaven¡ BREAK - chyba
0000:0D33 80E201         AND    DL,01            ; maska p©ep¡na‡e BREAK
0000:0D36 3688162801     MOV    SS:[0128],DL     ; nastaven¡ p©ep¡na‡e BREAK
0000:0D3B C3             RET

0000:0D3C B0FF         * MOV    AL,FF            ; p©¡znak - chyba povelu
0000:0D3E C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 34h - poskytnut¡ adresy p©¡znaku aktivity DOS
; -----------------------------------------------------------------------------
0000:0D3F E8A0FA         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0D42 C744022301     MOV    Word Ptr [SI+02],0123 ; BX <- p©¡znak akt. DOS
0000:0D47 8C5410         MOV    [SI+10],SS       ; ES <- CS
0000:0D4A C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 52h - poskytnut¡ adresy defini‡n¡ tabulky DOS
; -----------------------------------------------------------------------------
0000:0D4B E894FA         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0D4E C74402F000     MOV    Word Ptr [SI+02],00F0 ; BX <- adr. tab. DOS
0000:0D53 8C5410         MOV    [SI+10],SS       ; ES <- CS
0000:0D56 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 36h - poskytnut¡ voln‚ho m¡sta disku
; -----------------------------------------------------------------------------
0000:0D57 16             PUSH   SS
0000:0D58 1F             POP    DS               ; DS <- CS
0000:0D59 8AC2           MOV    AL,DL            ; po‘adovan˜ disk
0000:0D5B E8390F         CALL   1C97             ; nastav. pracovn¡ho log. disku
0000:0D5E B8FFFF         MOV    AX,FFFF          ; p©¡znak-neplatn  specif.disku
0000:0D61 7224           JB     0D87             ; chybn‚ zad n¡ disku
0000:0D63 E87D15         CALL   22E3             ; poskytnut¡ tabulky disku
0000:0D66 33D2           XOR    DX,DX            ; ‡¡ta‡ voln˜ch alok. blok–
0000:0D68 BB0200         MOV    BX,0002          ; po‡ te‡n¡ aloka‡n¡ blok
0000:0D6B 268B4E0D       MOV    CX,ES:[BP+0D]    ; max. ‡¡slo alok. bloku
0000:0D6F 49             DEC    CX               ; po‡et aloka‡n¡ch blok–
0000:0D70 51             PUSH   CX               ; £schova po‡tu alok. blok–
0000:0D71 E86D14       * CALL   21E1             ; ‡ten¡ ukazatele alok. bloku
0000:0D74 7501           JNZ    0D77             ; alok. blok nen¡ voln˜
0000:0D76 42             INC    DX               ; zv˜¨en¡ ‡¡ta‡e voln˜ch blok–
0000:0D77 43           * INC    BX               ; ‡¡slo dal¨¡ho alok. bloku
0000:0D78 E2F7           LOOP   0D71             ; dal¨¡ alok. blok
0000:0D7A 5B             POP    BX               ; celkov˜ po‡et alok. blok–
0000:0D7B 268A4604       MOV    AL,ES:[BP+04]    ; posledn¡ sektor v bloku
0000:0D7F FEC0           INC    AL               ; po‡et sektor– na alok. blok
0000:0D81 32E4           XOR    AH,AH            ; AX=po‡et sektor– na alok.blok
0000:0D83 268B4E02       MOV    CX,ES:[BP+02]    ; po‡et bajt– na sektor
0000:0D87 E858FA       * CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0D8A 894C04         MOV    [SI+04],CX       ; CX=po‡et bajt– na sektor
0000:0D8D 895C06         MOV    [SI+06],BX       ; DX=celkov˜ po‡et alok. blok–
0000:0D90 895402         MOV    [SI+02],DX       ; BX=po‡et voln˜ch alok. blok–
0000:0D93 8904           MOV    [SI],AX          ; AX=po‡et sektor– na alok.blok
0000:0D95 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 2fh - poskytnut¡ adresy DTA
; -----------------------------------------------------------------------------
0000:0D96 368B1EDF00     MOV    BX,SS:[00DF]     ; adresa diskov˜ch p©enos– DTA
0000:0D9B 368B0EE100     MOV    CX,SS:[00E1]     ; segment adresy DTA
0000:0DA0 E83FFA         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0DA3 895C02         MOV    [SI+02],BX       ; nastaven¡ BX
0000:0DA6 894C10         MOV    [SI+10],CX       ; nastaven¡ ES
0000:0DA9 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 1ah - nastaven¡ adresy diskov˜ch p©enos– DTA
; -----------------------------------------------------------------------------
0000:0DAA 368916DF00     MOV    SS:[00DF],DX     ; adresa diskov˜ch p©enos– DTA
0000:0DAF 368C1EE100     MOV    SS:[00E1],DS     ; segment adresy DTA
0000:0DB4 C3             RET
; -----------------------------------------------------------------------------
0000:0DB5 B200           MOV    DL,00            ; aktivn¡ disk
; -----------------------------------------------------------------------------
;         Slu‘ba 32h - poskytnut¡ adresy bloku parametr– disku
; -----------------------------------------------------------------------------
0000:0DB7 16             PUSH   SS
0000:0DB8 1F             POP    DS               ; DS <- CS
0000:0DB9 8AC2           MOV    AL,DL            ; po‘adovan˜ disk
0000:0DBB E8D90E         CALL   1C97             ; nastaven¡ pracovn¡ho disku
0000:0DBE 720F           JB     0DCF             ; chybn‚ zad n¡ disku
0000:0DC0 E82015         CALL   22E3             ; poskytnut¡ tabulky parametr–
0000:0DC3 E81CFA         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0DC6 896C02         MOV    [SI+02],BP       ; nastaven¡ BX (offset tabulky)
0000:0DC9 8C440E         MOV    [SI+0E],ES       ; nastaven¡ DS (segment tab.)
0000:0DCC 32C0           XOR    AL,AL            ; p©¡znak - operace OK
0000:0DCE C3             RET

0000:0DCF B0FF         * MOV    AL,FF            ; p©¡znak chyby zad n¡ disku
0000:0DD1 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 1ah - poskytnut¡ aktivn¡ho disku
; -----------------------------------------------------------------------------
0000:0DD2 36A02001       MOV    AL,SS:[0120]     ; aktivn¡ logick˜ disk
0000:0DD6 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 0eh - v˜bˆr aktivn¡ho disku
; -----------------------------------------------------------------------------
0000:0DD7 36A00001       MOV    AL,SS:[0100]     ; maxim ln¡ disk
0000:0DDB 3AD0           CMP    DL,AL            ; p©ekro‡eno ‡¡slo disku ?
0000:0DDD 7305           JNB    0DE4             ; ‡¡slo disku p©ekro‡eno
0000:0DDF 3688162001     MOV    SS:[0120],DL     ; nov˜ aktivn¡ disk
0000:0DE4 C3           * RET
; -----------------------------------------------------------------------------
;         Slu‘ba 35h - poskytnut¡ adresy vektoru p©eru¨en¡
; -----------------------------------------------------------------------------
0000:0DE5 E81800         CALL   0E00             ; adresa ukaz. vektoru p©eru¨.
0000:0DE8 26C41F         LES    BX,ES:[BX]       ; obsah vektoru p©eru¨en¡
0000:0DEB E8F4F9         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0DEE 895C02         MOV    [SI+02],BX       ; nastaven¡ BX
0000:0DF1 8C4410         MOV    [SI+10],ES       ; nastaven¡ ES
0000:0DF4 C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 25h - nastaven¡ vektoru p©eru¨en¡
; -----------------------------------------------------------------------------
0000:0DF5 E80800         CALL   0E00             ; adresa ukaz. vektoru p©eru¨.
0000:0DF8 268917         MOV    ES:[BX],DX       ; nastaven¡ adresy vektoru
0000:0DFB 268C5F02       MOV    ES:[BX+02],DS
0000:0DFF C3             RET
; -----------------------------------------------------------------------------
;         Adresa ukazatele vektoru p©eru¨en¡ AL
; -----------------------------------------------------------------------------
0000:0E00 33DB           XOR    BX,BX            ; BX <- 0
0000:0E02 8EC3           MOV    ES,BX            ; ES <- 0
0000:0E04 8AD8           MOV    BL,AL            ; ‡¡slo vektoru p©eru¨en¡
0000:0E06 D1E3           SHL    BX,1
0000:0E08 D1E3           SHL    BX,1             ; offset vektoru p©eru¨en¡
0000:0E0A C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 37h - poskytnut¡/nastaven¡ oddˆlovac¡ho znaku parametr–
; -----------------------------------------------------------------------------
0000:0E0B 16             PUSH   SS
0000:0E0C 1F             POP    DS
                                               ;* poskytnut¡ oddˆl. znaku param.
0000:0E0D 0AC0           OR     AL,AL            ; je poskytnut¡ oddˆl. znaku ?
0000:0E0F 7506           JNZ    0E17             ; nen¡ poskytnut¡ oddˆl. znaku
0000:0E11 8A16E500       MOV    DL,[00E5]        ; oddˆlovac¡ znak parametr–
0000:0E15 EB1F           JMP    0E36
                                               ;* nastaven¡ oddˆl. znaku param.
0000:0E17 FEC8         * DEC    AL               ; je nastav.
0000:0E19 7505           JNZ    0E20
0000:0E1B 8816E500       MOV    [00E5],DL        ; oddˆlovac¡ znak parametr–
0000:0E1F C3             RET
                                               ;* poskytnut¡ oddˆl. znaku cesty
0000:0E20 FEC8         * DEC    AL
0000:0E22 7506           JNZ    0E2A
0000:0E24 8A16E600       MOV    DL,[00E6]        ; oddˆlovac¡ znak cesty
0000:0E28 EB0C           JMP    0E36
                                               ;* nastaven¡ oddˆl. znaku cesty
0000:0E2A FEC8         * DEC    AL
0000:0E2C 7505           JNZ    0E33
0000:0E2E 8816E600     * MOV    [00E6],DL        ; nastav. oddˆl. znaku cesty
0000:0E32 C3             RET

0000:0E33 B0FF         * MOV    AL,FF            ; p©¡znak chyby
0000:0E35 C3             RET

0000:0E36 E8A9F9       * CALL   07E2             ; nastaven¡ ukazat. na registry
0000:0E39 895406         MOV    [SI+06],DX       ; navr cen¡ znaku v DL
0000:0E3C C3             RET
; -----------------------------------------------------------------------------
;         Slu‘ba 53h - p©evod tabulky BPB na tabulku DOS
; -----------------------------------------------------------------------------
                                               ;* VSTUP: DS:SI=tabulka BPB
                                               ;*        ES:BP=tabulka DOS

0000:0E3D 8BFD           MOV    DI,BP            ; ukl dac¡ adresa tabulky
0000:0E3F 83C702         ADD    DI,+02           ; p©esko‡en¡ po‡tu disk–
0000:0E42 AD             LODSW                   ; po‡et bajt– na sektor
0000:0E43 AB             STOSW                   ; 02h: po‡et bajt– na sektor
0000:0E44 8BD0           MOV    DX,AX            ; bajt– na sektor
0000:0E46 AC             LODSB                   ; sektor– na alok. blok
0000:0E47 FEC8           DEC    AL               ; posledn¡ sektor alok. bloku
0000:0E49 AA             STOSB                   ; 04h: posledn¡ sektor alok. bloku
0000:0E4A FEC0           INC    AL               ; sektor– na alok. blok
                                               ;* v˜po‡et © du bloku
0000:0E4C 32E4           XOR    AH,AH            ; AH=© d bloku (v sektorech)
0000:0E4E A801         * TEST   AL,01            ; jsou v¨echny sektory ?
0000:0E50 7506           JNZ    0E58             ; jsou v¨echny sektory
0000:0E52 FEC4           INC    AH               ; zv˜¨en¡ © du bloku
0000:0E54 D0E8           SHR    AL,1             ; po‡et sektor– / 2
0000:0E56 EBF6           JMP    0E4E             ; dal¨¡ test
0000:0E58 8AC4         * MOV    AL,AH            ; © d bloku
0000:0E5A AA             STOSB                   ; 05h: © d bloku (v sektorech)
0000:0E5B 8AD8           MOV    BL,AL            ; © d bloku (v sektorech)

0000:0E5D A5             MOVSW                   ; 06h: rezervovan‚ sektory
0000:0E5E AC             LODSB
0000:0E5F AA             STOSB                   ; 08h: po‡et tabulek FAT
0000:0E60 8AF8           MOV    BH,AL            ; po‡et tabulek FAT
                                               ;* po‡et sektor– ROOT adres ©e
0000:0E62 AD             LODSW
0000:0E63 AB             STOSW                   ; 09h: po‡et polo‘ek ROOT adr.
0000:0E64 B105           MOV    CL,05            ; rotace pro p©evod na sektory
0000:0E66 D3EA           SHR    DX,CL            ; po‡et polo‘ek ROOT na sektor
0000:0E68 48             DEC    AX               ; max. ‡¡slo pol. ROOT v sekt.
0000:0E69 03C2           ADD    AX,DX            ; zaokrouhlen¡ na sektor
0000:0E6B 8BCA           MOV    CX,DX            ; po‡et polo‘ek na sektor
0000:0E6D 33D2           XOR    DX,DX            ; DX <- 0
0000:0E6F F7F1           DIV    CX               ; po‡et sektor– ROOT adres ©e
0000:0E71 8BC8           MOV    CX,AX            ; po‡et sektor– ROOT adres ©e
0000:0E73 47             INC    DI
0000:0E74 47             INC    DI

0000:0E75 A5             MOVSW                   ; 0dh: celkem sektor– na m‚diu

0000:0E76 AC             LODSB                   ; popisova‡ m‚dia
0000:0E77 26884616       MOV    ES:[BP+16],AL    ; popisova‡ m‚dia
0000:0E7B AD             LODSW                   ; po‡et sektor– v jedn‚ FAT
0000:0E7C AA             STOSB                   ; 0fh: po‡et sektor– ve FAT
0000:0E7D F6E7           MUL    BH               ; celkem sektor– obou FAT
0000:0E7F 26034606       ADD    AX,ES:[BP+06]    ; + rezervovan‚ sektory
0000:0E83 AB             STOSW                   ; 10h: po‡ te‡n¡ sektor ROOT
0000:0E84 03C1           ADD    AX,CX            ; + po‡et sektor– ROOT
0000:0E86 2689460B       MOV    ES:[BP+0B],AX    ; po‡ te‡n¡ datov˜ sektor

0000:0E8A 262B460D       SUB    AX,ES:[BP+0D]    ; - celkem datov˜ch sektor–
0000:0E8E F7D8           NEG    AX               ; celkem datov˜ch sektor–
0000:0E90 8ACB           MOV    CL,BL            ; © d bloku (v sektorech)
0000:0E92 D3E8           SHR    AX,CL            ; celkem datov˜ch blok–
0000:0E94 40             INC    AX               ; maxim ln¡ ‡¡slo dat. bloku
0000:0E95 2689460D       MOV    ES:[BP+0D],AX    ; maxim ln¡ ‡¡slo dat. bloku
0000:0E99 26C7461C0000   MOV    Word Ptr ES:[BP+1C],0 ; po‡ t.alok.blok adres ©e
0000:0E9F C3             RET
; -----------------------------------------------------------------------------
0000:0EA0 E9B000       * JMP    0F53             ; n vrat z INT 21h s chybou CY
0000:0EA3 E9AB00         JMP    0F51             ; n vrat z INT 21h s chybou 5
; -----------------------------------------------------------------------------
;         Slu‘ba 39h - vytvo©en¡ adres ©e
; -----------------------------------------------------------------------------
0000:0EA6 E81D2B         CALL   39C6             ; test zad n¡ specif. souboru
0000:0EA9 72F5           JB     0EA0             ; chyba zad n¡ adres ©e
0000:0EAB 8BF2           MOV    SI,DX            ; adresa jm‚na adres ©e
0000:0EAD 368C163D04     MOV    SS:[043D],SS     ; CS
0000:0EB2 36C7063B04FE04 MOV    Word Ptr SS:[043B],04FE
0000:0EB9 B010           MOV    AL,10            ; atribut adres ©e
0000:0EBB 36C706180400E5 MOV    Word Ptr SS:[0418],E500 ; zru¨eno nebo nepou‘ito
0000:0EC2 E83A08         CALL   16FF             ; nastaven¡ cesty k adres ©i
0000:0EC5 B003           MOV    AL,03            ; chyba - cesta nenalezena
0000:0EC7 72D7           JB     0EA0             ; chyba zad n¡ cesty
0000:0EC9 75D8           JNZ    0EA3             ; chyba - po‘adavek odm¡tnut

0000:0ECB C53E6904       LDS    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:0ECF 2BF7           SUB    SI,DI
0000:0ED1 56             PUSH   SI
0000:0ED2 FF7508         PUSH   [DI+08]          ; logick‚ ‡¡slo sektoru
0000:0ED5 16             PUSH   SS
0000:0ED6 1F             POP    DS               ; DS <- CS
0000:0ED7 FF364D04       PUSH   [044D]           ; aktu l. aloka‡n¡ blok
0000:0EDB 33C0           XOR    AX,AX
0000:0EDD A34D04         MOV    [044D],AX        ; popisov.m‚dia, p©¡znak v˜mˆny
0000:0EE0 E8E405         CALL   14C7             ; vytvo©en¡ bloku adres ©e
0000:0EE3 7251           JB     0F36             ; chyba vytvo©. bloku adres ©e
0000:0EE5 E82F07         CALL   1617
0000:0EE8 C43E6904       LES    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:0EEC 26C6450501     MOV    Byte Ptr ES:[DI+05],01 ; p©¡znak modifik. sekt.
0000:0EF1 83C710         ADD    DI,+10           ; data sektoru
                                               ;* vytvo©en¡ polo‘ky "."
0000:0EF4 B82E20         MOV    AX,202E          ; ozna‡en¡ adres ©e "."
0000:0EF7 AB             STOSW                   ; prvn¡ polo‘ka je "."
0000:0EF8 8B164D04       MOV    DX,[044D]        ; aktu l. aloka‡n¡ blok
0000:0EFC E83706         CALL   1536             ; inic. nov‚ polo‘ky adres ©e
0000:0EFF B82E2E         MOV    AX,2E2E          ; druh  polo‘ka ".."
0000:0F02 AB             STOSW                   ; druh  polo‘ka je ".."
0000:0F03 5A             POP    DX               ; po‡ te‡n¡ alok. blok adres ©e
0000:0F04 E82F06         CALL   1536             ; inic. nov‚ polo‘ky adres ©e
0000:0F07 C42E2604       LES    BP,[0426]        ; adresa z hlav¡ za©¡zen¡
0000:0F0B 5A             POP    DX               ; sektor ke ‡ten¡
0000:0F0C 32C0           XOR    AL,AL            ; p©¡znak na‡ten¡ sektoru
0000:0F0E E82818         CALL   2739             ; z¡sk n¡ sektoru DX
0000:0F11 8B164D04       MOV    DX,[044D]        ; aktu l. aloka‡n¡ blok
0000:0F15 C53E6904       LDS    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:0F19 5E             POP    SI
0000:0F1A 03F7           ADD    SI,DI
0000:0F1C 8914           MOV    [SI],DX          ; po‡ te‡n¡ alok. blok adres ©e
0000:0F1E 33D2           XOR    DX,DX
0000:0F20 895402         MOV    [SI+02],DX       ; aktu ln¡ alok. blok
0000:0F23 895404         MOV    [SI+04],DX

                                               ;* ulo‘en¡ modifikovan‚ho adres.
0000:0F26 C6450501       MOV    Byte Ptr [DI+05],01 ; p©¡znak modifikace bufferu
0000:0F2A 16             PUSH   SS
0000:0F2B 1F             POP    DS               ; DS <- CS
0000:0F2C 268A4600       MOV    AL,ES:[BP+00]    ; po‘adovan˜ disk pro z pis
0000:0F30 E8A818         CALL   27DB             ; ulo‘en¡ modifik. sektor–
0000:0F33 E911FA         JMP    0947             ; n vrat z INT 21h s funkc¡ OK

                                               ;* chyba vytvo©en¡ adres ©e
0000:0F36 5A             POP    DX
0000:0F37 5A             POP    DX               ; sektor k na‡ten¡
0000:0F38 C42E2604       LES    BP,[0426]        ; adresa z hlav¡ za©¡zen¡
0000:0F3C 32C0           XOR    AL,AL            ; p©¡znak na‡ten¡ sektoru
0000:0F3E E8F817         CALL   2739             ; z¡sk n¡ sektoru DX
0000:0F41 C53E6904       LDS    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:0F45 5E             POP    SI
0000:0F46 03F7           ADD    SI,DI
0000:0F48 83EE1A         SUB    SI,+1A
0000:0F4B C604E5         MOV    Byte Ptr [SI],E5 ; ozna‡en¡ polo‘ky jako zru¨en 
0000:0F4E E8D5FF         CALL   0F26             ; ulo‘en¡ adres ©e
0000:0F51 B005           MOV    AL,05            ; chyba - nelze prov‚st
0000:0F53 E9FBF9       * JMP    0951             ; n vrat z INT 21h s chybou CY
; -----------------------------------------------------------------------------
;         Slu‘ba 3bh - nastaven¡ aktivn¡ho adres ©e
; -----------------------------------------------------------------------------
0000:0F56 E86D2A         CALL   39C6             ; test zad n¡ specif. souboru
0000:0F59 725A           JB     0FB5             ; chyba zad n¡ cesty
0000:0F5B 1E             PUSH   DS               ; segment zadan‚ cesty adres.
0000:0F5C 52             PUSH   DX               ; offset zadan‚ cesty adres.
0000:0F5D 8BF2           MOV    SI,DX            ; offset zadan‚ cesty adres.
0000:0F5F E83F08         CALL   17A1             ; nastaven¡ adres ©e
0000:0F62 724F           JB     0FB3             ; chyba - adres © nenalezen
0000:0F64 754D           JNZ    0FB3             ;
0000:0F66 A14D04         MOV    AX,[044D]        ; aktu l. aloka‡n¡ blok
0000:0F69 8BD8           MOV    BX,AX            ; aktu ln¡ aloka‡n¡ blok
0000:0F6B 26875E1C       XCHG   BX,ES:[BP+1C]    ; nov˜ aloka‡n¡ blok adres ©e
0000:0F6F 0BC0           OR     AX,AX            ; je z kadn¡ adres © ?
0000:0F71 5E             POP    SI               ; n vrat za‡ tku textu zad n¡
0000:0F72 1F             POP    DS               ; n vrat segmentu zad n¡
0000:0F73 74BE           JZ     0F33             ; je z kladn¡ adres © - OK
0000:0F75 8BFD           MOV    DI,BP            ; tabulka parametr– disku
0000:0F77 83C71E         ADD    DI,+1E           ; adresa cesty k adres ©i
0000:0F7A 8BD7           MOV    DX,DI            ; cesta k adres ©i
0000:0F7C 36803E2B0400   CMP    Byte Ptr SS:[042B],00 ; byl zadan˜ disk
0000:0F82 7402           JZ     0F86             ; nebyl zad n disk
0000:0F84 46             INC    SI               ; p©esko‡en¡ ozna‡en¡ disku
0000:0F85 46             INC    SI               ; p©esko‡en¡ znaku ":"
0000:0F86 8BCE         * MOV    CX,SI            ; za‡ tek zadan‚ cesty
0000:0F88 36803E2C0400   CMP    Byte Ptr SS:[042C],00 ; byl £vodn¡ oddˆlov."\" ?
0000:0F8E 7404           JZ     0F94             ; nebyl zad n z kladn¡ adres.
0000:0F90 46             INC    SI               ; p©esko‡en¡ znaku "\"
0000:0F91 41             INC    CX               ; p©esko‡en¡ znaku "\"
0000:0F92 EB2B           JMP    0FBF             ; na‡ten¡ jm‚na adres ©e

0000:0F94 0BDB         * OR     BX,BX            ; byl ji‘ z kadn¡ adres © ?
0000:0F96 7429           JZ     0FC1             ; byl ji‘ z kldn¡ adres ©

                                               ;* nalezen¡ konce p–vod. adres.
0000:0F98 33DB           XOR    BX,BX            ; ‡¡ta‡ znak–
0000:0F9A 26803D00     * CMP    Byte Ptr ES:[DI],00 ; je konec specifikace ?
0000:0F9E 7404           JZ     0FA4             ; je konec
0000:0FA0 47             INC    DI               ; zv˜¨en¡ ukazatele textu
0000:0FA1 43             INC    BX               ; zv˜¨en¡ ‡¡ta‡e znak–
0000:0FA2 EBF6           JMP    0F9A
                                               ;* nastaven¡ koncov‚ho oddˆlova‡e
0000:0FA4 B02F           MOV    AL,2F            ; oddˆlova‡ cestu "/"
0000:0FA6 363A06E500     CMP    AL,SS:[00E5]     ; oddˆlovac¡ znak parametr–
0000:0FAB 7502           JNZ    0FAF             ; oddˆlova‡ parametr– nen¡ "/"
0000:0FAD B05C           MOV    AL,5C            ; oddˆlova‡ cesty je "\"
0000:0FAF AA           * STOSB                   ; ulo‘en¡ oddˆlova‡e cesty "\"
0000:0FB0 43             INC    BX               ; zv˜¨en¡ ‡¡ta‡e znak– textu
0000:0FB1 EB1D           JMP    0FD0
                                               ;* chyba - cesta nenalezena
0000:0FB3 58             POP    AX
0000:0FB4 58             POP    AX
0000:0FB5 B003         * MOV    AL,03            ; chyba - cesta nenalezena
0000:0FB7 E997F9         JMP    0951             ; n vrat z INT 21h s chybou CY

                                               ;* zv˜¨en¡ ‡¡ta‡e znak–
0000:0FBA 43             INC    BX               ; zv˜¨en¡ ‡¡ta‡e znak–
0000:0FBB 83FB40         CMP    BX,+40           ; p©ekro‡ena d‚lka 64 znak– ?
0000:0FBE C3             RET


                                               ;* na‡ten¡ jm‚na adres ©e
0000:0FBF 33DB           XOR    BX,BX            ; ‡¡ta‡ znak– adres ©e
0000:0FC1 AC           * LODSB                   ; na‡ten¡ znaku
0000:0FC2 0AC0           OR     AL,AL            ; je ji‘ konec textu ?
0000:0FC4 7503           JNZ    0FC9             ; nen¡ je¨tˆ konec
0000:0FC6 E98900         JMP    1052             ; konec specifikace
0000:0FC9 3C2E         * CMP    AL,2E            ; je adres © ".." ?
0000:0FCB 741D           JZ     0FEA             ; je adres © ".."
0000:0FCD E82D00         CALL   0FFD             ; p©enos jm‚na s p©¡ponou
0000:0FD0 83FB40         CMP    BX,+40           ; je p©ekro‡ena d‚lka textu ?
0000:0FD3 72EC           JB     0FC1             ; nen¡ p©ekro‡ena d‚lka textu
0000:0FD5 268A45FF       MOV    AL,ES:[DI-01]    ; poslednˆ ulo‘en˜ znak
0000:0FD9 E8C520         CALL   30A1             ; test odˆlova‡e param., cesty
0000:0FDC 7501           JNZ    0FDF             ; posledn¡ znak nebyl oddˆlova‡
0000:0FDE 4F             DEC    DI               ; zru¨en¡ oddˆlova‡e
0000:0FDF 32C0         * XOR    AL,AL            ; koncov˜ bajt 0
0000:0FE1 AA             STOSB                   ; ozna‡en¡ konce textu bajtem 0
0000:0FE2 26C7461CFFFF   MOV    Word Ptr ES:[BP+1C],FFFF ; adres © nezn m˜
0000:0FE8 EBCB           JMP    0FB5             ; chyba zad n¡ cesty

                                               ;* na‡ten¡ adres ©e ".."
0000:0FEA AC           * LODSB                   ; na‡ten¡ znaku
0000:0FEB 0AC0           OR     AL,AL            ; je konec textu ?
0000:0FED 7462           JZ     1051             ; je konec textu
0000:0FEF 3C2E           CMP    AL,2E            ; je oddˆlovac¡ te‡ka ?
0000:0FF1 75CE           JNZ    0FC1             ; nen¡ te‡ka - dal¨¡ znak
0000:0FF3 E84600         CALL   103C             ; zu¨en¡ posledn¡ho jm‚na
0000:0FF6 AC             LODSB                   ; na‡ten¡ znaku
0000:0FF7 0AC0           OR     AL,AL            ; je konec textu ?
0000:0FF9 7456           JZ     1051             ; je konec textu
0000:0FFB EBC4           JMP    0FC1             ; dal¨¡ znak

                                               ;* p©enos jm‚na s p©¡ponou
0000:0FFD 57             PUSH   DI               ; £schova za‡ tku textu
0000:0FFE 51             PUSH   CX               ; £schova CX
0000:0FFF B90008         MOV    CX,0800          ; max. d‚lka textu 8 znak–
0000:1002 B42E           MOV    AH,2E            ; omezuj¡c¡ znak - te‡ka "."
0000:1004 E84F00         CALL   1056             ; p©enos textu po znak
0000:1007 E8B1FF         CALL   0FBB             ; p©ekro‡ena d‚lka cesty ?
0000:100A 7313           JNB    101F             ; d‚lka cesty p©ekro‡ena
0000:100C 3AE0           CMP    AH,AL            ; byl oddˆlovac¡ znak "." ?
0000:100E 7412           JZ     1022             ; p©enesen¡ p©¡pony jm‚na
0000:1010 0AC0           OR     AL,AL            ; byl konec textu 0 ?
0000:1012 7407           JZ     101B             ; byl konec textu 0
0000:1014 AA           * STOSB                   ; ulo‘en¡ znaku do bufferu
0000:1015 E8A2FF         CALL   0FBA             ; zv˜¨en¡ ‡¡ta‡e znak–
0000:1018 7305           JNB    101F             ; p©ekro‡ena d‚lka cesty
0000:101A 46             INC    SI               ; p©ednastaven¡ SI
0000:101B 4E           * DEC    SI               ; n vrat posledn¡ho znaku
0000:101C 59             POP    CX               ; n vrat CX
0000:101D 58             POP    AX               ; zru¨en¡ star‚ho konce textu
0000:101E C3             RET
                                               ;* p©ekro‡ena d‚lka cesty-zru¨eno
0000:101F 59           * POP    CX               ; n vrat CX
0000:1020 5F             POP    DI               ; n vrat DI beze zmˆny
0000:1021 C3           * RET

0000:1022 AA           * STOSB                   ; ulo‘en¡ znaku
0000:1023 E894FF         CALL   0FBA             ; zv˜¨en¡ ‡¡ta‡e znak–
0000:1026 73F7           JNB    101F             ; p©ekro‡ena d‚lka cesty
0000:1028 AC             LODSB                   ; na‡ten¡ dal¨¡ho znaku
0000:1029 32E4           XOR    AH,AH            ; omezuj¡c¡ znak - 0
0000:102B B90003         MOV    CX,0300          ; d‚lka textu 3 znaky
0000:102E E82500         CALL   1056             ; p©enos textu po znak
0000:1031 E887FF         CALL   0FBB             ; p©ekro‡ena d‚lka cesty ?
0000:1034 73E9           JNB    101F             ; p©ekro‡ena d‚lka cesty
0000:1036 0AC0           OR     AL,AL            ; je konec textu 0 ?
0000:1038 74E1           JZ     101B             ; je konec textu 0
0000:103A EBD8           JMP    1014             ; n vrat

                                               ;* zru¨en¡ posledn¡ho jm‚na
0000:103C 4F             DEC    DI               ; n vrat ukazatele znak–
0000:103D 4B             DEC    BX               ; n vrat ‡¡ta‡e znak–
0000:103E 3BFA         * CMP    DI,DX            ; je ji‘ za‡ tek cesty ?
0000:1040 74DF           JZ     1021             ; je ji‘ za‡ tek cesty
0000:1042 50             PUSH   AX               ; £schova AX
0000:1043 268A45FF       MOV    AL,ES:[DI-01]    ; posledn¡ znak
0000:1047 E85720         CALL   30A1             ; test odˆlova‡e param., cesty
0000:104A 58             POP    AX               ; n vrat AX
0000:104B 74D4           JZ     1021             ; je oddˆlova‡
0000:104D 4F             DEC    DI               ; sn¡‘en¡ ukazatele
0000:104E 4B             DEC    BX               ; sn¡‘en¡ ‡¡ta‡e znak–
0000:104F EBED           JMP    103E             ; dal¨¡ znak

0000:1051 4F             DEC    DI

0000:1052 AA           * STOSB
0000:1053 E9F1F8         JMP    0947             ; n vrat z INT 21h s funkc¡ OK

                                               ;* p©enos textu po znak
0000:1056 AA             STOSB                   ; ulo‘en¡ znaku
0000:1057 FEC1           INC    CL               ; zv˜¨en¡ ‡¡ta‡e znak–
0000:1059 E85EFF         CALL   0FBA             ; zv˜¨en¡ ‡¡ta‡e znak–
0000:105C 7314           JNB    1072             ; p©ekro‡ena d‚lka cesty
0000:105E 0AC0           OR     AL,AL            ; je to konec textu ?
0000:1060 7410           JZ     1072             ; je to konec textu
0000:1062 3ACD           CMP    CL,CH            ; p©ekro‡en po‡et znak– ?
0000:1064 7602           JBE    1068             ; nen¡ p©ekro‡en po‡et znak–
0000:1066 4F             DEC    DI               ; n vrat ukazatele na znak
0000:1067 4B             DEC    BX               ; n vrat ‡¡ta‡e znak–
0000:1068 AC           * LODSB                   ; na‡ten¡ dal¨¡ho znaku
0000:1069 E83520         CALL   30A1             ; test odˆlova‡e param., cesty
0000:106C 7404           JZ     1072             ; je oddˆlova‡ - konec
0000:106E 3AC4           CMP    AL,AH            ; je zadan˜ znak ?
0000:1070 75E4           JNZ    1056             ; nen¡ zadan˜ znak - dal¨¡
0000:1072 C3           * RET

0000:1073 E9A500       * JMP    111B             ; chyba - cesta nenalezena
; -----------------------------------------------------------------------------
;         Slu‘ba 3ah - zru¨en¡ adres ©e
; -----------------------------------------------------------------------------
0000:1076 E84D29         CALL   39C6             ; test zad n¡ specif. souboru
0000:1079 72F8           JB     1073             ; chyba zad n¡ specifikace
0000:107B 8BF2           MOV    SI,DX            ; specifikace adres ©e
0000:107D E82107         CALL   17A1             ; nastaven¡ adres ©e
0000:1080 72F1           JB     1073             ; adres © nenalezen
0000:1082 7521           JNZ    10A5

0000:1084 8B3E4D04       MOV    DI,[044D]        ; aktu l. aloka‡n¡ blok
0000:1088 0BFF           OR     DI,DI            ; je to z kladn¡ adres © ?
0000:108A 7419           JZ     10A5             ; je to z kladn¡ adres ©-chyba
0000:108C 268B4E1C       MOV    CX,ES:[BP+1C]    ; po‡ te‡n¡ blok
0000:1090 83F9FF         CMP    CX,-01           ; je definov n ?
0000:1093 7515           JNZ    10AA             ; je definov n
0000:1095 E8F705         CALL   168F             ; aktualizace aktu l. adres ©e
0000:1098 E847F7         CALL   07E2             ; nastaven¡ ukazat. na registry
0000:109B 8B5406         MOV    DX,[SI+06]       ; DX
0000:109E 8E5C0E         MOV    DS,[SI+0E]       ; DS
0000:10A1 EBD3           JMP    1076             ; opakov n¡ operace

0000:10A3 58           * POP    AX
0000:10A4 58             POP    AX

0000:10A5 B005         * MOV    AL,05            ; chyba - nelze zru¨it
0000:10A7 E9A7F8       * JMP    0951             ; n vrat z INT 21h s chybou CY


0000:10AA 3BF9         * CMP    DI,CX            ; je to z kladn¡ adres © ?
0000:10AC 7504           JNZ    10B2             ; nen¡ to z kladn¡ adres ©
0000:10AE B010           MOV    AL,10            ; chyba - nelze ru¨it ROOT
0000:10B0 EBF5         * JMP    10A7             ; n vrat s chybou

0000:10B2 C53E6904     * LDS    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:10B6 2BDF           SUB    BX,DI            ; velikost bufferu
0000:10B8 53             PUSH   BX
0000:10B9 FF7508         PUSH   [DI+08]          ; logick‚ ‡¡slo sektoru
0000:10BC 16             PUSH   SS
0000:10BD 1F             POP    DS               ; DS <- CS
0000:10BE 16             PUSH   SS
0000:10BF 07             POP    ES               ; ES <- CS
0000:10C0 BFEF03         MOV    DI,03EF          ;
0000:10C3 B03F           MOV    AL,3F            ;'?'
0000:10C5 B90B00         MOV    CX,000B          ; po‡et znak– jm‚na
0000:10C8 F3             REPZ
0000:10C9 AA             STOSB                   ; nastaven¡ jm‚na na "?"
0000:10CA 32C0           XOR    AL,AL
0000:10CC AA             STOSB                   ; koncov  0
0000:10CD E88808         CALL   1958             ; inicializace ukazatel–
0000:10D0 E84105         CALL   1614             ; ‡ten¡ polo‘ky adres ©e
0000:10D3 8E1E6B04       MOV    DS,[046B]        ;
0000:10D7 8BF3           MOV    SI,BX            ; za‡ tek nalezen‚ polo‘ky
0000:10D9 AD             LODSW                   ; prvn¡ 2 znaky jm‚na
0000:10DA 3D2E20         CMP    AX,202E          ; je to adres © "." ?
0000:10DD 75C4           JNZ    10A3             ; nen¡ to "." - chyba
0000:10DF 83C61E         ADD    SI,+1E           ; adresa dal¨¡ polo‘ky
0000:10E2 AD             LODSW                   ; prvn¡ 2 znaky dal¨¡ polo‘ky
0000:10E3 3D2E2E         CMP    AX,2E2E          ; je to ".." ?
0000:10E6 75BB           JNZ    10A3             ; nen¡ to ".." - chyba
0000:10E8 16             PUSH   SS
0000:10E9 1F             POP    DS               ; DS <- CS
0000:10EA C70621010200   MOV    Word Ptr [0121],0002 ; po‡ te‡n¡ sektor ROOT
0000:10F0 E82105         CALL   1614             ; ‡ten¡ polo‘ky adres ©e
0000:10F3 C606FB0316     MOV    Byte Ptr [03FB],16 ; atributy - DIR, SYS, HID
0000:10F8 E88B04         CALL   1586             ; nalezen¡ nˆjak‚ho souboru
0000:10FB 73A6           JNB    10A3             ; je nˆjak˜ soubor - chyba
0000:10FD C42E2604       LES    BP,[0426]        ; adresa z hlav¡ za©¡zen¡
0000:1101 8B1E4D04       MOV    BX,[044D]        ; aktu l. aloka‡n¡ blok
0000:1105 E83A15         CALL   2642             ; nalezen¡ dal¨¡ho bloku
0000:1108 5A             POP    DX               ; sektor ke ‡ten¡
0000:1109 32C0           XOR    AL,AL            ; p©¡znak na‡ten¡ sektoru
0000:110B E82B16         CALL   2739             ; z¡sk n¡ sektoru DX
0000:110E C53E6904       LDS    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:1112 5B             POP    BX               ; n vrat adresy polo‘ky
0000:1113 03DF           ADD    BX,DI            ; adresa polo‘ky adres ©e
0000:1115 C607E5         MOV    Byte Ptr [BX],E5 ; ozna‡en¡ adres ©e jako ru¨en˜
0000:1118 E90BFE         JMP    0F26             ; ulo‘en¡ modifikovan‚ho adres.

0000:111B B003           MOV    AL,03            ; chyba - cesta nenalezena
0000:111D EB91           JMP    10B0             ; n vrat s chybou

; *****************************************************************************
;
;                 Obsluha p©idˆlov n¡ aloka‡n¡ch blok– pamˆti
;
; *****************************************************************************


; -----------------------------------------------------------------------------
;         Uvolnˆn¡ v¨ech blok– ur‡it‚ho vlastn¡ka
; -----------------------------------------------------------------------------
0000:111F BF0000         MOV    DI,0000          ; vlastn¡k - voln˜ blok
0000:1122 36A1EE00       MOV    AX,SS:[00EE]     ; prvn¡ alok. blok pamˆti
0000:1126 E82000         CALL   1149             ; test aloka‡n¡ho bloku AX
0000:1129 7301         * JNB    112C             ; aloka‡n¡ blok OK
0000:112B C3           * RET

0000:112C 06           * PUSH   ES
0000:112D 1F             POP    DS               ; DS <- segment nov‚ho bloku
0000:112E 391E0100       CMP    [0001],BX        ; je to tento vlastn¡k ?
0000:1132 7504           JNZ    1138             ; nen¡ to tento vlastn¡k
0000:1134 893E0100       MOV    [0001],DI        ; nov˜ vlastn¡k (pr zdn˜)
0000:1138 803D5A       * CMP    Byte Ptr [DI],5A ; posledn¡ alok. blok ?
0000:113B 74EE           JZ     112B             ; posledn¡ alok. blok
0000:113D E80200         CALL   1142             ; nalezen¡ dal¨¡ho alok. bloku
0000:1140 EBE7           JMP    1129             ; uvolnˆn¡ dal¨¡ho bloku
; -----------------------------------------------------------------------------
;         Nalezen¡ dal¨¡ho aloka‡n¡ho bloku
; -----------------------------------------------------------------------------
0000:1142 8CD8           MOV    AX,DS            ; p–vodn¡ aloka‡n¡ blok
0000:1144 03060300       ADD    AX,[0003]        ; zv˜¨en¡ o velikost bloku
0000:1148 40             INC    AX               ; korekce pro z hlav¡ bloku
; -----------------------------------------------------------------------------
;         Test aloka‡n¡ho bloku AX
; -----------------------------------------------------------------------------
0000:1149 8EC0           MOV    ES,AX            ; adresa dal¨¡ho bloku
0000:114B 26803D4D       CMP    Byte Ptr ES:[DI],4D ; je st©edn¡ blok "M" ?
0000:114F 7408           JZ     1159             ; je st©edn¡ blok - OK
0000:1151 26803D5A       CMP    Byte Ptr ES:[DI],5A ; je posledn¡ blok "Z" ?
0000:1155 7402           JZ     1159             ; je posledn¡ blok - OK
0000:1157 F9             STC                     ; chyba - neplatn˜ blok
0000:1158 C3             RET

0000:1159 F8           * CLC
0000:115A C3           * RET
; -----------------------------------------------------------------------------
;         P©ipojen¡ voln˜ch aloka‡n¡ch blok–
; -----------------------------------------------------------------------------
0000:115B 803D5A         CMP    Byte Ptr [DI],5A ; je posledn¡ alok. blok "Z" ?
0000:115E 74FA           JZ     115A             ; je to ji‘ posledn¡ blok
0000:1160 E8DFFF         CALL   1142             ; nalezen¡ dal¨¡ho alok. bloku
0000:1163 72F5           JB     115A             ; chybn˜ alok. blok
0000:1165 26393E0100     CMP    ES:[0001],DI     ; je to voln˜ blok ?
0000:116A 75EE           JNZ    115A             ; nen¡ to voln˜ blok
0000:116C 268B0E0300     MOV    CX,ES:[0003]     ; d‚lka ru¨en‚ho alok. bloku
0000:1171 41             INC    CX               ; korekce pro z hlav¡ bloku
0000:1172 010E0300       ADD    [0003],CX        ; zv˜¨en¡ velikosti bloku
0000:1176 268A0D         MOV    CL,ES:[DI]       ; p–vodn¡ popisova‡ bloku
0000:1179 880D           MOV    [DI],CL          ; je nov˜m popisova‡em
0000:117B EBDE           JMP    115B             ; p©ipojen¡ dal¨¡ho alok. bloku
; -----------------------------------------------------------------------------
;         Slu‘ba 48h - p©idˆlen¡ aloka‡n¡ho bloku
; -----------------------------------------------------------------------------
0000:117D 33C0           XOR    AX,AX            ; AX <- 0
0000:117F 8BF8           MOV    DI,AX            ; DI <- 0
0000:1181 36A3E700       MOV    SS:[00E7],AX     ; prvn¡ nalezen˜ alok. blok
0000:1185 36A3E900       MOV    SS:[00E9],AX     ; nejmen¨¡ dostate‡. alok. blok
0000:1189 36A3EB00       MOV    SS:[00EB],AX     ; posledn¡ nalezen˜ alok. blok
0000:118D 50             PUSH   AX               ; £schova 0 (nalezen˜ max.blok)
0000:118E 36A1EE00       MOV    AX,SS:[00EE]     ; prvn¡ aloka‡n¡ blok
0000:1192 E8B4FF         CALL   1149             ; test aloka‡n¡ho bloku AX
0000:1195 7212           JB     11A9             ; chybn˜ aloka‡n¡ blok
                                               ;* proch zen¡ p©es v¨echny bloky
0000:1197 06           * PUSH   ES
0000:1198 1F             POP    DS               ; DS <- ES 1. alok. blok
0000:1199 393E0100       CMP    [0001],DI        ; je to voln˜ blok ?
0000:119D 7423           JZ     11C2             ; je voln˜ blok
0000:119F 803D5A       * CMP    Byte Ptr [DI],5A ; je posledn¡ aloka‡n¡ blok ?
0000:11A2 740B           JZ     11AF             ; je posledn¡ alok. blok
0000:11A4 E89BFF         CALL   1142             ; nalezen¡ dal¨¡ho alok. bloku
0000:11A7 73EE           JNB    1197             ; nalezen dal¨¡ blok OK
                                               ;* chyba - neplatn˜ alok. blok
0000:11A9 58           * POP    AX               ; n vrat max. nalez. bloku
0000:11AA B007           MOV    AL,07            ; chyba-©¡d. blok pamˆti zni‡en
0000:11AC E9A2F7       * JMP    0951             ; n vrat z INT 21h s chybou CY
                                               ;* je konec pamˆti
0000:11AF 36833EE70000 * CMP    Word Ptr SS:[00E7],+00 ; nalezen nˆjak˜ blok ?
0000:11B5 7568           JNZ    121F             ; nalezen alespo¤ 1 blok
0000:11B7 E828F6       * CALL   07E2             ; nastaven¡ ukazat. na registry
0000:11BA 5B             POP    BX               ; n vrat max. veliksoti bloku
0000:11BB 895C02         MOV    [SI+02],BX       ; nejvˆt¨¡ nalezen˜ alok. blok
0000:11BE B008           MOV    AL,08            ; chyba - nedostatek pamˆti
0000:11C0 EBEA           JMP    11AC             ; n vrat s chybou
                                               ;* nalezen voln˜ alok. blok
0000:11C2 E896FF       * CALL   115B             ; p©ipojen¡ voln˜ch alok. blok–
0000:11C5 72E2           JB     11A9             ; chyba - nespr vn˜ alok. blok
                                               ;* nastaven¡ maxim ln¡ velikosti
0000:11C7 8B0E0300       MOV    CX,[0003]        ; velikost nalezen‚ho bloku
0000:11CB 5A             POP    DX               ; maxim ln¡ velikost bloku
0000:11CC 3BCA           CMP    CX,DX            ; je to vˆt¨¡ blok ?
0000:11CE 7602           JBE    11D2             ; nen¡ to vˆt¨¡ blok
0000:11D0 8BD1           MOV    DX,CX            ; nov˜ nejvˆt¨¡ blok
0000:11D2 52           * PUSH   DX               ; £schova maxim ln¡ho bloku
0000:11D3 3BD9           CMP    BX,CX            ; je to posta‡uj¡c¡ velikost ?
0000:11D5 77C8           JA     119F             ; blok nesta‡¡ - dal¨¡
                                               ;* nastaven¡ prvn¡ho bloku
0000:11D7 36833EE70000   CMP    Word Ptr SS:[00E7],+00 ; byl ji‘ nalezen blok ?
0000:11DD 7505           JNZ    11E4             ; byl ji‘ nalezen vhodn˜ blok
0000:11DF 368C1EE700     MOV    SS:[00E7],DS     ; £schova adresy prvn¡ho bloku
                                               ;* nastaven¡ nejmen¨¡ho bloku
0000:11E4 36833EE90000 * CMP    Word Ptr SS:[00E9],+00 ; nalezen nejmen¨¡ blok ?
0000:11EA 740E           JZ     11FA             ; nejmen¨¡ blok nenalezen
0000:11EC 06             PUSH   ES
0000:11ED 368E06E900     MOV    ES,SS:[00E9]     ; nejmen¨¡ dostate‡. alok. blok
0000:11F2 26390E0300     CMP    ES:[0003],CX     ; je to men¨¡ blok ?
0000:11F7 07             POP    ES
0000:11F8 7605           JBE    11FF             ; nen¡ to men¨¡ blok
0000:11FA 368C1EE900   * MOV    SS:[00E9],DS     ; nov˜ nejmen¨¡ alok. blok
                                               ;* posledn¡ nalezen˜ blok
0000:11FF 368C1EEB00   * MOV    SS:[00EB],DS     ; posledn¡ nalezen˜ alok. blok
0000:1204 EB99           JMP    119F

                                               ;* pou‘ije se nejvy¨¨¡ blok
0000:1206 368E1EEB00   * MOV    DS,SS:[00EB]     ; posledn¡ nalezen˜ alok. blok
0000:120B 8B0E0300       MOV    CX,[0003]        ; velikost bloku
0000:120F 2BCB           SUB    CX,BX            ; je zbytkov˜ blok ?
0000:1211 8CDA           MOV    DX,DS            ; £schova adresy bloku
0000:1213 7445           JZ     125A             ; nen¡ zbytkov˜ blok
0000:1215 03D1           ADD    DX,CX            ; adresa dal¨¡ho bloku
0000:1217 8EC2           MOV    ES,DX            ;
0000:1219 49             DEC    CX
0000:121A 87D9           XCHG   BX,CX
0000:121C EB27           JMP    1245
0000:121E 90             NOP

                                               ;* aloka‡n¡ blok byl nalezen
0000:121F 36803EED0001 * CMP    Byte Ptr SS:[00ED],01 ; strategie alokace pamˆti
0000:1225 77DF           JA     1206             ; pou‘ije se nejvy¨¨¡ blok
0000:1227 368E1EE700     MOV    DS,SS:[00E7]     ; prvn¡ nalezen˜ alok. blok
0000:122C 7205           JB     1233             ; pou‘ije se prvn¡ blok
0000:122E 368E1EE900     MOV    DS,SS:[00E9]     ; nejmen¨¡ dostate‡. alok. blok
0000:1233 8B0E0300     * MOV    CX,[0003]        ; velikost nalezen‚ho bloku
0000:1237 2BCB           SUB    CX,BX            ; zbytek aloka‡n¡ho bloku
0000:1239 8CD8           MOV    AX,DS            ; segment nalezen‚ho bloku
0000:123B 8BD0           MOV    DX,AX            ; segment nalezen‚ho bloku
0000:123D 741B           JZ     125A             ; nezbyl ‘ dn˜ blok
                                               ;* vytvo©en¡ zbytkov‚ho bloku
0000:123F 03C3           ADD    AX,BX            ; popisova‡ zbytkov‚ho bloku
0000:1241 40             INC    AX               ; segment zbytkov‚ho bloku
0000:1242 8EC0           MOV    ES,AX            ; segment zbytkov‚ho bloku
0000:1244 49             DEC    CX               ; velikost bloku - 1
                                               ;* nastaven¡ velikost¡ blok–
0000:1245 891E0300     * MOV    [0003],BX        ; nov  velikost alok. bloku
0000:1249 26890E0300     MOV    ES:[0003],CX     ; velikost zbytkov‚ho bloku
0000:124E B34D           MOV    BL,4D            ; ozna‡en¡ st©edn¡ho bloku "M"
0000:1250 861D           XCHG   BL,[DI]          ; nov‚ ozna‡en¡ alok. bloku
0000:1252 26881D         MOV    ES:[DI],BL       ; p©enos do zbytkov‚ho bloku
0000:1255 26893E0100     MOV    ES:[0001],DI     ; zbytkov˜ blok je voln˜ <- 0
                                               ;* ozna‡en¡ nov‚ho vlatn¡ka
0000:125A 8EDA         * MOV    DS,DX            ; n vrat segmentu bloku
0000:125C 36A18B01       MOV    AX,SS:[018B]     ; segment aktivn¡ho PSP
0000:1260 A30100         MOV    [0001],AX        ; vlastn¡kem je program
0000:1263 8CD8           MOV    AX,DS            ; segment nov‚ho bloku-1
0000:1265 40             INC    AX               ; segment nov‚ho bloku
0000:1266 5B             POP    BX               ; n vrat BX
0000:1267 E9DDF6       * JMP    0947             ; n vrat z INT 21h s funkc¡ OK
; -----------------------------------------------------------------------------
;         Slu‘ba 4ah - modifikace p©idˆlen‚ pamˆti
; -----------------------------------------------------------------------------
0000:126A BF0000         MOV    DI,0000          ; DI <- 0
0000:126D 8CC0           MOV    AX,ES            ; modikovan˜ aloka‡n¡ blok
0000:126F 48             DEC    AX               ; z hlav¡ bloku
0000:1270 E8D6FE         CALL   1149             ; test aloka‡n¡ho bloku AX
0000:1273 7303           JNB    1278             ; je to aloka‡n¡ blok OK
0000:1275 E932FF       * JMP    11AA             ; chyba - blok pamˆti zni‡en
0000:1278 8ED8         * MOV    DS,AX            ; modifikovan˜ alok. blok
0000:127A E8DEFE         CALL   115B             ; p©ipojen¡ voln˜ch alok. blok–
0000:127D 72F6           JB     1275             ; chyba aloka‡n¡ho bloku
0000:127F 8B0E0300       MOV    CX,[0003]        ; maxim ln¡ velikost bloku
0000:1283 51             PUSH   CX
0000:1284 3BD9           CMP    BX,CX            ; kontrola max. velikosti
0000:1286 76AB           JBE    1233             ; po‘adovan  velikost OK
0000:1288 E92CFF         JMP    11B7             ; chyba - nedostatek pamˆti
; -----------------------------------------------------------------------------
;         Slu‘ba 49h - uvolnˆn¡ aloka‡n¡ho bloku pamˆti
; -----------------------------------------------------------------------------
0000:128B BF0000         MOV    DI,0000          ; DI <- 0
0000:128E 8CC0           MOV    AX,ES            ; uvol¤ovan˜ alok. blok
0000:1290 48             DEC    AX               ; popisova‡ alok. bloku
0000:1291 E8B5FE         CALL   1149             ; test aloka‡n¡ho bloku AX
0000:1294 7207           JB     129D             ; chybn˜ aloka‡n¡ blok
0000:1296 26893E0100     MOV    ES:[0001],DI     ; ozna‡en¡ bloku jako voln˜
0000:129B EBCA           JMP    1267             ; n vrat OK
                                               ;* chyba zad n¡ adresy bloku
0000:129D B009         * MOV    AL,09            ; chyba - neplatn  adresa bloku
0000:129F E9AFF6         JMP    0951             ; n vrat z INT 21h s chybou CY
; -----------------------------------------------------------------------------
;         Slu‘ba 58h - strategie p©idˆlov n¡ aloka‡n¡ch blok– pamˆti
; -----------------------------------------------------------------------------
0000:12A2 3C01           CMP    AL,01            ; je podslu‘ba 1 ?
0000:12A4 7206           JB     12AC             ; je podslu‘ba 0
0000:12A6 740C           JZ     12B4             ; je podslu‘ba 1
0000:12A8 B001           MOV    AL,01            ; chyba - neplatn˜ povel
0000:12AA EBF3           JMP    129F             ; n vrat s chybou
                                               ;* sl. 0 - poskytnut¡ strategie
0000:12AC 36A0ED00     * MOV    AL,SS:[00ED]     ; sou‡asn  strategie alokace
0000:12B0 32E4           XOR    AH,AH
0000:12B2 EBE7         * JMP    129B             ; n vrat OK
                                               ;* sl.1 - nastaven¡ strategie
0000:12B4 36881EED00     MOV    SS:[00ED],BL     ; nastaven¡ nov‚ strategie
0000:12B9 EBF7           JMP    12B2             ; n vrat OK
; -----------------------------------------------------------------------------



; *****************************************************************************
;
;                   Obsluha znakov‚ho za©¡zen¡ (konzola)
;
; *****************************************************************************
                                               ;* opakov n¡ operace za©¡zen¡
0000:12BB E800F5       * CALL   07BE             ; n vrat v¨ech registr–


                                               ;* obsluha funkc¡ konzoly
0000:12BE 368C165701     MOV    SS:[0157],SS     ; segment pracovn¡ DTA
0000:12C3 36C7065501E903 MOV    Word Ptr SS:[0155],03E9 ; offset pracovn¡ DTA
0000:12CA 36C70659010100 MOV    Word Ptr SS:[0159],0001 ; po‡et z znam– = 1
0000:12D1 36A3E903       MOV    SS:[03E9],AX     ; po‘adovan  funkce
0000:12D5 F6441880       TEST   Byte Ptr [SI+18],80 ; je znakov‚ za©¡zen¡ ?
0000:12D9 7503           JNZ    12DE             ; nen¡ to znakov‚ za©¡zen¡
0000:12DB E98000         JMP    135E             ; proveden¡ oper. se znak. za©.

                                               ;* obsluha blokov‚ho za©¡zen¡
0000:12DE E8F1F4         CALL   07D2             ; £schova v¨ech registr–
0000:12E1 1E             PUSH   DS               ; £schova DS
0000:12E2 16             PUSH   SS
0000:12E3 07             POP    ES               ; ES <- CS
0000:12E4 16             PUSH   SS
0000:12E5 1F             POP    DS               ; DS <- CS
0000:12E6 33DB           XOR    BX,BX            ; BX <- 0 stavov‚ slovo
0000:12E8 891E4A01       MOV    [014A],BX        ; stavov‚ slovo za©¡z. (konz.)
0000:12EC 881E5401       MOV    [0154],BL        ; popisova‡ m‚dia (konzola)
0000:12F0 BB4701         MOV    BX,0147          ; adresa z hlav¡ za©¡zen¡
                                               ;* nastaven¡ ‡¡sla funkce
0000:12F3 B91604         MOV    CX,0416          ; funkce ‡ten¡ ze za©¡zen¡
0000:12F6 0AE4           OR     AH,AH            ; je ‡ten¡ ze za©¡zen¡ ?
0000:12F8 7418           JZ     1312             ; je ‡ten¡ ze za©¡zen¡
0000:12FA B90E05         MOV    CX,050E          ; funkce nedestrukt. ‡ten¡
0000:12FD FECC           DEC    AH               ; je test vstupu ze za©¡zen¡ ?
0000:12FF 7411           JZ     1312             ; je test vstupu ze za©¡zen¡
0000:1301 B91608         MOV    CX,0816          ; funkce z pisu na za©¡zen¡
0000:1304 FECC           DEC    AH               ; je z pis na za©¡zen¡ ?
0000:1306 7452           JZ     135A             ; je z pis na za©¡zen¡
0000:1308 B90D0A         MOV    CX,0A0D          ; funkce statut v˜stupu
0000:130B FECC           DEC    AH               ; je statut v˜stupu ?
0000:130D 744B           JZ     135A             ; je statut v˜stupu
0000:130F B90F07         MOV    CX,070F          ; funkce vypr zdnˆn¡ vstupu
                                               ;* operace ‡ten¡
0000:1312 B486         * MOV    AH,86            ; p©¡znak chyby znak. za©¡zen¡
0000:1314 880E4701     * MOV    [0147],CL        ; nastaven¡ d‚lky po‘adavku z.
0000:1318 882E4901       MOV    [0149],CH        ; nastaven¡ povelu pro operaci
0000:131C 8ACC           MOV    CL,AH            ; £schova p©¡znaku chyby za©¡z.
0000:131E 1F             POP    DS
0000:131F E8CC00         CALL   13EE             ; obsluha aktivn¡ho za©¡zen¡
0000:1322 368B3E4A01     MOV    DI,SS:[014A]     ; stavov‚ slovo za©¡z. (konz.)
0000:1327 F7C70080       TEST   DI,8000          ; byla chyba operace ?
0000:132B 740F           JZ     133C             ; operace byla OK
0000:132D 8AE1           MOV    AH,CL            ; p©¡znak chyby za©¡zen¡
0000:132F E83B1A         CALL   2D6D             ; obsluha chyby INT 24h
0000:1332 3C01           CMP    AL,01            ; je opakov n¡ operace ?
0000:1334 7485           JZ     12BB             ; je opakov n¡ operace
0000:1336 3680264B01FD   AND    Byte Ptr SS:[014B],FD ; chyba operace
0000:133C 16           * PUSH   SS
0000:133D 1F             POP    DS               ; DS <- CS
0000:133E 80FD05         CMP    CH,05            ; byl nedestruktivn¡ vstup ?
0000:1341 7506           JNZ    1349             ; nebyl nedestruktivn¡ vstup
0000:1343 A05401         MOV    AL,[0154]        ; navr cen˜ p©ipraven˜ znak
0000:1346 A2E903         MOV    [03E9],AL        ; p©e‡ten˜ znak
0000:1349 8A264B01     * MOV    AH,[014B]        ; atributy za©¡zen¡ HIGH
0000:134D F6D4           NOT    AH
0000:134F 80E402         AND    AH,02
0000:1352 E869F4         CALL   07BE             ; n vrat v¨ech registr–
0000:1355 36A1E903       MOV    AX,SS:[03E9]     ; p©e‡ten˜ znak
0000:1359 C3             RET
                                               ;* operace z pisu
0000:135A B487           MOV    AH,87
0000:135C EBB6           JMP    1314
; -----------------------------------------------------------------------------
                                               ;* proveden¡ operace se znak.za©.
                                                 ; VSTUP: AH=0 ‡ten¡ znaku
                                                 ;        AH=1 test znaku
                                                 ;        AH=2 z pis znaku

0000:135E 0AE4         * OR     AH,AH            ; je ‡ten¡ znaku ?
0000:1360 7426           JZ     1388             ; ‡ten¡ znaku ze znak. za©¡zen¡
0000:1362 FECC           DEC    AH               ; je test znaku ?
0000:1364 7405           JZ     136B             ; test znaku ze znak. za©¡zen¡
0000:1366 FECC           DEC    AH               ; je z pis znaku
0000:1368 7411           JZ     137B             ; z pis znaku na znak. za©¡zen¡
0000:136A C3             RET
; -----------------------------------------------------------------------------
                                               ;* test znaku ze znak. za©¡zen¡
0000:136B FF7421         PUSH   [SI+21]          ; £schova rel. z znamu LOW
0000:136E FF7423         PUSH   [SI+23]          ; £schova rel. z znamu HIGH
0000:1371 E81400         CALL   1388             ; ‡ten¡ znaku ze znak. za©¡zen¡
0000:1374 8F4423         POP    [SI+23]          ; n vrat rel. z znamu HIGH
0000:1377 8F4421         POP    [SI+21]          ; n vrat rel. z znamu LOW
0000:137A C3             RET
; -----------------------------------------------------------------------------
                                               ;* z pis znaku na znak. za©¡zen¡
0000:137B E82300         CALL   13A1             ; p©¡pr. reg. pro operaci V/V
0000:137E E8FF07         CALL   1B80             ; z pis z znamu na za©¡zen¡
0000:1381 E89F15         CALL   2923             ; nastav. nov‚ho ‡¡sla z znamu
0000:1384 E85000         CALL   13D7             ; n vrat registr– i adresy DTA
0000:1387 C3           * RET
; -----------------------------------------------------------------------------
                                               ;* ‡ten¡ znaku ze znak. za©¡zen¡
0000:1388 E81600       * CALL   13A1             ; p©¡pr. reg. pro operaci V/V
0000:138B E8BB06         CALL   1A49             ; ‡ten¡ z znamu ze za©¡zen¡
0000:138E 51             PUSH   CX               ; po‡et p©e‡ten˜ch znak–
0000:138F E89115         CALL   2923             ; nastav. nov‚ho ‡¡sla z znamu
0000:1392 59             POP    CX               ; po‡et p©e‡ten˜ch znak–
0000:1393 0BC9           OR     CX,CX            ; byl p©e‡ten nˆjak˜ znak ?
0000:1395 E83F00         CALL   13D7             ; n vrat registr– i adresy DTA
0000:1398 36A0E903       MOV    AL,SS:[03E9]     ; p©e‡ten˜ znak
0000:139C 75E9           JNZ    1387             ; byl p©ijat nˆjak˜ znak
0000:139E B01A           MOV    AL,1A            ; znak konce souboru ^Z
0000:13A0 C3             RET
; -----------------------------------------------------------------------------
                                               ;* p©¡pr. reg. pro operaci V/V
0000:13A1 368F063F01     POP    SS:[013F]        ; £schova n vratov‚ adresy
0000:13A6 E829F4         CALL   07D2             ; £schova v¨ech registr–
0000:13A9 36FF36DF00     PUSH   SS:[00DF]        ; £schova offsetu adresy DTA
0000:13AE 36FF36E100     PUSH   SS:[00E1]        ; £schova segmentu adresy DTA
0000:13B3 1E             PUSH   DS               ; £schova DS
0000:13B4 16             PUSH   SS
0000:13B5 1F             POP    DS               ; DS <- CS
0000:13B6 8B0E5701       MOV    CX,[0157]        ; seg. DTA pro obsluhu konzoly
0000:13BA 890EE100       MOV    [00E1],CX        ; segment DTA
0000:13BE 8B0E5501       MOV    CX,[0155]        ; off. DTA pro obsluhu konzoly
0000:13C2 890EDF00       MOV    [00DF],CX        ; offset DTA
0000:13C6 8B0E5901       MOV    CX,[0159]        ; po‡et z znam– pro operaci
0000:13CA 1F             POP    DS               ; n vrat DS
0000:13CB C7440E0100     MOV    Word Ptr [SI+0E],0001 ; d‚lka z znamu = 1 bajt
0000:13D0 8BD6           MOV    DX,SI            ; adresa za‡ tku FCB
0000:13D2 E82B10         CALL   2400             ; ‡ten¡ rel. z znamu z FCB
0000:13D5 EB12           JMP    13E9             ; n vrat z podprogramu
; -----------------------------------------------------------------------------
                                               ;* n vrat registr– i adresy DTA
0000:13D7 368F063F01     POP    SS:[013F]        ; £schova n vratov‚ adresy
0000:13DC 368F06E100     POP    SS:[00E1]        ; n vrat segmentu adresy DTA
0000:13E1 368F06DF00     POP    SS:[00DF]        ; n vrat offsetu adresy DTA
0000:13E6 E8D5F3         CALL   07BE             ; n vrat v¨ech registr–
0000:13E9 36FF263F01   * JMP    SS:[013F]        ; n vrat z podprogramu
; -----------------------------------------------------------------------------
;         Vol n¡ obsluhy za©¡zen¡ DS:SI
; -----------------------------------------------------------------------------
                                               ;* vol n¡ obsluhy aktiv. za©¡zen¡
0000:13EE C57419       * LDS    SI,[SI+19]       ; ukazatel na aktivn¡ za©¡zen¡

                                               ;* vol n¡ obsluhy za©¡zen¡ DS:SI
                                               ;* ES:BX=z hlav¡ za©¡zen¡

0000:13F1 8B4406         MOV    AX,[SI+06]       ; offset rutiny strategie
0000:13F4 36A34301       MOV    SS:[0143],AX     ; adresa strategie
0000:13F8 368C1E4501     MOV    SS:[0145],DS     ; segment obsluhy za©¡zen¡
0000:13FD 36FF1E4301     CALL   FAR SS:[0143]    ; vol n¡ strategie za©¡zen¡
0000:1402 8B4408         MOV    AX,[SI+08]       ; offset rutiny p©eru¨en¡
0000:1405 36A34301       MOV    SS:[0143],AX
0000:1409 36FF1E4301     CALL   FAR SS:[0143]    ; vol n¡ rutiny p©eru¨en¡
0000:140E C3             RET
; -----------------------------------------------------------------------------
;                Nalezen¡ z hlav¡ znakov‚ho za©¡zen¡
; -----------------------------------------------------------------------------
0000:140F 56             PUSH   SI
0000:1410 57             PUSH   DI
0000:1411 51             PUSH   CX
0000:1412 F606FB0308     TEST   Byte Ptr [03FB],08
0000:1417 7520           JNZ    1439
0000:1419 BE0701         MOV    SI,0107          ; za‡ tek ©etˆzce za©¡zen¡ NUL
0000:141C F744040080   * TEST   Word Ptr [SI+04],8000 ; je to znakov‚ za©¡zen¡ ?
0000:1421 740F           JZ     1432             ; nen¡ to znakov‚ za©¡zen¡
0000:1423 56             PUSH   SI               ; £schova offsetu z hlav¡
0000:1424 83C60A         ADD    SI,+0A           ; jm‚no za©¡zen¡
0000:1427 BFEF03         MOV    DI,03EF          ; jm‚no hledan‚ho za©¡zen¡
0000:142A B90400         MOV    CX,0004          ; d‚lka jm‚na
0000:142D F3             REPZ
0000:142E A7             CMPSW                   ; porovn n¡ jmen
0000:142F 5E             POP    SI               ; n vrat offsetu z hlav¡
0000:1430 740E           JZ     1440             ; za©¡zen¡ bylo nalezeno
0000:1432 C534         * LDS    SI,[SI]          ; adresa dal¨¡ho za©¡zen¡
0000:1434 83FEFF         CMP    SI,-01           ; je ji‘ konec ©etˆzce ?
0000:1437 75E3           JNZ    141C             ; nen¡ je¨tˆ konec ©etˆzce
0000:1439 F9           * STC                     ; chyba - za©¡zen¡ nenalezeno
0000:143A 16           * PUSH   SS
0000:143B 1F             POP    DS
0000:143C 59             POP    CX
0000:143D 5F             POP    DI
0000:143E 5E             POP    SI
0000:143F C3             RET

0000:1440 368C1E3904   * MOV    SS:[0439],DS     ; segment z hlav¡ za©¡zen¡
0000:1445 8A7C04         MOV    BH,[SI+04]       ; atributy za©¡zen¡
0000:1448 80CFC0         OR     BH,C0            ;
0000:144B 80E7DF         AND    BH,DF
0000:144E 3689363704     MOV    SS:[0437],SI     ; offset z hlav¡ za©¡zen¡
0000:1453 EBE5           JMP    143A
; -----------------------------------------------------------------------------
;         Nalezen¡ adresy tabulky disku
; -----------------------------------------------------------------------------
                                               ;* VSTUP: AL=‡¡slo disku
                                               ;* VSTUP: CY=chyba
                                               ;*         ES:BP=tabulka disku

0000:1455 C42EF000       LES    BP,[00F0]        ; adresa tabulky disk. za©¡zen¡
0000:1459 243F           AND    AL,3F            ; ‡¡slo disk. jednotky
0000:145B 3A060001       CMP    AL,[0100]        ; po‡et instalovan˜ch log.disk–
0000:145F F5             CMC
0000:1460 720C           JB     146E             ; p©ekro‡en¡ po‡tu disk–
0000:1462 263A4600     * CMP    AL,ES:[BP+00]    ; je to hledan˜ disk ?
0000:1466 7406           JZ     146E             ; disk nalezen
0000:1468 26C46E18       LES    BP,ES:[BP+18]    ; adresa dal¨¡ho disku
0000:146C EBF4           JMP    1462             ; dal¨¡ disk
0000:146E 892E2604     * MOV    [0426],BP        ; adresa tabulky log. disku
0000:1472 8C062804       MOV    [0428],ES
0000:1476 C3             RET
; -----------------------------------------------------------------------------
;         Sestaven¡ z hlav¡ za©¡zen¡ pro ‡ten¡
; -----------------------------------------------------------------------------
                                               ;* VSTUP: AL=‡¡slo vnit©n¡ jedn.
                                                 ;       AH=popisova‡ m‚dia
                                                 ;       CX=po‡et sektor–
                                                 ;       DX=po‡ te‡n¡ sektor
                                                 ;       DS:BX=adresa bufferu
                                               ;* VSTUP: ES:BX=adresa z hlav¡

0000:1477 57             PUSH   DI               ; £schova DI
0000:1478 51             PUSH   CX               ; £schova po‡tu sektor– CX
0000:1479 50             PUSH   AX               ; £schova ‡¡sla disk. jednotky
0000:147A B104           MOV    CL,04            ; povel - ‡ten¡ ze za©¡zen¡

0000:147C B016         * MOV    AL,16            ; d‚lka z hlav¡ = 22
0000:147E 16             PUSH   SS
0000:147F 07             POP    ES               ; ES <- CS
0000:1480 BF2D01         MOV    DI,012D          ; z hlav¡ za©¡zen¡
0000:1483 AA             STOSB                   ; 00h: d‚lka z hlav¡ = 16h
0000:1484 58             POP    AX               ; n vrat ‡¡sla disk. jednotky
0000:1485 AA             STOSB                   ; 01h: ‡¡slo vnit©n¡ disk.jedn.
0000:1486 50             PUSH   AX               ; £schova ‡¡sla disk. jednotky
0000:1487 8AC1           MOV    AL,CL            ; k¢d povelu
0000:1489 AA             STOSB                   ; 02h: nastaven¡ k¢du povelu
0000:148A 33C0           XOR    AX,AX            ; stavov‚ slovo za©¡zen¡
0000:148C AB             STOSW                   ; 03h: stavov‚ slovo za©¡zen¡
0000:148D 83C708         ADD    DI,+08           ; rezervov no
0000:1490 58             POP    AX               ; n vrat k¢du povelu a popisov.
0000:1491 86E0           XCHG   AH,AL            ; AL <- popisova‡ m‚dia
0000:1493 AA             STOSB                   ; 0dh: popisova‡ m‚dia
0000:1494 86C4           XCHG   AL,AH            ; n vrat AX
0000:1496 50             PUSH   AX               ; £schova AX
0000:1497 8BC3           MOV    AX,BX            ; offset adresy bufferu
0000:1499 AB             STOSW                   ; 0eh: offset adresy bufferu
0000:149A 8CD8           MOV    AX,DS            ; segment adresy bufferu
0000:149C AB             STOSW                   ; 10h: segment adresy bufferu
0000:149D 59             POP    CX               ; n vrat ‡¡sla jednotky
0000:149E 58             POP    AX               ; n vrat po‡tu sektor–
0000:149F AB             STOSW                   ; 12h: po‡et sektor–
0000:14A0 92             XCHG   AX,DX            ; AX <- ‡¡slo po‡ te‡. sektoru
0000:14A1 AB             STOSW                   ; 14h: po‡ te‡n¡ sektor
0000:14A2 91             XCHG   AX,CX            ; n vrat AX
0000:14A3 87D1           XCHG   DX,CX            ; n vrat CX a DX
0000:14A5 5F             POP    DI               ; n vrat DI
0000:14A6 BB2D01         MOV    BX,012D          ; ES:BX=adresa z hlav¡ za©¡zen¡
0000:14A9 C3             RET
; -----------------------------------------------------------------------------
;         Sestaven¡ z hlav¡ za©¡zen¡ pro z pis/z pis s verifikac¡
; -----------------------------------------------------------------------------
                                               ;* VSTUP: AL=‡¡slo vnit©n¡ jedn.
                                                 ;       AH=popisova‡ m‚dia
                                                 ;       CX=po‡et sektor–
                                                 ;       DX=po‡ te‡n¡ sektor
                                                 ;       DS:BX=adresa bufferu
                                               ;* VSTUP: ES:BX=adresa z hlav¡

0000:14AA 57             PUSH   DI               ; £schova DI
0000:14AB 51             PUSH   CX               ; £schova po‡tu sektor– CX
0000:14AC 50             PUSH   AX               ; £schova ‡¡sla disk. jednotky
0000:14AD B108           MOV    CL,08            ; povel - z pis na za©¡zen¡
0000:14AF 36020EDB00     ADD    CL,SS:[00DB]     ; p©i‡ten¡ p©ep¡na‡e VERIFY
0000:14B4 EBC6           JMP    147C             ; proveden¡ operace
; -----------------------------------------------------------------------------

0000:14B6 A15F04         MOV    AX,[045F]
0000:14B9 3DFFFF         CMP    AX,FFFF
0000:14BC 7576           JNZ    1534
0000:14BE 833E4D0400     CMP    Word Ptr [044D],+00 ; aktu l. aloka‡n¡ blok
0000:14C3 7502           JNZ    14C7
0000:14C5 F9             STC
0000:14C6 C3             RET

0000:14C7 8B1E4D04     * MOV    BX,[044D]        ; aktu l. aloka‡n¡ blok
0000:14CB 0BDB           OR     BX,BX            ; je to z kladn¡ adres © ?
0000:14CD 7403           JZ     14D2             ; je to z kladn¡ adres ©
0000:14CF E88411         CALL   2656             ; nalezen¡ posled.bloku adres.
0000:14D2 B90100       * MOV    CX,0001
0000:14D5 E8CC10         CALL   25A4
0000:14D8 72EC           JB     14C6
0000:14DA 8B164D04       MOV    DX,[044D]        ; aktu l. aloka‡n¡ blok
0000:14DE 0BD2           OR     DX,DX            ; je to z kladn¡ adres © ?
0000:14E0 750B           JNZ    14ED             ; nen¡ to z kladn¡ adres ©
0000:14E2 E8F001         CALL   16D5             ; inicializace parametr– bloku
0000:14E5 C7062101FFFF   MOV    Word Ptr [0121],FFFF ; po‡ te‡n¡ sektor ROOT
0000:14EB EB13           JMP    1500

0000:14ED 813E4904F80F * CMP    Word Ptr [0449],0FF8 ; je povolen‚ ‡¡slo bloku ?
0000:14F3 7204           JB     14F9             ; je povolen‚ ‡¡slo bloku
0000:14F5 891E4904       MOV    [0449],BX        ; omezen¡ na nalezen˜ blok
0000:14F9 8BD3         * MOV    DX,BX            ; ‡¡slo aloka‡n¡ho bloku
0000:14FB 32DB           XOR    BL,BL            ; sektor v bloku = 0
0000:14FD E87310         CALL   2573             ; zji¨tˆn¡ datov‚ho sektoru

0000:1500 268A4E04     * MOV    CL,ES:[BP+04]    ; posledn¡ sektor v bloku
0000:1504 FEC1           INC    CL               ; po‡et sektor– na blok
0000:1506 32ED           XOR    CH,CH            ; po‡et sektor– na blok

                                               ;* vytvo©en¡ nov‚ho bloku adres.
0000:1508 51           * PUSH   CX               ; CX = po‡et sektor– na blok
0000:1509 B0FF           MOV    AL,FF            ; p©¡znak-sektor se ne‡te
0000:150B E82B12         CALL   2739             ; z¡sk n¡ sektoru DX
0000:150E 268B4E02       MOV    CX,ES:[BP+02]    ; po‡et bajt– na sektor
0000:1512 06             PUSH   ES
0000:1513 C43E6904       LES    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:1517 57             PUSH   DI               ; £schova za‡ tku bufferu
0000:1518 83C710         ADD    DI,+10           ; adresa dat bufferu
0000:151B 33C0           XOR    AX,AX            ; nulovac¡ slovo
0000:151D D1E9           SHR    CX,1             ; po‡et slov na sektor
0000:151F F3             REPZ
0000:1520 AB             STOSW                   ; vynulov n¡ sektoru
0000:1521 7301           JNB    1524             ; byl sud˜ po‡et bajt–
0000:1523 AA             STOSB                   ; vynulov n¡ lich‚ho bajtu
0000:1524 5F           * POP    DI               ; n vrat za‡ tku bufferu
0000:1525 FEC0           INC    AL               ; AL <- 1
0000:1527 26884505       MOV    ES:[DI+05],AL    ; p©¡znak modifikace bufferu
0000:152B 07             POP    ES               ; segment tab. parametr– DOS
0000:152C 59             POP    CX               ; po‡et sektor– na blok
0000:152D 42             INC    DX               ; zv˜¨en¡ ‡¡sla sektoru
0000:152E E2D8           LOOP   1508             ; dal¨¡ sektor
0000:1530 A12101         MOV    AX,[0121]        ; po‡ te‡n¡ sektor ROOT
0000:1533 40             INC    AX               ; po‡ te‡n¡ sektor
0000:1534 F8             CLC
0000:1535 C3             RET
; -----------------------------------------------------------------------------
;         Inicializace polo‘ky nov‚ho adres ©e
; -----------------------------------------------------------------------------
                                                 ; inic. nov‚ polo‘ky adres ©e
0000:1536 B90400         MOV    CX,0004          ; po‡et dvojslov - 1
0000:1539 B82020         MOV    AX,2020          ; 2 mezery
0000:153C F3             REPZ
0000:153D AB             STOSW                   ; inicializace jm‚na souboru
0000:153E AA             STOSB                   ; posledn¡ mezera
0000:153F 8B363B04       MOV    SI,[043B]        ; adresa FCB adres ©e
0000:1543 B010           MOV    AL,10            ; atribut - adres ©
0000:1545 AA             STOSB                   ; ulo‘en¡ atributu
0000:1546 83C70A         ADD    DI,+0A           ; rezervovan‚ bajty
0000:1549 8B4416         MOV    AX,[SI+16]       ; ‡as
0000:154C AB             STOSW                   ; nastaven¡ ‡asu
0000:154D 8B4414         MOV    AX,[SI+14]       ; datum
0000:1550 AB             STOSW                   ; nastaven¡ data
0000:1551 8BC2           MOV    AX,DX            ; po‡ te‡n¡ aloka‡n¡ blok adr.
0000:1553 AB             STOSW                   ; nastaven¡ po‡ t. alok. bloku
0000:1554 33C0           XOR    AX,AX            ; AX <- 0
0000:1556 AB             STOSW                   ; velikost = 0
0000:1557 AB             STOSW
0000:1558 C3           * RET
; -----------------------------------------------------------------------------
;         Poskytnut¡ velikosti souboru FCB
; -----------------------------------------------------------------------------
0000:1559 E87C1A         CALL   2FD8             ; nalezen¡ souboru FCB
0000:155C 72FA           JB     1558             ; chyba - soubor nenalezen
0000:155E 52             PUSH   DX
0000:155F 1E             PUSH   DS
0000:1560 E80800         CALL   156B
0000:1563 07             POP    ES
0000:1564 5F             POP    DI
0000:1565 C3           * RET
; -----------------------------------------------------------------------------

0000:1566 E86F1A         CALL   2FD8             ; nalezen¡ souboru FCB
0000:1569 72FA           JB     1565             ; chyba - soubor nenalezen
                                               ;* aktualizace FCB souboru
0000:156B 16             PUSH   SS
0000:156C 1F             POP    DS               ; DS <- CS
0000:156D E89FFE         CALL   140F             ; nalezen¡ z hlav¡ znak. za©¡z.
0000:1570 7204           JB     1576             ; nen¡ to znakov‚ za©¡zen¡
0000:1572 E83B1A         CALL   2FB0             ; vytvo©en¡ nov‚ho FCB soub.
0000:1575 C3             RET
; -----------------------------------------------------------------------------

0000:1576 E8DF03       * CALL   1958
0000:1579 803EFB0308     CMP    Byte Ptr [03FB],08
0000:157E 7503           JNZ    1583
0000:1580 E82A01         CALL   16AD
0000:1583 E88E00         CALL   1614
0000:1586 1E             PUSH   DS
0000:1587 8E1E6B04       MOV    DS,[046B]
0000:158B 8A27           MOV    AH,[BX]
0000:158D 0AE4           OR     AH,AH
0000:158F 7433           JZ     15C4
0000:1591 363A261904     CMP    AH,SS:[0419]
0000:1596 742C           JZ     15C4
0000:1598 F6470B08       TEST   Byte Ptr [BX+0B],08
0000:159C 7405           JZ     15A3
0000:159E 36FE066D04     INC    Byte Ptr SS:[046D]
0000:15A3 8BF3           MOV    SI,BX
0000:15A5 16             PUSH   SS
0000:15A6 07             POP    ES
0000:15A7 BFEF03         MOV    DI,03EF
0000:15AA B90B00         MOV    CX,000B          ; max. d‚lka jm‚na
0000:15AD F3           * REPZ
0000:15AE A6             CMPSB                   ; nalezen¡
0000:15AF 742F           JZ     15E0
0000:15B1 26807DFF3F     CMP    Byte Ptr ES:[DI-01],3F        ;'?'
0000:15B6 74F5           JZ     15AD
0000:15B8 1F             POP    DS
0000:15B9 C42E2604       LES    BP,[0426]        ; adresa z hlav¡ za©¡zen¡
0000:15BD E88200         CALL   1642
0000:15C0 73C4           JNB    1586
0000:15C2 EB4D           JMP    1611
0000:15C4 1F             POP    DS
0000:15C5 8B0E2101       MOV    CX,[0121]        ; po‡ te‡n¡ sektor ROOT
0000:15C9 3B0E5F04       CMP    CX,[045F]
0000:15CD 7304           JNB    15D3
0000:15CF 890E5F04       MOV    [045F],CX
0000:15D3 3A261904       CMP    AH,[0419]
0000:15D7 74E0           JZ     15B9
0000:15D9 890E6104       MOV    [0461],CX
0000:15DD F9             STC
0000:15DE EB31           JMP    1611
0000:15E0 8A2C           MOV    CH,[SI]
0000:15E2 1F             POP    DS
0000:15E3 8A26FB03       MOV    AH,[03FB]
0000:15E7 F6C508         TEST   CH,08
0000:15EA 7409           JZ     15F5
0000:15EC F6C408         TEST   AH,08
0000:15EF 74C8           JZ     15B9
0000:15F1 32E4           XOR    AH,AH
0000:15F3 EB14           JMP    1609
0000:15F5 80FC08         CMP    AH,08
0000:15F8 74BF           JZ     15B9
0000:15FA 83C60F         ADD    SI,+0F
0000:15FD E86C03         CALL   196C
0000:1600 7407           JZ     1609
0000:1602 F6061804FF     TEST   Byte Ptr [0418],FF
0000:1607 74B0           JZ     15B9
0000:1609 C42E2604       LES    BP,[0426]        ; adresa z hlav¡ za©¡zen¡
0000:160D 268A6600       MOV    AH,ES:[BP+00]
0000:1611 16             PUSH   SS
0000:1612 07             POP    ES
0000:1613 C3             RET

0000:1614 A12101         MOV    AX,[0121]        ; po‡ te‡n¡ sektor ROOT

0000:1617 A32101         MOV    [0121],AX        ; po‡ te‡n¡ sektor adres ©e
0000:161A B104           MOV    CL,04
0000:161C D3E0           SHL    AX,CL            ; po‡ te‡n¡ sektor * 16
0000:161E 33D2           XOR    DX,DX            ; DX <- 0
0000:1620 D1E0           SHL    AX,1             ; p©enos nejvy¨¨¡ho bitu AX
0000:1622 D1D2           RCL    DX,1
0000:1624 268B5E02       MOV    BX,ES:[BP+02]    ; po‡et bajt– na sektor
0000:1628 80E3E0         AND    BL,E0            ; zaokrouhlen¡ na 32 bajt–
0000:162B F7F3           DIV    BX               ; v˜po‡et po‡tu polo‘ek adres.
0000:162D 8BDA           MOV    BX,DX            ;
0000:162F 53             PUSH   BX
0000:1630 E87806         CALL   1CAB
0000:1633 5B             POP    BX
0000:1634 8B166904       MOV    DX,[0469]        ; ukazatel posledn¡ho bufferu
0000:1638 83C210         ADD    DX,+10           ;
0000:163B 03DA           ADD    BX,DX
0000:163D 26035602       ADD    DX,ES:[BP+02]    ; po‡et bajt– na sektor
0000:1641 C3             RET

0000:1642 A12101         MOV    AX,[0121]        ; po‡ te‡n¡ sektor ROOT
0000:1645 3B066104       CMP    AX,[0461]
0000:1649 7425           JZ     1670
0000:164B 40             INC    AX
0000:164C 83C320         ADD    BX,+20
0000:164F 3BDA           CMP    BX,DX
0000:1651 721F           JB     1672
0000:1653 8A1E2104       MOV    BL,[0421]
0000:1657 FEC3           INC    BL
0000:1659 3A1E2A04       CMP    BL,[042A]        ; po‡et sektor– na blok
0000:165D 7218           JB     1677
0000:165F 8B1E6304       MOV    BX,[0463]        ; blok
0000:1663 81FBF80F       CMP    BX,0FF8          ; povolen‚ ‡¡slo bloku ?
0000:1667 7307           JNB    1670
0000:1669 83FB02         CMP    BX,+02           ; je to z kadn¡ adres © ?
0000:166C 7202           JB     1670             ; je to z kladn¡ adres ©
0000:166E EBA7           JMP    1617
0000:1670 F9           * STC
0000:1671 C3             RET

0000:1672 A32101         MOV    [0121],AX        ; po‡ te‡n¡ sektor ROOT
0000:1675 F8             CLC
0000:1676 C3             RET

0000:1677 881E2104       MOV    [0421],BL
0000:167B A32101         MOV    [0121],AX        ; po‡ te‡n¡ sektor ROOT
0000:167E 1E             PUSH   DS
0000:167F C53E6904       LDS    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:1683 8B5508         MOV    DX,[DI+08]
0000:1686 42             INC    DX
0000:1687 1F             POP    DS
0000:1688 E85906         CALL   1CE4
0000:168B 33DB           XOR    BX,BX
0000:168D EBA5           JMP    1634

; -----------------------------------------------------------------------------
;         Aktualizace aktu ln¡ho adres ©e
; -----------------------------------------------------------------------------

0000:168F 268B5E1C       MOV    BX,ES:[BP+1C]    ; po‡ te‡n¡ blok adres ©e
0000:1693 0BDB           OR     BX,BX            ; je z kladn¡ adres © ?
0000:1695 7416           JZ     16AD             ; je z kladn¡ adres ©
0000:1697 81FBF80F       CMP    BX,0FF8          ; je povolen‚ ‡¡slo bloku ?
0000:169B 7238           JB     16D5             ; inicializace parametr– bloku
0000:169D 06             PUSH   ES
0000:169E 1F             POP    DS               ; DS <- ES tabulka parametr–
0000:169F 8D761E         LEA    SI,[BP+1E]       ; aktivn¡ adres ©
0000:16A2 E8F201         CALL   1897             ; pokus o nastaven¡ adres ©e
0000:16A5 7326           JNB    16CD             ; adres © nalezen OK
0000:16A7 26C7461C0000   MOV    Word Ptr ES:[BP+1C],0000 ; po‡ te‡n¡ blok = ROOT


                                               ;* nastaven¡ parametr– pro ROOT
0000:16AD 16           * PUSH   SS
0000:16AE 1F             POP    DS
0000:16AF 33C0           XOR    AX,AX            ; AX <- 0
0000:16B1 A34D04         MOV    [044D],AX        ; aktu l. aloka‡n¡ blok
0000:16B4 A22104         MOV    [0421],AL        ;
0000:16B7 48             DEC    AX
0000:16B8 A34904         MOV    [0449],AX
0000:16BB 268B460B       MOV    AX,ES:[BP+0B]    ; po‡ te‡n¡ dat. sektor
0000:16BF 268B5610       MOV    DX,ES:[BP+10]    ; po‡ te‡n¡ sektor ROOT
0000:16C3 2BC2           SUB    AX,DX            ; po‡et sektor– ROOT
0000:16C5 A22A04         MOV    [042A],AL        ; po‡et sektor– na blok
0000:16C8 89164B04       MOV    [044B],DX        ; po‡ te‡n¡ sektor adres ©e
0000:16CC C3             RET

                                               ;* nastaven¡ ukazatele na adres ©
0000:16CD A14D04         MOV    AX,[044D]        ; aktu l. aloka‡n¡ blok
0000:16D0 2689461C       MOV    ES:[BP+1C],AX    ; po‡ te‡n¡ blok adres ©e
0000:16D4 C3             RET


                                               ;* inicializace parametr– bloku
0000:16D5 0BDB           OR     BX,BX            ; je aloka‡n¡ blok ROOT ?
0000:16D7 74D4           JZ     16AD             ; je ROOT
0000:16D9 16             PUSH   SS
0000:16DA 1F             POP    DS               ; DS <- CS
0000:16DB 891E4D04       MOV    [044D],BX        ; aktu l. aloka‡n¡ blok
0000:16DF 268A4604       MOV    AL,ES:[BP+04]    ; posledn¡ sektor v bloku
0000:16E3 FEC0           INC    AL               ; po‡et sektor– na blok
0000:16E5 A22A04         MOV    [042A],AL        ; po‡et sektor– na blok
0000:16E8 E8F60A         CALL   21E1             ; ‡ten¡ ukaz. alok. bloku z FAT
0000:16EB 893E4904       MOV    [0449],DI        ; ukazatel alok. bloku ve FAT
0000:16EF 8BD3           MOV    DX,BX            ; po‘adovan˜ aloka‡n¡ blok
0000:16F1 32DB           XOR    BL,BL            ; BL <- sektor v bloku
0000:16F3 881E2104       MOV    [0421],BL        ; sektor v alok. bloku
0000:16F7 E8790E         CALL   2573             ; zji¨tˆn¡ datov‚ho sektoru
0000:16FA 89164B04       MOV    [044B],DX        ; po‡ te‡n¡ sektor adres ©e
0000:16FE C3             RET
; -----------------------------------------------------------------------------
;         Nastaven¡ cesty k adres ©i
; -----------------------------------------------------------------------------
0000:16FF 50             PUSH   AX
0000:1700 E89E00         CALL   17A1
0000:1703 8AD1           MOV    DL,CL
0000:1705 59             POP    CX
0000:1706 36880EFB03     MOV    SS:[03FB],CL
0000:170B 8BC8           MOV    CX,AX
0000:170D 730F           JNB    171E
0000:170F 7504           JNZ    1715
0000:1711 0AD2           OR     DL,DL
0000:1713 7504           JNZ    1719
0000:1715 B004           MOV    AL,04            ; chyba-otev©eno mnoho soubor–
0000:1717 F9             STC
0000:1718 C3             RET

0000:1719 32C0           XOR    AL,AL
0000:171B F9             STC
0000:171C EB3A           JMP    1758

0000:171E 742C           JZ     174C

0000:1720 B003           MOV    AL,03
0000:1722 36F606FB0318   TEST   Byte Ptr SS:[03FB],18
0000:1728 7518           JNZ    1742
0000:172A 0AED           OR     CH,CH
0000:172C 7818           JS     1746
0000:172E 51             PUSH   CX
0000:172F 368E1E6B04     MOV    DS,SS:[046B]
0000:1734 8A6F0B         MOV    CH,[BX+0B]
0000:1737 F6C501         TEST   CH,01
0000:173A 7503           JNZ    173F
0000:173C E82D02         CALL   196C
0000:173F 59             POP    CX
0000:1740 7404           JZ     1746
0000:1742 B005           MOV    AL,05
0000:1744 EBD1           JMP    1717
0000:1746 32C0           XOR    AL,AL
0000:1748 B003           MOV    AL,03
0000:174A EB0C           JMP    1758
0000:174C B001           MOV    AL,01
0000:174E 36F606FB0310   TEST   Byte Ptr SS:[03FB],10
0000:1754 74C1           JZ     1717
0000:1756 F8             CLC
0000:1757 C3             RET

0000:1758 50             PUSH   AX
0000:1759 16             PUSH   SS
0000:175A 1F             POP    DS
0000:175B 9C             PUSHF
0000:175C 803EEF032E     CMP    Byte Ptr [03EF],2E            ;'.'
0000:1761 7505           JNZ    1768
0000:1763 9D             POPF
0000:1764 B001           MOV    AL,01
0000:1766 EB10           JMP    1778
0000:1768 9D             POPF
0000:1769 06             PUSH   ES
0000:176A C43E3B04       LES    DI,[043B]
0000:176E 1E             PUSH   DS
0000:176F 57             PUSH   DI
0000:1770 06             PUSH   ES
0000:1771 8BC1           MOV    AX,CX
0000:1773 E8F313         CALL   2B69
0000:1776 1F             POP    DS
0000:1777 07             POP    ES
0000:1778 0AC0           OR     AL,AL
0000:177A 58             POP    AX
0000:177B 7404           JZ     1781
0000:177D B002           MOV    AL,02
0000:177F F9             STC
0000:1780 C3             RET

0000:1781 06             PUSH   ES
0000:1782 C43E3B04       LES    DI,[043B]
0000:1786 47             INC    DI
0000:1787 1E             PUSH   DS
0000:1788 56             PUSH   SI
0000:1789 8E1E6B04       MOV    DS,[046B]
0000:178D 8BF3           MOV    SI,BX
0000:178F B90B00         MOV    CX,000B
0000:1792 F3             REPZ
0000:1793 A4             MOVSB
0000:1794 5E             POP    SI
0000:1795 1F             POP    DS
0000:1796 07             POP    ES
0000:1797 3C01           CMP    AL,01
0000:1799 7704           JA     179F
0000:179B 0AC0           OR     AL,AL
0000:179D F8             CLC
0000:179E C3             RET

0000:179F F9             STC
0000:17A0 C3             RET
; -----------------------------------------------------------------------------
;         Nastaven¡ adres ©e
; -----------------------------------------------------------------------------
0000:17A1 33C0           XOR    AX,AX
0000:17A3 36A32B04       MOV    SS:[042B],AX     ; zadan˜ disk adres ©e
0000:17A7 36C606FB0316   MOV    Byte Ptr SS:[03FB],16 ; atributy hledan‚ polo‘ky
0000:17AD AC             LODSB                   ; na‡ten¡ znaku
0000:17AE E8F018         CALL   30A1             ; test odˆlova‡e param., cesty
0000:17B1 7443           JZ     17F6             ; je oddˆlova‡
0000:17B3 8AE0           MOV    AH,AL            ; £schova prvn¡ho znaku
0000:17B5 AC             LODSB                   ; druh˜ znak
0000:17B6 3C3A           CMP    AL,3A            ; je oddˆlova‡ disku ":" ?
0000:17B8 7465           JZ     181F             ; je zad n disk
0000:17BA 4E             DEC    SI
0000:17BB 4E             DEC    SI               ; n vrat za‡ tku specifikace

0000:17BC 1E             PUSH   DS
0000:17BD 56             PUSH   SI
0000:17BE 16             PUSH   SS
0000:17BF 07             POP    ES               ; ES <- CS
0000:17C0 36803EE60000   CMP    Byte Ptr SS:[00E6],00 ;
0000:17C6 7405           JZ     17CD
0000:17C8 E8A400         CALL   186F
0000:17CB 7348           JNB    1815
0000:17CD E81800       * CALL   17E8
0000:17D0 36A0D500       MOV    AL,SS:[00D5]
0000:17D4 50             PUSH   AX
0000:17D5 36C606D50000   MOV    Byte Ptr SS:[00D5],00
0000:17DB E8B1FE         CALL   168F             ; aktualizace aktu l. adres ©e
0000:17DE 58             POP    AX
0000:17DF 36A2D500       MOV    SS:[00D5],AL
0000:17E3 5E             POP    SI
0000:17E4 1F             POP    DS
0000:17E5 E9B400         JMP    189C
0000:17E8 32C0           XOR    AL,AL
0000:17EA E8AA04         CALL   1C97             ; nastav. pracovn¡ho log. disku
0000:17ED 72B1           JB     17A0
0000:17EF 16             PUSH   SS
0000:17F0 1F             POP    DS
0000:17F1 E8EF0A         CALL   22E3             ; poskytnut¡ tabulky disku
0000:17F4 F8             CLC
0000:17F5 C3             RET

0000:17F6 1E           * PUSH   DS
0000:17F7 56             PUSH   SI
0000:17F8 E8EDFF         CALL   17E8
0000:17FB 5E             POP    SI
0000:17FC 1F             POP    DS
0000:17FD 36FE062C04     INC    Byte Ptr SS:[042C]
0000:1802 803C00         CMP    Byte Ptr [SI],00
0000:1805 7440           JZ     1847
0000:1807 1E             PUSH   DS
0000:1808 56             PUSH   SI
0000:1809 06             PUSH   ES
0000:180A E84000         CALL   184D
0000:180D 07             POP    ES
0000:180E 7305           JNB    1815
0000:1810 5E             POP    SI
0000:1811 1F             POP    DS
0000:1812 E98200         JMP    1897             ; pokus o nastaven¡ adres ©e
0000:1815 58             POP    AX
0000:1816 58             POP    AX
0000:1817 16             PUSH   SS
0000:1818 07             POP    ES
0000:1819 E89417         CALL   2FB0             ; vytvo©en¡ nov‚ho FCB soub.
0000:181C FEC0           INC    AL
0000:181E C3             RET

                                               ;* je zad n disk
0000:181F 36FE062B04   * INC    Byte Ptr SS:[042B] ; zadan˜ disk adres ©e
0000:1824 8AC4           MOV    AL,AH
0000:1826 0C20           OR     AL,20            ; p©evod na velk‚ p¡smeno
0000:1828 2C60           SUB    AL,60            ; p©evod na ‡¡slo disku
0000:182A 1E             PUSH   DS
0000:182B 56             PUSH   SI
0000:182C 50             PUSH   AX
0000:182D 16             PUSH   SS
0000:182E 07             POP    ES
0000:182F E83D00         CALL   186F
0000:1832 58             POP    AX
0000:1833 73E0           JNB    1815
0000:1835 E8B2FF         CALL   17EA
0000:1838 5E             POP    SI
0000:1839 1F             POP    DS
0000:183A 72E2           JB     181E
0000:183C AC             LODSB
0000:183D E86118         CALL   30A1             ; test odˆlova‡e param., cesty
0000:1840 74BB           JZ     17FD
0000:1842 4E             DEC    SI
0000:1843 1E             PUSH   DS
0000:1844 56             PUSH   SI
0000:1845 EB89           JMP    17D0
0000:1847 E863FE         CALL   16AD
0000:184A 32C0           XOR    AL,AL
0000:184C C3             RET

0000:184D 16             PUSH   SS
0000:184E 07             POP    ES
0000:184F BF0400         MOV    DI,0004
0000:1852 33C9           XOR    CX,CX
0000:1854 368A0E0300     MOV    CL,SS:[0003]     ; d‚lka
0000:1859 F3           * REPZ
0000:185A A6             CMPSB
0000:185B 740C           JZ     1869
0000:185D 4E             DEC    SI
0000:185E E8EB17         CALL   304C             ; ‡ten¡ znaku
0000:1861 263A45FF       CMP    AL,ES:[DI-01]
0000:1865 74F2           JZ     1859
0000:1867 F9           * STC
0000:1868 C3             RET

0000:1869 AC             LODSB                   ; na‡ten¡ prvn¡ho znaku
0000:186A E83418         CALL   30A1             ; test odˆlova‡e param., cesty
0000:186D 75F8           JNZ    1867             ; nen¡ oddˆlova‡ - chyba

0000:186F BFEF03         MOV    DI,03EF          ; jm‚no souboru
0000:1872 B90900         MOV    CX,0009          ; max. po‡et znak– jm‚na
0000:1875 E8D417       * CALL   304C             ; ‡ten¡ znaku ze specifikace
0000:1878 3C2E           CMP    AL,2E            ; je te‡ka ?
0000:187A 740E           JZ     188A             ; je oddˆlovac¡ te‡ka
0000:187C E82218         CALL   30A1             ; test odˆlova‡e param., cesty
0000:187F 7407           JZ     1888             ; je oddˆlova‡ - chyba
0000:1881 0AC0           OR     AL,AL            ; je konec jm‚na ?
0000:1883 7405           JZ     188A             ; konec jm‚na
0000:1885 AA             STOSB                   ; ulo‘en¡ znaku
0000:1886 E2ED           LOOP   1875             ; ‡ten¡ dal¨¡ho znaku
0000:1888 F9           * STC                     ; chyba - jm‚no dlouh‚
0000:1889 C3             RET
                                               ;* je te‡ka - vymaz n¡ p©¡pony
0000:188A 83C102       * ADD    CX,+02           ;
0000:188D B020           MOV    AL,20            ; mazac¡ mezera
0000:188F F3             REPZ
0000:1890 AA             STOSB                   ; vymazan¡ zbytku jm‚na
0000:1891 16             PUSH   SS
0000:1892 1F             POP    DS
0000:1893 E879FB         CALL   140F             ; nalezen¡ z hlav¡ znak. za©¡z.
0000:1896 C3             RET

                                               ;* pokus o nastaven¡ adres ©e
0000:1897 1E             PUSH   DS
0000:1898 E812FE         CALL   16AD
0000:189B 1F             POP    DS
0000:189C 06             PUSH   ES
0000:189D 56             PUSH   SI
0000:189E E8D116         CALL   2F72
0000:18A1 8AC8           MOV    CL,AL
0000:18A3 80C980         OR     CL,80
0000:18A6 5F             POP    DI
0000:18A7 07             POP    ES
0000:18A8 3BF7           CMP    SI,DI
0000:18AA 7503           JNZ    18AF
0000:18AC E98A00         JMP    1939
0000:18AF 1E             PUSH   DS
0000:18B0 56             PUSH   SI
0000:18B1 8A04           MOV    AL,[SI]
0000:18B3 16             PUSH   SS
0000:18B4 1F             POP    DS
0000:18B5 803EE60000     CMP    Byte Ptr [00E6],00
0000:18BA 7417           JZ     18D3
0000:18BC 06             PUSH   ES
0000:18BD 16             PUSH   SS
0000:18BE 07             POP    ES
0000:18BF E84DFB         CALL   140F             ; nalezen¡ z hlav¡ znak. za©¡z.
0000:18C2 07             POP    ES
0000:18C3 720E           JB     18D3
0000:18C5 0AC0           OR     AL,AL
0000:18C7 7574           JNZ    193D
0000:18C9 5E             POP    SI
0000:18CA 5E             POP    SI
0000:18CB 16             PUSH   SS
0000:18CC 07             POP    ES
0000:18CD E8E016         CALL   2FB0             ; vytvo©en¡ nov‚ho FCB soub.
0000:18D0 FEC0           INC    AL
0000:18D2 C3             RET

0000:18D3 57             PUSH   DI
0000:18D4 06             PUSH   ES
0000:18D5 51             PUSH   CX
0000:18D6 E89DFC         CALL   1576
0000:18D9 59             POP    CX
0000:18DA 07             POP    ES
0000:18DB 5F             POP    DI
0000:18DC 7270           JB     194E
0000:18DE C53E6904       LDS    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:18E2 F6470B10       TEST   Byte Ptr [BX+0B],10
0000:18E6 7455           JZ     193D
0000:18E8 36803ED50000   CMP    Byte Ptr SS:[00D5],00
0000:18EE 7411           JZ     1901
0000:18F0 8BD7           MOV    DX,DI
0000:18F2 8CD8           MOV    AX,DS
0000:18F4 5F             POP    DI
0000:18F5 1F             POP    DS
0000:18F6 803D00         CMP    Byte Ptr [DI],00
0000:18F9 7450           JZ     194B
0000:18FB 1E             PUSH   DS
0000:18FC 57             PUSH   DI
0000:18FD 8BFA           MOV    DI,DX
0000:18FF 8ED8           MOV    DS,AX
0000:1901 8B14           MOV    DX,[SI]
0000:1903 2BDF           SUB    BX,DI
0000:1905 2BF7           SUB    SI,DI
0000:1907 53             PUSH   BX
0000:1908 50             PUSH   AX
0000:1909 56             PUSH   SI
0000:190A 51             PUSH   CX
0000:190B FF7508         PUSH   [DI+08]
0000:190E 8BDA           MOV    BX,DX
0000:1910 E8C2FD         CALL   16D5             ; inicializace parametr– bloku
0000:1913 5A             POP    DX               ; ‡¡slo sektoru
0000:1914 32C0           XOR    AL,AL            ; p©¡znak ‡ten¡ sektoru
0000:1916 E8200E         CALL   2739             ; z¡sk n¡ sektoru DX
0000:1919 59             POP    CX
0000:191A 5E             POP    SI
0000:191B 58             POP    AX
0000:191C 5B             POP    BX
0000:191D 8B3E6904       MOV    DI,[0469]        ; ukazatel posledn¡ho bufferu
0000:1921 03F7           ADD    SI,DI
0000:1923 03DF           ADD    BX,DI
0000:1925 5F             POP    DI
0000:1926 1F             POP    DS
0000:1927 8A05           MOV    AL,[DI]
0000:1929 0AC0           OR     AL,AL
0000:192B 741E           JZ     194B
0000:192D 47             INC    DI
0000:192E 8BF7           MOV    SI,DI
0000:1930 E86E17         CALL   30A1             ; test odˆlova‡e param., cesty
0000:1933 7503           JNZ    1938
0000:1935 E964FF         JMP    189C
0000:1938 4E             DEC    SI
0000:1939 32C9           XOR    CL,CL
0000:193B F9             STC
0000:193C C3             RET

0000:193D 5F             POP    DI
0000:193E 1F             POP    DS
0000:193F 8A05           MOV    AL,[DI]
0000:1941 0AC0           OR     AL,AL
0000:1943 7404           JZ     1949
0000:1945 8BF7           MOV    SI,DI
0000:1947 F9             STC
0000:1948 C3             RET

0000:1949 FEC0           INC    AL
0000:194B 16             PUSH   SS
0000:194C 1F             POP    DS
0000:194D C3             RET

0000:194E 5E             POP    SI
0000:194F 1F             POP    DS
0000:1950 8A04           MOV    AL,[SI]
0000:1952 8BF7           MOV    SI,DI
0000:1954 0AC0           OR     AL,AL
0000:1956 F9             STC
0000:1957 C3             RET

0000:1958 C42E2604       LES    BP,[0426]        ; adresa z hlav¡ za©¡zen¡
0000:195C 33C0           XOR    AX,AX            ; AX <- 0
0000:195E A32101         MOV    [0121],AX        ; po‡ te‡n¡ sektor ROOT
0000:1961 A26D04         MOV    [046D],AL        ;
0000:1964 48             DEC    AX
0000:1965 A35F04         MOV    [045F],AX
0000:1968 A36104         MOV    [0461],AX
0000:196B C3             RET

0000:196C 50             PUSH   AX
0000:196D 36A0FB03       MOV    AL,SS:[03FB]
0000:1971 F6D0           NOT    AL
0000:1973 22C5           AND    AL,CH
0000:1975 2416           AND    AL,16
0000:1977 58             POP    AX
0000:1978 C3             RET

0000:1979 06             PUSH   ES
0000:197A 57             PUSH   DI
0000:197B 56             PUSH   SI
0000:197C 53             PUSH   BX
0000:197D BB0100         MOV    BX,0001          ; standardn¡ vstupn¡ za©¡zen¡
0000:1980 E8FC24         CALL   3E7F             ; nalezen¡ tabulky souboru
0000:1983 83C703         ADD    DI,+03           ; nastaven¡ jako FCB
0000:1986 8A1E7704       MOV    BL,[0477]
0000:198A C5367804       LDS    SI,[0478]        ; ukazatel na ovlada‡ za©¡zen¡
0000:198E 26897519       MOV    ES:[DI+19],SI    ; offset ukazatele driveru
0000:1992 268C5D1B       MOV    ES:[DI+1B],DS    ; segment ukazatele driveru
0000:1996 26885D18       MOV    ES:[DI+18],BL    ; atributy za©¡zen¡

0000:199A 16             PUSH   SS
0000:199B 1F             POP    DS               ; DS <- CS
0000:199C 33DB           XOR    BX,BX            ; standardn¡ v˜stupn¡ za©¡zen¡
0000:199E E8DE24         CALL   3E7F             ; nalezen¡ tabulky souboru
0000:19A1 83C703         ADD    DI,+03           ; nastaven¡ jako FCB
0000:19A4 8A1E7604       MOV    BL,[0476]
0000:19A8 C5367204       LDS    SI,[0472]
0000:19AC 26897519       MOV    ES:[DI+19],SI
0000:19B0 268C5D1B       MOV    ES:[DI+1B],DS
0000:19B4 26885D18       MOV    ES:[DI+18],BL
0000:19B8 16             PUSH   SS
0000:19B9 1F             POP    DS
0000:19BA C606260100     MOV    Byte Ptr [0126],00
0000:19BF C606270101     MOV    Byte Ptr [0127],01
0000:19C4 5B             POP    BX
0000:19C5 5E             POP    SI
0000:19C6 5F             POP    DI
0000:19C7 07             POP    ES
0000:19C8 C3             RET

0000:19C9 06             PUSH   ES
0000:19CA 57             PUSH   DI
0000:19CB 56             PUSH   SI
0000:19CC 53             PUSH   BX
0000:19CD C606260101     MOV    Byte Ptr [0126],01
0000:19D2 C606270100     MOV    Byte Ptr [0127],00
0000:19D7 33DB           XOR    BX,BX
0000:19D9 E8A324         CALL   3E7F             ; nalezen¡ tabulky souboru
0000:19DC 83C703         ADD    DI,+03
0000:19DF 268A5D18       MOV    BL,ES:[DI+18]
0000:19E3 881E7604       MOV    [0476],BL
0000:19E7 26C57519       LDS    SI,ES:[DI+19]
0000:19EB 3689367204     MOV    SS:[0472],SI
0000:19F0 368C1E7404     MOV    SS:[0474],DS
0000:19F5 36C5363B04     LDS    SI,SS:[043B]
0000:19FA 8A5C18         MOV    BL,[SI+18]
0000:19FD C57419         LDS    SI,[SI+19]
0000:1A00 26885D18       MOV    ES:[DI+18],BL
0000:1A04 26897519       MOV    ES:[DI+19],SI
0000:1A08 268C5D1B       MOV    ES:[DI+1B],DS
0000:1A0C 16             PUSH   SS
0000:1A0D 1F             POP    DS
0000:1A0E BB0100         MOV    BX,0001
0000:1A11 E86B24         CALL   3E7F             ; nalezen¡ tabulky souboru
0000:1A14 83C703         ADD    DI,+03
0000:1A17 268A5D18       MOV    BL,ES:[DI+18]
0000:1A1B 881E7704       MOV    [0477],BL
0000:1A1F 26C57519       LDS    SI,ES:[DI+19]
0000:1A23 3689367804     MOV    SS:[0478],SI     ; ukazatel na ovlada‡ za©¡zen¡
0000:1A28 368C1E7A04     MOV    SS:[047A],DS
0000:1A2D 36C5363B04     LDS    SI,SS:[043B]
0000:1A32 8A5C18         MOV    BL,[SI+18]
0000:1A35 C57419         LDS    SI,[SI+19]
0000:1A38 26885D18       MOV    ES:[DI+18],BL
0000:1A3C 26897519       MOV    ES:[DI+19],SI
0000:1A40 268C5D1B       MOV    ES:[DI+1B],DS
0000:1A44 16             PUSH   SS
0000:1A45 1F             POP    DS
0000:1A46 E97BFF         JMP    19C4
; -----------------------------------------------------------------------------
                                               ;* ‡ten¡ z znamu ze za©¡zen¡
0000:1A49 E82903         CALL   1D75
0000:1A4C 0ADB           OR     BL,BL
0000:1A4E 7804           JS     1A54
0000:1A50 E83E04         CALL   1E91
0000:1A53 C3             RET

0000:1A54 C43EDF00     * LES    DI,[00DF]        ; adresa diskov˜ch p©enos– DTA
0000:1A58 F6C340         TEST   BL,40                         ;'@'
0000:1A5B 7407           JZ     1A64
0000:1A5D F6C304         TEST   BL,04
0000:1A60 7439           JZ     1A9B
0000:1A62 32C0           XOR    AL,AL
0000:1A64 E9AA00         JMP    1B11
0000:1A67 06             PUSH   ES
0000:1A68 1F             POP    DS
0000:1A69 8BDF           MOV    BX,DI
0000:1A6B 33D2           XOR    DX,DX
0000:1A6D 33C0           XOR    AX,AX
0000:1A6F E805FA         CALL   1477             ; z hlav¡ za©¡zen¡ pro ‡ten¡
0000:1A72 36C5363B04     LDS    SI,SS:[043B]
0000:1A77 E874F9         CALL   13EE
0000:1A7A 8BD7           MOV    DX,DI
0000:1A7C B486           MOV    AH,86
0000:1A7E 368B3E3001     MOV    DI,SS:[0130]
0000:1A83 F7C70080       TEST   DI,8000
0000:1A87 7409           JZ     1A92
0000:1A89 E8E112         CALL   2D6D
0000:1A8C 8BFA           MOV    DI,DX
0000:1A8E 3C01           CMP    AL,01
0000:1A90 74D7           JZ     1A69
0000:1A92 8BFA           MOV    DI,DX
0000:1A94 36033E3F01     ADD    DI,SS:[013F]     ; adresa bloku param. BPB
0000:1A99 EB76           JMP    1B11
0000:1A9B F6C320         TEST   BL,20                         ;' '
0000:1A9E 75C7           JNZ    1A67
0000:1AA0 F6C301         TEST   BL,01
0000:1AA3 7403           JZ     1AA8
0000:1AA5 E99F00         JMP    1B47
0000:1AA8 8CC0           MOV    AX,ES
0000:1AAA 8ED8           MOV    DS,AX
0000:1AAC 8BDF           MOV    BX,DI
0000:1AAE 33D2           XOR    DX,DX
0000:1AB0 8BC2           MOV    AX,DX
0000:1AB2 51             PUSH   CX
0000:1AB3 B90100         MOV    CX,0001
0000:1AB6 E8BEF9         CALL   1477             ; z hlav¡ za©¡zen¡ pro ‡ten¡
0000:1AB9 59             POP    CX
0000:1ABA 36C5363B04     LDS    SI,SS:[043B]
0000:1ABF C57419         LDS    SI,[SI+19]
0000:1AC2 E82E11         CALL   2BF3
0000:1AC5 E829F9         CALL   13F1             ; vol n¡ obsluhy za©¡zen¡ DS:SI
0000:1AC8 57             PUSH   DI
0000:1AC9 B486           MOV    AH,86
0000:1ACB 368B3E3001     MOV    DI,SS:[0130]
0000:1AD0 F7C70080       TEST   DI,8000
0000:1AD4 7413           JZ     1AE9
0000:1AD6 E89412         CALL   2D6D
0000:1AD9 5F             POP    DI
0000:1ADA 36C7063F010100 MOV    Word Ptr SS:[013F],0001 ; adresa bloku param. BPB
0000:1AE1 3C01           CMP    AL,01
0000:1AE3 74DD           JZ     1AC2
0000:1AE5 32C0           XOR    AL,AL
0000:1AE7 EB12           JMP    1AFB
0000:1AE9 5F             POP    DI
0000:1AEA 36833E3F0101   CMP    Word Ptr SS:[013F],+01 ; adresa bloku param. BPB
0000:1AF0 751F           JNZ    1B11
0000:1AF2 1E             PUSH   DS
0000:1AF3 368E1E3D01     MOV    DS,SS:[013D]
0000:1AF8 8A05           MOV    AL,[DI]
0000:1AFA 1F             POP    DS
0000:1AFB 36FF063B01     INC    Word Ptr SS:[013B]
0000:1B00 36C70630010000 MOV    Word Ptr SS:[0130],0000
0000:1B07 47             INC    DI
0000:1B08 3C1A           CMP    AL,1A
0000:1B0A 7405           JZ     1B11
0000:1B0C 3C0D           CMP    AL,0D
0000:1B0E E0B2           LOOPNZ 1AC2
0000:1B10 40             INC    AX
0000:1B11 EB1F           JMP    1B32
0000:1B13 AC           * LODSB
0000:1B14 AA             STOSB
0000:1B15 3C0D           CMP    AL,0D
0000:1B17 7503           JNZ    1B1C
0000:1B19 C6040A         MOV    Byte Ptr [SI],0A
0000:1B1C 3C0A         * CMP    AL,0A
0000:1B1E E0F3           LOOPNZ 1B13
0000:1B20 7507           JNZ    1B29
0000:1B22 33F6           XOR    SI,SI
0000:1B24 E8861A         CALL   35AD
0000:1B27 0C01           OR     AL,01
0000:1B29 16             PUSH   SS
0000:1B2A 1F             POP    DS
0000:1B2B E84BFE         CALL   1979
0000:1B2E 8936DC00       MOV    [00DC],SI
0000:1B32 16             PUSH   SS
0000:1B33 1F             POP    DS
0000:1B34 893E3F04       MOV    [043F],DI
0000:1B38 7509           JNZ    1B43
0000:1B3A C43E3B04       LES    DI,[043B]
0000:1B3E 26806518BF     AND    Byte Ptr ES:[DI+18],BF
0000:1B43 E84904         CALL   1F8F
0000:1B46 C3             RET

0000:1B47 E87FFE         CALL   19C9
0000:1B4A 8B36DC00       MOV    SI,[00DC]
0000:1B4E 0BF6           OR     SI,SI
0000:1B50 75C1           JNZ    1B13
0000:1B52 803E600380     CMP    Byte Ptr [0360],80
0000:1B57 7406           JZ     1B5F
0000:1B59 C706600380FF   MOV    Word Ptr [0360],FF80
0000:1B5F 51             PUSH   CX
0000:1B60 06             PUSH   ES
0000:1B61 57             PUSH   DI
0000:1B62 BA6003         MOV    DX,0360
0000:1B65 E8281B         CALL   3690
0000:1B68 5F             POP    DI
0000:1B69 07             POP    ES
0000:1B6A 59             POP    CX
0000:1B6B BE6203         MOV    SI,0362
0000:1B6E 803C1A         CMP    Byte Ptr [SI],1A
0000:1B71 75A0           JNZ    1B13
0000:1B73 B01A           MOV    AL,1A
0000:1B75 AA             STOSB
0000:1B76 4F             DEC    DI
0000:1B77 B00A           MOV    AL,0A
0000:1B79 E8311A         CALL   35AD
0000:1B7C 33F6           XOR    SI,SI
0000:1B7E EBA9           JMP    1B29

; -----------------------------------------------------------------------------
                                               ;* z pis z znamu na za©¡zen¡
0000:1B80 E8F201         CALL   1D75
0000:1B83 0ADB           OR     BL,BL
0000:1B85 7865           JS     1BEC
0000:1B87 E8FE1C         CALL   3888
0000:1B8A 26894514       MOV    ES:[DI+14],AX
0000:1B8E 26895516       MOV    ES:[DI+16],DX
0000:1B92 E86704         CALL   1FFC
0000:1B95 C3             RET

0000:1B96 1E             PUSH   DS
0000:1B97 16             PUSH   SS
0000:1B98 1F             POP    DS
0000:1B99 E82DFE         CALL   19C9
0000:1B9C 1F             POP    DS
0000:1B9D 8BF3           MOV    SI,BX
0000:1B9F 51             PUSH   CX
0000:1BA0 AC             LODSB
0000:1BA1 3C1A           CMP    AL,1A
0000:1BA3 7405           JZ     1BAA
0000:1BA5 E8051A         CALL   35AD
0000:1BA8 E2F6           LOOP   1BA0
0000:1BAA 58             POP    AX
0000:1BAB 2BC1           SUB    AX,CX
0000:1BAD 1F             POP    DS
0000:1BAE E8C8FD         CALL   1979
0000:1BB1 EB29           JMP    1BDC
0000:1BB3 33C0           XOR    AX,AX
0000:1BB5 E8F2F8         CALL   14AA             ; z hlav¡ za©¡zen¡ pro z pis
0000:1BB8 36C5363B04     LDS    SI,SS:[043B]
0000:1BBD E82EF8         CALL   13EE
0000:1BC0 8BD7           MOV    DX,DI
0000:1BC2 B487           MOV    AH,87
0000:1BC4 368B3E3001     MOV    DI,SS:[0130]
0000:1BC9 F7C70080       TEST   DI,8000
0000:1BCD 7409           JZ     1BD8
0000:1BCF E89B11         CALL   2D6D
0000:1BD2 8BDA           MOV    BX,DX
0000:1BD4 3C01           CMP    AL,01
0000:1BD6 74DB           JZ     1BB3
0000:1BD8 1F             POP    DS
0000:1BD9 A13F01         MOV    AX,[013F]        ; adresa bloku param. BPB
0000:1BDC C43E3B04       LES    DI,[043B]
0000:1BE0 33D2           XOR    DX,DX
0000:1BE2 26F7750E       DIV    Word Ptr ES:[DI+0E]
0000:1BE6 8BC8           MOV    CX,AX
0000:1BE8 E80004         CALL   1FEB
0000:1BEB C3             RET

0000:1BEC 80CB40         OR     BL,40                         ;'@'
0000:1BEF 33C0           XOR    AX,AX
0000:1BF1 E3E9           JCXZ   1BDC
0000:1BF3 1E             PUSH   DS
0000:1BF4 8AC3           MOV    AL,BL
0000:1BF6 C51EDF00       LDS    BX,[00DF]        ; adresa diskov˜ch p©enos– DTA
0000:1BFA 8BFB           MOV    DI,BX
0000:1BFC 33D2           XOR    DX,DX
0000:1BFE A820           TEST   AL,20                         ;' '
0000:1C00 75B1           JNZ    1BB3
0000:1C02 A802           TEST   AL,02
0000:1C04 7590           JNZ    1B96
0000:1C06 A804           TEST   AL,04
0000:1C08 7576           JNZ    1C80
0000:1C0A 8BC2           MOV    AX,DX
0000:1C0C 803F1A         CMP    Byte Ptr [BX],1A
0000:1C0F 745A           JZ     1C6B
0000:1C11 51             PUSH   CX
0000:1C12 B90100         MOV    CX,0001
0000:1C15 E892F8         CALL   14AA             ; z hlav¡ za©¡zen¡ pro z pis
0000:1C18 59             POP    CX
0000:1C19 36C5363B04     LDS    SI,SS:[043B]
0000:1C1E C57419         LDS    SI,[SI+19]
0000:1C21 E8CF0F         CALL   2BF3
0000:1C24 E8CAF7         CALL   13F1             ; vol n¡ obsluhy za©¡zen¡ DS:SI
0000:1C27 57             PUSH   DI
0000:1C28 B487           MOV    AH,87
0000:1C2A 368B3E3001     MOV    DI,SS:[0130]
0000:1C2F F7C70080       TEST   DI,8000
0000:1C33 7411           JZ     1C46
0000:1C35 E83511         CALL   2D6D
0000:1C38 5F             POP    DI
0000:1C39 36C7063F010100 MOV    Word Ptr SS:[013F],0001 ; adresa bloku param. BPB
0000:1C40 3C01           CMP    AL,01
0000:1C42 74DD           JZ     1C21
0000:1C44 EB09           JMP    1C4F
0000:1C46 5F             POP    DI
0000:1C47 36833E3F0100   CMP    Word Ptr SS:[013F],+00; adresa bloku param. BPB
0000:1C4D 741C           JZ     1C6B
0000:1C4F 42             INC    DX
0000:1C50 36FF063B01     INC    Word Ptr SS:[013B]
0000:1C55 47             INC    DI
0000:1C56 1E             PUSH   DS
0000:1C57 368E1E3D01     MOV    DS,SS:[013D]
0000:1C5C 803D1A         CMP    Byte Ptr [DI],1A
0000:1C5F 1F             POP    DS
0000:1C60 740F           JZ     1C71
0000:1C62 36C70630010000 MOV    Word Ptr SS:[0130],0000
0000:1C69 E2B6           LOOP   1C21
0000:1C6B 8BC2           MOV    AX,DX
0000:1C6D 1F             POP    DS
0000:1C6E E96BFF         JMP    1BDC
0000:1C71 36C70630010000 MOV    Word Ptr SS:[0130],0000
0000:1C78 E8780F         CALL   2BF3
0000:1C7B E873F7         CALL   13F1             ; vol n¡ obsluhy za©¡zen¡ DS:SI
0000:1C7E EBEB           JMP    1C6B
0000:1C80 8BD1           MOV    DX,CX
0000:1C82 EBE7           JMP    1C6B
; -----------------------------------------------------------------------------
                                                 ; nalezen¡ popis. souboru FCB
0000:1C84 16             PUSH   SS
0000:1C85 1F             POP    DS
0000:1C86 06             PUSH   ES
0000:1C87 57             PUSH   DI
0000:1C88 E8F421         CALL   3E7F             ; nalezen¡ tabulky souboru
0000:1C8B 7207           JB     1C94
0000:1C8D 8BF7           MOV    SI,DI
0000:1C8F 83C603         ADD    SI,+03
0000:1C92 06             PUSH   ES
0000:1C93 1F             POP    DS
0000:1C94 5F           * POP    DI
0000:1C95 07             POP    ES
0000:1C96 C3           * RET
; -----------------------------------------------------------------------------
;         Nastaven¡ pracovn¡ho log. disku
; -----------------------------------------------------------------------------
0000:1C97 3638060001     CMP    SS:[0100],AL     ; po‡et instalovan˜ch log.disk–
0000:1C9C 72F8           JB     1C96             ; chybn‚ ‡¡slo disku
0000:1C9E FEC8           DEC    AL
0000:1CA0 7904           JNS    1CA6
0000:1CA2 36A02001       MOV    AL,SS:[0120]     ; aktivn¡ logick˜ disk
0000:1CA6 36A22504     * MOV    SS:[0425],AL     ; pracovn¡ logick˜ disk
0000:1CAA C3           * RET

; -----------------------------------------------------------------------------

0000:1CAB 8A0E2A04       MOV    CL,[042A]        ; po‡et sektor– na blok
0000:1CAF F6F1           DIV    CL
0000:1CB1 88262104       MOV    [0421],AH
0000:1CB5 8AC8           MOV    CL,AL
0000:1CB7 32ED           XOR    CH,CH
0000:1CB9 8B164B04       MOV    DX,[044B]        ; po‡ te‡n¡ sektor adres ©e
0000:1CBD 02D4           ADD    DL,AH
0000:1CBF 80D600         ADC    DH,00
0000:1CC2 8B1E4904       MOV    BX,[0449]
0000:1CC6 891E6304       MOV    [0463],BX
0000:1CCA E318           JCXZ   1CE4
0000:1CCC E81205       * CALL   21E1             ; ‡ten¡ ukaz. alok. bloku z FAT
0000:1CCF 87DF           XCHG   BX,DI
0000:1CD1 81FBF80F       CMP    BX,0FF8
0000:1CD5 7302           JNB    1CD9
0000:1CD7 E2F3           LOOP   1CCC
0000:1CD9 891E6304       MOV    [0463],BX
0000:1CDD 8BD7           MOV    DX,DI            ; ‡¡slo aloka‡n¡ho bloku
0000:1CDF 8ADC           MOV    BL,AH            ; ‡¡slo sektoru v bloku
0000:1CE1 E88F08         CALL   2573             ; zji¨tˆn¡ datov‚ho sektoru
0000:1CE4 32C0           XOR    AL,AL            ; p©¡znak na‡ten¡ sektoru
0000:1CE6 B40F           MOV    AH,0F
0000:1CE8 E84E0A         CALL   2739             ; z¡sk n¡ sektoru DX
0000:1CEB C3             RET

CONTEXT   0 241   0   3  72



ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º                                                                              º
º  >>> Obsah pamˆt¡ EPROM na desce STE termin lu BDT K 8901 - LOADING 07 <<<   º
º                                                                              º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

0000:f3                 di                  ; z kaz p©eru¨en¡
0001:31 80 18           ld      sp,stack    ; z sobn¡k BDTSTE
0004:c3 2d 0c           jp      init        ; inicializace BDT
; ......................................................
0007:                   db   0ffh,0ffh,0ffh,0ffh
000b:18 08              jr      lab29
; ......................................................
000d:           dtb14:  db   2,0f7h,73h,10h,10h,0,0,0
0015:11 de 18   lab29:  ld      de,dtb13
0018:21 0d 00           ld      hl,dtb14
001b:cd 18 02           call    vekt9
001e:18 08              jr      lab101
; ......................................................
0020:           dtb24:  db   3,0f8h,42h,10h,10h,0,0,0
0028:11 e0 18   lab101: ld      de,dtb23
002b:21 20 00           ld      hl,dtb24
002e:cd 18 02           call    vekt9
0031:01 cc 18           ld      bc,dtb25
0034:1e 05              ld      e,5
0036:26 01              ld      h,1
0038:2e 00              ld      l,0
003a:cd 1e 02           call    vekt11
003d:01 ce 18           ld      bc,dtb27
0040:1e 06              ld      e,6
0042:26 01              ld      h,1
0044:2e 00              ld      l,0
0046:cd 1e 02           call    vekt11
0049:01 b0 18           ld      bc,dtb28
004c:1e 03              ld      e,3
004e:26 02              ld      h,2
0050:2e 15              ld      l,15h
0052:cd 1e 02           call    vekt11
0055:01 b6 18           ld      bc,dtb29
0058:1e 04              ld      e,4
005a:26 02              ld      h,2
005c:2e 02              ld      l,2
005e:cd 1e 02           call    vekt11
0061:18 05              jr      lab113
; ......................................................
0063:c3 15 0d   lab124: jp      lab120           ; obsluha nemaskov. p©eru¨en¡

0066:18 fb              jr      lab124           ; obsluha nemaskov. p©eru¨en¡
; ......................................................
0068:18 08      lab113: jr      lab114
; ......................................................
006a:           dtb31:  db   4,0f9h,9eh,0dh,10h,0,0,0

0072:11 e2 18   lab114: ld      de,dtb30
0075:21 6a 00           ld      hl,dtb31
0078:cd 18 02           call    vekt9
007b:c3 a6 00           jp      lab115
; ......................................................
007e:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
0087:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
0090:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
0099:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
00a2:                   db   0ffh,0ffh,0ffh,0ffh
00a6:18 08      lab115: jr      lab116
; ......................................................
00a8:           dtb33:  db   0bh,6,38h,4ah,10h,0,0,0
00b0:11 f0 18   lab116: ld      de,dtb32
00b3:21 a8 00           ld      hl,dtb33
00b6:cd 18 02           call    vekt9
00b9:18 08              jr      lab117
; ......................................................
00bb:           dtb35:  db   0ch,7,0edh,4ah,10h,0,0,0
00c3:11 f2 18   lab117: ld      de,dtb34
00c6:21 bb 00           ld      hl,dtb35
00c9:cd 18 02           call    vekt9
00cc:01 d0 18           ld      bc,dtb36
00cf:1e 11              ld      e,11h
00d1:26 03              ld      h,3
00d3:2e 05              ld      l,5
00d5:cd 1e 02           call    vekt11
00d8:01 d2 18           ld      bc,dtb37
00db:1e 12              ld      e,12h
00dd:26 01              ld      h,1
00df:2e 03              ld      l,3
00e1:cd 1e 02           call    vekt11
00e4:01 d4 18           ld      bc,dtb38
00e7:1e 13              ld      e,13h
00e9:26 01              ld      h,1
00eb:2e 00              ld      l,0
00ed:cd 1e 02           call    vekt11
00f0:01 d6 18           ld      bc,dtb39
00f3:1e 14              ld      e,14h
00f5:26 01              ld      h,1
00f7:2e 00              ld      l,0
00f9:cd 1e 02           call    vekt11
00fc:01 d8 18           ld      bc,dtb40
00ff:1e 15              ld      e,15h
0101:26 01              ld      h,1
0103:2e 00              ld      l,0
0105:cd 1e 02           call    vekt11
0108:c3 c7 0c           jp      lab118
; ......................................................
010b:18 08              jr      lab125
; ......................................................
010d:           dtb46:  db   5,0feh,72h,69h,10h,0,0,0
0115:11 e8 18   lab125: ld      de,dtb45
0118:21 0d 01           ld      hl,dtb46
011b:cd 18 02           call    vekt9
011e:01 ba 18           ld      bc,dtb47
0121:1e 07              ld      e,7
0123:26 02              ld      h,2
0125:2e 04              ld      l,4
0127:cd 1e 02           call    vekt11
012a:01 c2 18           ld      bc,dtb48
012d:1e 08              ld      e,8
012f:26 02              ld      h,2
0131:2e 00              ld      l,0
0133:cd 1e 02           call    vekt11
0136:c9                 ret     
; ......................................................
0137:18 08              jr      lab126
; ......................................................
0139:           dtb50:  db   6,0fdh,0,3bh,10h,0,0,0
0141:11 e4 18   lab126: ld      de,dtb49
0144:21 39 01           ld      hl,dtb50
0147:cd 18 02           call    vekt9
014a:01 b2 18           ld      bc,dtb51
014d:1e 09              ld      e,9
014f:26 01              ld      h,1
0151:2e 02              ld      l,2
0153:cd 1e 02           call    vekt11
0156:01 c6 18           ld      bc,dtb52
0159:1e 0a              ld      e,0ah
015b:26 01              ld      h,1
015d:2e 00              ld      l,0
015f:cd 1e 02           call    vekt11
0162:c9                 ret     
; ......................................................
0163:18 08              jr      lab127
; ......................................................
0165:           dtb54:  db   7,0fch,5,3bh,10h,0,0,0
016d:11 e6 18   lab127: ld      de,dtb53
0170:21 65 01           ld      hl,dtb54
0173:cd 18 02           call    vekt9
0176:01 b4 18           ld      bc,dtb55
0179:1e 0b              ld      e,0bh
017b:26 01              ld      h,1
017d:2e 03              ld      l,3
017f:cd 1e 02           call    vekt11
0182:c5                 push    bc
0183:d5                 push    de
0184:e5                 push    hl
0185:01 c8 18           ld      bc,dtb56
0188:1e 0c              ld      e,0ch
018a:26 01              ld      h,1
018c:2e 00              ld      l,0
018e:cd 1e 02           call    vekt11
0191:e1                 pop     hl
0192:d1                 pop     de
0193:c1                 pop     bc
0194:c9                 ret     
; ......................................................
0195:18 08              jr      lab128
; ......................................................
0197:           dtb58:  db   8,0fbh,0,3bh,10h,0,0,0
019f:11 ee 18   lab128: ld      de,dtb57
01a2:21 97 01           ld      hl,dtb58
01a5:cd 18 02           call    vekt9
01a8:01 b8 18           ld      bc,dtb59
01ab:1e 0d              ld      e,0dh
01ad:26 01              ld      h,1
01af:2e 02              ld      l,2
01b1:cd 1e 02           call    vekt11
01b4:01 ca 18           ld      bc,dtb60
01b7:1e 0e              ld      e,0eh
01b9:26 01              ld      h,1
01bb:2e 00              ld      l,0
01bd:cd 1e 02           call    vekt11
01c0:c9                 ret     
; ......................................................
01c1:18 08              jr      lab129
; ......................................................
01c3:           dtb62:  db   9,0fah,0,6eh,10h,0,0,0
01cb:11 ea 18   lab129: ld      de,dtb61
01ce:21 c3 01           ld      hl,dtb62
01d1:cd 18 02           call    vekt9
01d4:18 08              jr      lab130
; ......................................................
01d6:           dtb64:  db   0ah,0f6h,0bfh,52h,10h,0,1,0
01de:11 ec 18   lab130: ld      de,dtb63
01e1:21 d6 01           ld      hl,dtb64
01e4:cd 18 02           call    vekt9
01e7:01 bc 18           ld      bc,dtb65
01ea:1e 0f              ld      e,0fh
01ec:26 02              ld      h,2
01ee:2e 03              ld      l,3
01f0:cd 1e 02           call    vekt11
01f3:01 c4 18           ld      bc,dtb66
01f6:1e 10              ld      e,10h
01f8:26 01              ld      h,1
01fa:2e 00              ld      l,0
01fc:cd 1e 02           call    vekt11
01ff:c9                 ret     
; ......................................................
0200:c3 2e 0b   vekt1:  jp      syst1       ; hork˜ start syst‚mu
; ......................................................
0203:c3 1b 03   vekt2:  jp      syst2       ; chybov‚ hl ¨en¡ - ERROR (S)
; ......................................................
0206:c3 3b 03   vekt3:  jp      syst3       ; zav dˆn¡ form tov. program–
; ......................................................
0209:c3 61 03   vekt4:  jp      syst4
; ......................................................
020c:c3 83 03   vekt5:  jp      syst5       ; skok na vektor p©eru¨en¡ (‡¡slo L)
; ......................................................
020f:c3 96 03   vekt6:  jp      syst6       ; nastav.adresy vektoru L na adr. DE
; ......................................................
0212:c3 b3 03   vekt7:  jp      syst7
; ......................................................
0215:c3 c3 03   vekt8:  jp      syst8
; ......................................................
0218:c3 23 04   vekt9:  jp      syst9
; ......................................................
021b:c3 1b 03   vekt10: jp      syst2       ; hl ¨en¡ chyby ERROR(S)
; ......................................................
021e:c3 bf 04   vekt11: jp      syst11
; ......................................................
0221:c3 1b 03   vekt12: jp      syst2       ; hl ¨en¡ chyby ERROR(S)
; ......................................................
0224:c3 1b 03   vekt13: jp      syst2       ; hl ¨en¡ chyby ERROR(S)
; ......................................................
0227:c3 1b 03   vekt14: jp      syst2       ; hl ¨en¡ chyby ERROR(S)
; ......................................................
022a:c3 13 05   vekt15: jp      syst15      ; inicializace ukazatele registr–
; ......................................................
022d:c3 1e 05   vekt16: jp      syst16
; ......................................................
0230:c3 28 05   vekt17: jp      syst17
; ......................................................
0233:c3 6b 05   vekt18: jp      syst18
; ......................................................
0236:c3 8b 05   vekt19: jp      syst19
; ......................................................
0239:c3 ec 07   vekt20: jp      syst20
; ......................................................
023c:c3 f8 07   vekt21: jp      syst21
; ......................................................
023f:c3 22 08   vekt22: jp      syst22
; ......................................................
0242:c3 51 09   vekt23: jp      syst23
; ......................................................
0245:c3 69 09   vekt24: jp      syst24
; ......................................................
0248:c3 5d 09   vekt25: jp      syst25
; ......................................................
024b:c3 75 09   vekt26: jp      syst26
; ......................................................
024e:                   db   0ffh,0ffh

                pushrg:                     ; ulo‘en¡ registr–

0250:f3                 di                  ; z kaz p©eru¨en¡
0251:fd e3              ex      (sp),iy     ; £schova IY, IY <- n vr. adresa
0253:dd e5              push    ix          ; £schova IX
0255:f5                 push    af          ; £schova AF
0256:dd 21 01 18        ld      ix,dtb16    ; registr p©¡znak–
025a:dd cb 00 fe        set     7,(ix+0)    ; nastaven¡ p©¡znaku
025e:ed 73 26 18        ld      (ddw5),sp   ; £schova ukazatele z sobn¡ku
0262:31 80 18           ld      sp,stack    ; z sobn¡k BDTSTE
0265:fb                 ei                  ; povolen¡ p©eru¨en¡
0266:dd 2a 02 18        ld      ix,(ddw6)   ; ukazatel programu interpreteru
026a:dd 74 18           ld      (ix+18h),h  ; £schova registru H
026d:dd 75 17           ld      (ix+17h),l  ; £schova registru L
0270:dd 72 1a           ld      (ix+1ah),d  ; £schova registru D
0273:dd 73 19           ld      (ix+19h),e  ; £schova registru E
0276:dd 70 1c           ld      (ix+1ch),b  ; £schova registru B
0279:dd 71 1b           ld      (ix+1bh),c  ; £schova registru C
027c:2a 26 18           ld      hl,(ddw5)   ; uschovan˜ ukazatel z sobn¡ku
027f:dd 74 15           ld      (ix+15h),h  ; £schova SP - HIGH
0282:dd 75 14           ld      (ix+14h),l  ; £schova SP - LOW
0285:dd 7e 16           ld      a,(ix+16h)
0288:fe ec              cp      0ech
028a:20 0f              jr      nz,lab33    ; nen¡ shoda - chyba
028c:2a 02 18           ld      hl,(ddw6)   ; ukazatel programu interpreteru
028f:01 1c 00           ld      bc,1ch      ; d‚lka tabulky dat
0292:09                 add     hl,bc       ; nov  adresa
0293:ed 4b 26 18        ld      bc,(ddw5)   ; uschovan  adresa SP
0297:ed 42              sbc     hl,bc       ; sn¡‘en¡ ukazatele SP o data
0299:38 05              jr      c,lab34     ; nedosa‘eno z sobn¡ku - OK
029b:3e 01      lab33:  ld      a,1         ; k¢d chyby ERROR(S)01
029d:c3 1b 03           jp      syst2       ; chybov‚ hl ¨en¡ ERROR(S)01

02a0:fd e9      lab34:  jp      (iy)        ; n vrat do programu
; ......................................................
                poprg:                      ; n vrat registr–

02a2:21 01 18           ld      hl,dtb16    ; p©¡znaky syst‚mov˜ch hodin
02a5:cb 76              bit     6,(hl)
02a7:28 20              jr      z,lab35
02a9:2a 02 18           ld      hl,(ddw6)   ; ukazatel programu interpreteru
02ac:7c                 ld      a,h
02ad:b5                 or      l
02ae:28 0d              jr      z,lab91
02b0:dd 2a 02 18        ld      ix,(ddw6)   ; ukazatel programu interpreteru
02b4:dd 7e 07           ld      a,(ix+7)
02b7:b7                 or      a
02b8:20 0f              jr      nz,lab35
02ba:cd e6 09           call    lab49
02bd:cd da 09   lab91:  call    lab92       ; inicializace IX
02c0:dd 22 02 18        ld      (ddw6),ix   ; ukazatel programu interpreteru
02c4:21 01 18           ld      hl,dtb16
02c7:cb b6              res     6,(hl)
02c9:dd 2a 02 18 lab35: ld      ix,(ddw6)   ; ukazatel programu interpreteru
02cd:dd 66 15           ld      h,(ix+15h)
02d0:dd 6e 14           ld      l,(ix+14h)
02d3:22 26 18           ld      (ddw5),hl
02d6:dd 66 18           ld      h,(ix+18h)
02d9:dd 6e 17           ld      l,(ix+17h)
02dc:dd 56 1a           ld      d,(ix+1ah)
02df:dd 5e 19           ld      e,(ix+19h)
02e2:dd 46 1c           ld      b,(ix+1ch)
02e5:dd 4e 1b           ld      c,(ix+1bh)
02e8:f3                 di      
02e9:ed 7b 26 18        ld      sp,(ddw5)
02ed:f1                 pop     af
02ee:dd e1              pop     ix
02f0:fd e1              pop     iy
02f2:fb                 ei      
02f3:00                 nop     
02f4:f3         lab138: di      
02f5:f5                 push    af
02f6:3a 15 18           ld      a,(ddb14)
02f9:b7                 or      a
02fa:28 05              jr      z,lab36
02fc:f1                 pop     af
02fd:fb                 ei      
02fe:c3 d7 05           jp      lab66
; ......................................................
0301:3a 14 18   lab36:  ld      a,(ddb15)
0304:b7                 or      a
0305:28 09              jr      z,lab37
0307:3d                 dec     a
0308:32 14 18           ld      (ddb15),a
030b:f1                 pop     af
030c:fb                 ei      
030d:c3 77 08           jp      lab38

0310:3a 01 18   lab37:  ld      a,(dtb16)
0313:cb bf              res     7,a
0315:32 01 18           ld      (dtb16),a
0318:f1                 pop     af
0319:fb                 ei      
031a:c9                 ret     
; ......................................................
                syst2:                      ; chybov‚ hl ¨en¡ ERROR (S)
031b:f3                 di
031c:32 00 18           ld      (RAMTOP),a  ; k¢d chyby ERROR(S)
031f:2a 10 0c           ld      hl,(ddw1)   ; adresa chybov‚ho hl ¨en¡ (=6bef)
0322:e9                 jp      (hl)        ; skok na chybov‚ hl ¨en¡ ERROR(S)
; ......................................................
0323:cd e6 09   lab48:  call    lab49
0326:c3 30 03           jp      lab53
; ......................................................
                lab148:                   ;* inicializace ukazatele programu
0329:01 00 00           ld      bc,0        ; za‡ tek programu interpreteru
032c:ed 43 02 18        ld      (ddw6),bc   ; ukazatel programu interpreteru
0330:3a 01 18   lab53:  ld      a,(dtb16)   ; p©¡znak
0333:cb f7              set     6,a
0335:32 01 18           ld      (dtb16),a
0338:c9                 ret     
; ......................................................
0339:                   db   0ffh,0ffh

033b:e5         syst3:  push    hl          ; £schova registru HL
033c:f5                 push    af          ; £schova registru AF
033d:21 01 18   lab196: ld      hl,dtb16    ; p©¡znaky syst. hodin
0340:cb 46              bit     0,(hl)
0342:20 13              jr      nz,lab137
0344:cb 7e              bit     7,(hl)
0346:20 0a              jr      nz,lab139
0348:cb fe              set     7,(hl)
034a:21 f4 02           ld      hl,lab138   ; adresa dal¨¡ obsluhy
034d:f1                 pop     af          ; n vrat registru AF
034e:e3                 ex      (sp),hl     ; n vrat registru HL
034f:fb                 ei                  ; povolen¡ p©eru¨en¡
0350:ed 4d              reti                ; n vrat z p©eru¨en¡

0352:f1         lab139: pop     af          ; n vrat registru AF
0353:e1                 pop     hl          ; n vrat registru HL
0354:fb                 ei                  ; povolen¡ p©eru¨en¡
0355:ed 4d              reti                ; n vrat z p©eru¨en¡

0357:cb 86      lab137: res     0,(hl)
0359:cb fe              set     7,(hl)
035b:f1                 pop     af          ; n vrat registru AF
035c:e1                 pop     hl          ; n vrat registru HL
035d:fb                 ei                  ; povolen¡ p©eru¨en¡
035e:c3 f4 02           jp      lab138      ; n vrat z p©eru¨en¡
; ......................................................
0361:f5         syst4:  push    af
0362:c5                 push    bc
0363:7e                 ld      a,(hl)
0364:21 15 18           ld      hl,ddb14    ; tabulka
0367:34                 inc     (hl)
0368:06 00              ld      b,0
036a:4e                 ld      c,(hl)
036b:09                 add     hl,bc
036c:77                 ld      (hl),a      ; ulo‘en¡
036d:79                 ld      a,c         ; ‡¡slo
036e:fe 10              cp      10h         ; kontrola ‡¡sla funkce
0370:3e 11              ld      a,11h       ; k¢d chyby ERROR(S)11
0372:ca 1b 03           jp      z,syst2     ; hl ¨en¡ chyby ERROR(S)11
0375:c1                 pop     bc
0376:f1                 pop     af
0377:c9                 ret     
; ......................................................
                                          ;* obsluha p©eru¨en¡ od syst. hodin
0378:e5         dtb69:  push    hl          ; £schova registru HL
0379:f5                 push    af          ; £schova registru AF
037a:21 14 18           ld      hl,ddb15    ; ‡¡ta‡ syst‚mov˜ch hodin
037d:34                 inc     (hl)        ; zv˜¨en¡ ‡¡ta‡e syst‚mov˜ch hodin
037e:c3 3d 03           jp      lab196      ; obsluha syst‚mov˜ch hodin
; ......................................................
0381:                   db   3bh,3

                syst5:                      ; skok na vektor p©eru¨en¡ (‡¡slo L)
0383:f3                 di                  ; z kaz p©eru¨en¡
0384:c5                 push    bc          ; £schova registru BC
0385:f5                 push    af          ; £schova registru AF
0386:7d                 ld      a,l         ; ‡¡slo vektoru
0387:21 01 18           ld      hl,dtb16    ; p©¡znak funkce
038a:cb c6              set     0,(hl)      ; nastaven¡ p©¡znaku obsluhy p©eru¨.
038c:cd 0d 04           call    lab133      ; v˜po‡et adresy vektoru p©eru¨en¡ A
038f:7e                 ld      a,(hl)      ; ni‘¨¡ bajt adresy
0390:23                 inc     hl
0391:66                 ld      h,(hl)      ; vy¨¨¡ bajt adresy
0392:6f                 ld      l,a         ; ni‘¨¡ bajt adresy
0393:f1                 pop     af          ; n vrat registru AF
0394:c1                 pop     bc          ; n vrat registru BC
0395:e9                 jp      (hl)        ; skok na obsluhu p©eru¨en¡
; ......................................................
                syst6:                      ; nastaven¡ adr. vektoru L na adr.DE

0396:cd 50 02           call    pushrg      ; ulo‘en¡ registr–
0399:dd 7e 17           ld      a,(ix+17h)  ; ‡¡slo vektoru p©eru¨en¡
039c:cd 0d 04           call    lab133      ; v˜po‡et adresy vektoru p©eru¨en¡ A
039f:dd 46 1a           ld      b,(ix+1ah)  ; nov  adresa - HIGH
03a2:dd 4e 19           ld      c,(ix+19h)  ; nov  adresa - LOW
03a5:f3                 di                  ; z kaz p©eru¨en¡
03a6:71                 ld      (hl),c      ; nov  adresa - LOW
03a7:23                 inc     hl          ; vi¨¨¡ bajt adresy
03a8:70                 ld      (hl),b      ; nov  adresa - HIGH
03a9:fb                 ei                  ; povolen¡ p©eru¨en¡
03aa:cd ec 03           call    lab135      ; kontr.sou‡et tab.vektor– p©eru¨en¡
03ad:22 2c 18           ld      (ddw19),hl  ; ulo‘en¡ kontr. sou‡tu tab. vekt.
03b0:c3 a2 02           jp      poprg       ; n vrat registr–
; ......................................................
                syst7:
03b3:f5                 push    af          ; £schova AX
03b4:dd e5              push    ix          ; £schova IX
03b6:f3                 di                  ; z kaz p©eru¨en¡
03b7:dd 2a 02 18        ld      ix,(ddw6)   ; ukazatel programu interpreteru
03bb:dd 34 07           inc     (ix+7)      ; zv˜¨en¡
03be:fb                 ei                  ; povolen¡ p©eru¨en¡
03bf:dd e1              pop     ix          ; n vrat IX
03c1:f1                 pop     af          ; n vrat AF
03c2:c9                 ret     
; ......................................................
                syst8:
03c3:f5                 push    af          ; £schova AX
03c4:dd e5              push    ix          ; £schova IX
03c6:f3                 di                  ; z kaz p©eru¨en¡
03c7:dd 2a 02 18        ld      ix,(ddw6)   ; ukazatel programu interpreteru
03cb:dd 35 07           dec     (ix+7)      ; sn¡‘en¡
03ce:fb                 ei                  ; povolen¡ p©eru¨en¡
03cf:dd e1              pop     ix          ; n vrat IX
03d1:f2 d9 03           jp      p,lab145    ; je je¨tˆ kladn‚ - OK
03d4:3e 13              ld      a,13h       ; chyba 13h
03d6:c3 1b 03   dtb118: jp      syst2       ; hl ¨en¡ chyby ERROR(S)13

03d9:f3         lab145: di                  ; z kaz p©eru¨en¡
03da:3a 01 18           ld      a,(dtb16)   ; p©¡znak
03dd:cb 77              bit     6,a
03df:20 03              jr      nz,lab146
03e1:fb                 ei                  ; povolen¡ p©eru¨en¡
03e2:f1                 pop     af          ; n vrat AF
03e3:c9                 ret

03e4:fb         lab146: ei                  ; povolen¡ p©eru¨en¡
03e5:f1                 pop     af          ; n vrat AF
03e6:cd 50 02           call    pushrg      ; ulo‘en¡ registr–
03e9:c3 a2 02           jp      poprg       ; n vrat registr–
; ......................................................
                lab135:                   ;* kontr.sou‡et tab.vektor– p©eru¨en¡
03ec:06 00              ld      b,0         ; B <- 00
03ee:3a 07 0c           ld      a,(ddb68)   ; po‡et vektor– p©eru¨en¡ (= 20)
03f1:4f                 ld      c,a         ; po‡et vektor– p©eru¨en¡
03f2:cb 21              sla     c
03f4:cb 10              rl      b           ; po‡et vektor– p©eru¨en¡ * 2
03f6:2a 05 0c           ld      hl,(ddw18)  ; za‡ tek tabulky vektor– p©eru¨en¡
03f9:cd fd 03           call    lab122      ; kontroln¡ sou‡et pamˆti
03fc:c9                 ret     
; ......................................................
                lab122:                     ; kontr.sou‡et pamˆti -> HL
                                            ; (HL adresa, BC po‡et bajt–)
03fd:af                 xor     a           ; A <- 0
03fe:57                 ld      d,a         ; pomocn˜ registr
03ff:17         lab123: rla                 ; rotace A vlevo
0400:cb 12              rl      d           ; rotace s D vlevo
0402:ce 00              adc     a,0         ; p©enos bitu z rotace
0404:ae                 xor     (hl)        ; XOR s pamˆt¡
0405:ed a1              cpi                 ; sn¡‘en¡ ‡¡ta‡e dat, zv˜¨en¡ ukaz.
0407:ea ff 03           jp      pe,lab123   ; kontr. sou‡et s dal¨¡m bajtem
040a:62                 ld      h,d         ; vy¨¨¡ bajt kontroln¡ho sou‡tu
040b:6f                 ld      l,a         ; ni‘¨¡ bajt kontroln¡ho sou‡tu
040c:c9                 ret     
; ......................................................
                lab133:                   ;* v˜po‡et adresy vektoru p©eru¨en¡ A
040d:21 07 0c           ld      hl,ddb68    ; po‡et vektor– p©eru¨en¡ (20)
0410:be                 cp      (hl)        ; je ‡¡slo vy¨¨¡ ?
0411:38 05              jr      c,lab134    ; ‡¡slo p©eru¨en¡ je OK
0413:3e 12              ld      a,12h       ; k¢d chyby 12h
0415:c3 1b 03           jp      syst2       ; chybov‚ hl ¨en¡ ERROR(S)12
0418:87         lab134: add     a,a         ; ‡¡slo p©eru¨en¡ * 2
0419:06 00              ld      b,0         ; B <- 0
041b:4f                 ld      c,a         ; BC <- A*2
041c:2a 05 0c           ld      hl,(ddw18)  ; za‡ tek tabulky vektor– p©eru¨en¡
041f:09                 add     hl,bc       ; v˜po‡et adresy vektoru p©eru¨en¡
0420:c9                 ret     
; ......................................................
0421:                   db   0ffh,0ffh

0423:cd 50 02   syst9:  call    pushrg      ; ulo‘en¡ registr–
0426:dd 66 18           ld      h,(ix+18h)
0429:dd 6e 17           ld      l,(ix+17h)
042c:7e                 ld      a,(hl)
042d:b7                 or      a
042e:28 02              jr      z,lab93
0430:fe ff              cp      0ffh
0432:3e 21      lab93:  ld      a,21h       ; k¢d chyby 21h
0434:ca 1b 03           jp      z,syst2     ; hl ¨en¡ chyby ERROR(S)21
0437:23                 inc     hl
0438:7e                 ld      a,(hl)
0439:fe ff              cp      0ffh
043b:3e 22              ld      a,22h       ; k¢d chyb 22h
043d:ca 1b 03           jp      z,syst2     ; hl ¨en¡ chyby ERROR(S)22
0440:cd 46 04           call    lab94       ; nastaven¡ programu interpreteru
0443:c3 a2 02           jp      poprg       ; navrat registr–
; ......................................................

                lab94:                      ; nastaven¡ programu interpreteru
0446:dd e5              push    ix
0448:dd 66 18           ld      h,(ix+18h)
044b:dd 6e 17           ld      l,(ix+17h)
044e:e5                 push    hl
044f:fd e1              pop     iy
0451:fd 66 05           ld      h,(iy+5)    ; 0
0454:fd 6e 04           ld      l,(iy+4)    ; 8
0457:01 37 00           ld      bc,37h      ; (55)
045a:09                 add     hl,bc
045b:e5                 push    hl
045c:cd 80 0a           call    lab95       ; kontrola adresy programu interp.
045f:e1                 pop     hl
0460:dd e5              push    ix
0462:c1                 pop     bc
0463:09                 add     hl,bc
0464:fd 7e 03           ld      a,(iy+3)
0467:2b                 dec     hl
0468:77                 ld      (hl),a
0469:fd 7e 02           ld      a,(iy+2)
046c:2b                 dec     hl
046d:77                 ld      (hl),a
046e:01 fa ff           ld      bc,0fffah   ; BC <-  -6
0471:09                 add     hl,bc       ; HL <- HL - 6
0472:dd 74 15           ld      (ix+15h),h
0475:dd 75 14           ld      (ix+14h),l
0478:dd 36 16 ec        ld      (ix+16h),0ech
047c:fd 7e 04           ld      a,(iy+4)
047f:dd 77 04           ld      (ix+4),a
0482:fd 7e 05           ld      a,(iy+5)
0485:dd 77 05           ld      (ix+5),a
0488:fd 7e 00           ld      a,(iy+0)
048b:dd 77 00           ld      (ix+0),a
048e:fd 7e 01           ld      a,(iy+1)
0491:dd 77 01           ld      (ix+1),a
0494:fd 7e 06           ld      a,(iy+6)
0497:dd 77 02           ld      (ix+2),a
049a:fd 46 07           ld      b,(iy+7)
049d:b0                 or      b
049e:28 0f              jr      z,lab100
04a0:dd 70 03           ld      (ix+3),b
04a3:3a 2e 18           ld      a,(ddw7)
04a6:dd 77 08           ld      (ix+8),a
04a9:3a 2f 18           ld      a,(ddb20)
04ac:dd 77 09           ld      (ix+9),a
04af:cd 23 03   lab100: call    lab48
04b2:dd e3              ex      (sp),ix
04b4:c1                 pop     bc
04b5:dd 66 1a           ld      h,(ix+1ah)
04b8:dd 6e 19           ld      l,(ix+19h)
04bb:71                 ld      (hl),c
04bc:23                 inc     hl
04bd:70                 ld      (hl),b
04be:c9                 ret     
; ......................................................
04bf:cd 50 02   syst11: call    pushrg      ; ulo‘en¡ registr–
04c2:dd 7e 19           ld      a,(ix+19h)
04c5:b7                 or      a           ; = 0 ?
04c6:20 05              jr      nz,lab104   ; nen¡ = 0 (OK)
04c8:3e 23              ld      a,23h       ; k¢d chyby 23h
04ca:c3 1b 03           jp      syst2       ; hl ¨en¡ chyby ERROR(S)23
04cd:dd 7e 19   lab104: ld      a,(ix+19h)
04d0:cd a4 0a           call    lab105
04d3:fd cb 00 fe        set     7,(iy+0)
04d7:dd 46 18           ld      b,(ix+18h)
04da:fd 70 01           ld      (iy+1),b    ; n sobitel
04dd:dd 5e 17           ld      e,(ix+17h)
04e0:fd 73 02           ld      (iy+2),e    ; n sobenec
04e3:af                 xor     a           ; A <- 0
04e4:b8                 cp      b           ; je B = 0 ?
04e5:28 1a              jr      z,lab111    ; B = 0
04e7:bb                 cp      e           ; je E = 0 ?
04e8:28 17              jr      z,lab111    ; E = 0
04ea:21 00 00           ld      hl,0        ; HL <- 0000
04ed:16 00              ld      d,0         ; D <- 00
04ef:13                 inc     de          ; DE <- E+1
04f0:19         lab112: add     hl,de
04f1:10 fd              djnz    lab112      ; vyn soben¡ DE*B -> HL
04f3:dd e5              push    ix
04f5:cd 80 0a           call    lab95       ; kontrola adresy programu interp.
04f8:dd e3              ex      (sp),ix
04fa:e1                 pop     hl
04fb:fd 74 09           ld      (iy+9),h
04fe:fd 75 08           ld      (iy+8),l
                                            ; nˆkter˜ z n sobk– = 0
0501:dd 66 1c   lab111: ld      h,(ix+1ch)
0504:dd 6e 1b           ld      l,(ix+1bh)
0507:dd 7e 19           ld      a,(ix+19h)
050a:77                 ld      (hl),a
050b:23                 inc     hl
050c:3a 00 0c           ld      a,(ddb23)   ; = 10h
050f:77                 ld      (hl),a
0510:c3 a2 02           jp      poprg       ; navrat registru
; ......................................................
0513:cd 50 02   syst15:                   ; inicializace ukazatele registr–
                        call    pushrg      ; ulozeni registru
0516:cd 29 03           call    lab148      ; inicializace ukazatele programu
0519:c3 a2 02           jp      poprg       ; navrat registru
; ......................................................
051c:                   db   0ffh,0ffh
051e:cd 50 02   syst16: call    pushrg      ; ulozeni registru
0521:dd cb 06 86        res     0,(ix+6)
0525:c3 2f 05           jp      lab150
; ......................................................
0528:cd 50 02   syst17: call    pushrg      ; ulozeni registru
052b:dd cb 06 c6        set     0,(ix+6)
052f:cd fe 06   lab150: call    lab151
0532:fd cb 00 6e        bit     5,(iy+0)
0536:20 21              jr      nz,lab152
0538:fd 7e 04           ld      a,(iy+4)
053b:fd be 01           cp      (iy+1)
053e:20 10              jr      nz,lab155
0540:cd 30 06           call    lab157
0543:fd 7e 05           ld      a,(iy+5)
0546:b7                 or      a
0547:28 1f              jr      z,lab156
0549:fd cb 00 f6        set     6,(iy+0)
054d:c3 68 05           jp      lab156
; ......................................................
0550:cd 0a 07   lab155: call    lab83
0553:cd e7 06           call    lab153
0556:c3 68 05           jp      lab156
; ......................................................
0559:dd e5      lab152: push    ix
055b:cd 19 06           call    lab72
055e:e1                 pop     hl
055f:e5                 push    hl
0560:cd 86 07           call    lab73
0563:dd e1              pop     ix
0565:cd e7 06           call    lab153
0568:c3 a2 02   lab156: jp      poprg       ; navrat registru
; ......................................................
056b:cd 50 02   syst18: call    pushrg      ; ulozeni registru
056e:cd fe 06           call    lab151
0571:fd cb 00 6e lab169:bit     5,(iy+0)
0575:28 0e              jr      z,lab168
0577:dd e5              push    ix
0579:cd 19 06           call    lab72
057c:e1                 pop     hl
057d:e5                 push    hl
057e:cd 86 07           call    lab73
0581:dd e1              pop     ix
0583:18 ec              jr      lab169
; ......................................................
0585:cd e7 06   lab168: call    lab153
0588:c3 a2 02           jp      poprg       ; navrat registru
; ......................................................
058b:cd 50 02   syst19: call    pushrg      ; ulozeni registru
058e:cd fe 06           call    lab151
0591:fd 7e 04           ld      a,(iy+4)
0594:b7                 or      a
0595:20 27              jr      nz,lab171
0597:fd cb 00 76        bit     6,(iy+0)
059b:20 10              jr      nz,lab177
059d:cd 30 06           call    lab157
05a0:fd 7e 05           ld      a,(iy+5)
05a3:b7                 or      a
05a4:28 2e              jr      z,lab178
05a6:fd cb 00 ee        set     5,(iy+0)
05aa:c3 d4 05           jp      lab178
; ......................................................
05ad:dd e5      lab177: push    ix
05af:cd 19 06           call    lab72
05b2:dd e3              ex      (sp),ix
05b4:e1                 pop     hl
05b5:cd 86 07           call    lab73
05b8:cd e7 06           call    lab153
05bb:c3 d4 05           jp      lab178
; ......................................................
05be:cd 55 07   lab171: call    lab172
05c1:fd cb 00 76        bit     6,(iy+0)
05c5:28 0a              jr      z,lab176
05c7:dd e5              push    ix
05c9:cd 19 06           call    lab72
05cc:cd 0a 07           call    lab83
05cf:dd e1              pop     ix
05d1:cd e7 06   lab176: call    lab153
05d4:c3 a2 02   lab178: jp      poprg       ; navrat registru
; ......................................................
05d7:cd 50 02   lab66:  call    pushrg      ; ulozeni registru
05da:f3                 di      
05db:21 15 18           ld      hl,ddb14
05de:06 00              ld      b,0
05e0:4e                 ld      c,(hl)
05e1:35                 dec     (hl)
05e2:09                 add     hl,bc
05e3:7e                 ld      a,(hl)
05e4:fb                 ei      
05e5:cd f2 0a           call    lab67
05e8:fd cb 00 6e        bit     5,(iy+0)
05ec:20 0d              jr      nz,lab71
05ee:fd 7e 04           ld      a,(iy+4)
05f1:fd be 01           cp      (iy+1)
05f4:20 11              jr      nz,lab82
05f6:3e 31              ld      a,31h       ; k¢d chyby 31h
05f8:c3 1b 03           jp      syst2       ; hl ¨en¡ chyby ERROR(S)31
; ......................................................
05fb:cd 19 06   lab71:  call    lab72
05fe:21 fa 05           ld      hl,5fah
0601:cd 86 07           call    lab73
0604:c3 0e 06           jp      lab81
; ......................................................
0607:dd 21 fa 05 lab82: ld      ix,5fah
060b:cd 0a 07           call    lab83
060e:c3 a2 02   lab81:  jp      poprg       ; navrat registru
; ......................................................
0611:                   db   0,0,0,0,0,0,0,0

0619:fd 46 07   lab72:  ld      b,(iy+7)
061c:fd 4e 06           ld      c,(iy+6)
061f:c5                 push    bc
0620:dd e1              pop     ix
0622:dd cb 06 7e        bit     7,(ix+6)
0626:c4 b5 09           call    nz,lab57
0629:cd 55 06           call    lab58
062c:cd 23 03           call    lab48
062f:c9                 ret     
; ......................................................
0630:dd 66 18   lab157: ld      h,(ix+18h)
0633:dd 6e 17           ld      l,(ix+17h)
0636:7c                 ld      a,h
0637:b5                 or      l
0638:28 14              jr      z,lab158
063a:7e                 ld      a,(hl)
063b:23                 inc     hl
063c:b6                 or      (hl)
063d:23                 inc     hl
063e:20 07              jr      nz,lab162
0640:af                 xor     a
0641:77                 ld      (hl),a
0642:23                 inc     hl
0643:77                 ld      (hl),a
0644:c3 54 06           jp      lab165
; ......................................................
0647:cd 97 09   lab162: call    lab163
064a:dd cb 06 fe        set     7,(ix+6)
064e:cd a9 06   lab158: call    lab159
0651:cd 29 03           call    lab148      ; inicializace ukazatele programu
0654:c9         lab165: ret     
; ......................................................
0655:e5         lab58:  push    hl
0656:dd 66 13           ld      h,(ix+13h)
0659:dd 6e 12           ld      l,(ix+12h)
065c:e5                 push    hl
065d:fd e3              ex      (sp),iy
065f:fd e5              push    iy
0661:01 f6 ff           ld      bc,0fff6h   ; = -10
0664:fd 09              add     iy,bc       ; IY - 10
0666:dd e5              push    ix
0668:c1                 pop     bc
0669:fd 66 11   lab61:  ld      h,(iy+11h)
066c:fd 6e 10           ld      l,(iy+10h)
066f:a7                 and     a
0670:ed 42              sbc     hl,bc
0672:28 07              jr      z,lab59
0674:09                 add     hl,bc
0675:e5                 push    hl
0676:fd e1              pop     iy
0678:c3 69 06           jp      lab61
; ......................................................
067b:dd 7e 10   lab59:  ld      a,(ix+10h)
067e:fd 77 10           ld      (iy+10h),a
0681:dd 7e 11           ld      a,(ix+11h)
0684:fd 77 11           ld      (iy+11h),a
0687:af                 xor     a
0688:dd 77 10           ld      (ix+10h),a
068b:dd 77 11           ld      (ix+11h),a
068e:fd e1              pop     iy
0690:fd 35 05           dec     (iy+5)
0693:20 08              jr      nz,lab60
0695:fd cb 00 ae        res     5,(iy+0)
0699:fd cb 00 b6        res     6,(iy+0)
069d:dd 36 10 00 lab60: ld      (ix+10h),0
06a1:dd 36 11 00        ld      (ix+11h),0
06a5:fd e1              pop     iy
06a7:e1                 pop     hl
06a8:c9                 ret     
; ......................................................
06a9:fd e5      lab159: push    iy
06ab:01 f6 ff           ld      bc,0fff6h
06ae:fd 09              add     iy,bc
06b0:dd 46 01           ld      b,(ix+1)
06b3:fd 66 11   lab161: ld      h,(iy+11h)
06b6:fd 6e 10           ld      l,(iy+10h)
06b9:7c                 ld      a,h
06ba:b5                 or      l
06bb:28 0c              jr      z,lab160
06bd:78                 ld      a,b
06be:23                 inc     hl
06bf:be                 cp      (hl)
06c0:2b                 dec     hl
06c1:38 06              jr      c,lab160
06c3:e5                 push    hl
06c4:fd e1              pop     iy
06c6:c3 b3 06           jp      lab161
; ......................................................
06c9:dd 74 11   lab160: ld      (ix+11h),h
06cc:dd 75 10           ld      (ix+10h),l
06cf:dd e5              push    ix
06d1:e1                 pop     hl
06d2:fd 74 11           ld      (iy+11h),h
06d5:fd 75 10           ld      (iy+10h),l
06d8:fd e1              pop     iy
06da:fd 34 05           inc     (iy+5)
06dd:fd e5              push    iy
06df:e1                 pop     hl
06e0:dd 74 13           ld      (ix+13h),h
06e3:dd 75 12           ld      (ix+12h),l
06e6:c9                 ret     
; ......................................................
06e7:dd 66 18   lab153: ld      h,(ix+18h)
06ea:dd 6e 17           ld      l,(ix+17h)
06ed:7c                 ld      a,h
06ee:b5                 or      l
06ef:c8                 ret     z
06f0:4e                 ld      c,(hl)
06f1:23                 inc     hl
06f2:46                 ld      b,(hl)
06f3:23                 inc     hl
06f4:78                 ld      a,b
06f5:b1                 or      c
06f6:20 02              jr      nz,lab154
06f8:0e 01              ld      c,1
06fa:71         lab154: ld      (hl),c
06fb:23                 inc     hl
06fc:70                 ld      (hl),b
06fd:c9                 ret     
; ......................................................
06fe:dd 66 1c   lab151: ld      h,(ix+1ch)
0701:dd 6e 1b           ld      l,(ix+1bh)
0704:7e                 ld      a,(hl)
0705:c3 f2 0a           jp      lab67
; ......................................................
0708:                   db   0ffh,0ffh
070a:00         lab83:  nop     
070b:fd 7e 02           ld      a,(iy+2)
070e:b7                 or      a
070f:ca 4e 07           jp      z,lab84
0712:dd cb 06 46        bit     0,(ix+6)
0716:20 10              jr      nz,lab85
0718:fd 7e 03           ld      a,(iy+3)
071b:fd 86 04           add     a,(iy+4)
071e:fd be 01           cp      (iy+1)
0721:38 12              jr      c,lab90
0723:fd 96 01           sub     (iy+1)
0726:18 0d              jr      lab90
; ......................................................
0728:fd 7e 03   lab85:  ld      a,(iy+3)
072b:b7                 or      a
072c:20 03              jr      nz,lab86
072e:fd 7e 01           ld      a,(iy+1)
0731:3d         lab86:  dec     a
0732:fd 77 03           ld      (iy+3),a
0735:cd d7 07   lab90:  call    lab87
0738:cd b3 07           call    lab74
073b:fd be 02           cp      (iy+2)
073e:38 03              jr      c,lab89
0740:fd 7e 02           ld      a,(iy+2)
0743:77         lab89:  ld      (hl),a
0744:23                 inc     hl
0745:b7                 or      a
0746:28 06              jr      z,lab84
0748:eb                 ex      de,hl
0749:06 00              ld      b,0
074b:4f                 ld      c,a
074c:ed b0              ldir    
074e:cd c6 07   lab84:  call    lab79
0751:fd 34 04           inc     (iy+4)
0754:c9                 ret     
; ......................................................
0755:fd 7e 02   lab172: ld      a,(iy+2)
0758:b7                 or      a
0759:ca 7f 07           jp      z,lab173
075c:fd 7e 03           ld      a,(iy+3)
075f:cd d7 07           call    lab87
0762:fd 7e 03           ld      a,(iy+3)
0765:3c                 inc     a
0766:fd be 01           cp      (iy+1)
0769:38 01              jr      c,lab174
076b:af                 xor     a
076c:fd 77 03   lab174: ld      (iy+3),a
076f:cd b3 07           call    lab74
0772:be                 cp      (hl)
0773:38 01              jr      c,lab175
0775:7e                 ld      a,(hl)
0776:23         lab175: inc     hl
0777:b7                 or      a
0778:28 05              jr      z,lab173
077a:06 00              ld      b,0
077c:4f                 ld      c,a
077d:ed b0              ldir    
077f:cd c6 07   lab173: call    lab79
0782:fd 35 04           dec     (iy+4)
0785:c9                 ret     
; ......................................................
0786:e5         lab73:  push    hl
0787:dd e3              ex      (sp),ix
0789:cd b3 07           call    lab74
078c:47                 ld      b,a
078d:eb                 ex      de,hl
078e:dd e3              ex      (sp),ix
0790:cd b3 07           call    lab74
0793:b8                 cp      b
0794:38 01              jr      c,lab76
0796:78                 ld      a,b
0797:fd be 02   lab76:  cp      (iy+2)
079a:38 03              jr      c,lab77
079c:fd 7e 02           ld      a,(iy+2)
079f:b7         lab77:  or      a
07a0:28 05              jr      z,lab78
07a2:06 00              ld      b,0
07a4:4f                 ld      c,a
07a5:ed b0              ldir    
07a7:dd e3      lab78:  ex      (sp),ix
07a9:cd c6 07           call    lab79
07ac:dd e3              ex      (sp),ix
07ae:cd c6 07           call    lab79
07b1:e1                 pop     hl
07b2:c9                 ret     
; ......................................................
07b3:e5         lab74:  push    hl
07b4:dd 66 1a           ld      h,(ix+1ah)
07b7:dd 6e 19           ld      l,(ix+19h)
07ba:7c                 ld      a,h
07bb:b5                 or      l
07bc:28 06              jr      z,lab75
07be:7e                 ld      a,(hl)
07bf:23                 inc     hl
07c0:23                 inc     hl
07c1:5e                 ld      e,(hl)
07c2:23                 inc     hl
07c3:56                 ld      d,(hl)
07c4:e1         lab75:  pop     hl
07c5:c9                 ret     
; ......................................................
07c6:e5         lab79:  push    hl
07c7:dd 66 1a           ld      h,(ix+1ah)
07ca:dd 6e 19           ld      l,(ix+19h)
07cd:47                 ld      b,a
07ce:7c                 ld      a,h
07cf:b5                 or      l
07d0:28 02              jr      z,lab80
07d2:23                 inc     hl
07d3:70                 ld      (hl),b
07d4:78         lab80:  ld      a,b
07d5:e1                 pop     hl
07d6:c9                 ret     
; ......................................................
07d7:fd 66 09   lab87:  ld      h,(iy+9)
07da:fd 6e 08           ld      l,(iy+8)
07dd:b7                 or      a
07de:c8                 ret     z
07df:16 00              ld      d,0
07e1:fd 5e 02           ld      e,(iy+2)
07e4:13                 inc     de
07e5:47                 ld      b,a
07e6:19         lab88:  add     hl,de
07e7:10 fd              djnz    lab88
07e9:c9                 ret     
; ......................................................
07ea:                   db   0ffh,0ffh
07ec:cd 50 02   syst20: call    pushrg      ; ulozeni registru
07ef:cd 97 09           call    lab163
07f2:cd 29 03           call    lab148      ; inicializace ukazatele programu
07f5:c3 a2 02           jp      poprg       ; navrat registru
; ......................................................
07f8:cd 50 02   syst21: call    pushrg      ; ulozeni registru
07fb:dd 66 18           ld      h,(ix+18h)
07fe:dd 6e 17           ld      l,(ix+17h)
0801:46                 ld      b,(hl)
0802:23                 inc     hl
0803:4e                 ld      c,(hl)
0804:3e 17      dtb131: ld      a,17h       ; 23
0806:b8                 cp      b
0807:38 05              jr      c,lab181
0809:3e 3b              ld      a,3bh       ; 59
080b:b9                 cp      c
080c:30 05              jr      nc,lab182
080e:3e 51      lab181: ld      a,51h       ; k¢d chyby 51h
0810:c3 1b 03           jp      syst2       ; hl ¨en¡ chyby ERROR(S)51
; ......................................................
0813:dd 70 0a   lab182: ld      (ix+0ah),b
0816:dd 71 0b           ld      (ix+0bh),c
0819:cd 2b 0a           call    lab183
081c:cd 29 03           call    lab148      ; inicializace ukazatele programu
081f:c3 a2 02           jp      poprg       ; navrat registru
; ......................................................
0822:cd 50 02   syst22: call    pushrg      ; ulozeni registru
0825:dd 7e 02           ld      a,(ix+2)
0828:dd b6 03           or      (ix+3)
082b:3e 52              ld      a,52h       ; k¢d chyby 52h
082d:ca 1b 03           jp      z,syst2     ; hl ¨en¡ chyby ERROR(S)52
0830:dd 66 09           ld      h,(ix+9)
0833:dd 6e 08           ld      l,(ix+8)
0836:dd 46 03           ld      b,(ix+3)
0839:dd 4e 02           ld      c,(ix+2)
083c:ed 5b 2e 18        ld      de,(ddw7)
0840:cd 70 08           call    lab185      ; porovn n¡ CMP DE,HL
0843:38 0a              jr      c,lab186
0845:09         lab189: add     hl,bc
0846:38 13              jr      c,lab187
0848:cd 70 08           call    lab185      ; porovn n¡ CMP DE,HL
084b:38 0e              jr      c,lab187
084d:18 f6              jr      lab189
; ......................................................
084f:09         lab186: add     hl,bc
0850:30 fd              jr      nc,lab186
0852:cd 70 08   lab188: call    lab185      ; porovn n¡ CMP DE,HL
0855:38 04              jr      c,lab187
0857:09                 add     hl,bc
0858:c3 52 08           jp      lab188
; ......................................................
085b:dd 74 0b   lab187: ld      (ix+0bh),h
085e:dd 75 0a           ld      (ix+0ah),l
0861:dd 74 09           ld      (ix+9),h
0864:dd 75 08           ld      (ix+8),l
0867:cd 1f 0a           call    lab164
086a:cd 29 03           call    lab148      ; inicializace ukazatele programu
086d:c3 a2 02           jp      poprg       ; navrat registru
; ......................................................
                                          ;* porovn n¡ CMP DE,HL
0870:7a         lab185: ld      a,d
0871:bc                 cp      h
0872:d8                 ret     c
0873:c0                 ret     nz
0874:7b                 ld      a,e
0875:bd                 cp      l
0876:c9                 ret     
; ......................................................
0877:cd 50 02   lab38:  call    pushrg      ; ulozeni registru
087a:2a 2e 18           ld      hl,(ddw7)
087d:23                 inc     hl
087e:22 2e 18           ld      (ddw7),hl
0881:3a 01 0c           ld      a,(ddb16)   ; = 14h
0884:3d                 dec     a
0885:06 04              ld      b,4
0887:0e 00              ld      c,0
0889:11 cf 08           ld      de,dtb17
088c:21 36 18           ld      hl,dtb18
088f:cd be 08           call    lab39
0892:3a 31 18           ld      a,(ddb21)
0895:fe 02              cp      2
0897:20 0c              jr      nz,lab64
0899:3a 30 18           ld      a,(ddb22)
089c:e6 03              and     3
089e:20 05              jr      nz,lab64
08a0:3e 1d              ld      a,1dh
08a2:c3 b4 08           jp      lab65
; ......................................................
08a5:06 00      lab64:  ld      b,0
08a7:3a 31 18           ld      a,(ddb21)
08aa:4f                 ld      c,a
08ab:dd 21 ce 08        ld      ix,8ceh
08af:dd 09              add     ix,bc
08b1:dd 7e 00           ld      a,(ix+0)
08b4:06 03      lab65:  ld      b,3
08b6:0e 01              ld      c,1
08b8:cd be 08           call    lab39
08bb:c3 db 08   lab40:  jp      lab41
; ......................................................
08be:34         lab39:  inc     (hl)
08bf:be                 cp      (hl)
08c0:30 f9              jr      nc,lab40
08c2:71                 ld      (hl),c
08c3:2b                 dec     hl
08c4:1b                 dec     de
08c5:1a                 ld      a,(de)
08c6:10 f6              djnz    lab39
08c8:c9                 ret     
; ......................................................
08c9:                   db   64h,0ch,0,17h,3bh,3bh
08cf:           dtb17:  db   1fh,1ch,1fh,1eh,1fh,1eh,1fh,1fh,1eh,1fh,1eh
08da:                   db   1fh

08db:2a 0c 18   lab41:  ld      hl,(ddw8)   ; =1800h
08de:01 00 18   lab62:  ld      bc,RAMTOP   ; ramtop / kod chyby SYSERR
08e1:e5         lab55:  push    hl
08e2:dd e1              pop     ix
08e4:a7                 and     a
08e5:ed 42              sbc     hl,bc
08e7:28 2e              jr      z,lab42
08e9:dd 66 0d           ld      h,(ix+0dh)
08ec:dd 6e 0c           ld      l,(ix+0ch)
08ef:3a 2e 18           ld      a,(ddw7)
08f2:dd be 0a           cp      (ix+0ah)
08f5:20 ea              jr      nz,lab55
08f7:3a 2f 18           ld      a,(ddb20)
08fa:dd be 0b           cp      (ix+0bh)
08fd:20 e2              jr      nz,lab55
08ff:dd cb 06 7e        bit     7,(ix+6)
0903:20 06              jr      nz,lab56
0905:cd 17 0a           call    lab46
0908:c3 11 09           jp      lab63
; ......................................................
090b:cd b5 09   lab56:  call    lab57
090e:cd 55 06           call    lab58
0911:cd 23 03   lab63:  call    lab48
0914:c3 de 08           jp      lab62
; ......................................................
0917:3a 36 18   lab42:  ld      a,(dtb18)
091a:47                 ld      b,a
091b:3a 35 18           ld      a,(ddb17)
091e:b0                 or      b
091f:20 2d              jr      nz,lab43
0921:2a 10 18           ld      hl,(ddw9)   ; =1804
0924:01 04 18   lab54:  ld      bc,dtb19    ; za‡ tek pamˆti programu interpr.
0927:e5         lab45:  push    hl
0928:dd e1              pop     ix
092a:a7                 and     a
092b:ed 42              sbc     hl,bc
092d:28 1f              jr      z,lab43
092f:dd 66 0d           ld      h,(ix+0dh)
0932:dd 6e 0c           ld      l,(ix+0ch)
0935:3a 34 18           ld      a,(ddb18)
0938:dd be 0b           cp      (ix+0bh)
093b:20 ea              jr      nz,lab45
093d:3a 33 18           ld      a,(ddb19)
0940:dd be 0a           cp      (ix+0ah)
0943:20 e2              jr      nz,lab45
0945:cd 17 0a           call    lab46
0948:cd 23 03           call    lab48
094b:c3 24 09           jp      lab54
; ......................................................
094e:c3 a2 02   lab43:  jp      poprg       ; navrat registru
; ......................................................
0951:cd 50 02   syst23: call    pushrg      ; ulozeni registru
0954:11 33 18           ld      de,ddb19
0957:01 04 00           ld      bc,4        ; d‚lka dat
095a:c3 8c 09           jp      lab191
; ......................................................
095d:cd 50 02   syst25: call    pushrg      ; ulozeni registru
0960:11 30 18           ld      de,ddb22
0963:01 03 00           ld      bc,3
0966:c3 8c 09           jp      lab191
; ......................................................
0969:cd 50 02   syst24: call    pushrg      ; ulozeni registru
096c:21 33 18           ld      hl,ddb19
096f:01 04 00           ld      bc,4
0972:c3 81 09           jp      lab193
; ......................................................
0975:cd 50 02   syst26: call    pushrg      ; ulozeni registru
0978:21 30 18           ld      hl,ddb22
097b:01 03 00           ld      bc,3
097e:c3 81 09           jp      lab193
; ......................................................
0981:dd 56 18   lab193: ld      d,(ix+18h)
0984:dd 5e 17           ld      e,(ix+17h)
0987:ed b0              ldir                ; p©enos polo‘ky
0989:c3 a2 02           jp      poprg       ; navrat registru
; ......................................................
098c:dd 66 18   lab191: ld      h,(ix+18h)
098f:dd 6e 17           ld      l,(ix+17h)
0992:ed b0              ldir                ; p©enos polo‘ky
0994:c3 a2 02           jp      poprg       ; navrat registru
; ......................................................
0997:dd 66 18   lab163: ld      h,(ix+18h)
099a:dd 6e 17           ld      l,(ix+17h)
099d:4e                 ld      c,(hl)
099e:23                 inc     hl
099f:46                 ld      b,(hl)
09a0:78                 ld      a,b
09a1:b1                 or      c           ; je BC = 0 ?
09a2:3e 51              ld      a,51h       ; k¢d chyby 51h
09a4:ca 1b 03           jp      z,syst2     ; hl ¨en¡ chyby ERROR(S)51
09a7:2a 2e 18           ld      hl,(ddw7)
09aa:09                 add     hl,bc
09ab:dd 74 0b           ld      (ix+0bh),h
09ae:dd 75 0a           ld      (ix+0ah),l
09b1:cd 1f 0a           call    lab164
09b4:c9                 ret     
; ......................................................
09b5:e5         lab57:  push    hl
09b6:cd 17 0a           call    lab46
09b9:dd 66 0b           ld      h,(ix+0bh)
09bc:dd 6e 0a           ld      l,(ix+0ah)
09bf:ed 4b 2e 18        ld      bc,(ddw7)
09c3:a7                 and     a
09c4:ed 42              sbc     hl,bc
09c6:eb                 ex      de,hl
09c7:dd 66 18           ld      h,(ix+18h)
09ca:dd 6e 17           ld      l,(ix+17h)
09cd:23                 inc     hl
09ce:23                 inc     hl
09cf:73                 ld      (hl),e
09d0:23                 inc     hl
09d1:72                 ld      (hl),d
09d2:dd cb 06 be        res     7,(ix+6)
09d6:e1                 pop     hl
09d7:c9                 ret     
; ......................................................
09d8:                   db   0ffh,0ffh
                                            ; inicializace IX
09da:fd e5      lab92:  push    iy
09dc:dd 2a 08 18        ld      ix,(ddw10)  ; =17fch
09e0:cd 37 0a           call    lab47       ; p©enos parametr– IX -> IY
09e3:fd e1              pop     iy
09e5:c9                 ret     
; ......................................................

09e6:fd e5      lab49:  push    iy
09e8:e5                 push    hl
09e9:fd 21 fc 17        ld      iy,17fch
09ed:dd 7e 01           ld      a,(ix+1)
09f0:2a 08 18           ld      hl,(ddw10)  ; =17fch
09f3:01 fc 17           ld      bc,17fch
09f6:a7                 and     a
09f7:ed 42              sbc     hl,bc       ; HL = BC ?
09f9:28 15              jr      z,lab50     ; je HL = 17fch (za‡ tek)
09fb:2a 0a 18           ld      hl,(ddw11)  ; =17fch
09fe:23                 inc     hl
09ff:be                 cp      (hl)
0a00:30 0e              jr      nc,lab50
0a02:fd 46 0d   lab52:  ld      b,(iy+0dh)
0a05:fd 4e 0c           ld      c,(iy+0ch)
0a08:c5                 push    bc
0a09:fd e1              pop     iy
0a0b:fd be 01           cp      (iy+1)
0a0e:30 f2              jr      nc,lab52
0a10:cd 56 0a   lab50:  call    lab51       ; p©enos parametr– IY -> IX
0a13:e1                 pop     hl
0a14:fd e1              pop     iy
0a16:c9                 ret     
; ......................................................
0a17:fd e5      lab46:  push    iy
0a19:cd 37 0a           call    lab47       ; p©enos parametr– IX -> IY
0a1c:fd e1              pop     iy
0a1e:c9                 ret     
; ......................................................
0a1f:fd e5      lab164: push    iy
0a21:fd 21 00 18        ld      iy,RAMTOP   ; ramtop / kod chyby SYSERR
0a25:cd 56 0a           call    lab51       ; p©enos parametr– IY -> IX
0a28:fd e1              pop     iy
0a2a:c9                 ret     
; ......................................................
0a2b:fd e5      lab183: push    iy
0a2d:fd 21 04 18        ld      iy,dtb19    ; za‡ tek pamˆti programu interpr.
0a31:cd 56 0a           call    lab51       ; p©enos parametr– IY -> IX
0a34:fd e1              pop     iy
0a36:c9                 ret     
; ......................................................
                                            ; p©enos parametr– IX -> IY
0a37:dd 46 0d   lab47:  ld      b,(ix+0dh)
0a3a:dd 4e 0c           ld      c,(ix+0ch)
0a3d:dd 56 0f           ld      d,(ix+0fh)
0a40:dd 5e 0e           ld      e,(ix+0eh)
0a43:d5                 push    de
0a44:fd e1              pop     iy
0a46:fd 70 0d           ld      (iy+0dh),b
0a49:fd 71 0c           ld      (iy+0ch),c
0a4c:c5                 push    bc
0a4d:fd e1              pop     iy
0a4f:fd 72 0f           ld      (iy+0fh),d
0a52:fd 73 0e           ld      (iy+0eh),e
0a55:c9                 ret     
; ......................................................
                lab51:                      ; p©enos parametr– IY -> IX
0a56:fd e5              push    iy
0a58:c1                 pop     bc
0a59:dd 70 0d           ld      (ix+0dh),b
0a5c:dd 71 0c           ld      (ix+0ch),c
0a5f:fd 46 0f           ld      b,(iy+0fh)
0a62:fd 4e 0e           ld      c,(iy+0eh)
0a65:dd 70 0f           ld      (ix+0fh),b
0a68:dd 71 0e           ld      (ix+0eh),c
0a6b:c5                 push    bc
0a6c:dd e5              push    ix
0a6e:c1                 pop     bc
0a6f:fd 70 0f           ld      (iy+0fh),b
0a72:fd 71 0e           ld      (iy+0eh),c
0a75:fd e1              pop     iy
0a77:fd 70 0d           ld      (iy+0dh),b
0a7a:fd 71 0c           ld      (iy+0ch),c
0a7d:c9                 ret     
; ......................................................
0a7e:                   db   0ffh,0ffh

                                            ; kontrola adresy programu interp.
0a80:44         lab95:  ld      b,h         ; adresa ukazatele interpreteru
0a81:4d                 ld      c,l
0a82:2a 06 18           ld      hl,(ddw12)  ; konec pamˆti programu interpreteru
0a85:a7                 and     a           ; CF <- 0
0a86:ed 42              sbc     hl,bc       ; kontrola horn¡ meze adresy prog.
0a88:e5                 push    hl          ; rozd¡l adres -> stack
0a89:dd e1              pop     ix          ; rozd¡l adres -> IX
0a8b:38 09              jr      c,lab96     ; p©ete‡en¡ adresy programu interp.
0a8d:ed 5b 04 18        ld      de,(dtb19)  ; za‡ tek pamˆti programu interpr.
0a91:a7                 and     a           ; CF <- 0
0a92:ed 52              sbc     hl,de       ; kontrola doln¡ meze adresy prog.
0a94:30 05              jr      nc,lab97    ; nen¡ chyba adresy programu interp.
0a96:3e 73      lab96:  ld      a,73h       ; k¢d chyby 73h
0a98:c3 1b 03           jp      syst2       ; chybov‚ hl ¨en¡ ERROR(S)73
0a9b:19         lab97:  add     hl,de       ; n vrat adresy programu interpret.
0a9c:dd 22 06 18        ld      (ddw12),ix  ; konec pamˆti programu interpreteru
0aa0:cd 24 0b           call    lab98       ; vynulov n¡ BC bajt– od adresy HL
0aa3:c9                 ret     
; ......................................................
0aa4:b7         lab105: or      a           ; ‡¡slo - po‡et polo‘ek
0aa5:ca e7 0a           jp      z,lab106
0aa8:cd 11 0b           call    lab69       ; zv˜¨en¡ ukazatele 0C0A o A polo‘ek
0aab:fd e5              push    iy          ; adresa polo‘ky
0aad:e1                 pop     hl          ; nov  adresa
0aae:ed 4b 04 18        ld      bc,(dtb19)  ; za‡ tek pamˆti programu interpr.
0ab2:a7                 and     a
0ab3:ed 42              sbc     hl,bc
0ab5:da e0 0a           jp      c,lab108
0ab8:01 0a 00           ld      bc,0ah      ; BC <- 10
0abb:09                 add     hl,bc       ; HL + 10
0abc:44                 ld      b,h
0abd:4d                 ld      c,l         ; BC <- nov  adresa
0abe:2a 06 18           ld      hl,(ddw12)  ; konec pamˆti programu interpreteru
0ac1:ed 5b 04 18        ld      de,(dtb19)  ; za‡ tek pamˆti programu interpr.
0ac5:a7                 and     a
0ac6:ed 52              sbc     hl,de
0ac8:ed 42              sbc     hl,bc
0aca:da ec 0a           jp      c,lab110    ; p©ekro‡en¡ ‡¡sla - chyba
0acd:2a 04 18           ld      hl,(dtb19)  ; za‡ tek pamˆti programu interpr.
0ad0:cd 24 0b           call    lab98       ; vynulov n¡ BC bajt– od adresy HL
0ad3:fd e5              push    iy
0ad5:e1                 pop     hl
0ad6:01 0a 00           ld      bc,0ah      ; BC <- 10
0ad9:09                 add     hl,bc       ; HL <- HL + 10
0ada:22 04 18           ld      (dtb19),hl  ; za‡ tek pamˆti programu interpr.
0add:c3 f1 0a           jp      lab109
; ......................................................
0ae0:fd cb 00 7e lab108:bit     7,(iy+0)
0ae4:ca f1 0a           jp      z,lab109    ; nen¡ chyba - n vrat
0ae7:3e 71      lab106: ld      a,71h       ; k¢d chyby 71h
0ae9:c3 ee 0a           jp      lab107      ; hl ¨en¡ chyby ERROR(S)71
; ......................................................
0aec:3e 72      lab110: ld      a,72h       ; k¢d chyby 72h
0aee:c3 1b 03   lab107: jp      syst2       ; hl ¨en¡ chyby ERROR(S)72
; ......................................................
0af1:c9         lab109: ret     

; ......................................................
0af2:b7         lab67:  or      a           ; po‡et polo‘ek
0af3:ca 0b 0b           jp      z,lab68
0af6:cd 11 0b           call    lab69       ; zv˜¨en¡ ukazatele 0C0A o A polo‘ek
0af9:fd e5              push    iy          ; adresa polo‘ky
0afb:e1                 pop     hl
0afc:ed 4b 04 18        ld      bc,(dtb19)  ; za‡ tek pamˆti programu interpr.
0b00:a7                 and     a
0b01:ed 42              sbc     hl,bc
0b03:30 06              jr      nc,lab68
0b05:fd cb 00 7e        bit     7,(iy+0)
0b09:20 05              jr      nz,lab70
0b0b:3e 71      lab68:  ld      a,71h       ; k¢d chyby 71h
0b0d:c3 1b 03           jp      syst2       ; hl ¨en¡ chyby ERROR(S)71
; ......................................................
0b10:c9         lab70:  ret     
; ......................................................
                                          ;* zv˜¨en¡ ukazatele 0C0A o A polo‘ek
0b11:3d         lab69:  dec     a           ; A - 1
0b12:26 00              ld      h,0
0b14:6f                 ld      l,a         ; HL <- A-1
0b15:44                 ld      b,h
0b16:4d                 ld      c,l         ; BC <- A-1
0b17:29                 add     hl,hl       ; A * 2
0b18:29                 add     hl,hl       ; A * 4
0b19:09                 add     hl,bc       ; A * 5
0b1a:29                 add     hl,hl       ; A * 10
0b1b:44                 ld      b,h
0b1c:4d                 ld      c,l         ; BC <- A*10
0b1d:fd 2a 0a 0c        ld      iy,(ddw15)  ; adresa lab303 = 2300h
0b21:fd 09              add     iy,bc       ; zv˜¨en¡ adresy o offset A
0b23:c9                 ret     
; ......................................................
                lab98:                    ;* vynulov n¡ BC bajt– od adresy HL
0b24:af                 xor     a           ; nulovac¡ bajt
0b25:77         lab99:  ld      (hl),a      ; vynulov n¡ adresy
0b26:ed a1              cpi                 ; zv˜¨en¡ ukazatele adres
0b28:ea 25 0b           jp      pe,lab99    ; vynulov n¡ dal¨¡ho bajtu
0b2b:c9                 ret     
; ......................................................
0b2c:                   db   0ffh,0ffh


                syst1:                      ; hork˜ start syst‚mu

0b2e:f3                 di                  ; z kaz p©eru¨en¡
0b2f:af                 xor     a           ; A <- 0
0b30:21 00 18           ld      hl,RAMTOP   ; za‡ tek pamˆti RAM
0b33:01 80 00           ld      bc,80h      ; d‚lka datov‚ ‡ sti RAM
0b36:77         lab132: ld      (hl),a      ; vymaz n¡ datov‚ ‡ sti RAM
0b37:ed a1              cpi                 ; zv˜¨en¡ ukazatele
0b39:ea 36 0b           jp      pe,lab132   ; vymaz n¡ dal¨¡ho bajtu
0b3c:2a 0a 0c           ld      hl,(ddw15)  ; = 2300h
0b3f:22 04 18           ld      (dtb19),hl  ; za‡ tek pamˆti programu interpr.
0b42:ed 4b 0c 0c        ld      bc,(ddw50)  ; = 0800h
0b46:09                 add     hl,bc       ; HL <- HL + BC (2300h + 0800h)
0b47:22 06 18           ld      (ddw12),hl  ; konec pamˆti programu interpreteru
0b4a:31 80 18           ld      sp,stack    ; z sobn¡k v RAM
0b4d:21 fc 17           ld      hl,17fch    ; HL <- 17fch
0b50:22 08 18           ld      (ddw10),hl  ; = 17fch
0b53:22 0a 18           ld      (ddw11),hl  ; = 17fch
0b56:21 00 18           ld      hl,RAMTOP   ; ramtop / k¢d chyby SYSERR
0b59:22 0c 18           ld      (ddw8),hl   ; =1800h
0b5c:22 0e 18           ld      (ddw16),hl  ; =1800h
0b5f:21 04 18           ld      hl,dtb19    ; za‡ tek pamˆti programu interpr.
0b62:22 10 18           ld      (ddw9),hl   ; =1804
0b65:22 12 18           ld      (ddw17),hl  ; =1804
0b68:3a 04 0c           ld      a,(ddb25)   ; = 3
0b6b:cd 0d 04           call    lab133      ; v˜po‡et adresy vektoru p©eru¨en¡ A
0b6e:01 78 03           ld      bc,dtb69    ; adresa p©eru¨en¡ od syst‚m. hodin
0b71:71                 ld      (hl),c      ; p©eru¨en¡ od syst. hodin
0b72:23                 inc     hl          ; adresa vy¨¨¡ho bajtu adresy
0b73:70                 ld      (hl),b      ; adresa p©eru¨en¡ od syst. hodin
0b74:cd ec 03           call    lab135      ; kontr.sou‡et tab.vektor– p©eru¨en¡
0b77:22 2c 18           ld      (ddw19),hl  ; kontr.sou‡et tab.vektor– p©eru¨en¡
0b7a:ed 4b 02 0c        ld      bc,(ddw51)  ; C=adresa portu syst. ‡asova‡e
0b7e:3a 03 0c           ld      a,(ddb26)   ; ‡asovac¡ konstanta ‡asova‡e
0b81:ed 79              out     (c),a       ; nastaven¡ ‡asovac¡ konstanty-20 Hz
0b83:3e 80              ld      a,80h       ; p©¡znak syst. hodin
0b85:32 01 18           ld      (dtb16),a   ; p©¡znaky syst. hodin
0b88:fb                 ei                  ; povolen¡ p©eru¨en¡
0b89:dd 21 98 0b        ld      ix,0b98h    ; tabulka parametr– - 17h (0bafh)
0b8d:cd 46 04   lab199: call    lab94       ; nastaven¡ programu interpreteru
0b90:21 00 00           ld      hl,0
0b93:22 37 18           ld      (ddw20),hl
0b96:22 3d 18           ld      (ddw21),hl
0b99:2a 12 0c           ld      hl,(ddw22)  ; = 000bh
0b9c:22 39 18           ld      (ddw23),hl
0b9f:2a 14 0c           ld      hl,(ddw24)  ; = 000ah
0ba2:22 3b 18           ld      (ddw25),hl
0ba5:dd 21 a4 0b        ld      ix,0ba4h
0ba9:cd 46 04           call    lab94       ; nastaven¡ programu interpreteru
0bac:c3 a2 02           jp      poprg       ; n vrat registr–

0baf:                   db   0b3h,0bh,28h,18h,0ffh,0ffh,0bfh,0bh,8,0,0,0
0bbb:                   db   37h,18h,2ah
0bbe:18 cd              db   18h
; ......................................................

                                          ;* cyklick‚ testov n¡ pamˆt¡

0bbf:cd b3 03   lab200: call    syst7
0bc2:cd ec 03           call    lab135      ; kontr.sou‡et tab.vektor– p©eru¨en¡
0bc5:ed 4b 2c 18        ld      bc,(ddw19)  ; kontr.souc.tab.vekt.preruseni = 3d04h
0bc9:a7                 and     a
0bca:ed 42              sbc     hl,bc       ; kontrola kontroln¡ho sou‡tu
0bcc:3e 81              ld      a,81h       ; k¢d chyby 81h
0bce:c2 1b 03           jp      nz,syst2    ; hl ¨en¡ chyby ERROR(S)81
0bd1:cd c3 03           call    syst8
0bd4:21 dc 0b           ld      hl,dtb72    ; adresa pro pokra‡ov n¡ v testu
0bd7:e5                 push    hl          ; adresa pro pokra‡ov n¡ -> stack
0bd8:2a 0e 0c           ld      hl,(ddw4)   ; adresa testu pamˆti ROM
0bdb:e9                 jp      (hl)        ; skok test pamˆt¡

0bdc:c3 bf 0b   dtb72:  jp      lab200      ; pokra‡ov n¡ v testu pamˆt¡
; ......................................................
0bdf:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
0be8:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
0bf1:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
0bfa:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh





0c00:           ddb23:  db      10h
0c01:           ddb16:  db      14h
0c02:           ddw51:  db      3           ; adresa ‡¡ta‡e syst‚mov˜ch hodin
0c03:           ddb26:  db      0f0h        ; ‡asovac¡ konstanta syst. ‡asova‡e
0c04:           ddb25:  db      3
0c05:           ddw18:  dw      1880h       ; za‡ tek tabulky vektor– p©eru¨en¡
0c07:           ddb68:  db      20          ; po‡et vektor– p©eru¨en¡
0c08:           ddw26:  dw      0c23h       ; adresa chyby p©eru¨en¡ ERROR(S)03
0c0a:           ddw15:  dw      2300h       ; = 2300h
0c0c:           ddw50:  dw      0800h       ; = 0800h
0c0e:           ddw4:   dw      13deh       ; adresa testu pamˆti ROM
0c10:           ddw1:   dw      6befh       ; adresa chybov‚ho hl ¨en¡ (=6bef)
0c12:           ddw22:  dw      000bh       ; = 000bh
0c14:           ddw24:  dw      000ah       ; = 000ah
0c16:           ddw13:  dw      1444h       ; = 1444h

0c18:21 20 0c   lab119: ld      hl,dtb41
0c1b:e5                 push    hl
0c1c:2a 16 0c   lab198: ld      hl,(ddw13)  ; = 1444h
0c1f:e9                 jp      (hl)
; ......................................................
                                            ; chyba ERROR(S)03

0c20:cd 2a 02   dtb41:  call    vekt15      ; inicializace ukazatele registr–
0c23:cd 2b 0c           call    lab6        ; reti
0c26:3e 03              ld      a,3         ; chyba ERROR(S)03
0c28:c3 03 02           jp      vekt2       ; error

0c2b:ed 4d      lab6:                       ; instrukce RETI
                        reti    
; ......................................................

; *****************************************************************************
;
;                         Inicializace BDT
;
; *****************************************************************************

0c2d:ed 5e      init:                     ;* inicializace BDT
                        im      2           ; m¢d p©eru¨en¡ 2 (s vektorem p©er.)
0c2f:af                 xor     a           ; p©¡znak - nen¡ v˜stup na displej
0c30:32 f4 18           ld      (ddb1),a    ; p©¡znak testu RAM (10h)
                                          ;* test pamˆti RAM
0c33:21 00 18           ld      hl,RAMTOP   ; za‡ tek pamˆti RAM
0c36:01 00 28           ld      bc,2800h    ; d‚lka pamˆti RAM
0c39:56         lab5:   ld      d,(hl)      ; £schova p–vodn¡ho obsahu adresy
0c3a:36 55              ld      (hl),55h    ; testovac¡ vzorek 1
0c3c:5e                 ld      e,(hl)      ; zpˆtn‚ p©e‡ten¡ vzorku 1
0c3d:36 aa              ld      (hl),0aah   ; textovac¡ vzorek 2
0c3f:7e                 ld      a,(hl)      ; zpˆtn‚ p©e‡ten¡ vzorku 2
0c40:2f                 cpl                 ; NOT 0aah -> 55h
0c41:bb                 cp      e           ; porovn n¡ shody vzrok–
0c42:c2 87 0c           jp      nz,lab2     ; nen¡ shoda - chyba pamˆti RAM
0c45:7a                 ld      a,d         ; p–vodn¡ obsah adresy
0c46:72                 ld      (hl),d      ; navr cen¡ p–vodn¡ho obsahu adresy
0c47:ed a1              cpi                 ; je bajt ulo‘en spr vnˆ ?
0c49:c2 87 0c           jp      nz,lab2     ; nen¡ shoda - chyba RAM sys.er.02
0c4c:ea 39 0c           jp      pe,lab5     ; BC nen¡ je¨tˆ 0 - dal¨¡ adresa
                                          ;* ukon‡en¡ v¨ech po‘adavk– p©eru¨en¡
0c4f:cd 2b 0c           call    lab6        ; proveden¡ instrukce reti
                                          ;* vymaz n¡ textov‚ho bufferu
0c52:21 0e 19           ld      hl,txtbuf   ; textov˜ buffer
0c55:11 0f 19           ld      de,txtbuf+1 ; text.buffer + 1
0c58:01 0f 00           ld      bc,0fh      ; d‚lka textov‚ho bufferu - 1
0c5b:36 20              ld      (hl)," "    ; ulo‘en¡ mezery
0c5d:ed b0              ldir                ; vymaz n¡ cel‚ho textov‚ho bufferu
0c5f:cd 43 0e           call    tsktxt      ; v˜stup textu na displej
0c62:21 f4 18           ld      hl,ddb1     ; p©¡znak testu RAM (10h)
0c65:cb a6              res     4,(hl)      ; zru¨en¡ p©¡znaku testu RAM
                                          ;* test kl vesnice na zkrat
0c67:11 00 00           ld      de,0        ; ‡¡ta‡ test– kl vesnice
0c6a:db 09      lab27:  in      a,(9)       ; vstup dat z kl vesnice
0c6c:e6 1f              and     1fh         ; data jednoho © dku z kl vesnice
0c6e:fe 1f              cp      1fh         ; je stisknuta kl vesa ?
0c70:ca 78 0c           jp      z,lab26     ; nen¡ ‘ dn  kl vesa - OK
0c73:3e 04              ld      a,4         ; chyba ERR(S)04 - chyba kl vesnice
0c75:c3 03 02           jp      vekt2       ; chybov‚ hl ¨en¡ ERROR(S) 04
0c78:1b         lab26:  dec     de          ; sn¡‘en¡ ‡¡ta‡e pokus–
0c79:7b                 ld      a,e         ; jsou ji‘ v¨echny testy ?
0c7a:b2                 or      d
0c7b:c2 6a 0c           jp      nz,lab27    ; ‡¡ta‡ je¨tˆ nen¡ = 0 - dal¨¡ test
0c7e:00                 nop                 ; rezerva
0c7f:00                 nop     
0c80:00                 nop     
0c81:00                 nop     
0c82:00                 nop     
0c83:00                 nop     
0c84:c3 bf 0c           jp      lab28       ; pokra‡ov n¡ v inicializaci BDT

0c87:3e 02      lab2:                       ; chyba RAM ERROR(S)02
                        ld      a,2         ; k¢d chyby ERROR(S)02
0c89:c3 03 02           jp      vekt2       ; chybov‚ hl ¨en¡ ERROR(S)02
; ......................................................

                                          ;* p©enos dat za CALL
0c8c:e3         lab203: ex      (sp),hl     ; HL <- n vr. adresa, ulo‘. HL
0c8d:d5                 push    de          ; £schova DE
0c8e:c5                 push    bc          ; £schova BC
0c8f:f5                 push    af          ; £schova AF
0c90:5e                 ld      e,(hl)      ; DE <- 1.a 2. bajt za CALL
0c91:23                 inc     hl
0c92:56                 ld      d,(hl)      ; DE <- c¡lov  adresa k p©enosu
0c93:23                 inc     hl          ; C <- 3. bajt za CALL
0c94:4e                 ld      c,(hl)
0c95:06 00              ld      b,0         ; BC <- po‡et bajt– k p©enosu
0c97:03                 inc     bc
0c98:03                 inc     bc          ; BC <- po‡et bajt– + 2
0c99:ed a0              ldi                 ; p©enos 1. bajtu (d‚lka dat)
0c9b:ed a0              ldi                 ; p©enos 2. bajtu
0c9d:e5                 push    hl          ; £schova HL
0c9e:d5                 push    de          ; DE -> stack
0c9f:e1                 pop     hl          ; HL <- DE c¡lov  adresa
0ca0:13                 inc     de
0ca1:13                 inc     de          ; DE <- c¡lov  adresa + 2
0ca2:73                 ld      (hl),e
0ca3:23                 inc     hl
0ca4:72                 ld      (hl),d      ; ulo‘en¡ adresy
0ca5:e1                 pop     hl
0ca6:38 12              jr      c,lab197
0ca8:28 0e              jr      z,lab201
0caa:7e                 ld      a,(hl)
0cab:23                 inc     hl
0cac:e5                 push    hl
0cad:66                 ld      h,(hl)
0cae:6f                 ld      l,a
0caf:ed a0              ldi     
0cb1:ed a0              ldi     
0cb3:e1                 pop     hl
0cb4:23                 inc     hl
0cb5:e2 ba 0c           jp      po,lab197
0cb8:ed b0      lab201: ldir                ; p©enos dat
0cba:f1         lab197: pop     af          ; n vrat AF
0cbb:c1                 pop     bc          ; n vrat BC
0cbc:d1                 pop     de          ; n vrat DE
0cbd:e3                 ex      (sp),hl     ; n vrat HL, n vr. adr. -> stack
0cbe:c9                 ret     
; ......................................................
                                            ; pokra‡ov n¡ v inicializaci BDT
0cbf:21 e5 0c   lab28:  ld      hl,lab301   ; n vratov  adresa pro pokra‡ov n¡
0cc2:e5                 push    hl          ; ulo‘en¡ n vratov‚ adresy
0cc3:2a 0e 0c           ld      hl,(ddw4)   ; adresa testu pamˆti ROM
0cc6:e9                 jp      (hl)        ; kontrola pamˆt¡ ROM a RAM
; ......................................................
0cc7:c3 18 0c   lab118: jp      lab119
; ......................................................

0cca:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
0cd3:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh
0cdc:                   db   0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh,0ffh

                                          ;* inicializace syst‚mu p©eru¨en¡

                lab301:                     ; nastaven¡ tabulky vekt. p©eru¨en¡
0ce5:2a 08 0c           ld      hl,(ddw26)  ; adresa chyby p©eru¨en¡ ERROR(S)03
0ce8:22 80 18           ld      (stack),hl  ; ulo‘en¡ prvn¡ adresy obsluhy p©.
0ceb:21 80 18           ld      hl,tabint   ; za‡ tek tabulky vektor– p©eru¨en¡
0cee:11 82 18           ld      de,tabint+2 ; n sleduj¡c¡ vektor p©eru¨en¡
0cf1:06 00              ld      b,0         ; B <- 0
0cf3:3a 07 0c           ld      a,(ddb68)   ; po‡et vektor– p©eru¨en¡ = 20
0cf6:4f                 ld      c,a         ; po‡et vektor– p©eru¨en¡
0cf7:cb 21              sla     c           ; po‡et vektor– p©eru¨en¡ * 2
0cf9:cb 10              rl      b           ; po‡et vektor– p©eru¨en¡ * 2
0cfb:0b                 dec     bc          ; po‡et vektor– p©eru¨en¡ * 2 - 1
0cfc:ed b0              ldir                ; kopie n vratov˜ch adres
0cfe:3e 18              ld      a,18h       ; adresa vektoru p©eru¨en¡
0d00:ed 47              ld      i,a         ; nastaven¡ vektoru p©eru¨en¡
                                          ;* inicializace ‡¡ta‡e - syst. hodiny
0d02:3e 80              ld      a,80h       ; vektor p©eru¨en¡ pro CTC
0d04:d3 00              out     (0),a       ; nastaven¡ vektoru p©eru¨en¡ CTC
0d06:3e 07              ld      a,7         ; nast. ‡asovac¡ konstanty CTC-2
0d08:d3 02              out     (2),a       ; p©¡kaz nastaven¡ ‡as. konst. CTC-2
0d0a:3e 20              ld      a,20h       ; ‡asovac¡ konstanta (4,8 kHz)
0d0c:d3 02              out     (2),a       ; nastaven¡ ‡asovac¡ konstanty
0d0e:3e c7              ld      a,0c7h      ; nastaven¡ CTC-3
0d10:d3 03              out     (3),a       ; nastaven¡ CTC-3
0d12:c3 00 02           jp      vekt1       ; hork˜ start syst‚mu
; ......................................................
                                          ;* obsluha nemaskov. p©eru¨en¡ NMI
                                          ;* (provede se p©i v˜padku nap jen¡)
0d15:f5         lab120: push    af          ; £schova AF
0d16:e5                 push    hl          ; £schova HL
0d17:21 00 18           ld      hl,RAMTOP   ; k¢d chyby syst‚mu
0d1a:7e                 ld      a,(hl)      ; k¢d chyby syst‚mu
0d1b:fe f3              cp      0f3h        ; nastalo ji‘ p©eru¨en¡ NMI ?
0d1d:e1                 pop     hl          ; n vrat HL
0d1e:ca 95 0d           jp      z,lab121    ; p©eru¨en¡ NMI bylo ji‘ obslou‘eno
0d21:f1                 pop     af          ; n vrat AF
0d22:af                 xor     a           ; A <- 0
0d23:ed 4f              ld      r,a         ; R <- 0 (vynulov n¡ R)
0d25:db 0d              in      a,(0dh)     ; ‡ten¡ adresy BDT
0d27:cb bf              res     7,a         ; nastaven¡ na adresu 127 a n¡‘e
0d29:f6 40              or      40h         ; nastaven¡ na adresu 64 a v˜¨e
0d2b:32 bc 22           ld      (ddb24),a   ; adresa BDT
0d2e:21 20 3f           ld      hl,dtb42    ; z sobn¡k £schovy dat
0d31:01 d0 00           ld      bc,0d0h     ; d‚lka z sobn¡ku
0d34:cd fd 03           call    lab122      ; kontr.sou‡et pamˆti -> HL
0d37:22 ba 22           ld      (ddw14),hl  ; kontr. sou‡et z sobn¡ku dat 3f20h
0d3a:3e 03              ld      a,3         ; p©¡kaz pro zastaven¡ ‡¡ta‡–
0d3c:d3 00              out     (0),a       ; zastaven¡ ‡¡ta‡e 0
0d3e:d3 01              out     (1),a       ; zastaven¡ ‡¡ta‡e 1
0d40:d3 02              out     (2),a       ; zastaven¡ ‡¡ta‡e 2
0d42:d3 03              out     (3),a       ; zastaven¡ ‡¡ta‡e 3
0d44:d3 0b              out     (0bh),a     ; z kaz p©eru¨en¡ od PIO4-B
0d46:d3 0f              out     (0fh),a     ; z kaz p©eru¨en¡ od PIO3-B
0d48:d3 0f              out     (0fh),a     ; z kaz p©eru¨en¡ od PIO3-B
0d4a:3e 18              ld      a,18h       ; p©¡kaz pro RESET obvod– SIO
0d4c:d3 05              out     (5),a       ; RESET obvodu SIO(STE)-A
0d4e:d3 07              out     (7),a       ; RESET obvodu SIO(STE)-B
0d50:d3 19              out     (19h),a     ; RESET obvodu SIO(ZEL)-A
0d52:d3 1b              out     (1bh),a     ; RESET obvodu SIO(ZEL)-B
0d54:cd 2b 0c           call    lab6        ; proveden¡ instrukce reti
0d57:e1                 pop     hl          ; zru¨en¡ n vratov‚ adresy
0d58:21 5e 0d           ld      hl,dtb44    ; nov  adresa programu
0d5b:e5                 push    hl          ; nov  adresa programu
0d5c:ed 45              retn                ; skok do obsluhy NMI
                                          ;* ‡ek n¡ na v˜padek nap jen¡
0d5e:3e 18      dtb44:  ld      a,18h       ; adresa tabulky vektor– p©eru¨en¡
0d60:ed 47              ld      i,a         ; nastaven¡ tabulky vektor– p©eru¨en¡
0d62:ed 5e              im      2           ; m¢d p©eru¨en¡ 2
0d64:3e 80              ld      a,80h       ; vektor p©eru¨en¡ pro CTC
0d66:d3 00              out     (0),a       ; nastaven¡ vektoru p©eru¨en¡ CTC
0d68:3e 07              ld      a,7         ; nastaven¡ ‡¡ta‡e CTC-2
0d6a:d3 02              out     (2),a       ; nastaven¡ ‡¡ta‡e CTC-2
0d6c:3e 20              ld      a,20h       ; ‡asov  konstanta ‡¡ta‡e CTC-2
0d6e:d3 02              out     (2),a       ; ‡asov  konstanta ‡¡ta‡e CTC-2
0d70:3e c7              ld      a,0c7h      ; nastaven¡ ‡¡ta‡e CTC-3
0d72:d3 03              out     (3),a       ; nastaven¡ ‡¡ta‡e CTC-3
0d74:3e f0              ld      a,0f0h      ; ‡asov  konstanta ‡¡ta‡e CTC-3
0d76:d3 03              out     (3),a       ; ‡asov  konstanta ‡¡ta‡e CTC-3
0d78:21 80 0d           ld      hl,dtb6     ; adresa pro p©eru¨en¡ od hodin
0d7b:22 86 18           ld      (ddw27),hl  ; nastaven¡ adresy obsluhy od CTC-3
0d7e:fb                 ei                  ; povolen¡ p©eru¨en¡
0d7f:76                 halt                ; ‡ek n¡ na p©eru¨.‡asov.nebo RESET
                                          ;* p©eru¨en¡ od ‡asova‡e (po 20 ms)
0d80:e1         dtb6:   pop     hl          ; zru¨en¡ n vratov‚ adresy
0d81:3e 03              ld      a,3         ; z kaz p©eru¨en¡ od ‡asova‡e
0d83:d3 02              out     (2),a       ; z kaz p©eru¨en¡ od ‡asova‡e
0d85:d3 03              out     (3),a       ; z kaz p©eru¨en¡ od ‡asova‡e
0d87:3e ff              ld      a,0ffh      ; nastaven¡ REFRESH registru
0d89:ed 4f              ld      r,a         ; nastaven¡ REFRESH registru
0d8b:3e 00              ld      a,0         ; nastaven¡ REFRESH registru
0d8d:ed 4f              ld      r,a         ; nastaven¡ REFRESH registru
0d8f:21 00 00           ld      hl,0        ; nov  adresa startu BDT
0d92:e5                 push    hl
0d93:ed 4d              reti                ; skok na startovac¡ adresu BDT
                                          ;* n vrat z obsluhy NMI
0d95:f1         lab121: pop     af          ; n vrat registru AF
0d96:ed 45              retn                ; n vrat z obsluhy NMI
; ......................................................
0d98:           dtb11:                      ; zpˆtn  inic. PIO1-A (displej)
                        db      0cfh        ; m¢d - bitov˜ vstup/v˜stup
                        db      0fh         ; maska - bity 0 a‘ 3 jako vstup
                        db      7           ; z kaz p©eru¨en¡ od kan lu
0d9b:           setdis:                     ; tabulka pro inic. PIO1-A (displej)
                        db      0cfh        ; m¢d - bitov˜ vstup/v˜stup
                        db      0           ; maska - v¨echny bity jako v˜stup
                        db      7           ; z kaz p©eru¨en¡ od kan lu

0d9e:37         lab212: scf
0d9f:cd 8c 0c           call    lab203      ; p©enos dat za CALL
0da2                    dw      1905h       ; c¡lov  adresa 1905h
0da4:15                 db      15h         ; po‡et bajt–
0da5:00                 db      0
0da6:01 b0 18           ld      bc,dtb28
0da9:11 05 19           ld      de,dtb15
0dac:21 00 00           ld      hl,0
0daf:cd 36 02           call    vekt19
0db2:3a 0b 19           ld      a,(ddb27)   ; ovl d n¡ v˜stupn¡ch za©¡zen¡
0db5:0f                 rrca                ; bit 0
0db6:30 05              jr      nc,lab205   ; bit 0=0
0db8:cd f3 0d           call    lab221      ; bit 0=1: vypnut¡ zvukov‚ho v˜stupu
0dbb:18 26              jr      lab210
; ......................................................
0dbd:0f         lab205: rrca                ; bit 1
0dbe:30 05              jr      nc,lab206   ; bit 1=0
0dc0:cd 02 0e           call    lab220      ; bit 1=1: zapnut¡ zvukov‚ho v˜stupu
0dc3:18 1e              jr      lab210
; ......................................................
0dc5:0f         lab206: rrca                ; bit 2
0dc6:30 05              jr      nc,lab207   ; bit 2=0
0dc8:cd 11 0e           call    lab219      ; bit 2=1: zmˆna zobrazen‚ho obrazu
0dcb:18 16              jr      lab210
; ......................................................
0dcd:0f         lab207: rrca                ; bit 3
0dce:30 05              jr      nc,lab208   ; bit 3=0
0dd0:cd 2f 0e           call    lab218      ; bit 3=1: zobraz.textu aktiv.obrazu
0dd3:18 0e              jr      lab210
; ......................................................
0dd5:0f         lab208: rrca                ; bit 4
0dd6:30 05              jr      nc,lab209   ; bit 4=0
0dd8:cd 20 0e           call    lab216      ; bit 4=1: zobrazen¡ textu obrazu 0
0ddb:18 06              jr      lab210
; ......................................................
0ddd:0f         lab209: rrca                ; bit 5
0dde:30 03              jr      nc,lab210   ; bit 5=0
0de0:cd 24 0e           call    lab213      ; bit 5=1: zobrazen¡ textu obrazu 1
0de3:00         lab210: nop     
0de4:01 09 19           ld      bc,dtb21
0de7:11 00 00           ld      de,0
0dea:21 00 00           ld      hl,0
0ded:cd 2d 02           call    vekt16
0df0:c3 9e 0d           jp      lab212
; ......................................................
                                          ;* vypnut¡ zvukov‚ho v˜stupu
0df3:3a 32 19   lab221: ld      a,(btpi1a)  ; v˜stupn¡ bajt na PIO1-A (displej)
0df6:e6 7f              and     7fh         ; vypnut¡ p©¡znaku v˜stupu HUPE
0df8:32 32 19           ld      (btpi1a),a  ; v˜stupn¡ bajt na PIO1-A (displej)
0dfb:db 08              in      a,(8)       ; ‡ten¡ stavu v˜stupu na PIO1-A
0dfd:e6 7f              and     7fh         ; vypnut¡ v˜stupu na houka‡ku
0dff:d3 08              out     (8),a       ; vypnut¡ zvukov‚ho v˜stupu
0e01:c9                 ret
; ......................................................
                                          ;* zapnut¡ zvukov‚ho v˜stupu
0e02:3a 32 19   lab220: ld      a,(btpi1a)  ; v˜stupn¡ bajt na PIO1-A (displej)
0e05:f6 80              or      80h         ; zapnut¡ zvukov‚ho v˜stupu
0e07:32 32 19           ld      (btpi1a),a  ; v˜stupn¡ bajt na PIO1-A (displej)
0e0a:db 08              in      a,(8)       ; ‡ten¡ stavu v˜stupu na PIO1-A
0e0c:f6 80              or      80h         ; zapnut¡ v˜stupu na houka‡ku
0e0e:d3 08              out     (8),a       ; zapnut¡ zvukov‚ho v˜stupu
0e10:c9                 ret     
; ......................................................
                                          ;* zmˆna zobrazen‚ho obrazu
0e11:3a 32 19   lab219: ld      a,(btpi1a)  ; v˜stupn¡ bajt na PIO1-A (displej)
0e14:ee 40              xor     40h         ; zmˆna obrazu
0e16:32 32 19           ld      (btpi1a),a  ; v˜stupn¡ bajt na PIO1-A (displej)
0e19:db 08              in      a,(8)       ; ‡ten¡ stavu v˜stupu na PIO1-A
0e1b:ee 40              xor     40h         ; zmˆna obrazu
0e1d:d3 08              out     (8),a       ; zmˆna obrazu
0e1f:c9                 ret     
; ......................................................
                                          ;* zobrazen¡ textu obrazu 0
0e20:06 00      lab216: ld      b,0
0e22:18 02              jr      lab217
; ......................................................
                                          ;* v˜stup textu obrazu 1
0e24:06 40      lab213: ld      b,40h
0e26:3a 32 19   lab217: ld      a,(btpi1a)  ; v˜stupn¡ bajt na PIO1-A (displej)
0e29:e6 bf              and     0bfh        ; zru¨en¡ p©ep¡na‡e obrazu
0e2b:b0                 or      b           ; nastaven¡ p©ep¡na‡e obrazu
0e2c:32 32 19           ld      (btpi1a),a  ; v˜stupn¡ bajt na PIO1-A (displej)
0e2f:3a f4 18   lab218: ld      a,(ddb1)    ; p©¡znak testu RAM (10h)
0e32:cb 67              bit     4,a
0e34:20 39              jr      nz,lab214
0e36:d5                 push    de          ; £schova DE
0e37:11 dd 0f           ld      de,dtb22    ; obsluha p©eru¨en¡ 4 - kl vesnice
0e3a:e5                 push    hl          ; £schova HL
0e3b:21 04 00           ld      hl,4        ; ‡¡slo vektoru = 4
0e3e:cd 0f 02           call    vekt6       ; nastaven¡ adr. vektoru L na adr.DE
0e41:e1                 pop     hl          ; n vrat HL
0e42:d1                 pop     de          ; n vrat DE
                                            ; pokra‡uje se v˜stupem na displej
; -----------------------------------------------------------------------------
;                    Zobrazen¡ textov‚ho bufferu na displeji
; -----------------------------------------------------------------------------

                tsktxt:                   ;* v˜stup textu na displej
0e43:21 ec 10           ld      hl,tabznk   ; tabulka gener toru znak–
0e46:22 38 19           ld      (adtbzn),hl ; adresa tabulky znak–
0e49:21 d8 0f           ld      hl,setklv   ; tabulka pro inicializaci PIO1-B
0e4c:0e 0b              ld      c,0bh       ; ©¡zen¡ PIO1-B - vstup z kl vesnice
0e4e:06 05              ld      b,5         ; po‡et inicializa‡n¡ch bajt–
0e50:ed b3              otir                ; nastaven¡ PIO1-B - kl vesnice
0e52:af                 xor     a           ; A <- 0
0e53:32 33 19           ld      (ddb2),a    ; = 0
0e56:32 34 19           ld      (ddb3),a    ; = 0
0e59:32 00 19           ld      (ddb4),a    ; = 0 (0e59h) £schova © dku kl ves
0e5c:32 0c 19           ld      (ddb5),a    ; = 0
0e5f:32 0d 19           ld      (ddb6),a    ; = 0
0e62:3e 9f              ld      a,9fh       ; v˜stupn¡ bajt na PIO1-A (z pis)
0e64:32 32 19           ld      (btpi1a),a  ; v˜stupn¡ bajt na PIO1-A (displej)
0e67:32 ff 18           ld      (ddb8),a    ; v˜stupn¡ bajt na PIO1-A (displej)
0e6a:21 f4 18           ld      hl,ddb1     ; p©¡znak testu RAM (10h)
0e6d:cb e6              set     4,(hl)      ; nastav. p©¡znak v˜stupu na displej
0e6f:3a 0c 19   lab214: ld      a,(ddb5)    ; = 0
0e72:32 35 19           ld      (ddb9),a    ; = 0
0e75:3a 0d 19           ld      a,(ddb6)    ; = 0
0e78:4f                 ld      c,a
0e79:07                 rlca    
0e7a:07                 rlca    
0e7b:47                 ld      b,a
0e7c:e6 03              and     3
0e7e:32 37 19           ld      (ddb10),a   ; = 0
0e81:78                 ld      a,b
0e82:e6 c0              and     0c0h
0e84:47                 ld      b,a
0e85:79                 ld      a,c
0e86:e6 0f              and     0fh
0e88:b0                 or      b
0e89:32 36 19           ld      (ddb11),a   ; = 0
0e8c:3a 32 19           ld      a,(btpi1a)  ; v˜stupn¡ bajt na PIO1-A (displej)
0e8f:d3 08              out     (8),a       ; zapnut¡ z pisu na displej
0e91:21 9b 0d           ld      hl,setdis   ; tabulka pro inicializaci PIO1-A
0e94:06 03              ld      b,3         ; po‡et znak– pro inicializaci
0e96:0e 0a              ld      c,0ah       ; ©¡zen¡ kan lu PIO1-A (displej)
0e98:ed b3              otir                ; inicializace PIO1-A (displej)
0e9a:af                 xor     a           ; A <- 0
0e9b:32 2e 19           ld      (citrad),a  ; ‡¡ta‡ zobrazen˜ch © dk–
0e9e:06 20              ld      b,20h       ; po‡et bajt– linky k v˜stupu
0ea0:3a 32 19           ld      a,(btpi1a)  ; v˜stupn¡ bajt na PIO1-A (displej)
0ea3:cb 8f              res     1,a         ;
0ea5:cb af      lab8:                       ; vymaz n¡ spodn¡ho © dku
                        res     5,a         ; generov n¡ sign lu TAKT
0ea7:d3 08              out     (8),a       ; vysl n¡ sign lu TAKT
0ea9:cb ef              set     5,a         ; n vrat sign lu TAKT
0eab:d3 08              out     (8),a       ; n vrat sign lu TAKT
0ead:10 f6              djnz    lab8        ; dal¨¡ znak

0eaf:2a 35 19           ld      hl,(ddb9)   ; = 0
0eb2:22 2f 19           ld      (ddw3),hl   ; = 0
0eb5:3a 37 19           ld      a,(ddb10)   ; = 0
0eb8:32 31 19           ld      (ddb13),a   ; = 0
                lab17:                      ; zobrazen¡ 1 linky textu
0ebb:06 10              ld      b,10h       ; po‡et znak– na v˜stup = 16
0ebd:3a 2e 19           ld      a,(citrad)  ; ‡¡ta‡ zobrazen˜ch © dk–
0ec0:4f                 ld      c,a         ; ‡¡ta‡ © dk–
0ec1:fd 21 0e 19        ld      iy,txtbuf   ; textov˜ buffer (16 znak–)
0ec5:dd 2a 38 19 lab11: ld      ix,(adtbzn) ; adresa tabulky znak–
0ec9:fd 7e 00           ld      a,(iy+0)    ; znak k v˜stupu na displej
0ecc:3d                 dec     a           ; znak - 1
0ecd:dd be fe           cp      (ix-2)      ; kontrola horn¡ hranice znaku
0ed0:30 06              jr      nc,lab9     ; je vˆt¨¡ - nezobraz¡ se
0ed2:3c                 inc     a           ; znak
0ed3:dd 96 ff           sub     (ix-1)      ; kontrola doln¡ hranice znaku
0ed6:30 03              jr      nc,lab21    ; je vˆt¨¡ - bude zobrazen
0ed8:af         lab9:   xor     a           ; n hradn¡ font - nezobraz¡ se
0ed9:18 1b              jr      lab10       ; zobrazen¡ znaku
0edb:16 00      lab21:  ld      d,0         ; D <- 0
0edd:5f                 ld      e,a         ; E <- znak relativnˆ v tabulce
0ede:dd 19              add     ix,de       ; tabulka + znak
0ee0:eb                 ex      de,hl       ; HL <- znak
0ee1:29                 add     hl,hl       ; znak * 2
0ee2:29                 add     hl,hl       ; znak * 4
0ee3:eb                 ex      de,hl       ; DE <- znak * 4
0ee4:dd 19              add     ix,de       ; tabulka + znak*5 (adresa znaku)
0ee6:79                 ld      a,c         ; ‡¡slo zobrazovan‚ linky znaku
0ee7:0f                 rrca                ; =linka/2
0ee8:38 2b              jr      c,lab22     ; je linka 1,5
0eea:0f                 rrca                ; =linka/4
0eeb:38 37              jr      c,lab24     ; je linka 2,6
0eed:07                 rlca                ; =linka 0,4,8/2
0eee:5f                 ld      e,a         ; =linka 0,4,8/2
0eef:16 00              ld      d,0         ; D <- 0
0ef1:dd 19              add     ix,de       ; adresa linek 0,2 v tabulce
0ef3:dd 7e 00           ld      a,(ix+0)    ; bajt linek 0,2
0ef6:e6 1f      lab10:  and     1fh         ; ponech  pouze 5 bit– linky
0ef8:fd 77 10           ld      (iy+10h),a  ; ulo‘. do bufferu linky pro v˜stup
0efb:fd 23              inc     iy          ; dal¨¡ znak k dek¢dov n¡
0efd:10 c6              djnz    lab11       ; dek¢dov n¡ linky dal¨¡ho znaku

0eff:0c         lab12:  inc     c           ; zv˜¨en¡ ukazatele linky
0f00:79                 ld      a,c         ; zobrazen  linka
0f01:e6 03              and     3           ; linka
0f03:fe 03              cp      3           ; je n sobek 3 ?
0f05:28 f8              jr      z,lab12     ; je n sobek 3 - p©esko‡en¡ ‡¡sla
0f07:79                 ld      a,c         ; linka
0f08:fe 09              cp      9           ; jsou ji‘ v¨echny linky ?
0f0a:32 2e 19           ld      (citrad),a  ; ‡¡ta‡ zobrazen‚ linky
0f0d:20 2d              jr      nz,lab13    ; nejsou je¨tˆ v¨echny linky
0f0f:af                 xor     a
0f10:32 2e 19           ld      (citrad),a  ; citac zobrazenych radku
0f13:18 27              jr      lab13       ; zobrazeni sloupcu textu
; ......................................................
                lab22:                      ; je linka 1,5
0f15:0f                 rrca                ; linka 1,5/4
0f16:0f                 rrca                ; linka 1,5/8
0f17:dd 7e 01           ld      a,(ix+1)    ; bajt 1 znaku (pro 1.linku)
0f1a:30 03              jr      nc,lab23    ; je linka 1
0f1c:dd 7e 03           ld      a,(ix+3)    ; bajt 3 znaku (pro 5.linku)
0f1f:0f         lab23:  rrca                ; (rotace o 3 bity vpravo)
0f20:0f                 rrca
0f21:0f                 rrca                ; zde jsou p©ipraveny bity
0f22:18 d2              jr      lab10       ; ulo‘en¡ © dku do bufferu
; .....................................................
0f24:0f         lab24:                      ; je linka 2,6
                        rrca                ; linka 2,6/8
0f25:30 04              jr      nc,lab25    ; je linka 2
0f27:dd 23              inc     ix          ; adresa + 1
0f29:dd 23              inc     ix          ; adresa + 2
0f2b:dd 6e 01   lab25:  ld      l,(ix+1)    ; bajt 1
0f2e:dd 66 02           ld      h,(ix+2)    ; bajt 2
0f31:cb 14              rl      h
0f33:cb 15              rl      l
0f35:cb 14              rl      h
0f37:cb 15              rl      l
0f39:7d                 ld      a,l         ; bajt linky 2,6
0f3a:18 ba              jr      lab10       ; ulo‘en¡ © dku do bufferu
; ......................................................
                lab13:                      ; zobrazen¡ linky textu
0f3c:21 1e 19           ld      hl,slpbuf   ; buffer linky pro v˜stup na displej
0f3f:06 10              ld      b,10h       ; po‡et linek k v˜stupu
0f41:0e 08              ld      c,8         ; adresa PIO1-A (displej)
0f43:3a 32 19   lab16:  ld      a,(btpi1a)  ; v˜stupn¡ bajt na PIO1-A (displej)
0f46:cb 66              bit     4,(hl)      ; je nastaven bit 5 znaku ?
0f48:28 02              jr      z,lab14     ; nen¡ nastaven bit 5 znaku
0f4a:cb 87              res     0,a         ; nastaven¡ indikace bitu 5 znaku
0f4c:57         lab14:  ld      d,a         ; £schova linky k v˜stupu
0f4d:78                 ld      a,b         ; ‡¡ta‡ linek
0f4e:fe 10              cp      10h         ; je prvn¡ linka ?
0f50:20 18              jr      nz,lab15    ; nen¡ prvn¡ linka
                                            ; p©i prvn¡ lince se nastav¡ LED
0f52:e5                 push    hl          ; £schova HL
0f53:21 2f 19           ld      hl,ddw3     ; nastaven¡ LED
0f56:cb 46              bit     0,(hl)      ; m  b˜t rozsv¡cena LED ?
0f58:28 02              jr      z,lab18     ; LED nen¡ rozsv¡cena
0f5a:cb 9a              res     3,d         ; nastaven¡ (rozsv¡cen¡) LED X3
0f5c:cb 76      lab18:  bit     6,(hl)      ; m  b˜t rozsv¡cena LED ?
0f5e:28 02              jr      z,lab19     ; LED nen¡ rozsv¡cena
0f60:cb 92              res     2,d         ; nastaven¡ rozv¡cen¡ LED
0f62:23         lab19:  inc     hl          ; druh˜ bajt LED
0f63:cb 66              bit     4,(hl)      ; m  b˜t rozsv¡cena LED ?
0f65:28 02              jr      z,lab20     ; LED nen¡ rozsv¡cena
0f67:cb 8a              res     1,d         ; nastaven¡ (rozsv¡cen¡) LED
0f69:e1         lab20:  pop     hl          ; n vrat HL

0f6a:7a         lab15:  ld      a,d         ; prvn¡ ‡ st linky
0f6b:ed 79              out     (c),a       ; v˜stup prvn¡ ‡ sti linky
0f6d:cb ef              set     5,a         ; nastaven¡ sign lu TAKT
0f6f:ed 79              out     (c),a       ; nastaven¡ sign lu TAKT (z pis dat)
0f71:e6 d0              and     0d0h        ; ukon‡en¡ sign lu TAKT
0f73:57                 ld      d,a         ; £schova bajtu k v˜stupu
0f74:7e                 ld      a,(hl)      ; linka k v˜stupu
0f75:e6 0f              and     0fh         ; spodn¡ ‡ st linky k v˜stupu
0f77:ee 0f              xor     0fh         ; inverze bit–
0f79:b2                 or      d           ; n vrat ©¡dic¡ch sign l–
0f7a:ed 79              out     (c),a       ; z pis druh‚ ‡ sti linky
0f7c:cb ef              set     5,a         ; nastaven¡ sign lu TAKT
0f7e:ed 79              out     (c),a       ; nastaven¡ sign lu TAKT (z pis dat)
0f80:23                 inc     hl          ; adresa linky dal¨¡ho znaku
0f81:10 c0              djnz    lab16       ; zobrazen¡ linky dal¨¡ho znaku
0f83:3a 2e 19           ld      a,(citrad)  ; ‡¡ta‡ zobrazen˜ch © dk–
0f86:fe 01              cp      1           ; je linka 1 ?
0f88:ca bb 0e           jp      z,lab17     ; je linka 1 - dal¨¡ linka
0f8b:21 31 19           ld      hl,ddb13    ; = 0
0f8e:cb 3e              srl     (hl)
0f90:2b                 dec     hl
0f91:cb 1e              rr      (hl)
0f93:2b                 dec     hl
0f94:cb 1e              rr      (hl)
0f96:3a 2e 19           ld      a,(citrad)  ; ‡¡ta‡ zobrazen˜ch © dk–
0f99:a7                 and     a
0f9a:c2 bb 0e           jp      nz,lab17    ; nen¡ je¨tˆ © dek 0
0f9d:21 98 0d           ld      hl,dtb11    ; tabulka zpˆtn‚ inic. PIO1-A
0fa0:0e 0a              ld      c,0ah       ; ©¡zen¡ kan lu PIO1-A (displej)
0fa2:06 03              ld      b,3         ; po‡et bajt–
0fa4:ed b3              otir                ; nastaven¡ kan lu PIO1-A (uveden¡
                                            ;  v˜stup– do vysokoimp. stavu)
0fa6:3a 32 19           ld      a,(btpi1a)  ; v˜stupn¡ bajt na PIO1-A (displej)
0fa9:f6 20              or      20h         ; ukon‡en¡ sign lu TAKT
0fab:e6 ef              and     0efh        ; zru¨en¡ sign lu WR
0fad:d3 08              out     (8),a       ; uveden¡ sign l– do klidov‚ho stavu
0faf:c9                 ret     

; ......................................................
0fb0:           dtb75:  db   1eh,2ah,1dh,2dh,33h,1fh,0,0,80h,84h,58h,30h
0fbc:                   db   2eh,59h,0,0,81h,85h,45h,31h,32h,46h,0,0,82h
0fc9:                   db   86h,43h,34h,35h,36h,44h,0,83h,87h,41h,37h,38h
0fd5:                   db   39h,42h,0

0fd8:           setklv:                     ; tabulka pro inicializaci PIO-B
                                            ; pro vstup z kl vesnice (z 0e50h)
                        db      0cfh        ; re‘im - bitov˜ vstup/v˜stup
                        db      0ffh        ; maska - v¨echny bity vstupy
                        db      88h         ; vektor p©eru¨en¡
                        db      97h         ; povolen¡ p©eru¨en¡ od v¨ech bit–
                        db      0e0h        ; maska - p©eru¨en¡ od bit– kl ves

                                          ;* p©eru¨en¡ od kl vesnice

0fdd:f5         dtb22:  push    af          ; £schova AF
0fde:e5                 push    hl          ; £schova HL
0fdf:db 09              in      a,(9)       ; vstup z kl vesnice
0fe1:6f                 ld      l,a         ; data z kl vesnice
0fe2:e6 1f              and     1fh         ; data jednoho © dku
0fe4:fe 1f              cp      1fh         ; je nˆjak  kl vesa ?
0fe6:ca 3d 10           jp      z,lab222    ; nen¡ ‘ dn  kl vesa - n vrat
0fe9:7d                 ld      a,l         ; stisknut‚ kl vesy
0fea:21 34 19           ld      hl,ddb3     ; = 0
0fed:cb 4e              bit     1,(hl)
0fef:20 4a              jr      nz,lab223
0ff1:32 00 19           ld      (ddb4),a    ; = 0 (0e59h) £schova © dku kl ves
0ff4:cb ce              set     1,(hl)
0ff6:cb c6              set     0,(hl)
0ff8:fe 4f              cp      4fh         ; je kl vesa A (zru¨en¡) ?
0ffa:28 1f              jr      z,lab224    ; je kl vesa A
0ffc:fe 5d              cp      5dh         ; je kl vesa X (alternat. zru¨en¡) ?
0ffe:20 00              jr      nz,lab227
1000:21 3a 19   lab227: ld      hl,dtb26
1003:fe d7              cp      0d7h        ; je kl vesa D ?
1005:20 04              jr      nz,lab228   ; mem¡ kl vesa D
1007:cb de              set     3,(hl)
1009:18 17              jr      lab230

100b:fe bd      lab228: cp      0bdh        ; je kl vesa Y ?
100d:20 04              jr      nz,lab229   ; nen¡ kl vesa Y
100f:cb ee              set     5,(hl)
1011:18 0f              jr      lab230

1013:fe cf      lab229: cp      0cfh        ; je kl vesa B ?
1015:20 0b              jr      nz,lab230   ; nen¡ kl vesa B
1017:cb f6              set     6,(hl)
1019:18 07              jr      lab230

101b:21 3a 19   lab224: ld      hl,dtb26    ;

101e:7e                 ld      a,(hl)
101f:f6 17              or      17h
1021:77                 ld      (hl),a
1022:21 ce 18   lab230: ld      hl,dtb27
1025:cd 09 02           call    vekt4
1028:db 08              in      a,(8)       ; ‡ten¡ dat z registru videopamˆti
102a:6f                 ld      l,a         ; £schova stavu videopamˆti
102b:e6 7f              and     7fh         ; vypnut¡ zvukov‚ signalizace
102d:d3 08              out     (8),a       ; vypnut¡ zvukov‚ signalizace
102f:f6 80              or      80h         ; zapnut¡ zvukov‚ signalizace
1031:d3 08              out     (8),a       ; zapnut¡ zvukov‚ signalizace
1033:7d                 ld      a,l         ; p–vodn¡ nastaven¡ portu
1034:d3 08              out     (8),a       ; zpˆtn‚ nastaven¡ v˜stupu
1036:e1                 pop     hl          ; n vrat HL
1037:f1                 pop     af          ; n vrat AF
1038:c3 06 02           jp      vekt3

103b:cb c6      lab223: set     0,(hl)
103d:e1         lab222: pop     hl
103e:f1                 pop     af
103f:fb                 ei      
1040:ed 4d              reti    
; ......................................................

1042:01 ce 18   lab233: ld      bc,dtb27
1045:11 00 00           ld      de,0
1048:21 00 00           ld      hl,0
104b:cd 36 02           call    vekt19
104e:3a ff 18           ld      a,(ddb8)    ; v˜stupn¡ bajt na PIO1-A (displej)
1051:a7                 and     a
1052:20 0c              jr      nz,lab231
1054:01 cc 18           ld      bc,dtb25
1057:11 00 00           ld      de,0
105a:21 00 00           ld      hl,0
105d:cd 2d 02           call    vekt16
1060:21 c6 10   lab231: ld      hl,dtb43
1063:cd 39 02           call    vekt20
1066:21 34 19           ld      hl,ddb3     ; = 0
1069:cb 46              bit     0,(hl)
106b:cb 86              res     0,(hl)
106d:20 f1              jr      nz,lab231
106f:cb 8e              res     1,(hl)
1071:18 cf              jr      lab233
; ......................................................
1073:37         lab239: scf     
1074:cd 8c 0c           call    lab203      ; p©enos dat za CALL
1077:f5 18              dw      18f5h       ; c¡lov  adresa
1079:02                 db      2           ; po‡et bajt– k p©enosu
107a:                   db      0,21h       ; data k p©enosu

107c:28 00      lab234: jr      z,lab235
107e:22 01 19   lab235: ld      (ddw28),hl
1081:01 b6 18           ld      bc,dtb29
1084:11 f5 18           ld      de,dtb71
1087:21 00 00           ld      hl,0
108a:cd 36 02           call    vekt19
108d:af                 xor     a
108e:32 ff 18           ld      (ddb8),a    ; v˜stupn¡ bajt na PIO1-A (displej)
1091:01 cc 18           ld      bc,dtb25
1094:11 00 00           ld      de,0
1097:21 01 19           ld      hl,ddw28
109a:cd 36 02           call    vekt19
109d:3a 03 19           ld      a,(ddb28)
10a0:fe 00              cp      0
10a2:ca be 10           jp      z,lab236
10a5:cd c8 10           call    lab240
10a8:37         lab237: scf     
10a9:cd 8c 0c           call    lab203      ; p©enos dat za CALL
10ac:fb 18              dw      18fbh       ; c¡lov  adresa
10ae:01                 db      1           ; po‡et bajt– k p©enosu
10af:                   db      0           ; bajt k p©enosu


10b0:01 f9 18   lab238: ld      bc,dtb73
10b3:11 fb 18           ld      de,dtb74
10b6:21 00 00           ld      hl,0
10b9:cd 2d 02           call    vekt16
10bc:18 b5              jr      lab239
; ......................................................
10be:3e ff      lab236: ld      a,0ffh
10c0:32 ff 18           ld      (ddb8),a    ; v˜stupn¡ bajt na PIO1-A (displej)
10c3:c3 a8 10           jp      lab237
; ......................................................
10c6:           dtb43:  db   2,0
10c8:3a 00 19   lab240: ld      a,(ddb4)    ; = 0 (0e59h) £schova © dku kl ves
10cb:06 05              ld      b,5
10cd:21 b0 0f           ld      hl,dtb75
10d0:11 08 00           ld      de,8
10d3:1f         lab242: rra                 ; bit = 0 ?
10d4:30 03              jr      nc,lab241   ; je konec
10d6:19                 add     hl,de
10d7:10 fa              djnz    lab242
10d9:3a 00 19   lab241: ld      a,(ddb4)    ; = 0 (0e59h) £schova © dku kl ves
10dc:07                 rlca    
10dd:07                 rlca    
10de:07                 rlca
10df:e6 07              and     7           ; vy¨¨¡ 3 bity adresy
10e1:5f                 ld      e,a
10e2:16 00              ld      d,0
10e4:19                 add     hl,de
10e5:7e                 ld      a,(hl)
10e6:32 ff 18           ld      (ddb8),a    ; v˜stupn¡ bajt na PIO1-A (displej)
10e9:c9                 ret     
; ......................................................

10ea:           higznk: db   7fh            ; nejvy¨¨¡ znak v tabulce znak–
10eb:           lowznk: db   10h            ; nejni‘¨¡ znak v tabulce znak–

                tabznk:                     ; tabulka gener toru znak–
                                            ; (ka‘d˜ znak 5 bajt–, organizace

struktura znaku:    7   6   5   4   3   2   1   0
                  ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
0                 ³   ³   ³   ³0/4³0/3³0/2³0/1³0/0³
                  ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
                  ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
1                 ³1/4³1/3³1/2³1/1³1/0³2/4³2/3³2/2³
                  ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
                  ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
2                 ³2/1³2/0³   ³3/4³3/3³3/2³3/1³3/0³
                  ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
                  ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
3                 ³4/4³4/3³4/2³4/1³4/0³5/4³5/3³5/2³
                  ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
                  ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
4                 ³5/1³5/0³   ³6/4³6/3³6/2³6/1³6/0³
                  ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ

10ec:                   db   15h,55h,4ah,0aah,95h,0ah,0aah,95h,55h,4ah,1fh
10f7:                   db   0,0,0,0,0,0f8h,0,0,0,0,7,0c0h,0,0,0,0,0,0f8h
1109:                   db   0,0,0,0,7,0c0h,10h,84h,10h,84h,10h,8,42h,8
1117:                   db   42h,8,4,21h,4,21h,4,2,10h,82h,10h,82h,1,8,41h
1126:                   db   8,41h,1fh,0ffh,0dfh,0ffh,0dfh,4,21h,4,0abh
1131:                   db   84h,0,20h,9fh,11h,0,0,22h,1fh,41h,0,0,0,0,0
1140:                   db   0,4,21h,4,20h,4,0ah,52h,80h,0,0,0ah,57h,0cah
114e:                   db   0fah,8ah,0,8bh,8ah,74h,40h,18h,0c8h,84h,44h
1159:                   db   0c3h,4,52h,8ch,0ach,8dh,4,22h,0,0,0,2,22h,8
1167:                   db   41h,2,8,20h,82h,11h,8,0,25h,4eh,0a9h,0,0,21h
1175:                   db   1fh,21h,0,0,0,0ch,62h,10h,0,0,1fh,0,0,0,0,0
1185:                   db   3,0ch,0,8,84h,44h,0,0eh,8ch,0d5h,0cch,4eh,4
1192:                   db   61h,4,21h,0eh,0eh,88h,46h,44h,1fh,1fh,8,86h
119e:                   db   0ch,4eh,2,32h,92h,0f8h,82h,1fh,87h,81h,0ch
11a9:                   db   4eh,7,44h,1eh,8ch,4eh,1fh,8,84h,42h,8,0eh,8ch
11b6:                   db   4eh,8ch,4eh,0eh,8ch,4fh,8,9ch,0,63h,0,63h,0
11c3:                   db   0,1,0,21h,8,2,22h,10h,41h,2,0,7,0c0h,0f8h,0
11d2:                   db   8,20h,81h,11h,8,0eh,88h,42h,20h,4,0eh,8ch,0d5h
11df:                   db   0bch,0eh,4,54h,51h,0fch,51h,1eh,8ch,5eh,8ch
11ea:                   db   5eh,0eh,8ch,10h,84h,4eh,1eh,4ah,49h,4ah,5eh
11f5:                   db   1fh,84h,1eh,84h,1fh,1fh,84h,1eh,84h,10h,0eh
1200:                   db   84h,17h,8ch,4eh,11h,8ch,5fh,8ch,51h,0eh,21h
120b:                   db   4,21h,0eh,1,8,41h,0ch,4eh,11h,95h,18h,0a4h
1217:                   db   91h,10h,84h,10h,84h,1fh,11h,0ddh,55h,8ch,51h
1222:                   db   11h,8eh,55h,9ch,51h,0eh,8ch,51h,8ch,4eh,1eh
122d:                   db   8ch,5eh,84h,10h,0eh,8ch,51h,0ach,8dh,1eh,8ch
1238:                   db   5eh,0a4h,91h,0eh,8ch,0eh,0ch,4eh,1fh,21h,4
1243:                   db   21h,4,11h,8ch,51h,8ch,4eh,11h,8ch,4ah,51h,4
124f:                   db   11h,8ch,55h,0adh,4ah,11h,8ah,84h,54h,51h,11h
125a:                   db   8ah,84h,21h,4,1fh,8,84h,44h,1fh,1ch,84h,10h
1266:                   db   84h,1ch,0,82h,4,10h,40h,7,8,41h,8,47h,4,75h
1274:                   db   44h,21h,4,0,0,0,0,1fh,12h,0adh,5dh,0adh,52h
1281:                   db   4,54h,51h,0fch,51h,1fh,84h,1eh,8ch,5eh,12h
128c:                   db   94h,92h,97h,0c1h,0eh,52h,8ah,57h,0d1h,1fh,84h
1297:                   db   1eh,84h,1fh,4,0fdh,55h,0afh,0c4h,1fh,8ch,10h
12a2:                   db   84h,10h,11h,8ah,84h,54h,51h,11h,8ch,0d5h,0cch
12ad:                   db   51h,0eh,4,53h,0aeh,51h,11h,95h,18h,0a4h,91h
12b8:                   db   7,4ah,49h,4ah,51h,11h,0ddh,55h,8ch,51h,11h
12c3:                   db   8ch,5fh,8ch,51h,0eh,8ch,51h,8ch,4eh,1fh,8ch
12ce:                   db   51h,8ch,51h,0fh,8ch,4fh,2ah,51h,1eh,8ch,5eh
12d9:                   db   84h,10h,0eh,8ch,10h,84h,4eh,1fh,21h,4,21h,4
12e5:                   db   11h,8ch,4ah,22h,10h,11h,0adh,4eh,0adh,51h,1eh
12f0:                   db   8ch,5eh,8ch,5eh,10h,87h,91h,8ch,5eh,11h,8ch
12fb:                   db   59h,0adh,59h,0eh,88h,46h,0ch,4eh,11h,0adh,55h
1306:                   db   0adh,5fh,1ch,10h,4fh,8,9ch,15h,0adh,55h,0afh
1311:                   db   0c1h,11h,8ch,5fh,8,41h,1ch,0a1h,6,29h,46h


131c:           dtb127: db   "  ADR:"
1322:           dtb129: db   "  V:07"

                lab245:                     ; kontroln¡ sou‡et RAM
1328:21 00 3b           ld      hl,dtb81    ; adresa za‡ tku pamˆti RAM 1
132b:ed 4b a1 1e        ld      bc,(1ea1h)  ; d‚lka pamˆti RAM 1
132f:cd fd 03           call    lab122      ; kontr.sou‡et pamˆti -> HL
1332:ed 4b a9 1e        ld      bc,(1ea9h)  ; p©edpokl dan˜ kontroln¡ sou‡et
1336:b7                 or      a
1337:ed 42              sbc     hl,bc       ; kontrola kontroln¡ho sou‡tu
1339:3e 4a              ld      a,4ah       ; chyba pamˆti RAM
133b:c0                 ret     nz          ; n vrat p©i chybˆ pamˆti
133c:21 00 2b           ld      hl,dtb82    ; adresa za‡ tku pamˆti RAM 2
133f:ed 4b a3 1e        ld      bc,(1ea3h)  ; d‚lka pamˆti RAM 2
1343:cd fd 03           call    lab122      ; kontr.sou‡et pamˆti -> HL
1346:ed 4b ab 1e        ld      bc,(1eabh)  ; p©edpokl dan˜ kontroln¡ sou‡et
134a:b7                 or      a           ; CF <- 0
134b:ed 42              sbc     hl,bc       ; kontrola kontroln¡ho sou‡tu
134d:c8                 ret     z           ; n vrat - kontr. sou‡et OK
134e:3e 4b              ld      a,4bh       ; chyba pamˆti RAM
1350:c9                 ret     
; ......................................................
                                            ; inicializace buffer– pro "LOADING"
1351:21 f5 18   lab258: ld      hl,dtb71
1354:11 f6 18           ld      de,dtb115
1357:36 00              ld      (hl),0
1359:01 9f 05           ld      bc,59fh
135c:ed b0              ldir                ; vymaz n¡
135e:21 e3 1e           ld      hl,dtb77
1361:11 e4 1e           ld      de,dtb117
1364:36 00              ld      (hl),0
1366:01 d6 03           ld      bc,03d6h
1369:ed b0              ldir                ; vymaz n¡
136b:21 77 13           ld      hl,dtb119   ; text "    LOADING     7"
136e:11 05 1f           ld      de,dtb120   ; program pro l dov n¡
1371:01 3f 00           ld      bc,3fh      ; d‚lka dat
1374:ed b0              ldir                ; p©enos textu LOADING 7
1376:c9                 ret

1377:           dtb119:
1377:af                 xor     a
1378:3c                 inc     a
1379:cd 8c 0c           call    lab203
137c:e3 1e              dw      1ee3h
137e:15                 db      15h
137f:00                 db      0
1380:cd 1e 10           call    101eh
1383:00                 db      0
1384:00                 db      0
1385:                   db      "    LOADING     7"
; ......................................................

1396:cd 8c 0c           call    lab203

1399:fc 1e              dw      1efch
139b:02                 db      2
139c:00                 db      0

139d:01 b0 18           ld      bc,dtb28
13a0:11 e3 1e           ld      de,dtb77
13a3:21 00 00           ld      hl,0
13a6:cd 2d 02           call    vekt16
13a9:01 cd 1e           ld      bc,dtb78
13ac:11 fc 1e           ld      de,dtb79
13af:21 00 00           ld      hl,0
13b2:cd 36 02           call    vekt19
13b5:c9                 ret     
; ......................................................
13b6:           dtb136: db   80h,1,0,40h
13ba:                   db   " ** LOADING **  "
13ca:           dtb122: db   "      TIME      "
13da:           dtb125: db   80h
13db:01 00 42           ld      bc,4200h

                lab300:                     ; kontrola pamˆt¡ ROM a RAM

13de:21 00 00           ld      hl,0        ; po‡ te‡n¡ adresa pamˆt¡
13e1:01 00 08           ld      bc,800h     ; d‚lka jedn‚ pamˆti
13e4:1e 0b              ld      e,0bh       ; po‡et pamˆt¡ = 11
13e6:dd 21 f9 17        ld      ix,tcsste   ; tabulka kontr.sou‡t– STE
13ea:e5         lab248: push    hl          ; £schova HL (adresa)
13eb:c5                 push    bc          ; £schova BC (d‚lka pamˆti EPROM)
13ec:cd fd 03           call    lab122      ; kontroln¡ sou‡et jedn‚ EPROM
13ef:dd 7e 00           ld      a,(ix+0)    ; ni‘¨¡ bajt kontroln¡ho sou‡tu
13f2:bd                 cp      l           ; kontrola skute‡n‚ho kontr. sou‡tu
13f3:c2 2d 14           jp      nz,lab243   ; chyba EPROM ERROR(S) 40h a‘ 4bh
13f6:dd 23              inc     ix          ; adresa vy¨¨¡ho bajtu kontr. sou‡tu
13f8:dd 7e 00           ld      a,(ix+0)    ; vy¨¨¡ bajt kontroln¡ho sou‡tu
13fb:bc                 cp      h           ; kontrola skute‡n‚ho kontr. sou‡tu
13fc:c2 2d 14           jp      nz,lab243   ; chyba EPROM ERROR(S) 40h a‘ 4bh
13ff:dd 23              inc     ix          ; adresa kontr. sou‡tu n sl. pamˆti
1401:c1                 pop     bc          ; n vrat BC (d‚lka pamˆti EPROM)
1402:e1                 pop     hl          ; n vrat HL (adresa pamˆti EPROM)
1403:09                 add     hl,bc       ; za‡ tek dal¨¡ pamˆti EPROM
1404:1d                 dec     e           ; sn¡‘en¡ ‡¡ta‡e pamˆt¡
1405:ca 20 14           jp      z,lab244    ; byla ji‘ posledn¡ pamˆŸ
1408:3e 09              ld      a,9         ; ‡¡slo posledn¡ pamˆti STE
140a:bb                 cp      e           ; je posledn¡ pamˆŸ STE ?
140b:cc 35 14           call    z,lab246    ; posledn¡ ROM STE (BC = 7f9h)
140e:3e 08              ld      a,8         ; ‡¡slo prvn¡ pamˆti ZEL
1410:bb                 cp      e           ; je prvn¡ pamˆŸ ZEL ?
1411:cc 39 14           call    z,lab247    ; prvn¡ pamˆŸ ZEL - tabulka ZEL
1414:3e 01              ld      a,1         ; ‡¡slo posledn¡ pamˆti ZEL
1416:bb                 cp      e           ; je posledn¡ pamˆŸ ZEL ?
1417:c2 ea 13           jp      nz,lab248   ; nen¡ posledn¡ pamˆŸ ZEL
141a:01 ef 07           ld      bc,7efh     ; nov  d‚lka posledn¡ pamˆti ZEL
141d:c3 ea 13           jp      lab248      ; test dal¨¡ pamˆti
                                           ;* konec testu pamˆt¡ EPROM
1420:3a f4 18   lab244: ld      a,(ddb1)    ; p©¡znak testu RAM (10h)
1423:cb 7f              bit     7,a         ; prov d¡ se test RAM ?
1425:c8                 ret     z           ; neprov d¡ se test RAM
1426:cd 28 13           call    lab245      ; kontroln¡ sou‡et RAM
1429:c8                 ret     z           ; test RAM OK - n vrat
142a:c3 03 02           jp      vekt2       ; indikace chyby RAM
; ......................................................
                lab243:                     ; chyba EPROM ERROR(S) 40h a‘ 4bh
142d:3e 0b              ld      a,0bh       ; po‡et pamˆt¡ = 11
142f:93                 sub     e           ; ‡¡slo pamˆti s chybou
1430:c6 40              add     a,40h       ; korekce na ‡¡slo 40h a‘ 4bh
1432:c3 03 02           jp      vekt2       ; indikace chyby
; ......................................................
                lab246:                     ; BC = 7f9h ( bez tabulky chs.)
1435:01 f9 07           ld      bc,7f9h
1438:c9                 ret     
; ......................................................
                lab247:                     ; nastaven¡ parametr– ZEL pro CRC
1439:01 00 08           ld      bc,800h     ; d‚lka pamˆt¡ EPROM
143c:21 00 40           ld      hl,4000h    ; po‡ te‡n¡ adresa pamˆt¡ EPROM
143f:dd 21 ef 7f        ld      ix,tcszel   ; tabulka kontroln¡ch sou‡t– ZEL
1443:c9                 ret     



; ......................................................
1444:18 08              jr      lab249
; ......................................................
1446:           dtb86:  db   0dh,0f3h,88h,15h,10h,0,0,0
144e:11 b3 1e   lab249: ld      de,dtb85
1451:21 46 14           ld      hl,dtb86
1454:cd 18 02           call    vekt9
1457:18 08              jr      lab250
; ......................................................
1459:           dtb88:  db   0eh,2,0e8h,4bh,10h,0,0,0
1461:11 b7 1e   lab250: ld      de,dtb87
1464:21 59 14           ld      hl,dtb88
1467:cd 18 02           call    vekt9
146a:18 08              jr      lab251
; ......................................................
146c:           dtb90:  db   0fh,3,0dh,4ch,10h,0,0,0
1474:11 b9 1e   lab251: ld      de,dtb89
1477:21 6c 14           ld      hl,dtb90
147a:cd 18 02           call    vekt9
147d:18 08              jr      lab252
; ......................................................
147f:           dtb92:  db   10h,5,32h,4ch,10h,0,0,0
1487:11 bb 1e   lab252: ld      de,dtb91
148a:21 7f 14           ld      hl,dtb92
148d:cd 18 02           call    vekt9
1490:18 08              jr      lab253
; ......................................................
1492:           dtb94:  db   11h,4,5bh,4ch,10h,0,0,0
149a:11 bd 1e   lab253: ld      de,dtb93
149d:21 92 14           ld      hl,dtb94
14a0:cd 18 02           call    vekt9
14a3:18 08              jr      lab254
; ......................................................
14a5:           dtb96:  db   12h,0f5h,23h,6ch,10h,0,0,0
14ad:11 b5 1e   lab254: ld      de,dtb95
14b0:21 a5 14           ld      hl,dtb96
14b3:cd 18 02           call    vekt9
14b6:18 08              jr      lab255
; ......................................................
14b8:           dtb98:  db   13h,8,0a1h,66h,10h,0,0,0
14c0:11 bf 1e   lab255: ld      de,dtb97
14c3:21 b8 14           ld      hl,dtb98
14c6:cd 18 02           call    vekt9
14c9:18 08              jr      lab256
; ......................................................
14cb:           dtb100: db   14h,9,0deh,59h,10h,0,0,0
14d3:11 c1 1e   lab256: ld      de,dtb99
14d6:21 cb 14           ld      hl,dtb100
14d9:cd 18 02           call    vekt9
14dc:18 08              jr      lab257
; ......................................................
14de:           dtb102: db   15h,0f4h,2dh,17h,10h,0,14h,0
14e6:11 c3 1e   lab257: ld      de,dtb101
14e9:21 de 14           ld      hl,dtb102
14ec:cd 18 02           call    vekt9
14ef:01 c9 1e           ld      bc,dtb103
14f2:1e 1c              ld      e,1ch
14f4:26 01              ld      h,1
14f6:2e 02              ld      l,2
14f8:cd 1e 02           call    vekt11
14fb:01 da 18           ld      bc,dtb104
14fe:1e 16              ld      e,16h
1500:26 01              ld      h,1
1502:2e 00              ld      l,0
1504:cd 1e 02           call    vekt11
1507:01 cb 1e           ld      bc,dtb105
150a:1e 17              ld      e,17h
150c:26 03              ld      h,3
150e:2e 02              ld      l,2
1510:cd 1e 02           call    vekt11
1513:01 cf 1e           ld      bc,dtb106
1516:1e 18              ld      e,18h
1518:26 01              ld      h,1
151a:2e 03              ld      l,3
151c:cd 1e 02           call    vekt11
151f:01 dd 1e           ld      bc,dtb107
1522:1e 19              ld      e,19h
1524:26 01              ld      h,1
1526:2e 02              ld      l,2
1528:cd 1e 02           call    vekt11
152b:01 d9 1e           ld      bc,dtb108
152e:1e 1a              ld      e,1ah
1530:26 02              ld      h,2
1532:2e 04              ld      l,4
1534:cd 1e 02           call    vekt11
1537:01 cd 1e           ld      bc,dtb78
153a:1e 1b              ld      e,1bh
153c:26 02              ld      h,2
153e:2e 02              ld      l,2
1540:cd 1e 02           call    vekt11
1543:01 c7 1e           ld      bc,dtb109
1546:1e 1d              ld      e,1dh
1548:26 01              ld      h,1
154a:2e 04              ld      l,4
154c:cd 1e 02           call    vekt11
154f:01 d3 1e           ld      bc,dtb110
1552:1e 1e              ld      e,1eh
1554:26 01              ld      h,1
1556:2e 13              ld      l,13h
1558:cd 1e 02           call    vekt11
155b:01 d5 1e           ld      bc,dtb111
155e:1e 1f              ld      e,1fh
1560:26 01              ld      h,1
1562:2e 01              ld      l,1
1564:cd 1e 02           call    vekt11
1567:01 d7 1e           ld      bc,dtb112
156a:1e 20              ld      e,20h
156c:26 01              ld      h,1
156e:2e 00              ld      l,0
1570:cd 1e 02           call    vekt11
1573:01 db 1e           ld      bc,dtb113
1576:1e 21              ld      e,21h
1578:26 01              ld      h,1
157a:2e 05              ld      l,5
157c:cd 1e 02           call    vekt11
157f:21 a0 1e           ld      hl,dtb114
1582:36 02              ld      (hl),2
1584:cd 51 13           call    lab258      ; inicializace buffer– pro "LOADING"
1587:c9                 ret     
; ......................................................
1588:cd 28 13           call    lab245      ; kontroln¡ sou‡et RAM
158b:ca 8f 16           jp      z,lab259    ; kontroln¡ sou‡et souhlas¡
158e:21 b6 13           ld      hl,dtb136   ; text " ** LOADING **  "
1591:e5         lab261: push    hl          ; £schova textu pro druh˜ v˜stup
1592:06 10              ld      b,10h
1594:21 13 1f           ld      hl,dtb123
1597:7e         lab286: ld      a,(hl)
1598:fe 4c              cp      4ch         ; je "L" ? (LOADING)
159a:ca aa 15           jp      z,lab262
159d:fe 2b              cp      2bh         ; je "+" ? (+TIME+)
159f:ca ff 16           jp      z,lab281
15a2:fe 54              cp      54h         ; je "T" ? (TIME)
15a4:ca f7 16           jp      z,lab284
15a7:23                 inc     hl
15a8:10 ed              djnz    lab286
15aa:21 13 1f   lab262: ld      hl,dtb123   ; prvn¡ znak textu "L ADR:...."
15ad:36 4c              ld      (hl),4ch    ; nastaven¡ "L"
15af:e5         lab285: push    hl
15b0:21 20 3f           ld      hl,dtb42
15b3:01 d0 00           ld      bc,0d0h
15b6:cd fd 03           call    lab122      ; kontr.sou‡et pamˆti -> HL
15b9:ed 4b ba 22        ld      bc,(ddw14)  ; p©edpokl dan˜ kontroln¡ sou‡et
15bd:b7                 or      a           ; CF <- 0
15be:ed 42              sbc     hl,bc       ; kontrola kontroln¡ho sou‡tu
15c0:3e cf      lab283: ld      a,0cfh      ; port PIO-B = bitov˜ vstup/v˜stup
15c2:d3 0f              out     (0fh),a     ; port PIO-B = bitov˜ vstup/v˜stup
15c4:3e ff              ld      a,0ffh      ; maska - v¨echny bity jako vstup
15c6:d3 0f              out     (0fh),a     ; maska - v¨echny bity jako vstup
15c8:3e 07              ld      a,7         ; z kaz p©eru¨en¡ od PIO-B
15ca:d3 0f              out     (0fh),a     ; z kaz p©eru¨en¡ od PIO-B
15cc:db 0d              in      a,(0dh)     ; ‡ten¡ adresy BDT
15ce:cb bf              res     7,a         ; reset bitu 7 (adresa 128 a n¡‘e)
15d0:ca 81 16           jp      z,lab263    ; kontroln¡ sou‡et form t– je OK
15d3:f6 40              or      40h         ; adresa 64 a v˜¨e
                                          ;* bude na‡ten¡ form t– BDT
                                          ;* p©evod adresy BDT do k¢du BCD
15d5:4f         lab273: ld      c,a         ; ‡¡slo BDT
15d6:21 00 00           ld      hl,0        ; HL <- 0000
15d9:06 07              ld      b,7         ; B <- 7 po‡et bit– adresy
15db:3e 01              ld      a,1         ; bit ukazatele
15dd:cb 39      lab279: srl     c           ; rotace adresy BDT vpravo
15df:dc 07 17           call    c,lab274    ; bit adresy = 1 - p©evod do BCD
15e2:87                 add     a,a         ; zv˜¨en¡ ukazatele masky adresy
15e3:10 f8              djnz    lab279      ; dal¨¡ bit adresy
                                          ;* ulo‘en¡ ‡¡sla BDT v dekad. tvaru
15e5:11 e8 3f           ld      de,dtb133   ; buffer k ulo‘en¡ v˜stupn¡ho textu
15e8:7c                 ld      a,h         ; nejvy¨¨¡ dek da adresy
15e9:e6 0f              and     0fh         ; nejvy¨¨¡ dek da adresy (stovky)
15eb:c6 30              add     a,30h       ; p©evod na ‡¡slici ASCII
15ed:12                 ld      (de),a      ; ulo‘en¡ ‡¡slice stovek adresy
15ee:13                 inc     de          ; zv˜¨en¡ ukl dac¡ adresy
15ef:7d                 ld      a,l         ; des¡tky adresy
15f0:cb 3f              srl     a
15f2:cb 3f              srl     a
15f4:cb 3f              srl     a
15f6:cb 3f              srl     a           ; rotace do ni‘¨¡ tetr dy
15f8:c6 30              add     a,30h       ; p©evod na ‡¡slici ASCII
15fa:12                 ld      (de),a      ; ulo‘en¡ des¡tek adresy
15fb:13                 inc     de          ; zv˜¨en¡ ukl dac¡ adresy textu
15fc:7d                 ld      a,l         ; adresa BDT
15fd:e6 0f              and     0fh         ; jednotky adresy BDT
15ff:c6 30              add     a,30h       ; p©evod na ‡¡slici ASCII
1601:12                 ld      (de),a      ; ulo‘en¡ jednotek adresy BDT
1602:3e 30              ld      a,30h       ; mazac¡ "0"
1604:06 05              ld      b,5         ; po‡et nul k z pisu
1606:13         lab280: inc     de          ; doplnˆn¡ 5 nulami
1607:12                 ld      (de),a      ; ulo‘en¡ znaku "0"
1608:10 fc              djnz    lab280      ; ulo‘en¡ dal¨¡ho znaku

160a:e1         lab264: pop     hl          ; ukl dac¡ adresa textu "L ADR:..."
160b:23                 inc     hl          ; ukl dac¡ adresa p©ed adresou
160c:11 1c 13           ld      de,dtb127   ; text "  ADR:"
160f:01 06 00           ld      bc,6        ; d‚lka textu "ADR:"
1612:eb                 ex      de,hl
1613:ed b0              ldir                ; p©enos textu "ADR:"
1615:3e cf              ld      a,0cfh      ; port PIO-B = bitov˜ vstup/v˜stup
1617:d3 0f              out     (0fh),a     ; port PIO-B = bitov˜ vstup/v˜stup
1619:3e ff              ld      a,0ffh      ; maska - v¨echny bity jako vstup
161b:d3 0f              out     (0fh),a     ; maska - v¨echny bity jako vstup
161d:3e 07              ld      a,7         ; z kaz p©eru¨en¡ od PIO-B
161f:d3 0f              out     (0fh),a     ; z kaz p©eru¨en¡ od PIO-B
1621:db 0d              in      a,(0dh)     ; ‡ten¡ adresy BDT
1623:cb bf              res     7,a         ; reset bitu 7 (adresa 128 a n¡‘e)
1625:f6 40              or      40h         ; adresa 64 a v˜¨e
1627:47                 ld      b,a         ; adresa BDT
1628:0f                 rrca    
1629:0f                 rrca    
162a:0f                 rrca    
162b:0f                 rrca    
162c:e6 0f              and     0fh         ; vy¨¨¡ tetr da adresy
162e:c6 30              add     a,30h       ; p©evod na ‡¡slici ASCII
1630:fe 3a              cp      3ah         ; je p¡smeno HEX ?
1632:da 37 16           jp      c,lab265    ; nen¡ p¡smeno HEX
1635:c6 07              add     a,7         ; korekce na p¡smeno HEX
1637:12         lab265: ld      (de),a      ; ulo‘en¡ vy¨¨¡ ‡¡slice adresy
1638:13                 inc     de          ; zv˜¨en¡ ukl dac¡ adresy
1639:78                 ld      a,b         ; adresa BDT
163a:e6 0f              and     0fh         ; ni‘¨¡ tetr da adresy
163c:c6 30              add     a,30h       ; korekce na ‡¡slici ASCII
163e:fe 3a              cp      3ah         ; je p¡smeno HEX ?
1640:da 45 16           jp      c,lab266    ; nen¡ p¡smeno HEX
1643:c6 07              add     a,7         ; korekce na p¡smeno HEX
1645:12         lab266: ld      (de),a      ; ulo‘en¡ vy¨¨¡ ‡¡slice adresy
1646:13                 inc     de          ; zv˜¨en¡ ukl dac¡ adresy
1647:3e 48              ld      a,"H"       ; znak "H"
1649:12                 ld      (de),a      ; ulo‘en¡ znaku "H"
164a:13                 inc     de          ; zv˜¨en¡ ukl dac¡ adresy
164b:21 22 13           ld      hl,dtb129   ; text "  V:07"
164e:01 06 00           ld      bc,6        ; d‚lka textu
1651:ed b0              ldir                ; p©enos textu "V:07"
1653:cd 05 1f           call    dtb120      ; nastaven¡ parametr– pro l dov n¡
1656:e1                 pop     hl
1657:22 10 1f           ld      (ddw29),hl
165a:21 d0 18           ld      hl,dtb36
165d:22 2c 1f           ld      (ddw30),hl
1660:f3                 di      
1661:cd 64 49           call    4964h       ; l dov n¡ dat þ
1664:fb                 ei      
1665:cd 05 1f   lab272: call    dtb120
1668:3a 00 1f           ld      a,(ddb30)
166b:b7                 or      a
166c:ca 7e 16           jp      z,lab271
166f:fe 02              cp      2
1671:21 12 1f           ld      hl,dtb132
1674:cb 86              res     0,(hl)
1676:ca 65 16           jp      z,lab272
1679:cb c6              set     0,(hl)
167b:c3 65 16           jp      lab272
; ......................................................
167e:cd 2a 02   lab271: call    vekt15      ; inicializace ukazatele registr–
                                            ; kontrola adresy BDT
1681:f6 40      lab263: or      40h         ; adresa BDT 64 a v˜¨e
1683:47                 ld      b,a         ; nov  adresa BDT
1684:3a bc 22           ld      a,(ddb24)   ; star  adresa BDT
1687:b8                 cp      b           ; je adresa BDT stejn  ?
1688:ca 0a 16           jp      z,lab264    ; adresa BDT z–stala stejn 
168b:78                 ld      a,b         ; nov  adresa BDT
168c:c3 d5 15           jp      lab273      ; je na‡ten¡ form t– BDT
; ......................................................

168f:3a e0 3e   lab259: ld      a,(ddb29)
1692:cb 67              bit     4,a
1694:ca aa 16           jp      z,lab260
1697:21 20 3f           ld      hl,dtb42    ; data interpreteru
169a:01 d0 00           ld      bc,0d0h     ; d‚lka datov‚ ‡ sti interpreteru
169d:cd fd 03           call    lab122      ; kontr.sou‡et pamˆti -> HL
16a0:ed 4b ba 22        ld      bc,(ddw14)  ; p©edpokl dan˜ kontroln¡ sou‡et
16a4:b7                 or      a           ; CF <- 0
16a5:ed 42              sbc     hl,bc       ; kontrola kontroln¡ho sou‡tu
16a7:c2 c0 16           jp      nz,lab287   ; nen¡ shoda kontroln¡ho sou‡tu
                                          ;* jinak n sleduje pouze synchron.‡asu
16aa:21 ca 13   lab260: ld      hl,dtb122   ; text "      TIME      "
16ad:11 13 1f           ld      de,dtb123   ; adresa bufferu
16b0:01 10 00           ld      bc,10h      ; d‚lka textu
16b3:ed b0              ldir                ; p©enos textu "TIME"
16b5:21 a0 1e           ld      hl,dtb114
16b8:cb c6              set     0,(hl)
16ba:21 da 13           ld      hl,dtb125
16bd:c3 91 15           jp      lab261
; ......................................................
16c0:21 d5 16   lab287: ld      hl,dtb134
16c3:11 13 1f           ld      de,dtb123
16c6:01 10 00           ld      bc,10h
16c9:ed b0              ldir                ; prenos textu "+ TIME +"
16cb:21 d1 16           ld      hl,dtb135
16ce:c3 91 15           jp      lab261
; ......................................................
16d1:           dtb135: db   80h,1,0,43h
16d5:           dtb134: db   "    + TIME +    "
16e5:                   db   14h,0
16e7:                   db   "  ADDRESS:      "
16f7:21 13 1f   lab284: ld      hl,dtb123
16fa:36 54              ld      (hl),54h    ; "T"
16fc:c3 af 15           jp      lab285
; ......................................................
16ff:21 13 1f   lab281: ld      hl,dtb123
1702:36 44              ld      (hl),44h    ; "D"
1704:c3 ee 17           jp      lab282
; ......................................................
                                          ;* p©evod bitu do formy BCD
1707:57         lab274: ld      d,a         ; ukazatel masky adresy BDT
1708:78                 ld      a,b         ; ‡¡ta‡ bit–
1709:fe 04              cp      4           ; je vy¨¨¡ tetr da ?
170b:7a                 ld      a,d         ; ukazatel masky adresy BDT
170c:dc 19 17           call    c,lab275    ; je vy¨¨¡ tetr da
170f:85                 add     a,l         ; p©i‡ten¡ p©enosu
1710:27                 daa                 ; korekce DAA
1711:dc 17 17           call    c,lab278    ; je p©enos do vy¨¨¡ dek dy
1714:6f                 ld      l,a         ; nov  hodnota ni‘¨¡ho ‡¡sla
1715:7a                 ld      a,d         ; ukazatel masky adresy BDT
1716:c9                 ret     
; ......................................................
1717:24         lab278: inc     h           ; p©enos do vy¨¨¡ dek dy ‡¡sla
1718:c9                 ret     
; ......................................................
                                          ;* je vy¨¨¡ tetr da ‡¡sla
1719:78         lab275: ld      a,b         ; ‡¡ta‡ bit–
171a:fe 03              cp      3           ; je bit 5 ?
171c:ca 27 17           jp      z,lab276    ; je bit 5
171f:fe 02              cp      2           ; je bit 6 ?
1721:ca 2a 17           jp      z,lab277    ; je bit 6
1724:3e 64              ld      a,64h       ; =100 (pro bit 7)
1726:c9                 ret     

1727:3e 16      lab276: ld      a,16h       ; =22 (pro bit 5)
1729:c9                 ret     

172a:3e 32      lab277: ld      a,32h       ; =50 (pro bit 6)
172c:c9                 ret     
; ......................................................

172d:3e 10              ld      a,10h       ; =16
172f:32 1d 20           ld      (ddb31),a
1732:2a d7 1e           ld      hl,(dtb112)
1735:22 1b 20           ld      (ddw31),hl
1738:2a 0c 19           ld      hl,(ddb5)   ; = 0
173b:22 1e 20           ld      (ddw32),hl
173e:21 15 00           ld      hl,lab29
1741:22 30 20           ld      (ddw33),hl
1744:21 1b 20           ld      hl,ddw31
1747:22 32 20           ld      (ddw34),hl
174a:21 a0 1e   lab290: ld      hl,dtb114
174d:cb 4e              bit     1,(hl)
174f:20 63              jr      nz,lab288
1751:cb 7e              bit     7,(hl)
1753:20 5f              jr      nz,lab288
1755:21 1a 20           ld      hl,dtb137
1758:cb 4e              bit     1,(hl)
175a:20 58              jr      nz,lab288
175c:21 20 20           ld      hl,dtb138
175f:11 21 20           ld      de,dtb139
1762:36 20              ld      (hl),20h
1764:01 0f 00           ld      bc,0fh
1767:ed b0              ldir    
1769:e5                 push    hl
176a:21 34 20           ld      hl,dtb140
176d:cd 45 02           call    vekt24
1770:e1                 pop     hl
1771:06 02              ld      b,2
1773:dd 21 34 20        ld      ix,dtb140
1777:11 24 20           ld      de,dtb141
177a:dd 6e 00   lab296: ld      l,(ix+0)    ; ‡¡slo k p©evodu
177d:26 00              ld      h,0
177f:13                 inc     de
1780:dd 23              inc     ix
1782:cd b9 17           call    lab292      ; p©evod ‡¡sla HL do dek. tvaru
1785:21 3b 20           ld      hl,dtb147
1788:c5                 push    bc
1789:ed a0              ldi     
178b:ed a0              ldi     
178d:c1                 pop     bc
178e:3e 3a              ld      a,3ah       ; znak ":"
1790:12                 ld      (de),a
1791:10 e7              djnz    lab296      ; p©evod dal¨¡ho ‡¡sla do dek. tvaru
1793:3e 20              ld      a,20h
1795:12                 ld      (de),a
1796:2a 0c 19           ld      hl,(ddb5)   ; = 0
1799:22 1e 20           ld      (ddw32),hl
179c:01 b0 18           ld      bc,dtb28
179f:11 30 20           ld      de,ddw33
17a2:21 00 00           ld      hl,0
17a5:cd 2d 02           call    vekt16
17a8:01 d7 1e           ld      bc,dtb112
17ab:11 00 00           ld      de,0
17ae:21 00 00           ld      hl,0
17b1:cd 36 02           call    vekt19
17b4:cd 3f 02   lab288: call    vekt22
17b7:18 91              jr      lab290
; ......................................................
                                          ;* p©evod ‡¡sla HL do dek. tvaru

17b9:e5         lab292: push    hl          ; £schova HL
17ba:d5                 push    de          ; £schova DE
17bb:c5                 push    bc          ; £schova BC
17bc:f5                 push    af          ; £schova DE
17bd:01 38 20           ld      bc,dtb142   ; ukl dac¡ adresa ‡¡sla
17c0:11 10 27           ld      de,10000
17c3:cd e1 17           call    lab293      ; p©evod desetitis¡c–
17c6:11 e8 03           ld      de,1000
17c9:cd e1 17           call    lab293      ; p©evod tis¡c–
17cc:11 64 00           ld      de,100
17cf:cd e1 17           call    lab293      ; p©evod stovek
17d2:11 0a 00           ld      de,10
17d5:cd e1 17           call    lab293      ; p©evod des¡tek
17d8:7d                 ld      a,l         ; zbytek - jednotky
17d9:cd e9 17           call    lab295      ; p©evod jednotek
17dc:f1                 pop     af          ; n vrat AF
17dd:c1                 pop     bc          ; n vrat BC
17de:d1                 pop     de          ; n vrat DE
17df:e1                 pop     hl          ; n vrat HL
17e0:c9                 ret     
                                          ;* p©evod na ‡¡slici
17e1:af         lab293: xor     a           ; A <- 0 ‡¡ta‡ ‡¡sla
17e2:3c         lab294: inc     a           ; zv˜¨en¡ ‡¡ta‡e ‡¡sla
17e3:ed 52              sbc     hl,de       ; HL <- HL-DE
17e5:30 fb              jr      nc,lab294   ; nen¡ je¨tˆ p©ete‡en¡
17e7:3d                 dec     a           ; n vrat A
17e8:19                 add     hl,de       ; n vrat HL
17e9:f6 30      lab295: or      30h         ; korekce A na dekadickou ‡¡slici
17eb:02                 ld      (bc),a      ; ulo‘en¡ p©eveden‚ ‡¡slice
17ec:03                 inc     bc          ; zv˜¨en¡ ukl dac¡ adresy
17ed:c9                 ret     
; ......................................................
17ee:e5         lab282: push    hl
17ef:c3 c0 15           jp      lab283
; ......................................................
17f2:                   db   0ffh,12h,0,88h,8,46h,10h
17f9:           tcsste:                     ; tabulka kontroln¡ch sou‡t– ROM STE
                        dw      7ddch
                        dw      0ee98h
                        dw      0d4e3h
                        db      1


tcszel:  set 7ff0h

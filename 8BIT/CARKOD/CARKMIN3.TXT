CONTEXT   0  71   4   0  60
Adaptor pro sn¡m n¡ ‡ rov‚ho k¢du       - # -

ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ


  ÿAÿdÿaÿpÿtÿoÿrÿ ÿpÿrÿoÿ ÿsÿnÿ¡ÿmÿ ÿnÿ¡ÿ ÿ‡ÿ ÿrÿoÿvÿ‚ÿhÿoÿ ÿkÿ¢ÿdÿu

                        ING. MIROSLAV N‰ME€EK

—vod

    Adaptor  pro  sn¡m n¡  ‡ rov‚ho  k¢du  (d le  jen  adaptor) slou‘¡
kúroz¨¡©en¡  mo‘nost¡ vstup– termin l– BDT K8901 o vstup z ru‡n¡ sondy
pro  sn¡m n¡  ‡ rov‚ho  k¢du.  Tyto termin ly jsou pou‘¡v ny vúsyst‚mu
sbˆru dat DIS A 6422, jeho‘ dodavatelem je firma ROBOTRON. Adaptor lze
v¨ak  po  £pravˆ  pou‘¡t  i  uújin˜ch  za©¡zen¡  -  kútomuto  £‡elu je
zapot©eb¡  upravit  v˜stupn¡  obvody  a  programov‚ vybaven¡ adaptoru.
Hlavn¡  oblast¡  pou‘it¡  adaptoru je pr–myslov‚ vyu‘it¡ pro sledov n¡
v˜robk– ve v˜robˆ, ale i pro ovl d n¡ za©¡zen¡ a vkl d n¡ dat. Adaptor
lze  realizovat  z  bˆ‘nˆ  dostupn˜ch sou‡ stek. Jako sn¡mac¡ sonda je
pou‘ita  sonda  3WN16601,  jej¡m‘  v˜robcem  je  TESLA  Blatn  (€SSR).
Sútouto  sondou  bylo  dosa‘eno  velmi  dobr˜ch  v˜sledk–  ve  spojen¡
súadaptorem.  Jedinou  £pravou  sondy  bylo doplnˆn¡ o indika‡n¡ diodu
LED, tuto indikaci lze v¨ak p©¡padnˆ um¡stit i mimo sondu.


Funkce

    Adaptor  ‡te  sign l,  p©ich zej¡c¡ ze sn¡mac¡ sondy, tento sign l
dek¢duje  a  po  dek¢dov n¡ vys¡l  jednotliv‚ znaky sn¡man‚ho ‡ rov‚ho
k¢du na za©¡zen¡. V˜stupn¡ obvody adaptoru jsou ©e¨eny tak, aby nebylo
nutno  zasahovat  do  hardware  ani  software  termin lu BDT. Z tohoto
d–vodu  je v˜stup adaptoru p©ipojen paralelnˆ ke kl vesnici termin lu.
Toto  p©ipojen¡  je  mo‘n‚  ©e¨it  pomoc¡ vsuvky, kter  se zapoj¡ mezi
konektory  pro  p©ipojen¡  kl vesnice, tak‘e nen¡ nutno prov dˆt ‘ dn‚
£pravy  vútermin lu a p–vodn¡ funkce kl vesnice z–st v  zachov na beze
zmˆny.


Popis zapojen¡

    Zjednodu¨en‚  zapojen¡  adaptoru  je na obr. 1. Srdcem adaptoru je
mikroprocesor  U880D (Q1). Program je ulo‘en v pamˆtech EPROM 2716 (Q3
a  Q4 - celkov  kapacita 4 KB). Jejich po‡et lze p©i men¨¡m po‡tu k¢d–
redukovat  na  1úkus, maxim lnˆ lze p©ipojit 3 pamˆti EPROM 2716. Jako
pamˆŸ pro ukl d n¡ dat jsou pou‘ity pamˆti RAM 2114 (Q5 a Q6 - celkov 
kapacita  1  KB).  Obvod  3205 (Q7) slou‘¡ k v˜bˆru pamˆt¡. Jednotliv‚
obvody  maj¡  adresy:  Q3  - 0000H a‘ 07FFH, Q4 - 0800H a‘ 0FFFH, Q5 -
1800H  a‘ 1BFFH nebo 1C00H a‘ 1FFFH/D0 a‘ D3, Q6 - 1800H a‘ 1BFFH nebo
1C00H a‘ 1FFFH/D4 a‘ D7.

    Vstup  a v˜stup dat prob¡h  p©es obvod PIO U855D (Q2). Sign l /AKT
je  sign l z tla‡¡tka pro aktivaci sondy, sign l /DAT je datov˜ sign l
ze  sondy. Vstup sign l– ze sondy je realizov n pomoc¡ re‘imu bitov‚ho
p©eru¨en¡  obvodu  PIO  hranou  sign lu.  Sign ly SEL, STO a /STI jsou
pou‘ity  pro  ©¡zen¡  nestandardn¡ch  v˜stup–  z  adaptoru. Sign l LON
zap¡n  nap jen¡ sondy. Vúsondˆ je um¡stˆna sv¡tiv  dioda LED p©ipojen 
k  nap jen¡,  kter   indikuje  pohotovostn¡  stav sondy, chybov‚ stavy
adaptoru  a  spr vn‚ p©e‡ten¡ sn¡man‚ho k¢du. Sign ly DIL1 a DIL2 jsou
vstupy  zúp©ep¡na‡–  DIL,  pomoc¡ kter˜ch lze volit typ ‡ rov‚ho k¢du,
kter˜  bude  sondou  sn¡m n. Dek¢dovac¡ obvody pro simulaci kl vesnice
jsou  sestaveny zúkompara‡n¡ch hradel M2, porovn vaj¡c¡ch adresu © dku
kl vesnice   prohled van‚ho  multiplexerem  kl vesnice  s  po‘adovanou
adresou  kl vesy,  p©ich zej¡c¡ od obvodu PIO. P©i shodˆ adres nastane
aktivace  v˜stupn¡ch  budi‡–  sloupc– kl vesnice, ‡¡m‘ je nasimulov na
funkce matice kl vesnice.


Programov‚ vybaven¡

    Program  adaptory  je  ulo‘en  v  pamˆtech  EPROM,  jejich celkov 
kapacita  je  4 KB. Po zapnut¡ adaptoru nastane inicializace adaptoru,
spo‡¡vaj¡c¡  mimo  jin‚  v  aktivaci  sondy  a inicializaci ‡¡ta‡e pro
vypnut¡  sondy. Pokud neprob¡h  vstup ze sondy ani v˜stup na termin l,
prov d¡  adaptor  cyklicky  testy  pamˆt¡  ROM, RAM a obvodu PIO. Tyto
testy  jsou  prov dˆny  pro  zabezpe‡en¡  vy¨¨¡  spolehlivosti provozu
adaptoru. Pokud nalezne adaptor bˆhem test– chybu (nap©. chyba jednoho
bitu  pamˆti  ROM),  zablokuje  se  dal¨¡  ‡innost adaptoru a sonda se
rozblik   chybov˜m  k¢dem dan˜m charakterem nalezen‚ chyby. Pokud nen¡
po  dobu 5 minut se sondou manipulov no (tj. nejsou ‡tena ‘ dn  data),
sonda  se automaticky vypne, ‡¡m‘ se sni‘uje jej¡ opot©eben¡ a zvy¨uje
spolehlivost.  Do  pohotovostn¡ho stavu je ji mo‘n‚ opˆt uv‚st stiskem
aktiva‡n¡ho tla‡¡tka na sondˆ.

    Pokud  je  sondou  sn¡m n  ‡ rov˜ k¢d, p©ich z¡ do adaptoru sign l
tvo©en˜  posloupnost¡  logick˜ch  "0"  a  "1".  Prodlevy  mezi hranami
sign lu  jsou  ukl d ny  do vyrovn vac¡ho bufferu adaptoru. Po sejmut¡
cel‚ho  k¢du  jsou  metodou dvoj¡ho pr–chodu vypo‡teny relativn¡ ¨¡©ky
impuls–  (kter‚  jsou  ji‘ nez visl‚ na rychlosti pohybu sondou). Tyto
relativn¡  impulsy jsou posl‚ze dek¢dov ny a pokud jsou rozezn ny jako
platn‚  znaky  dan‚ho  k¢du,  jsou tyto znaky ulo‘eny do vyrovn vac¡ho
v˜stupn¡ho  bufferu. P©i spr vn‚m dek¢dov n¡ ‡ten‚ho k¢du sonda kr tce
zablik ,   ‡¡m‘   adaptor  informuje  u‘ivatele  o  spr vn‚m  p©e‡ten¡
sn¡man‚ho  k¢du. Z v˜stupn¡ho bufferu pot‚ prob¡h  v˜stup jednotliv˜ch
znak– na kl vesnicov˜ vstup termin lu. Vstup nov˜ch dat do adaptoru je
mo‘n˜  nez visle na tom, zda ji‘ prob¡h  v˜stup na termin l. Nov  data
jsou  ukl d na  do  vyrovn vac¡ho  bufferu,  pouze  po  jeho  zaplnˆn¡
p©estane b˜t indikov no spr vn‚ ‡ten¡ dat a u‘ivatel mus¡ po‡kat a‘ se
uvoln¡  vyrovn vac¡  buffer.  Tento  p©¡pad v¨ak nast v  z©¡dka, neboŸ
kapacita  vyrovn vac¡ho  bufferu  je  asi  500 znak–. V sou‡asnosti je
realizov n  adaptor s mo‘nost¡ volby k¢d–: a) 39, b) 2 z 5 prokl dan˜,
c)  kombinovan˜  39  a 2 z 5 prokl dan˜ (automatick‚ rozezn n¡ k¢du) a
d)úk¢d  CKn.  Jako  nejvhodnˆj¨¡ k¢d je mo‘no doporu‡it k¢d CKn, kter˜
byl vyvinut k tomuto £‡elu. Nejde oústandardn¡ k¢d, oproti jin˜m k¢d–m
m   v¨ak  nˆkolik  v˜hod.  P©edev¨¡m  byl vyvinut s ohledem na sn¡m n¡
ru‡n¡m sn¡ma‡em, u kter‚ho se projevuj¡ velmi silnˆ takov‚ chyby, jako
je  kol¡s n¡  rychlosti  bˆhem  ‡ten¡, nep©esnosti v hran ch ‡ar apod.
Jeden  z znam  k¢du  CKn  m   standardn¡ strukturu, obsahuj¡c¡ z hlav¡
súinformac¡  o po‡tu znak– z znamu, pou‘it‚m vnit©n¡m k¢du a kontroln¡
sou‡et  k¢du.  Jako  vnit©n¡ k¢d jsou pou‘ity k¢dy CK3 a‘ CK8, jejich‘
relativn¡  d‚lky  znak–  jsou 3úa‘ 8 jednotek (tj. ¨¡©ek nejmen¨¡ ‡ ry
nebo  mezery  v k¢du). T¡mto zp–sobem je dosa‘eno vysok‚ spolehlivosti
p©i ‡ten¡ z znamu ‡ rov‚ho k¢du. D‚lka jednoho z znamu je p©i kr tk˜ch
z znamech  porovnateln  nebo ni‘¨¡ ne‘ u jin˜ch typ– k¢d–, p©i del¨¡ch
k¢dech  je  d‚lka  men¨¡.  K¢d  je  mo‘no  tisknout bˆ‘nou jehli‡kovou
tisk rnou bez velk˜ch n rok– na p©esnost.


Z vˆr

    V  ‡l nku  byl  pops n  adaptor  k  termin lu  BDT  K8901 (v˜robce
ROBOTRON)  pro  sn¡m n¡  ‡ rov‚ho  k¢du  pomoc¡  ru‡n¡  sn¡mac¡  sondy
3WN16601  (v˜robce TESLA Blatn  - €SSR). Adaptor je ur‡en ke sledov n¡
v˜robk–  ve  v˜robˆ,  kter‚  jsou  ozna‡eny  ¨t¡tky  s v˜robn¡mi ‡¡sly
zapsan˜mi  ve formˆ ‡ rov‚ho k¢du. Jako dal¨¡ oblast vyu‘it¡ se nab¡z¡
mo‘nost  p©ipojen¡  adaptoru  i  kújin˜m  za©¡zen¡m  a ovl d n¡ tˆchto
za©¡zen¡  pomoc¡  sn¡mac¡  sondy a tabulky k¢d–, obsahuj¡c¡ch sekvence
povel–  pro  ur‡itou  aplikaci  za©¡zen¡.  T¡m  je mo‘no zjednodu¨it a
zrychlit  obsluhu  libovoln‚ho  za©¡zen¡.  V  nˆkter˜ch p©¡padech m–‘e
adaptor  plnˆ nahradit ovl dac¡ panel za©¡zen¡ a st t se jeho levnˆj¨¡
a  p©itom  efektivnˆj¨¡ n hradou. Jako nejvhodnˆj¨¡ k¢d pro tyto £‡ely
(tj.   pokud  nebude  adaptor  pou‘¡v n  ke  ‡ten¡  standardn¡ch  k¢d–
pou‘it˜ch  k  ozna‡ov n¡  v˜robk–,  pro  kter‚ nen¡ ru‡n¡ sonda vhodn‚
‡tec¡  za©¡zen¡)  se  jev¡  pou‘it¡  k¢du  CKn,  kter˜  umo‘¤uje volbu
u‘ivatele  z  55  znak–  (p©i  pou‘it¡  sekvenc¡ znak– v¡ce) a o d‚lce
z znamu  max.  30  znak–. Bli‘¨¡ informace o adaptoru je mo‘n‚ obdr‘et
uúautora  (TESLA Ro‘nov pod Radho¨tˆm - €SSR). Je mo‘n  t‚‘ spolupr ce
v oblasti pou‘it¡ uveden‚ho adaptoru pro jin‚ aplikace.

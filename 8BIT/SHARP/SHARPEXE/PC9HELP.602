@CT 0
@LM 1
@RM 65
@PL 60
@TB ---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T
@MT 5
@MB 3
@PO 10
@PN 1
@OP 
@HE PC-DIR_______________________________________________________help          
@FO P+c                                                            #
@LH 6
                      Stono‘ka v MZ-800 (1)
                         Pavel Zakou©il



M lokdo  dok ‘e plnˆ  vyu‘¡t mo‘nost¡  z kaznick‚ho stov˜vodov‚ho
obvodu GDG mikropo‡¡ta‡e Sharp MZ-800. Proto bychom v na¨em ‡aso­
pise r di p©ispˆli ke snaz¨¡  orientaci v t‚to problematice s‚ri¡
‡l nk–. V prvn¡ ‡ sti se sezn m¡me s mo‘nostmi manipulace s pamˆ­
Ÿov˜m prostorem.
   Po‡¡ta‡e Sharp  MZ-800 pat©¡ rozhodnˆ mezi  to nejlep¨¡, co se
v minul˜ch letech na na¨em po‡¡ta‡ov‚m r dobytrhu nab¡zelo. P©es­
to‘e  se v  sou‡asn‚ dobˆ  situace zlep¨ila  a pro ©adu u‘ivatel–
p©estal  b˜t probl‚mem  p©echod na  16 bit–,  majitel‚ MZ-800  se
s n¡m je¨tˆ nelou‡¡. Pro ty, kte©¡ by se o nˆm r di dozvˆdˆli nˆ­
co v¡ce, jsou ur‡eny n sleduj¡c¡ © dky.
   ¡k  se, ‘e srdcem po‡¡ta‡e  je mikroprocesor. V Sharpu m  Z80
silnou podporu  je¨tˆ v stov˜vodov‚m obvodu  GDG. Jeho schopnosti
jsou  plnˆ srovnateln‚  s kartou  CGA po‡¡ta‡–  PC. Um¡  zobrazit
320x200 nebo 640x200 obrazov˜ch bod– ve dvou a‘ ¨estn cti barv ch
(podle toho,  je-li osazena roz¨i©uj¡c¡ VRAM),  v textov‚m re‘imu
40x25 znak– v osmi barv ch.  D le umo‘¤uje hardwarov˜ scroll (po­
hyb obrazu)  a mapov n¡ v¨ech pamˆt¡  do adresov‚ho prostoru mik­
roprocesoru.
   D¡ky sv˜m  mo‘nostem zab¡r  GDG pomˆrnˆ  velk˜ po‡et bran mik­
roprocesoru Z80. Jeho popis zah j¡me  p©ehledem tˆchto bran s je­
jich v˜znamy. Nˆkter‚ z nich  maj¡ ¨estn ctibitov‚ adresy a ty je
pak nutn‚ adresovat pomoc¡ registru  BC. Adresy port– jsou v tab.
1.
   V m¢du MZ-700 je k dispozici nav¡c adresa (tentokr t pamˆŸov )
0E008H s nˆkter˜mi syst‚mov˜mi sign ly.

                         Mapov n¡ pamˆti
Je  v¨eobecnˆ zn mo,  ‘e  mikroprocesor  Z80 um¡  adresovat pamˆŸ
v maxim ln¡m rozsahu  64 KB. Sharp MZ-800  m  v¨ak 64 KB  RAM, 16
nebo 32 KB VRAM a 16 KB ROM,  tedy celkem a‘ 112 KB pamˆti. O to,
aby  se jednotliv‚  pamˆti na  sbˆrnici neh daly,  se star  pr vˆ
GDG. Cel˜  adresov˜ prostor mikroprocesoru  (64 KB) m–‘e  zab¡rat
pouze pamˆŸ  RAM (jak se  toho doc¡l¡ vysvitne  pozdˆji) a takov˜
stav  pova‘ujme  za  z kladn¡.  V  nˆkter˜ch oblastech adresov‚ho
prostoru v¨ak m–‘eme RAM zamˆnit jinou pamˆt¡. Ne‘ si zp–soby to­
hoto  tzv. mapov n¡  pamˆti pop¡¨eme,  rozdˆl¡me si adresovateln˜
prostor na nˆkolik logick˜ch ‡ st¡. Toto logick‚ dˆlen¡ je z vis­
l‚ na  nastaven‚m grafick‚m m¢du.  P©edev¨¡m si v¨imneme  rozd¡lu
mezi m¢dy  MZ-800 a MZ-700 (o  volbˆ m¢du si pov¡me  pozdˆji, zde
pouze upozor¤uji,  ‘e skute‡n˜ m¢d v  nˆm‘ po‡¡ta‡ pracuje, nijak
nez vis¡ na stavu p©ep¡na‡e 700/800 na zadn¡ stˆnˆ).
Rozdˆlme si tedy adresovateln˜ prostor nejprve v m¢du MZ-800:
   Adresy 0 a‘  0FFFH: oblast doln¡ ROM, m–‘eme  tam m¡sto pamˆti
RAM mapovat ROM s doln¡m monitorem.
   Adresy 1000H a‘ 1FFFH: oblast  CGROM, proto‘e RAM zde lze p©e­
p¡nat s  CGROM, kter  obsahuje definice  dvou sharpovsk˜ch znako­
v˜ch sad.
   Oblast 2000H a‘ 7FFFH ozna‡ovat  nebudeme, v‘dy v n¡ s¡dl¡ pa­
mˆŸ RAM.
   Na adrese 8000H za‡¡n  oblast VRAM, kam je mo‘n‚ podle pot©eby
mapovat videopamˆŸ  obsahuj¡c¡ to, co vid¡me  na obrazovce. D‚lka
t‚to oblasti z vis¡ na velikosti pameti VRAM a m¢du. P©i velikos­
ti 16 KB VRAM kon‡¡ na  adrese 9FFFH p©i pou‘it¡ roz¨i©uj¡c¡ VRAM
(celkem 32 KB VRAM) na 0BFFFH.
   Za koncem oblasti VRAM le‘¡ v‘dy RAM a‘ do adresy 0DFFFH.
   —sek 0E000H a‘ 0FFFFH: oblast horn¡ ROM, neboŸ si ji tam m–‘e­
me p©ipnout m¡sto RAM.
   Rozdˆlen¡ adresn¡ho prostoru platn‚  v MZ-700 m¢du je n sledu­
j¡c¡:
   Oblasti  doln¡ a  horn¡ ROM  i CGROM  jsou shodn‚ s p©edchoz¡m
p©¡padem.  Souvisl  oblast  RAM je  zde pouze  jedna na  adres ch
2000H a‘ 0BFFFH.
   PamˆŸov˜ £sek  0C000H a‘ 0CFFFH  nazveme oblast¡ CGRAM,  neboŸ
zde m–‘eme  hlavn¡ RAM zamˆnit jinou,  obsahuj¡c¡ definice znako­
v˜ch sad. Tato mo‘nost v m¢du MZ-800 neexistuje.
   Oblast VRAM le‘¡ od 0D000H do 0DFFFH.

                        Mo‘nosti mapov n¡
Vlastn¡    mapov n¡    se    prov d¡    instrukcemi   INşA,(port)
a OUTş(port),A, p©i‡em‘  na obsahu st©ada‡e  nez le‘¡. Pozor v¨ak
na to, ‘e instrukce IN zni‡¡ p©edchoz¡ obsah st©ada‡e.
   Instrukc¡ IN  A,(0E0H) p©ipneme v m¢du  MZ-800 do oblasti VRAM
pamˆŸ VRAM  a do oblasti CGROM  pamˆŸ CGROM. V m¢du  MZ-700 touto
instrukc¡ zapneme do  oblast¡ CGROM a CGRAM pamˆti  CGROM a CGRAM
(obr. 1).
   Instrukce OUT  (0E0H),A p©ipoj¡ do  oblast¡ doln¡ ROM  a CGROM
pamˆŸ RAM. Po t‚to instrukci bude RAM p©¡tomna na cel‚ spodn¡ po­
lovinˆ  adresov‚ho  prostoru.  Plat¡  pro  m¢d  MZ-800  i  MZ-700
(obr.ş1).
   Instrukce IN A,(0E1H) je inverzn¡ k IN A,(0E0H). V MZ-800 m¢du
p©ipoj¡ pamˆŸ RAM  do oblast¡ CGROM a nad VRAM,  v MZ-700 m¢du ji
p©ipoj¡ do oblast¡ CGROM a CGRAM (obr. 2).
   Nyn¡ je na  ©adˆ instrukce OUT (0E1H),A. V  MZ-800 m¢du pomoc¡
n¡ p©ipoj¡me do oblasti horn¡ ROM pamˆŸ RAM (obr. 2).
   Proveden¡m instrukce OUT (0E2H),A dojde k namapov n¡ doln¡ ROM
(obsahuj¡c¡ doln¡ monitor) do oblasti  doln¡ ROM (m  stejn˜ efekt
v obou m¢dech - obr. 3).
   OUT (0E3H),A  zap¡n  v m¢du MZ-800  horn¡ ROM obsahuj¡c¡ horn¡
monitor, IPL  a podporu pro  Basic do oblasti  horn¡ ROM. V  m¢du
MZ-700 zap¡n  nav¡c do oblasti VRAM pamˆŸ VRAM (obr. 4).
   Efekt instrukce OUT (0E4H),A  je ponˆkud specifick˜. P©i jej¡m
proveden¡ se v  m¢du MZ-800 namapuje do v¨ech  oblast¡, kde je to
mo‘n‚, jin   pamˆŸ ne‘ hlavn¡  RAM (tj. p©ipne  se horn¡ i  doln¡
ROM, d le  VRAM a CGROM). V  t‚to konfiguraci se MZ-800  octne po
zapnut¡  nebo  po  resetu  tla‡¡tkem  na  zadn¡  stˆnˆ p©¡stroje.
V MZ-700  je  efekt  podobn˜,  nep©ip¡naj¡  se  v¨ak pamˆti CGROM
a CGRAM (tak‘e p©ipnuty budou horn¡ a doln¡ ROM a VRAM - obr. 5).
   Z vˆrem  si v¨imnˆme  instrukc¡ OUT  (0E5H),A a  OUT (0E6H),A.
V˜znam prvn¡ spo‡¡v  v "chr nˆn¡  vrchu", druh  m  v˜znam opa‡n˜,
jej¡m proveden¡m  z¡sk me "stav p©ed  chr nˆn¡m vrchu" (obr.  6).
On¡m vrchem se rozum¡ v m¢du MZ-800 oblast od 0D000H do konce pa­
mˆti, v m¢du  MZ-700 od 0E000H do konce  pamˆti. Spojen¡ "chr nit
vrch" znamen ,  ‘e z oblasti vrchu  jsou odpojeny v¨echny vnit©n¡
pamˆti  po‡¡ta‡e, t¡m  je umo‘nˆno  tam namapovat  nˆjakou jinou,
vnˆj¨¡ pamˆŸ. Ta se o tom, ‘e se m–‘e p©ipojit na sbˆrnici, dozv¡
prost©ednictv¡m sign lu "INH5" p©¡stupn‚ho na v˜vodu ‡. 38 obvodu
GDG. Z toho, co jsme ©ekli,  je z©ejm‚, ‘e tyto dvˆ instrukce p©i
bˆ‘n‚m programov n¡ asi p©¡li¨ ‡asto nevyu‘ijeme.
   Na konci ‡ sti o mapov n¡ pamˆti alespo¤ jeden p©¡klad. Uka‘me
si t©eba, jak z¡sk me onˆch 64 KB RAM, kter‚ jsme na za‡ tku pok­
l dali za z kladn¡ stav. Tak tedy: sta‡¡ prov‚st sekvenci
OUT (0E1H),A ;vypnout horn¡ ROM
OUT (0E0H),A ;vypnout doln¡ ROM a CGROM
IN A,(0E1H) ;vypnout VRAM
   Tato sekvence sice plat¡ pro oba m¢dy, ale koment © se vztahu­
je jen k m¢du MZ-800. Hardwarov  mo‘nost namapov n¡ 64şKB RAM, se
provede podr‘en¡m kl vesy <Ctrl> a stiskem tla‡¡tka RESET na zad­
n¡m panelu po‡¡ta‡e.


Pavel Zakou©il studuje na Matematicko-fyzik ln¡ fakultˆ UK.




Literatura:
SHARP Service Manual - Personal Computer Model MZ-800
Ladislav Zaj¡‡ek: Bity do bytu
Personal Computer MZ-800 Technical Reference Manual
Petr  Odehnal, Martin  Veverka: SHARP  MZ-821, popis rezidentn¡ho
softwaru, z kladn¡ informace
RNDr. Ji©¡ B rta, Vladim¡r Nevoral: Syst‚mov‚ programov n¡ na po­
‡¡ta‡¡ch SHARP MZ-800
Ing. Martin V ¤a: SHARP; Mikrob ze 4/1988

@LH 3

@PA

@LH 6
ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³Adresa ³ V˜znam                                               ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0CCH  ³ Nastaven¡ re‘imu z pisu do VRAM (WF)                 ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0CDH  ³ Nastaven¡ re‘imu ‡ten¡ z VRAM (RF)                   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0CEH  ³ IN:  €ten¡ stavu obrazovky (synchronizace...)        ³
³       ³ OUT: Nastaven¡ m¢du zobrazen¡                        ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 01CFH ³ Registr posuvu p©i scrollu - doln¡ ‡ st (8 bit–)     ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 02CFH ³ Registr posuvu p©i scrollu - horn¡ dva bity          ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 03CFH ³ V˜¨ka posouvan‚ oblasti, 7 bit–                      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 04CFH ³ Po‡ tek posouvan‚ oblasti, 7 bit–                    ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 05CFH ³ Konec posouvan‚ oblasti, 7 bit–                      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 06CFH ³ Registr barvy okraje (border) obrazovky, 4 bity      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 07CFH ³ Tzv. "superimpose bit", je j¡m 7. bit                ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0E0H  ³ IN: zapnout VRAM (m¢d 800); zapnout CGRAM (700),     ³
³       ³     zapnout CGROM (oba m¢dy)                         ³
³       ³ OUT: zapnout RAM na spodnich 32 KB                   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0E1H  ³ IN: vypnout VRAM a CGROM (800);CGRAM a CGROM (700)   ³
³       ³ OUT:vypnout horn¡ ROM (800);horn¡ ROM a VRAM (700)   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0E2H  ³ OUT: zapnout doln¡ ROM (oba m¢dy)                    ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0E3H  ³ OUT: zapne horn¡ ROM, v m¢du 700 je¨tˆ VRAM a 82xx   ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0E4H  ³ OUT: kde je to mo‘n‚, zapne nˆco jin‚ho ne‘ RAM      ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0E5H  ³ OUT: zcela uvoln¡ horn¡ ‡ st adresov‚ho prostoru     ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0E6H  ³ OUT: provede n vrat do stavu p©edch zej¡c¡ho p©ed    ³
³       ³      u‘it¡m OUT (0E6H),A                             ³
ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0F0H  ³ Registry palet                                       ³
ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
@LH 3

@LH 6

 Tab. 1 Adresy port–, obsluhuj¡c¡ch GDG

@PA

                 IN A,(E0H)                        OUT (EOH),A

         MZ-700               MZ-800               MZ-700, 800

           :                    :            0000H ÚÄÄÄÄÄÄÄÄÄÄ¿
1000H ÚÄÄÄÄÄÄÄÄÄÄ¿   1000H ÚÄÄÄÄÄÄÄÄÄÄ¿            ³          ³
      ³  CG ROM  ³         ³  CG ROM  ³            ³          ³
1FFFH ÀÄÄÄÄÄÄÄÄÄÄÙ   1FFFH ÀÄÄÄÄÄÄÄÄÄÄÙ            ³   RAM    ³
           :                    :                  ³          ³
           :                    :            7FFFH ÀÄÄÄÄÄÄÄÄÄÄÙ
C000H ÚÄÄÄÄÄÄÄÄÄÄ¿   8000H ÚÄÄÄÄÄÄÄÄÄÄ¿                 :
      ³VRAM,CGRAM³         ³  VRAM 1  ³                 :
CFFFH ÀÄÄÄÄÄÄÄÄÄÄÙ   A000H ÃÄÄÄÄÄÄÄÄÄÄ´                 :
           :               ³  VRAM 2  ³
           :         BFFFH ÀÄÄÄÄÄÄÄÄÄÄÙ
                                :
                                :


Obr. 1 Stav pamˆti po aktivaci portu E0H.





               IN A,(E1H)                            OUT (E1H),A

        MZ-700             MZ-800                MZ-700             MZ-800

          :                  :                     :                  :
1000H ÚÄÄÄÄÄÄÄÄ¿   1000H ÚÄÄÄÄÄÄÄÄ¿                :                  :
      ³  RAM   ³         ³  RAM   ³      D000H ÚÄÄÄÄÄÄÄÄ¿             :
1FFFH ÀÄÄÄÄÄÄÄÄÙ   1FFFH ÀÄÄÄÄÄÄÄÄÙ            ³        ³   E000H ÚÄÄÄÄÄÄÄÄ¿
          :                  :                 ³  RAM   ³         ³        ³
          :                  :                 ³        ³         ³  RAM   ³
C000H ÚÄÄÄÄÄÄÄÄ¿   8000H ÚÄÄÄÄÄÄÄÄ¿      FFFFH ÀÄÄÄÄÄÄÄÄÙ   FFFFH ÀÄÄÄÄÄÄÄÄÙ
      ³  RAM   ³         ³        ³                :                  :
CFFFH ÀÄÄÄÄÄÄÄÄÙ         ³  RAM   ³                :                  :
          :              ³        ³
          :        BFFFH ÀÄÄÄÄÄÄÄÄÙ
                             :
                             :



Obr. 2 Stav pamˆti po aktivaci portu E1H.
@PA


      OUT (E2H),A

      MZ-700, 800

0000H ÚÄÄÄÄÄÄÄÄÄÄ¿
      ³   RAM    ³
0FFFH ÀÄÄÄÄÄÄÄÄÄÄÙ
          :
          :


Obr. 3 Stav pamˆti po aktivaci v˜stupn¡ho portu E2H.




               OUT (E3H),A

         MZ-700               MZ-800

           :                    :
           :                    :
D000H ÚÄÄÄÄÄÄÄÄÄÄ¿              :
      ³  CG ROM  ³              :
E000H ÃÄÄÄÄÄÄÄÄÄÄ´   E000H ÚÄÄÄÄÄÄÄÄÄÄ¿
      ³ MONITOR  ³         ³ MONITOR  ³
      ³   ROM    ³         ³   ROM    ³
FFFFH ÀÄÄÄÄÄÄÄÄÄÄÙ   FFFFH ÀÄÄÄÄÄÄÄÄÄÄÙ



Obr. 4  Stav pamˆti po aktivaci v˜stupn¡ho portu E3H.
@PA


               OUT (E4H),A

         MZ-700               MZ-800

0000H ÚÄÄÄÄÄÄÄÄÄ¿   0000H ÚÄÄÄÄÄÄÄÄÄ¿
      ³ MONITOR ³         ³ MONITOR ³
      ³   ROM   ³         ³   ROM   ³
1000H ÃÄÄÄÄÄÄÄÄÄ´   1000H ÃÄÄÄÄÄÄÄÄÄ´
      ³         ³         ³ CG ROM  ³
      ³         ³   2000H ÃÄÄÄÄÄÄÄÄÄ´
      ³         ³         ³         ³
      ³         ³         ³         ³
      ³         ³         ³   RAM   ³
      ³         ³         ³         ³
      ³   RAM   ³         ³         ³
      ³         ³   8000H ÃÄÄÄÄÄÄÄÄÄ´
      ³         ³         ³  VRAM 1 ³
      ³         ³   A000H ÃÄÄÄÄÄÄÄÄÄ´
      ³         ³         ³  VRAM 2 ³
      ³         ³   C000H ÃÄÄÄÄÄÄÄÄÄ´
D000H ÃÄÄÄÄÄÄÄÄÄ´         ³   RAM   ³
      ³  VRAM   ³         ³         ³
E000H ÃÄÄÄÄÄÄÄÄÄ´   E000H ÃÄÄÄÄÄÄÄÄÄ´
      ³ MONITOR ³         ³ MONITOR ³
      ³   ROM   ³         ³   ROM   ³
FFFFH ÀÄÄÄÄÄÄÄÄÄÙ   FFFFH ÀÄÄÄÄÄÄÄÄÄÙ



Obr. 5  Stav pamˆti po aktivaci v˜stupn¡ho portu E4H.


@PA


               OUT A,(E5H)                            OUT (E6H),A

        MZ-700             MZ-800                MZ-700             MZ-800

          :                  :                     :                  :
          :                  :                     :                  :
D000H ÚÄÄÄÄÄÄÄÄ¿             :           D000H ÚÄÄÄÄÄÄÄÄ¿             :
      ³        ³   E000H ÚÄÄÄÄÄÄÄÄ¿            ³        ³   E000H ÚÄÄÄÄÄÄÄÄ¿
      ³        ³         ³        ³            ³  STAV  ³         ³  STAV  ³
      ³CHRN‰N‹³         ³CHRN‰N‹³            ³  PED  ³         ³  PED  ³
      ³        ³         ³        ³            ³ CHRN‰-³         ³ CHRN‰-³
      ³ VRCHU  ³         ³ VRCHU  ³            ³  N‹M   ³         ³  N‹M   ³
      ³        ³         ³        ³            ³ VRCHU  ³         ³ VRCHU  ³
FFFFH ÀÄÄÄÄÄÄÄÄÙ   FFFFH ÀÄÄÄÄÄÄÄÄÙ      FFFFH ÀÄÄÄÄÄÄÄÄÙ   FFFFH ÀÄÄÄÄÄÄÄÄÙ


Obr. 6 Stav pamˆti po aktivaci port– E5H a E6H.

@LH 3




@LH 6

@PA
                      Stono‘ka v MZ-800 (2)
                         Pavel Zakou©il



Minule jsme si uk zali vyu‘it¡  z kaznick‚ho obvodu GDG pro mapo­
v n¡ pamˆti. T¡m v¨ak  nejsou zdaleka vy‡erp ny mo‘nosti speci l­
n¡ho obvodu se sty  no‘i‡kami. Dnes navazuje kapitola, zab˜vaj¡c¡
se problematikou volby m¢d– a o ulo‘en¡ obrazovky v pamˆti VRAM.

               Volba m¢du zobrazen¡ a pr ce s VRAM
  P©i volbˆ m¢du hraje kl¡‡ovou roli br na na adrese 0CEH ozna‡o­
van  jako  DMD - Display  MoDe register. V˜znam  maj¡ pouze doln¡
‡ty©i bity tohoto registru. Ka‘d˜ majitel MZ800 zn  mo‘n‚ grafic­
k‚  m¢dy alespo¤  z Basicu,  kde jsou  parametrem p©¡kazu INIT ve
formˆ "M1" a‘  "M4". Ve skute‡nosti je ¨k la  bohat¨¡, ale z vis¡
tak‚  na tom,  m me-li instalov nu  roz¨¡©enou VRAM.  M¢dy, kter‚
jsou dostupn‚ i bez n¡, jsou v tab. 1 ozna‡eny hvˆzdi‡kou. Nasta­
ven¡ m¢du prov d¡me posloupnost¡ instrukc¡:
LD A,m¢d
OUT (DMD),A
  Kdy‘ u‘ jsme u br ny 0CEH,  pod¡vejme se, co z¡sk me ‡ten¡m je­
j¡ho obsahu. Instrukc¡ IN  A,(0CEH) toti‘ nedostaneme zpˆt nasta­
ven˜ grafick˜ m¢d, ale obsah st©ada‡e bude m¡t n sleduj¡c¡ struk­
turu (viz tab.  2). Zat¡mco doln¡ ‡ty©i bity  nenajdou asi p©¡li¨
‡asto uplatnˆn¡, bez horn¡ch  ‡ty©ech by nebylo mo‘n‚ programovat
plynul˜ pohyb po obrazovce.
  Nyn¡ si  podrobnˆ pov¨imneme VRAM  a pop¡¨eme si  zp–soby pr ce
s n¡,  a to  nejprve v  m¢du MZ800,  tedy s grafick˜m zobrazen¡m:
kdy‘  jsme si  MZ800 p©inesli  z prodejny,  obsahoval kromˆ 64 KB
hlavn¡ RAM je¨tˆ 16 KB VRAM ale tak‚ dvˆ voln‚ patice, do kter˜ch
bylo mo‘no  zasunout dokoupen‚ obvody  81416 (41416, 4116,  41464
s organizac¡ 16k * 4 bity) a roz¨¡©it tak kapacitu VRAM na 32 KB.
Z ‡ sti ‡l nku pojedn vaj¡c¡ o mapov n¡ je v¨ak z©ejm‚, ‘e po na­
mapov n¡ zab¡r  VRAM maxim lnˆ 16 KB a v m¢du 320x200 dokonce jen
8 KB.  Proberme si  ©e¨en¡ tohoto  zd nliv‚ho rozporu  a sou‡asnˆ
s t¡m si uka‘me strukturu VRAM.
  e¨en¡ kapacitn¡ho rozporu je n sleduj¡c¡. K ‡ernob¡l‚mu zobra­
zen¡ 320x200 bod– pot©ebujeme 320x200=64000 bit–, to je 8000 baj­
t–.  Podobnˆ p©i  ‡ernob¡l‚m zobrazen¡  640x200 pot©ebujeme 16000
bajt–. Tady u‘ za‡¡n  vysv¡tat d–vod, pro‡ se VRAM mapuje v d‚lce
8 resp. 16 KB. 8 KB je  jak zn mo 8x1024B=8192B, co‘ uspokoj¡ n ¨
po‘adavek po  osmi tis¡c¡ch bajtech  a je¨tˆ zbyde  192 (384) pro
voln‚  pou‘it¡. Podobn   je situace  v m¢du  640x200. MZ-800 v¨ak
umo‘¤uje pr ci v  barv ch, co‘ by n ¨ model  nedovedl. Ne‘ se ale
barv m budeme vˆnovat, v¨imneme si uspo© d n¡ obsahu VRAM.
  Po namapov n¡  instrukc¡ IN A,(0E0H)  le‘¡ prvn¡ bajt  v po©ad¡
VRAM na adrese 8000H. Zaveƒme  si v na¨em ‡ernob¡l‚m modelu £mlu­
vu, ‘e bity rovn‚ jedni‡ce  zp–sob¡ rozsv¡cen¡ bodu a bity nulov‚
jeho zhasnut¡.  Potom se obsah  bitu 0 bajtu  na adrese 8000H  ve
VRAM  objev¡ v  lev‚m horn¡m  rohu obrazovky  jako sv¡t¡c¡ (resp.
nesv¡t¡c¡) bod (viz  obr. 1). To je podstatn˜  rozd¡l proti tomu,
jak  si bajt  zpravidla p©edstavujeme,  tj. nejvy¨¨¡  (sedm˜) bit
vlevo, a je to tedy p©esnˆ opa‡nˆ, ne‘ na zn m‚m ZX Spectru. Pok­
ra‡ujme ale dal¨¡mi obrazov˜mi body. Bit 1 se objev¡ vpravo tˆsnˆ
vedle nult‚ho,  vedle bit 2 atd.  a‘ jako osm˜ od  lev‚ho rohu se
objev¡  bit 7.  Pokra‡ov n¡ je  stejn‚ jako  na jin˜ch po‡¡ta‡¡ch
- vpravo  od p©edchoz¡  osmice se  stejn˜m zp–sobem  zobraz¡ bajt
z adresy  8001H atd.  a‘ do  po‡tu bajt–  na jeden grafick˜ © dek
(ten  je shodn˜  s po‡tem  znak– na  © dek, tj.  je roven  40 pro
320x200 a 80 pro 640x200). N sleduje p©echod na nov˜ grafick˜ © ­
dek p©esnˆ tak, jak n m napov¡d  zdrav˜ dru‘stevn¡ rozum, tj. ob­
sah adresy 8000H+40 (nebo 80) se objev¡ p©esnˆ pod obsahem adresy
8000H. Tento  postup plat¡ pro celou  obrazovku, neexistuje ‘ dn‚
protivn‚ dˆlen¡ na t©etiny a jin‚ lump rny zn m‚ ze Spectra.
  Doposud jsme uva‘ovali pouze ‡ernob¡l˜ obraz, teƒ se pod¡vejme,
jak se situace "zkomplikuje"  p©id n¡m barev. V ‡ernob¡l‚m modelu
jsme uva‘ovali,  ‘e ka‘d‚mu bodu  na obrazovce je  p©i©azen jeden
bit ve VRAM.  F¡gl je v tom, ‘e jednomu  obrazov‚mu bodu je mo‘n‚
p©i©adit v¡ce  bit– (v na¨em p©¡padˆ  a‘ ‡ty©i) a z¡skat  tak pro
ka‘d˜ z bod– v¡ce mo‘n˜ch barev (a‘ 16).
  Situace vypad   takto. Videoram je  v‘dy rozdˆlena do  nˆkolika
rovin (anglicky "Plane") o d‚lce shodn‚ s d‚lkou namapovan‚ VRAM.
M–‘eme si p©edstavit, ‘e v t‚to  oblasti le‘¡ ne jedna, ale nˆko­
lik rovin VRAM na sobˆ. M me-li nap©. dvˆ roviny (obr. 2), ka‘d‚­
mu obrazov‚mu bodu odpov¡daj¡ dva bajty ve VRAM, kombinac¡ jejich
bit–  vznik  p©¡slu¨n   barva.  Jejich  kombinace (je  to vlastnˆ
dvoubitov‚ ‡¡slo) ur‡uje ‡¡slo barvy  dan‚ho bodu. Jak ale m–‘eme
m¡t na  jedn‚ adrese dva bajty,  i kdy‘ jen jakoby?  K odstranˆn¡
tohoto paradoxu m  GDG dva registry: registr form tu z pisu (Wri­
te Format  register - WF) na  br nˆ 0CCH a registr  form tu ‡ten¡
(Read Format register - RF) na br nˆ 0CDH. Abychom sn ze pochopi­
li jejich funkci,  seznamme se nejprve s rozdˆlen¡m  rovin v jed­
notliv˜ch m¢dech.
  Ji‘ bylo uvedeno, ‘e roviny  jsou maxim lnˆ ‡ty©i a po‡¡ta‡ bez
roz¨¡©en‚ VRAM obsahuje pouze dvˆ. V  m¢du 0 m me k dispozici ro­
viny 1 a  2,v m¢du 1 rov. 3  a 4,v m¢du 2 rov.  1,2,3,4, v m¢du 4
rovinu 1, v  m¢du 5 rovinu 3 a v  m¢du 6 roviny 1 a 3  (na to po­
zor!).
  Teƒ si v¨imnˆme struktury WF.  Doln¡ ‡ty©i bity ur‡uj¡, do kte­
r˜ch rovin  se bude zapisovat  (proto p©i vlastn¡m  z pisu nevad¡
jejich adresov‚  p©ekr˜v n¡) co‘ je shodn‚  s ur‡en¡m ‡¡sla barvy
(p©esnˆji  palety),  kterou  se   zapisuje.  Bit  4  ur‡uje  sadu
(A/B-viz nastavov n¡ m¢d–), do kter‚ se bude zapisovat, horn¡ t©i
bity definuj¡  re‘im, ve kter‚m bude  z pis prob¡hat. Ozna‡¡me-li
tyto  t©i bity  jako WMD  (Write MoDe),  m–‘eme podle hodnoty WMD
rozli¨it dva  druhy z pisu: pro  WMD 0 a‘  3 se jedn   o z pis do
jednotliv˜ch rovin, pro  WMD 4 a‘ 7 jde  o z pis ve specifikovan‚
barvˆ. Popis funkce registru WMD naleznete v tab. 3.
  Struktura registru RF je  n sleduj¡c¡. Existuj¡ dva druhy ‡ten¡
z VRAM, rozli¨en‚ hodnotou nejvy¨¨¡ho bitu v RF. Pro nejvy¨¨¡ bit
rovn˜ nule se  jedn  o p©¡m‚ ‡ten¡ z jedn‚  nebo v¡ce rovin ur‡e­
n˜ch spodn¡mi ‡ty©mi bity RF.  Pokud ‡teme z v¡ce rovin najednou,
prov d¡ se mezi daty z jednotliv˜ch rovin operace AND. M -li nej­
vy¨¨¡  bit RF  hodnotu 1,  jde o  tzv. ‡ten¡ specifikovanˆ barvy.
V tomto p©¡padˆ budou ve ‡ten˜ch datech jedni‡kov‚ bity odpov¡da­
j¡c¡ bod–m maj¡c¡m barvu shodnou  s barvou nastavenou ve spodn¡ch
‡ty©ech  bitech RF,  ostatn¡ bity  budou nulov‚.  Je t©eba  je¨tˆ
uv‚st,  ‘e bit  4 m   opˆt  v˜znam  p©ep¡na‡e sady  (B/A) a  bity
5 a 6 v˜znam nemaj¡.
                                          (Pokra‡ov n¡)


Literatura:
SHARP Service Manual - Personal Computer Model MZ-800
Ladislav Zaj¡‡ek: Bity do bytu
Personal Computer MZ-800 Technical Reference Manual
Petr  Odehnal, Martin  Veverka: SHARP  MZ-821, popis rezidentn¡ho
softwaru, z kladn¡ informace
RNDr. Ji©¡ B rta, Vladim¡r Nevoral: Syst‚mov‚ programov n¡ na po­
‡¡ta‡¡ch SHARP MZ-800
Ing. Martin V ¤a: SHARP; Mikrob ze 4/1988
@LH 3


@PA
@LH 6
ÚÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³M¢d ³ V˜znam                                                   ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0* ³ Odpov¡d  basicov‚mu M1 (320x200 bod– ve ‡ty©ech barv ch),³
³    ³ zobrazuje se sada A.                                     ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 1  ³ Nen¡ z Basicu p©¡stupn˜ a vy‘aduje roz¨¡©enou VRAM.      ³
³    ³ Graficky je shodn˜ s p©edchoz¡m, av¨ak zobrazovat se bude³
³    ³ tzv. sada B. To znamen , ‘e k dispozici m me vlastnˆ dvˆ ³
³    ³ nez visl‚ obrazovky, ka‘dou s 320x200 body a ‡ty©mi      ³
³    ³ barvami. Pracovat m–‘eme s libovolnou z obou sad (A a B),³
³    ³ tedy i s tou, kter  se nezobrazuje. Kterou ze sad chceme ³
³    ³ pr vˆ zobrazit, zvol¡me pr vˆ hodnotou m¢du.             ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 2  ³ Odpov¡d  basicov‚mu M2 (320x200, 16 barev). K dispozici  ³
³    ³ je pouze jedna sada (na druhou nezb˜v  m¡sto) ozna‡en  A.³
³    ³ Toto ozna‡en¡ m  sv–j v˜znam, jak uvid¡me d le.          ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 3  ³ Nem  v˜znam.                                             ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 4* ³ Odpov¡d  M3 v Basicu, tj. 640x200 bod– ve dvou barv ch,  ³
³    ³ zobrazuje se sada A.                                     ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 5  ³ Tot‚‘, ale sada B, v basicu nem  ekvivalent.             ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 6  ³ Odpov¡d  M4 v basicu, tj. 640x200, 4 barvy, sada A.      ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 7  ³ Nepou‘¡v  se.                                            ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 8  ³ Re‘im MZ700. Nastaven¡m tohoto m¢du se zmˆn¡ vlastnosti  ³
³    ³ mapov n¡ pamˆti i vlastnosti a rozdˆlen¡ VRAM. Skute‡n˜  ³
³    ³ stav po‡ita‡e (tj. zda emuluje MZ700) se nastavuje pr vˆ ³
³    ³ touto hodnotou, nikoli p©ep¡na‡em na zadn¡ stˆnˆ, jak    ³
³    ³ uv d¡ manu l.                                            ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ >8 ³ Bˆ‘nˆ se nepou‘¡v , je v¨ak mo‘n‚ dos hnout zaj¡mav˜ch   ³
³    ³ v˜sledk–. Jmenovitˆ lze z¡skat 80 znak– na © dek v m¢du  ³
³    ³ 700, tedy p©i znakov‚m rozdˆlen¡ VRAM.                   ³
@LH 3
ÀÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
@LH 6

@LH 3
Tab. 1. Mo‘nosti nastaven¡ m¢d– u MZ-800.
@PA

@LH 6
ÚÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³Bit³ V˜znam                                                   ³
ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 0 ³ Tzv. frekvence TEMP (generovan  obvodem 556, obvykle se  ³
³   ³ nevyu‘¡v ).                                              ³
ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 1 ³ Stav p©ep¡na‡e MZ700 na zadn¡ stˆnˆ po‡¡ta‡e, hodnota 0  ³
³   ³ odpov¡d  stavu ON. Kdy‘ Monitor startuje nˆjak˜ program, ³
³   ³ nastav¡ do DMD hodnotu podle tohoto bitu.                ³
ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 2 ³ M  trvale hodnotu 0.                                     ³
ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 3 ³ M  trvale hodnotu 0.                                     ³
ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 4 ³ Indikace sn¡mkov‚ synchronizace, aktivn¡ je v 0.         ³
ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 5 ³ Indikace © dkovˆ synchronizace, aktivn¡ je v 0.          ³
ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 6 ³ Indikace sn¡mkov‚ho zatem¤ov n¡, aktivn¡ 0.              ³
ÃÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ 7 ³ Indikace © dkov‚ho zatem¤ov n¡, aktivn¡ 0.               ³
@LH 3
ÀÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
 Tab. 2. V˜znam jednotliv˜ch bit– p©i ‡ten¡ z portu 0CEH.
@PA

@LH 6
ÚÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³ Hodnota ³                                                    ³
³   WMD   ³ Funkce                                             ³
ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³    0    ³ Zapisovan  data se do ur‡en˜ch rovin ulo‘¡ p©esnˆ  ³
³         ³ tak, jak je tam pos¡l me (do VRAM zapisujeme stej- ³
³         ³ nˆ, jako do oby‡ejn‚ pamˆti). To je vhodn‚ p©edev- ³
³         ³ ¨¡m pro p©¡m˜ p©esun do VRAM (t©eba z kazety), ne- ³
³         ³ n¡ vhodn‚ pro kreslen¡.                            ³
ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³    1    ³ Se zapisovan˜mi daty a daty ve VRAM se nejprve     ³
³         ³ provede operace v˜bˆrov‚ho logick‚ho sou‡tu (XOR)  ³
³         ³ a takto z¡skan˜ v˜sledek se ulo‘¡ do VRAM.         ³
ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³    2    ³ Tot‚‘, ale prov d¡ se logick˜  sou‡et (OR).        ³
ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³    3    ³ Tot‚‘, prov d¡ se operace NOT (zapisovan  data)    ³
³         ³ AND (data ve VRAM). V˜sledek je shodn˜ jako u p©¡- ³
³         ³ kazu RESET v Basicu.                               ³
ÃÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ Je z©ejm‚, ‘e m¢dy 1-3 z pisu jsou vhodn‚ pro kreslen¡ bod–, ³
³ ‡ar atd.                                                     ³
ÃÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³   4,5   ³ V tomto m¢du (ozna‡ovan‚m REPLACE) se jedni‡ky za- ³
³         ³ pisovan˜ch dat ulo‘¡ do VRAM v barvˆ dan‚ doln¡mi  ³
³         ³ ‡ty©mi bity WF a nuly se zap¡¨¡ jako barva 0. Toto ³
³         ³ je vhodn‚ pro z pis textu na pozad¡ v barvˆ 0 (ob- ³
³         ³ vykle ‡ern‚).                                      ³
ÃÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³   6,7   ³ Tzv. m¢d PSET. Jedni‡ky v zapisovan˜ch datech se   ³
³         ³ do VRAM zap¡¨¡ jako body v barvˆ dan‚ spodn¡mi     ³
³         ³ ‡ty©mi bity WF, nuly obsah VRAM nemˆn¡. Vhodn‚     ³
³         ³ pro z pis textu na barevn‚ pozad¡ i pro grafiku.   ³
ÀÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

Tab. 3. Funkce registru WMD.
@LH 3

@PA
@LH 6
OBRAZOVKA

Horn¡ lev˜ roh zobrazovan‚ oblasti (obrazovky - A0) =

bod o sou©adnic¡ch X=0, Y=0


   ³<ÄÄÄ adr. 8000H  ÄÄÄÄÄ>³<ÄÄÄ adr. 8001H ....
   ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂ
   ³A0³A1³A2³A3³A4³A5³A6³A7³B0³B1³B3³B4³B5³ .... 1. © dek obrazovky
   ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁ

   ³<ÄÄ adr. 8000H+40D ÄÄÄ>³<ÄÄÄ adr. 8001H+40D ....p©i 40 zn./©.
   ³<ÄÄ adr. 8000H+80D ÄÄÄ>³<ÄÄÄ adr. 8001H+80D ....p©i 80 zn./©.
   ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂ
   ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³ .... 2. © dek obrazovky
   ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁ
@LH 3

Bod A0 na obrazovce sv¡t¡, je-li na adrese 8000H v bitu A0 "I".
@LH 6


PAM‰† VRAM

        ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿
8000H:  ³A7³A6³A5³A4³A3³A2³A1³A0³
        ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙ

        ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿
8001H:  ³B7³B6³B5³B4³B3³B2³B1³B0³
        ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙ


8002H:   atd....
@LH 3


@LH 6
Obr. 1. Rozlo‘en¡ obrazov˜ch bod– na obrazovce a v pamˆti
@PA

OBRAZOVKA

Horn¡ lev˜ roh zobrazovan‚ oblasti (obrazovky - a0) =

bod o sou©adnic¡ch X=0, Y=0

ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂ
³a0³a1³a2³a3³a4³a5³a6³a7³b0³b1³b3³b4³b5³....
ÃÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅ
³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³
ÃÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅÄÄÅ

@LH 3

Barva bodu a0: A0 OR X0      (kombinace 00,0I,I0,II)
           a1: A1 OR X1
           a2: atd...
@LH 6

PAM‰† VRAM
@LH 3

        ROVINA 1                             ROVINA 2
@LH 6

        ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿            ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿
AdrR1+0 ³A7³A6³A5³A4³A3³A2³A1³A0³    AdrR2+0 ³X7³X6³X5³X4³X3³X2³X1³X0³
        ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙ            ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙ

        ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿            ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿
AdrR1+1 ³B7³B6³B5³B4³B3³B2³B1³B0³    AdrR2+1 ³Y7³Y6³Y5³Y4³Y3³Y2³Y1³Y0³
@LH 3
        ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙ            ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙ
@LH 6

AdrR1+2    atd....                   AdrR2+2

@LH 3

AdrR1 ... Adresa, kde za‡¡n  rovina (Plane) 1
AdrR2 ... Adresa, kde za‡¡n  rovina (Plane) 2

@LH 6
Obr. 2. €ty©i barvy na obrazovce - kombinace dvou rovin VRAM.




@PA
                  Commodore - rady za‡ te‡n¡k–m
                         Karel KLEISNER



V posledn¡ch letech se u n s  st le v¡ce roz¨i©uj¡ po‡¡ta‡e firmy
Commodore. Nejen velmi popul rn¡ C64,  ale i r–zn‚ typy p©¡stroj–
©ady AMIGA a PC kompatibiln¡. P©i jejich vzr–staj¡c¡ch po‡tech se
mno‘¡ i po‡ty oprav tˆchto za©¡zen¡  a st le ve vˆt¨¡ m¡©e se ob­
jevuj¡  z vady, kter‚  si  zp–sobuj¡  sami u‘ivatel‚.  Jde hlavnˆ
o C64, kter˜ je u n s hojnˆ roz¨¡©en a v p©eva‘uj¡c¡ vˆt¨inˆ obs­
luhov n dˆtmi. Ka‘d˜ by si  mˆl uvˆdomit, ‘e obsluha takov‚ho za­
©¡zen¡ vy‘aduje dodr‘ov n¡ ur‡it˜ch z kladn¡ch pravidel.
   Prvn¡m z nich je  spr vn  instalace kabel–, propojuj¡c¡ch jed­
notliv‚ komponenty sestavy. U typu C64 se to t˜k  kabelu nap jen¡
(od  s¡Ÿov‚ho zdroje  k po‡¡ta‡i),  kter˜ m   podobn˜ konektor se
vstupem audio/video a p©i pou‘it¡  m¡rn‚ho n sil¡ se ho poda©¡ do
tohoto vstupu zasunout. Je  nanejv˜¨ pravdˆpodobn‚, ‘e takto ins­
talovan‚ za©¡zen¡ po p©ipojen¡ na s¡Ÿ vypov¡ sv‚ slu‘by. V nˆkte­
r˜ch p©¡padech ji‘ oprava nen¡ rentabiln¡, proto‘e by se jej¡ ce­
na bl¡‘ila cenˆ nov‚ho po‡¡ta‡e.  Stejn‚ho efektu je mo‘no dos h­
nout p©ipojen¡m nap jec¡ho konektoru do spr vn‚ z suvky, ale oto­
‡en‚ho o 180 stup¤–.
   Do t‚to  kategorie z vad pat©¡  tak‚ p©ipojov n¡ a  odpojov n¡
r–zn˜ch perif‚ri¡ (kaz. pamˆti,  floppy disku, tisk rny apod.) za
provozu po‡¡ta‡e, a to i p©es d–razn‚ varov n¡, oti¨tˆn‚ t‚mˆ© ve
v¨ech manu lech, dod van˜ch s p©¡strojem.
   Tak‚ absence tla‡¡tka "reset" u C64 je zdrojem mnoha probl‚m–.
Obsluha se toti‘ sna‘¡  dos hnout stejn‚ funkce nˆkoliker˜m rych­
l˜m   vypnut¡m  a   zapnut¡m  po‡¡ta‡e.   Vyjde  daleko  levnˆji,
nech me-li si zm¡nˆn‚ tla‡¡tko  odbornˆ nainstalovat, ne‘ neust ­
l˜m vyp¡n n¡m zni‡it obvody po‡¡ta‡e.
   D–vody nˆkter˜ch z  tˆchto z vad se zdaj¡ na  prvn¡ pohled ne­
pochopiteln‚, ale  p©i zhruba dvoulet‚ praxi  v Commodore servisu
se ukazuje, ‘e tvo©¡ p©ibli‘nˆ 50 procent v¨ech oprav.
   Dal¨¡ ‡tvrtinu  nefunguj¡c¡ch po‡¡ta‡– m   na svˆdom¡ kol¡s n¡
napˆt¡ a napˆŸov‚ ¨pi‡ky v na¨¡ rozvodn‚ s¡ti. Zvl ¨tˆ ve star˜ch
rozvodech nejsou v˜jimkou kr tkodob‚ v˜kyvy napˆt¡ pod 200 V nebo
naopak nad 240 V. Na to jsou obzvl ¨Ÿ citliv‚ zdroje C64 a sp¡na­
n‚ zdroje, pou‘¡van‚ v Commodore PC-1. Poslednˆ jmenovan˜ po‡¡ta‡
nem  na rozd¡l  od ostatn¡ch typ– pou‘it ve  sv‚m zdroji ventil ­
tor, proto nˆkdy doch z¡ p©i del¨¡m pou‘¡v n¡ k p©eh© t¡ a zni‡e­
n¡ zdroje. Zcela jin  situace  je ve v¨ech typech po‡¡ta‡– Commo­
dore kategori¡ AMIGA a PC kompatibiln¡. Tyto p©¡stroje jsou velmi
spolehliv‚  a vˆt¨ina  jich je  v provozu  nˆkolik let  bez z vad
i bez bˆ‘n‚  £dr‘by. Zde se tˆ‘i¨tˆ  probl‚m– p©esouv  do oblasti
softwaru, proto‘e provozovan‚ programy nejsou v‘dy nabyt‚ leg ln¡
cestou. St le se tedy objevuj¡ nov‚ viry, kter‚ pak vyu‘it¡ po‡¡­
ta‡– komplikuj¡.

Ing. Karel Kleisner pracuje  v soukrom‚ opravnˆ po‡¡ta‡– Commodo­
@LH 4
re.
@PA
@LH 6
                         Commodore AMIGA
@LH 4
                     Tajemn˜ FastFileSystem


@LH 6

Na syst‚mov‚ disketˆ  Workench (verze 1.3 a v˜¨e)  je dod v n al­
ternativn¡ diskov˜ syst‚m s  n zvem FastFileSystem, zkr cenˆ FFS.
P©i ‡ten¡  standardn¡ p©¡ru‡ky (AmigaDOS1.3) se  v¨ak dozv¡me, ‘e
syst‚m je ur‡en pouze pro u‘ivatele  s pevn˜m diskem a tedy pouze
oni mohou vyu‘¡t jeho v˜hod tj. zv˜¨enou kapacitu media (o 50 KB)
a rychlost validace disku (a‘ 4 kr t).
   Po  p©e‡ten¡ tˆchto  informac¡ se  u‘ivatel bez  pevn‚ho disku
p©estane o FFS zaj¡mat. Ale jak  to chyba! FFS toti‘ pracuje i na
norm ln¡m pru‘n‚m disku, p©i‡em‘  si zachov v  v˜¨e popsan‚ v˜ho­
dy, ale z rove¤ se projev¡ i jeho nev˜hody tj. nemo‘nost bootov ­
n¡ syst‚mu  z FFS diskety  a pracn  inicializace.  Prvn¡ nev˜hoda
nen¡ a‘ tak z va‘n , syst‚m je mo‘no zav‚st z jin‚ diskety. Druh 
je v¨ak podstatnˆj¨¡ a vy‘aduje,  aby se u‘ivatel £‡astnil insta­
lace FFS. Tyto vlastnosti se na pevn‚m disku neprojev¡, neboŸ ten
je mo‘no rozdˆlit na "norm ln¡" ‡ st, kter  obstar  instalaci FFS
ve druh‚  ‡ sti. Pro ty, kte©¡  si chtˆj¡ vyzkou¨et FFS  v praxi,
uv d¡m pr–bˆh instalace Fast File Systemu na disketu.
   Nahrajeme Workbench  a otev©eme si Shell  (Cli). Prvn¡m krokem
je  £prava textov‚ho  instala‡n¡ho souboru  Mountlist v  adres ©i
Devs:. Tento soubor nahrajeme do libovoln‚ho editoru (nap©. Ed na
WB) a nap©¡klad nakonec, vep¡¨eme textovou definici z obr. 1, kde
F0: je  n zev za©¡zen¡, pod  kter˜m bude FastFileSystem  evidov n
v syst‚mu. Toto ozna‡en¡ m–‘e b˜t libovoln‚, nesm¡ v¨ak kolidovat
s jin˜m n zvem v Mountlistu.
   M me-li  v¡ce diskov˜ch  jednotek, m–‘eme  FFS nainstalovat na
libovolnou z nich  pomoc¡ Unit = x, kde x  je ‡¡slo jednotky. Po­
lo‘kou Buffers mˆn¡me velikost cache pamˆti pro p©¡stup na disk.
   Upraven˜ soubor nahrajeme zpˆt do Devs: a zavedeme FFS do sys­
t‚mu pomoc¡ p©¡kazu Mount:
1. Mount F0:
   (F0: je n zev za©¡zen¡ z Mountlistu - mus¡ se shodovat).

   Definici jsme tak‚ mohli  zapsat do libovoln‚ho textov‚ho sou­
boru a pak FFS zavedeme takto: Mount F0: from MaDefinice
   kde MaDefinice je n zev textov‚ho souboru s uvedenou definic¡.

   Nyn¡ naform tujeme pr zdnou disketu pod FFS, a to p©¡kazem:
2. Format drive F0: name MujDisk ffs
(po vyzv n¡ vlo‘¡me pr zdnou disketu a stiskneme RETURN).
   Po naform tov n¡  se zobraz¡ ikona s  n zvem MujDisk, s kterou
m–‘eme pracovat bˆ‘n˜m zp–sobem.
   T¡m jsme z¡skali disketu, kter  m  skoro o 50 KB vˆt¨¡ kapaci­
tu (898 048  B m¡sto 855 952 B)  a pr ce se soubory je  o 20-100%
rychlej¨¡.
   V  p©¡padˆ, kdy  chceme vyu‘¡vat  tuto disketu,  mus¡me m¡t na
disketˆ, z kter‚ startujeme tyto soubory:
Mount, DiskChange, L:FastFileSystem a  soubor s definic¡ za©¡zen¡
(vˆt¨inou Devs:Mountlist).
Pak provedeme tuto sekvenci p©¡kaz–:
1. Mount F0: (p©¡padnˆ Mount F0: from MaDefinice), tento p©¡kaz
    m–‘eme um¡stit do s:startup-sequence
2. vlo‘¡me FFS disketu
3. DiskChange F0:
   Nyn¡ ji‘ m–‘eme pou‘¡t dal¨¡ p©¡kazy pro pr ci s diskem a nor­
m ln¡ disketu a FFS disketu  rozli¨ujeme pomoc¡ DF0: a F0: nap©.:
List DF0: a List F0:
   FastFileSystem podporuje i p©¡kaz  DiskDoctor a d¡ky pru‘nosti
AmigaDOSu i vˆt¨ina ostatn¡ch program– sama rozpozn  nov‚ za©¡ze­
n¡ (nap©. DiskMaster vyhrad¡ jeden gadget pro F0:)


@PA
obr. 1








F0:
    Device     = trackdisk.device
    FileSystem     = l:FastFileSystem
    Unit = 0
    Flags = 1
    Surfaces  = 2
    BlocksPerTrack = 11
    Reserved = 2
    Interleave = 0
    LowCyl = 0 ;  HighCyl = 79
    Buffers = 20
    GlobVec = -1
    BufMemType = 3
    Mount = 1
    DosType = 0x444F5301
    StackSize = 4000
@LH 4
#



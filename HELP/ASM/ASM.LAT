**************************************************************************
ASM.HLP                                                            ASM.HLP


                                Obsah


     Kapitola 1  évod do programovac¡ho jazyka assembler             5
        Hlavn¡ vìhoda - rychlost a pý¡m‚ ý¡zen¡  . . . . . . . . . . 6
        Rodina mikroprocesor… 80286/80386  . . . . . . . . . . . . . 7
        Co budete schopni zvl dnout ihned po pýeŸten¡ t‚to knihy . . 8
        Co tato kniha pýedpokl d  o v s  . . . . . . . . . . . . . . 8

     Kapitola 2  ¬¡seln‚ soustavy                                    9
        Bin rn¡ Ÿ¡sla  . . . . . . . . . . . . . . . . . . . . . . . 9
        Bin rn¡ seŸ¡t n¡ a odeŸ¡t n¡ . . . . . . . . . . . . . . .  11
        Datovì typ BYTE  . . . . . . . . . . . . . . . . . . . . .  12
        Datovì typ CHARACTER . . . . . . . . . . . . . . . . . . .  12
        ¬¡sla se znam‚nkem . . . . . . . . . . . . . . . . . . . .  13
        Dvojkovì doplnØk (two's complement)  . . . . . . . . . . .  14
        Rozç¡ýen¡ znam‚nkov‚ho bitu  . . . . . . . . . . . . . . .  15
        Hexadecim ln¡ Ÿ¡sla  . . . . . . . . . . . . . . . . . . .  16
        Slova (words)  . . . . . . . . . . . . . . . . . . . . . .  17
        Dvouslova (doublewords)  . . . . . . . . . . . . . . . . .  18
        Nestandardn¡ pole bit… . . . . . . . . . . . . . . . . . .  19
        Bin rn¡ operace  . . . . . . . . . . . . . . . . . . . . .  20

     Kapitola 3  Adresovac¡ techniky                                23
        Bezprostýedn¡ adresov n¡ . . . . . . . . . . . . . . . . .  23
        Registrov‚ adresov n¡  . . . . . . . . . . . . . . . . . .  24
        Pý¡m‚ adresov n¡ . . . . . . . . . . . . . . . . . . . . .  24
        Registrov‚ nepý¡m‚ adresov n¡  . . . . . . . . . . . . . .  25
        B zov‚ relativn¡ adresov n¡  . . . . . . . . . . . . . . .  26
        Pý¡m‚ indexov‚ adresov n¡  . . . . . . . . . . . . . . . .  27
        B zov‚ indexov‚ adresov n¡ . . . . . . . . . . . . . . . .  27
        Extenze u 80386  . . . . . . . . . . . . . . . . . . . . .  28

     Kapitola 4  Programovac¡ styl                                  29
              Pole jm‚na (n vØçt¡) . . . . . . . . . . . . . . . .  29

     Kapitola 5  évod do assembleru                                 35
        Strojovì k¢d versus jazyk symbolickìch instrukc¡ . . . . .  36
        Typickì proces pýi vìstavbØ program… v assembleru  . . . .  37
        Programov  re§ie . . . . . . . . . . . . . . . . . . . . .  39

     Kapitola 6  ARCHITEKTURA : REGISTRY, PüÖZNAKY A INSTRUKCE      43
        Mikroprocesor 80286  . . . . . . . . . . . . . . . . . . .  43
        Z kladn¡ architektura  . . . . . . . . . . . . . . . . . .  43
        Segmentov‚ registry  . . . . . . . . . . . . . . . . . . .  44
        Indexov‚ a b zov‚ registry. Registry ukazatele . . . . . .  44
        ü¡dic¡ registry a registry stavu (FLAGS) . . . . . . . . .  45
        Registr adresy instrukce (instruction pointer) . . . . . .  46
        Stavov‚ slovo procesoru (machine status word ) . . . . . .  46



                                     i 




        Mikroprocesor 80386  . . . . . . . . . . . . . . . . . . .  46
        Datov‚ typy 80386  . . . . . . . . . . . . . . . . . . . .  47
        Adresov n¡ operand… u 80386  . . . . . . . . . . . . . . .  47
        VìpoŸet efektivn¡ adresy u 80386 . . . . . . . . . . . . .  47
        Prov dØn¡ k¢du mikroprocesoru 8086 na 80386  . . . . . . .  47
        Z kladn¡ architektura Ÿipu 80386 . . . . . . . . . . . . .  48
        Soubor vçeobecnìch registr…  . . . . . . . . . . . . . . .  48
        Segmentov‚ registry  . . . . . . . . . . . . . . . . . . .  48
        Registr adresy instrukce a EFLAGS  . . . . . . . . . . . .  49
        ü¡dic¡ registry  . . . . . . . . . . . . . . . . . . . . .  49
        Registry syst‚movìch adres . . . . . . . . . . . . . . . .  50
        Ladic¡ a trasovac¡ registry  . . . . . . . . . . . . . . .  50
        Zpracov n¡ vìjimeŸnìch stav… u 80286/80386 . . . . . . . .  50

     Kapitola 7  InstrukŸn¡ soubor mikroprocesor… 80286/80386       53
           AAA (80286/80386) . . . . . . . . . . . . . . . . . . .  53
           AAD (80286/80386) . . . . . . . . . . . . . . . . . . .  53
           AAM (80286/80386) . . . . . . . . . . . . . . . . . . .  54
           AAS (80286/80386) . . . . . . . . . . . . . . . . . . .  55
           ADC (80286/80386) . . . . . . . . . . . . . . . . . . .  55
           ADD (80286/80386) . . . . . . . . . . . . . . . . . . .  56
           AND (80286/80386) . . . . . . . . . . . . . . . . . . .  57
           ARPL (80286/80386)  . . . . . . . . . . . . . . . . . .  58
           BOUND (80286/80386) . . . . . . . . . . . . . . . . . .  59
           CALL (80286/80386)  . . . . . . . . . . . . . . . . . .  59
           CBW (80286/80386) . . . . . . . . . . . . . . . . . . .  61
           CLC (80286/80386) . . . . . . . . . . . . . . . . . . .  61
           CLD (80286/80386) . . . . . . . . . . . . . . . . . . .  62
           CLI (80286/80386) . . . . . . . . . . . . . . . . . . .  62
           CLTS (80286/80386)  . . . . . . . . . . . . . . . . . .  63
           CMC (80286/80386) . . . . . . . . . . . . . . . . . . .  63
           CMP (80286/80386) . . . . . . . . . . . . . . . . . . .  64
           CMPS/CMPSB/CMPSW (80286/80386)  . . . . . . . . . . . .  65
           CWD (80286/80386) . . . . . . . . . . . . . . . . . . .  66
           DAA (80286/80386) . . . . . . . . . . . . . . . . . . .  66
           DAS (80286/80386) . . . . . . . . . . . . . . . . . . .  67
           DEC (80286/80386) . . . . . . . . . . . . . . . . . . .  68
           DIV (80286/80386) . . . . . . . . . . . . . . . . . . .  68
           ENTER (80286/80386) . . . . . . . . . . . . . . . . . .  69
           HLT (80286/80386) . . . . . . . . . . . . . . . . . . .  70
           IDIV (80286/80386)  . . . . . . . . . . . . . . . . . .  71
           IMUL (80286/80386)  . . . . . . . . . . . . . . . . . .  72
           IN (80286/80386)  . . . . . . . . . . . . . . . . . . .  73
           INC (80286/80386) . . . . . . . . . . . . . . . . . . .  74
           INS/INSB/INSW (80286/80386) . . . . . . . . . . . . . .  74
           INT/INTO (80286/80386)  . . . . . . . . . . . . . . . .  76
           IRET (80286/80386)  . . . . . . . . . . . . . . . . . .  77
           J(podm¡nka) (80286/80386) . . . . . . . . . . . . . . .  77
           JMP (80286/80386) . . . . . . . . . . . . . . . . . . .  79
           LAHF (80286/80386)  . . . . . . . . . . . . . . . . . .  80
           LAR (80286/80386) . . . . . . . . . . . . . . . . . . .  81
           LSS/LFS/LGS (80386), LDS/LES (80286/80386)  . . . . . .  81
           LEA (80286/80386) . . . . . . . . . . . . . . . . . . .  82
           LEAVE (80286/80386) . . . . . . . . . . . . . . . . . .  83
           LGDT/LIDT (80286/80386) . . . . . . . . . . . . . . . .  83
           LLDT (80286/80386)  . . . . . . . . . . . . . . . . . .  84



                                    ii 




           LMSW (80286/80386)  . . . . . . . . . . . . . . . . . .  85
           LOCK (80386)  . . . . . . . . . . . . . . . . . . . . .  86
           LODS/LODSW/LODSB (80286/80386)  . . . . . . . . . . . .  87
           LOOP (80286/80386)  . . . . . . . . . . . . . . . . . .  87
           LSL (80286/80386) . . . . . . . . . . . . . . . . . . .  88
           LTR (80286/80386) . . . . . . . . . . . . . . . . . . .  89
           MOV (80286/80386) . . . . . . . . . . . . . . . . . . .  90
           MOVS/MOVSB/MOVSW (80286/80386)  . . . . . . . . . . . .  91
           MOVZX/MOVSX (80286/80386) . . . . . . . . . . . . . . .  92
           MUL (80286/80386) . . . . . . . . . . . . . . . . . . .  92
           NEG (80286/80386) . . . . . . . . . . . . . . . . . . .  93
           NOP (80286/80386) . . . . . . . . . . . . . . . . . . .  94
           NOT (80286/80386) . . . . . . . . . . . . . . . . . . .  95
           OR (80286/80386)  . . . . . . . . . . . . . . . . . . .  95
           OUT (80286/80386) . . . . . . . . . . . . . . . . . . .  96
           OUTS/OUTSB/OUTSW (80286/80386)  . . . . . . . . . . . .  96
           POP (80286/80386) . . . . . . . . . . . . . . . . . . .  97
           POPA (80286/80386)  . . . . . . . . . . . . . . . . . .  98
           POPF (80286/80386)  . . . . . . . . . . . . . . . . . .  99
           PUSH (80286/80386)  . . . . . . . . . . . . . . . . . . 100
           PUSHA (80286/80386) . . . . . . . . . . . . . . . . . . 100
           PUSHF (80286/80386) . . . . . . . . . . . . . . . . . . 101
           RCL/RCR/ROL/ROR (80286/80386) . . . . . . . . . . . . . 102
           REP/REPZ/REPE/PEPNE/REPNZ (80286/80386) . . . . . . . . 103
           RET (80286/80386) . . . . . . . . . . . . . . . . . . . 104
           SAHF (80286/80386)  . . . . . . . . . . . . . . . . . . 105
           SAL/SAR/SHL/SHR (80286/80386) . . . . . . . . . . . . . 105
           SBB (80286/80386) . . . . . . . . . . . . . . . . . . . 107
           SCAS/SCASB/SCASW (80286/80386)  . . . . . . . . . . . . 107
           SGDT/SIDT (80286/80386) . . . . . . . . . . . . . . . . 108
           SLDT (80286/80386)  . . . . . . . . . . . . . . . . . . 109
           SMSW (80286/80386)  . . . . . . . . . . . . . . . . . . 109
           STC (80286/80386) . . . . . . . . . . . . . . . . . . . 110
           STD (80286/80386) . . . . . . . . . . . . . . . . . . . 110
           STI (80286/80386) . . . . . . . . . . . . . . . . . . . 111
           STOS/STOSB/STOSW (80286/80386)  . . . . . . . . . . . . 111
           STR (80286/80386) . . . . . . . . . . . . . . . . . . . 112
           SUB (80286/80386) . . . . . . . . . . . . . . . . . . . 113
           TEST (80286/80386)  . . . . . . . . . . . . . . . . . . 114
           VERR/VERW (80286/80386) . . . . . . . . . . . . . . . . 114
           WAIT (80286/80386)  . . . . . . . . . . . . . . . . . . 115
           XCHG (80286/80386)  . . . . . . . . . . . . . . . . . . 115
           XLAT (80286/80386)  . . . . . . . . . . . . . . . . . . 116
           XOR (80286/80386) . . . . . . . . . . . . . . . . . . . 117

     Kapitola 8  Speci ln¡ instrukce 80386                         119
           IBTS  . . . . . . . . . . . . . . . . . . . . . . . . . 119
           MOV CRn . . . . . . . . . . . . . . . . . . . . . . . . 119
           MOV DRn . . . . . . . . . . . . . . . . . . . . . . . . 120
           MOV TRn . . . . . . . . . . . . . . . . . . . . . . . . 121
           SETcond.  . . . . . . . . . . . . . . . . . . . . . . . 121
           SHLD/SHRD . . . . . . . . . . . . . . . . . . . . . . . 123
           XBTS  . . . . . . . . . . . . . . . . . . . . . . . . . 124






                                    iii 




     Kapitola 9  Pý¡klady program… v assembleru                    125

     Appendix A  Re lnì a privilegovanì m¢d 80286(80386)           131
              Literatura . . . . . . . . . . . . . . . . . . . . . 132



konec OBSAHU                                                       ASM.HLP
**************************************************************************


                               Obr zky


     Figure 2.1: Bity a byty jednoho slova . . . . . . . . . . . . .18
     Figure 3.1: Pý¡m‚ adresov n¡  . . . . . . . . . . . . . . . . .25
     Figure 3.2: Nepý¡m‚ registrov‚ adresov n¡ . . . . . . . . . . .25
     Figure 3.3: B zov‚ relativn¡ adresov n¡ . . . . . . . . . . . .26
     Figure 3.4: B zov‚ indexov‚ adresov n¡  . . . . . . . . . . . .28


**************************************************************************

                               Tabulky


     Table 2.1: Dekadick , bin rn¡ a hexadecim ln¡ reprezentace
                Ÿ¡sel  . . . . . . . . . . . . . . . . . . . . . . .16
     Table 6.1: Vìjimky v privilegovan‚m m¢du 80286  . . . . . . . .51



                                    vii 

**************************************************************************




                           ASSEMBLER 80286/80386
 


                                   - 2 - 



                                   évod



   Tato pý¡ruŸka je koncipov na tak, aby splnila týi c¡le:

   1.  uv‚st V s do svØta mocn‚ho programov n¡  v  assembleru vyu§¡vaj¡c¡ho
       mikroprocesor 80386/80286

   2.  nauŸit  V s,  jak  ps t  jednoduch‚  a  souŸasnØ  mocn‚  programy  v
       assembleru, a

   3.  poslou§it jako referenŸn¡  pý¡ruŸka  jak  souboru  instrukc¡,  tak i
       uk zkovìch program…


   Assembler  80386/80286  je  velice   mocnou   extenz¡   starç¡ch  jazyk…
strojovìch instrukc¡, zejm‚na assembler… rodiny poŸ¡taŸ… 8088/8086. Je to v
prv‚  ýadØ  d…sledek  toho, §e vçichni  Ÿlenov‚  rodiny  INTEL  80xxx  jsou
kompatibiln¡  zdola  nahoru.  Z kladn¡ instrukce a rysy  jazyka  jsou  tedy
spoleŸn‚ prvn¡m mikroprocesor…m  i  t‚to posledn¡ s‚rii. Budouc¡ verze DOSu
poskytnou mo§nosti  pý¡stupu i k "vyçç¡m" vlastnostem programov n¡, jako je
napý. programov n¡ v chr nØn‚m re§imu  (protected mode): to ovçem povede ke
zvØtçen¡ rozd¡l… mezi starç¡mi a novØjç¡mi verzemi assembler….

   Assembler  je mocnì jazyk poskytuj¡c¡ program torovi absolutn¡  kontrolu
nad poŸ¡taŸem. Jazyky vyçç¡ £rovnØ (jako je PASCAL, Ada,  FORTRAN  a  jin‚)
ponech vaj¡ program tora  zcela  na  pospas  libov…li  autor…  kompil toru.
Jestli§e autor u§ivatelsk‚ho programu pou§ije  napý.  adapt‚r  na  hry jako
zaý¡zen¡, k nØmu§ se jeho program obrac¡, pak je vçe v  poý dku, kompil tor
s t¡m "poŸ¡t ". Pokud ale nevyu§ijete tØchto nab¡zenìch mo§nost¡, co  pak ?
V  assembleru m…§ete ps t sv‚ vlastn¡  u§ivatelsk‚  programy  nebo  dokonce
vyu§¡vat velice efektivn¡ch slu§eb  BIOSu,  kter‚  poskytuje  pý¡mo vìrobce
poŸ¡taŸe. V podstatØ je velk  vØtçina program… psanìch v assembleru u§¡v na
coby z platy (patches) na vyçç¡ programovac¡ jazyky : tyto z platy se sna§¡
dodefinovat ve  vyçç¡m programovac¡m jazyku to, co autoýi kompil toru mo§n 
pýehl‚dli.

   Tato  kniha  vysvØtluje  programov n¡  na  pý¡kladech  -  na kompletn¡ch
pý¡kladech : s ka§dìm programem je k dispozici listing se  vçemi nezbytnìmi
pozn mkami. Jinìmi slovy -  jestli§e  zap¡çete program pýesnØ tak, jak je v
tomto manu lu uveden, urŸitØ spr vnØ pobØ§¡. Nenaleznete zde § dn‚ zkr cen‚
pý¡klady nebo Ÿ steŸn‚ vìpisy,  kter‚  by  mØly  uçetýit m¡sto. Naçim c¡lem
bylo u ka§d‚ho pý¡kladu vysvØtlit a dokumentovat jej tak, aby usnadnil vaçe
studium jednotlivìch  instrukc¡ a programovac¡ho stylu, aœ ji§ jste nov Ÿek
nebo zkuçenì program tor.





                                   - 3 - 



                                   - 4 - 




                            K a p i t o l a   1

                  évod do programovac¡ho jazyka assembler


   Studium programovac¡ho jazyka nejni§ç¡  £rovnØ  -  assembleru - m…§e bìt
jedn¡m z  nejvdØŸnØjç¡ch  a  technicky  nejinspirativnØjç¡ch  Ÿinnost¡,  ke
kterìm se softwareovì specialista odhodl . Jakmile m te  pý¡sluçn‚ n stroje
a  v¡te,  jak  zkombinovat  vyçç¡   programovac¡   jazyk   s  nejr…znØjç¡mi
hardwareovìmi konfiguracemi  vaçeho  poŸ¡taŸe,  jste  opravdu  p nem  sv‚ho
stroje. Subtiln¡ ovl d n¡ periferi¡ a spr va pamØti,  efektivnost program…,
rychlost  a  ochrana  dat  -  to  vçe  Ÿek   na  program tora  tvoý¡c¡ho  v
assembleru. Nicm‚nØ zvl dnut¡ assembleru vy§aduje  zkuçenosti  a  smysl pro
detaily.

   I kdy§ jste zainteresov n ve specializovan‚ oblasti  vìvoje programov‚ho
vybaven¡,  assembler  se   stane  vaç¡m  druhìm  nejmocnØjç¡m  vyjadýovac¡m
jazykem.   Proto§e  assembler  umo§åuje  program torovi  pý¡mì  pý¡stup   k
registr…m, pamØti a jedineŸn‚mu svØtu bitovØ orientovanìch instrukc¡, Ÿasto
pýedstavuje jedinou mo§nost ýeçit softwareov‚  probl‚my  le§¡c¡  mimo dosah
prostýedk… vyçç¡ho programovac¡ho jazyka.

   Program v asembleru bude  produkovat  nejrychleji  interpretovanì c¡lovì
program, proto§e obch z¡  pou§it¡ kompil toru vyçç¡ho programovac¡ho jazyka
(PASCAL, PL/I, C apod.). Tato vìhodn  rychlost ovçem nen¡ zadarmo.

   Program toýi v assembleru mus¡ vØnovat svou pozornost  detail…m. Program
v assembleru ý¡d¡ mikroprocesor v jeho "vlastn¡m" jazyce, bez kompil tor… a
jeho kontroln¡ch prostýedk….  Vìsledkem tØchto velice element rn¡ch operac¡
vykon vanìch na £rovni  assembleru  je  to,  §e  jedna  str nka  programu v
assembleru je t‚mØý nesrovnateln  s  esoterickou  sofistikou  jedn‚ str nky
programu  ve  vyçç¡m  programovac¡m jazyce. Z tohoto  d…vodu  nen¡  vØtçina
vØtç¡ch program… ps na  v  assembleru. ( Vìjimkou jsou softwareov‚ projekty
financovan‚ vØtç¡mi spoleŸnostmi,  kter‚  jsou  ochotn‚  platit  znaŸnì Ÿas
nutnì k naps n¡ extr‚mnØ rychl‚ho a efektivn¡ho aplikaŸn¡ho programu).

   Jestli§e  "hovoý¡me"  strojovìm jazykem, vy§aduje  to  porozumØn¡  mnoha
koncept…m zcela ciz¡m vyçç¡m programovac¡m  jazyk…m.  Program tor  v jazyce
assembler mus¡  uva§ovat segmentaci pamØti. Tam, kde pou§¡v  pý¡m‚ho ý¡zen¡
pý¡stupu k  operaŸn¡ pamØti, je týeba prov dØt velice delik tn¡ rozhodnut¡.
Kde by mØla bìt uchov na data programu a kde program samotnì ? Je zapotýeb¡
z sobn¡ku ? Jesli§e ano, v jak‚ Ÿ sti pamØti by mØl  bìt  um¡stØn ? PeŸliv 
rozhodnut¡ se tìkaj¡ tak‚ alokace  pamØti pro jednotliv  data (byty, slova,
dvouslova atp.) i typu techto  dat (ýetØzce, statick‚ a dynamick‚ promØnn‚,
data v pevn‚ a pohybliv‚ ý dov‚ Ÿ rce atp.). StejnØ detailn¡  rozhodnut¡ se
tìkaj¡  dat  zpracov vanìch koprocesory 80287/80387,  pý¡stupu  k  obrazov‚
pamØti monitor…, k tisk rn m apod. Mnoh‚ z uvedenìch aspekt… jsou jedineŸn‚
pr vØ pýi vytv ýen¡ program… v assembleru.





                                   - 5 - 




---------------------------------------------------------------------------
Hlavn¡ vìhoda - rychlost a pý¡m‚ ý¡zen¡
---------------------------------------------------------------------------


   Jednou  z hlavn¡ch vìhod assembleru je skvØl   rychlost,  s  jakou  jsou
programy  vykon v ny.  Program  v  assembleru  je  jen  symbolickìm obrazem
vìsledn‚ho strojov‚ho  k¢du  -  lze  ý¡ci,  §e  program ve strojov‚m k¢du a
assemblerovskì   program  jsou  isomorfn¡  syst‚my.  Instrukce  na   £rovni
strojov‚ho k¢du jsou pak vykon v ny v mikrosekundovìch Ÿasech.

   Interprety, jako napý.  interprety  BASICu  Ÿi  APL,  analyzuj¡ zdrojovì
program  a  prov dØj¡  -  ý dek  po  ý dku  -  translaci do strojov‚ho k¢du
poŸ¡taŸe,   volaj¡ce  pýitom  celou  ýadu  vestavØnìch  podprogram….   Tyto
podprogramy  byly   pýedem   naps ny   a   predestinov ny   pro   konkr‚tn¡
mikroprocesor.   Proto§e  je  bØhem  vykon v n¡  programu  nezbytn‚   znovu
vyŸ¡slovat  vìrazy  a  prov dØt  oçetýov n¡  chyb,  je  vykon v n¡ takov‚ho
programu velice pomal‚.

   Kompil tory, jako napý. kompil tory PASCALu,  PL/I  nebo  FORTRANu, Ÿtou
zdrojovì program  a transformuj¡ jej do sekvence operaŸn¡ch k¢d… (pýesnØji:
instrukc¡), kter‚ mikroprocesor  bude vykon vat pý¡mo. Kompilovan‚ programy
jsou tedy rychlejç¡ ne§ interpretovanì zdrojovì program, proto§e pýeklad je
prov dØn jen jednou.

   Kompilovan‚ programy vçak maj¡ jednu nevìhodu: kompil tor mus¡ zajistit,
§e  zkompilovanì  program  bude  prov dØt  znaŸn‚  mno§stv¡  operac¡ 'vyçç¡
£rovnØ' -  napý. spolupracovat s periferiemi, syst‚mem soubor… atp. Zm¡nØn‚
operace  zp…sobuj¡,  §e  kompilovanì program je Ÿasto znaŸnØ rozs hlì i pýi
nevelk‚m zdrojov‚m programu. Tak  napý.  kompilovanì  program v BASICu m…§e
zabrat snadno 33 Kbyte  operaŸn¡  (a tedy i diskov‚) pamØti, pýiŸem§ tiskne
jen p r znak…  na  termin l.  Stejnì  program psanì v assembleru by zab¡ral
napý. jen 10 KByte, t.j. jen týetinu pamØœov‚ho prostoru.

   Pod¡vejme se nyn¡ jeçtØ  na  druhou  hlavn¡  vìhodu program… zapsanìch v
assembleru. Bez assembleru by byl u§ivatel  omezen  jen na to, co mu nab¡z¡
"profesion ln¡"  programy.  Napý.  jestli§e  nØkdo nap¡çe aplikaŸn¡ program
zpracov vaj¡c¡  vysoce  kritick   data  a  jeho  u§ivatel  je osoba  s  jen
Ÿ steŸnìm  zasvØcen¡m  do   poŸ¡taŸov‚  problematiky,  bude  velice  vhodn‚
zabr nit takov‚mu u§ivateli ve stisknut¡  kl ves  CTRL-ALT-DEL,  kter‚ m…§e
data  zcela zniŸit. Inhibice t‚to akce m…§e bìt  zajiçtØna  jen  na  £rovni
assembleru.

   Assemblery  umo§åuj¡  softwareovìm odborn¡k…m pru§nì  styk  s  operaŸn¡m
syst‚mem a  poskytuj¡ jim mo§nost pý¡m‚ho ý¡zen¡ vstup/vìstupn¡ch operac¡ s
periferiemi (disky, tisk rny, diskety aj.). AplikaŸn¡ program tor mus¡ tak‚
Ÿasto  pý¡mo komunikovat s operaŸn¡m syst‚mem.  Takov‚  programy  pak  jsou
obvykle ps ny v assembleru.











                                   - 6 - 




---------------------------------------------------------------------------
Rodina mikroprocesor… 80286/80386
---------------------------------------------------------------------------


   Prvn¡  integrovanì  obvod  (IO)  byl   vyvinut   v   çedes tìch  letech.
Integrovanì obvod prudce redukoval velikost kapacitor…, diod  a tranzistor…
a vçechny je umistil na plochu pl tku z Ÿist‚ho kýem¡ku. Deset  let pozdØji
vyvinul INTEL sv…j prvn¡ mikroprocesorovì Ÿip, INTEL 8008. V roce 1974 byla
vyvinuta   druh    generace    mikroprocesorovìch    Ÿip…,   reprezentovan 
mikroprocesorem 8080. Tento obvod nab¡dl u§ivateli  vçeobecn‚  mo§nosti. Ve
stejn‚ dobØ konkurence vrhla na  rychle se rozçiýuj¡c¡ trhy dalç¡ produkty,
napý¡klad mikroprocesor ZILOG Z-80.

   Týet¡ generace mikroprocesor… n sledovala hned po Ÿtyýech letech. V roce
1978 vyvinula firma INTEL  mikroprocesor  8086.  AŸkoliv tento Ÿip vykazuje
jist‚ rysy  kompatibility se svìm "pýedkem", 8080, m  mnohem avantgardnØjç¡
design, s mnoha novìmi  rysy.  INTEL  tak‚  vyvinul mikroprocesor 8088 jako
variantu  Ÿipu  8086.  Mikroprocesor 8088 umo§nil o nØco jednoduçç¡ n vrh a
zahrnul  kompatibilitu  s  bØ§nìmi   I/O   zaý¡zen¡mi.   Architekturou  byl
mikroprocesor 8088 jedn¡m z nejpokrokovØjç¡ch mikroprocesor…  t‚  doby. MØl
takov‚ kvality, §e jej  firma  IBM pou§ila za z kladn¡ stavebn¡ element sv‚
nov‚ ýady osobn¡ch poŸ¡taŸ….

   Ve  stejn‚  dobØ  se  objevil  i  "bratranec"  mikroprocesor… 8088/8086:
matematickì koprocesor  8087. Tento numerickì procesor by urŸen k realizaci
rychlìch vìpoŸt… v pohybliv‚ ý dov‚ Ÿ rce.

   INTEL vçak nez…stal jen  u  svìch  starìch  £spØch…. Uprostýed roku 1984
ohl sila  tato  spoleŸnost  dalç¡  technologickì skok: mikroprocesor 80286.
Tato centr ln¡ jednotka nov‚  generace  byla  navr§ena zejm‚na pro aplikace
vy§aduj¡c¡ vysokou vìkonnost. Mikroprocesor 80286, jsa dol…  kompatibiln¡ s
8086/8088, tØ§¡ z vìhod takovìch progres¡vn¡ch rys… poŸ¡taŸ… týet¡ a Ÿtvrt‚
generace,  jakou  jsou  spr va pamØti, mechanismy ochrany,  spr va  £loh  a
podpora virtu ln¡  pamØti.  Vçechny  zm¡nØn‚  vlastnosti  zajiçœuje  jedinì
VLSI-Ÿip,    kterì   poskytuje   u§ivateli   mikropoŸ¡taŸe   vìpoŸetn¡    a
architektur ln¡ potenci minipoŸ¡taŸe.

   Mikroprocesor  80286  je  zdola  nahoru  kompatibiln¡  s  8086/8088 d¡ky
spoleŸn‚  mno§inØ  instrukc¡   a  adresovìch  m¢d….  Z kladn¡  architektura
podporuje  vyçç¡  programovac¡  jazyky jako PASCAL, PL/M a C, proto§e n vrh
souboru registr… je pý¡hodnì pro k¢d generovanì kompil torem.

   Mikroprocesor 80286 podporuje  ýadu  mocnìch  datovìch  typ…,  jako jsou
napý. ýetØzce, form ty v BCD k¢du  a  v pohybliv‚ ý dov‚ Ÿ rce. N vrh 80286
tak‚ podporuje efektivn¡  adresov n¡ takovìch komplexn¡ch datovìch struktur
jako jsou statick /dynamick  pole, z znamy a pole uvnitý z znam….

   PamØœov  architektura 80286 podporuje techniky modul rn¡ho programov n¡,
kter‚  softwareov‚mu  specialistovi   umo§åuj¡  dØlit  pamØt  do  segment….
Segmentov n¡ pamØti poskytuje kratç¡ k¢d, proto§e reference uvnitý segmentu
mohou  bìt kratç¡. Paradigma segmentace samo  o  sobØ  podporuje  efektivn¡
implementaci d…mysln‚ spr vy pamØti - napý. techniku virtualizace a ochrany
pamØti. Mikroprocesor 80286 tak‚ poskytuje velkì adresovì prostor k podpoýe
souŸasnìch aplikaŸn¡ch po§adavk…. Fyzick  pamØœ sest v  a§ z  16  MByte RAM
nebo  ROM.  Tento  obrovskì   adresovì   prostor   umo§åuje  mikroprocesoru



                                   - 7 - 




ponech vat v  pamØti souŸasnØ nØkolik rozs hlìch program… a jejich datovìch
struktur, Ÿ¡m§ je k nim umo§nØn rychlì pý¡stup.

   Pro  aplikace  s  dynamicky  se  mØn¡c¡mi  po§adavky  na operaŸn¡  pamØœ
(multiu§ivatelsk‚  syst‚my)  d v   80286  ka§d‚mu  u§ivateli  a§   1  GByte
virtu ln¡ho  adresov‚ho prostoru. Rozs hlì adresovì prostor t‚mØý  vyluŸuje
omezen¡ na velikost nebo poŸet program…, kter‚ mohou bìt Ÿ st¡ syst‚mu.

   INTEL  80286  je  urŸen  k   podpoýe   multiu§ivatelsk‚ho   prostýed¡  a
multiprogramovìch   re§im…  v   re ln‚m   Ÿase.   MikropoŸ¡taŸov‚   syst‚my
obsluhuj¡c¡ Ÿtyýi Ÿi pØt u§ivatel… souŸasnØ mohou nyn¡  expandovat  tak, §e
podpoý¡ týikr t tolik u§ivatel…, a syst‚my pracuj¡c¡ v  re ln‚m  Ÿase budou
m¡t odezvy asi çestinov‚ ve srovn n¡ s dý¡vØjç¡m stavem.

   Posledn¡ (dosud) Ÿlen rodiny mikroprocesor… firmy INTEL je mikroprocesor
80386. Jeho 32-bitov   extern¡  datov   sbØrnice  m…§e  adresovat  a§  4 GB
operaŸn¡ pamØti.



---------------------------------------------------------------------------
Co budete schopni zvl dnout ihned po pýeŸten¡ t‚to knihy
---------------------------------------------------------------------------


   Po  pýeŸten¡  textu  a vyzkouçen¡ program… z¡sk te  solidn¡  znalosti  o
vnitýn¡  architektuýe  80286/80386.  Budete  velice  d…kladnØ  sezn meni  s
instrukŸn¡m souborem a se strukturou  registr…  mikroprocesoru  a  s jejich
pou§¡v n¡m. Pot‚, co  se  nauŸ¡te assembler, pochop¡te, jak poŸ¡taŸ pracuje
na  t‚ nejz kladnØjç¡ £rovni (oznaŸovan‚ t‚§  jako  strojov )  a  pochop¡te
vìhody a nevìhody programov n¡ v assembleru.



---------------------------------------------------------------------------
Co tato kniha pýedpokl d  o v s
---------------------------------------------------------------------------


   Tato  kniha  pýedpokl d ,  §e ji§ zn te nØkterì  z  rozç¡ýenìch  vyçç¡ch
programovac¡ch jazyk…, jako jsou napý.  PASCAL nebo BASIC. Nebudeme se vçak
nikterak sna§it o vyuŸov n¡ tØmto  jazyk…m.  Znalost  hexadecim ln¡ Ÿ¡seln‚
soustavy  je vhodn , nikoliv vçak bezpodm¡neŸnØ nutn  -  tot‚§  plat¡  i  o
znalostech logickìch operac¡ AND, NAND,  OR,  NOR,  XOR,  SHIFT LEFT/RIGHT,
ROTATE, COMPLEMENT atd.














                                   - 8 - 










                            K a p i t o l a   2

                             ¬¡seln‚ soustavy


   PorozumnØn¡  tomu, jak poŸ¡taŸ uchov v  informaci,  je  do  znaŸn‚  m¡ry
kritick‚ pro pochopen¡ programov n¡ na  £rovni  assembleru.  Jak  jsou data
reprezentov na vnitýnØ v poŸ¡taŸiú? Jeliko§ je poŸ¡taŸ elektrick‚ zaý¡zen¡,
"rozum¡" jen £rovn¡m napØt¡. Specificky vØtçina  mikroprocesor…  je z visl 
na  pý¡tomnosti Ÿi nepý¡tomnosti dvou spolehlivØ rozliçitelnìch  napØœovìch
£rovn¡.  M…§eme  tyto  £rovnØ  pova§ovat  za  charakteristiky  zapnut¡ nebo
vypnut¡, za 1 nebo 0. Dvojice 0/1 je oznaŸov na tak‚ jako bit.

   Lid‚ od prapoŸ tku pou§¡vali des¡tkovou Ÿ¡selnou soustavu,  proto§e maj¡
deset prst…. PoŸ¡taŸe "rozum¡" pouze dvØma odliçnìm stav…m, reprezentovanìm
symboly 0 a 1. To pýirozenØ vede ke  komunikaŸn¡m  probl‚m…m  mezi  lidmi a
poŸ¡taŸi.  Vìvoj  r…znìch  symbolickìch  k¢d…  byl  pý¡mìm  d…sledkem  t‚to
jazykov‚ nesluŸitelnosti.

   K¢d ASCII  (American  Standard  Code  for  Information  Interchange) byl
navr§en proto, aby byl s to reprezentovat vçechny  symboly  kter‚ vçeobecnØ
spojujeme  s  kl vesnic¡  psac¡ho  stroje.  NØkolik  Ÿ¡selnìch   k¢d…  bylo
vytvoýeno k tomu. aby reprezentovaly  Ÿ¡seln‚ hodnoty v takov‚ formØ, kter‚
poŸ¡taŸ  rozum¡.  Dvojkovì doplåkovì k¢d  umo§åuje  poŸ¡taŸi  reprezentovat
kladn   i  z porn   cel   Ÿ¡sla.  Jeden z nejd…le§itØjç¡ch  Ÿ¡selnìch  k¢d…
potýebnìch  pro  praxi  program tora  v  assembleru  je  k¢d hexadecim ln¡.
Hexadecim ln¡ z pis zlepçuje Ÿitelnost informac¡ reprezentovanìch v bin rn¡
podobØ aœ jde ji§ o data, instrukce nebo adresy v pamØti.



---------------------------------------------------------------------------
Bin rn¡ Ÿ¡sla
---------------------------------------------------------------------------


   Naçe  dekadick    Ÿ¡seln   soustava  m   sv‚  jm‚no  od  deseti  (deka-)
jednotlivìch Ÿ¡slic 0,1,...,9, kter‚ jsou  jedinìmi  pý¡pustnìmi  znaky pro
z pis (cel‚ho) dekadick‚ho Ÿ¡sla. Bin rn¡  soustava  m   jen  dva pý¡pustn‚
symboly - 0 a 1. M…§e se zd t, §e je  to  pro  z pis  velkìch  Ÿ¡sel  poŸet
symbol… naprosto nedostateŸnì. Snadno vçak nahl‚dnete, §e  z kladn¡ princip
bin rn¡ soustavy je nØco, co u§ d vno zn te.

   Nejprve  se  pod¡vejme  na nØjak‚ dekadick‚  Ÿ¡slo  -  ýeknØme  1024.  V
z kladn¡  çkole  jsme  se uŸili, §e toto Ÿ¡slo m  4  jednotky,  2  des¡tky,
§ dnou stovku a jednu  tis¡covku.  To  je  vlastnØ vyj dýen¡ v hov‚ Ÿ¡seln‚
reprezentace Ÿ¡sla 1024. Tak jak se pohybujete zprava  doleva  po Ÿ¡slic¡ch
dan‚ho  Ÿ¡sla,  zvØtçuje  se v ha ka§d‚ dalç¡ Ÿ¡slice. Naçe dekadick‚ Ÿ¡slo
(tedy Ÿ¡slo v soustavØ o z kladu 10) si m…§eme myslet v n sleduj¡c¡m tvaru




                                   - 9 - 




 1   0   2   4
 -   -   -   -    7   0
 |   |   |   +--- 4 x 10 =      4 (bit LSB)
 |   |   |              1
 |   |   +------- 2 x 10 =     20
 |   |                  2
 |   +----------- 0 x 10 =    000
 |                      3
 +--------------- 0 x 10 =   1000 (bit MSB)
                             ====
                             1024



   Konverzi  jsme  provedli  vyn soben¡m  ka§d‚  Ÿ¡slice  v  Ÿ¡sle z kladem
soustavy, kterì byl umocnØn na odpov¡daj¡c¡ exponent. Exponent se zvyçuje o
1 s ka§dou dalç¡ Ÿ¡slic¡ pýi postupu vyŸ¡slov n¡ od bitu LSB po bit MSB.

   Stejnì  postup  zachov me  i pýi konverzi Ÿ¡sla zapsan‚ho v jin‚ Ÿ¡seln‚
soustavØ,  napý.  ve  dvojkov‚.  MØjme  tedy  týeba  bin rn¡ Ÿ¡slo  1010  a
konvertujme jej do des¡tkov‚ soustavy:

 1   0   1   0
 -   -   -   -          0
 |   |   |   +--- 0 x  2 =      0 (bit LSB)
 |   |   |              1
 |   |   +------- 1 x  2 =      2
 |   |                  2
 |   +----------- 0 x  2 =      0
 |                      3
 +--------------- 1 x  2 =      8 (bit MSB)
                             ====
                               10



   V tomto pý¡padØ jsme u§ili z kladu soustavy 2. Pýeveden¡  Ÿ¡sla  z  jin‚
Ÿ¡seln‚ soustavy  do dekadick‚ je velice jednoduch‚: prostØ zmØn¡me hodnotu
z kladu, algoritmus pýevodu z…stane stejnì.

   VidØli  jsme,  jak  snadn‚ je pýev‚st dvojkov‚ Ÿ¡slo na Ÿ¡slo dekadick‚.
OpaŸnì pýevod - z dekadick‚ soustavy do dvojkov‚ -  je  rovnØ§  jednoduchì:
odeŸteme jen mocniny Ÿ¡sla  2  od Ÿ¡sla, kter‚ m  bìt konvertov no. üeknØme
napý.,  §e chceme pýev‚st dekadick‚ Ÿ¡slo 11  na  Ÿ¡slo  dvojkov‚.  ZaŸneme
odeŸten¡m 2x2x2=8 od 11. Dostaneme zbytek 3. OdeŸten¡ dalç¡ mocniny z kladu
2X2=4 prov‚st nelze, ale odeŸten¡ dalç¡ mocniny z kladu 2  d v   zbytek  1.
Nakonec odeŸteme posledn¡ mocninu z kladu 2, t.j. 1, a dostaneme  zbytek 0.
Celì postup n m d v  konverzi dekadicky 11 = dvojkovØ 1011.

   Jednoduçç¡ metodou vhodnou i pro  velk   dvojkov   Ÿ¡sla  je n sleduj¡c¡
postup. Je tvoýen s‚ri¡ opakovanìch dØlen¡, pýiŸem§ z klad soustavy, do n¡§
se pýev d¡, je dØlitelem, a pýev dØn‚ Ÿ¡slo je dØlencem. Pýevod dekadick‚ho
Ÿ¡sla 50 do bin rn¡ soustavy vypad  takto:






                                  - 10 - 




---------------------------------------------------------------------------
     DØlenec    DØlitel  Vìsledek    Zbytek     ---->     Vìsledek:
---------------------------------------------------------------------------
       50          2       25          0         |
       25          2       12          1         |         110010
       12          2        6          0         |
        6          2        3          0         |
        3          2        1          1         |
        1          2        0          1         |
---------------------------------------------------------------------------



   Tuto metodu m…§ete pou§¡t  pro  pýevod  dekadick‚ho  Ÿ¡sla do soustavy o
jak‚mkoliv z kladu. Napý. pýi  pýevodu  Ÿ¡sla  428 do çestn ctkov‚ soustavy
jednoduçe polo§¡te dØlenec=428, dØlitel=16.



---------------------------------------------------------------------------
Bin rn¡ seŸ¡t n¡ a odeŸ¡t n¡
---------------------------------------------------------------------------


   Bin rn¡ seŸ¡t n¡ a odeŸ¡t n¡ jsou  identick‚  s  dekadickìm  seŸ¡t n¡m a
odeŸ¡t n¡m,  vyjma  toho,  §e generujeme pýenos nebo  vìp…jŸku  pýi  urŸit‚
mocninØ Ÿ¡sla 2, a ne Ÿ¡sla 10. UveÔme struŸnØ dva pý¡klady:

    25
+   85
------
   110

   V tomto pý¡kladØ pýi seŸ¡t n¡ dvou Ÿ¡slic 5 generujeme pýenos do dalç¡ho
ý du, t.j. do stovek, pýiŸten¡m 1 k dalç¡mu sloupci


   Bin rn¡ seŸ¡t n¡ tedy bude vypadat takto:

   1010 (10)
+  0011 (3)
-----------
   1101 (13)

Zde 0+1  d v   vìsledek  1,  pýenos 0. 1+1 d v  souŸet 2 (bin rnØ 10), tedy
vìsledek 0, pýenos 1 - pýenos pýiŸteme k dalç¡mu ý du

   Bin rn¡  odeŸ¡t n¡  u§¡v  stejnìch princip…  jako  odeŸ¡t n¡  dekadick‚.
Jedinìm  rozd¡lem  je, §e pýi generov n¡ vìp…jŸky  z  vyçç¡ho  ý du  je  na
urŸitou mocninu umocnØn z klad 2, nikoliv z klad 10.









                                  - 11 - 




      534
   -  251
   ------
      283

   JedniŸku odeŸteme od 4 bez obt¡§¡. Pýi odeŸ¡t n¡ Ÿ¡sla 5 od 3 potýebujeme vçak vytvoýit vìp…jŸku z dalç¡ho ý du, t.j. ze stovek. To pak umo§n¡ odeŸ¡st 50 od 130.

   Bin rn¡ odeŸ¡t n¡ tedy bude vypadat takto:

      1010
   -  0110
   -------
      0101

Pýi odeŸten¡ 0 od 1 v bitu LSB netýeba vìp…jŸky. Ve týet¡m sloupci vçak potýebujeme vìp…jŸku 2x2x2 = 8. Tak dostaneme ve 3. sloupci 1 a vìsledek odeŸ¡t n¡ je 0101.



---------------------------------------------------------------------------
Datovì typ BYTE
---------------------------------------------------------------------------


   JeçtØ ne§ budeme pokraŸovat v  diskusi  o  r…znìch  Ÿ¡selnìch syst‚mech,
mus¡me pýipomenout, jak vlastnØ Ÿ¡sla uchov v  poŸ¡taŸ ve svìch technickìch
prostýedc¡ch  (pamØtech).  Architektura   poŸ¡taŸe  toti§  do  znaŸn‚  m¡ry
determinuje form t a rozsah jak program…, tak i dat.

   U  mikroprocesoru  80286  je  pamØœov‚  m¡sto  posloupnost¡   osmi  bit…
oznaŸovanìch jako byte. Pozice bit… jsou Ÿ¡slov ny od bitu LSB (m  Ÿ¡slo 0)
po  bit  MSB  (m    Ÿ¡slo   7).  Dalç¡  obr zek  ukazuje  nØkolik  po  sobØ
n sleduj¡c¡ch pamØœovìch m¡st, z nich§  ka§d‚  obsahuje  jeden  byte nØjak‚
informace. Tato informace  m…§e  bìt  strojovou  instrukc¡,  adresou jin‚ho
pamØœov‚ho m¡sta nebo Ÿ¡slem Ÿi znakem.

   Ka§dì  byte m…§e ve svìch osmi  bitech  reprezentovat  256  jednotlivìch
stav…. To tedy umo§åuje zobrazit v jednom byte kladn  Ÿ¡sla 0 a§ 255. Jeden
byte  m…§e tak‚ nabìvat hodnoty jednoho znaku  ASCII.  Slovo  je  technickì
pojem, oznaŸuj¡c¡ spojen¡  bit…  do jedn‚ informaŸn¡ jednotky pamØti. Slovo
m…§e  bìt dlouh‚ 8, 16 nebo 32 bit… (popý. i v¡ce nebo m‚nØ podle  aplikace
poŸ¡taŸe). V architektuýe 80286 je slovo  dlouh‚  16 bit…, u 80386 m  slovo
d‚lku 32 bit….



---------------------------------------------------------------------------
Datovì typ CHARACTER
---------------------------------------------------------------------------


   Osmice bit… v jednom  byte  nemus¡ reprezentovat jen Ÿ¡sla. K¢d ASCII je
sedmibitovì k¢d  umo§åuj¡c¡ reprezentaci p¡smen i Ÿ¡slic v pamØti poŸ¡taŸe.
Ka§d‚mu p¡smenu, Ÿ¡slici  nebo  speci ln¡mu (ý¡dic¡mu) znaku je t¡mto k¢dem
pýiýazena bin rn¡ reprezentace na 7 bitech v jednom  byte.  Sedmibitovì k¢d
m…§e reprezentovat 128 jednotlivìch symbol….  Osmì, zbìvaj¡c¡ bit v byte je
nØkdy vyu§¡v n ke kontrole pýi pýenosu dat (paritn¡  bit).  NØkteý¡ vìrobci



                                  - 12 - 




pamØt¡  ROM  vyu§¡vaj¡  osm‚ho bitu k zaveden¡  rozç¡ýen‚ho  souboru  znak…
(extended  character   set).   Pýid n¡m   jedin‚ho   bitu   tak   dos hneme
zdvojn soben¡ poŸtu jednoznaŸnØ reprezentovatelnìch znak… na  256.  To d v 
mo§nost zobrazen¡ speci ln¡ch znak… v jinìch jazyc¡ch (francouzsk‚ accents,
Ÿesk  diakritick   znam‚nka),  matematickìch  symbol…  a  velmi  d…le§itìch
grafickìch symbol….


     (MSB)                             (LSB)
         ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
   1000  ³   ³   ³   ³   ³   ³   ³   ³   ³
         ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
           7   6   5   4   3   2   1   0
                       .
                       .
                       .
         ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
   0011  ³ 0 ³ 1 ³ 1 ³ 1 ³ 0 ³ 0 ³ 1 ³ 0 ³
         ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
         ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
   0010  ³ 1 ³ 1 ³ 0 ³ 1 ³ 1 ³ 0 ³ 0 ³ 0 ³
         ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ

         ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
   0001  ³ 1 ³ 0 ³ 1 ³ 0 ³ 1 ³ 1 ³ 0 ³ 0 ³
         ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ



---------------------------------------------------------------------------
¬¡sla se znam‚nkem
---------------------------------------------------------------------------


   Pod¡vejme se  bl¡§e na reprezentaci celìch Ÿ¡sel u mikroprocesoru 80286.
Jestli§e pou§ijeme  vçech osm bit… k reprezentaci kladnìch Ÿ¡sel, dostaneme
rozsah 0 - 255 (00000000 - 11111111). Po pýiŸten¡ 1  k  Ÿ¡slu 255 dost v me
opØt nulu.

   Reprezentace celìch Ÿ¡sel  kladnìch  i  z pornìch  je  tedy kompromisem,
proto§e mus¡me nØjak indikovat znam‚nko Ÿ¡sla, na co§ n m staŸ¡  jeden bit.
Ponech me-li bit Ÿ. 7  k  reprezentaci  znam‚nka, dost v me rozsah kladnìch
Ÿ¡sel 0-127. K¢d… pou§itelnìch k  reprezentaci z pornìch Ÿ¡sel je cel  ýada
a nØkter‚ z nich si uk §eme.

   Nejjednoduçç¡ reprezentac¡ je pou§it¡  bitu  Ÿ. 7 (MSB) na znam‚nko: 0 v
MSB k¢duje kladn‚ Ÿ¡slo, jedniŸka v MSB Ÿ¡slo z porn‚. Napý¡klad:

   0000 0101   oznaŸuje +5
   1000 0101   oznaŸuje -5


   Co ale s hodnotou 0 ? Teoreticky bychom mØli:

   0000 0000   pro hodnotu +0
   1000 0000   pro hodnotu -0



                                  - 13 - 




   Jak  v s jistØ napadne, potýebovali bychom  teÔ  tak‚  nov   aritmetick 
pravidla pro z kladn¡ operace seŸ¡t n¡  a odeŸ¡t n¡. Napý¡klad prvn¡ z nich
by specifikovalo, §e hodnota 0 bude v§dy zobrazena jako "kladn " nula: 0000
0000.  Proto§e  poŸet  bit…  urŸenìch  k  reprezentaci  hodnoty  Ÿ¡sla  byl
redukov n na 7, m…§eme hovoýit jen o hodnot ch mezi 0 a + nebo - 127.
N sleduj¡c¡ pý¡klad odeŸ¡t n¡

   1111 1110 +0
-  0000 0010 +1
   1111 1111 -127


vçak  ned v   spr vnì  vìsledek.  Abychom  mohli prov dØt operace  s  takto
reprezentovanìmi Ÿ¡sly,  potýebujeme  ve  skuteŸnosti  symbol  1111  1111 k
reprezentaci Ÿ¡sla -1. Dalç¡ pý¡klad ukazuje zase jinì zp…sob odeŸ¡t n¡:

   1111 1110 -2
-  0000 0010 +2
   1111 1100 -4


   Kdybyste si udØlali konverzi Ÿ¡sla  1111 1100 pýedpokl daj¡ce, §e MSB je
rezervov n pro znam‚nko, dostali byste  hodnotu  -124.  ProŸ  tedy vìsledek
naçeho druh‚ho odeŸ¡t n¡ byl -4 ? ŸtØte d le a uvid¡te ...



---------------------------------------------------------------------------
Dvojkovì doplnØk (two's complement)
---------------------------------------------------------------------------


   Aby operace seŸ¡t n¡  a  odeŸ¡t n¡  pracovaly  spr vnØ  pýi reprezentaci
Ÿ¡sel navr§en‚ v pýedchoz¡m odstavci, je týeba reprezentovat  Ÿ¡sla  v tzv.
dvojkov‚m doplåkov‚m k¢du. Pý¡klady  pr vØ  diskutovan‚  vedou  k pochopen¡
potýeby reprezentovat kladn  a z porn  Ÿ¡sla n sleduj¡c¡m zp…sobem:

   0000 0100   +4
   0000 0011   +3
   0000 0010   +2
   0000 0001   +1
   0000 0000    0
   1111 1111   -1
   1111 1110   -2
   1111 1101   -3
   1111 1100   -4



   VçimnØte  si, §e toto k¢dov n¡ ponech v  sedmì  bit  (MSB)  na  znam‚nko
Ÿ¡sla. Po proveden¡  operace  seŸ¡t n¡  nebo  odeŸ¡t n¡  se  dvØma  Ÿ¡sly k
dvojkov‚m doplåkov‚m k¢du je vìsledek tak‚ v tomto k¢du. Napý¡klad:

   0000 0100   +4
+  1111 1101   -3
------------



                                  - 14 - 




1) 0000 0001   +1 (Generovanì pýenos ignorujeme)


   Vytvoýen¡ reprezentace z porn‚ho Ÿ¡sla ve dvojkov‚m  doplåku  je snadn‚:
staŸ¡ invertovat ka§dì bit Ÿ¡sla a k takto vytvoýen‚mu  Ÿ¡slu  pýiŸ¡st  +1.
N sleduj¡c¡ pý¡klad to ukazuje na z¡sk n¡ reprezentace Ÿ¡sla -5

   0000 0101   +5
   1111 1010   (Invertujeme jednotliv‚ bity)
+  0000 0001   (PýiŸteme +1)
   ------------
   1111 1011   -5



   ZpØtn  konverze je stejnØ tak snadn :  uka§me  si ji na pýevodu Ÿ¡sla -4
do jeho kladn‚ hodnoty 4:

   1111 1100   -4
   0000 0011   (Invertujeme jednotliv‚ bity)
+  0000 0001   (PýiŸteme +1)
------------
   0000 0100   +4




---------------------------------------------------------------------------
Rozç¡ýen¡ znam‚nkov‚ho bitu
---------------------------------------------------------------------------


   Proto§e vnitýn¡ registry  80286  maj¡  ç¡ýku  16  bit…  a  ç¡ýka jednoho
pamØœov‚ho  m¡sta  je  jen 8 bit…, je docela mo§n‚, §e budete potýebovat ve
vaçem programu seŸ¡st dvØ Ÿ¡sla o r…znìch ç¡ýk ch.  Napý¡klad  m…§ete cht¡t
seŸ¡st  osmibitov‚   Ÿ¡slo   ve   dvojkov‚m   doplnkov‚m   k¢du   s  Ÿ¡slem
çestn ctibitovìm, ulo§enìm ve stejn‚m datov‚m form tu:

             0000 0101  +5
+  1111 1111 1111 1101  -3
----------------------


   Zde jsme jednoduçe pýipojili 0000 0000 k bitu MSB Ÿ¡sla +5. Co se stane,
kdy§ bude osmibitov‚ Ÿ¡slo z porn‚ ?

             1111 1111  -1
+  0000 0000 0000 0100  +4
----------------------


   Jeliko§ bylo osmibitov‚  Ÿ¡slo  z porn‚, pýipojili bychom osm jedniŸek k
bitu  MSB  Ÿ¡sla  -1 : 1111 1111. Obecn‚ pravidlo pro rozç¡ýen¡ znam‚nka je
tedy  prost‚:  pýipoj¡me  osm jedniŸek nebo nul k bitu MSB u kratç¡ho Ÿ¡sla
pýesnØ podle znam‚nka "prodlu§ovan‚ho"  Ÿ¡sla.  Rozç¡ýen¡  znam‚nka  u dvou
osmibitovìch Ÿ¡sel by n m tedy dalo



                                  - 15 - 




   0000 0000 0000 0101  (16-ti bitov  reprezentace +5)
   1111 1111 1111 1111  (16-ti bitov  reprezentace -1)



---------------------------------------------------------------------------
Hexadecim ln¡ Ÿ¡sla
---------------------------------------------------------------------------


   Hexadecim ln¡ Ÿ¡seln   soustava dostala sv‚ jm‚no z 16- ti jednoznaŸnìch
symbol…,  kter‚  tvoý¡  mno§inu  jej¡ch  Ÿ¡slic.  Hexadecim ln¡  Ÿ¡sla jsou
u§iteŸn   pýi  Ÿten¡  nebo  psan¡  program…   v   assembleru,  prohled v n¡
pamØœovìch dump…  atp.,  proto§e  ka§dou  Ÿtveýici  bit…  nahrazuj¡ jedinìm
hexadecim ln¡m  symbolem. Hexadecim ln¡ Ÿ¡sla obsahuj¡ symboly  0  a§  9  a
p¡smena A,B,C,D,E,F. N sleduj¡c¡ tabulka  ukazuje  vztah  mezi dekadickìmi,
bin rn¡mi a hexadecim ln¡mi Ÿ¡sly.


      Tab. 2.1: Dekadick , bin rn¡ a hexadecim ln¡ reprezentace Ÿ¡sel

          --------------------------------------------------
          Dekadicky      Bin rnØ          Hexadecim lnØ
          --------------------------------------------------
           0             0000             0
           1             0001             1
           2             0010             2
           3             0011             3
           4             0100             4
           5             0101             5
           6             0110             6
           7             0111             7
           8             1000             8
           9             1001             9
          10             1010             A
          11             1011             B
          12             1100             C
          13             1101             D
          14             1110             E
          15             1111             F
          --------------------------------------------------

   U§iteŸnost hexadecim ln¡ch Ÿ¡sel vid¡me na n sleduj¡c¡m pý¡kladØ:

     10010110        --->      96
     11100011        --->      E3
     10101011        --->      AB
     00101100        --->      2C


   ¬¡sla  vpravo  jsou  mnohem l‚pe Ÿiteln  a  kontrolovateln   ne§  jejich
dvojkov‚  reprezentace  nalevo.  Konverze  Ÿ¡sla bin rn¡ho do hexadecim ln¡
soustavy je velice snadn : zaŸ¡n me od bitu LSB a postupnØ smØrem  doleva k
bitu  MSB  nahrazujeme  skupiny   Ÿtyý   po   sobØ  jdouc¡ch  bit…  jedinou
hexadecim ln¡ Ÿ¡slic¡.




                                  - 16 - 




   Konverze  Ÿ¡sla  z  hexadecim ln¡  soustavy  do  soustavy  dekadick‚  je
analogick   ji§  diskutovan‚  konverzi   Ÿ¡sla   bin rn¡ho   na  dekadick‚.
N sleduj¡c¡ pý¡klad osvØtluje tuto  konverzi  na  Ÿ¡sle  FACE, kter‚ m  bìt
pýevedeno do hexadecim ln¡ soustavy:

 F   A   C   E
 -   -   -   -      0
 |   |   |   +--- 14 x 16 =  14
 |   |   |               1
 |   |   +------- 12 x 16  =   192
 |   |                   2
 |   +----------- 10 x 16  =  2560
 |                       3
 +--------------- 15 x 16  = 61400
                             =====
                             64206


   ¬¡slo FACE reprezentovan‚ bin rnØ vypad  takto:

   1111101011001110

a  reprezentovan‚  ve  dvou po sobØ jdouc¡ch  pamØœovìch  m¡stech  (bytech)
takto:

   11111010 11001110 .



---------------------------------------------------------------------------
Slova (words)
---------------------------------------------------------------------------


   PonØvad§ 80286 je çestn ctibitovì procesor  a  pracuje  nejefektivnØji s
çestn ctibitovìmi £daji, vytvoý¡me  slo§en¡m  dvou byt… jedno slovo, jak je
patrn‚ z n sleduj¡c¡ho obr zku.






















                                  - 17 - 




                    Obr. 2.1: Bity a byty jednoho slova


(LSB)               S L O V O                (MSB)
ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿
³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³
ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙ
 15 14 13 12 11 10  9  8  7  6  5  4  3  2  1  0


       HORNÖ BYTE               DOLNÖ BYTE
ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿
³  ³  ³  ³  ³  ³  ³  ³  ³³  ³  ³  ³  ³  ³  ³  ³  ³
ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙ
 15 14  ........... 7  8  7   6 ...........  1  0


        byte MSB                byte LSB
 (Most Significant Byte)  (Least Significant Byte)


   Vytvoýen¡  slova  n m  umo§n¡   pýekroŸit   hranici   hodnoty   255  (FF
hexadecim lnØ,  FFH)  a  pracovat  s   Ÿ¡sly  a§  do  hodnoty  65535  (FFFF
hexadecim lnØ, FFFFH). Assembler skuteŸnØ uchov v  a zpracov v   cel  Ÿ¡sla
jako slova.

   Pýi uchov v n¡ cel‚ho  Ÿ¡sla  o  velikosti  slova v pamØti jsou jeho dva
byte um¡stØny v opaŸn‚m poýad¡. Byte  LSB  je um¡stØn na ni§ç¡ adrese, byte
MSB na vyçç¡ adrese pamØti. Napý¡klad uchov n¡ hodnoty 3456H  v  pamØti  by
vypadalo takto:

   Adresa pamØti     Hodnota
   -------------     -------
   0000 0001            34H
   0000 0000            56H


   Ve  vØtçinØ  pý¡pad…  se  program tor  v  jazyce  symbolickìch instrukc¡
nestar  o pravidla um¡sœov n¡  svìch  operand…  v pamØti. Vçechny instrukce
pracuj¡c¡ s pamØt¡ "rozum¡" form tu dat,  je§  se maj¡ do pamØti um¡stit, a
zajiçœuj¡  vçechny nezbytn‚ pýesuny. Program tor si  vçak  mus¡  bìt  dobýe
vØdomì  popsan‚  metody  ukl d n¡  jednotlivìch  byte  pýi  trasov n¡ sv‚ho
programu a  pýi zkoum n¡ vìpis… pamØti. Mikroprocesor zpracov v  v§dy 16-ti
bitov‚ slovo, ne dva osmibitov‚ byte.



---------------------------------------------------------------------------
Dvouslova (doublewords)
---------------------------------------------------------------------------


   Dvouslovo je çirok‚ 32  bit…,  jak ji§ jeho n zev napov¡d . Dvouslovo je
slo§eno ze dvou pýilehlìch slov na po sobØ jdouc¡ch adres ch.  Dvouslovo je
velice  vìznamnì  datovì  form t,  proto§e  dovoluje  mikroprocesoru  80286
adresovat v¡ce ne§ 1 mili¢n byte pamØti. Z tohoto d…vodu bude program tor v



                                  - 18 - 




jazyce  symbolickìch instrukc¡ mikroprocesoru 80286 pracovat s  32-bitovìmi
dvouslovy jako s ukazateli  na  data  v pamØti. Dvaatýicetibitov‚ dvouslovo
tak‚  umo§åuje,  aby  aritmetick‚  operace  s  vìhodou  vyu§¡valy  dvojitou
pýesnost  vìpoŸt… - v dvouslovØ je mo§n‚ uchov vat  velice  mal   i  velice
velk  Ÿ¡sla cel  i desetinn .

   Dvouslova jsou uchov v na  v  uspoý d n¡  podobn‚m  uchov n¡  slov. Tedy
ni§ç¡   slovo   dvouslova   je   ukl d no   na  ni§ç¡  adresu   v   pamØti.
Dvaatýicetibitov‚ slovo je uchov v no  jako  posloupnost  4  byte, poŸ¡naje
bytem LSB a  konŸe  bytem  MSB.  ¬¡slo  12345678H by bylo v pamØti uchov no
takto:

   Adresa pamØti     Hodnota
   -------------     -------
   0000 0011            12    (MSB) \
   0000 0010            34           > slovo 16 bit…
                                    /              \
                                                    >dvou-
                                    \              / slovo
   0000 0001            56           > slovo 16 bit…
   0000 0000            78    (LSB) /



---------------------------------------------------------------------------
Nestandardn¡ pole bit…
---------------------------------------------------------------------------


   VØtçina dat, se kterìmi se  setk v   program tor  v  jazyce symbolickìch
instrukc¡, spad  do  dvou  skupin  definovanìch  v  pýedchoz¡ch odstavc¡ch.
Existuj¡ vçak  i vìjimky. Napý. n vrh ýi PC-DOSu nechtØli plìtvat pamØœovìm
prostorem a rozhodli se uchov vat  datovì  £daj  /den-mØs¡c-rok/  v jedin‚m
çestn ctibitov‚m  slovØ. VØnovali tak 7 bit… pro £daj o roce (Ÿ¡sla od 0 do
128  reprezentuj¡  po  pýiŸten¡  z kladu  1980  rok),  na  £daj o mØs¡ci je
zapotýeb¡ rozsahu 1-12, staŸ¡ tedy 4 bity. Maxim ln¡ poŸet dn… v  mØs¡ci je
31,  staŸ¡  tedy  5  bit…  k  reprezentaci  £daje  o  dnu  v  mØs¡ci.  Jin 
nestandardn¡  bitov   pole  se  u§¡vaj¡  napý. v aplikac¡ch  s  poŸ¡taŸovou
grafikou. Zde m…§e jedinì bit  reprezentovat bod na obrazovce monitoru. Je-
li bit  nulovì,  m   bod  tmavou  barvu  (nesv¡t¡). JedniŸka v takov‚m bitu
signalizuje, §e bod m  bìt rozsv¡cen. Toto zobrazen¡ bod…  na  displeji  se
vçak m…§e poŸ¡taŸ od poŸ¡taŸe mØnit. Napý. co kdy§ chceme indikovat, §e bod
na  displeji  m   bìt  rozsv¡cen  urŸitou  barvou  ? PýidØl¡me-li  bodu  na
obrazovce nyn¡ dva  bity,  je  mo§n‚  popsat rozsv¡cen¡ Ÿi zhasnut¡ bodu ve
týech r…znìch barv ch. Vçechny tyto nestandardn¡ bitov‚  konfigurace musej¡
bìt peŸlivØ zv §eny pýi ukl d n¡,  zpracov n¡ a pý¡stupu k bin rn¡m £daj…m.
JeçtØ vØtç¡ pozor mus¡me d vat pýi rozboru bin rn¡ch vìpis… pamØti (dump…).












                                  - 19 - 




---------------------------------------------------------------------------
Bin rn¡ operace
---------------------------------------------------------------------------


   Pýi  bli§ç¡m  rozboru mikropoŸ¡taŸem prov dØn‚ho  sŸ¡t n¡  Ÿi  odeŸ¡t n¡
neobjev¡me  nic  jin‚ho  ne§ opakovan‚ s‚rie bitovìch  porovn n¡.  Je  sice
pravdou,  §e  centr ln¡  jednotka  mikroprocesoru obsahuje r…zn‚ "seŸ¡tac¡"
obvody;  lze  v  koneŸn‚ instanci ý¡ci, §e i tyto obvody pracuj¡ na z kladØ
srovn v n¡  dat  bit  po  bitu.  Tato  bitov   srovn n¡ pýedstavuj¡  velice
jednoduchì proces, neboœ pýi srovn n¡ dvou bit… m…§eme dostat jen týi mo§n‚
kombinace bitovìch p r…: oba bity mohou bìt nulov‚, oba jedniŸkov‚  nebo je
jen jeden z  bit…  jedniŸkovì.  Jednoduch   s‚rie  sest vaj¡c¡  se  z pr vØ
popsanìch  opakovanØ prov dØnìch srovn n¡ je z kladem seŸ¡t n¡,  odeŸ¡t n¡,
n soben¡ i  dØlen¡. V pý¡padØ seŸ¡t n¡ jsou aplikov na n sleduj¡c¡ pravidla
poŸ¡naje od bitu LSB (Least Significant Bit = bit s nejmenç¡ vahou):
- SeŸten¡ dvou bit… nastav¡ pý¡znak SUM do nuly pýi obou bitech nulovìch
- Je-li jeden ze seŸ¡tanìch bit… jedniŸkovì, m  pý¡znak SUM hodnotu 1
- Je-li hodnota obou bit… 1, je pý¡znak SUM nastaven na hodnotu 0 a pý¡znak
CARRY (pýenos) na hodnotu 1

   Tento proces je pýi seŸ¡t n¡  opakov n s ka§dìm n sleduj¡c¡m bitem (tedy
s bity  o  postupnØ  rostouc¡  v ze),  pýiŸem§  je týeba pýi ka§d‚ sekvenci
pravidel uva§ovat pýedchoz¡ pýenos. Z kladn¡ jednotka si  uchov v  historii
vçech individu ln¡ch sekvenc¡ srovn n¡ ve  sv‚  vnitýn¡  pracovn¡  pamØti a
vìsledek cel‚ho procesu pak  vypad   jako  bin rn¡ seŸ¡t n¡. Ve skuteŸnosti
tento proces nen¡ nic jin‚ho ne§ opakov n¡ operac¡ bitovìch srovn n¡.

   AŸkoliv  je  centr ln¡ jednotka technicky  predestinov na  k  vykon v n¡
takovìch  operac¡,  jako  je  seŸ¡t n¡,  odeŸ¡t n¡, n soben¡ a  dØlen¡,  m 
program tor  pracuj¡c¡ v assembleru mo§nost pý¡stupu  i  k  jinìm  operac¡m
bitov‚ho srovn n¡. Tyto operace zahrnuj¡ logick‚ AND, OR,  XOR,  SHIFT LEFT
(posun vlevo), SHIFT RIGHT (posun  vpravo),  ROTATE  LEFT  (rotace doleva),
ROTATE RIGHT (rotace vpravo)  a  COMPLEMENT  (doplnØk). U logickìch operac¡
AND,OR a COMPLEMENT je vhodn‚  pokl dat  hodnoty  bit…  1  a  0  za logick‚
hodnoty true a false.  Logick   operace AND srovn v  dva bity. Je-li jejich
hodnota jedniŸkov , je vìsledek tak‚  jedniŸka. VçimnØme si, §e vìsledek je
odliçnì od operace bin rn¡ho seŸ¡t n¡, kdy srovn n¡ dvou  bit…  vy£stilo ve
vìsledek SUM=0 a CARRY=1.

   LOGICKí SOU¬IN AND
       Bit Ÿ. 0  Bit Ÿ. 1  Vìsledek
          0         0         0
          0         1         0
          1         0         0
          1         1         1

   Operace AND je velmi Ÿasto pou§¡v na k vìbØru  Ÿi  "maskov n¡" nØkterìch
skupin bit… ve slovØ/bytu. Jeden pý¡klad takov‚ho vyu§it¡ m…§eme nal‚zt pýi
dekadick‚m n soben¡ Ÿi dØlen¡:  je  zapotýeb¡  vynulovat  4 bity s nejvyçç¡
vahou pýedt¡m, ne§ operaci n soben¡ nebo dØlen¡ provedeme nad dvØma Ÿ¡sly v
nesbalen‚m tvaru. To lze velice lehce prov‚st logickìm souŸinem nesbalen‚ho
dekadick‚ho Ÿ¡sla s hodnotou 0000 1111:






                                  - 20 - 




         1010 0011
   AND   0000 1111   (maska)
   ---------------
         0000 0011

   Operace logick‚ho souŸtu OR srovn v  dva bity a vyd v  vìsledek 1, je-li
alespoå  jeden  bit   jedniŸkovì.   Operace  OR  je  u§iteŸn   k  nastaven¡
specifickìch pozic¡ do hodnoty 1.

   LOGICKí SOU¬ET OR
       Bit Ÿ. 0  Bit Ÿ. 1  Vìsledek
          0         0         0
          0         1         1
          1         0         1
          1         1         1


   Napý¡klad  chceme-li  nastavit  bit  MSB  (Most Significant Bit = bit  s
nejvØtç¡  vahou) na hodnotu 1, m…§eme v  pý¡padØ  8-bitov‚ho  slova  pou§¡t
operaci OR nad t¡mto Ÿ¡slem a hodnotou 1000 0000:

      0001 1010
   OR 1000 0000
   ------------
      1001 1010


   Operace  EXCLUSIVE  OR  srovn v  dva bity a vrac¡ jako vìsledek jedniŸku
jen v pý¡padØ, §e jsou oba srovn van‚ bity r…zn‚. Tato logick  operace m…§e
bìt velice u§iteŸn  v pý¡padØ, §e je nutn‚ vytvoýit komplement specifickìch
bit… ve slovØ/bytu, týeba v grafickìch aplikac¡ch.

   EXKLUZÖVNÖ LOGICKí SOU¬ET XOR
       Bit Ÿ. 0  Bit Ÿ. 1  Vìsledek
          0         0         0
          0         1         1
          1         0         1
          1         1         0

   V n sleduj¡c¡m pý¡kladØ jsou prostýedn¡  Ÿtyýi  bity  osmibitov‚ho Ÿ¡sla
invertov ny oprac¡ EXCLUSIVE OR s hodnotou 0011 1100:

         1010 0110
   XOR   0011 1100
   ---------------
         1001 1010


   Operaci  exkluz¡vn¡ho  logick‚ho  souŸtu XOR lze s vìhodou pou§¡t tak‚ k
nulov n¡ pamØœov‚ho m¡sta m¡sto instrukce MOV (napý. XOR AX,AX nuluje AX).

   Operace SHIFT LEFT/RIGHT,  ROTATE  LEFT/RIGHT a COMPLEMENT pracuj¡ jen s
jedn¡m operandem. Instrukce SHIFT  poskytuje  elegantn¡  metodu  pro velice
rychl‚  n soben¡  nebo  dØlen¡  Ÿ¡sla  dvØma. Tato metoda  nejen  poskytuje
vìsledek velice rychle,  ale  je  hlavnØ  vìhodn  u poŸ¡taŸ…, kter‚ ve sv‚m
instrukŸn¡m souboru nemaj¡ realizov ny operace dØlen¡ a n soben¡  a  kdy je



                                  - 21 - 




tyto operace nutno  zabezpeŸit  programovØ.  Jestli§e  uva§ujeme  Ÿ¡sla bez
znam‚nka, pak posun Ÿ¡sla o jednu pozici doleva a dozazen¡ hodnoty 0 do LSB
m  za n sledek vyn soben¡ Ÿ¡sla dvØma:

   SHL   0100 0001   (dekadicky 65)
   ---------------
         1000 0010   (dekadicky 130)

 Jestli§e chceme podØlit Ÿ¡slo bez znam‚nka dvØma, pak staŸ¡p osuv  o jednu
pozici doprava a dosazen¡ hodnoty 0 do MSB:

   SHR   0000 1010   (dekadicky 10)
   ---------------
         0000 0101   (dekadicky 5)


   Instrukce  ROTATE  umo§åuje  pýeskupovat bity v Ÿ¡sle.  PodobnØ  jako  u
operace SHIFT  je  mo§n‚  rotovat  doprava  Ÿi  doleva (ve smØru RIGHT nebo
LEFT). Na rozd¡l od operace SHIFT, kdy je nejkrajnØjç¡ bit  v§dy "ztracen",
operace ROTATE pýesunuje  "vypad vaj¡c¡"  bit na voln‚ m¡sto vznikaj¡c¡ pýi
rotaci na druh‚m konci Ÿ¡sla:

   ROR   0000 1111   (rotace doprava)
   ---------------
         1000 0111
   ROL   0000 1111   (rotace doprava)
   ---------------
         0001 1110































                                  - 22 - 










                            K a p i t o l a   3

                            Adresovac¡ techniky


   Instrukce mikroprocesoru 80286/80386 obsahuje nejen informace o operaci,
kter   m   bìt  provedena,  ale  souŸasnØ  v  sobØ nese i informaci o  typu
zpracov vanìch  operand…  a  o  jejich  lokalizaci v pamØti.  Existuje  osm
z kladn¡ch adresovac¡ch mod…:

   1.  Bezprostýedn¡ adresov n¡ (immediate addressing)

   2.  Registrov‚ adresov n¡ (register addressing)

   3.  Pý¡m‚ adresov n¡ (direct addressing)

   4.  Registrov‚ nepý¡m‚ adresov n¡ (register indirect addressing)

   5.  B zov n¡ (based addressing)

   6.  Pý¡m‚ registrov‚ adresov n¡ (direct indexed addressing)

   7.  B zovan‚ indexov‚ adresov n¡ s pýem¡stØn¡m nebo bez pýem¡stØn¡ (base
       indexed addressing with or without displacement)

   8.  Extenze pro 80386



---------------------------------------------------------------------------
Bezprostýedn¡ adresov n¡
---------------------------------------------------------------------------


   Mikroprocesor dek¢duje adresovac¡ m¢d  podle  syntaxe  z pisu instrukce.
Napý¡klad u instrukce

   MOV AH,00
   MOV AL,04

je  hodnota  operandu  um¡stØna pý¡mo uvnitý instrukce  -  bezprostýednØ  v
instrukci.   Registr   AH   je  nulov n  (hodnotou  00)  a  registr  AL  je
inicializov n na hodnotu 0000 0100  bin rnØ. Je týeba pýipomenout, §e 80386
akceptuje i operandy dlouh‚ 32 bit…. N sleduj¡c¡ pý¡klad  pýesouv   16 bit…
dlouhì zdrojovì operand  do  registru AX (ka§dì hexadecim ln¡ pý¡mì operand
mus¡ zaŸ¡nat Ÿ¡slic¡ 0) :

   MOV AX,0FFFFH





                                  - 23 - 




---------------------------------------------------------------------------
Registrov‚ adresov n¡
---------------------------------------------------------------------------


   U registrov‚ho adresov n¡  je  hodnota zdrojov‚ho operandu ji§ ulo§ena v
nØkter‚m z  vnitýn¡ch  vçeobecnìch  (general)  registr…  80286/80386.  Tato
hodnota    m…§e    bìt    osmibitov ,    çestn ctibitov    nebo   u   80386
dvaatýicetibitov .  Mikroprocesor  interpretuje  d‚lku operandu podle jm‚na
registru. Napý¡klad:

   MOV DS,AX

   Tento zp…sob registrov‚ho adresov n¡ ý¡k  mikroprocesoru, aby vzal 16-ti
bitovì obsah zdrojov‚ho operandu - registru A (celì AX) - a pýesunul jej do
16-ti bitov‚ho registru DS. Tento zp…sob adresov n¡ lze aplikovat i na 8-mi
bitovì zdrojovì operand :

   MOV DL,AL

   Z  uv dØnìch  osmi  adresovac¡ch  m¢d…  vy§aduj¡   registrov‚   a  pý¡m‚
adresov n¡  nejm‚nØ  strojovìch  takt….  Jeliko§  data  operand…  jsou  ji§
zahrnuty v  instrukci  samotn‚,  nen¡  zapotýeb¡  § dnìch  ŸasovØ n roŸnìch
pý¡stup… do hlavn¡ pamØti, abychom hodnoty operand… z¡skali.

   Dalç¡ popisovan‚ adresovac¡ m¢dy vy§aduj¡ v¡ce strojovìch takt…, proto§e
mikroprocesor mus¡ spoŸ¡tat adresu  operandu  na  z kladØ  adresy segmentu,
offsetu (posunut¡) v  segmentu  a  Ÿasto  i  obsahu  indexov‚ho  a b zov‚ho
registru. Takto z¡skan  adresa je oznaŸov na jako efektivn¡ adresa operandu
(effective address, EA).



---------------------------------------------------------------------------
Pý¡m‚ adresov n¡
---------------------------------------------------------------------------


   U pý¡m‚ho adresov n¡ je offset  operandu v segmentu (t.j. jeho relativn¡
vzd lenost  od  poŸ tku  segmentu)  obsa§en  v registru jako  16-ti  bitov 
hodnota. Tento  offset je pýiŸten k posunut‚mu obsahu datov‚ho segmentov‚ho
registru  DS  a  hodnotou  tohoto  souŸtu  je  20-ti bitov   adresa  (pokud
pracujeme  v  re ln‚m  m¢du)  EA,  kter  je ji§ fyzickou adresou  operandu.
VØtçinou je operandem pý¡m‚ho adresov n¡ n vØçt¡.

   Napý¡klad  instrukce  MOV  AX,MYDATA  na  obr zku  3-1.   po§aduje,  aby
mikroprocesor naplnil registr AX obsahem pamØœov‚ho m¡sta, na kter‚ ukazuje
adresa spojen  s  n vØçt¡m  MYDATA. VçimnØte si, jak mikroprocesor uchov v 
ni§ç¡ byte operandu na ni§ç¡ adrese a vyçç¡ byte na vyçç¡ adrese.










                                  - 24 - 




                        Obr. 3.1: Pý¡m‚ adresov n¡

     Instrukce MOV     MOV AX,MYDATA          0005
                                              0004
     Registr AX        1111111100000000       0003    FF
     po provedeni                             0002    00      MYDATA
     instrukce MOV                            0001
                                              0000
                                              adresy



---------------------------------------------------------------------------
Registrov‚ nepý¡m‚ adresov n¡
---------------------------------------------------------------------------


   U  nepý¡m‚ho  registrov‚ho  adresov n¡  je  -  nam¡sto  reference adresy
zdrojov‚ho operandu prostýednictv¡m n vØçt¡ -  hodnota  operandu  z¡sk na z
offsetu ulo§en‚ho v jednom z  n sleduj¡c¡ch registr…: SI (source index), DI
(destination index), BX (base register)  nebo  (za  urŸitìch  okolnost¡) BP
(base pointer).

   Mikroprocesor   rozpozn    nepý¡m‚   registrov‚  adresov n¡  ze  syntaxe
instrukce.  OznaŸen¡  zdrojov‚ho  operandu je v hranatìch  z vork ch  [  ].
Napý¡klad na dalç¡m obr zku bude instrukce spr vnØ provedena jen v pý¡padØ,
§e registr BX byl pýedem  naplnØn hodnotou urŸuj¡c¡ offset pamØœov‚ho m¡sta
MYDATA. To m…§e bìt provedeno napý¡klad oper torem OFFSET takto:

   MOV BX,OFFSET MYDATA
nebo je mo§n‚ vyu§¡t instrukce LEA (Load Effective Address):

   LEA BX,MYDATA

                  Obr. 3.2: Nepý¡m‚ registrov‚ adresov n¡

                       MOV AX,[BX]            0005
                                              0004
                                              0003    FF
                  BX   0000000000000010       0002    00      MYDATA
                                              0001
                  AX   1111111100000000       0000
                                              adresy

   Registrov‚ nepý¡m‚ adresov n¡ lze pou§¡t k odkaz…m na data uchov van  ve
form tu  tabulky.  Pý¡stup  k jednotlivìm polo§k m takov‚  tabulky  se  pak
zefektivn¡ - m¡sto pomØrnØ ŸasovØ  znaŸnØ n roŸnìch operac¡ vìbØru adresy z
pamØti a pak  vìbØru  operandu  z  t‚to  adresy  prov d¡  mikroprocesor jen
inkrementaci b zov‚ho registru a vìbØr operandu z takto vznikl‚ adresy.










                                  - 25 - 




---------------------------------------------------------------------------
B zov‚ relativn¡ adresov n¡
---------------------------------------------------------------------------


   Efektivn¡ adresa operandu je u b zov‚ho  relativn¡ho  adresov n¡ z¡sk na
jako souŸet hodnoty pýem¡stØn¡ (displacement)  a  obsahu  b zov‚ho registru
(BP  nebo  BX).  Pýem¡stØn¡  je  uva§ov no vzhledem k  vybran‚mu  segmentu.
Implicitn¡m segmentovìm registrem je  v  pý¡padØ  BP  registr SS, v pý¡padØ
b zov‚ho registru BX je j¡m DS. Toto implicitn¡  urŸen¡  se  d   ve vØtçinØ
pý¡pad… zmØnit pýedponou  segment:  (segment  overriding),  tedy  napý. mov
ax,es:[bp] pýesune do  registru  ax  slovo  z  offsetu o hodnotØ [bp] a pro
vytvoýen¡  horn¡  Ÿ sti  adresy operandu pýesouvan‚ho do ax je vzat registr
es.  B zov‚  relativn¡  adresov n¡  se   Ÿasto   pou§¡v    ke  zpý¡stupnØn¡
komplexn¡ch datovìch struktur (napý. z znam…).  B zovì  registr  ukazuje na
zaŸ tek struktury  (b zi), a jednotliv‚ polo§ky z znamu jsou vyb¡r ny podle
hodnoty pýem¡stØn¡. ZmØna hodnoty pýem¡stØn¡ m  za n sledek pý¡stup k jinìm
polo§k m uvnitý z znamu. Zpý¡stupnØn¡ stejn‚  polo§ky  v  r…znìch z znamech
lze jednoduçe dos hnout zmØnou obsahu b zov‚ho registru.

   Na pý¡kladØ uv dØn‚m na  dalç¡m  obr zku  obsahuje adresa MESGE1 ýetØzec
znak….  Instrukce  LEA  napln¡  registr  BX  offsetem.  Pý¡stup k  Ÿtvrt‚mu
elementu MESGE1 je zajiçtØn pýiŸten¡m  b zov‚ adresy (v registru BX) MESGE1
k pýem¡stØn¡ (m  hodnotu +4) uvnitý ýetØzce.

                   Obr. 3.3: B zov‚ relativn¡ adresov n¡

     MESGE1            DB 'ASSEMBLY LANGUAGE IS FAST','$'
     MESGE2            DB 'AND EFFICIENT','$'
                                              datovì segment
     LEA BX,MESGE1                            0009    4C    L
                                              0008    20    mezera
                                              0007    59    Y
     MOV AL,[BX]+4                            0006    4C    L
                                              0005    42    B
     BX 0000000000000000                      0004    4D    M
     AL 4D                                    0003    45    E
                                              0002    53    S
                                              0001    53    S
                                              0000    41    A     MESGE1

   Assembler  rozpozn  n sleduj¡c¡ týi zp…soby z pisu b zov‚ho  relativn¡ho
adresov n¡:

   LEA [BX]+4
   LEA 4[BX]
   LEA [BX+4]


   Prvn¡ z pis je neju§¡vanØjç¡; pýem¡stØn¡ nicm‚nØ m…§e  pýedch zet b zovì
registr nebo m…§e  bìt  zahrnuto v hranatìch z vork ch. Adresov n¡ element…
struktury MESGE1 by mØlo bìt  prov dØno  inkrementac¡  pýem¡stØn¡,  a zmØna
struktury  by mØla bìt provedena zmØnou b zov‚  adresy  (BX),  týeba  touto
instrukc¡:

   LEA BX,MESGE2 .



                                  - 26 - 




---------------------------------------------------------------------------
Pý¡m‚ indexov‚ adresov n¡
---------------------------------------------------------------------------


   U pý¡m‚ho indexov‚ho adresov n¡ je offset operandu vypoŸ¡t n jako souŸet
pýem¡stØn¡ vzhledem k indexregistru (SI nebo DI) uvnitý vybran‚ho segmentu.
¬asto je tohoto typu adresov n¡  pou§¡v no k pý¡stupu k prvk…m (statick‚ho)
pole. Hodnota pýem¡stØn¡ lokalizuje  zaŸ tek  pole,  a hodnota uchov van  v
indexregistru  lokalizuje  konkr‚tn¡  prvek  pole.  Na  rozd¡l  od z znam…,
jejich§ jednotliv‚ polo§ky mohou m¡t promØnnou d‚lku i typ, jsou prvky pole
homogenn¡. Jeliko§ jsou tedy prvky  pole stejn‚ho typu a velikosti, pr…chod
polem je jen ot zkou systematick‚ inkrementace  a  dekrementace pýem¡stØn¡.
Napý¡klad:

   MOV SI,4
   MOV AL,ARAY1[SI]     ; vybereme 4. prvek ARAY1

   Je  vçak  zapotýeb¡  d vat pozor na to, abychom vybrali spr vnou hodnotu
pýem¡stØn¡ vzhledem k typu  prvk…  pole. Pr vØ uv dØnì pý¡klad by zavedl do
registru AL Ÿtvrtou hodnotu pole ARAY1. Stejnì pý¡kaz by naplnil registr AX
hodnotou prvku pole ARAY1:

   MOV AX,ARAY1[SI]

Tentokr t by vçak hodnota prvku pole musela bìt çestn ctibitov .



---------------------------------------------------------------------------
B zov‚ indexov‚ adresov n¡
---------------------------------------------------------------------------


   U b zov‚ho indexov‚ho adresov n¡ je operand lokalizov n uvnitý vybran‚ho
segmentu  a  na  offsetu  urŸen‚m  souŸtem  obsah…  b zov‚ho, indexov‚ho  a
popý¡padØ i  hodnoty  pýem¡stØn¡.  Nen¡-li  pýem¡stØn¡  zahrnuto,  je tento
zp…sob adresov n¡ nejŸastØji pou§it k pý¡stupu k element…m dynamick‚ho pole
(t.j.  pole,   jeho§  poŸ teŸn¡  adresa  se  m…§e  mØnit  bØhem  vykon v n¡
programu).  Zahrnut¡  pýem¡stØn¡ umo§åuje pý¡stup  k  individu ln¡m  prvk…m
pole, kter‚ m…§e bìt polo§kou uvnitý napý. z znamu.


















                                  - 27 - 




                   Obr. 3.4: B zov‚ indexov‚ adresov n¡

     MOV AX, ELEMENT[BX][DI]          0025
                                      0024   FO
     BX = 0000                        0023   BF
     DI = 0020                        0022   90
                                      0021
                                      0020
                                             Z znam 3
                                      0015
                                      0014
                                      0013
                                      0012
                                      0011
                                      0010
                                             Z znam 2
                                      0005
                                      0004
                                      0003
                                      0002
     AX = F0BF                        0001
                                      0000   MYDATA
                                             Z znam 1

   V tomto pý¡padØ (viz  pýedeçlì  obr zek)  by  b zovì registr ukazoval na
zaŸ tek z znamu, pýem¡stØn¡ (uchov van‚ v DI) by  reprezentovalo vzd lenost
od poŸ tku z znamu k poŸ tku pole uvnitý z znamu a hodnota pýem¡stØn¡ prvku
pole by byla  obsa§ena  v promØnn‚ ELEMENT. Pýedpokl dejme hodnotu ELEMENTu
3.

   Na pý¡kladØ na  dalç¡m  obr zku  je  poŸ teŸn¡ (b zov ) adresa 0000 a je
um¡stØna  v  registru  BX. Polo§ka týet¡ho  z znamu  (kter   je  polem)  m 
pýem¡stØn¡  0020, je§ je uchov no v DI. Týet¡  prvek  pole  je  zpý¡stupnØn
pýem¡stØn¡m obsa§enìm v promØnn‚ ELEMENT inicializovan‚ na hodnotu 3.



---------------------------------------------------------------------------
Extenze u 80386
---------------------------------------------------------------------------


   Dvaatýicetibitov‚ adresn¡  m¢dy jsou rozç¡ýeny v tom smyslu, §e dovoluj¡
pou§it¡  libovoln‚ho  registru  jako  b zov‚ho  Ÿi  indexov‚ho.  Tyto  m¢dy
po§aduj¡, aby v b zov‚m a indexov‚m registru (pokud  jsou  pou§¡v ny), byly
validn¡   32-bitov‚  hodnoty.  Vçechny  instrukce  çestn ctibitov‚ho   m¢du
"oýez vaj¡" nejvyçç¡ch  16  bit…  dvaatýicetibitov‚ho  registru  a  hodnoty
nejvyçç¡ch bit… jsou tedy ignorov ny.











                                  - 28 - 










                            K a p i t o l a   4

                             Programovac¡ styl


   Program v assembleru  je  s‚ri¡ pý¡mo proveditelnìch pý¡kaz…, kter‚ jsou
instrukcemi z kladn¡ jednotky  poŸ¡taŸe.  Symbolick   mnemonika,  v  n¡§ je
program  v assembleru zaps n, se nazìv  zdrojovì  program.  Tak  jako  jin‚
jazyky i assembler m  svou pýesnØ definovanou syntax.

Ka§dì pý¡kaz v assembleru je slo§en ze Ÿtyý pol¡:

   1.  Pole jm‚na

   2.  Pole operace

   3.  Pole operandu

   4.  Pole pozn mek


Pole jm‚na (n vØçt¡)

   Pole "jm‚na", Ÿasto  oznaŸovan‚  tak‚ jako pole n vØçt¡, pýiýazuje pr vØ
referovan‚ adrese pamØti symbolick‚ jm‚no. Toto  symbolick‚  jm‚no umo§åuje
program toru  obracet   se  na  tuto  adresu  jm‚nem  a  eliminuje  nutnost
pamatov n¡  adres   v  Ÿ¡seln‚m  tvaru.  Notace  je  zvl çtØ  u§iteŸn   pýi
generov n¡  pýem¡stiteln‚ho  (relokatibiln¡ho)  c¡lov‚ho programu. Pou§it¡m
symbolickìch referenc¡ program tor umo§åuje spojovac¡mu  programu (linkeru)
nal‚zt  m¡sto,  na  kter‚ bude c¡lovì program v assembleru zaveden. Vçechny
reference  na  instrukce  se  pak  mohou  automaticky  mØnit s  mØn¡c¡m  se
um¡stØn¡m  programu  v  pamØti.  I  kdy§ je mo§n‚ pojmenovat (t.j.  opatýit
n vØçt¡m)  ka§dou  instrukci,  pole  n vØçt¡  je obvykle vyu§¡v no  pro  ty
instrukce, je§  jsou referov ny v definic¡ch dat, konstant, segment…, cykl…
a vol n¡ podprogram….


   Jm‚no (n vØçt¡) mus¡ zaŸ¡nat p¡smenem a m…§e m¡t a§ 31 znak…, vŸetnØ

    -  vçech p¡smen A - Z

    -  vçech Ÿ¡slic 0 - 9

    -  speci ln¡ch symbol… _ $ . ? @ %

   Pýi  vìbØru  jm‚na  mus¡me  db t  jist‚ opatrnosti. Nelze  pou§¡t  jm‚na
stejn‚ho s rezervovanìm slovem assembleru nebo  stejn‚ho  s assemblerovskou
direktivou (viz d le). Jestli§e  jm‚no  m   obsahovat  teŸku (.), pak teŸka
mus¡ bìt prvn¡m znakem jm‚na.




                                  - 29 - 




   PromØnn‚

   Jm‚no promØnn‚ reprezentuje pamØœov‚ m¡sto, je§  je  pý¡stupn‚ programu:
obsah  tohoto pamØœov‚ho m¡sta se m…§e  mØnit  bØhem  vykon v n¡  programu.
Definice promØnn‚ zahrnuje  informaci  o  adrese  pamØœov‚ho  m¡sta (adrese
promØnn‚), typu promØnn‚ a jej¡  velikosti. PromØnn‚ lze u§¡t jako operandy
v jednoduchìch, indexovanìch nebo strukturovanìch form ch.

   N vØçt¡

   Jm‚na pou§it  k oznaŸen¡ procesorem proveditelnìch instrukc¡ aplikaŸn¡ho
programu jsou oznaŸov na  jako  relativn¡  (code-relative).  Jm‚no  (nebo v
tomto pý¡padØ n vØçt¡) m  týi  atributy: adresu segmentu, offset segmentu a
deskriptor  NEAR  nebo  FAR.  Z kladn¡  jednotka  m…§e  adresovat konkr‚tn¡
n vØçt¡  dvØma  zp…soby.  Je-li  n vØçt¡,  je§  m   bìt referov no,  uvnitý
stejn‚ho programov‚ho segmentu  (code  segment),  je  k  lokalizaci pý¡kazu
oznaŸen‚ho n vØçt¡m  zapotýeb¡ jen offset segmentu. V tomto pý¡padØ ý¡k me,
§e n vØçt¡ je  typu  NEAR.  Ke  specifikaci n vØçt¡ typu NEAR staŸ¡ um¡stit
dvojteŸku  (:) bezprostýednØ za jm‚no nebo  pou§¡t  pseudooperaci  LABEL  s
atributem NEAR

   LOOP:
   COUNT LABEL NEAR

   Druhì zp…sob pro adresaci  n vØçt¡  potýebuje  adresu segmentu i hodnotu
offsetu.  To  je  pý¡pad,  kdy  referovanì  pý¡kaz  assembleru nen¡  uvnitý
stejn‚ho programov‚ho segmentuú-úv takov‚m  pý¡padØ  je  n vØçt¡ definov no
jako FAR:

   MYCODE LABEL FAR

   V pr vØ uk zan‚m pý¡kladØ je  pseudooperace  LABEL  pou§ita  s atributem
FAR. Atribut FAR lze u§¡t tak‚ pýi referenci  symbol…  pomoc¡ pseudooperac¡
EQU, PROC a EXTRN :

   TEN EQU FAR 10
   PRNTIT PROC FAR
   EXTRN RANDM:FAR

   Konstanty

   Jm‚ny je mo§n‚ oznaŸit tak‚  pamØœov   m¡sta  obsahuj¡c¡  hodnoty jednou
nastaven‚  a  nemØn¡c¡  se  bØhem  vykon v n¡  programu.  Tato  jen  jednou
inicializovan  pamØœov  m¡sta se nazìvaj¡ konstanty a mohou bìt osmi typ….

1. Bin rn¡ konstanty.

   Bin rn¡ konstanty obsahuj¡ posloupnosti jedniŸek a nul a jejich definice
je ukonŸena p¡smenem B. Napý¡klad:

   EIGHT EQU 00001000B

2. Dekadick‚ konstanty.






                                  - 30 - 




   Dekadick‚ konstanty obsahuj¡ posloupnost dekadickìch  Ÿ¡slic  0  a§  9 a
jsou nepovinnØ zakonŸov ny  p¡smenem  D. Posloupnost Ÿ¡sel je pova§ov na za
dekadickou  konstantu,  dokud   nen¡  explicitnØ  provedena  zmØna  z kladu
pseudooperac¡ RADIX. Zde je pý¡klad dekadick‚ konstanty:

   FORTY EQU 40D

3. Hexadecim ln¡ konstanty.

   Obsahuj¡ posloupnosti hexadecim ln¡ch Ÿ¡slic 0-9  a  A-F.  Definice mus¡
bìt zakonŸena v§dy p¡smenem H. Prvn¡ znak mus¡  bìt  jednou  z  Ÿ¡slic 0-9.
Prvn¡  znak  ý¡k  pýekladaŸi assembleru, §e jm‚no  je  Ÿ¡slem  a  ne  týeba
n vØçt¡m nebo promØnnou. Jestli§e  hexadecim ln¡  Ÿ¡slo  zaŸ¡n   nØkterìm z
p¡smen  A-F,  je  týeba  pýipojit  pýed nejlevØjç¡ p¡smeno nulu (0),  kter 
odstran¡  nejednoznaŸnost  pýi   pýekladu.  Hexadecim ln¡  Ÿ¡slo  m…§e  bìt
definov no týeba takto:

   FIFTY EQU   32H
   HEXNM EQU   0FFH

   Ve druh‚ definici je nula pýipojena pýed nejlevØjç¡ Ÿ¡slici k odstranØn¡
nejednoznaŸnosti definice.

4. Oktalov‚ konstanty.

   Skl daj¡ se z Ÿ¡slic 0-7 a ukonŸeny jsou p¡smenem O nebo Q.
   Napý¡klad:

   SIX EQU 6O (nebo 6Q)

5. Znakov‚ konstanty

   Znakov‚ konstanty mohou  obsahovat  libovoln‚  ASCII  znaky  uzavýen‚ do
jednoduchìch nebo dvojitìch uvozovek. Jesli§e znakov  konstanta m  v¡ce ne§
dva znaky, je týeba pou§¡t pseudooperace DB (define byte). Jestli§e ýetØzec
znak… obsahuje pouze jeden nebo  dva znaky, pak m…§eme pou§¡t pseudooperace
DD, DQ, DT nebo DW. Napý¡klad:

   INITL DD 'B'
   NAME DB '80286 ASSEMBLER'

6. Data v plovouc¡ ý dov‚ Ÿ rce (floating point)

   Tento datovì typ reprezentuje hodnoty  v dekadick‚ vØdeck‚ notaci a nen¡
podporov n assemblerem IBM Small Assembler.
Napý¡klad:

   SINE DD 0.332E-1

7. Hexadecim ln¡ Ÿ¡sla real

   Hexadecim ln¡ Ÿ¡slo real je konstantou, kter  obsahuje Ÿ¡slice 0 a§  9 a
p¡smena A a§ F, n sledovan‚ p¡smenem R. Jako u hexadecim ln¡ konstanty mus¡
bìt  prvn¡  Ÿ¡slice nØkterì ze symbol… 0  -  9.  Konstanta  mus¡  obsahovat
celkov‚ poŸet Ÿ¡slic rovnì 8, 16,  nebo  20,  pokud nen¡ prvn¡ Ÿ¡slice 0. V




                                  - 31 - 




takov‚m pý¡padØ mus¡ bìt celkovì poŸet Ÿ¡slic o jednu vØtç¡, t.j. 9,17 nebo
21. Tento datovì typ tak‚ nen¡ podporov n IBM Small Assemblerem. Napý¡klad:

   HRNUM DD 0FAB12345R

8. Pseudoinstrukce EQU

   N vØçt¡ v poli jm‚na  m…§e  bìt pýiýazena hodnota vìrazu v poli operand…
pou§it¡m  symbolu  EQU  nebo  pou§it¡m  znam‚nka rovnosti =.  Pou§it¡m  EQU
pýiýad¡me promØnn‚ hodnotu,  kter   se v pr…bØhu vykon v n¡ programu nem…§e
mØnit. Pou§ijeme-li oper toru = (to  je  tak‚  pseudoinstrukce  !), hodnota
konstanty se m…§e bØhem vykon v n¡ programu mØnit. Napý¡klad:

   SCRADD EQU [BP+16]
   BASNUM = 1980

   V prvn¡m  pý¡kladØ  je  symbol  SCRADD  substituov n  nam¡sto indexov‚ho
vìrazu [BP+16]. PodobnØ BASNUM m…§e bìt pou§¡v no nam¡sto Ÿ¡sla 1980. Nav¡c
teÔ m…§e bìt symbolu  BASNUM  pýiýazena  nov   hodnota v pr…bØhu vykon v n¡
programu.


   Jm‚na segment…

   Jm‚no  segmentu je uvedeno v poli  jm‚na  deklarace  segmentu.  Pý¡klad:
MYCODE SEGMENT PARA 'CODE'

   Pole operace

   Pole   operace   obsahuje   mnemonickou   zkratku   skuteŸn‚   instrukce
mikroprocesoru. Mnemonick  zkratka je dlouh  dva a§ çest p¡smen a pýipom¡n 
anglickì  n zev  instrukce.  Pou§it¡  mnemoniky  vytv ý¡  k¢d  mnohem  l‚pe
srozumitelnì  a  £roveå  mnemonickìch k¢d… je v podstatØ isomorfn¡ s £rovn¡
strojovìch  instrukc¡  (zobrazen¡  do  strojov‚  £rovnØ  prov d¡  konverzn¡
tabulka). Operace  uveden   v  poli  operace  m…§e  reprezentovat strojovou
instrukci, makroinstrukci nebo psudooperaci (pseudoinstrukci). Napý¡klad:

   INITIAL MOV AX,0H

   INITIAL je zde  n vØçt¡  a  MOV  operace. Po poli operace n sleduje pole
operand…. Ka§d  operace nejenom  ý¡k   assembleru,  co  m  udØlat, ale tak‚
specifikuje poŸet operand… a jejich typ.

   Operace  m…§e  obsahovat  odkaz  na  makro.  Takov   reference instruuje
assembler, aby zpracoval pýeddefinovanou sekvenci instrukc¡. Assembler tedy
generuje  zdrojov‚  instrukce  stejnØ  jako  by byly zaps ny  ve  zdrojov‚m
programu jako jeho Ÿ st. Napý¡klad:

   DOS_INT MACRO SERVICE_ID

   Tato operace ý¡k   assembleru,  §e n sleduj¡c¡ k¢d je Ÿ st makrodefinice
MACRO.  Pseudooperace (tak‚: pseudoinstrukce) obvykle neprodukuj¡  strojov‚
instrukce, ale ý¡d¡ assembler tak, aby prov dØl urŸit‚  operace  na datech,
vìpisech o pýekladu a makrodefinic¡ch.





                                  - 32 - 




   Pole operandu

   Pole operandu obsahuje  data,  kter   maj¡  bìt  zpracov v na instrukc¡.
Jestli§e instrukce vy§aduje jen jeden  nebo dva operandy, jsou od instrukce
oddØleny alespoå jednou  mezerou.  Jestli§e m  instrukce operandy dva, jsou
od  sebe  oddØleny  Ÿ rkou  (,).  NØkter‚  operace  vçak v…bec  nepotýebuj¡
operandy.

   Jakmile operace  potýebuje dva operandy, je prvn¡ operand nazìv n c¡lovì
a  druhì  zdrojovì.  Pý¡kladem  operac¡  vy§aduj¡c¡ch  dva   operandy  jsou
instrukce pýesunu dat, registrov‚ instrukce aj. Napý¡klad:

   MOV AX,8

je pý¡kladem bezprostýedn¡ho operandu. Zde  dojde  k  naplnØn¡  registru AX
Ÿ¡slem 8.

   Pole pozn mek

   Pole pozn mek je posledn¡ pole  a Ÿasto to neju§iteŸnØjç¡. Pole pozn mek
d v  prostor pro intern¡ koment ýe  a  dokumentaci  k  programu. Pozn mkov‚
ý dky jsou assemblerem ignorov ny a  jsou u§iteŸn‚ jen ve vìpisu zdrojov‚ho
programu. Je-li operace opatýena  pozn mkou,  je  týeba um¡stit pozn mku a§
alespoå jednu mezeru  za  posledn¡m  polem  operace  a  zaŸ¡nat  symbolem ;
(stýedn¡k).  Smyslem  pou§it¡  pozn mek  je  popsat  ty   Ÿ sti  zdrojov‚ho
programu, kter‚ nejsou bezprostýednØ srozumiteln‚. Napý¡klad:

   MOV AH,45H ; parametr pro Ÿten¡ znaku

   Jak lze vidØt z uveden‚ho pý¡kladu, pozn mka pom h  pochopit, proŸ je do
registru AH zavedena hodnota 45H. V tomto pý¡padØ jde o parametr pýeruçen¡,
kter‚mu odpov¡d  urŸit  operace BIOSu.


   Pý¡nos programov n¡ v assembleru

   V poŸ tc¡ch  programov n¡ byly veçker‚ programy ps ny ve strojov‚m k¢du.
Instrukce  byly  ps ny  v  hexadecim ln¡m  nebo bin rn¡m tvaru a pak  pý¡mo
dekodov ny technickìmi prostýedky. Jak  programy  rostly  co do velikosti a
slo§itosti, zvìçil se pronikavØ  Ÿas  potýebnì k vìvoji a ladØn¡ softwaru a
vznikla potýeba novìch, produktivnØjç¡ch metod k vytv ýen¡ program….

   Assembler byl pr vØ takovou  metodou.  Byl  jazykem l‚pe srozumitelnìm a
pochopitelnìm.  Automaticky udr§oval  ýadu  (zd nlivØ  nekoneŸnou)  detail…
inherentn¡ch programu ve strojov‚m k¢du. Neobsahoval nutnou  re§ii typickou
pro vyçç¡ programovac¡  jazyky  a generoval programy, kter‚ byly vykon v ny
velice rychle.

   Pý¡klad programu v assembleru

   Uvedeme pý¡klad pýelo§en‚ho programu v assembleru.  Prav   strana naçeho
programu obsahuje assemblerovskì zdrojovì k¢d, kterì lze snadno  Ÿ¡st  a je
dobýe dokumentov n. Spolu s t¡mto zdrojovìm textem je na lev‚ stranØ uveden
i strojovì ekvivalent symbolick‚ho z pisu.  Je  vidØt,  §e  pro nezkuçen‚ho
program tora je assemblerovskì program extr‚mnØ "zaçifrovanì".




                                  - 33 - 




Microsoft MACRO Assembler Version 5.0             Page 1-1

                                                  09-19-88
     1                    page ,132
     2                    ;Pro procesory 8086/80386
     3                    ;program ilustruje
     4                    ;hexadecimalni secitani
     5
     6 0000               STACK   SEGMENT PARA STACK
     7 0000 40            [ DB 64 DUP ('MYSTACK ')
     8                      4D 59 53 54
     9                      41 43 48 20
     10                           ]
     11
     12 0200              STACK   ENDS
     13
     14 0000              MYCODE  SEGMENT PARA 'CODE'
     15 0000              MYPROC  PROC FAR ;
     16                   ASSUME  CS:MYCODE,SS:STACK
     17 0000 1E           PUSH    DS
     18 0001 2B C0        SUB     AX,AX
     19 0003 50           PUSH    AX
     20
     21 ;NASLEDUJE SOUCET TRI CISEL (BEZPROSTREDNI ADRESOVANI)
     22 0004 B0 23        MOV     AL,23H  ;PRVNI CISLO
     23 0006 04 0A        ADD     AL,0AH  ;PRICTI 0AH K REG. AL
     24 0008 04 10        ADD     AL,10H  ;PRICTI 10H K REG. AL
     25                   ;KONEC PRIKLADU SECITANI,VYSLEDEK V REGISTRU AL
     26
     27 000A C0           RET             ; PREDEJ RIZENI DOSU
     28 000B              MYPROC  ENDP    ; KONEC PROCEDURY
     29 000B              MYCODE  ENDS    ; KONEC SEGMENTU
     30
     31                   END             ; KONEC PROGRAMU V ASSEMBLERU



   Prvn¡  sloupeŸek,  Ÿ¡sla  od  1  do  31,  jsou   Ÿ¡sla   ý dk…  vkl dan 
assemblerem.  Druhì sloupeŸek obsahuje skuteŸn‚ adresy  pamØti,  v  n¡§  je
pýelo§en   mnemonick  operace (instrukce) ulo§ena. Jsou to  çestn ctibitov‚
adresy reprezentovan‚ v hexadecim ln¡m form tu.  Týet¡  a  Ÿtvrtì sloupeŸek
obsahuj¡ skuteŸnì tvar strojov‚ho k¢du, kterì odpov¡d   mnemonick‚ operaci.
Tyto sloupeŸky se mØn¡ podle typu instrukce a poŸtu jej¡ch operand….

   Zbìvaj¡c¡ sloupeŸky ji§ odpov¡daj¡ popsanìm pol¡m zdrojov‚ho  programu v
assembleru: pole jm‚na, operace, operandu a pozn mky. ü dky 2 a§ 4, 21 a 25
obsahuj¡  jen  pozn mky.  V dalç¡ch Ÿ stech  t‚to  knihy  se  nauŸ¡me  ps t
programy respektuj¡c¡ tvar naznaŸenì v naçem pý¡kladØ.











                                  - 34 - 










                            K a p i t o l a   5

                            évod do assembleru


   V t‚to kapitole budeme  podrobnØ  diskutovat o tom, co assembler je, naŸ
je  potýeba  a  co  vlastnØ  dØl .  Prozkoum me  podobn‚  i  rozd¡ln‚  rysy
assembleru  a  kompil toru  vyçç¡ho  programovac¡ho  jazyka.  Na  uk zkov‚m
programu budeme demonstrovat, jak vytv ýet, pýekl dat a spouçtØt jednoduchì
assemblerovskì program.

   Program SAMPLE.ASM je pou§it jako  model  programu  k  demonstraci vçech
nezbytnìch souŸ st¡ assemblerovsk‚ho programu.  Dalç¡  detaily  tìkaj¡c¡ se
instrukŸn¡ho souboru 80286/80386 lze nal‚zt v kapitole n sleduj¡c¡.

   Assembler  je poŸ¡taŸovì program vytvoýenì tak,  aby  dovedl  Ÿ¡st  text
zapsanì  podle  jistìch  syntaktickìch  pravidel,  tzv.  zdrojovì  program.
Zdrojovì program je zaps n v anglickìch zkratk ch, kter‚  se  oznaŸuj¡ jako
mnemonika. Assembler akceptuje tuto mnemoniku  a pýev d¡ ji na bin rn¡ nuly
a jedniŸky, kter‚ jedin‚  jsou  pýirozenìm  jazykem  mikroprocesoru. Takov 
pýelo§en  verze zdrojov‚ho programu se nazìv  strojovì k¢d (program).

   Ka§d   mnemonika  je  smyslupln   zkratka pý¡kazu reprezentuj¡c¡ho jednu
skuteŸnou  strojovou  instrukci.  Mnemonika  (t‚mØý v§dy) odpov¡d  skuteŸn‚
instrukci poŸ¡taŸe. Mnemonika je to, co Ÿin¡ program v assembleru Ÿitelnìm,
lehce  vytvoýitelnìm  a  trasovatelnìm.  Pý¡mì  vztah  mezi   mnemonikou  a
strojovou  instrukc¡ umo§åuje assembleru rychlì pýevod zdrojov‚ho  programu
na strojovì k¢d.

   PýekladaŸ vyçç¡ho programovac¡ho jazyka prov d¡ Ÿinnost  podobnou  v tom
smyslu, §e Ÿte zdrojovì program a pýev d¡ jej na strojovì k¢d. Programov n¡
ve vyçç¡m programovac¡m jazyce poskytuje program torovi  v¡ce  prostoru pro
soustýedØn¡ se na  probl‚m  samotnì  a  dovoluje  mu  nezabìvat  se detaily
le§¡c¡mi o nØkolik £rovn¡ n¡§e (napý. kter‚ registry a jak   pamØœov  m¡sta
m   pou§¡t  atp.).  Vìsledkem je program,  kterì  je  znaŸnØ  nez vislì  na
konkr‚tn¡m mikroprocesoru. Program ve vyçç¡m programovac¡m jazyce  je dobýe
Ÿitelnì  a  jeho  struktura je velice podobn   obecnØ  zapsan‚mu  algoritmu
ýeçen¡ dan‚ho probl‚mu. Mezi programem  ve  vyçç¡m  programovac¡m  jazyce a
jeho  pýelo§enìm  tvarem  vçak nen¡ pý¡mì  vztah  jako  mezi  mnemonikou  a
strojovou instrukc¡ u assembleru. Pýelo§enì tvar programu je obvykle mnohem
vØtç¡ ne§ "dobýe"  napsanì  ekvivalentn¡ program v assembleru. Nechceme t¡m
vçak  ý¡ci,  §e  kompil tory  nejsou  schopny  generovat  kvalitn¡ k¢d.  Ve
skuteŸnosti byste asi po prvn¡ch  zkuçenostech  s  assemblerem  radØji dali
pýednost kompil toru nØkter‚ho vyçç¡ho programovac¡ho jazyka.









                                  - 35 - 




---------------------------------------------------------------------------
Strojovì k¢d versus jazyk symbolickìch instrukc¡
---------------------------------------------------------------------------


   N sleduj¡c¡ uk zka programu ilustruje  u§iteŸnost  assembleru  a n zornØ
ukazuje pý¡mou korespondenci mezi instrukc¡  assembleru  a  jej¡m strojovìm
ekvivalentem. Oba fragmenty program… -  strojovì k¢d i program v assembleru
-  jsou  z  funkŸn¡ho  hlediska  identick‚. Oba prov dØj¡  urŸit‚  nezbytn‚
inicializaŸn¡ operace, pak pln¡ stýadaŸ hodnotou ulo§enou v promØnn‚ NUMONE
a nakonec ke stýadaŸi pýiŸ¡taj¡ hodnotu 3H :

     Strojovì k¢d                   Ekvivalent v jazyce
                                    symbolickìch instrukc¡
                                    (assembleru)
     --------------------------------------------------------------
     00011110                       PUSH            DS
     00101011                       SUB             AX,AX
     11000000
     01010000                       PUSH            AX
     10111000                       MOV             AX,MYDATA
     00000001
     11101100
     10001110                       MOV             DS,AX
     11011000
     10100001                       MOV             AX,NUMONE
     0000
     00000101                       ADD             AX,3H
     0011


   Vìsledek  pýekladu  zdrojov‚ho  programu  v  assembleru  se  tak‚ nazìv 
relokatibiln¡ k¢d. Jakmile  m me  program ve tvaru relokatibiln¡ho k¢du, je
mo§n‚ jej pý¡mo zav‚st do pamØti a po nastaven¡ pý¡sluçnìch vazeb spustit.

   Programov n¡  ve  strojov‚m  k¢du  je  ŸasovØ  vysoce  n roŸn   Ÿinnost,
zatØ§uje oŸi a vytvoýenì program nebìv  snadn‚ odladit. Jak  bylo  vidØt  v
pýedchoz¡m pý¡kladØ,  nen¡  bezprostýednØ  zýejm‚,  co  vlastnØ  jednotliv 
bin rn¡ Ÿ¡sla reprezentuj¡ - jsou to data nebo instrukce Ÿi adresy ?

   NaçtØst¡  pro n s, m me k dispozici asemblery,  kter‚  n m  pýi  procesu
vytv ýen¡  strojov‚ho  programu pom haj¡. VidØli  jsme,  §e  assemblerovsk 
verze pýedchoz¡ho fragmentu programu  je  mnohem  pochopitelnØjç¡  ne§ jej¡
strojovì ekvivalent. Srozumiteln‚ anglick‚ zkratky nahradily nesrozumiteln 
bin rn¡ Ÿ¡sla.

   VçimnØme si  jeçtØ filosofie vìvoje mikroprocesor… firmy INTEL. INTEL se
sna§il   zachovat   kompatibilitu    s   ostatn¡mi   Ÿleny   sv‚   "rodiny"
mikroprocesor…, poŸ¡naje od prvn¡ch  procesor…  pýes 8080, 8088 a 8086 a§ k
souŸasn‚  generaci.  To  znamen ,  §e  ka§d   nov   generace mikroprocesor…
pýich z¡ s  rozs hlejç¡m  instrukŸn¡m  souborem,  hardwarovìmi vylepçen¡mi,
zvìçenou rychlost¡ atp., pýiŸem§ pýedchoz¡ aplikace jsou zachov ny. Proto§e
ka§dì  novì   mikroprocesor   obsahuje   nadmno§inu   (superset)  instrukc¡
pýedchoz¡ho mikroprocesoru, star‚ programy bude mo§n‚  vykon vat  buÔ zcela
beze  zmØn  nebo  jen   s   nepatrnìmi   £pravami  na  nejnovØjç¡  generaci




                                  - 36 - 




mikroprocesor…. To je smyslem  £sil¡  o  zachov ni kompatibility - u§ivatel
nemus¡ znovu vyv¡jet stejnì software.



---------------------------------------------------------------------------
Typickì proces pýi vìstavbØ program… v assembleru
---------------------------------------------------------------------------


   Vytv ýen¡ program… v assembleru pýedstavuje sekvenci  nØkolika  krok…. V
podstatØ m…§eme vydØlit týi z kladn¡ kroky:

   1.  Textovìm editorem vytvoý¡me zdrojovì program

   2.  Pýelo§¡me  assemblerem  zdrojovì  program  a  z¡sk me  relokatibiln¡
       program

   3.  Spojov n¡m   z¡sk me   z   relokatibiln¡ho   programu   exekutabiln¡
       (proveditelnì) k¢d ve tvaru .EXE souboru


   Alternativn¡ metodou je vytvoýen¡ souboru .COM. PodrobnØ je tato mo§nost
diskutov na v pý¡loze ke  ka§d‚mu  assembleru.  KromØ tØchto tý¡ z kladn¡ch
krok… je do  vìvojov‚ho  cyklu  vytv ýen¡  assemblerovsk‚ho  programu týeba
zahrnout i dalç¡ krok spoŸ¡vaj¡c¡ v ladØn¡ (debugging) programu, proto§e je
t‚mØý nemo§n‚, §e hned napoprv‚ nap¡çete bezchybnì assemblerovskì program.

   KROK 1: Vytv ýen¡ zdrojov‚ho programu

   Vhodnìm  editorem (nejl‚pe obrazovkovìm - full-screen editor)  vytvoý¡te
zdrojovì program s  extenz¡  .ASM  a  ulo§¡te  jej na disk nebo disketu pod
jm‚nem týeba SAMPLE.ASM.  VçimnØme  si  nyn¡  bl¡§e  jednotlivìch instrukc¡
vaçeho programu SAMPLE.ASM. Prvn¡ dva ý dky programu

   1. ;PRIKLAD PROGRAMU PRO IBM 8088/80286
   2. ;PROGRAM PRO ZAPIS ZNAKU NA OBRAZOVKU


jsou pozn mkami. Ka§dì ýetØzec  znak…,  pýed  n¡m§  je um¡stØn stýedn¡k, je
assemblerem ignorov n. Zde  pozn mka  vystihuje,  co  m   program prov dØt.
N sleduj¡c¡  Ÿ st  programu  obsahuje dva pý¡kazy, SEGMENT (ý dek 3) a ENDS
(ý dek 5), kter‚ definuj¡ poŸ tek a konec urŸit‚ho celku v programu: zde je
to segment z sobn¡ku STACK SEGMENT :

3. STACK SEGMENT  PARA 'STACK'
4.       DB       64 DUP ('STACK')
5. STACK ENDS


   Vçechny týi  uv dØn‚ makroassemblery umo§åuj¡ udr§ovat v pamØti a§ Ÿtyýi
souŸasnØ aktivn¡ segmenty:  CODE,  DATA, STACK a EXTRA. Segmentace umo§åuje
dosa§en¡ dobýe strukturovan‚ho, modul rn¡ho zdrojov‚ho programu.






                                  - 37 - 




   ü dek 3 obsahuje slovo  STACK  v poli n vØçt¡ a specifikuje jm‚no, kter‚
je segmentu pýiýazeno. Operand PARA specifikuje, §e segment bude zaŸ¡nat na
16-bytov‚ hranici (standardn¡ paragraf)  v  pamØti.  Slovo 'STACK' na konci
ý dku specifikuje jm‚no, kter‚ bude spojeno s t¡mto  segmentem  v ký¡§ovìch
referenc¡ch.

   ü dek  4  definuje  velikost  z sobn¡ku,  64  D(efined)  B(ytes) a  ý¡k 
assembleru, §e m  tato m¡sta  v pamØti inicializovat slovem 'STACK'. Pý¡kaz
ENDS na ý dku 5 ukonŸuje definici segmentu.

   Dalç¡ týi ý dky programu definuj¡ a pojmenov vaj¡ segment dat - DATA:

6. DATA     SEGMENT PARA 'DATA'
7. MESAGE   DB 'JAK SE VAM TO LIBI, VAZENI ?','$'
8. DATA     ENDS



   Tento segment tak‚ zaŸ¡n  na 16-bytov‚ hranici a v ký¡§ovìch referenc¡ch
bude vyps n jako 'DATA' (ý dek 6). V tomto velice kr tk‚m  datov‚m segmentu
je definov na jen jedna promØnn   - MESAGE. Je specifikov na jako ýetØzcov 
promØnn , inicializovan  hodnotou 'JAK SE VAM TO LIBI, VAZENI ?'.

   Je týeba zd…raznit, §e nØkter‚ assemblery jsou na um¡stØn¡ segmentu DATA
(kde  jsou  definov ny  a  referov ny  promØnn‚)  velice  citliv‚.  Vçechny
pý¡klady v tomto textu maj¡ segment DATA um¡stØn na zaŸ tku  programu. Tyto
segmenty vçak mohou bìt um¡stØny i pod segmentem CODE. Jestli§e je ve vaçem
programu  segment  DATA  um¡stØn  na  zaŸ tku programu a  pýesto  dost v te
chybov‚ hl çen¡  kv…li um¡stØn¡ datov‚ho segmentu, pýesuåte segment DATA na
konec vaçeho programu.

   ü dek  9  definuje  zaŸ tek  segmentu  CODE, kterì le§¡ opØt na  hranici
paragrafu (16 byte) a bude oznaŸen slovem 'CODE' v ký¡§ovìch referenc¡ch:

9. CODE     SEGMENT  PARA 'CODE' ;DEFINUJ SEGMENT CODE


VçimnØte si pozn mek na tomto a n sleduj¡c¡ch ý dc¡ch.

   N sleduj¡c¡ ý dek obsahuje n vØçt¡ MAIN a deklaraci procedury PROC:

10.   MAIN     PROC     FAR ;PROCEDURA SE JMENUJE MAIN



   Procedury  jsou Ÿ sti program…, kter‚ jsou vykon v ny  tak,  §e  jsou  z
jinìch  program…  vol ny.  Pýi  ka§d‚m  vyvol n¡  procedury   je  procedura
provedena a ý¡zen¡ je vr ceno zpØt volaj¡c¡mu programu.

   Deklarace  procedury  zaŸ¡n   symbolem PROC a konŸ¡  symbolem  ENDP.  Za
symbolem PROC je uveden buÔ atribut NEAR nebo FAR. Tento  atribut informuje
assembler o tom, jakì typ skoku m  assembler prov‚st.  Ve  vØtçinØ  pý¡pad…
atributy NEAR a FAR  urŸuj¡,  jakì typ n vratov‚ instrukce m  bìt generov n
pro  pr vØ  pýekl danou  proceduru.  Vol n¡  CALL  procedury  specifikovan‚
atributem  NEAR ponech v  na vrcholu z sobn¡ku  jen  hodnotu  registru  IP,




                                  - 38 - 




zat¡mco vol n¡  CALL  procedury  specifikovan‚  atributem  FAR  uchov v  do
z sobn¡ku oba registry CS a IP (v uveden‚m poýad¡).

   Vçechny  ý dky  programu  se  samozýejmØ  budou  ve   vaçich  programech
vyskytovat v tØch Ÿi onØch modifikac¡ch. Ka§dì program bude m¡t napý. jinak
dimenzov n a inicializov n segmenty  STACK  a  DATA.  Nebudou se vçak mØnit
n sleduj¡c¡  ý dky  (11  a§  17),  kter‚   pýedstavuj¡   standardn¡  prolog
assemblerovsk‚ho programu. Pro tento prolog  budeme  tak‚  pou§¡vat çirç¡ho
n zvu nutn  programov  re§ie .



---------------------------------------------------------------------------
Programov  re§ie
---------------------------------------------------------------------------


   N sleduj¡c¡   instrukce  ustavuj¡  z kladn¡  vazby  na  týi   definovan‚
programov‚ segmenty:

11.   ASSUME CS:CODE,DS:DATA,ES:DATA,SS:STACK


   Pý¡kaz ASSUME ý¡k  assembleru, §e m  spojit registr CS (Code  Segment) s
um¡stØn¡m segmentu CODE, registry DS a ES (Data Segment a Extra  Segment) s
um¡stØn¡m segmentu DATA a registr SS s um¡stØn¡m segmentu STACK. Znamen  to
tedy, §e napý. instrukce mov ax,var napln¡ registr ax obsahem promØnn‚ var,
jej¡§ adresa bude z¡sk na jako souŸet obsahu registru DS a posunut¡ symbolu
var vzhledem k zaŸ tku segmentu DATA, na nØho§ ukazuje DS.

   N sleduj¡c¡ týi instrukce slou§¡  k  "zapamatov n¡"  um¡stØn¡ operaŸn¡ho
syst‚mu: jakmile assemblerovskì program skonŸ¡ svoji Ÿinnost,  znovu ustav¡
vçechna nezbytn  spojen¡.

12.      PUSH  DS    ;UCHOVEJ DS
13.      SUB   AX,AX ;NULUJ AX
14.      PUSH  AX    ;UCHOVEJ TAKE NULOVY OFFSET


   ü dek 12 ukl d  aktu ln¡ obsah registru DS na vrchol z sobn¡ku. ü dek 13
generuje nulovou hodnotu  pro  offset  a  na  ý dku 14 je tato hodnota tak‚
ulo§ena do z sobn¡ku.

   Uchov n¡  star‚  hodnoty  registru  DS  je  tak  snadn‚ jako  jeho  nov‚
naplnØn¡. Registr DS vçak nem…§e  bìt naplnØn hodnotou promØnn‚. To ukazuj¡
ý dky 15 a 16:

15.      MOV   AX,DATA  ;VEZMI DO A UMISTENI DATA
16.      MOV   DS,AX    ;NAPLN JIM REGISTR DS


   NaplnØn¡ registru ES bude analogick‚:

17.      MOV   ES,AX





                                  - 39 - 




   V tomto pý¡kladØ ukazuj¡ oba registry na stejn‚ pamØœov‚ m¡sto. ü dek 17
je posledn¡m ý dkem programov‚ re§ie  spojen‚  s  prologem assemblerovsk‚ho
programu.

   ü dky  18 a§ 21 jsou vlastn¡m algoritmem  naçeho  programu.  M¡sto  nich
byste vlo§ili sv…j vlastn¡ k¢d:

18.   ; PROGRAM PRO VYPIS ZPRAVY NA OBRAZOVKU
19.      LEA   DX,MESAGE   ;ADRESA ULOZENI ZPRAVY
20.      MOV   AX,09       ;PARAMETR DOSu
21.      INT   21H         ;VOLEJ PRERUSENI DOSu


   V tomto pý¡padØ bude n ç program vypisovat na obrazovku text JAK  SE VAM
TO LIBI, VAZENI ?. Po vyps n¡  textu  program  ukonŸ¡ svoji Ÿinnost - to je
n pln¡ n sleduj¡c¡ch ý dk…:

22.         RET         ;NAVRAT RIZENI DO DOSu
23. MAIN ENDP        ;KONEC PROCEDURY MAIN
24. CODE ENDS        ;KONEC SEGMENTU CODE
25.         END         ;KONEC ZDROJOVEHO PROGRAMU


   Instrukce  RET  (ý dek  22) vyzved v  n vratovou adresu ze z sobn¡ku a v
tomto pý¡padØ zajiçœuje n vrat do  operaŸn¡ho  syst‚mu.  ü dek  23 ukonŸuje
definici procedury. Segment  CODE  je  ukonŸen  pý¡kazem ENDS na ý dku 24 a
celì assemblerovskì program  ukonŸuje  instrukce END (ý dek 25), kter  ý¡k 
assembleru, §e dos hl konce zdrojov‚ho  programu.  Jestli§e  uchov me tento
program  na  disku  jako  SAMPLE.ASM,  m…§eme  pýej¡t  ke druh‚mu  kroku  v
programov n¡ v assembleru.

   KROK 2: generov n¡ relokatibiln¡ho k¢du

   V n sleduj¡c¡m  vìkladu  si  uk §eme,  jak  co  nejjednoduçeji generovat
soubor .OBJ - t.j. soubor uchov vaj¡c¡ program v relokatibiln¡m tvaru.

   Jestli§e m me v jednotce A disketu s nØkterìm z assembler… a  v jednotce
B disketu se zdrojovìm programem SAMPLE.ASM, jednoduçe nap¡çeme

   B>A:MASM SAMPLE
   pro IBM Macro Assembler, nebo
   B>A:MASM SAMPLE
   pro Microsoft Assembler, nebo
   B>A:TASMB SAMPLE
   pro Turbo Editasm Assembler.


   V  pý¡padØ  Turbo  Editasm (na disketØ pod n zvem TASMB.EXE) zvol¡me F7,
abychom  dostali   soubor  .OBJ.  Stiskneme  "A"  a  zaŸneme  tak  pýeklad.
Implicitn¡ jm‚no relokatibiln¡ho programu bude SAMPLE.OBJ.

   Vçechny týi zm¡nØn‚ assemblery  nevy§aduj¡  pýi  zad n¡ jm‚na souboru se
zdrojovìm programem extenzi .ASM -  ta  se  pýedpokl d   implicite. éspØçnì
pýeklad vytvoý¡ soubor SAMPLE.OBJ a um¡st¡  jej  na disketu v jednotce B. I
kdy§ SAMPLE.OBJ obsahuje  vçechny  instrukce v jejich strojov‚m tvaru, nen¡
to  jeçtØ  program,  kterì m…§eme prov dØt pod  operaŸn¡m  syst‚mem.  Pr vØ



                                  - 40 - 




SAMPLE.OBJ  je  vstupn¡m  programem  do  posledn¡ f ze pýi  programov n¡  v
assembleru.

   KROK 3: spojov n¡

   V tomto okam§iku je nutno  pou§¡t spojovac¡ program (linker) LINK, kterì
transformuje  program SAMPLE.OBJ  do  provediteln‚ho  programu  SAMPLE.EXE.
PodrobnØ  je tento proces popisov n v  pý¡sluçn‚m  manu lu  ke  konkr‚tn¡mu
firemn¡mu assembleru.  Zde  si  uk §eme,  jak  jednoduçe  vytvoý¡me program
SAMPLE.EXE.

   Pýedpokl dejme  opØt  program  SAMPLE.OBJ  na  disketØ  v   jednotce  B,
spojovac¡ program  LINK v jednotce A. Abychom vytvoýili program SAMPLE.EXE,
provedeme n sleduj¡c¡ akci:

   B>A:LINK SAMPLE


   Po £spØçn‚m ukonŸen¡ Ÿinnosti spojovac¡ho programu budeme m¡t na disketØ
v jednotce B program SAMPLE.EXE. M…§eme vyzkouçet jeho Ÿinnost

   B>SAMPLE


   Po  vyps n¡  textu  na  obrazovku  program   automaticky   vr t¡  ý¡zen¡
operaŸn¡mu syst‚mu DOS, kterì se ohl s¡ vìzvou B> .

































                                  - 41 - 































































                                  - 42 - 










                            K a p i t o l a   6

               ARCHITEKTURA : REGISTRY, PüÖZNAKY A INSTRUKCE



---------------------------------------------------------------------------
Mikroprocesor 80286
---------------------------------------------------------------------------


   Mikroprocesor 80286 m  mnoho vyspØlìch rys… navr§enìch k dosa§en¡ vysok‚
vìkonnosti   a   vych zej¡c¡ch   vstý¡c   potýeb m   multiu§ivatelskìch   a
multiprogramovìch  aplikac¡.  Mikroprocesor  80286  m   vestavØnou  ochranu
pamØti pro operaŸn¡ syst‚m  a  podporuje  vìluŸnost  pý¡stupu u§ivatelskìch
program… k jejich dat…m. Pýi kmitoŸtu taktovac¡ch puls… 10 MHz  prov d¡ Ÿip
80286 programy a§ 6x  rychleji  ne§ obvod 8086 pýi taktovac¡ frekvenci 4.77
MHz.

   ¬ip 80286 poskytuje kompatibilitu s programovìm vybaven¡m pro 8088/8086.
V  m¢du re lnìch adres (re lnì m¢d) je  80286  kompatibiln¡  s  existuj¡c¡m
relokatibiln¡m k¢dem pro 8088/8086.  Ve  virtu ln¡m  adresov‚m  m¢du (tak‚:
privilegovanì m¢d, chr nØnì m¢d) je  80286  kompatibiln¡  s relokatibiln¡mi
programy  8088/8086  na  £rovni  zdrojovìch  program…,  ale   program  m…§e
vy§adovat  jist‚  £pravy,  aby  mohl  vyu§¡vat  vçechny  vìhody virtu ln¡ho
adresov‚ho prostoru podporovan‚ho obvodem 80286.



---------------------------------------------------------------------------
Z kladn¡ architektura
---------------------------------------------------------------------------


   Obvod 80286 obsahuje osm 16-bitovìch  vçeobecnìch registr… - AX, BX, CX,
DX, SP, BP, SI a DI. Registry AX, BX, CX a DX mohou bìt pou§ity  jako £pln‚
16-bitov‚  registry,  nebo  m…§e  bìt  ka§dì  z  registr… rozdØlen  na  dva
osmibitov‚ registry,  co§  poskytuje  mo§nost  pou§¡vat  a§  8 osmibitovìch
registr…. Jm‚na registr…  zakonŸen   p¡smenem "X" (napý. BX) oznaŸuj¡ £pln‚
registry.  Osmibitov‚  poloviny  jsou oznaŸeny p¡smenem "L"  resp.  "H"  za
jm‚nem registru (tedy AL resp. AH oznaŸuj¡ doln¡,  resp.  horn¡ osmibitovou
polovinu çestn ctibitov‚ho registru AX).

   æestn ctibitov‚ registry SP (Stack  Pointer)  a  BP (Base Pointer) tvoý¡
registrovì p r, kterì je vyu§¡v n pro manipulaci se  z sobn¡kem  a obsahuje
offset vzhledem k aktu ln¡mu z sobn¡ku.  Registrovì p r SI (Source Index) a
DI (Destination Index)  je  oznaŸov n jako indexov‚ registry. Tyto registry
jsou u§¡v ny jako hodnoty  index…,  je§ mohou bìt zvyçov ny a sni§ov ny pýi
proch zen¡ komplexnØjç¡mi datovìmi strukturami.




                                  - 43 - 




---------------------------------------------------------------------------
Segmentov‚ registry
---------------------------------------------------------------------------


   ¬ip  80286 podporuje Ÿtyýi souŸasnØ pý¡stupn‚  moduly  v  hlavn¡  pamØti
nazìvan‚ segmenty. Tyto Ÿtyýi  segmenty  mohou  bìt  adresov ny 16-bitovìmi
registry CS, DS, SS a ES .
   K¢d  pr vØ  vykon van‚ho  programu  pý¡tomn‚ho  v  operaŸn¡   pamØti  je
adresov n registrem CS (Code Segment). B ze (b zov  adresa, adresa poŸ tku)
pr vØ  aktivn¡ho  datov‚ho  segmentu  je  adresov na  registrem   DS  (Data
Segment). Z sobn¡ky pou§¡van‚ k ulo§en¡ mezivìsledk… a k vol n¡ podprogram…
maj¡ tak‚ sv…j vlastn¡ segment SS (Stack Segment).  Program tor  m…§e nav¡c
pýistupovat k druh‚mu  aktivn¡mu  datov‚mu  segmentu  nazìvan‚mu  ES (Extra
Segment), kterì je referov n pýes registr ES.

   Adresace  elementu  uvnitý vybran‚ho segmentu  je  zabezpeŸena  vybr n¡m
aktivn¡ho segmentu prostýednictv¡m jednoho ze 4 segmentovìch registr… - CS,
DS, SS nebo ES  a  specifikac¡ 16-bitov‚ho offsetu vzhledem k b zov‚ adrese
ulo§en‚ ve vybran‚m segmentov‚m registru. æestn ctibitov  adresa segmentu a
16-bitovì offset (posunut¡ vzhledem k poŸ tku segmentu = adrese v patýiŸn‚m
segmentov‚m   registru)  vytv ýej¡  vyçç¡  a  ni§ç¡  polovinu   32-bitov‚ho
virtu ln¡ho adresov‚ho  ukazatele  do  pamØti.  Jakmile  je  jednou segment
vybr n, staŸ¡ jen specifikovat offset (ni§ç¡ch 16 bit…) v instrukci. Adresy
segment… jsou interpretov ny r…znØ  v  z vislosti na m¢du, v nØm§ Ÿip 80286
pracuje. V re ln‚m m¢du segmentov‚  registry  obsahuj¡  fyzick‚  adresy. Ve
virtu ln¡m  (privilegovan‚m)  m¢du  obsahuj¡  segmentov‚ registry adresy do
virtu ln¡ pamØti a vy§aduj¡ translaci logick‚ virtu ln¡ adresy na adresu ve
fyzick‚ pamØti.



---------------------------------------------------------------------------
Indexov‚ a b zov‚ registry. Registry ukazatele
---------------------------------------------------------------------------


   Jak  jsme  ji§  uvedli,  fyzick   adresa  konkr‚tn¡ho   elementu  uvnitý
vybran‚ho segmentu se z¡sk  kombinac¡  adresy  segmentu  a  offsetu. Offset
m…§e  bìt  um¡stØn  v  libovoln‚m  z  registr…  b zovìch  (base  register),
indexovìch (index register) nebo v registru ukazatele (pointer register).

   Operace  nad z sobn¡kem jsou umo§nØny selektorem z sobn¡kov‚ho  segmentu
(stack segment selector)  SS  a  registry  SP (Stack Pointer) nebo BP (Base
Pointer).  Offsety vzhledem k registr…m DS a ES  jsou  z¡sk ny  z  b zov‚ho
registru  BX,  komplikovanØjç¡  manipulace  s  daty  mohou   bìt  provedeny
pou§¡v n¡m registr… SI (Source Index) a DI (Destination Index) ve spojen¡ s
pr vØ aktivn¡m datovìm segmentem.











                                  - 44 - 




---------------------------------------------------------------------------
ü¡dic¡ registry a registry stavu (FLAGS)
---------------------------------------------------------------------------


   ¬ip 80286 obsahuje registr  FLAGS  s 11 pý¡znaky. æest z tØchto pý¡znak…
nazìvaj¡c¡ch se pý¡znaky stavu  je  nastavov no  aritmetickìmi  a logickìmi
operacemi  a  pro  tyto  operace  poskytuje logick‚ ý¡dic¡  podm¡nky.  Tyto
registry jsou oznaŸeny jako pý¡znak pýenosu CF (Carry Flag), pý¡znak parity
PF  (Parity Flag), pý¡znak pomocn‚ho pýenosu  AF  (Auxiliary  Carry  Flag),
pý¡znak znam‚nka SF (Sign Flag) a pý¡znak pýeteŸen¡ OF (Overflow Flag).

   -úpý¡znak pýenosu CF  je  nastaven  na  1, kdy§ je generov n pýenos nebo
vìp…jŸka pýi aritmetick‚ operaci s  8-bitovìmi  nebo  16-bitovìmi operandy.
Jinak je nastaven na 0. CF je u§¡v n tak‚ pýi instrukc¡ch rotac¡ a posun… a
obsahuje  pak  hodnotu  bitu  "vypad vaj¡c¡ho"  pýi  rotaci  nebo posunu  z
pý¡sluçn‚ho registru

   -úpý¡znak parity PF je nastavov n do 1 pýi generov n¡ lich‚ parity  a do
0 pýi generov n¡  parity  sud‚.  Je  pou§¡v n hlavnØ pro aplikace spojen‚ s
pýenosem dat.

   -úpý¡znak pý¡davn‚ho (pomocn‚ho) pýenosu AC je pou§¡v n v BCD aritmetice
k indikaci, zda  byla  vìp…jŸka  z  / pýenos do nejni§ç¡ Ÿtyýbitov‚ Ÿ¡slice
Ÿ¡sla reprezentovan‚ho v k¢du BCD

   -úpý¡znak nuly ZF indikuje nulovì vìsledek operace t¡m, §e se nastav¡ na
hodnotu 1

   -úpý¡znak znam‚nka SF je nastaven do 1 v pý¡padØ z porn‚ho vìsledku a do
0 v pý¡padØ vìsledku kladn‚ho.

   -úpý¡znak pýeteŸen¡ OF  indikuje  nastaven¡m do 1 skuteŸnost, §e operace
generovala  pýenos  do  nejvyçç¡ho bitu vìsledku ale  nikoliv  souŸasnØ  ze
nejvyçç¡ho bitu nebo pýenos z nejvyçç¡ho bitu vìsledku  ale  nikoliv pýenos
do tohoto nevyçç¡ho bitu (nonekvivalence).

   Týi  z  11  pý¡znak…  -  TF, IF a DF - se pou§¡vaj¡ k  ý¡zen¡  nØkterìch
operac¡  procesoru.  Pý¡znak  TF  (Trap  Flag) pýi sv‚m  nastaven¡  pýep¡n 
procesor do krokov‚ho re§imu a umo§åuje odladØn¡ programu. Pý¡znak povolen¡
pýeruçen¡  IE  (Interrupt  Enable) umo§åuje pýi sv‚  hodnotØ  1  akceptovat
extern¡  pýeruçen¡  a  pýi hodnotØ 0 je nebere v £vahu.  SmØr  postupu  pýi
ýetØzcovìch operac¡ch urŸuje pý¡znak  DF  (Direction Flag). Pýi DF = 0 jsou
registry SI a  DE  automaticky  inkrementov ny,  pýi  DF  =  1 jsou SI a DF
automaticky dekrementov ny pýi proch zen¡ polem (ýetØzcem).

   Pý¡znaky IOPLF a  NTF  jsou  dva  nov‚ pý¡znaky, je§ u pýedchoz¡ch Ÿlen…
rodiny INTEL neexistovaly a  u  80286  jsou  vyu§¡v ny jen v privilegovan‚m
m¢du.  Dvoubitovì IOPLF (Input/Output Privilege Level  Flag)  je  pou§it  k
tomu, aby instrukce vykonala jen ty operace, kter‚ m  povoleny. Pý¡znak NTF
(Nested  Task  Flag)  je  pou§it  k indikaci vnoýen¡ pr vØ prov dØn‚  £lohy
(task)  do  jin‚  £lohy (pýi multiprogramov‚m provozu). Pýi NT = 1 m  pr vØ
prov dØnì proces platn‚ spojen¡ (vazbu) s  pýedchoz¡m  programem (procesem,
£lohou).





                                  - 45 - 




---------------------------------------------------------------------------
Registr adresy instrukce (instruction pointer)
---------------------------------------------------------------------------


   Registr adresy instrukce IP (Instruction Pointer) obsahuje offset adresy
pý¡çt¡ vykon van‚ instrukce (v…Ÿi CS) uvnitý pr vØ aktivn¡ho segmentu CODE.
Umo§åuje tak vytvoýen¡ £pln‚ 32-bitov‚ adresy pý¡çt¡ instrukce programu.



---------------------------------------------------------------------------
Stavov‚ slovo procesoru (machine status word )
---------------------------------------------------------------------------


   Prvn¡ch pØt bit…  16-bitov‚ho  stavov‚ho  slova  procesoru  MSW (Machine
Status Word) obsahuje bit PE (Protection Enable)-nultì bit, bit MP (Monitor
CoProcessor)-prvn¡ bit, bit  EM  (EMulate  Coprocessor)-druhì  bit,  bit TS
(Task Switched)-týet¡ bit a ET (Processor Extension Type)-bit Ÿtvrtì.

 -úPE je pou§it k aktivaci privilegovan‚ho  m¢du  Ÿipu 80286. Je-li PE = 0,
pracuje procesor v re ln‚m m¢du. Pýi PE = 1 je aktivov n privilegovanì m¢d.
 -úMP  je  pou§it  spolu  s  bitem  TS  ke zjiçtØn¡, zda operace WAIT  bude
generovat chybovì stav "koprocesor nen¡ pý¡tomen" pýi TS = 1.
 -úEM  pýi  nastaven¡  do 1 zp…sob¡,  §e  vçechny  k¢dy  koprocesoru  budou
vyvol vat chybovì stav "koprocesor nen¡ pý¡tomen". Pýi EM = 0 budou vçechny
operaŸn¡ k¢dy koprocesoru skuteŸnØ realizov ny koprocesorem 80287/80387.
 -úTS je nastaven do 1  automaticky, kdykoliv je provedena operace pýepnut¡
£lohy  (programu)   (task  switching).  Pýi  TSú  =ú1  budou  vçechny  k¢dy
koprocesoru vyvol vat trap "koprocesor nen¡ pý¡tomen".



---------------------------------------------------------------------------
Mikroprocesor 80386
---------------------------------------------------------------------------


   ¬ip 80386  je  32-bitovì  mikroprocesor  navr§enì  k  podpoýe operaŸn¡ch
syst‚m… optimalizovanìch pro  re§im  pr ce  v¡ce  £loh  (multitasking). ¬ip
80386 m  32-bitov‚ registry a datov‚  cesty  a  je tedy s to podporovat 32-
bitov‚ adresn¡ m¢dy. 80386 je schopen adresovat a§ 4 GB fyzick‚ pamØti a 64
TB  (terrabyte  !)  pamØti  virtu ln¡.  Integrovan   architektura  spr vy a
ochrany  pamØti  v  sobØ zahrnuje registry pro  translaci  adres,  ochrannì
mechanismus pro podporu  operaŸn¡ch  syst‚m… a vyspØlì hardware pro podporu
re§imu pr ce v¡ce £loh.

   üetØzen‚ zpracov n¡ instrukc¡ (pipelining), velk  ç¡ýka sbØrnice a pý¡m 
translace adres na Ÿipu  80386  vìraznØ  zkracuj¡ pr…mØrnou dobu vykon v n¡
instrukce  a  implikuj¡  tak  vysokou   pr…chodnost   syst‚mu.   Tento  rys
architektury 80386 se projevuje v  jeho rychlosti : 80386 pracuje rychlost¡
3 - 4 mili¢ny instrukc¡ za sekundu (pýi frekvenci  taktovac¡ch  impuls…  16
MHz).





                                  - 46 - 




   Dalç¡mi rysy 80386 je pý¡mì  pý¡stup k rychl‚ vyrovn vac¡ pamØti (cache)
pro translaci str nek, self-test  a  4  nov‚ trasovac¡ registry (breakpoint
registers). ¬ip 80386 je kompatibiln¡ na £rovni relokatibiln¡ho k¢du s Ÿipy
8088/8086/80286.



---------------------------------------------------------------------------
Datov‚ typy 80386
---------------------------------------------------------------------------


   ¬ip 80386 podporuje nØkolik dalç¡ch datovìch  typ….  Podporuje pýedevç¡m
32-bitov  cel   Ÿ¡sla integer s/bez znam‚nka (signed and unsigned integers)
a pole bit…  v  d‚lce  1  a§  32  bit….  ¬ip tak‚ podporuje standardn¡ typy
ukazatel… jako 8086/80286 a pýid v  k nim ukazatel offsetu (32 bit…)  a 48-
bitovì £plnì ukazatel.



---------------------------------------------------------------------------
Adresov n¡ operand… u 80386
---------------------------------------------------------------------------


   KromØ 8-bitovìch a 16-bitovìch  bezprostýedn¡ch  operand…  podporuje Ÿip
80386 tak‚ operandy o d‚lce  32  bit…  s  t¡m,  §e  pole  pro bezprostýedn¡
operand je rozç¡ýeno z 16 na 32 bit…. Je-li specifikov n 32-bitovì operand,
instrukce  RET  a  ENTER pracuj¡ s 16-bitovìm  bezprostýedn¡m  operandem  s
nulami doplnØnìmi do d‚lky 32 bit….



---------------------------------------------------------------------------
VìpoŸet efektivn¡ adresy u 80386
---------------------------------------------------------------------------


   Pýi pý¡stupu k segmentu delç¡mu ne§ 64 kB m…§e bìt efektivn¡  adresa jak
32-bitov , tak i  16-bitov .  Efektivn¡ adresa je vytvoýena seŸten¡m obsah…
(pý¡padnØ pou§it‚ho) b zov‚ho registru  a  (pý¡padnØ  pou§it‚ho) indexov‚ho
registru a  (tak‚ pý¡padn‚ho) pýem¡stØn¡. KromØ toho byly 32-bitov‚ adresn¡
m¢dy rozç¡ýeny tak, aby umo§nily pou§it¡  libovoln‚ho  vçeobecn‚ho registru
jako b zov‚ho Ÿi indexov‚ho.



---------------------------------------------------------------------------
Prov dØn¡ k¢du mikroprocesoru 8086 na 80386
---------------------------------------------------------------------------


   ¬ip 80386 m  2 m¢dy Ÿinnosti : re lnì  a  privilegovanì.  Re lnì  m¢d je
stejnì jako u 80286  a  je m¢dem nastavenìm po RESETu mikroprocesoru 80386.
Virtu ln¡    m¢d    napodobuj¡c¡    mikroprocesor   8086   je   podmno§inou
privilegovan‚ho  m¢du  Ÿipu   80386   a   umo§åuje,   aby   instrukŸn¡  k¢d



                                  - 47 - 




mikroprocesoru 8086 mohl bìt prov dØn  v  r mci  privilegovan‚ho  m¢du Ÿipu
80386 pýi str nkovan‚m re§imu pr ce procesoru.



---------------------------------------------------------------------------
Z kladn¡ architektura Ÿipu 80386
---------------------------------------------------------------------------


   Mikroprocesor  80386 poskytuje program torovi 32 registr…. Registry  lze
rozdØlit do sedmi hlavn¡ch kategori¡:

   - vçeobecn‚ registry
   - segmentov‚ registry
   - registry adresy instrukce a pý¡znaky
   - ý¡dic¡ registry
   - registry syst‚movìch adres
   - ladic¡ a testovac¡ registry

   Uveden‚  registry  jsou  nadmno§inou  registr…  obvod…  8086   a  80286;
mikroprocesor 80386 tedy obsahuje vçechny registry Ÿip… 8086 a 80286.



---------------------------------------------------------------------------
Soubor vçeobecnìch registr…
---------------------------------------------------------------------------


   Osm  vçeobecnìch  registr…   Ÿipu   80386  m   podobn‚  pou§it¡  jako  8
vçeobecnìch registr…  u  80286  s  t¡m,  §e  jsou çirok‚ 32 bit…. Vçeobecn‚
registry jsou s to podpoýit operandy dlouh‚ 1,  8,  16  a  32 bit… a bitov 
pole  d‚lky  1  a§ 32 bit…. Tyto registry jsou oznaŸeny jako EAX (stýadaŸ),
EBX (b zovì registr), ECX  (Ÿ¡taŸ),  ESP  (ukazatel z sobn¡ku), EDX (datovì
registr),  EBP  (ukazatel  b ze),  ESI  (zdrojovì indexovì registr)  a  EDI
(c¡lovì indexovì registr).

   Abychom  z¡skali  pý¡stup  ke  vçem  32-bitovìm  registr…m,  je týeba  v
referenci na nØ pou§¡t prefixu "E". Ka§dì z 8 vçeobecnìch registr… m…§e bìt
rozdØlen do 16-bitovìch ekvivalent… Ÿip… 8086/80286 - staŸ¡ vypustit prefix
"E" v odkazu na registr.



---------------------------------------------------------------------------
Segmentov‚ registry
---------------------------------------------------------------------------


   ¬ip 80386 obsahuje  çest  16-bitovìch  segmentovìch  registr….  TØchto 6
registr…  uchov v   hodnoty   selektor…  ukazuj¡c¡ch  na  pr vØ  adresovan 
pamØœov  m¡sta. V  re ln‚m  adresov‚m  m¢du  m…§e m¡t segment velikost od 1
byte po maximum 64 kB. V privilegovan‚m m¢du je mo§n‚ pracovat  se segmenty
o velikosti 1 byte a§ 4 GB.




                                  - 48 - 




   Soubor 6-ti 16-bitovìch registr… obsahuje registry CS (Code Segment), DS
(Data Segment), SS (Stack Segment), ES (Extra Segment) a registry FS  a GS.
Registry GS a FS jsou pýid ny  proto,  aby byla zm¡rnØna "z cpa" v registru
ES  a  aby byly l‚pe z¡sk ny hodnoty  indexov‚ho  a  b zov‚ho  registru  ze
souboru vçeobecnìch registr….



---------------------------------------------------------------------------
Registr adresy instrukce a EFLAGS
---------------------------------------------------------------------------


   ¬ip 80386 obsahuje 32-bitovì registr adresy instrukce oznaŸenì jako EIP.
Registr EIP uchov v   hodnotu  offsetu  pý¡çt¡  prov dØn‚  instrukce. Tento
offset  je  v§dy  relativn¡  vzhledem  k b zi pr vØ aktivn¡ho segmentu  CS.
Ni§ç¡ch 16 bit… registru EIP lze referovat samostatnØ a  oznaŸuj¡  se  jako
registr IP. Tyto bity jsou u§¡v ny pýi 16- bitov‚ adresaci.

   Registr EFLAGS m  u Ÿipu 80386 d‚lku 32 bit…. Registr EFLAGS je pou§it k
ý¡zen¡ jistìch operac¡ a  indikuje  stav Ÿipu 80386. EFLAGS obsahuje 2 nov‚
pý¡znaky  (ve  srovn n¡  s 80286): VM (Virtual 8086 Mode flag) a pý¡znak RF
(Resume Flag). EFLAGS obsahuje stejn‚ ý¡dic¡ a logick‚ pý¡znakov‚ bity jako
Ÿipy 8086/80286.

   Pý¡znak VM povoluje  virtu ln¡  m¢d  Ÿipu  8086.  Pýi VM = 1 a nastaven¡
80386 do privilegovan‚ho m¢du bude  Ÿip 80386 "pýepnut" do virtu ln¡ho m¢du
8086 a vçechny operace  se  segmentem  budou  prov dØny jakoby prob¡haly na
Ÿipu 8086. Pýi t‚to emulaci Ÿipu 8086 bude obvod  80386  generovat  vìpadky
(faults) pýi privilegovanìch operaŸn¡ch k¢dech.

   Pý¡znak  RF  je  vyu§it  spolu  s  ladic¡m  registrem k  nastaven¡  bod…
zastaven¡ nebo k nastaven¡  "krokov n¡"  procesoru. Pýi RF = 1 jsou vçechny
vìpadky u pý¡çt¡ vykon van‚ instrukce  ignorov ny.  RF  je  pak automaticky
nastavov n na 0 pýi £spØçn‚m dokonŸen¡ ka§d‚ instrukce.



---------------------------------------------------------------------------
ü¡dic¡ registry
---------------------------------------------------------------------------


   Obvod 80386 obsahuje 4 32-bitov‚ registry : CR0, CR1, CR2  a  CR2 . Tyto
registry  obsahuj¡  informace  o  stavu  procesoru.  Pý¡stup  ke kontroln¡m
registr…m je umo§nØn instrukcemi typu load a store.

   Registr CR0 obsahuje 6  pýeddefinovanìch  pý¡znak…  urŸenìch  pro ý¡zen¡
mikroprocesoru a pro zjiçœov n¡ jeho stavu.  Bity  0 - 15 registru CR0 jsou
oznaŸov ny tak‚ jako stavov‚ slovo  procesoru  MSW  (Machine  Status Word),
vytv ýej¡ce tak  kompatibilitu 80386 s 80286 v privilegovan‚m m¢du. Pý¡kazy
LMSW a  SMSW  pracuj¡  stejnØ  u 80386 i 80286. Pýi pý¡stupu k registru CR0
mus¡ program tor pou§¡t pý¡kazu MOV CR0,registr.






                                  - 49 - 




   Bity ET, TS, EM, MP a PE maj¡ stejnì vìznam jako  u  Ÿipu  80286. ü¡dic¡
registr CR1 je vyhra§en  pro  pý¡çt¡ aplikace firmy INTEL. CR2 obsahuje 32-
bitovou line rn¡ adresu pamØti, kter  zp…sobila posledn¡ detekovanì vìpadek
str nky. CR3 obsahuje fyzickou adresu b ze tabulky str nek. Proto§e tabulka
str nek je u 80386 v§dy sv z na po jednotlivìch str nk ch, je nejni§ç¡ch 12
bit… registru CR3 pýi z pisu ignorov no.



---------------------------------------------------------------------------
Registry syst‚movìch adres
---------------------------------------------------------------------------


   Mikroprocesor 80386  obsahuje 4 speci ln¡ registry, kter‚ jsou pou§ity k
odkaz…m  na  tabulky  nebo   segmenty   podporovan‚   privilegovanìm  m¢dem
80286/80386. Tabulka GDT (Global Descriptor Table),  LDT  (Local Descriptor
Table)  a  TST  (Task Segment Table)  maj¡  sv‚  adresy  ulo§eny  v  tØchto
speci ln¡ch  registrech. Registry syst‚movìch adres a syst‚movìch  segment…
jsou oznaŸeny GPTR, IDTR, LDTR a TR.

   Registry  GPTR  a  IDTR jsou 32-bitov‚ registry,  kter‚  uchov vaj¡  32-
bitovou hodnotu line rn¡ adresy b ze  a 16- bitovì limit tabulky glob ln¡ch
(GTR) a lok ln¡ch (LTR)  deskriptor….  LDTR  a  TR jsou 16-bitov‚ registry,
kter‚ uchov vaj¡ 16-bitovì selektor pro segmenty LDT a TST.



---------------------------------------------------------------------------
Ladic¡ a trasovac¡ registry
---------------------------------------------------------------------------


   Mikroprocesor  80386 umo§åuje program torovi pý¡stup k çesti  32-bitovìm
ladic¡m registr…m -  DR0, DR1, DR2, DR3 DR6, DR7 . DR4 a DR5 jsou vyhrazeny
pro firmu INTEL. Registr pro ý¡zen¡  ladØn¡  DR6 je pou§it k nastaven¡ bod…
zastaven¡ (breakpoints). DR7 zobrazuje aktu ln¡ stav v bodech zastaven¡.

   ¬ip 80386 obsahuje tak‚ dva  32-bitov‚  testovac¡  registry,  kter‚ jsou
pou§ity  k  ý¡zen¡  testov n¡  RAM  a  CAM  (Content Addressable  Memory  -
asociativn¡ pamØœ) v bloku pýedvìbØru instrukc¡. TR6 je pou§it jako registr
testu  pý¡kaz…  a  TR7 jako datovì  registr  uchov vaj¡c¡  data  v  bufferu
pýedvìbØru instrukc¡.



---------------------------------------------------------------------------
Zpracov n¡ vìjimeŸnìch stav… u 80286/80386
---------------------------------------------------------------------------


   VìjimeŸnì  stav  (vìjimka,  exception)  je  vnitýn¡  ud lost¡,   je§  je
detekov na hardwarem bØhem  prov dØn¡ instrukce. Vìjimka zp…sob¡ generov n¡
pýeruçen¡   a  proveden¡  odpov¡daj¡c¡ho  programu  zpracov vaj¡c¡ho   toto
pýeruçen¡. Jako synonyma pro vìjimku (exception) se u§¡v   pojm…  trap nebo
fault  (srv.  [2]).  Zde  se  soustýed¡me  jen  na problematiku  vìjimek  u



                                  - 50 - 




procesoru  80286,  i  kdy§  vìjimky  generovan‚  procesorem  80386  jsou  v
n sleduj¡c¡ kapitole u vçech instrukc¡ rovnØ§ uvedeny.

   V privilegovan‚m m¢du procesoru  80286  jsou  vçechny reference na pamØœ
provØýov ny vzhledem  k opr vnØnosti adresace pamØœov‚ho m¡sta a ke zp…sobu
pý¡stupu k tomuto m¡stu.  Poruçen¡  pravidel  ochrany pamØti vestavØnìch do
procesoru 80286 zp…sob¡  pýed n¡  ý¡zen¡  programu  pro  obsluhu pýeruçen¡.
Pýeruçen¡ generovan  vìjimkami maj¡ stanoven‚  pozice  v  tabulce pýeruçen¡
(IDT, Interrupt Descriptor Table) a shrnuje je n sleduj¡c¡ tabulka.

               Tab. 6.1: Vìjimky v privilegovan‚m m¢du 80286

       -------------------------------------------------------------
       Zkratka ¬¡slo pýeruçen¡ (v IDT) Popis
       -------------------------------------------------------------
       #UD               6        Nedefinovanì operaŸn¡ k¢d
       #NM               7        Nen¡ k dispozici matematick 
                                  jednotka
       #DF               8        Dvojit  vìjimka/vìpadek
       #MP               9        Chyba ochrany matematick‚
                                  jednotky
       #TS               10       Neplatnì segment stavu £lohy
       #NP               11       Nepý¡tomen/nen¡ k dispozici
       #SS               12       Chyba z sobn¡ku
       #GP               13       Vçeobecn  vìjimka poruçen¡
                                  ochrany pamØti = vçeobecn 
                                  vìjimka privilegovan‚ho m¢du
       #MF               16       Matematick  chyba
       -------------------------------------------------------------


   V  re ln‚m  m¢du  procesoru  80286  je  v  pr…bØhu zpracov n¡  instrukc¡
prov dØno mnohem m‚nØ kontrol a  je tedy generov no podstatnØ m‚nØ vìjimek.
Jedna  z  Ÿasto  se  vyskytuj¡c¡ch  vìjimek je vçeobecn   vìjimka  poruçen¡
ochrany  pamØti;  d le  se Ÿasto vyskytuje vìjimka/pýeruçen¡ INT 13, je§ je
generov na  v§dy,  kdy§  je referov n slovn¡ operand  na  adrese  (offsetu)
OFFFFH v nØkter‚m segmentu (druhì byte by toti§ mØl vzhledem k referovan‚mu
registru offset 10000H,  co§  pýesahuje  adresovac¡  kapacitu  segmentu (64
Kbyte).

   V popisu ka§d‚ instrukce v  n sleduj¡c¡  kapitole  jsou  uvedeny vçechny
vìjimky,  kter‚  mohou  bìt  v  pr…bØhu jej¡ho vykon v n¡ generov ny jak  v
re ln‚m, tak i v privilegovan‚m m¢du.
















                                  - 51 - 































































                                  - 52 - 










                            K a p i t o l a   7

               InstrukŸn¡ soubor mikroprocesor… 80286/80386


   Pro struŸnost budeme re lnì m¢d oznaŸovat RM a privilegovanì m¢d PM

AAA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     AAA - nastav ASCII po sŸ¡t n¡ v AL

¬asov n¡:                      3 (80286), 4(80386)

Popis:                         Instrukce AAA by nØla  bìt  vykon na  jen po
                               instrukci  ADD, kter  ponech v  v AL  bytovì
                               vìsledek.   AAA   konvertuje   obsah  AL  na
                               nesbalenou  dekadickou  Ÿ¡slici.  AAA zkoum 
                               ni§ç¡  4  bity  registru  AL a hled  validn¡
                               Ÿ¡slo v k¢du BCD v  rozsahu  0  a§  9. ¬tyýi
                               vyçç¡   bity  AL  pýitom  nastavuje  do   0.
                               Jestli§e   doçlo   k   dekadick‚mu  pýenosu,
                               pý¡znaky  AF  a  AC  jsou  nastaveny  na  0.
                               Jestli§e hodnota obsa§en   v  ni§ç¡m p…lbytu
                               je vØtç¡ nØ§ 9 nebo je AF nastaven do 1, pak
                               AAA prov d¡ n sleduj¡c¡ akce: AL  je zvØtçen
                               o 6, AH je  zvØtçen  o  1,  pý¡znaky AF a AC
                               jsou nastaveny do 1  a  vyçç¡  bity  AL jsou
                               vynulov ny.

Syntaxe:                       AAA (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            AF, CF

Nedefinovan‚ pý¡znaky:         OF, ZF, SF, PF

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       ADD AL,BL    ; SeŸti Ÿ¡sla BCD v AL a BL
                               AAA               ;   z¡skej    vìsledek   v
                               nesbalen‚m tvaru

AAD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     AAD - nastav ASCII AX pýed dØlen¡m



                                  - 53 - 




¬asov n¡:                      3 (80286), 4 (80386)

Popis:                         Instrukce  AAD  zpracov v   Ÿ¡slo  vyj dýen‚
                               jako  2  nesbalen‚  dekadick‚ Ÿ¡slice v k¢du
                               BCD (ni§ç¡ Ÿ¡slice je v AL, vyçç¡ je v AH) a
                               pýipravuje je k operaci dØlen¡,  kter‚ vrac¡
                               vìsledek v nesbalen‚m tvaru. AL  je nastaven
                               na  AL  +  (AH  x  10)  a  AH je  vynulov n.
                               Vìsledek  je  v  AX  a  je  roven  bin rn¡mu
                               ekvivalentu       p…vodn¡ho      nesbalen‚ho
                               dvoum¡stn‚ho Ÿ¡sla.

Syntaxe:                       AAD (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            SF, ZF, PF

Nedefinovan‚ pý¡znaky:         OF, AF, CF

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       AAD ; pou§ito pýed dØlen¡m

AAM (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     nastav ASCII AX po n soben¡

¬asov n¡:                      16 (80286), 17 (80386)

Popis:                         AAM  nastav¡  vìsledek  v  registru   AX  po
                               n soben¡ dvou nesbalenìch dekadickìch Ÿ¡sel.
                               Tato  instrukce by  mØla  bìt  provedena  po
                               instrukci MUL. Proto§e vìsledek je menç¡ ne§
                               100, je celì obsa§en  v  registru  AL  . AAM
                               rozv¡j¡  sbalenì tvar vìsledku v AL tak,  §e
                               dØl¡  AL deseti a ponech v  kvocient  (vyçç¡
                               Ÿ¡slici) v AL a zbytek (ni§ç¡ Ÿ¡slici) v AH.

Syntaxe:                       AAM (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            SF, ZF, PF


Nedefinovan‚ pý¡znaky:         OF, AF, CF

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       AAM ; pou§ito po n soben¡



                                  - 54 - 




AAS (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     nastav ASCII AL po odeŸ¡t n¡

¬asov n¡:                      3 (80286), 4 (80386)

Popis:                         éŸelem instrukce AAS je korigovat vìsledek v
                               registru  AL  po  odeŸ¡t n¡ dvou nesbalenìch
                               dekadickìch  operand….  Vìsledek  je  rovnØ§
                               ulo§en v nesbalen‚m  dekadick‚m  tvaru. Toho
                               je  dosa§eno  aplikac¡  n sleduj¡c¡ch krok…:
                               je-li ni§ç¡ p…lbyte v AL  vyçç¡  ne§  9 nebo
                               AF=1, pak se AL zvìç¡ o 6 a AH o 1. Pý¡znaky
                               CF a AF  jsou  nastaveny  na  1.  Jinak jsou
                               nulov ny  CF a AF. P…vodn¡ hodnota  registru
                               AL  je tedy  nahrazena  bytem,  jeho§  vyçç¡
                               polovina  je  nulov   a  ni§ç¡  polovina  je
                               Ÿ¡slem v rozsahu 0 - 9.

Syntaxe:                       AAS (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            AF, CF

Nedefinovan‚ pý¡znaky:         OF, SF, ZF a PF

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       AAS ; pou§ito po odeŸ¡t n¡

ADC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     seŸ¡t n¡ s pýenosem

¬asov n¡:                      2 - 7 (80286), 2 - 7 (80386)

Popis:                         SeŸ¡t  dva  operandy  s  pýenosem  - prov d¡
                               celoŸ¡seln‚ seŸ¡t n¡. Je-li nastaven pý¡znak
                               CF, je k souŸtu dvou operand…  pýiŸtena  1 a
                               vìsledek je vr cen na m¡sto urŸen¡.

Syntaxe:                       ADC destination,source

Ovlivåuje pý¡znaky:            OF, SF, ZF, AF, PF, CF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v RM:                  pro  slovn¡ operand  s  offsetem  0FFFFH  je
                               generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…



                                  - 55 - 




Pý¡klad:                       SeŸtØme bezprostýedn¡ operand s pýenosem  do
                               stýadaŸe:
                                  ADC  AL,4
                                  ADC  AX, 298
                                  ADC  EBX, 22334455H ; (jen pro 80386)

                               SeŸtØme bezprostýedn¡ operand s pýenosem  do
                               registru nebo na pamØœov‚ m¡sto:
                                  ADC  CX,341
                                  ADC  BL,10
                                  ADC  TABLE[SI],2
                                  ADC  MEMORY,6293
                                  ADC  NUMBER,12345678 (jen pro 80386)

                               SeŸtØme  data  s  pýenosem  z   registru  do
                               registru,  registru  do  pamØti,  pamØti  do
                               registru
                                  ADC  DL,BL
                                  ADC  MEM_WRD,AX
                                  ADC  SI,MEM_WRD

ADD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     seŸ¡t n¡

¬asov n¡:                      2-7 (80286), 2-7 (80386)

Popis:                         ADD prov d¡ seŸ¡t n¡ dvou operand…. Vìsledek
                               je ulo§en v c¡lov‚m operandu.


Syntaxe:                       ADD destination, source

Ovlivåuje pý¡znaky:            AF, CF, OF, PF, SF, ZF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je-li  vìsledek   v   segmentu  nepý¡stupn‚m
                               z pisu,  je  generov na   vçeobecn   vìjimka
                               poruçen¡  ochrany  pamØti.  Pro  nedovolenou
                               efektivn¡ adresu operandu  nach zej¡c¡  se v
                               registrech  CS, DS  nebo  ES  je  generov na
                               rovnØ§   vçeobecn    vìjimka.   Jestli§e  SS
                               obsahuje nedovolenou  adresu,  je generov na
                               vìjimeŸn  situace "chyba z sobn¡ku".

Vìjimky v RM:                  pro  slovn¡ operand  s  offsetem  0FFFFH  je
                               generov no pýeruçen¡ INT 13.


Pozn mka pro 80386:            ç¡ýka slova je 32 bit…


Pý¡klad:                       Z registru do registru:
                                  ADD  AX,BX



                                  - 56 - 




                                  ADD  EBX,ECX        (jen pro 80386)

                               Z registru do pamØti
                                  ADD  EXTMEM,AX

                               Z pamØti do registru
                                  ADD  DX,BUFF

                               Bezprostýedn¡ operand do stýadaŸe
                                  ADD  AL,4
                                  ADD  EAX,98765432H (jen pro 80386)

                               Bezprostýedn¡ operand do registru
                                  ADD  CX,1985

                               Bezprostýedn¡ operand do pamØti
                                  ADD  EXTMEM,23

AND (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     logickì souŸin dvou operand…

¬asov n¡:                      2-7 (80286), 2-7 (80386)

Popis:                         Vìsledek  obsahuje  jedniŸkovan‚  ty  bitov‚
                               pozice, kter‚ mØly hodnotu 1 u c¡lov‚ho  i u
                               zdrojov‚ho  operandu;   jinak   jsou  pozice
                               nulov ny. Pý¡znaky OF a CF jsou nastaveny do
                               0.

Syntaxe:                       AND destination, source

Ovlivåuje pý¡znaky:            OF = 0, CF = 0, PF, SF, ZF

Nedefinovan‚ pý¡znaky:         AF

Vìjimky v PM:                  Je-li  vìsledek   v   segmentu  nepý¡stupn‚m
                               z pisu,  je  generov na   vçeobecn   vìjimka
                               poruçen¡  ochrany  pamØti.  Pro  nedovolenou
                               efektivn¡ adresu operandu  nach zej¡c¡  se v
                               registrech  CS, DS  nebo  ES  je  generov na
                               rovnØ§   vçeobecn    vìjimka.   Jestli§e  SS
                               obsahuje nedovolenou  adresu,  je generov na
                               vìjimeŸn  situace "chyba z sobn¡ku".

Vìjimky v RM:                  pro  slovn¡ operand  s  offsetem  0FFFFH  je
                               generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       Bezprostýedn¡ operand do registru
                                  AND  BL,11001110B
                                  AND  EAX,11101011001100110001110000111001B
                                       (jen pro 80386)




                                  - 57 - 




                               Bezprostýedn¡ operand do pamØti
                                  AND  EXTMEM,10011100B
                                  AND  NUMBER,0F0F0F0F0H (jen pro 80386)

                               Bezprostýedn¡ operand do stýadaŸe
                                  AND  AX,1011100101011100B
                                  AND  AL,MASK_BYTE

                               Z registru do pamØti
                                  AND  EXTMEM,SI

                               Z registru do registru
                                  AND  AX,BX
                                  AND  EAX,ECX   (jen pro 80386)

                               Z pamØti do registru
                                  AND  DH,EXTBYTE

ARPL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav pole RPL selektoru

¬asov n¡:                      10-11 (80286), 20-21 (80386)

Popis:                         Instrukce  ARPL  je  navr§ena  k  tomu,  aby
                               zabr nila   syst‚movìm    program…m   z¡skat
                               pý¡stup  k  podprogram…m   s   vyçç¡  £rovn¡
                               priority.  Prvn¡  operand  instrukce ARPL je
                               16-bitov   pamØœov   promØnn   nebo  registr
                               d‚lky  slova,   kter (ì)   obsahuje  hodnotu
                               selektoru. Druhì operand je registr  o d‚lce
                               slova. Je-li pole  RPL  (Requested Privilege
                               Level)  1.  operandu  menç¡  ne§   pole  RPL
                               druh‚ho  operandu,  je  pý¡znak  nuly   (ZF)
                               nastaven do 1.  Pole RPL prvn¡ho operandu je
                               zvìçeno tak, aby se  shodovalo  s  polem RPL
                               druh‚ho operandu. Jinak  je ZF nastaven do 0
                               a prvn¡ operand instrukce ARPL nen¡ nikterak
                               modifikov n.

Syntaxe:                       ARPL (selektor, CS_selektor)

Ovlivåuje pý¡znaky:            ZF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je-li  vìsledek   v   segmentu  nepý¡stupn‚m
                               z pisu,  je  generov na   vçeobecn   vìjimka
                               poruçen¡  ochrany  pamØti.  Pro  nedovolenou
                               efektivn¡ adresu operandu  nach zej¡c¡  se v
                               registrech  CS, DS  nebo  ES  je  generov na
                               rovnØ§   vçeobecn    vìjimka.   Jestli§e  SS
                               obsahuje nedovolenou  adresu,  je generov na
                               vìjimeŸn  situace "chyba z sobn¡ku".




                                  - 58 - 




Vìjimky v RM:                  Je  generov no  pýeruçen¡ INT  6.  Instrukce
                               ARPL nen¡ v RM rozpozn na.

Pozn mka pro 80386:            -

Pý¡klad:                       ARPL MEM_WRD,BX

BOUND (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Konroluj index pole vzhledem k jeho hranic¡m

¬asov n¡:                      13 (80286), 10 (80386)

Popis:                         Operace BOUND je pou§¡v na k zajiçtØn¡ toho,
                               §e  index  pole  je  v  mez¡ch  definovanìch
                               dvouslovn¡m blokem v  pamØti.  Prvn¡ operand
                               (registr) mus¡ bìt vØtç¡ nebo  roven prvn¡mu
                               slovu v  pamØti,  a  menç¡  ne§  nebo  roven
                               druh‚mu  slovu  v  pamØti.  Nejsou-li   tyto
                               podm¡nky splnØny, generuje se INT 5.

Syntaxe:                       BOUND destination, source

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v RM:                  Jestli§e test na hranice pole neuspØje (t.j.
                               index prvku pole le§¡  mimo  meze  pole), je
                               generov no  pýeruçen¡  INT  5.  Je-li   danì
                               operand  na offsetu  0FFFDH  Ÿi  vyçç¡m,  je
                               generov no  pýeruçen¡  INT 13.  Je-li  druhì
                               operand registr, je generov no pýeruçen¡ INT
                               6.

Vìjimky v PM:                  Jestli§e  test na hranice pole neuspØje,  je
                               generov no  pýeruçen¡  INT  5. Pro neplatnou
                               efektivn¡ adresu operandu  v  registrech CS,
                               DS  a ES  je  generov na  vçeobecn   vìjimka
                               privilegovan‚ho m¢du. Pýi neplatn‚ adrese  v
                               SS je generov na vìjimka "chyba z sobn¡ku".

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                       BOUND AX,MEM_WRD
                               BOUND EBX,NEW_WORD ; (jen pro 80386)

CALL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vol n¡ procedury

¬asov n¡:                      7-185 (80286), 3-275 (80386)





                                  - 59 - 




Popis:                         Instrukce CALL zp…sobuje,  §e  adresa pý¡çt¡
                               vykon van‚ instrukce je uchov na v z sobn¡ku
                               a  ý¡zen¡  programu   je   pýed no  operandu
                               instrukce CALL. Po ukonŸen¡ volan‚ procedury
                               vykon v     volaj¡c¡    program    instrukce
                               n sleduj¡c¡ bezprostýednØ za instrukc¡ CALL.

Syntaxe:                       CALL operand
Ovlivåuje pý¡znaky:            § dn‚  (vìjimkou  je  pý¡padn‚ pýepnut¡ £loh
                               (task switching))

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  a)   vol n¡   "FAR   CALLS":  je  generov na
                               vçeobecn    vìjimka  privilegovan‚ho   m¢du,
                               vìjimka  "deskriptor   neexistuje",  vìjimka
                               "chyba   z sobn¡ku"   a   vìjimka  "neplatnì
                               segment stavu £lohy".

                               b) vol n¡ "NEAR direct CALLS": je generov na
                               vçeobecn   vìjimka  privilegovan‚ho  m¢du  v
                               pý¡padØ,  §e  procedura  je lokalizov na vnØ
                               segmentu CS

                               c)   vol n¡   "NEAR  indirect   CALLS":   je
                               generov na vçeobecn  vìjimka privilegovan‚ho
                               m¢du pýi neplatn‚ efektivn¡ adrese  operandu
                               v  segmentovìch registrech CS, DS nebo ES  a
                               nebo vìjimka "chyba z sobn¡ku" pýi  neplatn‚
                               adrese  v  segmentu  SS.  Vçeobecn   vìjimka
                               privilegovan‚ho  m¢du  je  generov na tak‚ v
                               pý¡padØ, §e je z¡sk n nepý¡mì  offset le§¡c¡
                               mimo hranice segmentu CS.

Vìjimky v RM:                  Je generov no pýeruçen¡ INT 13 v pý¡padØ, §e
                               slovn¡ operand m  offset 0FFFFH.

Pozn mka pro 80386:            Slovn¡ operand  m   ç¡ýku  32  bit…, operand
                               typu ukazatel m  ç¡ýku 48 bit….

Pý¡klad:                          CALL ADDER ; procedura je uvnitý nebo vnØ
                               segmentu

                               pro 80386:
                                  CALL IMMPTR  ;  Operand  typu ukazatel je
                               48-bitovì

                                  CALL DISP16 ;  U§¡v   32-bitovì rozç¡ýenì
                               ukazatel instrukce

                                  CALL registr nebo pamØœ
                                       ; posunut¡ je 32-bitov‚.
                                       ; Slovn¡ operandy jsou 32-bitov‚






                                  - 60 - 




CBW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Konvertuj byte na slovo

¬asov n¡:                      2 (80286), 3 (80386)

Popis:                         Operace  CBW  konvertuje byte  se  znam‚nkem
                               ulo§enì v registru  AL na slovo se znam‚nkem
                               v  registru  AX.  Konverze  je   zabezpeŸena
                               rozç¡ýen¡m  nejvìznamnØjç¡ho  bitu v  AL  na
                               vçechny   (zbìvaj¡c¡)   bity   AH.  Viz  t‚§
                               pozn mku pro 80386.

Syntaxe:                       CBW (nem  operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            Velikost   slova  je  32  bit….  Hodnota   s
                               rozç¡ýenìm  znam‚nkem  je  v AX, vìsledek je
                               ulo§en do EAX.

Pý¡klad:                       CBW

CLC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nuluj pý¡znak pýenosu (CF)

¬asov n¡:                      2

Popis:                         Operace CLC nastavuje pý¡znak pýenosu  do 0.
                               ¦ dn‚  jin‚  registry  ani  pý¡znaky  nejsou
                               ovlivnØny.

Syntaxe:                       CLC (nem  operandy)

Ovlivåuje pý¡znaky:            CF = 0

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       CLC





                                  - 61 - 




CLD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nuluj pý¡znak smØru (DF)

¬asov n¡:                      2

Popis:                         Nuluje pý¡znak DF, inkrementuje registry  SI
                               a  DI.  ¦ dn‚  jin‚  registry  ani  pý¡znaky
                               nejsou    ovlivnØny.    üetØzcov     operace
                               inkrementuje registry SI a DI automaticky po
                               proveden¡ instrukce CLD.

Syntaxe:                       CLD (nem  operandy)

Ovlivåuje pý¡znaky:            DF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       CLD

CLI (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nuluj pý¡znak pýeruçen¡ (IF)

¬asov n¡:                      3

Popis:                         Operace  CLI  nuluje pý¡znak  pýeruçen¡  IF.
                               ¦ dn‚   jin‚   pý¡znaky   nejsou  ovlivnØny.
                               Efektem proveden¡ operace CLI je  inaktivace
                               vìskytu   vçech    pýeruçen¡    s   vìjimkou
                               nemaskovatelnìch pýeruçen¡, kter‚ se projev¡
                               sign lem NMI.

Syntaxe:                       CLI (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            IF = 0

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je-li  aktu ln¡  privilegovan   £roveå vyçç¡
                               ne§ IOPL v registru pý¡znak…,  je generov na
                               vçeobecn  vìjimka privilegovan‚ho m¢du. IOPL
                               indikuje nejni§ç¡ privilegovanou  £roveå, na
                               kter‚ lze prov‚st vstup/vìstup.

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -



                                  - 62 - 




Pý¡klad:                       CLI

CLTS (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nuluj  pý¡znak  TS ("Pýepnuta  uloha",  task
                               switched)

¬asov n¡:                      2 (80286), 5 (80386)

Popis:                         Instrukce CLTS nuluje pý¡znak TS ve stavov‚m
                               slovØ MSW. CLTS je privilegovan   instrukce,
                               kter  m…§e bìt prov dØna jen na  £rovni  0 a
                               je  reservovan   pro syst‚mov‚  software  na
                               £rovni  operaŸn¡ho  syst‚mu.   CLTS  sleduje
                               ka§d‚ vykon n¡ WAITu nebo  ESC  a  v pý¡padØ
                               nastaven¡ pý¡znaku  MP  v  MSW  a souŸasn‚ho
                               nastaven¡ pý¡znaku TS vyvol  instrukce  CLTS
                               vìjimku.

Syntaxe:                       CLTS

Ovlivåuje pý¡znaky:            TS = 0

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je-li aktu ln¡  £roveå  privilegovan‚ho m¢du
                               jin  ne§ 0, je generov na  vçeobecn  vìjimka
                               privilegovan‚ho m¢du pýi pokusu o  proveden¡
                               CLTS.

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       CLTS

CMC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vytvoý doplnØk pý¡znaku pýenosu (CF)

¬asov n¡:                      2

Popis:                         Instrukce  CMC  invertuje   bitovou  hodnotu
                               pý¡znaku  pýenosu  CF.  Je-li  CF  =  1,  je
                               nastaven do  0; je-li CF = 0, je nastaven do
                               1.

Syntaxe:                       CMC

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚



                                  - 63 - 




Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       CMC

CMP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Porovnej dva operandy

¬asov n¡:                      2-7 (80286), 2-6 (80386)

Popis:                         Instrukce  CMP  odeŸte zdrojovì  operand  od
                               c¡lov‚ho a podle vznikl‚ho vìsledku  nastav¡
                               patýiŸn‚  pý¡znaky.  CMP   nemØn¡  operandy.
                               Zdrojovì  a  c¡lovì  operand  mus¡  bìt  oba
                               stejn‚ho  typu, s  vìjimkou  pou§it¡  CMP  v
                               bezprostýedn¡m   re§imu   -   zde  m…§e  bìt
                               bezprostýedn¡  operand  o velikosti  byte  s
                               rozç¡ýenìm znam‚nkovìm bitem  na  cel‚ slovo
                               porovn n se slovem v pamØti.

Syntaxe:                       CMP destination,source

Ovlivåuje pý¡znaky:            OF, SF, ZF, AF, PF, CF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e registr  CS,  DS  nebo  ES obsahuj¡
                               nepovolenou  efektivn¡  adresu  operandu, je
                               generov na vçeobecn  vìjimka privilegovan‚ho
                               m¢du. Jestli§e SS obsahuje neplatnou adresu,
                               je generov na vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Je-li  slovn¡  operand  um¡stØn  na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       Bezprostýedn¡ operand srovn n s pamØt¡:
                               CMP EXTMEM,5CAFH
                               Bezprostýedn¡ operand srovn n s registrem:
                               CMP BL,5
                               CMP EAX, 0FFFF0000H (pro 80386)
                               Bezprostýedn¡ operand srovn n se stýadaŸem:
                               CMP AL,7
                               Registr srovn n s registrem:
                               CMP AX,BX
                               CMP EDX,EAX (jen pro 80386)
                               Registr srovn n s pamØt¡:
                               CMP EXTMEM,DX
                               PamØœ srovn na s registrem:
                               CMP CH,EXTMEM
                               CMP EBX,VALUE (jen pro 80386)




                                  - 64 - 




CMPS/CMPSB/CMPSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Porovnej ýetØzcov‚ operandy

¬asov n¡:                      8 (80286), 10 (80386)

Popis:                         Instrukce    CMPS/SB/SW    srovn v     obsah
                               pamØœov‚ho   m¡sta  adresovan‚ho   registrem
                               SI(ESI)   s    obsahem    pamØœov‚ho   m¡sta
                               adresovan‚ho  registrem  DI(EDI).  Instrukce
                               CMPS   odeŸte    obsah    pamØœov‚ho   m¡sta
                               adresovan‚ho registrem DI(EDI) od pamØœov‚ho
                               m¡sta   adresovan‚ho    registrem   SI(ESI).
                               Vìsledkem je nastaven¡ pý¡znak…, avçak obsah
                               pamØœovìch m¡st nen¡ mØnØn. Registry SI(ESI)
                               a   DI(EDI)    jsou    inkrementov ny   nebo
                               dekrementov ny  podle  hodnoty  pý¡znaku DF.
                               Je-li pý¡znak DF nulov n (0), jsou SI(ESI) a
                               DI(EDI)  inkremetov ny,  pýi  hodnotØ DF = 1
                               jsou  tyto   registry   dekrementov ny.  Lze
                               specifikovat bytov‚ nebo slovn¡ porovn v n¡.
                               Inkrementace indexovìch  registr…  SI(ESI) a
                               DI(EDI) je o 1 pro bytov‚ operandy a o 2 pro
                               operandy slovn¡.


Pozn mka:                      Pravì  operand  instrukce  CMPS  je  operand
                               indexovanì  registrem DI a tento operand  je
                               adresov n  registrem  ES.   Tato  implicitn¡
                               specifikace nem…§e bìt zmØnØna.


Syntaxe:                       CMPS source_string,destination_string
                               CMPSB (§ dn‚ operandy)
                               CMPSW (§ dn‚ operandy)


Ovlivåuje pý¡znaky:            AF, CF, PF, OF, SF, ZF


Nedefinovan‚ pý¡znaky:         § dn‚


Vìjimky v PM:                  Jestli§e registr  CS,  DS  nebo  ES obsahuj¡
                               nepovolenou  efektivn¡  adresu  operandu, je
                               generov na vçeobecn  vìjimka privilegovan‚ho
                               m¢du. Jestli§e SS obsahuje neplatnou adresu,
                               je generov na vìjimka "chyba z sobn¡ku".


Vìjimky v RM:                  Je-li  slovn¡  operand  um¡stØn  na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka   operand…   je  32   bit….   Pou§ijte
                               instrukci CDQ.



                                  - 65 - 




Pý¡klad:                       MOV SI,OFFSET STRING1
                               MOV DI,OFFSET STRING2
                               CMPS STRING1,STRING2
                               CMPS DS:BYTE PTR[SI],ES:[DI]
                               LEA ESI,STRING1 (jen pro 80386)
                               LEA EDI,STRING2
                               CMPS STRING1,STRING2

CWD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Konvertuj slovo do dvouslova

¬asov n¡:                      2

Popis:                         Instrukce CWD konvertuje slovo se  znam‚nkem
                               um¡stØn‚  v  registru  AX  do  dvouslova  se
                               znam‚nkem  v  registrech DX:AX.  Operace  je
                               provedena  tak,  §e  bit  MSB registru AX je
                               rozç¡ýen   do   vçech   (zbìvaj¡c¡ch)  pozic
                               registru DX. Viz pozn mku pro 80386.

Syntaxe:                       CWD (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            æ¡ýka   slova  je  32  bit….  Hodnota   pýed
                               konverz¡ (s rozç¡ýenìm znam‚nkovìm bitem) je
                               ulo§ena v EAX, vìsledek konverze  je ukl d n
                               do registrov‚ho p ru EDX:EAX.

Pý¡klad:                       CWD

DAA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Dekadick‚ nastaven¡ po seŸ¡t n¡

¬asov n¡:                      3 (80286), 4 (80386)

Popis:                         Instrukce  DAA by mØla bìt pou§¡v na jen  po
                               seŸten¡  dvou  sbalenìch BCD  operand….  DAA
                               konvertuje  vìsledek  v   AL   do  sbalen‚ho
                               dekadick‚ho   tvaru    podle   n sleduj¡c¡ch
                               pravidel:

                               a) Je-li ni§ç¡ Ÿtveýice byt… v AL  vØtç¡ ne§
                               9 nebo je nastaven CF, je AL inkrementov n o
                               6 a nastaven AF; jinak je AF nulov n.




                                  - 66 - 




                               b)  Je-li   (n sledkem   pýedchoz¡  operace)
                               vìsledek vØtç¡ ne§ 9FH nebo je CF = 1, je AL
                               inkrementov n  o  60H a CF  je  nastaven  do
                               jedn‚; jinak je CF nulov n.

Syntaxe:                       DAA (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            AF, CF, SF, ZF, PF

Nedefinovan‚ pý¡znaky:         OF

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       MOV     AL,08
                               ADD     AL,03     ; Vìsledek v AL je OBH
                               DAA               ; Vìsledek v AL je 11H

DAS (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Dekadick‚ nastaven¡ po odeŸ¡t n¡

¬asov n¡:                      3 (80286), 4 (80386)

Popis:                         Instrukce DAS  by  mØla  bìt  u§ita  jen  po
                               odeŸ¡t n¡   dvou   sbalenìch    BCD   Ÿ¡sel.
                               Instrukce DAS vrac¡ nastavenì vìsledek  v AL
                               a postupuje podle n sleduj¡c¡ch pravidel:

                               a) Je-li ni§ç¡ Ÿtveýice byt… v AL  vØtç¡ ne§
                               9 nebo je nastaven AF, je AL dekrementov n o
                               6 a nastaven AF; jinak je AF nulov n.

                               b)  Je-li   (n sledkem   pýedchoz¡  operace)
                               vìsledek vØtç¡ ne§ 9FH nebo je CF = 1, je AL
                               dekrementov n  o  60H a CF  je  nastaven  do
                               jedn‚; jinak je CF nulov n.

Syntaxe:                       DAS (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            AF, CF, SF, PF, ZF

Nedefinovan‚ pý¡znaky:         OF

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                          MOV  AL,12
                                  SUB  AL,03     ; Vìsledek v AL je 0FH



                                  - 67 - 




                                  DAS            ; Vìsledek v AL je 09H

DEC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Dekrementace o 1

¬asov n¡:                      2-7 (80286), 2-6 (80386)

Popis:                         Instrukce  DEC  odeŸte  jedniŸku  od  obsahu
                               (slovn¡ho  nebo   bytov‚ho)  specifikovan‚ho
                               pamØœov‚ho  m¡sta  nebo  registru. Instrukce
                               DEC nemØn¡ pý¡znak CF.

Syntaxe:                       DEC destination

Ovlivåuje pý¡znaky:            OF, SF, AF, ZF, PF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je-li  vìsledek   v   segmentu  nepý¡stupn‚m
                               z pisu,  je   generov na   vçobecn   vìjimka
                               poruçen¡  ochrany  pamØti.  Pro  nedovolenou
                               efektivn¡ adresu operandu  nach zej¡c¡  se v
                               registrech  CS, DS  nebo  ES  je  generov na
                               vçeobecn    vìjimka  privilegovan‚ho   m¢du.
                               Jestli§e SS obsahuje nedovolenou adresu,  je
                               generov na vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Je-li  slovn¡ operand na offsetu OFFFFH,  je
                               generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                          DEC  AX
                                  DEC  EXTMEM
                                  DEC  TABLE[BX][SI]
                                  DEC  ECX (jen pro 80386)

DIV (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     DØlen¡  bez  uva§ov n¡   znam‚nka  (unsigned
                               division)

¬asov n¡:                      14-25 (80286), 14-41 (80386)

Popis:                         Instrukce DIV prov d¡ dØlen¡ operand…. Je-li
                               specifikov n  zdrojovì  operand  o velikosti
                               byte,  je registr  AX  dØlen  t¡mto  bytovìm
                               operandem   a  vìsledek  je  uchov n  v   AL
                               (kvocient)   a   v   AH   (zbytek).    Je-li
                               specifikov n  zdrojovì  operand  o velikosti
                               slova,     je     dØlen     DX:AX    slovem.
                               NejvìznamnØjç¡ch 16 bit…  zdrojov‚ho dØlence




                                  - 68 - 




                               je ulo§eno v DX,  kvocient  v  AX a zbytek v
                               DX.

Syntaxe:                       DIV source

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         SF, AF, OF, PF, CF

Vìjimky v PM:                  Je-li  dØlitel  roven  nule nebo je vìsledek
                               dØlen¡  - kvocient - pý¡liç velkì a  nevejde
                               se   do  m¡sta  urŸen¡  (AL  nebo  AX),   je
                               generov no   pýeruçen¡   INT   0.   Jestli§e
                               obsahuj¡ DS,  CS  Ÿi  ES  neplatn‚ efektivn¡
                               adresy  operand…,  je  generov na  vçeobecn 
                               vìjimka  privilegovan‚ho  m¢du.  Jestli§e SS
                               obsahuje  neplatnou  adresu,  je  generov na
                               vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Je-li  dØlitel 0  nebo  je  kvocient  pý¡liç
                               velkì a nevejde se do m¡sta urŸen¡  (AL nebo
                               AX), je generov no pýeruçen¡ INT 0. Jestli§e
                               je  slovn¡ operand  na  offsetu  OFFFFH,  je
                               generov no  pýeruçen¡  INT  13.  DØlen¡   ve
                               dvojit‚  pýesnosti  je mo§n‚  se  64-bitovìm
                               dØlencem  v EDX:EAX, 32-bitovì dØlitel je  v
                               pamØti nebo v registru, 32-bitovì kvocient v
                               EAX a 32-bitovì zbytek je v EDX.

Pozn mka pro 80386:            -

Pý¡klad:                       DØlen¡ bytu jinìm bytem:
                                  MOV  AL,NUMER_BTE
                                  DIV  DIVSR_BTE ;Kvocient v AL,zbytek v AH

                               DØlen¡ slova bytem:
                                  MOV  AX,NUMER_WRD
                                  DIV  DIVSR_BTE ;Kvocient v AL,zbytek v AH

                               DØlen¡ dvouslova slovem:
                                  MOV  DX,NUMER_MSW
                                  MOV  AX,NUMER_LSW
                                  DIV  DIVSR_WRD ;Kvocient v AX,zbytek v DX

                               DØlen¡ u 80386:
                                  MOV  EDX,MSB_NUMBER
                                  MOV  EAX,LSB_NUMBER
                                  DIV  ECX  ;Kvocient v EAX, zbytek v EDX

ENTER (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vytvoý  prostor  v z sobn¡ku  pro  parametry
                               procedury

¬asov n¡:                      11-16 (80286), 10-19 (80386)



                                  - 69 - 




Popis:                         Instrukce  ENTER  se pou§¡v   pro  vytvoýen¡
                               prototypu struktury  uchov vaj¡c¡ parametry,
                               jej¡§ pou§it¡ je typick‚ pro vØtçinu vyçç¡ch
                               programovac¡ch    jazyk….   Prvn¡    operand
                               specifikuje  velikost  po§adovan‚  alokovan‚
                               dynamick‚  pamØti, ji§ je týeba vymezit  pro
                               parametry   v   z sobn¡ku  pýi   vstupu   do
                               procedury.   Druhì   operand   ud v   £roveå
                               vnoýen¡  podprogramu  vzhledem  k zdrojov‚mu
                               programu  ve  vyçç¡m  programovac¡m  jazyce.
                               Instrukce   ENTER   urŸuje,   jak‚  mno§stv¡
                               ukazatel… (ze star‚ struktury pro vol n¡) je
                               týeba kop¡rovat do  nov‚  struktury. BP(EBP)
                               je   pou§it   jako  aktu ln¡   ukazatel   do
                               struktury.  Je-li  druhì  operand  roven  0,
                               ENTER ukl d  BP (EBP), nastavuje BP (EBP) na
                               hodnotu SP (ESP)  a odeŸ¡t  prvn¡ operand od
                               SP (ESP).

Syntaxe:                       ENTER immediate_word,immediate_byte
Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Pokud registr  SP  odkazuje  na  adresu mimo
                               limit  z sobn¡ku,   je   generov na  vìjimka
                               "chyba z sobn¡ku",  a  to  v  libovoln‚ f zi
                               vykon v n¡ instrukce ENTER.

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            Jsou  pou§ity 32-bitov‚ registry EBD a  ESP.
                               Velikost  struktury je zvØtçena ze 16 na  32
                               bit….

HLT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zastaven¡ prov dØn¡ programu

¬asov n¡:                      2 (80286), 5 (80386)

Popis:                         Instrukce  HLT  zp…sob¡  ukonŸen¡  prov dØn¡
                               programu.  OpØtovn‚  spuçtØn¡   programu  je
                               mo§n‚ jen extern¡m pýeruçen¡m nebo  RESETem.
                               Nejsou ovlivnØny § dn‚ registry ani  stavov‚
                               pý¡znaky. Jestli§e je k opØtovn‚mu  spuçtØn¡
                               programu   pou§ito    pýeruçen¡,   uschovan‚
                               hodnoty CS:IP budou  ukazovat  na instrukci,
                               je§ n sleduje za HLT.

Syntaxe:                       HLT (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚



                                  - 70 - 




Vìjimky v PM:                  HLT  je  privilegovan   instrukce generuj¡c¡
                               vçeobecnou   vìjimku   poruçen¡   ochrany  v
                               pý¡padØ, §e aktu ln¡ privilegovan  £roveå je
                               jin  ne§ 0.

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       HLT

IDIV (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     CeloŸ¡seln‚ dØlen¡ (se znam‚nkem)

¬asov n¡:                      17-28 (80286), 19-34 (80386)

Popis:                         Instrukce IDIV prov d¡ operaci celoŸ¡seln‚ho
                               dØlen¡    se    znam‚nkem.    Jestli§e    je
                               specifikov n  zdrojovì  operand  o velikosti
                               byte, je registr AX dØlen bytovìm operandem:
                               kvocient je  ulo§en  v  AL  a  zbytek  v AH.
                               Zdrojovì  operand  o  velikosti  slova  dØl¡
                               DX:AX  slovem. Vyçç¡ch 16 bit… dØlence je  v
                               registru  DX,  kvocient je um¡stØn  v  AX  a
                               zbytek v DX.  Zbytek m  stejn‚ znam‚nko jako
                               dØlenec a je v§dy  menç¡  jako  dØlitel. Viz
                               t‚§ pozn mku pro 80386.

Syntaxe:                       IDIV source

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         SF, AF, OF, PF, CF

Vìjimky v PM:                  Je-li  dØlitel roven  0  nebo  je-li  zbytek
                               pý¡liç  velkì  pro  um¡stØn¡ do po§adovan‚ho
                               registru   (AX   nebo   AL),  je  generov no
                               pýeruçen¡ INT 0. Jestli§e obsahuj¡ DS, CS Ÿi
                               ES  neplatn‚  efektivn¡  adresy operand…, je
                               generov na vçeobecn  vìjimka privilegovan‚ho
                               m¢du. Jestli§e SS obsahuje neplatnou adresu,
                               je generov na vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Je-li  dØlitel 0  nebo  je  kvocient  pý¡liç
                               velkì a nevejde se do m¡sta urŸen¡  (AL nebo
                               AX), je generov no pýeruçen¡ INT 0. Jestli§e
                               je  slovn¡ operand  na  offsetu  OFFFFH,  je
                               generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            Velikost slova je 32 bit…. DØlen¡ ve dvojit‚
                               pýesnosti   je   prov dØno   s  dØlitelem  v
                               registrov‚m  p ru  EDX:EAX. DØlitel  je  32-
                               bitov  hodnota  um¡stØn   v registru/pamØti.




                                  - 71 - 




                               32-bitovì pod¡l (kvocient) je  v  EAX  a 32-
                               bitovì zbytek v EDX.

Pý¡klad:                       DØlen¡ slova bytem:
                                  MOV  AX,NUMER_WRD
                                  IDIV DIVSR_BTE

                               DØlen¡ slova slovem:
                                  MOV  AX,NUMER_WORD
                                  CWD       ;Konverze slova na dvouslovo
                                  IDIV DIVSR_WRD

                               DØlen¡ dvouslova slovem:
                                  MOV  DX,NUMER_MSW
                                  MOV  AX,NUMER_LSW
                                  IDIV DIVSR_WRD

                               DØlen¡ u 80386:
                                  MOV  EDX,MSB_NUMBER
                                  MOV  EAX,LSB_NUMBER
                                  IDIV DIVISOR

IMUL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     CeloŸ¡seln‚ n soben¡

¬asov n¡:                      13-24 (80286), 9-41 (80386)

Popis:                         Instrukce IMUL prov d¡  celoŸ¡seln‚ n soben¡
                               se znam‚nkem. Jestli§e  je  zdrojovì operand
                               jedinì byte, je  vyn soben  obsahem registru
                               AL  a 16-bitovì  vìsledek  se  znam‚nkem  je
                               ulo§en do AX. Pý¡znaky CF a OF jsou nulov ny
                               v pý¡padØ, §e registr AH je extenz¡ znam‚nka
                               hodnoty ulo§en‚ v AL;  jinak  jsou  OF  a CF
                               nastaveny na 1. Viz  t‚§  pozn mku  k 80386.
                               Jestli§e je zdrojovì operand specifikovanì v
                               instrukci  IMUL  slovo,  pak  je   vyn soben
                               obsahem registru AX a 32-bitovì  vìsledek se
                               znam‚nkem  je  ulo§en  v  registrov‚m   p ru
                               DX:AX.  Registr DX obsahuje vyçç¡ch 16  bit…
                               vìsledku. Pý¡znaky OF a CF jsou nastaveny do
                               nuly v pý¡padØ, §e DX je extenz¡  znam‚nka v
                               AX (viz pozn mku u 80386); jinak  jsou  OF a
                               CF  nastaveny do 1. Jestli§e instrukce  IMUL
                               specifikuje týi operandy,  je  druhì operand
                               (jen§   je   efektivn¡    adresou   slovn¡ho
                               operandu) n soben týet¡m operandem (jen§  je
                               bezprostýedn¡ slovn¡ hodnotou).  Vìsledek je
                               16-bitovì  a je um¡stØn do prvn¡ho  operandu
                               instrukce IMUL,  kterì  specifikuje registr.
                               CF a OF jsou nastaveny do nuly v pý¡padØ, §e
                               vìsledek  je Ÿ¡slo se znam‚nkem v  intervalu
                               (-32768,+32768);   jinak   jsou  CF   a   OF
                               nastaveny do 1.



                                  - 72 - 




Syntaxe:                       IMUL source

Ovlivåuje pý¡znaky:            OF, CF

Nedefinovan‚ pý¡znaky:         ZF, SF, AF, PF

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na vçeobecn  vìjimka pruçen¡ ochrany
                               pamØti.  Jestli§e   SS   obsahuje  neplatnou
                               adresu,   je   generov na   vìjimka   "chyba
                               z sobn¡ku".

Vìjimky v RM:                  Jestli§e  le§¡  slovn¡  operand  na  offsetu
                               OFFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            Velikost  slova je  32  bit….  Je  prov dØno
                               n soben¡ ve dvojit‚ pýesnosti a  vìsledek je
                               ulo§en  v  registrov‚m p ru  EDX:EAX.  Tento
                               vìsledek   vznik     vyn soben¡m   32-bitov‚
                               hodnoty EAX-kr t.

Pý¡klad:                          MOV AL,NUMBER
                                  IMUL NUMBER ;Vìsledek v AX
                                  MOV AX,VALUE1
                                  IMUL VALUE2 ;Vìsledek v DX:AX

                               Pro 80386:
                                  MOV EAX,FCAB1234H
                                  IMUL NUMBER ;Vìsledek v EDX:EAX

IN (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vstup slova nebo bytu (z portu)

¬asov n¡:                      5 (80286), 5-6 (80386)

Popis:                         Instrukce  IN  nahrazuje obsah  registru  AL
                               nebo  AX   obsahem   specifikovan‚ho  portu.
                               Pýesouvanì  datovì £daj m…§e bìt slovo  nebo
                               byte.    Program tor    m…§e    specifikovat
                               libovolnì  port Ÿ¡slem od 0 do 65535,  kter‚
                               ulo§¡  do  registru  DX.  Jestli§e  je  port
                               specifikov n  s  datovìm  bytem "inline", je
                               nastaven pý¡stup k port…m  0  a§  255. INTEL
                               reservoval I/O adresy 00F8H a§ 00FFH ke svìm
                               intern¡m £Ÿel…m  (ý¡zen¡  koprocesoru, resp.
                               pý¡çt¡ extenze procesoru): tyto adresy port…
                               by tedy nemØly bìt u§¡v ny.

Syntaxe:                       IN accumulator,port

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚



                                  - 73 - 




Vìjimky v PM:                  Jestli§e IOPL (v registru pý¡znak…) obsahuje
                               hodnotu  vØtç¡  ne§  aktu ln¡  privilegovan 
                               £roveå,  je  generov na   vçeobecn   vìjimka
                               poruçen¡ ochrany pamØti.

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                          IN   AL,B_P_ADR     ; vstup byte do AL
                                  IN   AX,W_P_ADR     ; vstup slova do AX
                                  IN   AL,DX          ; vstup byte do AL
                                  IN   AX,DX          ; vstup slova do AX
                                  IN   EAX,PORT8      ; jen pro 80386

INC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zvìçen¡ o jedniŸku

¬asov n¡:                      2-7

Popis:                         Instrukce   INC   zvìç¡   obsah  operandu  o
                               jedniŸku, ani§
ovlivn¡ pý¡znak CF.

Syntaxe:                       INC destination

Ovlivåuje pý¡znaky:            SF, AF, OF, ZF, PF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  V pý¡padØ, §e operand  le§¡  v  segmentu, do
                               nØho§ nelze zapsat, je generov na  vçeobecn 
                               vìjimka   privilegovan‚ho   m¢du.   Jestli§e
                               registry  CS,  DS  nebo ES obsahuj¡ neplatn‚
                               efektivn¡  adresy  operand…,  je  generov na
                               vçeobecn  vìjimka  poruçen¡  ochrany pamØti.
                               Jestli§e  SS  obsahuje  neplatnou adresu, je
                               generov na vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Pýi  um¡stØn¡  slovn¡ho  operandu na offsetu
                               0FFFFH je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                          INC  AX
                                  INC  EBX       ; jen pro 80386
                                  INC  MEM_LOC

INS/INSB/INSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vstup z portu do ýetØzce

¬asov n¡:                      5 (80286), 5-8 (80386)



                                  - 74 - 




Popis:                         Instrukce  INS  pýesouv   byte  nebo   slovo
                               ýetØzce  na  pamØœov‚   m¡sto  specifikovan‚
                               ES:DI.  Registr  DX  (EDX) ukazuje pýitom na
                               vstupn¡  port.  Instrukc¡ INS  je  pýesouv n
                               byte  nebo  slovo  podle  prvn¡ho   operandu
                               instrukce INS.  Operand  v  pamØti  mus¡ bìt
                               adresovatelnì z registru  ES.  Instrukce INS
                               nedovoluje,    aby    bylo    Ÿ¡slo    portu
                               specifikov no  jako  bezprostýedn¡  hodnota.
                               Port  m…§e bìt  adresov n  jen  pýi  pou§it¡
                               registru  DS.  Po  proveden¡  instrukce   je
                               registr      DI       (EDI)      automaticky
                               inkrementov n/dekrementov n. Jestli§e  je DF
                               = 0 (byla provedena  instrukce  CLD),  je DI
                               (EDI)  inkrementov n. Jestli§e  je  DF  =  1
                               (byla provedena instrukce STD), je  DI (EDI)
                               dekrementov n. Inkrement/dekrement  je roven
                               1 pro bytovì pýesun, 2 pro slovn¡ pýesun.

Syntaxe:                       INS     destination_string,port
                               INSB    (§ dn‚ operandy)
                               INSW    (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e je hodnota  CPL  (Current Privilege
                               Level) vØtç¡ ne§ hodnota IOPL, je generov na
                               vçeobecn  vìjimka privilegovan‚ho m¢du. Tato
                               vìjimka je  generov na  tak‚  v  pý¡padØ, §e
                               m¡sto   urŸen¡   (c¡lovì   ýetØzec)  le§¡  v
                               segmentu,  do  nØho§  nelze zapsat. Jestli§e
                               registry  CS,  DS  nebo ES obsahuj¡ neplatn‚
                               efektivn¡  adresy  operand…,  je  generov na
                               vçeobecn  vìjimka  poruçen¡  ochrany pamØti.
                               Jestli§e  SS  obsahuje  neplatnou adresu, je
                               generov na vìjimka "chyba z sobn¡ku".


Vìjimky v RM:                  Pýi  um¡stØn¡  slovn¡ho  operandu na offsetu
                               0FFFFH je generov no pýeruçen¡ INT 13.


Pozn mka pro 80386:            æ¡ýka slova je 32 bit…. Adresy v pamØti jsou
                               vytv ýeny ze 32-bitovìch  efektivn¡ch adres.
                               ¬¡slo   portu   je   vzato  z  registru  DX.
                               Efektivn¡ adresa neovlivn¡ adresu I/O portu.

Pý¡klad:                          INS  BTE_STRG,DX    ; vstup bytu
                                  INS  WRD_STRG,DX    ; vstup slova
                                                      ( d‚lky ýetØzc…
                                  INSB      ; vstup byte jsou vzaty z
                                  INSW      ; vstup slova registru ECS )





                                  - 75 - 




INT/INTO (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Generov n¡  pýeruçen¡  -  vol n¡ pýeruçovac¡
                               procedury

¬asov n¡:                      23-167 (80286), 33-287 (80386)

Popis:                         Instrukce  INT  generuje  vol n¡ pýeruçovac¡
                               procedury  pomoc¡  softwareov‚ho  pýep¡naŸe.
                               Bezprostýedn¡   operand   instrukce,   kterì
                               obsahuje hodnotu mezi 0 a§ 255 vŸetnØ, ud v 
                               "Ÿ¡slo" pýeruçen¡, je§ je indexem do tabulky
                               deskriptor…  pýeruçen¡   (IDT   -  Interrupt
                               Descriptor Table)  pýeruçovac¡  procedury. V
                               privilegovan‚m    m¢du    sest v     tabulka
                               deskriptor…   z  osmibytovìch   deskriptor….
                               Deskriptor  pro   vyvol n¡   pýeruçen¡  mus¡
                               specifikovat   m¡sto  pýeruçen¡   (interrupt
                               gate),  m¡sto  pro  vìjimku  (trap  gate)  a
                               popý¡padØ  m¡sto £lohy (task gate). V RM  je
                               tabulka    deskriptor…   polem    4-bytovìch
                               ukazatel… alokovan  na fixn¡ adrese  00000H.
                               Instrukce INTO je identick  instrukci  INT s
                               tou   vìjimkou,   §e  Ÿ¡slo   pýeruçen¡   je
                               implicitnØ   4.   Toto   pýeruçen¡  je  tedy
                               aktivovateln‚  jen v pý¡padØ, §e pý¡znak  OF
                               je nastaven. V RM  instrukce  INT  ukl d  do
                               z sobn¡ku pý¡znaky a registr CS  a n vratovì
                               IP (EIP) (  v uveden‚m poýad¡). U§¡v  pýitom
                               ukazatele,   kterì   je   indexov n   Ÿ¡slem
                               pýeruçen¡.

Syntaxe:                       INT interrupt_type
                               INTO (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            Pýi  pýepnut¡  £lohy (task  switching)  jsou
                               ovlivnØny vçechny pý¡znaky;  jinak instrukce
                               INT/INTO neovlivåuj¡ § dn‚ pý¡znaky.

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Mohou   bìt   generov ny   vìjimky  poruçen¡
                               ochrany    pamØti,    vìjimka    "deskriptor
                               nenalezen",   vìjimka   "chyba   z sobn¡ku",
                               vìjimka "neplatnì stavovì segment £lohy".

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            æ¡ýka  operandu  nem   § dnì vìznam. Hodnoty
                               registr… EIP, ESP a  FLAGS  jsou  zav dØny z
                               m¡sta pýeruçen¡ (gate).

Pý¡klad:                       INT 21H
                               INTO




                                  - 76 - 




IRET (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     N vrat z pýeruçen¡

¬asov n¡:                      17-169 (80286), 22-275 (80386)

Popis:                         V  re ln‚m  adresn¡m  m¢du  instrukce   IRET
                               vyzved v  ze z sobn¡ku  IP (EIP), CS a FLAGS
                               a  ukonŸuje k¢d  programu  pýeruçen¡.  V  PM
                               instrukce IRET z vis¡ na nastaven¡  pý¡znaku
                               NT (Nested Task flag):

                               1.  NT  =  1.  Instrukce "obrac¡" efekt CALL
                               nebo INT, kter‚ vyvolaly pýepnut¡  £loh. K¢d
                               prov dØj¡c¡  instrukci  IRET  m   sv…j  stav
                               uchov n  ve sv‚m registru stavu £lohy  (TS).
                               Znamen   to, §e pýi opØtovn‚ aktivaci  £lohy
                               bude   provedena   jako    prvn¡   instrukce
                               n sleduj¡c¡ instrukci IRET.

                               2. NT = 0.  Instrukce  IRET  vrac¡  ý¡zen¡ z
                               pýeruçovac¡ho podprogramu, ani§  se vyskytlo
                               pýepnut¡ £loh. Privilegovan  £roveå k¢du, do
                               nØho§ se ý¡zen¡ z pýeruçovac¡ho  podprogramu
                               navrac¡,  mus¡ bìt  stejn   nebo  menç¡  ne§
                               privilegovan       £roveå      pýeruçovac¡ho
                               podprogramu.

Syntaxe:                       IRET (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            Celì  registr  pý¡znak…   je   vyzvednut  ze
                               z sobn¡ku.

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  M…§e   bìt   generov na   vçeobecn   vìjimka
                               poruçen¡ ochrany pamØti, vìjimka "deskriptor
                               nenalezen", vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Je   generov no   pýeruçen¡   INT   13   pýi
                               vyzved v n¡ obsahu z sobn¡ku maj¡c¡ho offset
                               0FFFFH.

Pozn mka pro 80386:            Je  pou§it   32-bitovì   rozç¡ýenì  ukazatel
                               instrukce.  éroveå  INTER  ukl d   48-bitovì
                               ESP. Jsou ukl d ny 48-bitovì EIP a 32-bitovì
                               FLAG.

Pý¡klad:                       IRET

J(podm¡nka) (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     (Bl¡zkì) skok pýi splnØn¡ podm¡nky




                                  - 77 - 




                               Varian. ¬as. Popis:
                               JA      7    Skok pýi vØtç¡m
                               JAE     7    Skok pýi vØtç¡m nebo rovn‚m
                               JB      7    Skok pýi menç¡m
                               JBE     7-9  Skok pýi menç¡m nebo rovn‚m
                               JC      7-9  Skok pýi pýenosu
                               JCXZ    8    Skok pýi CX = 0
                               JE      7    Skok pýi rovnosti
                               JG      7    Skok pýi vØtç¡m
                               JGE     7    Skok pýi vØtç¡m nebo rovn‚m
                               JL      7    Skok pýi menç¡m
                               JLE     7    Skok pýi menç¡m nebo rovn‚m
                               JNA     7    Skok pýi ne vØtç¡m
                               JNAE    7    Skok pýi ne vØtç¡m nebo rovn‚m
                               JNB     7    Skok pýi ne menç¡m
                               JNBE    7    Skok pýi ne menç¡m nebo rovn‚m
                               JNC     7    Skok pýi CF = 0
                               JNE     7    Skok pýi nerovnosti
                               JNG     7    Skok pýi ne vØtç¡m
                               JNGE    7    Skok pýi ne vØtç¡m nebo rovn‚m
                               JNL     7    Skok pýi ne menç¡m
                               JNLE    7    Skok pýi ne menç¡m nebo rovn‚m
                               JNO     7    Skok nebylo-li pýeteŸen¡
                               JNP     7    Skok nebyla-li parita
                               JNS     7    Skok nebylo-li znam‚nko
                               JO      7    Skok pýi pýeteŸen¡
                               JP      7    Skok pýi paritØ
                               JPE     7    Skok pýi sud‚ paritØ
                               JPO     7    Skok pýi lich‚ paritØ
                               JS      7    Skok pýi znam‚nku
                               JZ      7    Skok pýi nule


Popis:                         Instrukce J (n sledovan   podm¡nkou  z pr vØ
                               uveden‚ho seznamu)  pýed v   ý¡zen¡ operandu
                               specifikovan‚mu v instrukci. Jde o podm¡nØn‚
                               "kr tk‚" skoky testuj¡c¡ pý¡znaky. Testovac¡
                               operand instrukce mus¡  bìt v dosahu -128 a§
                               +127 byte od um¡stØn¡ instrukce J(podm¡nka).
                               Toto  omezen¡  je podstatn‚  pro  assembler,
                               kterì vytv ý¡  1-bytov‚  pýem¡stØn¡ vzta§en‚
                               ke konci instrukce J(podm¡nka).


Syntaxe:                       J(test_condition)


Ovlivåuje pý¡znaky:            § dn‚


Nedefinovan‚ pý¡znaky:         § dn‚








                                  - 78 - 




Vìjimky v PM:                  Jestli§e  je  offset m¡sta, na  nØ§  m   bìt
                               pýed no ý¡zen¡, mimo hranice segmentu CS, je
                               generov na vçeobecn  vìjimka privilegovan‚ho
                               m¢du.


Vìjimky v RM:                  § dn‚


Pozn mka pro 80386:            U§¡v     32-bitovì     rozç¡ýenì    ukazatel
                               instrukce.    Pýem¡stØn¡   je    osmibitov‚,
                               rozç¡ýen‚  do  32  bit…  znam‚nkovìm   bitem
                               (pokud nen¡ jinak upraveno).

Pý¡klad:                       JA INST_LABEL

JMP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nepodm¡nØnì skok


¬asov n¡:                      7-183 (80286), 7-268 (80386)


Popis:                         Instrukce  JMP  pýed v  ý¡zen¡  programu  na
                               jinou  instrukci,  pýiŸem§  nen¡  uchov v na
                               § dn   informace  o  n vratu.  JMP   prov d¡
                               intrasegmentov‚  pý¡m‚  a  nepý¡m‚  skoky  a
                               mezisegmentov‚ skoky.  Intrasegmentov‚ pý¡m‚
                               skoky  pou§¡vaj¡  offset um¡stØnì  ihned  za
                               instrukc¡.  Intrasegmentov‚   nepý¡m‚  skoky
                               u§¡vaj¡ obsahu pamØœov‚ho m¡sta adresovan‚ho
                               byty, kter‚ n sleduj¡c¡ po instrukŸn¡m byte.
                               Kdy§  je  instrukce  intrasegmentovìm pý¡mìm
                               skokem,  vzd lenost  od  konce  instrukce  k
                               c¡lov‚mu n vØçt¡  je  pýiŸtena  k  IP (EIP).
                               Mezisegmentov‚    skoky   nahrazuj¡    obsah
                               registru CS. Pro pý¡m‚ skoky je to zajiçtØno
                               druhìm  slovem  n sleduj¡c¡m  instrukci. Pro
                               skoky nepý¡m‚ je registr CS  nahrazen druhìm
                               slovem n sleduj¡c¡m po naznaŸen‚ adrese  dat
                               (viz pý¡klady).


Syntaxe:                       JMP (target)


Ovlivåuje pý¡znaky:            Pýi  pýepnut¡  ulohy (task  switching)  jsou
                               ovlivnØny vçechny pý¡znaky;  jinak nedoch z¡
                               k ovlivnØn¡ § dnìch pý¡znak….



Nedefinovan‚ pý¡znaky:         § dn‚




                                  - 79 - 




Vìjimky v PM:                  Jestli§e   je  typ  skoku  NEAR,  m…§e   bìt
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany  pamØti  v  pý¡padØ, §e offset m¡sta
                               urŸen¡ je mimo  hranice  aktu ln¡ho segmentu
                               CS.  Jestli§e  je typ skoku  FAR,  m…§e  bìt
                               generov na tak‚  vçeobecn   vìjimka ochrany.
                               Jin‚  mo§n‚  vìjimky  jsou: "deskriptor nen¡
                               pý¡tomen",   "chyba  z sobn¡ku",   "neplatnì
                               stavovì  registr  £lohy".   Jestli§e   je  u
                               intersegmentov‚ho nepý¡m‚ho  skoku operandem
                               registr, je generov na vìjimka "nedefinovanì
                               operaŸn¡ k¢d".

Vìjimky v RM:                  Jakmile    je     v     pý¡padØ    nepý¡m‚ho
                               intersegmentov‚ho  skoku operandem  registr,
                               je generov na vìjimka "nedefinovanì operaŸn¡
                               k¢d".

Pozn mka pro 80386:            Je  pou§it   32-bitovì   rozç¡ýenì  ukazatel
                               instrukce.  Ukazatelov‚  operandy  jsou  48-
                               bitov‚ a jejich pýem¡stØn¡ jsou 32-bitov .

Pý¡klad:                       Intersegmentovì pý¡mì skok:
                                  JMP FAR_LABEL
                                  Intersegmentovì nepý¡mì skok:
                                  JMP TABLE[BP][DI]
                                  JMP TABLE[EBP][EDI] ; jen pro 80386
                                  Intrasegmentovì pý¡mì skok:
                                  JMP NEAR_LABEL
                                  Intrasegmentovì nepý¡mì skok:
                                  JMP WORDPTR[BX][DI]

LAHF (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Naplå AH pý¡znakovìmi registry

¬asov n¡:                      2

Popis:                         Instrukce  LAHF  pýesouv   registry pý¡znak…
                               SF,  ZF,  AF,  PF  a  CF  do  urŸitìch  bit…
                               registru AH:

                               SF ZF AF PF CF
                               BIT 7   BIT 0

Bitov‚ pozice 1, 3 a 5 jsou nedefinov ny.

Syntaxe:                       LAHF (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:

Vìjimky v PM:                  § dn‚




                                  - 80 - 




Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       LAHF

LAR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     ZaveÔ  byte  pý¡stupovìch  opr vnØn¡ (access
                               rights)

¬asov n¡:                      14-16 (80286), 15-16(80386)

Popis:                         Druhì   operand   instrukce   LAR   obsahuje
                               selektor. Jestli§e  je  pý¡sluçnì deskriptor
                               na aktu ln¡ privilegovan‚ £rovni viditelnì a
                               selektor  je  RPL,   je   byte  pý¡stupovìch
                               opr vnØn¡  (access  rights  byte) zaveden do
                               horn¡ho byte prvn¡ho (registrov‚ho) operandu
                               instrukce LAR a ni§ç¡ byte je nastaven na 0.
                               Bylo-li zaveden¡ dokonŸeno, m  ZF hodnotu 1;
                               jinak je nulov n.

Syntaxe:                       LAR access_rights_byte,selector

Ovlivåuje pý¡znaky:            ZF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na vçeobecn  vìjimka ochrany pamØti.
                               Jestli§e  SS  obsahuje  neplatnou adresu, je
                               generov na vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Je  generov no  pýeruçen¡  INT  6. V RM nen¡
                               instrukce LAR rozpozn na.

Pozn mka pro 80386:            -

Pý¡klad:                       LAR ARB,SELECTR

LSS/LFS/LGS (80386), LDS/LES (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     ZaveÔ dvouslovn¡ ukazatel

¬asov n¡:                      7

Popis:                         Instrukce    LDS/LES    zav dØj¡    4-bytovì
                               ukazatel,     lokalizovanì     na     adrese
                               specifikovan‚ druhìm operandem instrukce, do
                               segmentov‚ho  a  slovn¡ho   registru.  Prvn¡
                               slovo  ukazatele  (offset)  je  zavedeno  do
                               registru  vystupuj¡c¡ho  jako  prvn¡ operand



                                  - 81 - 




                               instrukce.  Posledn¡   slovo   ukazatele  je
                               zavedeno  do  DS  registru (u instrukce LDS)
                               nebo ES registru (u instrukce LES).

Syntaxe:                       LDS destination,source

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Mo§n‚   vìjimky   jsou:   vçeobecn   vìjimka
                               poruçen¡   ochrany   a   "deskriptor   nebyl
                               nalezen".  Jestli§e  je operand  vnØ  hranic
                               limitu  segmentu,  je  generov na  vçeobecn 
                               vìjimka   ochrany   nebo    vìjimka   "chyba
                               z sobn¡ku". Jestli§e je  zdrojovìm operandem
                               registr, je generov na vìjimka "nedefinovanì
                               operaŸn¡ k¢d".

Vìjimky v RM:                  Pro  operand na offsetu 0FFFFH nebo  0FFFFDH
                               je generov no pýeruçen¡ INT 13.  Jestli§e je
                               zdrojovì  operand  registr,   je  generov na
                               vìjimka "nedefinovanì operaŸn¡ k¢d".

Pozn mka pro 80386:            æ¡ýka slova je 32 bit…. Ukazetel‚ maj¡
ç¡ýku 48 bit….

Pý¡klad:                          LDS  SI,DOUBLEWORD1
                                  LES  BX,DOUBLEWORD2

LEA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     ZaveÔ offset efektivn¡m adresy

¬asov n¡:                      3 (80286), 2 (80386)

Popis:                         Instrukce LEA pýesouv  offset ze  zdrojov‚ho
                               do   c¡lov‚ho   operandu.    Prvn¡   operand
                               instrukce LEA je c¡lovì registr, do nØho§ se
                               pýesouv  offset druh‚ho operandu.

Syntaxe:                       LEA source,destination

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je-li druhì operand  registr,  je generov na
                               vìjimka "nedefinovanì operaŸn¡ k¢d".

Vìjimky v RM:                  Je-li druhì operand  registr,  je generov na
                               vìjimka "nedefinovanì operaŸn¡ k¢d".

Pozn mka pro 80386:            æ¡ýka  slova je 32 bit…. Adresy pamØti  jsou
                               vytv ýeny z 32-bitovìch efektivn¡ch adres.



                                  - 82 - 




Pý¡klad:                          LEA  AX,[BP][DI]
                                  LEA  EBX,MYDATA ; jen pro 80386

LEAVE (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vìstup z procedury (na vyçç¡ £rovni)

¬asov n¡:                      5 (80286), 4 (80386)

Popis:                         Instrukce  LEAVE  prov d¡ operaci  du ln¡  k
                               instrukci   ENTER.   LEAVE   uvoln¡  vçechny
                               lok ln¡ promØnn‚ a nastav¡ BP na hodnotu SP,
                               navrac¡ registr…m  hodnoty  bezprostýednØ po
                               vykon n¡   procedury.   Kdy§   je  BP  (EBP)
                               kop¡rov n   do   SP   (ESP),  je  prostor  v
                               z sobn¡ku  pou§itì  pro  proceduru  uvolnØn.
                               Starì  ukazatel  struktury   (viz  instrukci
                               ENTER)  je nyn¡  vyzvednut  ze  z sobn¡ku  a
                               ulo§en  do BP  (EBP);  to  obnov¡  strukturu
                               volaj¡c¡ho    (pod)programu   a    n sleduje
                               instrukce   RET   nn   odstraåuj¡c¡  vçechny
                               argumenty ulo§en‚ do  z sobn¡ku  pro potýeby
                               procedury, kter  pr vØ konŸ¡.

Syntaxe:                       LEAVE (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Neukazuje-li  BP  (EBP)  na  pamØœov‚  m¡sto
                               uvnitý aktu ln¡ho z sobn¡kov‚ho segmentu, je
                               generov na vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Je-li   operand   na  offsetu   0FFFFH,   je
                               generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka   slova  je  32  bit….  Jsou   pou§ity
                               registry ESP a EBP.

Pý¡klad:                       LEAVE

LGDT/LIDT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     ZaveÔ registr tabulky glob ln¡ch deskriptor…
                               ZaveÔ registr tabulky deskriptor… pýeruçen¡

¬asov n¡:                      11-12

Popis:                         Instrukce  LGDT  nebo  LIDT  zav d¡  6  byte
                               pamØti referovan‚ efektivn¡ adresou operandu
                               do  tabulky  glob ln¡ch  deskriptor… nebo do
                               tabulky  deskriptor…  pýeruçen¡.  Pole LIMIT
                               registru tabulky deskriptor…  je  zav dØno z



                                  - 83 - 




                               prvn¡ho slova; dalç¡ týi byte  jsou zavedeny
                               do  pole BASE uveden‚ho registru a  posledn¡
                               byte  je  ignorov n.  Tyto  instrukce   jsou
                               urŸeny  pro  syst‚mov‚  software  (OS)  a  v
                               aplikaŸn¡ch programech nejsou pou§¡v ny.

Syntaxe:                       LGDT memory_operand

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  V pý¡padØ, §e aktu ln¡ privilegovan   £roveå
                               nen¡ nulov , je generov na vçeobecn  vìjimka
                               privilegovan‚ho   m¢du.  Jestli§e   obsahuje
                               registr SS neplatnou  adresu,  je generov na
                               vìjimka  "chyba   z sobn¡ku".   Jestli§e  je
                               zdrojovì  operand  registrem,  je generov na
                               vìjimka    "nedefinovanì   operaŸn¡    k¢d".
                               Jestli§e  registry  CS,DS nebo  ES  obsahuj¡
                               neplatnou  efektivn¡  adresu   operandu,  je
                               generov na vçeobecn  vìjimka privilegovan‚ho
                               m¢du.

Vìjimky v RM:                  Jestli§e le§¡ operand na offsetu  OFFFFH, je
                               generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            -

Pý¡klad:                          LGDT MEM_WRD
                                  LIDT MEM_WRD

LLDT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     ZaveÔ registr tabulky lok ln¡ch deskriptor…

¬asov n¡:                      17-19 (80286), 20 (80386)

Popis:                         Instrukce LLDT zav d¡  selektor  do registru
                               tabulky   lok ln¡ch   deskriptor….   Operand
                               word_operand instrukce LLDT by mØl obsahovat
                               selektor  ukazuj¡c¡  do  tabulky  glob ln¡ch
                               deskriptor…. Polo§ka v t‚to tabulce  by mØla
                               bìt   tabulkou   lok ln¡ch   deskriptor….  V
                               takov‚m pý¡padØ je registr tabulky lok ln¡ch
                               deskriptor…   zaveden   z    t‚to   polo§ky.
                               Instrukce je urŸena pro pou§it¡ v syst‚mov‚m
                               (OS) software a v aplikaŸn¡m software nebìv 
                               pou§ita.

Syntaxe:                       LLDT word_operand

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚



                                  - 84 - 




Vìjimky v PM:                  Jestli§e aktu ln¡ privilegovan   £roveå nen¡
                               0, je generov na vçoebecn  vìjimka  poruçen¡
                               ochrany pamØti. Stejn  vìjimka je generov na
                               v pý¡padØ, §e selektor neukazuje  na tabulku
                               glob ln¡ch  deskriptor…  nebo  v pý¡padØ, §e
                               polo§ka  v  tabulce  glob ln¡ch  deskriptor…
                               nen¡ lok ln¡ tabulkou deskriptor…. Kdy§ nen¡
                               lok ln¡  deskriptor  nalezen,  je generov na
                               vìjimka  "deskriptor   nenalezen".  Jestli§e
                               registry  CS,  DS  nebo ES obsahuj¡ neplatn‚
                               efektivn¡  adresy  operand…,  je  generov na
                               vçeobecn  vìjimka  poruçen¡  ochrany pamØti.
                               Jestli§e  SS  obsahuje  neplatnou adresu, je
                               generov na vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Je  generov no  pýeruçen¡  INT  6. V RM nen¡
                               instrukce LLDT rozpozn na.

Pozn mka pro 80386:            -

Pý¡klad:                       LLDT BP

LMSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav stavov‚ slovo procesoru (MSW)

¬asov n¡:                      3-6 (80286), 10-13 (80386)

Popis:                         Instrukce  LMSW  zav d¡ do  stavov‚ho  slova
                               procesoru (MSW, Machine  Status  Word) obsah
                               zdrojov‚ho   operandu.   Je   to   instrukce
                               vyhrazen    pro    syst‚movì    software   a
                               nevyskytuje  se  v  aplikaŸn¡ch  programech.
                               LMSW    lze    pou§¡t    k    pýepnut¡    do
                               privilegovan‚ho  m¢du  (ale  u 80286 nikoliv
                               pro   n vrat   z   privilegovan‚ho  m¢du  do
                               re ln‚ho) . V takov‚m pý¡padØ mus¡ bìt dalç¡
                               instrukce        privilegovan‚ho        m¢du
                               intrasegmentovì  skok,  aby  se  "vyŸistila"
                               fronta instrukc¡.

Syntaxe:                       LMSW source_operand

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Nen¡-li aktu ln¡ privilegovan  £roveå 0,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany  pamØti.  Jestli§e registry  CS,  DS
                               nebo ES obsahuj¡  neplatn‚  efektivn¡ adresy
                               operand…,  je  generov na  rovnØ§  vçeobecn 
                               vìjimka poruçen¡ ochrany pamØti. Jestli§e SS
                               obsahuje  neplatnou  adresu,  je  generov na
                               vìjimka "chyba z sobn¡ku".



                                  - 85 - 




Vìjimky v RM:                  Jestli§e le§¡ operand na offsetu  OFFFFH, je
                               generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            -

Pý¡klad:                       LMSW SP

LOCK (80386)
---------------------------------------------------------------------------

Instrukce:                     Aktivuj sign l BUS LOCK

¬asov n¡:                      0

Popis:                         Prefix  LOCK  pýed instrukc¡  vyjadýuje,  §e
                               oblast   pamØti    specifikovan    operandem
                               instrukce instruction bude zablokov na. Toho
                               je  dosa§eno  aktivac¡   sign lu   BUS  LOCK
                               procesoru  80386;  oblast  pamØti z…st v  ve
                               skuteŸnosti   zablokov na  a   protektov na,
                               dokud  procesor   nevykon    instrukci,  je§
                               odblokuje pamØœovou oblast stejnou s oblast¡
                               specifikovanou  druhìm  operandem  instrukce
                               LOCK.  Instrukce  u  80386,  je§  mohou  m¡t
                               prefix LOCK, jsou n sleduj¡c¡:

                               BT,BTS,BTR,BTC pamØœ,registr/bezpr._operand

                               XCG     pamØœ, registr

                               XCG     registr, pamØœ

                               ADC,SUB,ADC,SBB pamØœ,registr/bezpr_operand

                               OR,XOR,AND pamØœ, registr/bezpr._operand

                               NEG,INC,DEC,NOT pamØœ

Syntaxe:                       LOCK instruction,operand_type

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je  generov na  vçeobecn   vìjimka  poruçen¡
                               ochrany   pamØti   v    pý¡padØ,    §e   I/O
                               privilegovan  £roveå je  ni§ç¡  ne§ aktu ln¡
                               privilegovan  £roveå .

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            Blokovac¡  funkce  u  80386 jsou podmno§inou
                               blokovac¡ch funkc¡ u 8086 a  80286. Aplikace
                               psan‚ pro 8086  a 80286 tedy nemus¡ prob¡hat
                               korektnØ na 80386.




                                  - 86 - 




Pý¡klad:                       LOCK XCG MEM_WRD,AX

LODS/LODSW/LODSB (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     ZaveÔ bytovì nebo slovn¡ ýetØzec do stýadaŸe

¬asov n¡:                      5

Popis:                         Instrukce LODS pýesouv   slovn¡  nebo bytovì
                               operand   z   m¡sta    zdrojov‚ho   operandu
                               referovan‚ho registrem SI (ESI) do  stýadaŸe
                               AX   nebo   AL.   SI  (ESI)  je  automaticky
                               aktualizov n.  Jestli§e  je  DF  =  0  (bylo
                               provedeno CLD), je  SI  (ESI) inkrementov n;
                               jestli§e je DF = 1 (bylo provedeno  STD), je
                               SI  (ESI)  dekrementov n.   Inkrement  resp.
                               dekrement je roven 1 pro bytov‚ operandy a 2
                               pro slovn¡ operandy.

Syntaxe:                       LODS source_string
                               LODSB (§ dn‚ operandy)
                               LODSW (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  le§¡  slovn¡  operand  na  offsetu
                               OFFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                       LEA     SLDATA    ; jsou-li data 16-bitov ,
                               LODS              ; je vìsledek v AX

LOOP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Cyklus ý¡zenì registrem CX

¬asov n¡:                      8 (80286), 11 (80386)

Popis:                         Instrukce LOOP dekrementuje registr CX  o 1.
                               ¦ dn‚   pý¡znaky   nejsou    ovlivnØny.   Po
                               dekrementov n¡ jsou  testov ny  podm¡nky pro
                               instrukci  LOOPx (viz syntaxe) a pokud  jsou
                               splnØny, je proveden skok uvnitý segmentu na
                               m¡sto   specifikovan‚  operandem   instrukce



                                  - 87 - 




                               LOOPx.  Tento  operand  mus¡  le§et  (jde  o
                               n vØçt¡ !) v rozsahu 128 byte pýed instrukc¡
                               LOOPx a§ 127 byte za instrukc¡ LOOPx.

Syntaxe:                       LOOP short_target
                               LOOPE short_target
                               LOOPZ short_target
                               LOOPNZ short_target
                               LOOPNE short_target

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je generov na vçeobecn  vìjimka ochrany  pýi
                               pokusu  o  skok na adresu  s  offsetem  mimo
                               hranice aktu ln¡ho k¢dov‚ho segmentu CS.

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                               MOV CL,04H
                               AGAIN:  ADD BX,01H
                                       ADD AL,INFO[BX]
                                       DAA
                                       LOOP AGAIN
                                       MOV CX,12H
                               NEXT:   INC BX
                                       CMP TABLE[BX],0
                                       LOOPE NEXT
                                            ; jen pro 80386
                                       MOV ECX,0ABCDEH
                               REPEAT: INC BX
                                       MOV AL,TABLE_A[BX]
                                       ADD AL,TABLE_B[BX]
                                       MOV TOTAL[BX],AL
                                       LOOPNZ REPEAT

LSL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Z¡skej limit segmentu

¬asov n¡:                      14-16 (80286), 20-26 (80386)

Popis:                         Pokud  je selektor (druhì operand -  registr
                               nebo  pamØœ)  viditelnì  pýi  CPL   (Current
                               Privilege  Level),  je  do c¡lov‚ho operandu
                               instrukce pýesunuto  slovo  z  pole  LIMIT v
                               deskriptoru.   C¡lovì   operand   mus¡   bìt
                               registr. Jeho hodnota ud v  velikost  limitu
                               pro  tento  segment.  Jestli§e  byl   pýesun
                               uskuteŸnØn, je  pý¡znak  ZF  nastaven  na 1;
                               jinak je ZF nulov n.




                                  - 88 - 




Syntaxe:                       LSL seg_limit,selector

Ovlivåuje pý¡znaky:            ZF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Je generov no pýeruçen¡ INT 6. Instrukce LSL
                               nen¡ v RM rozpozn na.

Pozn mka pro 80386:            -

Pý¡klad:                       LSL AX,SELECTR

LTR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Naplå registr £lohy

¬asov n¡:                      17-19 (80286),23-27 (80386)

Popis:                         Instrukce  LTR  napln¡ registr  £lohy  (task
                               register) obsahem  zdrojov‚ho  registru nebo
                               pamØœov‚ lokace stoj¡c¡ na m¡stØ  zdrojov‚ho
                               operandu. Jde o instrukci operaŸn¡ho syst‚mu
                               nevyskytuj¡c¡ se v aplikaŸn¡ch programech.

Syntaxe:                       LTR source_operand

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Je generov no pýeruçen¡ INT 6. Instrukce LTR
                               nen¡ v RM rozpozn na.

Pozn mka pro 80386:            -

Pý¡klad:                       LTR MEM_WRD







                                  - 89 - 




MOV (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Pýesun dat

¬asov n¡:                      2-19 (80286), 2-22 (80386)

Popis:                         Instrukce  MOV  kop¡ruje   obsah  zdrojov‚ho
                               operandu do operandu  c¡lov‚ho.  K dispozici
                               je nØkolik instrukc¡ MOV, kter‚ maj¡ vçechny
                               stejnou funkci: kop¡ruj¡ zdrojovì operand do
                               c¡lov‚ho beze zmØny zdrojov‚ho operandu.

Syntaxe:                       MOV destination,source

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  je  naplåov n  segmentovì registr,
                               mohou  bìt  generov ny   vìjimky:  vçeobecn 
                               vìjimka  poruçen¡  ochrany  pamØti,  vìjimka
                               "chyba z sobn¡ku"  nebo  vìjimka "deskriptor
                               nenalezen".   Vçeobecn    vìjimka   poruçen¡
                               ochrany  pamØti  m…§e  bìt generov na tak‚ v
                               pý¡padØ,  §e c¡lovì operand le§¡ v  segmentu
                               nepý¡stupn‚m z pisu.  Jestli§e  registry CS,
                               DS  nebo  ES  obsahuj¡  neplatn‚   efektivn¡
                               adresy  operand…,  je  generov na  vçeobecn 
                               vìjimka ochrany pamØti. Jestli§e SS obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e le§¡ operand na offsetu  OFFFFH, je
                               generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka   slova   je   32  bit….  Adresy  jsou
                               vytvoýeny  pomoc¡   32-bitovìch  efektivn¡ch
                               adres nebo 32- bitovìch offset….

Pý¡klad:                       Do stýadaŸe z pamØti
                               MOV AX,MEM_WRD
                               MOV ECX,MYWORD ; jen pro 80386

                               Do pamØti ze stýadaŸe
                               MOV MEM_BYTE,AL

                               Do pamØti/registru ze segmentov‚ho registru
                               MOV BX,ES
                               MOV TABLE[BX],SS

                               Do segmentov‚ho registru z pamØti/registru
                               MOV ES,NEXT_WRD[SI]
                               MOV DS,AX

                               Do registru z registru



                                  - 90 - 




                               MOV CX,DI
                               MOV EAX,ECX ; jen pro 80386

                               Do registru z pamØti/registru
                               MOV AX,MEM_VAL
                               MOV CX,[BP][SI]

                               Do registru z bezprostýedn¡ho operandu
                               MOV DI,513
                               MOV EAX,12345678H ;jen pro 80386

                               Do pamØti/registru z bezpr. operandu
                               MOV TABLE[BP][SI],25
                               MOV BX,77

MOVS/MOVSB/MOVSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Pýesuå bytovì nebo slovn¡ ýØtØzec

¬asov n¡:                      5 (80286), 7 (80386)

Popis:                         Instrukce MOV pýesouvaj¡ obsah slova  (bytu)
                               referovan‚ho  [SI]  ([ESI])  do slova (byte)
                               adresovan‚ho   ES:[DI]  (ES:[EDI]).   C¡lovì
                               operand  mus¡  bìt  adresovatelnì z registru
                               ES. Po vykon n¡  instrukce jsou DI(EDI) i SI
                               (ESI)  automaticky  aktualizov ny.  Pýi DF=0
                               (byla vykon na instrukce CLD) jsou  registry
                               inkrementov ny,   jinak   (pýi   DF=1  (byla
                               vykon na  instrukce   STD))   jsou  registry
                               automaticky                  dekrementov ny.
                               Dekrement/inkrement je 1  pro bytov‚ a 2 pro
                               slovn¡ operace.

Syntaxe:                       MOVS destination_string,source_string
                               MOVSB (§ dn‚ operandy)
                               MOVSW (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku". Jestli§e je m¡sto  urŸen¡
                               v   segmentu    nepý¡stupn‚m    z pisu,   je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany pamØti.

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.




                                  - 91 - 




Pozn mka pro 80386:            Adresy  v  pamØti  jsou vytv ýeny pomoc¡ 32-
                               bitov‚  efektivn¡  adresy.  D‚lka ýetØzce je
                               odvozena od registru ECX.

Pý¡klad:                       LEA SI,MYSOURCE
                               LEA DI,ES:HERDESTINATION
                               MOV CX,50
                               REP MOVS HERDESTINATION

MOVZX/MOVSX (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Pýesun s extenz¡ znam‚nkov‚ho bitu

¬asov n¡:                      3 - 6

Popis:                         Instrukce  MOVZX a  MOVSX  jsou  doplnØny  k
                               instrukc¡m pýesunu  MOVx  k  tomu,  aby bylo
                               mo§n‚  pýesunout  8-mi   nebo   16-  bitovou
                               hodnotu do  registru  s  extenz¡  (nuly nebo
                               znam‚nka) do 16-ti nebo 32 bit….

Syntaxe:                       MOVZX register,register/memory
                               MOVSX register,register/memory

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  V  pý¡padØ,  §e  adresa  operandu  v  pamØti
                               poruçuje  pý¡stupov   pr va  nebo  le§¡  vnØ
                               hranic  segmentu,  je  generov na  vçeobecn 
                               vìjimka   poruçen¡   ochrany   pamØti.   Pýi
                               neplatn‚ adrese v segmentu SS  je generov na
                               vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            -

Pý¡klad:                       MOVZX EAX,BX
                               MOVZX CX,AL
                               MOVSX AX,BX ; norm ln¡ pýesun
                               MOVSX ECX,CL
                               MOVSX EAX,MYMEMORY

MUL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     N soben¡ bez znam‚nka (unsigned)

¬asov n¡:                      13-21 (80286), 9-41 (80386)






                                  - 92 - 




Popis:                         Operace MUL prov d¡  n soben¡  bez znam‚nka.
                               Bytovì operand instrukce MUL vyn sob¡  obsah
                               registru AL a  vìsledek ulo§¡ v registru AX.
                               Pý¡znaky CF  a OF jsou nastaveny do 0 pýi AH
                               nulov‚m; jinak jsou nastavov ny do 1. Slovn¡
                               operand instrukce MUL vyn sob¡ registr  AX a
                               vìsledek ponech  v  registrov‚m  p ru DX:AX.
                               DX obsahuje 16 vyçç¡ch bit… vìsledku, AX pak
                               16 ni§ç¡ch bit…. CF a OF jsou nastaveny do 0
                               pýi  DX nulov‚m; jinak jsou nastaveny do  1.
                               Viz pozn mku pro 80386.

Syntaxe:                       MUL source

Ovlivåuje pý¡znaky:            OF, CF

Nedefinovan‚ pý¡znaky:         SF, ZF, CF, AF

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka slova je  32 bit…. N soben¡ ve dvojit‚
                               pýesnosti  je  zajiçtØno n soben¡m  EAX  32-
                               bitovìm pamØœovìm m¡stem/registrem. Vìsledek
                               je 64-bitovì a je um¡stØn v registrov‚m p ru
                               EDX:EAX.

Pý¡klad:                       n soben¡ bytu slovem
                               MOV AL,MULT_BTE
                               CBW ; konverze byte v AL do slova v AX
                               MUL VAL_BTE
                               n soben¡ bytu bytem
                               MOV AL,MULTP_BTE
                               MUL VAL_BTE
                               n soben¡ slova slovem
                               MOV AX,MULT_PWRD
                               MUL VAL_WRD ; vyçç¡ bity v DX, ni§ç¡ v AX
                               80386
                               MOV EAX,0FCAB1234H
                               MUL EBX

NEG (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Negace ve dvojkov‚m doplåkov‚m k¢du

¬asov n¡:                      2-7 (80286),2-6 (80386)





                                  - 93 - 




Popis:                         Instrukce NEG odeŸ¡t  operand od  0, pýiŸ¡t 
                               k  takto vznikl‚ hodnotØ 1 a vrac¡  vìsledek
                               na m¡sto p…vodn¡ho operandu, vytv ýej¡c  tak
                               dvojkovì doplnØk. Pý¡znak CF je  nastaven na
                               1  (s  vìjimkou  nulov‚ho  operandu,   kterì
                               zp…sob¡ nastaven¡ CF na 0).

Syntaxe:                       NEG destination

Ovlivåuje pý¡znaky:            OF, SF, CF, ZF, AF, PF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  V   pý¡padØ,  §e  vìsledek  je  v   segmentu
                               chr nØn‚m   proti   z pisu,   je  generov na
                               vçeobecn  vìjimka  poruçen¡  ochrany pamØti.
                               Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                       NEG AL
                               NEG EBX (jen pro 80386)

NOP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Pr zdn  operace

¬asov n¡:                      3

Popis:                         Instrukce  nevyvol   § dnou operaci.  Je  to
                               jednobytov    instrukce   modifikuj¡c¡   jen
                               registr IP (EIP).

Syntaxe:                       NOP (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       NOP




                                  - 94 - 




NOT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Logick  negace

¬asov n¡:                      2-7 (80286), 2-6 (80386)

Popis:                         Instrukce  NOT  neguje  ka§dì  bit  ve  sv‚m
                               operandu a vrac¡ vìsledek na  p…vodn¡ m¡sto.
                               ¦ dn‚ pý¡znaky nejsou ovlivnØny.

Syntaxe:                       NOT destination

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  V   pý¡padØ,  §e  vìsledek  je  v   segmentu
                               chr nØn‚m   proti   z pisu,   je  generov na
                               vçeobecn  vìjimka ochrany. Jestli§e registry
                               CS,  DS nebo ES obsahuj¡ neplatn‚  efektivn¡
                               adresy  operand…,  je  generov na  vçeobecn 
                               vìjimka ochrany pamØti. Jestli§e SS obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       NOT AX
                               NOT EBX ;(jen pro 80386)

OR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Logick  disjunkce

¬asov n¡:                      2-7 (80286), 2-7 (80386)

Popis:                         Instrukce  OR  prov d¡   inkluz¡vn¡  logickì
                               souŸet  nad  dvØma  operandy. Koresponduj¡c¡
                               bitov‚  dvojice  obsahuj¡c¡  oba bity nulov‚
                               vrac¡  hodnotu 0, jinak hodnotu 1.  Vìsledek
                               je ulo§en v c¡lov‚m operandu.

Syntaxe:                       OR destination,source

Ovlivåuje pý¡znaky:            CF = 0, OF = 0, SF, ZF, PF

Nedefinovan‚ pý¡znaky:         AF

Vìjimky v PM:                  V   pý¡padØ,  §e  vìsledek  je  v   segmentu
                               chr nØn‚m   proti   z pisu,   je  generov na
                               vçeobecn  vìjimka  poruçen¡  ochrany pamØti.



                                  - 95 - 




                               Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit….

Pý¡klad:                       OR CX,DI
                               OR EAX,0FFFF0000H ;(jen pro 80386)
                               OR EBX,ECX ;(jen pro 80386)

OUT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vìstup slova nebo byte

¬asov n¡:                      3 (80286), 3-4 (80386)

Popis:                         Obsah stýadaŸe ( AX nebo  AL)  je  vysl n na
                               vìstupn¡  port.  Jako   vìstup   lze  pou§¡t
                               jakìkoliv port 0 a§ 65535.

Syntaxe:                       OUT port, accumulator

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  je   hodnota   IOPL  (Input/Output
                               Privilege Level-v  registru  pý¡znak…) vyçç¡
                               ne§   aktu ln¡   privilegovan    £roveå,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany pamØti.

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            ç¡ýka slova je 32 bit….

Pý¡klad:                       OUT WRD_PORT,AX
                               OUT BYT_PORT,AL
                               OUT EDX,EAX ; (jen pro 80386)

OUTS/OUTSB/OUTSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vìstup bytov‚ho/slovn¡ho ýetØzce na port

¬asov n¡:                      5 (80286), 7 (80386)






                                  - 96 - 




Popis:                         Instrukce  OUT  pýesouv   bytovì nebo slovn¡
                               ýetØzec  adresovanì  v  pamØti DS:SI na port
                               specifikovanì  adresou  v  DX. Druhì operand
                               instrukce  OUT  urŸuje  typ pýesouvanìch dat
                               (slova   nebo   byty).   SI  je  automaticky
                               inkrementov n o 1 pýi DF=0; pýi DF = 1 je SI
                               dekrementov n o 1. Pý¡r…stek je 1 pro bytov‚
                               a 2 pro slovn¡ operandy.

Syntaxe:                       OUTS port,source_string
                               OUTSB (§ dn‚ operandy)
                               OUTSW (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e je hodnota  CPL  (Current Privilege
                               Level)   vØtç¡   nebo   rovn   hodnotØ  IOPL
                               (Input/Output    Privilege     Level),    je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany  pamØti.  Tato   vìjimka   m…§e  bìt
                               generov na tak‚ v pý¡padØ, §e CS, DS nebo ES
                               obsahuje    neplatnou    efektivn¡    adresu
                               operandu.  Jestli§e   segment   CS  obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32  bit….  Adresy  operand… v
                               pamØti jsou vytv ýeny ze 32-bitov‚ efektivn¡
                               adresy. æestn ctibitov  Ÿ st adresy je br na
                               z  registru  DX.   32-   bitov   specifikace
                               neovlivn¡ adresu I/O portu. D‚lka ýetØzce je
                               br na z registru ECX.

Pý¡klad:                       OUTS DX,BYT_WRD
                               OUTS DX,WRD_STRNG
                               OUTSB
                               OUTSW

POP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vyzvedni operand ze z sobn¡ku

¬asov n¡:                      5 (80286), 5-7 (80386)

Popis:                         Instrukce   POP   vyzved v    obsah  vrcholu
                               z sobn¡ku a ukl d  jej do DS, ES, SS, pamØti
                               nebo  registru.  Instrukce POP  vezme  slovo
                               adresovan‚   registrem   SP    (=   ukazatel
                               z sobn¡ku)    a    ulo§¡    jej   na   m¡sto




                                  - 97 - 




                               specifikovan‚  c¡lovìm operandem  instrukce.
                               Ukazatel z sobn¡ku je pak zvìçen o 2.

Syntaxe:                       POP destination

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je-li  ze  z sobn¡ku  zav dØna  hodnota   do
                               segmentov‚ho    registru,   je    generov na
                               vçeobecn  vìjimka  poruçen¡  ochrany pamØti,
                               vìjimka  "chyba   z sobn¡ku"   nebo  vìjimka
                               "deskriptor   nenalezen".   Vìjimka   "chyba
                               z sobn¡ku" je generov na tak‚ v  pý¡padØ, §e
                               aktu ln¡  vrchol  z sobn¡ku nen¡  um¡stØn  v
                               rozsahu  pr vØ  adresovan‚ho   segmentu  SS.
                               Stejnou vìjimku bude generovat tak‚ um¡stØn¡
                               operandu  instrukce  v   segmentu  chr nØn‚m
                               proti z pisu. Jestli§e registry CS,  DS nebo
                               ES   obsahuj¡   neplatn‚   efektivn¡  adresy
                               operand…,  je  generov na  vçeobecn  vìjimka
                               poruçen¡   ochrany   pamØti.   Jestli§e   SS
                               obsahuje  neplatnou  adresu,  je  generov na
                               vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32  bit….  Adresy  operand… v
                               pamØti   jsou   vytv ýeny    z   32-bitovìch
                               efektivn¡ch adres.

Pý¡klad:                       Registrovì operand
                               POP CX
                               POP EAX (jen pro 80386)
                               Segmentovì registr
                               POP SS

POPA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vyzvedni vçechny vçeobecn‚ registry

¬asov n¡:                      19 (80286), 24 (80386)

Popis:                         Instrukce  POPA  vyzved v   obsah vçech osmi
                               çestn ctibitovìch registr… (DI, SI, BP,  SP,
                               BX, DX, CX,  AX)  (resp. dvaatýicetibitovìch
                               EDI,  ESI,  EBP, ESP, EBX,  EDX,  ECX,  EAX)
                               kromØ SP (resp.  ESP). Hodnota SP (ESP) nen¡
                               obnovov na.  Instrukce  POPA  je  du ln¡   k
                               instrukci  PUSHA,  kter   vçechny  vçeobecn‚
                               registry   ukl d    na    z sobn¡k.   Prvn¡m
                               registrem, kterì instrukce POPA vyzved v  ze
                               z sobn¡ku, je DI (EDI).



                                  - 98 - 




Syntaxe:                       POPA (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e nen¡ vrchol z sobn¡ku uvnitý hranic
                               segmentu  SS,  je  generov na vìjimka "chyba
                               z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit….

Pý¡klad:                       POPA

POPF (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vyzvednut¡ obsahy pý¡znakovìch registr…

¬asov n¡:                      5

Popis:                         Instrukce  POPF  pou§¡v   regitrovou dvojici
                               SS:SP   k   referenci   vrcholu   z sobn¡ku.
                               Instrukce POPF pak kop¡ruje vrchol z sobn¡ku
                               do   registru   pý¡znak….   SP   (ESP)    je
                               automaticky inkrementov n o 2. Pý¡znaky jsou
                               v   takto    z¡skan‚m    registru   pý¡znak…
                               definov ny n sledovnØ (od bitu 15 k bitu 0):
                               Nedefinov no,  Nested  Task,  I/O  Privilege
                               Level  (dva   bity),   Overflow,  Direction,
                               Interrupt   Enabled,   Trap,   Sign,   Zero,
                               Nedefinov no, Auxiliary Carry, Nedefinov no,
                               Parity, Nedefinov no a Carry.

Syntaxe:                       POPF (§ dn‚ operandy)
Ovlivåuje pý¡znaky:            Celì  registr  pý¡znak…   je   vyzvednut  ze
                               z sobn¡ku.

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  je  vrchol  z sobn¡ku mimo hranice
                               segmentu  SS,  je  generov na vìjimka "chyba
                               z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit….

Pý¡klad:                       POPF






                                  - 99 - 




PUSH (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Ulo§ slovo na vrchol z sobn¡ku

¬asov n¡:                      3-5 (80286), 2-5 (80386)

Popis:                         Instrukce  PUSH  sni§uje  hodnotu  ukazatele
                               z sobn¡ku SP (ESP) o  2  a  jej¡  operand je
                               um¡stØn  na  novì  vrchol  z sobn¡ku.  Je-li
                               ukl d na  hodnota registru SP (ESP), pak  ji
                               instrukce  PUSH   u   procesoru  80286/80386
                               ukl d   takovou,  jak   byla pýed proveden¡m
                               instrukce PUSH (na rozd¡l  od  PUSH  u 8086,
                               kde    byla     uchov v na     hodnota    SP
                               dekrementovan     o    2).    Ukl dat    lze
                               ES,CS,SS,DS,  pamØœov‚ m¡sto,  bezprostýedn¡
                               operand Ÿi registr.

Syntaxe:                       PUSH source

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  je  nov   hodnota  SP  vnØ  limitu
                               segmentu  SS,  je  generov na vìjimka "chyba
                               z sobn¡ku". Jestli§e registry CS,DS nebo  ES
                               obsahuj¡ neplatn‚ efektivn¡ adresy operand…,
                               je  generov na  vçeobecn   vìjimka  poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…. PamØœov‚ adresy jsou
                               vytv ýeny z 32-bitovìch efektivn¡ch adres.

Pý¡klad:                       PUSH AX
                               PUSH EBX ;(jen pro 80386)
                               PUSH CS

PUSHA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Ulo§ do z sobn¡ku vçechny vçeobecn‚ registry

¬asov n¡:                      17 (80286), 18 (80386)

Popis:                         Ukl d    registry   AX,CX,DX,BX   a  p…vodn¡
                               SP,BP,SI,DI (resp. EAX,ECX,EDX,EBX a p…vodn¡
                               ESP,EBP,ESI,EDI)  do  z sobn¡ku,  v uveden‚m
                               poýad¡. Ukazatel z sobn¡ku  je dekrementov n
                               o 16 (je ukl d no 8 dvoubytovìch hodnot).



                                  - 100 - 




Syntaxe:                       PUSHA (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je  generov na  vìjimka  "chyba z sobn¡ku" v
                               pý¡padØ,  §e poŸ teŸn¡ Ÿi koneŸn  adresa  je
                               vnØ rozsahu segmentu SS.

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit….

Pý¡klad:                       PUSHA

PUSHF (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Ulo§ registr pý¡znak… na z sobn¡k

¬asov n¡:                      3 (80286), 4 (80386)

Popis:                         Instrukce  PUSHF  dekrementuje   registr  SP
                               (ESP)  o  2  a  kop¡ruje registr pý¡znak… (=
                               vçechny pý¡znakov‚ registry) do specifickìch
                               bit…    slovn¡ho    operandu    adresovan‚ho
                               registrem  SP   (ESP).   N sleduj¡c¡  seznam
                               definuje poýad¡ pý¡znak…  poŸ¡naje nejvyçç¡m
                               (15.) bitem  a  konŸe  nejni§ç¡m  (0.) bitem
                               onoho   slovn¡ho   operandu:   Nedefinov no,
                               Nested Task,I/O Privilege Level (dva  bity),
                               Overflow,   Direction,  Interrupt   Enabled,
                               Trap,  Sign,  Zero,  Nedefinov no, Auxiliary
                               Carry, Nedefinov no, Parity,  Nedefinov no a
                               Carry.

Syntaxe:                       PUSHF (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je  generov na  vìjimka  "chyba z sobn¡ku" v
                               pý¡padØ,  §e poŸ teŸn¡ Ÿi koneŸn  adresa  je
                               vnØ rozsahu segmentu SS.

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            Instrukce ukl d  32-bitovì rozç¡ýenì registr
                               pý¡znak….

Pý¡klad:                       PUSHF




                                  - 101 - 




RCL/RCR/ROL/ROR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Instrukce rotac¡

¬asov n¡:                      2-5 (80286), 3-10 (80386)

Popis:                         Ka§d  z uvedenìch  instrukc¡  rotac¡ posouv 
                               specifick‚ bity registrov‚ho nebo pamØœov‚ho
                               operandu.  Instrukce  ROL  posunuje (rotuje)
                               vçechny  bity  operandu  doleva  o   1  bit,
                               pýiŸem§  bit  MSB  (nejvyçç¡) se pýesouv  na
                               m¡sto LSB (nejni§ç¡). Instrukce ROR  prov d¡
                               posuv (rotaci) pýesnØ opaŸnØ -  vçechny bity
                               se posunou  o 1 m¡sto doprava a na m¡sto MSB
                               se  pýesune  bit LSB. Instrukce  RCL  a  RCR
                               u§¡vaj¡  hodnotu  pý¡znaku   CF   jako  Ÿ st
                               pýesouvan‚ veliŸiny. Instrukce  RCL pýesouv 
                               CF do LSB a MSB do CF. Instrukce RCR prov d¡
                               pýesnØ opaŸnì pýesun: CF do MSB a LSB do CF.
                               Druhì operand  instrukc¡  rotac¡ specifikuje
                               poŸet pozic, o  kter‚ se m  zdrojovì operand
                               posunout. Pý¡znak pýeteŸen¡  OF  je nastaven
                               jen  v  pý¡padØ, §e u  instrukc¡  rotac¡  je
                               druhì operand roven  1.  U  RCR  je  test na
                               pýeteŸen¡ prov dØn pýed rotac¡, pro RCL, ROL
                               a ROR po rotaci. Pý¡znak OF je  nastavov n v
                               tØchto situac¡ch:  pokud  CF  =  MSB, nastav
                               OF:=0; pokud CF<>MSB, nastav OF := 1.

Pozn mka:                      Obvod 80286/80386 neumo§åuje prov dØt rotace
                               o v¡ce ne§ 31 bit…. Je pou§ito jen ni§ç¡ch 5
                               bit… Ÿ¡taŸe poŸtu rotac¡ i v pý¡padØ,  §e je
                               snaha o proveden¡ rotace o v¡ce ne§ 31 bit….

Syntaxe:                       RCL destination
                               RCL destination,CL
                               RCL destination,count
                               RCR destination
                               RCR destination,CL
                               RCR destination,count
                               ROL destination
                               ROL destination,CL
                               ROL destination,count
                               ROR destination
                               ROR destination,CL
                               ROR destination,count

Ovlivåuje pý¡znaky:            OF (jen pro rotaci o 1 bit),CF

Nedefinovan‚ pý¡znaky:         OF pro v¡cebitov‚ rotace

Vìjimky v PM:                  Jestli§e  registry  CS,DS nebo  ES  obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje



                                  - 102 - 




                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku". Jestli§e je m¡sto  urŸen¡
                               v   segmentu    nepý¡stupn‚m    z pisu,   je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany pamØti.

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                       RCL AH,1
                               RCL MEMRY_BTE,REP_VAL
                               RCL DH,CL
                               RCR BL,1
                               RCR TABLE[BX][DI],CL
                               ROL CX,1
                               ROL AX,CL
                               ROR BL,1
                               ROR MEMRY_BTE,REP_VAL
                               ROR TABLE[DX][DI],CL

REP/REPZ/REPE/PEPNE/REPNZ (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Opakuj ýetØzcovou operaci

¬asov n¡:                      5+9xN, kde N je poŸet iterac¡

Popis:                         REP, REPE  a  REPNE  jsou  prefixov‚ operace
                               kter‚  zp…sobuj¡,  §e primitivn¡  operace  s
                               ýetØzci zapsan  jako operand tØchto  operac¡
                               bude prov dØna opakovanØ  tak  dlouho, dokud
                               nebude registr CX roven nule.  Pro instrukce
                               SCAS a CMPS repetice konŸ¡ v pý¡padØ,  §e po
                               opakov n¡ instrukce za  prefixem  se pý¡znak
                               ZF liç¡ od "z"-bitu prefixu.

Syntaxe:                       REP
                               REPE
                               REPNE

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       LEA DI,VALUE1 ; pýiprav c¡lovì ýetØzec
                               LEA SI,VALUE2 ; pýprav zdrojovì ýetØzec
                               REPE CMPSB ; opakuj, pokud jsou si ve
                               ; srovn n¡ byte-po-byte rovny



                                  - 103 - 




RET (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     N vrat z procedury

¬asov n¡:                      15-55 (80286), 10-68 (80386)

Popis:                         Instrukce  zabezpeŸuje pokraŸov n¡  programu
                               t¡m, §e  pýenese  ý¡zen¡  progamu  na adresu
                               n vratu, kter  byla  (pýi  vol n¡ procedury)
                               ulo§ena do z sobn¡ku. Tato adresa je obvykle
                               um¡stØna   do   z sobn¡ku   instrukc¡  CALL.
                               Intrasegmentov‚  (NEAR)  n vraty   RET  pln¡
                               registr   instrukce  (instruction   pointer)
                               dvØma  nejhornØjç¡mi   byty   um¡stØnìmi  na
                               vrcholu  z sobn¡ku.  Tyto dva  byty  ud vaj¡
                               offset  instrukce,  kter   m  bìt vykon v na
                               jako  dalç¡.  Intersegmentov‚  (FAR) n vraty
                               RET  zaŸ¡naj¡  stejnØ  jako  intrasegmentov‚
                               pýenesen¡m  horn¡ch  dvou  byte ze z sobn¡ku
                               (t.j. offset  pý¡çt¡  vykon van‚ instrukce).
                               Jako  dalç¡ akce je vçak provedeno  naplnØn¡
                               registru CS dalç¡mi dvØma byte ze z sobn¡ku.
                               Tyto   dalç¡   dva  byte   obsahuj¡   adresu
                               segmentu,  v  nØm§  le§¡  pý¡çt¡  vykon van 
                               instrukce.

                               Abychom provedli intrasegmentovì  n vrat RET
                               a zmØnili ukazatele z sobn¡ku, je tedy týeba
                               zav‚st  horn¡  dva  byte  ze   z sobn¡ku  do
                               registru  instrukce.  Pak  je  týeba  zav‚st
                               dalç¡ dva  byte  ze  z sobn¡ku  do ukazatele
                               z sobn¡ku (stack pointer). Tyto posledn¡ dva
                               byte znovu nastav¡ posledn¡ obsah  ukazatele
                               z sobn¡ku, jen§ mohl pý¡padnØ bìt  ulo§en na
                               vrchol z sobn¡ku pýed instrukc¡ CALL.
                               Abychom provedli intersegmentovì  n vrat RET
                               a zmØnili ukazatele z sobn¡ku, je týeba opØt
                               zav‚st  horn¡  dva  byte  ze   z sobn¡ku  do
                               registru.  To  je offset  pý¡çt¡  vykon van‚
                               instrukce. Dalç¡ dva byte jsou  ze z sobn¡ku
                               zavedeny   do  registr  CS.  To  je   adresa
                               segmentu,  v  nØm§  le§¡  pý¡çt¡  vykon van 
                               instrukce.  Dalç¡  dva  byte ze z sobn¡ku se
                               mus¡  ulo§it  do   ukazatele   z sobn¡ku  ze
                               stejnìch pohnutek jako  pýi intrasegmentov‚m
                               n vratu.

Syntaxe:                       RET (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚






                                  - 104 - 




Vìjimky v PM:                  V   nØkterìch   pý¡padech    je   generov na
                               vçeobecn  vìjimka  poruçen¡  ochrany pamØti,
                               vìjimka  "deskriptor  nen¡   pý¡tomen"  nebo
                               vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            Je  pou§¡v n  32-bitovì  rozç¡ýenì  ukazatel
                               instrukce.  Ze  z sobn¡ku  je vyzved v n 32-
                               bitovì EIP.

Pý¡klad:                       RET

SAHF (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Ulo§ registr AH do pý¡znak…

¬asov n¡:                      2 (80286), 3 (80386)

Popis:                         Instrukce      SAHF       pln¡      pý¡znaky
                               SF,ZF,xx,AF,xx,PF,xx,CF            hodnotami
                               odpov¡daj¡c¡ch bit… registru  AH  (tedy bity
                               7,6,4,2
a 0).

Syntaxe:                       SAHF (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            SF, ZF, AF, PF, CF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       SAHF

SAL/SAR/SHL/SHR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Skupina     instrukc¡      posun…     (shift
                               instructions)

¬asov n¡:                      2-5 (80286), 3-7 (80386)

Popis:                         Instrukce SAL nebo SHL posouv  bity operandu
                               specifikovan‚ho  v   instrukci   doleva.  To
                               zp…sobuje, §e MSB je pýesunut do CF a LSB je
                               nulov n. Instrukce SAR nebo SHR posouv  bity
                               sv‚ho operandu doprava. Pak je  LSB pýesunut
                               do  CF.  Instrukce  SAR  prov d¡   dØlen¡  s
                               uva§ov n¡m   znam‚nka:   MSB    se   nemØn¡.



                                  - 105 - 




                               Instrukce  SHR prov d¡ dØlen¡ bez ohledu  na
                               znam‚nko: MSB je nulov n. Posuv  je opakov n
                               tolikr t,   kolik   Ÿin¡   hodnota   druh‚ho
                               operandu instrukc¡  posuvu.  T¡mto operandem
                               m…§e bìt jak pý¡mì  operand,  tak  i registr
                               CL.  Mikroprocesory  80286/80386  nepovoluj¡
                               posuny delç¡ ne§ 31. Je-li  pýesto po§adov n
                               posuv delç¡ ne§ 31  bit…,  je  uva§ov no jen
                               doln¡ch  pØt  bit…  operandu specifikuj¡c¡ho
                               d‚lku posunu. Pý¡znak OF  je  nastaven  do 1
                               jen pýi  posunu o 1 bit. Pro posun doleva je
                               nulov n v pý¡padØ, §e  bit  MSB  vìsledku je
                               stejnì   jako  vìslednì  CF:  jinak  je   OF
                               nastaven na 1. U instrukce SAR je pýi posuvu
                               o 1 bit  OF  nastaven  do  0.  Instrukce SHR
                               nastavuje  pý¡znak  OF  na hodnotu stejnou s
                               hodnotou MSB p…vodn¡ho  operandu  (t.j. pýed
                               proveden¡m posuvu).

Syntaxe:                       SAL destination,count
                               SAL destination,1
                               SAL destination,CL
                               SHL destination,count
                               SHL destination,1
                               SHL destination,CL

Ovlivåuje pý¡znaky:            OF (jen pýi posuvu o 1 bit),CF, AF, OF, PF a
                               SF.

Nedefinovan‚ pý¡znaky:         AF

Vìjimky v PM:                  Jestli§e  registry  CS,DS nebo  ES  obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku". Jestli§e je m¡sto  urŸen¡
                               v   segmentu    nepý¡stupn‚m    z pisu,   je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany pamØti.

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                       SHL MEMRY_BTE,1
                               SHL AX,CL
                               SHL TABLE[BX][DI],CL
                               SAR BL,1
                               SAR MEMRY_BTE,REP_VAL
                               SAR DH,CL
                               SAR CX,1
                               SAR MEMRY_BTE,1
                               SAR AX,CL




                                  - 106 - 




SBB (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     OdeŸ¡t n¡ s vìp…jŸkou

¬asov n¡:                      2-3 (80286), 2-7 (80386)

Popis:                         Instrukce  SBB  pýiŸ¡t    druhì   operand  k
                               pý¡znaku  CF a tento vìsledek je odeŸten  od
                               prvn¡ho  operandu.  Vìsledek  je  uchov n  v
                               prvn¡m operandu.

Syntaxe:                       SBB destination,source

Ovlivåuje pý¡znaky:            OF, SF, ZF, PF, CF, AF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku". Jestli§e je m¡sto  urŸen¡
                               v   segmentu    nepý¡stupn‚m    z pisu,   je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany pamØti.

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                       SBB AX,BX
                               SBB DX,MEMRY_WRD
                               SBB TABLE[BX][DI],SI
                               SBB AL,3
                               SBB EAX,EBX ; jen pro 80386
                               SBB ECX,0ABCD1234H ; jen pro 80386

SCAS/SCASB/SCASW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Porovn n¡ ýetØzcovìch dat

¬asov n¡:                      7

Popis:                         Srovn v  byte(AL), slovo(AX) s ES:[DI]  nebo
                               s ES:[EDI]. Instrukce SCAS odeŸ¡t   pamØœovì
                               byte nebo slovn¡ operand adresovanì  ES:[DI]
                               (ES:[EDI])  buÔ  od  registru  AL  nebo  AX.
                               Vìsledek je ignorov n a jsou nastavov ny jen
                               pý¡sluçn‚  pý¡znaky.  Operand  v pamØti mus¡
                               bìt  adresov n registrem ES. Po srovn n¡  je
                               DI (EDI) inkrementov n pýi DF=0; jinak je DI




                                  - 107 - 




                               (EDI) dekrementov n.  Inkrement/dekrement je
                               1 pro bytovì a 2 pro slovn¡ operand.

Syntaxe:                       SCAS destination,source
                               SCASB (§ dn‚ operandy)
                               SCASW (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            OF, SF, ZF, PF, CF, AF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            æ¡ýka slova je 32 bit….

Pý¡klad:                       MOV CL,10H   ; srovn n¡ 16 byte
                               LEA DI,VALUE1; um¡stØn¡ ýetØzce
                               MOV AL,'S'   ; hledanì znak
                               REPNE SCASB  ; dokud nen¡ nalezen,
                                            ; prohl¡§ej dalç¡ byty

SGDT/SIDT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uschovej registr GDT/IDT do pamØti

¬asov n¡:                      11 (80286), 9 (80386)

Popis:                         Instrukce SGDT i SIDT zav d¡  obsah registru
                               tabulky  deskriptor…  do   çesti  pamØœovìch
                               byt…,  na  nØ§  ukazuje c¡lovì operand. Pole
                               LIMIT  tohoto registru je um¡stØno v  prvn¡m
                               slovØ;  dalç¡  týi  byte jsou naplnØny polem
                               BASE  a   posledn¡   ze   çestice   byt…  je
                               nedefinov n.

Syntaxe:                       SGDT destination
                               SIDT destination

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Je-li   c¡lovì    operand    registrem,   je
                               generov na  vìjimka  "nedefinovanì  operaŸn¡
                               k¢d".  Jestli§e  registry  CS,  DS  nebo  ES
                               obsahuj¡ neplatn‚ efektivn¡ adresy operand…,
                               je  generov na  vçeobecn   vìjimka  poruçen¡



                                  - 108 - 




                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Je-li   c¡lovì    operand    registrem,   je
                               generov na  vìjimka  "nedefinovanì  operaŸn¡
                               k¢d". Jestli§e je slovn¡ operand  na offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            -

Pý¡klad:                       SGDT MEM_WRD
                               SIDT MEM_WRD

SLDT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uchovej     registr    tabulky     lok ln¡ch
                               deskriptor…

¬asov n¡:                      2

Popis:                         Instrukce  SLDT  m  jako  operand  efektivn¡
                               adresu  ukazuj¡c¡  buÔ na  2-bytovì  registr
                               nebo  pamØœov‚  m¡sto  a  uchov  v nØm obsah
                               tabulky lok ln¡ch deskriptor….

Syntaxe:                       SLDT destination

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku". Jestli§e je m¡sto  urŸen¡
                               v   segmentu    nepý¡stupn‚m    z pisu,   je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany pamØti.

Vìjimky v RM:                  Je generov no INT 6 - instrukce SLDT  nen¡ v
                               RM rozpozn na.

Pozn mka pro 80386:            -

Pý¡klad:                       SLDT BP

SMSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uchovej stavov‚ slovo procesoru (MSW)

¬asov n¡:                      2



                                  - 109 - 




Popis:                         C¡lovì operand  (efektivn¡  adresa, 2-bytovì
                               registr  nebo  pamØœov‚  m¡sto) obdr§¡ kopii
                               stavov‚ho slova procesoru MSW.

Syntaxe:                       SMSW destination

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku". Jestli§e je m¡sto  urŸen¡
                               v   segmentu    nepý¡stupn‚m    z pisu,   je
                               generov na rovnØ§ vçeobecn   vìjimka ochrany
                               pamØti.

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            -

Pý¡klad:                       SMSW BP

STC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav pý¡znak pýenosu (CF)

¬asov n¡:                      2

Popis:                         Instrukce  STC  nastavuje   pý¡znak   CF  do
                               hodnoty 1.

Syntaxe:                       STC (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            CF = 1

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       STC


STD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav pý¡znak DF



                                  - 110 - 




¬asov n¡:                      2

Popis:                         Instrukce  STD  nastavuje   pý¡znak   DF  do
                               hodnoty  1.  To m  za  n sledek,  §e  pý¡çt¡
                               instrukce pracuj¡c¡ s ýetØzci bude  sni§ovat
                               obsah registru SI a/nebo DI.

Syntaxe:                       STD (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            DF = 1

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       STD

STI (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav pý¡znak pýeruçen¡ (IF)

¬asov n¡:                      2 (80286), 3 (80386)

Popis:                         Instrukce STI nastavuje  IF = 1. To umo§åuje
                               zpracovat maskovateln  extern¡  pýeruçen¡ po
                               vykon n¡ pý¡çt¡ instrukce.

Syntaxe:                       STI (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            IF = 1

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  je  aktu ln¡  privilegovan  £roveå
                               ni§ç¡  ne§  I/O  privilegovan   £roveå,   je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany pamØti.

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       STI

STOS/STOSB/STOSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uschovej ýetØzcov  data

¬asov n¡:                      3 (80286), 4 (80386)




                                  - 111 - 




Popis:                         Instrukce STOS pýesouv  obsah buÔ AL nebo AX
                               na byte nebo slovo v pamØti. Tato  lokace je
                               adresov na  ES:DI  (resp.   ES:EDI).  C¡lovì
                               operand  mus¡  bìt  adresovatelnì z registru
                               ES.   Registr   DI  (EDI)   je   automaticky
                               inkrementov n/dekrementov n pýi DF = 0/DF  =
                               1.  Inkrement/dekrement  je  1  pro   bytov‚
                               pýesuny a 2 pro slovn¡ pýesuny.

Syntaxe:                       STOS destination_string
                               STOSB (§ dn‚ operandy)
                               STOSW (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na vçeobecn  vìjimka ochrany pamØti.
                               Jestli§e  SS  obsahuje  neplatnou adresu, je
                               generov na   vìjimka    "chyba   z sobn¡ku".
                               Jestli§e   je   m¡sto  urŸen¡   v   segmentu
                               nepý¡stupn‚m z pisu, je generov na vçeobecn 
                               vìjimka ochrany.

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       MOV ECX, 0FFCCAAH ; jen pro 80386
                               LEA EDI, VARIABLE
                               MOV AX,'-'
                               REP STOSB

STR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uschovej registr £lohy (task register)

¬asov n¡:                      2 (80286), 23-27 (80386)

Popis:                         Instrukce  STR  zp…sob¡, §e  obsah  registru
                               £lohy  je  kop¡rov n  do 2-bytov‚ho registru
                               nebo pamØœov‚ho m¡sta,  kter‚  je adresov no
                               c¡lovìm operandem.

Syntaxe:                       STR destination

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚






                                  - 112 - 




Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku". Jestli§e je m¡sto  urŸen¡
                               v   segmentu    nepý¡stupn‚m    z pisu,   je
                               generov na rovnØ§ vçeobecn  vìjimka poruçen¡
                               ochrany pamØti.

Vìjimky v RM:                  Je generov no INT 6 - instrukce SLDT  nen¡ v
                               RM rozpozn na.

Pozn mka pro 80386:            -

Pý¡klad:                       STR BP

SUB (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     CeloŸ¡seln‚ odeŸ¡t n¡

¬asov n¡:                      2-7

Popis:                         Instrukce  SUB  odeŸte zdrojovì  operand  od
                               c¡lov‚ho.  Vìsledek  je  ulo§en  v   c¡lov‚m
                               operandu.

Syntaxe:                       SUB destination,source

Ovlivåuje pý¡znaky:            OF, SF, ZF, PF, AF, CF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku". Jestli§e je m¡sto  urŸen¡
                               v   segmentu    nepý¡stupn‚m    z pisu,   je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany pamØti.

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       SUB AX, BX
                               SUB EAX,EDX ; jen pro 80386
                               SUB DX, MEMRY_WRD
                               SUB MEMRY_WRD,AX
                               SUB MEM_BTE,7
                               SUB NUMBER,0FC991576H ; jen pro 80386




                                  - 113 - 




TEST (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Test - logick‚ srovn n¡

¬asov n¡:                      2-6 (80386), 2-5 (80386)

Popis:                         Instrukce TEST prov d¡  logick‚  AND bit-po-
                               bitu nad dvØma operandy. Ka§dì  bit vìsledku
                               je nastaven  do  1  pýi  jedniŸkovìch bitech
                               obou  srovn vanìch  operand…; jinak  je  bit
                               vìsledku nastaven do  0.  Vìsledek instrukce
                               nen¡ pou§it, jsou jen nastaveny odpov¡daj¡c¡
                               pý¡znaky.

Syntaxe:                       TEST destination, source

Ovlivåuje pý¡znaky:            OF = 0, CF = 0, SF, ZF, PF

Nedefinovan‚ pý¡znaky:         AF

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   na  offsetu
                               0FFFFH, je generov no pýeruçen¡ INT 13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       TEST AX,BX
                               TEST EAX,EBX ; jen pro 80386
                               TEST MEM_BTE,6
                               TEST TABLE[BX][DI],CX
                               TEST TABLE[BX][DI],ECX ; jen pro 80386

VERR/VERW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Verifikuj segment pro Ÿten¡ nebo z pis

¬asov n¡:                      14-16 (80286), 10-16 (80386)

Popis:                         Instrukce VERR a VERW zjiçœuj¡,  zda segment
                               adresovanì    2-bytovìm    registrem    nebo
                               pamØœovìm selektorem m…§e bìt dosa§itelnì  z
                               aktu ln¡  privilegovan‚   £rovnØ.  Instrukce
                               tak‚ zjiçœuje,  zda  segment  m…§e  bìt Ÿten
                               nebo zda je do  nØj  mo§n‚  zapisovat. Je-li
                               segment  pý¡stupnì, je  ZF  nastaven  na  1;
                               jinak je ZF nulov n.

Syntaxe:                       VERR destination_readable_selector



                                  - 114 - 




                               VERW destination_writable_selector

Ovlivåuje pý¡znaky:            ZF

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Je  generov no  pýeruçen¡  INT 6 - instrukce
                               VERR/VERW nen¡ v RM rozpozn na.

Pozn mka pro 80386:            -

Pý¡klad:                       VERR BP
                               VERW SELECTR

WAIT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     ¬ek n¡ na vìskyt extern¡ho pýeruçen¡

¬asov n¡:                      3 (80286), 6 (80386) - minim lnØ

Popis:                         Instrukce WAIT zp…sob¡, §e 80286/80386 Ÿek ,
                               dokud  se   nevyskytne   extern¡  pýeruçen¡.
                               Procesor  z…st v    inaktivn¡,   dokud  nen¡
                               aktivov n vstup TEST. Instrukci lze pou§¡t k
                               synchronizaci   extern¡ch  zaý¡zen¡   (napý.
                               koprocesoru).

Syntaxe:                       WAIT (§ dn‚ operandy)

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pozn mka pro 80386:            -

Pý¡klad:                       WAIT

XCHG (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Z mØna byt… nebo slov

¬asov n¡:                      3-5




                                  - 115 - 




Popis:                         Instrukce XCHG zamØåuje  bytovì  nebo slovn¡
                               zdrojovì  operand  s  odpov¡daj¡c¡m  c¡lovìm
                               operandem.

Syntaxe:                       XCHG destination,source

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e    operand    le§¡    v    segmentu
                               nepý¡stupn‚m z pisu, je generov na vçeobecn 
                               vìjimka  poruçen¡  ochrany  pamØti. Jestli§e
                               registry  CS,  DS  nebo ES obsahuj¡ neplatn‚
                               efektivn¡  adresy  operand…,  je  generov na
                               vçeobecn  vìjimka  poruçen¡  ochrany pamØti.
                               Jestli§e  SS  obsahuje  neplatnou adresu, je
                               generov na vìjimka "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   um¡stØn  na
                               offsetu 0FFFFH, je generov no pýeruçen¡  INT
                               13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       XCHG AX,BX
                               XCHG DH,DATA_BTE
                               XCHG AL,DL
                               XCHG EAX,EBX ; jen pro 80386

Pozn mka:                      Pýi u§it¡ instrukce XCHG s prefixem LOCK lze
                               efektnØ implementovat  semafory  pro obsluhu
                               sd¡lenìch zdroj… v operaŸn¡m syst‚mu.

XLAT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Pýevod podle pýevodn¡ tabulky

¬asov n¡:                      5

Popis:                         Instrukce  XLAT prov d¡ translaci byte v  AL
                               pomoc¡  pýevodn¡  tabulky   (lookup  table).
                               Ukazatel na 256 bytovou pýevodn¡  tabulku je
                               zaveden do BX.  Byte, kterì m  bìt pýeveden,
                               je  um¡stØn  v  AL:  slou§¡  jako  index  do
                               pýevodn¡  tabulky.  Po  proveden¡  instrukce
                               XLAT  je  byte v AL  nahrazen  bytem,  kterì
                               odpov¡d  bytu vzd len‚mu AL-byt… od  zaŸ tku
                               pýevodn¡ tabulky.

Syntaxe:                       XLAT translation_table

Ovlivåuje pý¡znaky:            § dn‚

Nedefinovan‚ pý¡znaky:         § dn‚



                                  - 116 - 




Vìjimky v PM:                  Jestli§e  registry  CS,  DS nebo ES obsahuj¡
                               neplatn‚  efektivn¡   adresy   operand…,  je
                               generov na   vçeobecn     vìjimka   poruçen¡
                               ochrany   pamØti.   Jestli§e   SS   obsahuje
                               neplatnou  adresu,  je   generov na  vìjimka
                               "chyba z sobn¡ku".

Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   um¡stØn  na
                               offsetu 0FFFFH, je generov no pýeruçen¡  INT
                               13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       LEA BX,MYTABLE ; um¡stØn¡ tabulky
                               MOV AL,INDEX ; offset do tabulky
                               XLAT  MYTABLE ; hodnota z tabulky vr cena  v
                               AL

Pozn mka:                      D‚lka  translaŸn¡  tabulky  m…§e bìt i menç¡
                               ne§ 256 byt….  Operand  translation_table je
                               nepovinnì, proto§e registr BX mus¡  bìt pýed
                               proveden¡m  instrukce  XLAT  stejnØ  naplnØn
                               ukazatelem na tabulku.

XOR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Logickì exkluz¡vn¡ souŸet XOR

¬asov n¡:                      2-3 (80286), 2-7 (80386)

Popis:                         Instrukce XOR srovn v  ka§dì bit  zdrojov‚ho
                               operandu  s  c¡lovìm  a prov d¡ "bitovì" XOR
                               (nonekvivalence). Vìsledek obsahuje  nuly na
                               tØch  bitovìch  pozic¡ch,  kde m  zdrojovì i
                               c¡lovì operand  buÔ  obØ  jedniŸky  nebo obØ
                               nuly.  Jinak  je  na pý¡sluçn‚ bitov‚ pozici
                               jedniŸka.

Syntaxe:                       XOR destination,source

Ovlivåuje pý¡znaky:            OF = 0, CF = 0,SF, ZF, PF

Nedefinovan‚ pý¡znaky:         AF

Vìjimky v PM:                  Jestli§e    operand    le§¡    v    segmentu
                               nepý¡stupn‚m z pisu, je generov na vçeobecn 
                               vìjimka  poruçen¡  ochrany  pamØti. Jestli§e
                               registry  CS,  DS  nebo ES obsahuj¡ neplatn‚
                               efektivn¡  adresy  operand…,  je  generov na
                               vçeobecn  vìjimka  ochrany  pamØti. Jestli§e
                               SS obsahuje neplatnou adresu, je  generov na
                               vìjimka "chyba z sobn¡ku".






                                  - 117 - 




Vìjimky v RM:                  Jestli§e  je  slovn¡   operand   um¡stØn  na
                               offsetu 0FFFFH, je generov no pýeruçen¡  INT
                               13.

Pozn mka pro 80386:            ç¡ýka slova je 32 bit…

Pý¡klad:                       XOR AX,MEMRY_WRD
                               XOR AH,BL
                               XOR OP1,OP1 ; efektn¡ nulov n¡ operand OP1
                               XOR TABLE[BX][DI],AX
                               XOR EAX,ECX ; jen pro 80386
                               XOR EDX,0CFAD1579H ; jen pro 80386















































                                  - 118 - 










                            K a p i t o l a   8

                         Speci ln¡ instrukce 80386


IBTS
---------------------------------------------------------------------------

Instrukce:                     Vlo§ bity do registru nebo pamØœov‚ lokace

¬asov n¡:                      2-4

Popis:                         Instrukce IBTS vkl d  ni§ç¡ bity registru do
                               jin‚ho  registru  nebo pamØœov‚  lokace  bez
                               poruçen¡   soused¡c¡ch   bit….   IBTS  m   4
                               operandy:  b zov   adresa  bitov‚ho ýetØzce,
                               bitovì offset zaŸ tku  podýetØzce,  kterì m 
                               bìt ulo§en, jeho d‚lku  a  registr,  jen§ m 
                               obdr§et  vkl danou  hodnotu.  B zov   adresa
                               m…§e  bìt  registrem  nebo adresou v pamØti.
                               Offset je ulo§enì v registru EAX  (v  AX pýi
                               16-tibitovìch  operandech).  D‚lka  pole  je
                               d na   registrem   CL   a  posledn¡  operand
                               instrukce  specifikuje   vçeobecnì  registr,
                               kterì m  obdr§et hodnotu.

Syntaxe:                       IBTS base,offset,length,source
                               IBTS reg/mem,(E)AX,CL,reg

Ovlivåuje pý¡znaky:            OF,SF,ZF,AF,PF


Nedefinovan‚ pý¡znaky:         CF

Vìjimky v PM:                  Vçeobecn   vìjimka  privilegovan‚ho  m¢du je
                               generov na v pý¡padØ, §e operand  nem…§e bìt
                               pou§it kv…li poruçen¡  limitu  segmentu nebo
                               pý¡stupovìch pr v.

Vìjimky v RM:                  Vçeobecn   vìjimka  privilegovan‚ho  m¢du je
                               generov na v pý¡padØ, §e operand  nem…§e bìt
                               pou§it  kv…li  um¡stØn¡  mimo limit segmentu
                               (offset 0FFFFH).

Pý¡klad:                       IBTS BX,AX,CL,DX

MOV CRn
---------------------------------------------------------------------------

Instrukce:                     Naplå a ulo§ ý¡dic¡ registry



                                  - 119 - 




                               MOV CRn,reg
                               MOV reg,CRn

¬asov n¡:                      2-4

Popis:                         Instrukce  pln¡  nebo  ukl daj¡ hodnoty z/do
                               ý¡dic¡ch   registr…   CRn.   Instrukce  v§dy
                               pou§¡vaj¡  32-bitov‚  operandy a  pro  80386
                               jsou definov ny jen ý¡dic¡ registry CR0, CR2
                               a CR3.

Syntaxe:                       MOV CRn,source_operand
                               MOV destination,CRn

Ovlivåuje pý¡znaky:            OF, ZF, SF, PF, AF


Nedefinovan‚ pý¡znaky:         CF

Vìjimky v PM:                  Jde  o   privilegovan‚   instrukce.  Jsou-li
                               vykon v ny na privilegovan‚ £rovni jin‚  ne§
                               0,  vedou  k  vìpadku  ochrany   (protection
                               fault).

Vìjimky v RM:                  § dn‚

Pý¡klad:                       MOV CR2,EAX
                               MOV EBX,CR3

MOV DRn
---------------------------------------------------------------------------

Instrukce:                     Naplå a uschovej ladic¡ registry
                               MOV Dreg,reg
                               MOV reg,Dreg

¬asov n¡:                      2-4

Popis:                         Instrukce zav dØj¡ a  uchov vaj¡  obsahy 32-
                               bitovìch hodnot ladic¡ch registr….

Syntaxe:                       MOV Dreg,reg
                               MOV reg,Dreg

Ovlivåuje pý¡znaky:            OF, ZF, SF, AF, PF


Nedefinovan‚ pý¡znaky:         CF

Vìjimky v PM:                  Jde  o   privilegovan‚   instrukce.  Jsou-li
                               vykon v ny na privilegovan‚ £rovni jin‚  ne§
                               0, vedou k vìpadku ochrany.

Vìjimky v RM:                  § dn‚

Pý¡klad:                       MOV DR4,EAX



                                  - 120 - 




                               MOV EBX,DR5

MOV TRn
---------------------------------------------------------------------------

Instrukce:                     Naplå a uschovej testovac¡ registry
                               MOV Treg,reg
                               MOV reg,Treg

¬asov n¡:                      2-4

Popis:                         Instrukce  pln¡  nebo  ukl daj¡ hodnoty z/do
                               testovac¡ch  registr…  TRn. Pro  80386  jsou
                               definov ny jen ý¡dic¡ registry TR6 a TR7.

Syntaxe:                       MOV Treg,reg
                               MOV reg,Treg

Ovlivåuje pý¡znaky:            § dn‚


Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jde  o   privilegovan‚   instrukce.  Jsou-li
                               vykon v ny na privilegovan‚ £rovni jin‚  ne§
                               0, vedou k vìpadku ochrany.

Vìjimky v RM:                  § dn‚

Pý¡klad:                       MOV TR6,EAX

SETcond.
---------------------------------------------------------------------------

Instrukce:                     Nastav byte podle podm¡nky
























                                  - 121 - 




                               --------------------------------------------
                               Instrukce    ¬asov n¡: Popis:
                               --------------------------------------------
                               SET     cond.JedniŸkuje-nuluje
                                            byte podle vìsledku
                                            testu podm¡nky
                               SETO    -    PýeteŸen¡
                               SETNO   -    Nen¡ pýeteŸen¡
                               SETB    -    Menç¡
                               SETNAE  -    Ne vØtç¡ nebo rovno
                               SETNB   -    Ne menç¡
                               SETAE   -    VØtç¡ nebo rovno
                               SETE    -    Rovno
                               SETZ    -    Nula
                               SETNE   -    Ne rovno
                               SETNZ   -    Ne nula
                               SETBE   -    Menç¡ nebo rovno
                               SETNA   -    Ne vØtç¡
                               SETNBE  -    Ne menç¡ nebo rovno
                               SETA    -    VØtç¡
                               SETS    -    Znam‚nko
                               SETNS   -    Ne znam‚nko
                               SETP    -    Parita
                               SETPE   -    Sud  parita
                               SETNP   -    Ne parita
                               SETPO   -    Lich  parita
                               SETL    -    Menç¡ ne§ (se signem)
                               SETNGE  -    Ne vØtç¡ ne§ nebo =
                               SETNL   -    Ne menç¡ ne§
                               SETGE   -    VØtç¡ nebo rovno
                               SETLE   -    Menç¡ nebo rovno
                               SETNG   -    Ne vØtç¡ ne§
                               SETNLE  -    Ne menç¡ ne§ nebo =
                               SETG    -    VØtç¡ ne§ (se signem)
                               --------------------------------------------


Efekt instrukce:               Instrukce SET nastavuje vybranì byte do nuly
                               nebo   do   jedniŸky   podle   16   podm¡nek
                               definovanìch pro 80386. Jedinìm operandem je
                               jednobytovì registr  nebo  pamØœovì operand.
                               Jsou provedena n sleduj¡c¡  pýiýazen¡: pokud
                               SETcond, pak reg/mem = 1; jinak reg/mem = 0.

Syntaxe:                       SETcond reg/mem

Ovlivåuje pý¡znaky:            § dn‚


Nedefinovan‚ pý¡znaky:         § dn‚

Vìjimky v PM:                  Jestli§e   operand   nem…§e   bìt  pou§it  v
                               instrukci  kv…li  poruçen¡  limitu  segmentu
                               nebo  poruçen¡  pý¡stupovìch  pr v,  pak  je
                               generov na vìjimka 13.




                                  - 122 - 




Vìjimky v RM:                  § dn‚

Pý¡klad:                       SETNO

SHLD/SHRD
---------------------------------------------------------------------------

Instrukce:                     Instrukce dvojit‚ho posuvu

¬asov n¡:                      3-7

Popis:                         Instrukce   SHLD/SHRD    posouvaj¡   operand
                               reprezentuj¡c¡  Ÿ¡slo  v  dvojit‚  pýesnosti
                               doleva nebo doprava tak, aby vzniklo Ÿ¡slo v
                               jednoduch‚ pýesnosti.  Registr  nebo hodnota
                               pamØœov‚ho m¡sta je posunuta v z vislosti na
                               hodnotØ v týet¡m  operandu  instrukce, kterì
                               je Ÿ¡taŸem. Tento posuv se liç¡ od  posuv… u
                               Ÿ¡sel  v  jednoduch‚  pýesnosti  v  tom,  §e
                               dvojitì posuv pou§¡v  registrovì operand pro
                               specifikaci  bit…,  kter‚  se maj¡ posouvat,
                               zat¡mco jednoduchì posuv  pýesouv   jen nuly
                               nebo jedniŸky. Registr  nebo  pamØœov‚ m¡sto
                               (reg/mem)   specifikuje   vstupn¡   operand.
                               Registr (reg) specifikuje  bity,  kter‚ maj¡
                               bìt vsunuty, a týet¡ operand  (immediate/CL)
                               obsahuje poŸet posuv….

                               Pro  SHLD  obsahuje  registr  nebo  pamØœovì
                               operand   vyçç¡   bity   Ÿ¡sla   v   dvojit‚
                               pýesnosti,   a   registr   (druhì   operand)
                               obsahuje ni§ç¡ bity Ÿ¡sla. Prvn¡  operand je
                               posunut doleva, pýiŸem§  vyçç¡  bity druh‚ho
                               operandu  jsou  vsunuty  doprava  (na  m¡sto
                               ni§ç¡ho  ý du). Vìsledek je ulo§en v  prvn¡m
                               operandu.

                               Pro  SHRD  obsahuje  registr  nebo  pamØœovì
                               operand   ni§ç¡   bity  Ÿ¡sla   ve   dvojit‚
                               pýesnosti  a   registrovì   (druhì)  operand
                               obsahuje  vyçç¡  bity.   Prvn¡   operand  je
                               posunut  doprava  a  ni§ç¡ bity registrov‚ho
                               operandu  jsou  vsunuty  doleva  (na   m¡sto
                               vyçç¡ho  ý du). Vìsledek je ulo§en v  prvn¡m
                               operandu.

Syntaxe:                       SHLD reg/mem,reg,immediate_operand
                               SHLD reg/mem,reg,CL

Ovlivåuje pý¡znaky:            CF   je   nastaven   na  hodnotu  posledn¡ho
                               vysouvan‚ho  bitu  OF je  nastaven  jestli§e
                               posunut¡ posledn¡ho bitu zp…sobilo pýeteŸen¡
                               SF,ZF  a PF  jsou  nastaveny  podle  hodnoty
                               vìsledku





                                  - 123 - 




Nedefinovan‚ pý¡znaky:         AF

Vìjimky v PM:                  § dn‚

Vìjimky v RM:                  § dn‚

Pý¡klad:                       SHLD AX,BL,0AH ; 0AH = bezprostýedn¡ operand
                               SHRD AL,BL,CL ; CL = poŸet posuv…

XBTS
---------------------------------------------------------------------------

Instrukce:                     Extrahuj bitovì ýetØzec

¬asov n¡:                      6-13

Popis:                         Instrukce XBTS extrahuje  bitovì  ýetØzec, a
                               tento ýetØzec je ulo§en zarovnanì  doprava a
                               rozç¡ýenì (t.j. s  horn¡mi  bity nastavenìmi
                               do nuly) ve specifikovan‚m registru.
                               Instrukce XBTS m  4 operandy; b zovou adresu
                               bitov‚ho  ýetØzce,  bitovì   offset  zaŸ tku
                               podýetØzce,  jen§  m   bìt extrahov n, d‚lku
                               extrahovan‚ho podýetØzce a  registr,  kam m 
                               bìt extrahovanì  podýetØzec  um¡stØn. B zov 
                               adresa  m…§e bìt um¡stØna v registru nebo  v
                               pamØœov‚m  operandu.  Offset  je  ulo§en   v
                               registru   EAX   (resp.   AX  u  16-bitovìch
                               operand…).  D‚lka  pole  je  d na   hodnotou
                               registru   CL.   Posledn¡   pole   instrukce
                               specifikuje    vçeobecnì   registr,    kterì
                               obsahuje extrahovanou hodnotu.

Syntaxe:                       XBTS dest,base,offset,length
                               XBTS reg,reg/mem,(E)AX,CL

Ovlivåuje pý¡znaky:            OF, SF, AF, ZF, PF


Nedefinovan‚ pý¡znaky:         CF

Vìjimky v PM:                  Jestli§e   operand   nem…§e   bìt  pou§it  v
                               instrukci  kv…li  poruçen¡  limitu  segmentu
                               nebo  poruçen¡  pý¡stupovìch  pr v,  pak  je
                               generov na vìjimka 13.

Vìjimky v RM:                  Jestli§e  operand  le§¡  mimo limit segmentu
                               (0FFFFH),  je  generov na  vçeobecn  vìjimka
                               poruçen¡ ochrany pamØti.

Pý¡klad:                       XBTS AX,BX,AX,CL








                                  - 124 - 










                            K a p i t o l a   9

                      Pý¡klady program… v assembleru


1. SeŸ¡t n¡ - pou§it¡ bezprostýedn¡ho adresov n¡

               ; Pro 80286/80386
               ; Ilustrace jednoduch‚ho hexadecim ln¡ho seŸ¡t n¡
               ; BEZPROSTüEDNÖ ADRESOVµNÖ

stack          segment para stack
               db 64 dup ("MYSTACK") ; z sobn¡k o 100h slovech
stack          ends

mycode         segment para "code"      ; definuj segment k¢du
myproc         proc far                 ; procedura jm‚nem MYPROC
               assume cs:mycode,ss:stack

               push  ds                 ; uschovej datovì segment
               sub   ax,ax              ; nula do ax
               push  ax                 ; uschovej do z sobn¡ku

               ; nasleduje k¢d vlastniho programu -
               mov   al,12h             ; prvn¡ operand = NUM1
               add   al,18h             ; pýiŸti druhì operand
               add   al,30h             ; pýiŸti týet¡ operand

               ; konec seŸ¡t n¡ - vìsledek je v AL
               mov   ah,4Ch             ; n vrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc         endp                     ; konec procedury MYPROC
mycode         ends                     ; konec segmentu k¢du


   Jako prvn¡ je v naçem pý¡kladØ definov n z sobn¡k:  je  inicializov n 64
slovy  "MYSTACK",  co§  m…§e  usnadnit  ladØn¡  naçeho  programu. N sleduj¡
segment je k¢dovì -  je  nazv n "mycode" a vçeobecnØ mus¡ obsahovat alespoå
jednu  proceduru - tou je u n s procedura  "MYPROC".  Procedura  seŸte  týi
hexadecim ln¡ Ÿ¡sla a pomoc¡ int 21 pýed  ý¡zen¡ DOSu. V  naçem jednoduch‚m
pý¡kladØ  nen¡  v…bec  pou§it  datovì  segment  -  program s  § dnìmi  daty
ulo§enìmi v datov‚m segmentu nepracuje.

2. SeŸ¡t n¡ - pou§it¡ pý¡m‚ho adresov n¡

               ; Pro 80286/80386
               ; Ilustrace jednoduch‚ho hexadecim ln¡ho seŸ¡t n¡
               ; PüÖM ADRESOVµNÖ




                                  - 125 - 




stack          segment para stack
               db 64 dup ("MYSTACK")    ; z sobn¡k o 100h slovech
stack          ends

mydata         segment para "data"      ; datovì segment MYDATA
               NUM1  dw 1234h           ; prvn¡ slovn¡ operand
               NUM2  dw 24h             ; druhì slovn¡ operand
               NUM3  dw 0ABCh           ; týet¡ slovn¡ operand
               ANS   dw ?               ; slovo pro vìsledek
mydata         ends                     ; konec segmentu dat

mycode         segment para "code"      ; definuj segment k¢du
myproc         proc far                 ; procedura jm‚nem MYPROC
               assume cs:mycode,ss:stack
               push  ds                 ; uschovej datovì segment
               sub   ax,ax              ; nula do ax
               push  ax                 ; uschovej ax
               mov   ax,mydata          ; datovì segment do AX
               mov   ds,ax              ; nastav hodnotu DS

               ; nasleduje k¢d vlastniho programu -
               mov   ax,NUM1            ; prvn¡ operand = NUM1
               add   ax,NUM2            ; pýiŸti NUM2
               add   ax,NUM3            ; pýiŸti NUM3
               mov   ANS,ax             ; ulo§ vìsledek do ANS

               ; konec seŸ¡t n¡ - vìsledek je v promØnn‚ ANS
               mov   ah,4Ch             ; n vrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc         endp                     ; konec procedury myproc
mycode         ends                     ; konec segmentu k¢du


 V  tomto  pý¡kladØ  je pou§it pro um¡stØn¡ operand… datovì segment MYDATA,
zaŸ¡naj¡c¡ v pamØti na hranici  paragrafu (t.j. na adrese dØliteln‚ 16-ti).
KromØ  operand…  seŸ¡t n¡  je v segmentu  MYDATA  definov no  i  slovo  pro
vìsledek (ANS, symbol "?" znamen , §e slovo nen¡ inicializov no).

3. SeŸ¡t n¡ ve dvojit‚ pýesnosti - indexov‚ adresov n¡

               ; Pro 80286/80386
               ; Ilustrace hexadecim ln¡ho seŸ¡t n¡ ve dvojit‚ pýesnosti
               ; INDEXOV ADRESOVµNÖ

stack          segment para stack
               db 64 dup ("MYSTACK")    ; z sobn¡k o 100h slovech
stack          ends

mydata         segment para "data"      ; datovì segment MYDATA
TABLE          dw 1234h,5678h,9ABCh,0DEF0h,1111h,2222h,3333h
               dw 4444h,5555h,6666h,7777h,8888h,9999h,0AAAAh
               dw 0BBBBh,0CCCCh,0DDDDh,0EEEEh,0FFFFh
LSBANS         dw ?                     ; ni§ç¡ byty vìsledku
MSBANS         dw ?                     ; vyçç¡ byty vìsledku
mydata         ends



                                  - 126 - 




; ----------- konec segmentu dat mydata ------------

segment        para "code"              ; definuj segment k¢du
myproc         proc far                 ; procedura jm‚nem MYPROC
               assume cs:mycode,ss:stack
               push  ds                 ; uschovej datovì segment
               sub   ax,ax              ; nula do ax
               push  ax                 ; uschovej ax
               mov   ax,mydata          ; datovì segment do ax
               mov   ds,ax              ; nastav hodnotu ds
;----------- nasleduje k¢d vlastniho programu -------
               mov   si,0h              ; index=0 (1.prvek tabulky)
               mov   ax,TABLE[si]       ; vezmi prvn¡ Ÿ¡slo
               mov   cx,09h             ; devØt seŸ¡t n¡
again:         add   si,02h             ; dalç¡ slovo v TABLE
               add   ax,TABLE[si]       ; pýiŸti jej
               adc   dx,0h              ; pýiŸti pý¡p. pýenos k dx
               loop again               ; dalç¡ pýiŸten¡ pýi cx<>0
               mov LSBANS,ax            ; hotovo-pýesun vìsledku
               mov MSBANS,dx            ; i Ÿ sti MSB
; ---- konec seŸ¡t n¡ - vìsledek je v MSBANS a LSBANS -----
               mov ah,4Ch               ; n vrat do DOSu
               int 21h                  ; s ERRORLEVEL 0
               ret
myproc         endp                     ; konec procedury myproc
mycode         ends                     ; konec segmentu k¢du


4. Pou§it¡ pý¡kazu DAA pýi seŸ¡t n¡ - registrov‚ nepý¡m‚
               adresov n¡

               ; Pro 80286/80386
               ; Ilustrace pou§it¡ DAA pýi seŸ¡t n¡
               ; REGISTROV NEPüÖM ADRESOVµNÖ

stack          segment para stack
               db 64 dup ("MYSTACK")    ; z sobn¡k o 100h slovech
stack          ends

mydata s       egment para "data" ; datovì segment MYDATA
INFO           db 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
ANS            db ?                     ; vìsledek
mydata         ends                     ; konec segmentu dat mydata

segment        para "code"              ; definuj segment k¢du
myproc         proc  far                ; procedura jm‚nem MYPROC
               assume cs:mycode,ss:stack
               push  ds                 ; uschovej datovì segment
               sub   ax,ax              ; nula do ax
               push  ax                 ; uschovej ax
               mov   ax,mydata          ; datovì segment do ax
               mov   ds,ax              ; nastav hodnotu ds
; nasleduje k¢d vlastniho programu -
               lea   bx,info            ; z¡skej adresu (offset)
               mov   cx,10              ; 10 seŸ¡t n¡
               mov   al,INFO            ; 1. Ÿ¡slo z INFO do AL



                                  - 127 - 




again:         add   bx,01h             ; dalç¡ Ÿ¡slo z INFO
               add   al,info[bx]        ; pýiŸti jej k al
               daa                      ; pýichystej AL
               loop  again              ; dalç¡ seŸ¡t n¡
               mov   ANS,al             ; vìsledek do ANS
; konec seŸ¡t n¡ - vìsledek je v ANS
               mov   ah,4Ch             ; n vrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc         endp                     ; konec procedury myproc
mycode         ends                     ; konec segmentu k¢du


5. Pý¡klad 32-bitov‚ho seŸ¡t n¡ u 80386

stack          segment para "stack"
               db 64 dup("MYSTACK")
stack          ends

mydata         segment para "data"
NUMS           DD 12345678h,9ABCDEF0h,23h,10000000h,0CADh
ANSWER         DD ?
mydata         ends

mycode         segment para "code"
myproc         proc far
               assume cs:mycode,ds:mydata,ss:stack
               push  ds
               sub   ax,ax
               push  ax
               mov   ax,mydata
               mov   ds,ax
; k¢d pro 32-bitov‚ seŸ¡t n¡
               lea   bx,NUMS            ; offset NUMS do BX
               mov   eax,[bx]           ; prvn¡ 32-bitov‚ Ÿ¡slo do EAX
               add   eax,[bx]+4         ; pýiŸti druh‚
               add   eax,[bx]+8         ; a týet¡
               mov   ANSWER,eax         ; vìsledek bude v ANSWER
               mov   ah,4Ch             ; n vrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc endp
mycode ends
               end


6.Pý¡klad jednoduch‚ho 32-bitov‚ho n soben¡


stack          segment para "stack"
               db 64 dup("MYSTACK")
stack          ends

mydata         segment para "data"
NUM1           DD 12345678h
NUM2           DD 9ABCDEF0h



                                  - 128 - 




               ANSWER DD ?
mydata ends

mycode         segment para "code"
myproc         proc  far
               assume cs:mycode,ds:mydata,ss:stack
               push ds
               sub   ax,ax
               push  ax
               mov   ax,mydata
               mov   ds,ax
; k¢d pro 32-bitov‚ n soben¡
               mov   eax,NUM1           ; prvn¡ 32-bitov‚ Ÿ¡slo do EAX
               mul   eax,NUM2           ; vyn sob druhìm Ÿ¡slem
               mov   dword ptr ANSWER,eax ;ni§ç¡ch 32 bit… vìsledku
               mov   dword ptr ANSWER,edx ;vyçç¡ch 32 bit… vìsledku
               mov   ah,4Ch             ; n vrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc endp
mycode ends
               end

   Vìsledek  n soben¡  je  v registrech EAX a EDX. Pou§it¡m oper toru DWORD
PTR je 32-bitovì obsah ka§d‚ho registru spr vnØ um¡stØn do Ÿtyýslova ANSWER
v datov‚m segmentu.

































                                  - 129 - 































































                                  - 130 - 










                                 Dodatek A

                  Re lnì a privilegovanì m¢d 80286(80386)


   Jak ji§ bylo naznaŸeno v  kapitole 6., jsou obsahy segmentovìch registr…
interpretov ny r…znØ v z vislosti na tom, zda 80286/80386 pracuje v re ln‚m
nebo v privilegovan‚m m¢du. Speci lnØ u obvodu 80286

 - v re ln‚m m¢du  (real  address mode) generuje 80286 20-ti bitovou adresu
pamØœov‚ lokace podle n sleduj¡cho vztahu
   ADRESA=(16xSELEKTOR) + OFFSET
kde  SELEKTOR  je  obsah  pý¡sluçn‚ho  segmentov‚ho  registru  a OFFSET  je
posunut¡ referovan‚ho pamØœov‚ho m¡sta vzhledem k zaŸ tku segmentu.

 - ve  virtu ln¡m  (privilegovan‚m)  m¢du  (virtual  address  mode) pracuje
procesor s virtu ln¡ adresou,  kterou  mapuje  do 24-bitov‚ fyzick‚ adresy,
vys¡lan‚ na adresovou sbØrnici. V tomto m¢du jsou vçechny pý¡stupy k pamØti
kontrolov ny na opr vnØnost.  Pý¡stup  k pamØœov‚ lokaci je tedy provØýov n
vzhledem  k  tzv.  privilegovan‚   £rovni,   co§   je   dvoubitov   hodnota
reprezentuj¡c¡ relativn¡ £roveå pý¡stupov‚ho  opr vnØn¡  k  pamØti  (00b je
maxim ln¡, 11b je minim ln¡ £roveå)
   Obsahem segmentov‚ho registru je tedy v§dy selektor; struktura selektoru
je n sleduj¡c¡:


         (MSB)                       (LSB)
 ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿
 ³                I  N D E X            ³TI³ RPL ³
 ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÙ
 15                                              0



RPL =             po§adovan   privilegovan   £roveå  (1  a§  3)  (requested
                  privilege level)

TI =              indikace tabulky deskriptor…

0 =               tabulka GDT (Global Descriptor Table)

1 =               tabulka LDT (Local Descriptor Table )

INDEX =           ukazatel do tabulky deskriptor…

Tabulka deskriptor…

   Tabulka deskriptor… (LDT nebo GDT ve virtu ln¡ pamØti,  resp.  fyzick  v
pamØti  na  Ÿipu  80286) je slo§ena ze 48- bitovìch polo§ek. Na £rovni Ÿipu
80286 je programovØ nepý¡stupn . Jej¡ struktura je n sleduj¡c¡



                                  - 131 - 




 47    40 39                   16 15             0
 ÚÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿ÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿ÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿
 ³  ARB  ³      BASE ADDRESS     ³     LIMIT     ³  CS
 ÀÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙ
 ÚÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿ÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿ÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿
 ³  ARB  ³      BASE ADDRESS     ³     LIMIT     ³  DS
 ÀÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙ
 ÚÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿ÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿ÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿
 ³  ARB  ³      BASE ADDRESS     ³     LIMIT     ³  SS
 ÀÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙ
 ÚÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿ÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿ÂÂÂÂÂÂÂÚÂÂÂÂÂÂÂ¿
 ³  ARB  ³      BASE ADDRESS     ³     LIMIT     ³  ES
 ÀÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙÁÁÁÁÁÁÁÙ

nn Ka§d   adresa b ze segmentu je 24-bitov  (t.j. pro adresaci 0 - 16 MB ).
Hovoý¡me-li tedy o segmentov‚m registru, je pod t¡mto  pojmem  týeba ch pat
jak jeho programovØ  pý¡stupnou  Ÿ st  -  selektor -, tak i Ÿ st programovØ
nepý¡stupnou -  deskriptor. ¬ip 80286 tedy z dvojice SEGMENT:OFFSET vytvoý¡
fyzickou adresu ve dvou kroc¡ch:
1.  selektor  urŸ¡  index do tabulky  deskriptor…  a  je  z¡sk n  pý¡sluçnì
deskriptor, t.j. adresa zaŸ tku segmentu ve fyzick‚ pamØti
2.  tato  adresa  je seŸtena s 16-bitovìm offsetem, co§ poskytne 24-bitovou
adresu jednoznaŸnØ urŸuj¡c¡ pamØœov‚ m¡sto ve fyzick‚m pamØœov‚m prostoru
   Popsanì vìpoŸet fyzick‚  adresy  je automatickou z le§itost¡ CPU 80286 -
program tor na £rovni  assembleru  je jen povinen naplnit ý dnìmi hodnotami
segmentov‚ registry a urŸit offset v segmentu.



Literatura

   [1] Murray W.H.,Pappas C.H. : 80286/80386 Assembly
   Language Programming, Osborne McGraw-Hill, 1986
   [2] 80286 Assembly Language Reference Manual, Operating
   Systems and Languages Library,Olivetti, 1986



                                  - 132 - 


                                                             konec ASM.HLP
**************************************************************************

**************************************************************************
ASM.HLP                                                            ASM.HLP


                                Obsah


     Kapitola 1  Úvod do programovacího jazyka assembler             5
        Hlavní výhoda - rychlost a pøímé øízení  . . . . . . . . . . 6
        Rodina mikroprocesorù 80286/80386  . . . . . . . . . . . . . 7
        Co budete schopni zvládnout ihned po pøeètení této knihy . . 8
        Co tato kniha pøedpokládá o vás  . . . . . . . . . . . . . . 8

     Kapitola 2  Èíselné soustavy                                    9
        Binární èísla  . . . . . . . . . . . . . . . . . . . . . . . 9
        Binární seèítání a odeèítání . . . . . . . . . . . . . . .  11
        Datový typ BYTE  . . . . . . . . . . . . . . . . . . . . .  12
        Datový typ CHARACTER . . . . . . . . . . . . . . . . . . .  12
        Èísla se znaménkem . . . . . . . . . . . . . . . . . . . .  13
        Dvojkový doplnìk (two's complement)  . . . . . . . . . . .  14
        Rozšíøení znaménkového bitu  . . . . . . . . . . . . . . .  15
        Hexadecimální èísla  . . . . . . . . . . . . . . . . . . .  16
        Slova (words)  . . . . . . . . . . . . . . . . . . . . . .  17
        Dvouslova (doublewords)  . . . . . . . . . . . . . . . . .  18
        Nestandardní pole bitù . . . . . . . . . . . . . . . . . .  19
        Binární operace  . . . . . . . . . . . . . . . . . . . . .  20

     Kapitola 3  Adresovací techniky                                23
        Bezprostøední adresování . . . . . . . . . . . . . . . . .  23
        Registrové adresování  . . . . . . . . . . . . . . . . . .  24
        Pøímé adresování . . . . . . . . . . . . . . . . . . . . .  24
        Registrové nepøímé adresování  . . . . . . . . . . . . . .  25
        Bázové relativní adresování  . . . . . . . . . . . . . . .  26
        Pøímé indexové adresování  . . . . . . . . . . . . . . . .  27
        Bázové indexové adresování . . . . . . . . . . . . . . . .  27
        Extenze u 80386  . . . . . . . . . . . . . . . . . . . . .  28

     Kapitola 4  Programovací styl                                  29
              Pole jména (návìští) . . . . . . . . . . . . . . . .  29

     Kapitola 5  Úvod do assembleru                                 35
        Strojový kód versus jazyk symbolických instrukcí . . . . .  36
        Typický proces pøi výstavbì programù v assembleru  . . . .  37
        Programová režie . . . . . . . . . . . . . . . . . . . . .  39

     Kapitola 6  ARCHITEKTURA : REGISTRY, PØÍZNAKY A INSTRUKCE      43
        Mikroprocesor 80286  . . . . . . . . . . . . . . . . . . .  43
        Základní architektura  . . . . . . . . . . . . . . . . . .  43
        Segmentové registry  . . . . . . . . . . . . . . . . . . .  44
        Indexové a bázové registry. Registry ukazatele . . . . . .  44
        Øídicí registry a registry stavu (FLAGS) . . . . . . . . .  45
        Registr adresy instrukce (instruction pointer) . . . . . .  46
        Stavové slovo procesoru (machine status word ) . . . . . .  46



                                     i 




        Mikroprocesor 80386  . . . . . . . . . . . . . . . . . . .  46
        Datové typy 80386  . . . . . . . . . . . . . . . . . . . .  47
        Adresování operandù u 80386  . . . . . . . . . . . . . . .  47
        Výpoèet efektivní adresy u 80386 . . . . . . . . . . . . .  47
        Provádìní kódu mikroprocesoru 8086 na 80386  . . . . . . .  47
        Základní architektura èipu 80386 . . . . . . . . . . . . .  48
        Soubor všeobecných registrù  . . . . . . . . . . . . . . .  48
        Segmentové registry  . . . . . . . . . . . . . . . . . . .  48
        Registr adresy instrukce a EFLAGS  . . . . . . . . . . . .  49
        Øídicí registry  . . . . . . . . . . . . . . . . . . . . .  49
        Registry systémových adres . . . . . . . . . . . . . . . .  50
        Ladicí a trasovací registry  . . . . . . . . . . . . . . .  50
        Zpracování výjimeèných stavù u 80286/80386 . . . . . . . .  50

     Kapitola 7  Instrukèní soubor mikroprocesorù 80286/80386       53
           AAA (80286/80386) . . . . . . . . . . . . . . . . . . .  53
           AAD (80286/80386) . . . . . . . . . . . . . . . . . . .  53
           AAM (80286/80386) . . . . . . . . . . . . . . . . . . .  54
           AAS (80286/80386) . . . . . . . . . . . . . . . . . . .  55
           ADC (80286/80386) . . . . . . . . . . . . . . . . . . .  55
           ADD (80286/80386) . . . . . . . . . . . . . . . . . . .  56
           AND (80286/80386) . . . . . . . . . . . . . . . . . . .  57
           ARPL (80286/80386)  . . . . . . . . . . . . . . . . . .  58
           BOUND (80286/80386) . . . . . . . . . . . . . . . . . .  59
           CALL (80286/80386)  . . . . . . . . . . . . . . . . . .  59
           CBW (80286/80386) . . . . . . . . . . . . . . . . . . .  61
           CLC (80286/80386) . . . . . . . . . . . . . . . . . . .  61
           CLD (80286/80386) . . . . . . . . . . . . . . . . . . .  62
           CLI (80286/80386) . . . . . . . . . . . . . . . . . . .  62
           CLTS (80286/80386)  . . . . . . . . . . . . . . . . . .  63
           CMC (80286/80386) . . . . . . . . . . . . . . . . . . .  63
           CMP (80286/80386) . . . . . . . . . . . . . . . . . . .  64
           CMPS/CMPSB/CMPSW (80286/80386)  . . . . . . . . . . . .  65
           CWD (80286/80386) . . . . . . . . . . . . . . . . . . .  66
           DAA (80286/80386) . . . . . . . . . . . . . . . . . . .  66
           DAS (80286/80386) . . . . . . . . . . . . . . . . . . .  67
           DEC (80286/80386) . . . . . . . . . . . . . . . . . . .  68
           DIV (80286/80386) . . . . . . . . . . . . . . . . . . .  68
           ENTER (80286/80386) . . . . . . . . . . . . . . . . . .  69
           HLT (80286/80386) . . . . . . . . . . . . . . . . . . .  70
           IDIV (80286/80386)  . . . . . . . . . . . . . . . . . .  71
           IMUL (80286/80386)  . . . . . . . . . . . . . . . . . .  72
           IN (80286/80386)  . . . . . . . . . . . . . . . . . . .  73
           INC (80286/80386) . . . . . . . . . . . . . . . . . . .  74
           INS/INSB/INSW (80286/80386) . . . . . . . . . . . . . .  74
           INT/INTO (80286/80386)  . . . . . . . . . . . . . . . .  76
           IRET (80286/80386)  . . . . . . . . . . . . . . . . . .  77
           J(podmínka) (80286/80386) . . . . . . . . . . . . . . .  77
           JMP (80286/80386) . . . . . . . . . . . . . . . . . . .  79
           LAHF (80286/80386)  . . . . . . . . . . . . . . . . . .  80
           LAR (80286/80386) . . . . . . . . . . . . . . . . . . .  81
           LSS/LFS/LGS (80386), LDS/LES (80286/80386)  . . . . . .  81
           LEA (80286/80386) . . . . . . . . . . . . . . . . . . .  82
           LEAVE (80286/80386) . . . . . . . . . . . . . . . . . .  83
           LGDT/LIDT (80286/80386) . . . . . . . . . . . . . . . .  83
           LLDT (80286/80386)  . . . . . . . . . . . . . . . . . .  84



                                    ii 




           LMSW (80286/80386)  . . . . . . . . . . . . . . . . . .  85
           LOCK (80386)  . . . . . . . . . . . . . . . . . . . . .  86
           LODS/LODSW/LODSB (80286/80386)  . . . . . . . . . . . .  87
           LOOP (80286/80386)  . . . . . . . . . . . . . . . . . .  87
           LSL (80286/80386) . . . . . . . . . . . . . . . . . . .  88
           LTR (80286/80386) . . . . . . . . . . . . . . . . . . .  89
           MOV (80286/80386) . . . . . . . . . . . . . . . . . . .  90
           MOVS/MOVSB/MOVSW (80286/80386)  . . . . . . . . . . . .  91
           MOVZX/MOVSX (80286/80386) . . . . . . . . . . . . . . .  92
           MUL (80286/80386) . . . . . . . . . . . . . . . . . . .  92
           NEG (80286/80386) . . . . . . . . . . . . . . . . . . .  93
           NOP (80286/80386) . . . . . . . . . . . . . . . . . . .  94
           NOT (80286/80386) . . . . . . . . . . . . . . . . . . .  95
           OR (80286/80386)  . . . . . . . . . . . . . . . . . . .  95
           OUT (80286/80386) . . . . . . . . . . . . . . . . . . .  96
           OUTS/OUTSB/OUTSW (80286/80386)  . . . . . . . . . . . .  96
           POP (80286/80386) . . . . . . . . . . . . . . . . . . .  97
           POPA (80286/80386)  . . . . . . . . . . . . . . . . . .  98
           POPF (80286/80386)  . . . . . . . . . . . . . . . . . .  99
           PUSH (80286/80386)  . . . . . . . . . . . . . . . . . . 100
           PUSHA (80286/80386) . . . . . . . . . . . . . . . . . . 100
           PUSHF (80286/80386) . . . . . . . . . . . . . . . . . . 101
           RCL/RCR/ROL/ROR (80286/80386) . . . . . . . . . . . . . 102
           REP/REPZ/REPE/PEPNE/REPNZ (80286/80386) . . . . . . . . 103
           RET (80286/80386) . . . . . . . . . . . . . . . . . . . 104
           SAHF (80286/80386)  . . . . . . . . . . . . . . . . . . 105
           SAL/SAR/SHL/SHR (80286/80386) . . . . . . . . . . . . . 105
           SBB (80286/80386) . . . . . . . . . . . . . . . . . . . 107
           SCAS/SCASB/SCASW (80286/80386)  . . . . . . . . . . . . 107
           SGDT/SIDT (80286/80386) . . . . . . . . . . . . . . . . 108
           SLDT (80286/80386)  . . . . . . . . . . . . . . . . . . 109
           SMSW (80286/80386)  . . . . . . . . . . . . . . . . . . 109
           STC (80286/80386) . . . . . . . . . . . . . . . . . . . 110
           STD (80286/80386) . . . . . . . . . . . . . . . . . . . 110
           STI (80286/80386) . . . . . . . . . . . . . . . . . . . 111
           STOS/STOSB/STOSW (80286/80386)  . . . . . . . . . . . . 111
           STR (80286/80386) . . . . . . . . . . . . . . . . . . . 112
           SUB (80286/80386) . . . . . . . . . . . . . . . . . . . 113
           TEST (80286/80386)  . . . . . . . . . . . . . . . . . . 114
           VERR/VERW (80286/80386) . . . . . . . . . . . . . . . . 114
           WAIT (80286/80386)  . . . . . . . . . . . . . . . . . . 115
           XCHG (80286/80386)  . . . . . . . . . . . . . . . . . . 115
           XLAT (80286/80386)  . . . . . . . . . . . . . . . . . . 116
           XOR (80286/80386) . . . . . . . . . . . . . . . . . . . 117

     Kapitola 8  Speciální instrukce 80386                         119
           IBTS  . . . . . . . . . . . . . . . . . . . . . . . . . 119
           MOV CRn . . . . . . . . . . . . . . . . . . . . . . . . 119
           MOV DRn . . . . . . . . . . . . . . . . . . . . . . . . 120
           MOV TRn . . . . . . . . . . . . . . . . . . . . . . . . 121
           SETcond.  . . . . . . . . . . . . . . . . . . . . . . . 121
           SHLD/SHRD . . . . . . . . . . . . . . . . . . . . . . . 123
           XBTS  . . . . . . . . . . . . . . . . . . . . . . . . . 124






                                    iii 




     Kapitola 9  Pøíklady programù v assembleru                    125

     Appendix A  Reálný a privilegovaný mód 80286(80386)           131
              Literatura . . . . . . . . . . . . . . . . . . . . . 132



konec OBSAHU                                                       ASM.HLP
**************************************************************************


                               Obrázky


     Figure 2.1: Bity a byty jednoho slova . . . . . . . . . . . . .18
     Figure 3.1: Pøímé adresování  . . . . . . . . . . . . . . . . .25
     Figure 3.2: Nepøímé registrové adresování . . . . . . . . . . .25
     Figure 3.3: Bázové relativní adresování . . . . . . . . . . . .26
     Figure 3.4: Bázové indexové adresování  . . . . . . . . . . . .28


**************************************************************************

                               Tabulky


     Table 2.1: Dekadická, binární a hexadecimální reprezentace
                èísel  . . . . . . . . . . . . . . . . . . . . . . .16
     Table 6.1: Výjimky v privilegovaném módu 80286  . . . . . . . .51



                                    vii 

**************************************************************************




                           ASSEMBLER 80286/80386
 


                                   - 2 - 



                                   Úvod



   Tato pøíruèka je koncipována tak, aby splnila tøi cíle:

   1.  uvést Vás do svìta mocného programování  v  assembleru využívajícího
       mikroprocesor 80386/80286

   2.  nauèit  Vás,  jak  psát  jednoduché  a  souèasnì  mocné  programy  v
       assembleru, a

   3.  posloužit jako referenèní  pøíruèka  jak  souboru  instrukcí,  tak i
       ukázkových programù


   Assembler  80386/80286  je  velice   mocnou   extenzí   starších  jazykù
strojových instrukcí, zejména assemblerù rodiny poèítaèù 8088/8086. Je to v
prvé  øadì  dùsledek  toho, že všichni  èlenové  rodiny  INTEL  80xxx  jsou
kompatibilní  zdola  nahoru.  Základní instrukce a rysy  jazyka  jsou  tedy
spoleèné prvním mikroprocesorùm  i  této poslední sérii. Budoucí verze DOSu
poskytnou možnosti  pøístupu i k "vyšším" vlastnostem programování, jako je
napø. programování v chránìném režimu  (protected mode): to ovšem povede ke
zvìtšení rozdílù mezi staršími a novìjšími verzemi assemblerù.

   Assembler  je mocný jazyk poskytující programátorovi absolutní  kontrolu
nad poèítaèem. Jazyky vyšší úrovnì (jako je PASCAL, Ada,  FORTRAN  a  jiné)
ponechávají programátora  zcela  na  pospas  libovùli  autorù  kompilátoru.
Jestliže autor uživatelského programu použije  napø.  adaptér  na  hry jako
zaøízení, k nìmuž se jeho program obrací, pak je vše v  poøádku, kompilátor
s tím "poèítá". Pokud ale nevyužijete tìchto nabízených možností, co  pak ?
V  assembleru mùžete psát své vlastní  uživatelské  programy  nebo  dokonce
využívat velice efektivních služeb  BIOSu,  které  poskytuje  pøímo výrobce
poèítaèe. V podstatì je velká vìtšina programù psaných v assembleru užívána
coby záplaty (patches) na vyšší programovací jazyky : tyto záplaty se snaží
dodefinovat ve  vyšším programovacím jazyku to, co autoøi kompilátoru možná
pøehlédli.

   Tato  kniha  vysvìtluje  programování  na  pøíkladech  -  na kompletních
pøíkladech : s každým programem je k dispozici listing se  všemi nezbytnými
poznámkami. Jinými slovy -  jestliže  zapíšete program pøesnì tak, jak je v
tomto manuálu uveden, urèitì správnì pobìží. Nenaleznete zde žádné zkrácené
pøíklady nebo èásteèné výpisy,  které  by  mìly  ušetøit místo. Našim cílem
bylo u každého pøíkladu vysvìtlit a dokumentovat jej tak, aby usnadnil vaše
studium jednotlivých  instrukcí a programovacího stylu, a již jste nováèek
nebo zkušený programátor.





                                   - 3 - 



                                   - 4 - 




                            K a p i t o l a   1

                  Úvod do programovacího jazyka assembler


   Studium programovacího jazyka nejnižší  úrovnì  -  assembleru - mùže být
jedním z  nejvdìènìjších  a  technicky  nejinspirativnìjších  èinností,  ke
kterým se softwareový specialista odhodlá. Jakmile máte  pøíslušné nástroje
a  víte,  jak  zkombinovat  vyšší   programovací   jazyk   s  nejrùznìjšími
hardwareovými konfiguracemi  vašeho  poèítaèe,  jste  opravdu  pánem  svého
stroje. Subtilní ovládání periferií a správa pamìti,  efektivnost programù,
rychlost  a  ochrana  dat  -  to  vše  èeká  na  programátora  tvoøícího  v
assembleru. Nicménì zvládnutí assembleru vyžaduje  zkušenosti  a  smysl pro
detaily.

   I když jste zainteresován ve specializované oblasti  vývoje programového
vybavení,  assembler  se   stane  vaším  druhým  nejmocnìjším  vyjadøovacím
jazykem.   Protože  assembler  umožòuje  programátorovi  pøímý  pøístup   k
registrùm, pamìti a jedineènému svìtu bitovì orientovaných instrukcí, èasto
pøedstavuje jedinou možnost øešit softwareové  problémy  ležící  mimo dosah
prostøedkù vyššího programovacího jazyka.

   Program v asembleru bude  produkovat  nejrychleji  interpretovaný cílový
program, protože obchází  použití kompilátoru vyššího programovacího jazyka
(PASCAL, PL/I, C apod.). Tato výhodná rychlost ovšem není zadarmo.

   Programátoøi v assembleru musí vìnovat svou pozornost  detailùm. Program
v assembleru øídí mikroprocesor v jeho "vlastním" jazyce, bez kompilátorù a
jeho kontrolních prostøedkù.  Výsledkem tìchto velice elementárních operací
vykonávaných na úrovni  assembleru  je  to,  že  jedna  stránka  programu v
assembleru je témìø nesrovnatelná s  esoterickou  sofistikou  jedné stránky
programu  ve  vyšším  programovacím jazyce. Z tohoto  dùvodu  není  vìtšina
vìtších programù psána  v  assembleru. ( Výjimkou jsou softwareové projekty
financované vìtšími spoleènostmi,  které  jsou  ochotné  platit  znaèný èas
nutný k napsání extrémnì rychlého a efektivního aplikaèního programu).

   Jestliže  "hovoøíme"  strojovým jazykem, vyžaduje  to  porozumìní  mnoha
konceptùm zcela cizím vyšším programovacím  jazykùm.  Programátor  v jazyce
assembler musí  uvažovat segmentaci pamìti. Tam, kde používá pøímého øízení
pøístupu k  operaèní pamìti, je tøeba provádìt velice delikátní rozhodnutí.
Kde by mìla být uchována data programu a kde program samotný ? Je zapotøebí
zásobníku ? Jesliže ano, v jaké èásti pamìti by mìl  být  umístìn ? Peèlivá
rozhodnutí se týkají také alokace  pamìti pro jednotlivá data (byty, slova,
dvouslova atp.) i typu techto  dat (øetìzce, statické a dynamické promìnné,
data v pevné a pohyblivé øádové èárce atp.). Stejnì detailní  rozhodnutí se
týkají  dat  zpracovávaných koprocesory 80287/80387,  pøístupu  k  obrazové
pamìti monitorù, k tiskárnám apod. Mnohé z uvedených aspektù jsou jedineèné
právì pøi vytváøení programù v assembleru.





                                   - 5 - 




---------------------------------------------------------------------------
Hlavní výhoda - rychlost a pøímé øízení
---------------------------------------------------------------------------


   Jednou  z hlavních výhod assembleru je skvìlá  rychlost,  s  jakou  jsou
programy  vykonávány.  Program  v  assembleru  je  jen  symbolickým obrazem
výsledného strojového  kódu  -  lze  øíci,  že  program ve strojovém kódu a
assemblerovský   program  jsou  isomorfní  systémy.  Instrukce  na   úrovni
strojového kódu jsou pak vykonávány v mikrosekundových èasech.

   Interprety, jako napø.  interprety  BASICu  èi  APL,  analyzují zdrojový
program  a  provádìjí  -  øádek  po  øádku  -  translaci do strojového kódu
poèítaèe,   volajíce  pøitom  celou  øadu  vestavìných  podprogramù.   Tyto
podprogramy  byly   pøedem   napsány   a   predestinovány   pro   konkrétní
mikroprocesor.   Protože  je  bìhem  vykonávání  programu  nezbytné   znovu
vyèíslovat  výrazy  a  provádìt  ošetøování  chyb,  je  vykonávání takového
programu velice pomalé.

   Kompilátory, jako napø. kompilátory PASCALu,  PL/I  nebo  FORTRANu, ètou
zdrojový program  a transformují jej do sekvence operaèních kódù (pøesnìji:
instrukcí), které mikroprocesor  bude vykonávat pøímo. Kompilované programy
jsou tedy rychlejší než interpretovaný zdrojový program, protože pøeklad je
provádìn jen jednou.

   Kompilované programy však mají jednu nevýhodu: kompilátor musí zajistit,
že  zkompilovaný  program  bude  provádìt  znaèné  množství  operací 'vyšší
úrovnì' -  napø. spolupracovat s periferiemi, systémem souborù atp. Zmínìné
operace  zpùsobují,  že  kompilovaný program je èasto znaènì rozsáhlý i pøi
nevelkém zdrojovém programu. Tak  napø.  kompilovaný  program v BASICu mùže
zabrat snadno 33 Kbyte  operaèní  (a tedy i diskové) pamìti, pøièemž tiskne
jen pár znakù  na  terminál.  Stejný  program psaný v assembleru by zabíral
napø. jen 10 KByte, t.j. jen tøetinu pamìového prostoru.

   Podívejme se nyní ještì  na  druhou  hlavní  výhodu programù zapsaných v
assembleru. Bez assembleru by byl uživatel  omezen  jen na to, co mu nabízí
"profesionální"  programy.  Napø.  jestliže  nìkdo napíše aplikaèní program
zpracovávající  vysoce  kritická  data  a  jeho  uživatel  je osoba  s  jen
èásteèným  zasvìcením  do   poèítaèové  problematiky,  bude  velice  vhodné
zabránit takovému uživateli ve stisknutí  kláves  CTRL-ALT-DEL,  které mùže
data  zcela znièit. Inhibice této akce mùže být  zajištìna  jen  na  úrovni
assembleru.

   Assemblery  umožòují  softwareovým odborníkùm pružný  styk  s  operaèním
systémem a  poskytují jim možnost pøímého øízení vstup/výstupních operací s
periferiemi (disky, tiskárny, diskety aj.). Aplikaèní programátor musí také
èasto  pøímo komunikovat s operaèním systémem.  Takové  programy  pak  jsou
obvykle psány v assembleru.











                                   - 6 - 




---------------------------------------------------------------------------
Rodina mikroprocesorù 80286/80386
---------------------------------------------------------------------------


   První  integrovaný  obvod  (IO)  byl   vyvinut   v   šedesátých  letech.
Integrovaný obvod prudce redukoval velikost kapacitorù, diod  a tranzistorù
a všechny je umistil na plochu plátku z èistého køemíku. Deset  let pozdìji
vyvinul INTEL svùj první mikroprocesorový èip, INTEL 8008. V roce 1974 byla
vyvinuta   druhá   generace    mikroprocesorových    èipù,   reprezentovaná
mikroprocesorem 8080. Tento obvod nabídl uživateli  všeobecné  možnosti. Ve
stejné dobì konkurence vrhla na  rychle se rozšiøující trhy další produkty,
napøíklad mikroprocesor ZILOG Z-80.

   Tøetí generace mikroprocesorù následovala hned po ètyøech letech. V roce
1978 vyvinula firma INTEL  mikroprocesor  8086.  Aèkoliv tento èip vykazuje
jisté rysy  kompatibility se svým "pøedkem", 8080, má mnohem avantgardnìjší
design, s mnoha novými  rysy.  INTEL  také  vyvinul mikroprocesor 8088 jako
variantu  èipu  8086.  Mikroprocesor 8088 umožnil o nìco jednodušší návrh a
zahrnul  kompatibilitu  s  bìžnými   I/O   zaøízeními.   Architekturou  byl
mikroprocesor 8088 jedním z nejpokrokovìjších mikroprocesorù  té  doby. Mìl
takové kvality, že jej  firma  IBM použila za základní stavební element své
nové øady osobních poèítaèù.

   Ve  stejné  dobì  se  objevil  i  "bratranec"  mikroprocesorù 8088/8086:
matematický koprocesor  8087. Tento numerický procesor by urèen k realizaci
rychlých výpoètù v pohyblivé øádové èárce.

   INTEL však nezùstal jen  u  svých  starých  úspìchù. Uprostøed roku 1984
ohlásila  tato  spoleènost  další  technologický skok: mikroprocesor 80286.
Tato centrální jednotka nové  generace  byla  navržena zejména pro aplikace
vyžadující vysokou výkonnost. Mikroprocesor 80286, jsa dolù  kompatibilní s
8086/8088, tìží z výhod takových progresívních rysù poèítaèù tøetí a ètvrté
generace,  jakou  jsou  správa pamìti, mechanismy ochrany,  správa  úloh  a
podpora virtuální  pamìti.  Všechny  zmínìné  vlastnosti  zajišuje  jediný
VLSI-èip,    který   poskytuje   uživateli   mikropoèítaèe   výpoèetní    a
architekturální potenci minipoèítaèe.

   Mikroprocesor  80286  je  zdola  nahoru  kompatibilní  s  8086/8088 díky
spoleèné  množinì  instrukcí   a  adresových  módù.  Základní  architektura
podporuje  vyšší  programovací  jazyky jako PASCAL, PL/M a C, protože návrh
souboru registrù je pøíhodný pro kód generovaný kompilátorem.

   Mikroprocesor 80286 podporuje  øadu  mocných  datových  typù,  jako jsou
napø. øetìzce, formáty v BCD kódu  a  v pohyblivé øádové èárce. Návrh 80286
také podporuje efektivní  adresování takových komplexních datových struktur
jako jsou statická/dynamická pole, záznamy a pole uvnitø záznamù.

   Pamìová architektura 80286 podporuje techniky modulárního programování,
které  softwareovému  specialistovi   umožòují  dìlit  pamìt  do  segmentù.
Segmentování pamìti poskytuje kratší kód, protože reference uvnitø segmentu
mohou  být kratší. Paradigma segmentace samo  o  sobì  podporuje  efektivní
implementaci dùmyslné správy pamìti - napø. techniku virtualizace a ochrany
pamìti. Mikroprocesor 80286 také poskytuje velký adresový prostor k podpoøe
souèasných aplikaèních požadavkù. Fyzická pamì sestává až z  16  MByte RAM
nebo  ROM.  Tento  obrovský   adresový   prostor   umožòuje  mikroprocesoru



                                   - 7 - 




ponechávat v  pamìti souèasnì nìkolik rozsáhlých programù a jejich datových
struktur, èímž je k nim umožnìn rychlý pøístup.

   Pro  aplikace  s  dynamicky  se  mìnícími  požadavky  na operaèní  pamì
(multiuživatelské  systémy)  dává  80286  každému  uživateli  až   1  GByte
virtuálního  adresového prostoru. Rozsáhlý adresový prostor témìø  vyluèuje
omezení na velikost nebo poèet programù, které mohou být èástí systému.

   INTEL  80286  je  urèen  k   podpoøe   multiuživatelského   prostøedí  a
multiprogramových   režimù  v   reálném   èase.   Mikropoèítaèové   systémy
obsluhující ètyøi èi pìt uživatelù souèasnì mohou nyní  expandovat  tak, že
podpoøí tøikrát tolik uživatelù, a systémy pracující v  reálném  èase budou
mít odezvy asi šestinové ve srovnání s døívìjším stavem.

   Poslední (dosud) èlen rodiny mikroprocesorù firmy INTEL je mikroprocesor
80386. Jeho 32-bitová  externí  datová  sbìrnice  mùže  adresovat  až  4 GB
operaèní pamìti.



---------------------------------------------------------------------------
Co budete schopni zvládnout ihned po pøeètení této knihy
---------------------------------------------------------------------------


   Po  pøeètení  textu  a vyzkoušení programù získáte  solidní  znalosti  o
vnitøní  architektuøe  80286/80386.  Budete  velice  dùkladnì  seznámeni  s
instrukèním souborem a se strukturou  registrù  mikroprocesoru  a  s jejich
používáním. Poté, co  se  nauèíte assembler, pochopíte, jak poèítaè pracuje
na  té nejzákladnìjší úrovni (oznaèované též  jako  strojová)  a  pochopíte
výhody a nevýhody programování v assembleru.



---------------------------------------------------------------------------
Co tato kniha pøedpokládá o vás
---------------------------------------------------------------------------


   Tato  kniha  pøedpokládá,  že již znáte nìkterý  z  rozšíøených  vyšších
programovacích jazykù, jako jsou napø.  PASCAL nebo BASIC. Nebudeme se však
nikterak snažit o vyuèování tìmto  jazykùm.  Znalost  hexadecimální èíselné
soustavy  je vhodná, nikoliv však bezpodmíneènì nutná -  totéž  platí  i  o
znalostech logických operací AND, NAND,  OR,  NOR,  XOR,  SHIFT LEFT/RIGHT,
ROTATE, COMPLEMENT atd.














                                   - 8 - 










                            K a p i t o l a   2

                             Èíselné soustavy


   Porozumnìní  tomu, jak poèítaè uchovává informaci,  je  do  znaèné  míry
kritické pro pochopení programování na  úrovni  assembleru.  Jak  jsou data
reprezentována vnitønì v poèítaèi·? Jelikož je poèítaè elektrické zaøízení,
"rozumí" jen úrovním napìtí. Specificky vìtšina  mikroprocesorù  je závislá
na  pøítomnosti èi nepøítomnosti dvou spolehlivì rozlišitelných  napìových
úrovní.  Mùžeme  tyto  úrovnì  považovat  za  charakteristiky  zapnutí nebo
vypnutí, za 1 nebo 0. Dvojice 0/1 je oznaèována také jako bit.

   Lidé od prapoèátku používali desítkovou èíselnou soustavu,  protože mají
deset prstù. Poèítaèe "rozumí" pouze dvìma odlišným stavùm, reprezentovaným
symboly 0 a 1. To pøirozenì vede ke  komunikaèním  problémùm  mezi  lidmi a
poèítaèi.  Vývoj  rùzných  symbolických  kódù  byl  pøímým  dùsledkem  této
jazykové nesluèitelnosti.

   Kód ASCII  (American  Standard  Code  for  Information  Interchange) byl
navržen proto, aby byl s to reprezentovat všechny  symboly  které všeobecnì
spojujeme  s  klávesnicí  psacího  stroje.  Nìkolik  èíselných   kódù  bylo
vytvoøeno k tomu. aby reprezentovaly  èíselné hodnoty v takové formì, které
poèítaè  rozumí.  Dvojkový doplòkový kód  umožòuje  poèítaèi  reprezentovat
kladná  i  záporná  celá  èísla.  Jeden z nejdùležitìjších  èíselných  kódù
potøebných  pro  praxi  programátora  v  assembleru  je  kód hexadecimální.
Hexadecimální zápis zlepšuje èitelnost informací reprezentovaných v binární
podobì a jde již o data, instrukce nebo adresy v pamìti.



---------------------------------------------------------------------------
Binární èísla
---------------------------------------------------------------------------


   Naše  dekadická   èíselná  soustava  má  své  jméno  od  deseti  (deka-)
jednotlivých èíslic 0,1,...,9, které jsou  jedinými  pøípustnými  znaky pro
zápis (celého) dekadického èísla. Binární  soustava  má  jen  dva pøípustné
symboly - 0 a 1. Mùže se zdát, že je  to  pro  zápis  velkých  èísel  poèet
symbolù naprosto nedostateèný. Snadno však nahlédnete, že  základní princip
binární soustavy je nìco, co už dávno znáte.

   Nejprve  se  podívejme  na nìjaké dekadické  èíslo  -  øeknìme  1024.  V
základní  škole  jsme  se uèili, že toto èíslo má 4  jednotky,  2  desítky,
žádnou stovku a jednu  tisícovku.  To  je  vlastnì vyjádøení váhové èíselné
reprezentace èísla 1024. Tak jak se pohybujete zprava  doleva  po èíslicích
daného  èísla,  zvìtšuje  se váha každé další èíslice. Naše dekadické èíslo
(tedy èíslo v soustavì o základu 10) si mùžeme myslet v následujícím tvaru




                                   - 9 - 




 1   0   2   4
 -   -   -   -    7   0
 |   |   |   +--- 4 x 10 =      4 (bit LSB)
 |   |   |              1
 |   |   +------- 2 x 10 =     20
 |   |                  2
 |   +----------- 0 x 10 =    000
 |                      3
 +--------------- 0 x 10 =   1000 (bit MSB)
                             ====
                             1024



   Konverzi  jsme  provedli  vynásobením  každé  èíslice  v  èísle základem
soustavy, který byl umocnìn na odpovídající exponent. Exponent se zvyšuje o
1 s každou další èíslicí pøi postupu vyèíslování od bitu LSB po bit MSB.

   Stejný  postup  zachováme  i pøi konverzi èísla zapsaného v jiné èíselné
soustavì,  napø.  ve  dvojkové.  Mìjme  tedy  tøeba  binární èíslo  1010  a
konvertujme jej do desítkové soustavy:

 1   0   1   0
 -   -   -   -          0
 |   |   |   +--- 0 x  2 =      0 (bit LSB)
 |   |   |              1
 |   |   +------- 1 x  2 =      2
 |   |                  2
 |   +----------- 0 x  2 =      0
 |                      3
 +--------------- 1 x  2 =      8 (bit MSB)
                             ====
                               10



   V tomto pøípadì jsme užili základu soustavy 2. Pøevedení  èísla  z  jiné
èíselné soustavy  do dekadické je velice jednoduché: prostì zmìníme hodnotu
základu, algoritmus pøevodu zùstane stejný.

   Vidìli  jsme,  jak  snadné je pøevést dvojkové èíslo na èíslo dekadické.
Opaèný pøevod - z dekadické soustavy do dvojkové -  je  rovnìž  jednoduchý:
odeèteme jen mocniny èísla  2  od èísla, které má být konvertováno. Øeknìme
napø.,  že chceme pøevést dekadické èíslo 11  na  èíslo  dvojkové.  Zaèneme
odeètením 2x2x2=8 od 11. Dostaneme zbytek 3. Odeètení další mocniny základu
2X2=4 provést nelze, ale odeètení další mocniny základu 2  dává  zbytek  1.
Nakonec odeèteme poslední mocninu základu 2, t.j. 1, a dostaneme  zbytek 0.
Celý postup nám dává konverzi dekadicky 11 = dvojkovì 1011.

   Jednodušší metodou vhodnou i pro  velká  dvojková  èísla  je následující
postup. Je tvoøen sérií opakovaných dìlení, pøièemž základ soustavy, do níž
se pøevádí, je dìlitelem, a pøevádìné èíslo je dìlencem. Pøevod dekadického
èísla 50 do binární soustavy vypadá takto:






                                  - 10 - 




---------------------------------------------------------------------------
     Dìlenec    Dìlitel  Výsledek    Zbytek     ---->     Výsledek:
---------------------------------------------------------------------------
       50          2       25          0         |
       25          2       12          1         |         110010
       12          2        6          0         |
        6          2        3          0         |
        3          2        1          1         |
        1          2        0          1         |
---------------------------------------------------------------------------



   Tuto metodu mùžete použít  pro  pøevod  dekadického  èísla do soustavy o
jakémkoliv základu. Napø. pøi  pøevodu  èísla  428 do šestnáctkové soustavy
jednoduše položíte dìlenec=428, dìlitel=16.



---------------------------------------------------------------------------
Binární seèítání a odeèítání
---------------------------------------------------------------------------


   Binární seèítání a odeèítání jsou  identické  s  dekadickým  seèítáním a
odeèítáním,  vyjma  toho,  že generujeme pøenos nebo  výpùjèku  pøi  urèité
mocninì èísla 2, a ne èísla 10. Uveïme struènì dva pøíklady:

    25
+   85
------
   110

   V tomto pøíkladì pøi seèítání dvou èíslic 5 generujeme pøenos do dalšího
øádu, t.j. do stovek, pøiètením 1 k dalšímu sloupci


   Binární seèítání tedy bude vypadat takto:

   1010 (10)
+  0011 (3)
-----------
   1101 (13)

Zde 0+1  dává  výsledek  1,  pøenos 0. 1+1 dává souèet 2 (binárnì 10), tedy
výsledek 0, pøenos 1 - pøenos pøièteme k dalšímu øádu

   Binární  odeèítání  užívá stejných principù  jako  odeèítání  dekadické.
Jediným  rozdílem  je, že pøi generování výpùjèky  z  vyššího  øádu  je  na
urèitou mocninu umocnìn základ 2, nikoliv základ 10.









                                  - 11 - 




      534
   -  251
   ------
      283

   Jednièku odeèteme od 4 bez obtíží. Pøi odeèítání èísla 5 od 3 potøebujeme však vytvoøit výpùjèku z dalšího øádu, t.j. ze stovek. To pak umožní odeèíst 50 od 130.

   Binární odeèítání tedy bude vypadat takto:

      1010
   -  0110
   -------
      0101

Pøi odeètení 0 od 1 v bitu LSB netøeba výpùjèky. Ve tøetím sloupci však potøebujeme výpùjèku 2x2x2 = 8. Tak dostaneme ve 3. sloupci 1 a výsledek odeèítání je 0101.



---------------------------------------------------------------------------
Datový typ BYTE
---------------------------------------------------------------------------


   Ještì než budeme pokraèovat v  diskusi  o  rùzných  èíselných systémech,
musíme pøipomenout, jak vlastnì èísla uchovává poèítaè ve svých technických
prostøedcích  (pamìtech).  Architektura   poèítaèe  totiž  do  znaèné  míry
determinuje formát a rozsah jak programù, tak i dat.

   U  mikroprocesoru  80286  je  pamìové  místo  posloupností   osmi  bitù
oznaèovaných jako byte. Pozice bitù jsou èíslovány od bitu LSB (má èíslo 0)
po  bit  MSB  (má   èíslo   7).  Další  obrázek  ukazuje  nìkolik  po  sobì
následujících pamìových míst, z nichž  každé  obsahuje  jeden  byte nìjaké
informace. Tato informace  mùže  být  strojovou  instrukcí,  adresou jiného
pamìového místa nebo èíslem èi znakem.

   Každý  byte mùže ve svých osmi  bitech  reprezentovat  256  jednotlivých
stavù. To tedy umožòuje zobrazit v jednom byte kladná èísla 0 až 255. Jeden
byte  mùže také nabývat hodnoty jednoho znaku  ASCII.  Slovo  je  technický
pojem, oznaèující spojení  bitù  do jedné informaèní jednotky pamìti. Slovo
mùže  být dlouhé 8, 16 nebo 32 bitù (popø. i více nebo ménì podle  aplikace
poèítaèe). V architektuøe 80286 je slovo  dlouhé  16 bitù, u 80386 má slovo
délku 32 bitù.



---------------------------------------------------------------------------
Datový typ CHARACTER
---------------------------------------------------------------------------


   Osmice bitù v jednom  byte  nemusí reprezentovat jen èísla. Kód ASCII je
sedmibitový kód  umožòující reprezentaci písmen i èíslic v pamìti poèítaèe.
Každému písmenu, èíslici  nebo  speciálnímu (øídicímu) znaku je tímto kódem
pøiøazena binární reprezentace na 7 bitech v jednom  byte.  Sedmibitový kód
mùže reprezentovat 128 jednotlivých symbolù.  Osmý, zbývající bit v byte je
nìkdy využíván ke kontrole pøi pøenosu dat (paritní  bit).  Nìkteøí výrobci



                                  - 12 - 




pamìtí  ROM  využívají  osmého bitu k zavedení  rozšíøeného  souboru  znakù
(extended  character   set).   Pøidáním   jediného   bitu   tak   dosáhneme
zdvojnásobení poètu jednoznaènì reprezentovatelných znakù na  256.  To dává
možnost zobrazení speciálních znakù v jiných jazycích (francouzské accents,
èeská diakritická  znaménka),  matematických  symbolù  a  velmi  dùležitých
grafických symbolù.


     (MSB)                             (LSB)
         +---+---+---+---+---+---+---+---+
   1000  |   |   |   |   |   |   |   |   |
         +---+---+---+---+---+---+---+---+
           7   6   5   4   3   2   1   0
                       .
                       .
                       .
         +---+---+---+---+---+---+---+---+
   0011  | 0 | 1 | 1 | 1 | 0 | 0 | 1 | 0 |
         +---+---+---+---+---+---+---+---+
         +---+---+---+---+---+---+---+---+
   0010  | 1 | 1 | 0 | 1 | 1 | 0 | 0 | 0 |
         +---+---+---+---+---+---+---+---+

         +---+---+---+---+---+---+---+---+
   0001  | 1 | 0 | 1 | 0 | 1 | 1 | 0 | 0 |
         +---+---+---+---+---+---+---+---+



---------------------------------------------------------------------------
Èísla se znaménkem
---------------------------------------------------------------------------


   Podívejme se  blíže na reprezentaci celých èísel u mikroprocesoru 80286.
Jestliže použijeme  všech osm bitù k reprezentaci kladných èísel, dostaneme
rozsah 0 - 255 (00000000 - 11111111). Po pøiètení 1  k  èíslu 255 dostáváme
opìt nulu.

   Reprezentace celých èísel  kladných  i  záporných  je  tedy kompromisem,
protože musíme nìjak indikovat znaménko èísla, na což nám staèí  jeden bit.
Ponecháme-li bit è. 7  k  reprezentaci  znaménka, dostáváme rozsah kladných
èísel 0-127. Kódù použitelných k  reprezentaci záporných èísel je celá øada
a nìkteré z nich si ukážeme.

   Nejjednodušší reprezentací je použití  bitu  è. 7 (MSB) na znaménko: 0 v
MSB kóduje kladné èíslo, jednièka v MSB èíslo záporné. Napøíklad:

   0000 0101   oznaèuje +5
   1000 0101   oznaèuje -5


   Co ale s hodnotou 0 ? Teoreticky bychom mìli:

   0000 0000   pro hodnotu +0
   1000 0000   pro hodnotu -0



                                  - 13 - 




   Jak  vás jistì napadne, potøebovali bychom  teï  také  nová  aritmetická
pravidla pro základní operace seèítání  a odeèítání. Napøíklad první z nich
by specifikovalo, že hodnota 0 bude vždy zobrazena jako "kladná" nula: 0000
0000.  Protože  poèet  bitù  urèených  k  reprezentaci  hodnoty  èísla  byl
redukován na 7, mùžeme hovoøit jen o hodnotách mezi 0 a + nebo - 127.
Následující pøíklad odeèítání

   1111 1110 +0
-  0000 0010 +1
   1111 1111 -127


však  nedává  správný  výsledek.  Abychom  mohli provádìt operace  s  takto
reprezentovanými èísly,  potøebujeme  ve  skuteènosti  symbol  1111  1111 k
reprezentaci èísla -1. Další pøíklad ukazuje zase jiný zpùsob odeèítání:

   1111 1110 -2
-  0000 0010 +2
   1111 1100 -4


   Kdybyste si udìlali konverzi èísla  1111 1100 pøedpokládajíce, že MSB je
rezervován pro znaménko, dostali byste  hodnotu  -124.  Proè  tedy výsledek
našeho druhého odeèítání byl -4 ? ètìte dále a uvidíte ...



---------------------------------------------------------------------------
Dvojkový doplnìk (two's complement)
---------------------------------------------------------------------------


   Aby operace seèítání  a  odeèítání  pracovaly  správnì  pøi reprezentaci
èísel navržené v pøedchozím odstavci, je tøeba reprezentovat  èísla  v tzv.
dvojkovém doplòkovém kódu. Pøíklady  právì  diskutované  vedou  k pochopení
potøeby reprezentovat kladná a záporná èísla následujícím zpùsobem:

   0000 0100   +4
   0000 0011   +3
   0000 0010   +2
   0000 0001   +1
   0000 0000    0
   1111 1111   -1
   1111 1110   -2
   1111 1101   -3
   1111 1100   -4



   Všimnìte  si, že toto kódování ponechává sedmý  bit  (MSB)  na  znaménko
èísla. Po provedení  operace  seèítání  nebo  odeèítání  se  dvìma  èísly k
dvojkovém doplòkovém kódu je výsledek také v tomto kódu. Napøíklad:

   0000 0100   +4
+  1111 1101   -3
------------



                                  - 14 - 




1) 0000 0001   +1 (Generovaný pøenos ignorujeme)


   Vytvoøení reprezentace záporného èísla ve dvojkovém  doplòku  je snadné:
staèí invertovat každý bit èísla a k takto vytvoøenému  èíslu  pøièíst  +1.
Následující pøíklad to ukazuje na získání reprezentace èísla -5

   0000 0101   +5
   1111 1010   (Invertujeme jednotlivé bity)
+  0000 0001   (Pøièteme +1)
   ------------
   1111 1011   -5



   Zpìtná konverze je stejnì tak snadná:  ukažme  si ji na pøevodu èísla -4
do jeho kladné hodnoty 4:

   1111 1100   -4
   0000 0011   (Invertujeme jednotlivé bity)
+  0000 0001   (Pøièteme +1)
------------
   0000 0100   +4




---------------------------------------------------------------------------
Rozšíøení znaménkového bitu
---------------------------------------------------------------------------


   Protože vnitøní registry  80286  mají  šíøku  16  bitù  a  šíøka jednoho
pamìového  místa  je  jen 8 bitù, je docela možné, že budete potøebovat ve
vašem programu seèíst dvì èísla o rùzných šíøkách.  Napøíklad  mùžete chtít
seèíst  osmibitové   èíslo   ve   dvojkovém   doplnkovém   kódu   s  èíslem
šestnáctibitovým, uloženým ve stejném datovém formátu:

             0000 0101  +5
+  1111 1111 1111 1101  -3
----------------------


   Zde jsme jednoduše pøipojili 0000 0000 k bitu MSB èísla +5. Co se stane,
když bude osmibitové èíslo záporné ?

             1111 1111  -1
+  0000 0000 0000 0100  +4
----------------------


   Jelikož bylo osmibitové  èíslo  záporné, pøipojili bychom osm jednièek k
bitu  MSB  èísla  -1 : 1111 1111. Obecné pravidlo pro rozšíøení znaménka je
tedy  prosté:  pøipojíme  osm jednièek nebo nul k bitu MSB u kratšího èísla
pøesnì podle znaménka "prodlužovaného"  èísla.  Rozšíøení  znaménka  u dvou
osmibitových èísel by nám tedy dalo



                                  - 15 - 




   0000 0000 0000 0101  (16-ti bitová reprezentace +5)
   1111 1111 1111 1111  (16-ti bitová reprezentace -1)



---------------------------------------------------------------------------
Hexadecimální èísla
---------------------------------------------------------------------------


   Hexadecimální èíselná  soustava dostala své jméno z 16- ti jednoznaèných
symbolù,  které  tvoøí  množinu  jejích  èíslic.  Hexadecimální  èísla jsou
užiteèná  pøi  ètení  nebo  psaní  programù   v   assembleru,  prohledávání
pamìových dumpù  atp.,  protože  každou  ètveøici  bitù  nahrazují jediným
hexadecimálním  symbolem. Hexadecimální èísla obsahují symboly  0  až  9  a
písmena A,B,C,D,E,F. Následující tabulka  ukazuje  vztah  mezi dekadickými,
binárními a hexadecimálními èísly.


      Tab. 2.1: Dekadická, binární a hexadecimální reprezentace èísel

          --------------------------------------------------
          Dekadicky      Binárnì          Hexadecimálnì
          --------------------------------------------------
           0             0000             0
           1             0001             1
           2             0010             2
           3             0011             3
           4             0100             4
           5             0101             5
           6             0110             6
           7             0111             7
           8             1000             8
           9             1001             9
          10             1010             A
          11             1011             B
          12             1100             C
          13             1101             D
          14             1110             E
          15             1111             F
          --------------------------------------------------

   Užiteènost hexadecimálních èísel vidíme na následujícím pøíkladì:

     10010110        --->      96
     11100011        --->      E3
     10101011        --->      AB
     00101100        --->      2C


   Èísla  vpravo  jsou  mnohem lépe èitelná a  kontrolovatelná  než  jejich
dvojkové  reprezentace  nalevo.  Konverze  èísla binárního do hexadecimální
soustavy je velice snadná: zaèínáme od bitu LSB a postupnì smìrem  doleva k
bitu  MSB  nahrazujeme  skupiny   ètyø   po   sobì  jdoucích  bitù  jedinou
hexadecimální èíslicí.




                                  - 16 - 




   Konverze  èísla  z  hexadecimální  soustavy  do  soustavy  dekadické  je
analogická  již  diskutované  konverzi   èísla   binárního   na  dekadické.
Následující pøíklad osvìtluje tuto  konverzi  na  èísle  FACE, které má být
pøevedeno do hexadecimální soustavy:

 F   A   C   E
 -   -   -   -      0
 |   |   |   +--- 14 x 16 =  14
 |   |   |               1
 |   |   +------- 12 x 16  =   192
 |   |                   2
 |   +----------- 10 x 16  =  2560
 |                       3
 +--------------- 15 x 16  = 61400
                             =====
                             64206


   Èíslo FACE reprezentované binárnì vypadá takto:

   1111101011001110

a  reprezentované  ve  dvou po sobì jdoucích  pamìových  místech  (bytech)
takto:

   11111010 11001110 .



---------------------------------------------------------------------------
Slova (words)
---------------------------------------------------------------------------


   Ponìvadž 80286 je šestnáctibitový procesor  a  pracuje  nejefektivnìji s
šestnáctibitovými údaji, vytvoøíme  složením  dvou bytù jedno slovo, jak je
patrné z následujícího obrázku.






















                                  - 17 - 




                    Obr. 2.1: Bity a byty jednoho slova


(LSB)               S L O V O                (MSB)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
 15 14 13 12 11 10  9  8  7  6  5  4  3  2  1  0


       HORNÍ BYTE               DOLNÍ BYTE
+--+--+--+--+--+--+--+--++--+--+--+--+--+--+--+--+
|  |  |  |  |  |  |  |  ||  |  |  |  |  |  |  |  |
+--+--+--+--+--+--+--+--++--+--+--+--+--+--+--+--+
 15 14  ........... 7  8  7   6 ...........  1  0


        byte MSB                byte LSB
 (Most Significant Byte)  (Least Significant Byte)


   Vytvoøení  slova  nám  umožní   pøekroèit   hranici   hodnoty   255  (FF
hexadecimálnì,  FFH)  a  pracovat  s   èísly  až  do  hodnoty  65535  (FFFF
hexadecimálnì, FFFFH). Assembler skuteènì uchovává a zpracovává  celá èísla
jako slova.

   Pøi uchovávání celého  èísla  o  velikosti  slova v pamìti jsou jeho dva
byte umístìny v opaèném poøadí. Byte  LSB  je umístìn na nižší adrese, byte
MSB na vyšší adrese pamìti. Napøíklad uchování hodnoty 3456H  v  pamìti  by
vypadalo takto:

   Adresa pamìti     Hodnota
   -------------     -------
   0000 0001            34H
   0000 0000            56H


   Ve  vìtšinì  pøípadù  se  programátor  v  jazyce  symbolických instrukcí
nestará o pravidla umísování  svých  operandù  v pamìti. Všechny instrukce
pracující s pamìtí "rozumí" formátu dat,  jež  se mají do pamìti umístit, a
zajišují  všechny nezbytné pøesuny. Programátor si  však  musí  být  dobøe
vìdomý  popsané  metody  ukládání  jednotlivých  byte  pøi  trasování svého
programu a  pøi zkoumání výpisù pamìti. Mikroprocesor zpracovává vždy 16-ti
bitové slovo, ne dva osmibitové byte.



---------------------------------------------------------------------------
Dvouslova (doublewords)
---------------------------------------------------------------------------


   Dvouslovo je široké 32  bitù,  jak již jeho název napovídá. Dvouslovo je
složeno ze dvou pøilehlých slov na po sobì jdoucích adresách.  Dvouslovo je
velice  významný  datový  formát,  protože  dovoluje  mikroprocesoru  80286
adresovat více než 1 milión byte pamìti. Z tohoto dùvodu bude programátor v



                                  - 18 - 




jazyce  symbolických instrukcí mikroprocesoru 80286 pracovat s  32-bitovými
dvouslovy jako s ukazateli  na  data  v pamìti. Dvaatøicetibitové dvouslovo
také  umožòuje,  aby  aritmetické  operace  s  výhodou  využívaly  dvojitou
pøesnost  výpoètù - v dvouslovì je možné uchovávat  velice  malá  i  velice
velká èísla celá i desetinná.

   Dvouslova jsou uchovávána  v  uspoøádání  podobném  uchování  slov. Tedy
nižší   slovo   dvouslova   je   ukládáno   na  nižší  adresu   v   pamìti.
Dvaatøicetibitové slovo je uchováváno  jako  posloupnost  4  byte, poèínaje
bytem LSB a  konèe  bytem  MSB.  Èíslo  12345678H by bylo v pamìti uchováno
takto:

   Adresa pamìti     Hodnota
   -------------     -------
   0000 0011            12    (MSB) \
   0000 0010            34           > slovo 16 bitù
                                    /              \
                                                    >dvou-
                                    \              / slovo
   0000 0001            56           > slovo 16 bitù
   0000 0000            78    (LSB) /



---------------------------------------------------------------------------
Nestandardní pole bitù
---------------------------------------------------------------------------


   Vìtšina dat, se kterými se  setkává  programátor  v  jazyce symbolických
instrukcí, spadá do  dvou  skupin  definovaných  v  pøedchozích odstavcích.
Existují však  i výjimky. Napø. návrháøi PC-DOSu nechtìli plýtvat pamìovým
prostorem a rozhodli se uchovávat  datový  údaj  /den-mìsíc-rok/  v jediném
šestnáctibitovém  slovì. Vìnovali tak 7 bitù pro údaj o roce (èísla od 0 do
128  reprezentují  po  pøiètení  základu  1980  rok),  na  údaj o mìsíci je
zapotøebí rozsahu 1-12, staèí tedy 4 bity. Maximální poèet dnù v  mìsíci je
31,  staèí  tedy  5  bitù  k  reprezentaci  údaje  o  dnu  v  mìsíci.  Jiná
nestandardní  bitová  pole  se  užívají  napø. v aplikacích  s  poèítaèovou
grafikou. Zde mùže jediný bit  reprezentovat bod na obrazovce monitoru. Je-
li bit  nulový,  má  bod  tmavou  barvu  (nesvítí). Jednièka v takovém bitu
signalizuje, že bod má být rozsvícen. Toto zobrazení bodù  na  displeji  se
však mùže poèítaè od poèítaèe mìnit. Napø. co když chceme indikovat, že bod
na  displeji  má  být  rozsvícen  urèitou  barvou  ? Pøidìlíme-li  bodu  na
obrazovce nyní dva  bity,  je  možné  popsat rozsvícení èi zhasnutí bodu ve
tøech rùzných barvách. Všechny tyto nestandardní bitové  konfigurace musejí
být peèlivì zváženy pøi ukládání,  zpracování a pøístupu k binárním údajùm.
Ještì vìtší pozor musíme dávat pøi rozboru binárních výpisù pamìti (dumpù).












                                  - 19 - 




---------------------------------------------------------------------------
Binární operace
---------------------------------------------------------------------------


   Pøi  bližším  rozboru mikropoèítaèem provádìného  sèítání  èi  odeèítání
neobjevíme  nic  jiného  než opakované série bitových  porovnání.  Je  sice
pravdou,  že  centrální  jednotka  mikroprocesoru obsahuje rùzné "seèítací"
obvody;  lze  v  koneèné instanci øíci, že i tyto obvody pracují na základì
srovnávání  dat  bit  po  bitu.  Tato  bitová  srovnání pøedstavují  velice
jednoduchý proces, nebo pøi srovnání dvou bitù mùžeme dostat jen tøi možné
kombinace bitových párù: oba bity mohou být nulové, oba jednièkové  nebo je
jen jeden z  bitù  jednièkový.  Jednoduchá  série  sestávající  se  z právì
popsaných  opakovanì provádìných srovnání je základem seèítání,  odeèítání,
násobení i  dìlení. V pøípadì seèítání jsou aplikována následující pravidla
poèínaje od bitu LSB (Least Significant Bit = bit s nejmenší vahou):
- Seètení dvou bitù nastaví pøíznak SUM do nuly pøi obou bitech nulových
- Je-li jeden ze seèítaných bitù jednièkový, má pøíznak SUM hodnotu 1
- Je-li hodnota obou bitù 1, je pøíznak SUM nastaven na hodnotu 0 a pøíznak
CARRY (pøenos) na hodnotu 1

   Tento proces je pøi seèítání  opakován s každým následujícím bitem (tedy
s bity  o  postupnì  rostoucí  váze),  pøièemž  je tøeba pøi každé sekvenci
pravidel uvažovat pøedchozí pøenos. Základní jednotka si  uchovává historii
všech individuálních sekvencí srovnání ve  své  vnitøní  pracovní  pamìti a
výsledek celého procesu pak  vypadá  jako  binární seèítání. Ve skuteènosti
tento proces není nic jiného než opakování operací bitových srovnání.

   Aèkoliv  je  centrální jednotka technicky  predestinována  k  vykonávání
takových  operací,  jako  je  seèítání,  odeèítání, násobení a  dìlení,  má
programátor  pracující v assembleru možnost pøístupu  i  k  jiným  operacím
bitového srovnání. Tyto operace zahrnují logické AND, OR,  XOR,  SHIFT LEFT
(posun vlevo), SHIFT RIGHT (posun  vpravo),  ROTATE  LEFT  (rotace doleva),
ROTATE RIGHT (rotace vpravo)  a  COMPLEMENT  (doplnìk). U logických operací
AND,OR a COMPLEMENT je vhodné  pokládat  hodnoty  bitù  1  a  0  za logické
hodnoty true a false.  Logická  operace AND srovnává dva bity. Je-li jejich
hodnota jednièková, je výsledek také  jednièka. Všimnìme si, že výsledek je
odlišný od operace binárního seèítání, kdy srovnání dvou  bitù  vyústilo ve
výsledek SUM=0 a CARRY=1.

   LOGICKÝ SOUÈIN AND
       Bit è. 0  Bit è. 1  Výsledek
          0         0         0
          0         1         0
          1         0         0
          1         1         1

   Operace AND je velmi èasto používána k výbìru  èi  "maskování" nìkterých
skupin bitù ve slovì/bytu. Jeden pøíklad takového využití mùžeme nalézt pøi
dekadickém násobení èi dìlení:  je  zapotøebí  vynulovat  4 bity s nejvyšší
vahou pøedtím, než operaci násobení nebo dìlení provedeme nad dvìma èísly v
nesbaleném tvaru. To lze velice lehce provést logickým souèinem nesbaleného
dekadického èísla s hodnotou 0000 1111:






                                  - 20 - 




         1010 0011
   AND   0000 1111   (maska)
   ---------------
         0000 0011

   Operace logického souètu OR srovnává dva bity a vydává výsledek 1, je-li
alespoò  jeden  bit   jednièkový.   Operace  OR  je  užiteèná  k  nastavení
specifických pozicí do hodnoty 1.

   LOGICKÝ SOUÈET OR
       Bit è. 0  Bit è. 1  Výsledek
          0         0         0
          0         1         1
          1         0         1
          1         1         1


   Napøíklad  chceme-li  nastavit  bit  MSB  (Most Significant Bit = bit  s
nejvìtší  vahou) na hodnotu 1, mùžeme v  pøípadì  8-bitového  slova  použít
operaci OR nad tímto èíslem a hodnotou 1000 0000:

      0001 1010
   OR 1000 0000
   ------------
      1001 1010


   Operace  EXCLUSIVE  OR  srovnává dva bity a vrací jako výsledek jednièku
jen v pøípadì, že jsou oba srovnávané bity rùzné. Tato logická operace mùže
být velice užiteèná v pøípadì, že je nutné vytvoøit komplement specifických
bitù ve slovì/bytu, tøeba v grafických aplikacích.

   EXKLUZÍVNÍ LOGICKÝ SOUÈET XOR
       Bit è. 0  Bit è. 1  Výsledek
          0         0         0
          0         1         1
          1         0         1
          1         1         0

   V následujícím pøíkladì jsou prostøední  ètyøi  bity  osmibitového èísla
invertovány oprací EXCLUSIVE OR s hodnotou 0011 1100:

         1010 0110
   XOR   0011 1100
   ---------------
         1001 1010


   Operaci  exkluzívního  logického  souètu XOR lze s výhodou použít také k
nulování pamìového místa místo instrukce MOV (napø. XOR AX,AX nuluje AX).

   Operace SHIFT LEFT/RIGHT,  ROTATE  LEFT/RIGHT a COMPLEMENT pracují jen s
jedním operandem. Instrukce SHIFT  poskytuje  elegantní  metodu  pro velice
rychlé  násobení  nebo  dìlení  èísla  dvìma. Tato metoda  nejen  poskytuje
výsledek velice rychle,  ale  je  hlavnì  výhodná u poèítaèù, které ve svém
instrukèním souboru nemají realizovány operace dìlení a násobení  a  kdy je



                                  - 21 - 




tyto operace nutno  zabezpeèit  programovì.  Jestliže  uvažujeme  èísla bez
znaménka, pak posun èísla o jednu pozici doleva a dozazení hodnoty 0 do LSB
má za následek vynásobení èísla dvìma:

   SHL   0100 0001   (dekadicky 65)
   ---------------
         1000 0010   (dekadicky 130)

 Jestliže chceme podìlit èíslo bez znaménka dvìma, pak staèíp osuv  o jednu
pozici doprava a dosazení hodnoty 0 do MSB:

   SHR   0000 1010   (dekadicky 10)
   ---------------
         0000 0101   (dekadicky 5)


   Instrukce  ROTATE  umožòuje  pøeskupovat bity v èísle.  Podobnì  jako  u
operace SHIFT  je  možné  rotovat  doprava  èi  doleva (ve smìru RIGHT nebo
LEFT). Na rozdíl od operace SHIFT, kdy je nejkrajnìjší bit  vždy "ztracen",
operace ROTATE pøesunuje  "vypadávající"  bit na volné místo vznikající pøi
rotaci na druhém konci èísla:

   ROR   0000 1111   (rotace doprava)
   ---------------
         1000 0111
   ROL   0000 1111   (rotace doprava)
   ---------------
         0001 1110































                                  - 22 - 










                            K a p i t o l a   3

                            Adresovací techniky


   Instrukce mikroprocesoru 80286/80386 obsahuje nejen informace o operaci,
která  má  být  provedena,  ale  souèasnì  v  sobì nese i informaci o  typu
zpracovávaných  operandù  a  o  jejich  lokalizaci v pamìti.  Existuje  osm
základních adresovacích modù:

   1.  Bezprostøední adresování (immediate addressing)

   2.  Registrové adresování (register addressing)

   3.  Pøímé adresování (direct addressing)

   4.  Registrové nepøímé adresování (register indirect addressing)

   5.  Bázování (based addressing)

   6.  Pøímé registrové adresování (direct indexed addressing)

   7.  Bázované indexové adresování s pøemístìním nebo bez pøemístìní (base
       indexed addressing with or without displacement)

   8.  Extenze pro 80386



---------------------------------------------------------------------------
Bezprostøední adresování
---------------------------------------------------------------------------


   Mikroprocesor dekóduje adresovací mód  podle  syntaxe  zápisu instrukce.
Napøíklad u instrukce

   MOV AH,00
   MOV AL,04

je  hodnota  operandu  umístìna pøímo uvnitø instrukce  -  bezprostøednì  v
instrukci.   Registr   AH   je  nulován  (hodnotou  00)  a  registr  AL  je
inicializován na hodnotu 0000 0100  binárnì. Je tøeba pøipomenout, že 80386
akceptuje i operandy dlouhé 32 bitù. Následující pøíklad  pøesouvá  16 bitù
dlouhý zdrojový operand  do  registru AX (každý hexadecimální pøímý operand
musí zaèínat èíslicí 0) :

   MOV AX,0FFFFH





                                  - 23 - 




---------------------------------------------------------------------------
Registrové adresování
---------------------------------------------------------------------------


   U registrového adresování  je  hodnota zdrojového operandu již uložena v
nìkterém z  vnitøních  všeobecných  (general)  registrù  80286/80386.  Tato
hodnota    mùže    být    osmibitová,    šestnáctibitová   nebo   u   80386
dvaatøicetibitová.  Mikroprocesor  interpretuje  délku operandu podle jména
registru. Napøíklad:

   MOV DS,AX

   Tento zpùsob registrového adresování øíká mikroprocesoru, aby vzal 16-ti
bitový obsah zdrojového operandu - registru A (celý AX) - a pøesunul jej do
16-ti bitového registru DS. Tento zpùsob adresování lze aplikovat i na 8-mi
bitový zdrojový operand :

   MOV DL,AL

   Z  uvádìných  osmi  adresovacích  módù  vyžadují   registrové   a  pøímé
adresování  nejménì  strojových  taktù.  Jelikož  data  operandù  jsou  již
zahrnuty v  instrukci  samotné,  není  zapotøebí  žádných  èasovì nároèných
pøístupù do hlavní pamìti, abychom hodnoty operandù získali.

   Další popisované adresovací módy vyžadují více strojových taktù, protože
mikroprocesor musí spoèítat adresu  operandu  na  základì  adresy segmentu,
offsetu (posunutí) v  segmentu  a  èasto  i  obsahu  indexového  a bázového
registru. Takto získaná adresa je oznaèována jako efektivní adresa operandu
(effective address, EA).



---------------------------------------------------------------------------
Pøímé adresování
---------------------------------------------------------------------------


   U pøímého adresování je offset  operandu v segmentu (t.j. jeho relativní
vzdálenost  od  poèátku  segmentu)  obsažen  v registru jako  16-ti  bitová
hodnota. Tento  offset je pøièten k posunutému obsahu datového segmentového
registru  DS  a  hodnotou  tohoto  souètu  je  20-ti bitová  adresa  (pokud
pracujeme  v  reálném  módu)  EA,  která je již fyzickou adresou  operandu.
Vìtšinou je operandem pøímého adresování návìští.

   Napøíklad  instrukce  MOV  AX,MYDATA  na  obrázku  3-1.   požaduje,  aby
mikroprocesor naplnil registr AX obsahem pamìového místa, na které ukazuje
adresa spojená s  návìštím  MYDATA. Všimnìte si, jak mikroprocesor uchovává
nižší byte operandu na nižší adrese a vyšší byte na vyšší adrese.










                                  - 24 - 




                        Obr. 3.1: Pøímé adresování

     Instrukce MOV     MOV AX,MYDATA          0005
                                              0004
     Registr AX        1111111100000000       0003    FF
     po provedeni                             0002    00      MYDATA
     instrukce MOV                            0001
                                              0000
                                              adresy



---------------------------------------------------------------------------
Registrové nepøímé adresování
---------------------------------------------------------------------------


   U  nepøímého  registrového  adresování  je  -  namísto  reference adresy
zdrojového operandu prostøednictvím návìští -  hodnota  operandu  získána z
offsetu uloženého v jednom z  následujících registrù: SI (source index), DI
(destination index), BX (base register)  nebo  (za  urèitých  okolností) BP
(base pointer).

   Mikroprocesor   rozpozná   nepøímé   registrové  adresování  ze  syntaxe
instrukce.  Oznaèení  zdrojového  operandu je v hranatých  závorkách  [  ].
Napøíklad na dalším obrázku bude instrukce správnì provedena jen v pøípadì,
že registr BX byl pøedem  naplnìn hodnotou urèující offset pamìového místa
MYDATA. To mùže být provedeno napøíklad operátorem OFFSET takto:

   MOV BX,OFFSET MYDATA
nebo je možné využít instrukce LEA (Load Effective Address):

   LEA BX,MYDATA

                  Obr. 3.2: Nepøímé registrové adresování

                       MOV AX,[BX]            0005
                                              0004
                                              0003    FF
                  BX   0000000000000010       0002    00      MYDATA
                                              0001
                  AX   1111111100000000       0000
                                              adresy

   Registrové nepøímé adresování lze použít k odkazùm na data uchovávaná ve
formátu  tabulky.  Pøístup  k jednotlivým položkám takové  tabulky  se  pak
zefektivní - místo pomìrnì èasovì  znaènì nároèných operací výbìru adresy z
pamìti a pak  výbìru  operandu  z  této  adresy  provádí  mikroprocesor jen
inkrementaci bázového registru a výbìr operandu z takto vzniklé adresy.










                                  - 25 - 




---------------------------------------------------------------------------
Bázové relativní adresování
---------------------------------------------------------------------------


   Efektivní adresa operandu je u bázového  relativního  adresování získána
jako souèet hodnoty pøemístìní (displacement)  a  obsahu  bázového registru
(BP  nebo  BX).  Pøemístìní  je  uvažováno vzhledem k  vybranému  segmentu.
Implicitním segmentovým registrem je  v  pøípadì  BP  registr SS, v pøípadì
bázového registru BX je jím DS. Toto implicitní  urèení  se  dá  ve vìtšinì
pøípadù zmìnit pøedponou  segment:  (segment  overriding),  tedy  napø. mov
ax,es:[bp] pøesune do  registru  ax  slovo  z  offsetu o hodnotì [bp] a pro
vytvoøení  horní  èásti  adresy operandu pøesouvaného do ax je vzat registr
es.  Bázové  relativní  adresování  se   èasto   používá   ke  zpøístupnìní
komplexních datových struktur (napø. záznamù).  Bázový  registr  ukazuje na
zaèátek struktury  (bázi), a jednotlivé položky záznamu jsou vybírány podle
hodnoty pøemístìní. Zmìna hodnoty pøemístìní má za následek pøístup k jiným
položkám uvnitø záznamu. Zpøístupnìní stejné  položky  v  rùzných záznamech
lze jednoduše dosáhnout zmìnou obsahu bázového registru.

   Na pøíkladì uvádìném na  dalším  obrázku  obsahuje adresa MESGE1 øetìzec
znakù.  Instrukce  LEA  naplní  registr  BX  offsetem.  Pøístup k  ètvrtému
elementu MESGE1 je zajištìn pøiètením  bázové adresy (v registru BX) MESGE1
k pøemístìní (má hodnotu +4) uvnitø øetìzce.

                   Obr. 3.3: Bázové relativní adresování

     MESGE1            DB 'ASSEMBLY LANGUAGE IS FAST','$'
     MESGE2            DB 'AND EFFICIENT','$'
                                              datový segment
     LEA BX,MESGE1                            0009    4C    L
                                              0008    20    mezera
                                              0007    59    Y
     MOV AL,[BX]+4                            0006    4C    L
                                              0005    42    B
     BX 0000000000000000                      0004    4D    M
     AL 4D                                    0003    45    E
                                              0002    53    S
                                              0001    53    S
                                              0000    41    A     MESGE1

   Assembler  rozpozná následující tøi zpùsoby zápisu bázového  relativního
adresování:

   LEA [BX]+4
   LEA 4[BX]
   LEA [BX+4]


   První zápis je nejužívanìjší; pøemístìní nicménì mùže  pøedcházet bázový
registr nebo mùže  být  zahrnuto v hranatých závorkách. Adresování elementù
struktury MESGE1 by mìlo být  provádìno  inkrementací  pøemístìní,  a zmìna
struktury  by mìla být provedena zmìnou bázové  adresy  (BX),  tøeba  touto
instrukcí:

   LEA BX,MESGE2 .



                                  - 26 - 




---------------------------------------------------------------------------
Pøímé indexové adresování
---------------------------------------------------------------------------


   U pøímého indexového adresování je offset operandu vypoèítán jako souèet
pøemístìní vzhledem k indexregistru (SI nebo DI) uvnitø vybraného segmentu.
Èasto je tohoto typu adresování  používáno k pøístupu k prvkùm (statického)
pole. Hodnota pøemístìní lokalizuje  zaèátek  pole,  a hodnota uchovávaná v
indexregistru  lokalizuje  konkrétní  prvek  pole.  Na  rozdíl  od záznamù,
jejichž jednotlivé položky mohou mít promìnnou délku i typ, jsou prvky pole
homogenní. Jelikož jsou tedy prvky  pole stejného typu a velikosti, prùchod
polem je jen otázkou systematické inkrementace  a  dekrementace pøemístìní.
Napøíklad:

   MOV SI,4
   MOV AL,ARAY1[SI]     ; vybereme 4. prvek ARAY1

   Je  však  zapotøebí  dávat pozor na to, abychom vybrali správnou hodnotu
pøemístìní vzhledem k typu  prvkù  pole. Právì uvádìný pøíklad by zavedl do
registru AL ètvrtou hodnotu pole ARAY1. Stejný pøíkaz by naplnil registr AX
hodnotou prvku pole ARAY1:

   MOV AX,ARAY1[SI]

Tentokrát by však hodnota prvku pole musela být šestnáctibitová.



---------------------------------------------------------------------------
Bázové indexové adresování
---------------------------------------------------------------------------


   U bázového indexového adresování je operand lokalizován uvnitø vybraného
segmentu  a  na  offsetu  urèeném  souètem  obsahù  bázového, indexového  a
popøípadì i  hodnoty  pøemístìní.  Není-li  pøemístìní  zahrnuto,  je tento
zpùsob adresování nejèastìji použit k pøístupu k elementùm dynamického pole
(t.j.  pole,   jehož  poèáteèní  adresa  se  mùže  mìnit  bìhem  vykonávání
programu).  Zahrnutí  pøemístìní umožòuje pøístup  k  individuálním  prvkùm
pole, které mùže být položkou uvnitø napø. záznamu.


















                                  - 27 - 




                   Obr. 3.4: Bázové indexové adresování

     MOV AX, ELEMENT[BX][DI]          0025
                                      0024   FO
     BX = 0000                        0023   BF
     DI = 0020                        0022   90
                                      0021
                                      0020
                                             Záznam 3
                                      0015
                                      0014
                                      0013
                                      0012
                                      0011
                                      0010
                                             Záznam 2
                                      0005
                                      0004
                                      0003
                                      0002
     AX = F0BF                        0001
                                      0000   MYDATA
                                             Záznam 1

   V tomto pøípadì (viz  pøedešlý  obrázek)  by  bázový registr ukazoval na
zaèátek záznamu, pøemístìní (uchovávané v DI) by  reprezentovalo vzdálenost
od poèátku záznamu k poèátku pole uvnitø záznamu a hodnota pøemístìní prvku
pole by byla  obsažena  v promìnné ELEMENT. Pøedpokládejme hodnotu ELEMENTu
3.

   Na pøíkladì na  dalším  obrázku  je  poèáteèní (bázová) adresa 0000 a je
umístìna  v  registru  BX. Položka tøetího  záznamu  (která  je  polem)  má
pøemístìní  0020, jež je uchováno v DI. Tøetí  prvek  pole  je  zpøístupnìn
pøemístìním obsaženým v promìnné ELEMENT inicializované na hodnotu 3.



---------------------------------------------------------------------------
Extenze u 80386
---------------------------------------------------------------------------


   Dvaatøicetibitové adresní  módy jsou rozšíøeny v tom smyslu, že dovolují
použití  libovolného  registru  jako  bázového  èi  indexového.  Tyto  módy
požadují, aby v bázovém a indexovém registru (pokud  jsou  používány), byly
validní   32-bitové  hodnoty.  Všechny  instrukce  šestnáctibitového   módu
"oøezávají" nejvyšších  16  bitù  dvaatøicetibitového  registru  a  hodnoty
nejvyšších bitù jsou tedy ignorovány.











                                  - 28 - 










                            K a p i t o l a   4

                             Programovací styl


   Program v assembleru  je  sérií pøímo proveditelných pøíkazù, které jsou
instrukcemi základní jednotky  poèítaèe.  Symbolická  mnemonika,  v  níž je
program  v assembleru zapsán, se nazývá zdrojový  program.  Tak  jako  jiné
jazyky i assembler má svou pøesnì definovanou syntax.

Každý pøíkaz v assembleru je složen ze ètyø polí:

   1.  Pole jména

   2.  Pole operace

   3.  Pole operandu

   4.  Pole poznámek


Pole jména (návìští)

   Pole "jména", èasto  oznaèované  také jako pole návìští, pøiøazuje právì
referované adrese pamìti symbolické jméno. Toto  symbolické  jméno umožòuje
programátoru  obracet   se  na  tuto  adresu  jménem  a  eliminuje  nutnost
pamatování  adres   v  èíselném  tvaru.  Notace  je  zvláštì  užiteèná  pøi
generování  pøemístitelného  (relokatibilního)  cílového programu. Použitím
symbolických referencí programátor umožòuje spojovacímu  programu (linkeru)
nalézt  místo,  na  které bude cílový program v assembleru zaveden. Všechny
reference  na  instrukce  se  pak  mohou  automaticky  mìnit s  mìnícím  se
umístìním  programu  v  pamìti.  I  když je možné pojmenovat (t.j.  opatøit
návìštím)  každou  instrukci,  pole  návìští  je obvykle využíváno  pro  ty
instrukce, jež  jsou referovány v definicích dat, konstant, segmentù, cyklù
a volání podprogramù.


   Jméno (návìští) musí zaèínat písmenem a mùže mít až 31 znakù, vèetnì

    -  všech písmen A - Z

    -  všech èíslic 0 - 9

    -  speciálních symbolù _ $ . ? @ %

   Pøi  výbìru  jména  musíme  dbát  jisté opatrnosti. Nelze  použít  jména
stejného s rezervovaným slovem assembleru nebo  stejného  s assemblerovskou
direktivou (viz dále). Jestliže  jméno  má  obsahovat  teèku (.), pak teèka
musí být prvním znakem jména.




                                  - 29 - 




   Promìnné

   Jméno promìnné reprezentuje pamìové místo, jež  je  pøístupné programu:
obsah  tohoto pamìového místa se mùže  mìnit  bìhem  vykonávání  programu.
Definice promìnné zahrnuje  informaci  o  adrese  pamìového  místa (adrese
promìnné), typu promìnné a její  velikosti. Promìnné lze užít jako operandy
v jednoduchých, indexovaných nebo strukturovaných formách.

   Návìští

   Jména použitá k oznaèení procesorem proveditelných instrukcí aplikaèního
programu jsou oznaèována  jako  relativní  (code-relative).  Jméno  (nebo v
tomto pøípadì návìští) má tøi  atributy: adresu segmentu, offset segmentu a
deskriptor  NEAR  nebo  FAR.  Základní  jednotka  mùže  adresovat konkrétní
návìští  dvìma  zpùsoby.  Je-li  návìští,  jež  má  být referováno,  uvnitø
stejného programového segmentu  (code  segment),  je  k  lokalizaci pøíkazu
oznaèeného návìštím  zapotøebí jen offset segmentu. V tomto pøípadì øíkáme,
že návìští je  typu  NEAR.  Ke  specifikaci návìští typu NEAR staèí umístit
dvojteèku  (:) bezprostøednì za jméno nebo  použít  pseudooperaci  LABEL  s
atributem NEAR

   LOOP:
   COUNT LABEL NEAR

   Druhý zpùsob pro adresaci  návìští  potøebuje  adresu segmentu i hodnotu
offsetu.  To  je  pøípad,  kdy  referovaný  pøíkaz  assembleru není  uvnitø
stejného programového segmentu·-·v takovém  pøípadì  je  návìští definováno
jako FAR:

   MYCODE LABEL FAR

   V právì ukázaném pøíkladì je  pseudooperace  LABEL  použita  s atributem
FAR. Atribut FAR lze užít také pøi referenci  symbolù  pomocí pseudooperací
EQU, PROC a EXTRN :

   TEN EQU FAR 10
   PRNTIT PROC FAR
   EXTRN RANDM:FAR

   Konstanty

   Jmény je možné oznaèit také  pamìová  místa  obsahující  hodnoty jednou
nastavené  a  nemìnící  se  bìhem  vykonávání  programu.  Tato  jen  jednou
inicializovaná pamìová místa se nazývají konstanty a mohou být osmi typù.

1. Binární konstanty.

   Binární konstanty obsahují posloupnosti jednièek a nul a jejich definice
je ukonèena písmenem B. Napøíklad:

   EIGHT EQU 00001000B

2. Dekadické konstanty.






                                  - 30 - 




   Dekadické konstanty obsahují posloupnost dekadických  èíslic  0  až  9 a
jsou nepovinnì zakonèovány  písmenem  D. Posloupnost èísel je považována za
dekadickou  konstantu,  dokud   není  explicitnì  provedena  zmìna  základu
pseudooperací RADIX. Zde je pøíklad dekadické konstanty:

   FORTY EQU 40D

3. Hexadecimální konstanty.

   Obsahují posloupnosti hexadecimálních èíslic 0-9  a  A-F.  Definice musí
být zakonèena vždy písmenem H. První znak musí  být  jednou  z  èíslic 0-9.
První  znak  øíká pøekladaèi assembleru, že jméno  je  èíslem  a  ne  tøeba
návìštím nebo promìnnou. Jestliže  hexadecimální  èíslo  zaèíná  nìkterým z
písmen  A-F,  je  tøeba  pøipojit  pøed nejlevìjší písmeno nulu (0),  která
odstraní  nejednoznaènost  pøi   pøekladu.  Hexadecimální  èíslo  mùže  být
definováno tøeba takto:

   FIFTY EQU   32H
   HEXNM EQU   0FFH

   Ve druhé definici je nula pøipojena pøed nejlevìjší èíslici k odstranìní
nejednoznaènosti definice.

4. Oktalové konstanty.

   Skládají se z èíslic 0-7 a ukonèeny jsou písmenem O nebo Q.
   Napøíklad:

   SIX EQU 6O (nebo 6Q)

5. Znakové konstanty

   Znakové konstanty mohou  obsahovat  libovolné  ASCII  znaky  uzavøené do
jednoduchých nebo dvojitých uvozovek. Jesliže znaková konstanta má více než
dva znaky, je tøeba použít pseudooperace DB (define byte). Jestliže øetìzec
znakù obsahuje pouze jeden nebo  dva znaky, pak mùžeme použít pseudooperace
DD, DQ, DT nebo DW. Napøíklad:

   INITL DD 'B'
   NAME DB '80286 ASSEMBLER'

6. Data v plovoucí øádové èárce (floating point)

   Tento datový typ reprezentuje hodnoty  v dekadické vìdecké notaci a není
podporován assemblerem IBM Small Assembler.
Napøíklad:

   SINE DD 0.332E-1

7. Hexadecimální èísla real

   Hexadecimální èíslo real je konstantou, která obsahuje èíslice 0 až  9 a
písmena A až F, následované písmenem R. Jako u hexadecimální konstanty musí
být  první  èíslice nìkterý ze symbolù 0  -  9.  Konstanta  musí  obsahovat
celkové poèet èíslic rovný 8, 16,  nebo  20,  pokud není první èíslice 0. V




                                  - 31 - 




takovém pøípadì musí být celkový poèet èíslic o jednu vìtší, t.j. 9,17 nebo
21. Tento datový typ také není podporován IBM Small Assemblerem. Napøíklad:

   HRNUM DD 0FAB12345R

8. Pseudoinstrukce EQU

   Návìští v poli jména  mùže  být pøiøazena hodnota výrazu v poli operandù
použitím  symbolu  EQU  nebo  použitím  znaménka rovnosti =.  Použitím  EQU
pøiøadíme promìnné hodnotu,  která  se v prùbìhu vykonávání programu nemùže
mìnit. Použijeme-li operátoru = (to  je  také  pseudoinstrukce  !), hodnota
konstanty se mùže bìhem vykonávání programu mìnit. Napøíklad:

   SCRADD EQU [BP+16]
   BASNUM = 1980

   V prvním  pøíkladì  je  symbol  SCRADD  substituován  namísto indexového
výrazu [BP+16]. Podobnì BASNUM mùže být používáno namísto èísla 1980. Navíc
teï mùže být symbolu  BASNUM  pøiøazena  nová  hodnota v prùbìhu vykonávání
programu.


   Jména segmentù

   Jméno  segmentu je uvedeno v poli  jména  deklarace  segmentu.  Pøíklad:
MYCODE SEGMENT PARA 'CODE'

   Pole operace

   Pole   operace   obsahuje   mnemonickou   zkratku   skuteèné   instrukce
mikroprocesoru. Mnemonická zkratka je dlouhá dva až šest písmen a pøipomíná
anglický  název  instrukce.  Použití  mnemoniky  vytváøí  kód  mnohem  lépe
srozumitelný  a  úroveò  mnemonických kódù je v podstatì isomorfní s úrovní
strojových  instrukcí  (zobrazení  do  strojové  úrovnì  provádí  konverzní
tabulka). Operace  uvedená  v  poli  operace  mùže  reprezentovat strojovou
instrukci, makroinstrukci nebo psudooperaci (pseudoinstrukci). Napøíklad:

   INITIAL MOV AX,0H

   INITIAL je zde  návìští  a  MOV  operace. Po poli operace následuje pole
operandù. Každá operace nejenom  øíká  assembleru,  co  má udìlat, ale také
specifikuje poèet operandù a jejich typ.

   Operace  mùže  obsahovat  odkaz  na  makro.  Taková  reference instruuje
assembler, aby zpracoval pøeddefinovanou sekvenci instrukcí. Assembler tedy
generuje  zdrojové  instrukce  stejnì  jako  by byly zapsány  ve  zdrojovém
programu jako jeho èást. Napøíklad:

   DOS_INT MACRO SERVICE_ID

   Tato operace øíká  assembleru,  že následující kód je èást makrodefinice
MACRO.  Pseudooperace (také: pseudoinstrukce) obvykle neprodukují  strojové
instrukce, ale øídí assembler tak, aby provádìl urèité  operace  na datech,
výpisech o pøekladu a makrodefinicích.





                                  - 32 - 




   Pole operandu

   Pole operandu obsahuje  data,  která  mají  být  zpracovávána instrukcí.
Jestliže instrukce vyžaduje jen jeden  nebo dva operandy, jsou od instrukce
oddìleny alespoò jednou  mezerou.  Jestliže má instrukce operandy dva, jsou
od  sebe  oddìleny  èárkou  (,).  Nìkteré  operace  však vùbec  nepotøebují
operandy.

   Jakmile operace  potøebuje dva operandy, je první operand nazýván cílový
a  druhý  zdrojový.  Pøíkladem  operací  vyžadujících  dva   operandy  jsou
instrukce pøesunu dat, registrové instrukce aj. Napøíklad:

   MOV AX,8

je pøíkladem bezprostøedního operandu. Zde  dojde  k  naplnìní  registru AX
èíslem 8.

   Pole poznámek

   Pole poznámek je poslední pole  a èasto to nejužiteènìjší. Pole poznámek
dává prostor pro interní komentáøe  a  dokumentaci  k  programu. Poznámkové
øádky jsou assemblerem ignorovány a  jsou užiteèné jen ve výpisu zdrojového
programu. Je-li operace opatøena  poznámkou,  je  tøeba umístit poznámku až
alespoò jednu mezeru  za  posledním  polem  operace  a  zaèínat  symbolem ;
(støedník).  Smyslem  použití  poznámek  je  popsat  ty   èásti  zdrojového
programu, které nejsou bezprostøednì srozumitelné. Napøíklad:

   MOV AH,45H ; parametr pro ètení znaku

   Jak lze vidìt z uvedeného pøíkladu, poznámka pomáhá pochopit, proè je do
registru AH zavedena hodnota 45H. V tomto pøípadì jde o parametr pøerušení,
kterému odpovídá urèitá operace BIOSu.


   Pøínos programování v assembleru

   V poèátcích  programování byly veškeré programy psány ve strojovém kódu.
Instrukce  byly  psány  v  hexadecimálním  nebo binárním tvaru a pak  pøímo
dekodovány technickými prostøedky. Jak  programy  rostly  co do velikosti a
složitosti, zvýšil se pronikavì  èas  potøebný k vývoji a ladìní softwaru a
vznikla potøeba nových, produktivnìjších metod k vytváøení programù.

   Assembler byl právì takovou  metodou.  Byl  jazykem lépe srozumitelným a
pochopitelným.  Automaticky udržoval  øadu  (zdánlivì  nekoneènou)  detailù
inherentních programu ve strojovém kódu. Neobsahoval nutnou  režii typickou
pro vyšší programovací  jazyky  a generoval programy, které byly vykonávány
velice rychle.

   Pøíklad programu v assembleru

   Uvedeme pøíklad pøeloženého programu v assembleru.  Pravá  strana našeho
programu obsahuje assemblerovský zdrojový kód, který lze snadno  èíst  a je
dobøe dokumentován. Spolu s tímto zdrojovým textem je na levé stranì uveden
i strojový ekvivalent symbolického zápisu.  Je  vidìt,  že  pro nezkušeného
programátora je assemblerovský program extrémnì "zašifrovaný".




                                  - 33 - 




Microsoft MACRO Assembler Version 5.0             Page 1-1

                                                  09-19-88
     1                    page ,132
     2                    ;Pro procesory 8086/80386
     3                    ;program ilustruje
     4                    ;hexadecimalni secitani
     5
     6 0000               STACK   SEGMENT PARA STACK
     7 0000 40            [ DB 64 DUP ('MYSTACK ')
     8                      4D 59 53 54
     9                      41 43 48 20
     10                           ]
     11
     12 0200              STACK   ENDS
     13
     14 0000              MYCODE  SEGMENT PARA 'CODE'
     15 0000              MYPROC  PROC FAR ;
     16                   ASSUME  CS:MYCODE,SS:STACK
     17 0000 1E           PUSH    DS
     18 0001 2B C0        SUB     AX,AX
     19 0003 50           PUSH    AX
     20
     21 ;NASLEDUJE SOUCET TRI CISEL (BEZPROSTREDNI ADRESOVANI)
     22 0004 B0 23        MOV     AL,23H  ;PRVNI CISLO
     23 0006 04 0A        ADD     AL,0AH  ;PRICTI 0AH K REG. AL
     24 0008 04 10        ADD     AL,10H  ;PRICTI 10H K REG. AL
     25                   ;KONEC PRIKLADU SECITANI,VYSLEDEK V REGISTRU AL
     26
     27 000A C0           RET             ; PREDEJ RIZENI DOSU
     28 000B              MYPROC  ENDP    ; KONEC PROCEDURY
     29 000B              MYCODE  ENDS    ; KONEC SEGMENTU
     30
     31                   END             ; KONEC PROGRAMU V ASSEMBLERU



   První  sloupeèek,  èísla  od  1  do  31,  jsou   èísla   øádkù  vkládaná
assemblerem.  Druhý sloupeèek obsahuje skuteèné adresy  pamìti,  v  níž  je
pøeložená  mnemonická operace (instrukce) uložena. Jsou to  šestnáctibitové
adresy reprezentované v hexadecimálním formátu.  Tøetí  a  ètvrtý sloupeèek
obsahují skuteèný tvar strojového kódu, který odpovídá  mnemonické operaci.
Tyto sloupeèky se mìní podle typu instrukce a poètu jejích operandù.

   Zbývající sloupeèky již odpovídají popsaným polím zdrojového  programu v
assembleru: pole jména, operace, operandu a poznámky. Øádky 2 až 4, 21 a 25
obsahují  jen  poznámky.  V dalších èástech  této  knihy  se  nauèíme  psát
programy respektující tvar naznaèený v našem pøíkladì.











                                  - 34 - 










                            K a p i t o l a   5

                            Úvod do assembleru


   V této kapitole budeme  podrobnì  diskutovat o tom, co assembler je, naè
je  potøeba  a  co  vlastnì  dìlá.  Prozkoumáme  podobné  i  rozdílné  rysy
assembleru  a  kompilátoru  vyššího  programovacího  jazyka.  Na  ukázkovém
programu budeme demonstrovat, jak vytváøet, pøekládat a spouštìt jednoduchý
assemblerovský program.

   Program SAMPLE.ASM je použit jako  model  programu  k  demonstraci všech
nezbytných souèástí assemblerovského programu.  Další  detaily  týkající se
instrukèního souboru 80286/80386 lze nalézt v kapitole následující.

   Assembler  je poèítaèový program vytvoøený tak,  aby  dovedl  èíst  text
zapsaný  podle  jistých  syntaktických  pravidel,  tzv.  zdrojový  program.
Zdrojový program je zapsán v anglických zkratkách, které  se  oznaèují jako
mnemonika. Assembler akceptuje tuto mnemoniku  a pøevádí ji na binární nuly
a jednièky, které jediné  jsou  pøirozeným  jazykem  mikroprocesoru. Taková
pøeložená verze zdrojového programu se nazývá strojový kód (program).

   Každá  mnemonika  je  smysluplná  zkratka pøíkazu reprezentujícího jednu
skuteènou  strojovou  instrukci.  Mnemonika  (témìø vždy) odpovídá skuteèné
instrukci poèítaèe. Mnemonika je to, co èiní program v assembleru èitelným,
lehce  vytvoøitelným  a  trasovatelným.  Pøímý  vztah  mezi   mnemonikou  a
strojovou  instrukcí umožòuje assembleru rychlý pøevod zdrojového  programu
na strojový kód.

   Pøekladaè vyššího programovacího jazyka provádí èinnost  podobnou  v tom
smyslu, že ète zdrojový program a pøevádí jej na strojový kód. Programování
ve vyšším programovacím jazyce poskytuje programátorovi  více  prostoru pro
soustøedìní se na  problém  samotný  a  dovoluje  mu  nezabývat  se detaily
ležícími o nìkolik úrovní níže (napø. které registry a jaká  pamìová místa
má  použít  atp.).  Výsledkem je program,  který  je  znaènì  nezávislý  na
konkrétním mikroprocesoru. Program ve vyšším programovacím jazyce  je dobøe
èitelný  a  jeho  struktura je velice podobná  obecnì  zapsanému  algoritmu
øešení daného problému. Mezi programem  ve  vyšším  programovacím  jazyce a
jeho  pøeloženým  tvarem  však není pøímý  vztah  jako  mezi  mnemonikou  a
strojovou instrukcí u assembleru. Pøeložený tvar programu je obvykle mnohem
vìtší než "dobøe"  napsaný  ekvivalentní program v assembleru. Nechceme tím
však  øíci,  že  kompilátory  nejsou  schopny  generovat  kvalitní kód.  Ve
skuteènosti byste asi po prvních  zkušenostech  s  assemblerem  radìji dali
pøednost kompilátoru nìkterého vyššího programovacího jazyka.









                                  - 35 - 




---------------------------------------------------------------------------
Strojový kód versus jazyk symbolických instrukcí
---------------------------------------------------------------------------


   Následující ukázka programu ilustruje  užiteènost  assembleru  a názornì
ukazuje pøímou korespondenci mezi instrukcí  assembleru  a  jejím strojovým
ekvivalentem. Oba fragmenty programù -  strojový kód i program v assembleru
-  jsou  z  funkèního  hlediska  identické. Oba provádìjí  urèité  nezbytné
inicializaèní operace, pak plní støadaè hodnotou uloženou v promìnné NUMONE
a nakonec ke støadaèi pøièítají hodnotu 3H :

     Strojový kód                   Ekvivalent v jazyce
                                    symbolických instrukcí
                                    (assembleru)
     --------------------------------------------------------------
     00011110                       PUSH            DS
     00101011                       SUB             AX,AX
     11000000
     01010000                       PUSH            AX
     10111000                       MOV             AX,MYDATA
     00000001
     11101100
     10001110                       MOV             DS,AX
     11011000
     10100001                       MOV             AX,NUMONE
     0000
     00000101                       ADD             AX,3H
     0011


   Výsledek  pøekladu  zdrojového  programu  v  assembleru  se  také nazývá
relokatibilní kód. Jakmile  máme  program ve tvaru relokatibilního kódu, je
možné jej pøímo zavést do pamìti a po nastavení pøíslušných vazeb spustit.

   Programování  ve  strojovém  kódu  je  èasovì  vysoce  nároèná  èinnost,
zatìžuje oèi a vytvoøený program nebývá snadné odladit. Jak  bylo  vidìt  v
pøedchozím pøíkladì,  není  bezprostøednì  zøejmé,  co  vlastnì  jednotlivá
binární èísla reprezentují - jsou to data nebo instrukce èi adresy ?

   Naštìstí  pro nás, máme k dispozici asemblery,  které  nám  pøi  procesu
vytváøení  strojového  programu pomáhají. Vidìli  jsme,  že  assemblerovská
verze pøedchozího fragmentu programu  je  mnohem  pochopitelnìjší  než její
strojový ekvivalent. Srozumitelné anglické zkratky nahradily nesrozumitelná
binární èísla.

   Všimnìme si  ještì filosofie vývoje mikroprocesorù firmy INTEL. INTEL se
snažil   zachovat   kompatibilitu    s   ostatními   èleny   své   "rodiny"
mikroprocesorù, poèínaje od prvních  procesorù  pøes 8080, 8088 a 8086 až k
souèasné  generaci.  To  znamená,  že  každá  nová  generace mikroprocesorù
pøichází s  rozsáhlejším  instrukèním  souborem,  hardwarovými vylepšeními,
zvýšenou rychlostí atp., pøièemž pøedchozí aplikace jsou zachovány. Protože
každý  nový   mikroprocesor   obsahuje   nadmnožinu   (superset)  instrukcí
pøedchozího mikroprocesoru, staré programy bude možné  vykonávat  buï zcela
beze  zmìn  nebo  jen   s   nepatrnými   úpravami  na  nejnovìjší  generaci




                                  - 36 - 




mikroprocesorù. To je smyslem  úsilí  o  zachováni kompatibility - uživatel
nemusí znovu vyvíjet stejný software.



---------------------------------------------------------------------------
Typický proces pøi výstavbì programù v assembleru
---------------------------------------------------------------------------


   Vytváøení programù v assembleru pøedstavuje sekvenci  nìkolika  krokù. V
podstatì mùžeme vydìlit tøi základní kroky:

   1.  Textovým editorem vytvoøíme zdrojový program

   2.  Pøeložíme  assemblerem  zdrojový  program  a  získáme  relokatibilní
       program

   3.  Spojováním   získáme   z   relokatibilního   programu   exekutabilní
       (proveditelný) kód ve tvaru .EXE souboru


   Alternativní metodou je vytvoøení souboru .COM. Podrobnì je tato možnost
diskutována v pøíloze ke  každému  assembleru.  Kromì tìchto tøí základních
krokù je do  vývojového  cyklu  vytváøení  assemblerovského  programu tøeba
zahrnout i další krok spoèívající v ladìní (debugging) programu, protože je
témìø nemožné, že hned napoprvé napíšete bezchybný assemblerovský program.

   KROK 1: Vytváøení zdrojového programu

   Vhodným  editorem (nejlépe obrazovkovým - full-screen editor)  vytvoøíte
zdrojový program s  extenzí  .ASM  a  uložíte  jej na disk nebo disketu pod
jménem tøeba SAMPLE.ASM.  Všimnìme  si  nyní  blíže  jednotlivých instrukcí
vašeho programu SAMPLE.ASM. První dva øádky programu

   1. ;PRIKLAD PROGRAMU PRO IBM 8088/80286
   2. ;PROGRAM PRO ZAPIS ZNAKU NA OBRAZOVKU


jsou poznámkami. Každý øetìzec  znakù,  pøed  nímž  je umístìn støedník, je
assemblerem ignorován. Zde  poznámka  vystihuje,  co  má  program provádìt.
Následující  èást  programu  obsahuje dva pøíkazy, SEGMENT (øádek 3) a ENDS
(øádek 5), které definují poèátek a konec urèitého celku v programu: zde je
to segment zásobníku STACK SEGMENT :

3. STACK SEGMENT  PARA 'STACK'
4.       DB       64 DUP ('STACK')
5. STACK ENDS


   Všechny tøi  uvádìné makroassemblery umožòují udržovat v pamìti až ètyøi
souèasnì aktivní segmenty:  CODE,  DATA, STACK a EXTRA. Segmentace umožòuje
dosažení dobøe strukturovaného, modulárního zdrojového programu.






                                  - 37 - 




   Øádek 3 obsahuje slovo  STACK  v poli návìští a specifikuje jméno, které
je segmentu pøiøazeno. Operand PARA specifikuje, že segment bude zaèínat na
16-bytové hranici (standardní paragraf)  v  pamìti.  Slovo 'STACK' na konci
øádku specifikuje jméno, které bude spojeno s tímto  segmentem  v køížových
referencích.

   Øádek  4  definuje  velikost  zásobníku,  64  D(efined)  B(ytes) a  øíká
assembleru, že má tato místa  v pamìti inicializovat slovem 'STACK'. Pøíkaz
ENDS na øádku 5 ukonèuje definici segmentu.

   Další tøi øádky programu definují a pojmenovávají segment dat - DATA:

6. DATA     SEGMENT PARA 'DATA'
7. MESAGE   DB 'JAK SE VAM TO LIBI, VAZENI ?','$'
8. DATA     ENDS



   Tento segment také zaèíná na 16-bytové hranici a v køížových referencích
bude vypsán jako 'DATA' (øádek 6). V tomto velice krátkém  datovém segmentu
je definována jen jedna promìnná  - MESAGE. Je specifikována jako øetìzcová
promìnná, inicializovaná hodnotou 'JAK SE VAM TO LIBI, VAZENI ?'.

   Je tøeba zdùraznit, že nìkteré assemblery jsou na umístìní segmentu DATA
(kde  jsou  definovány  a  referovány  promìnné)  velice  citlivé.  Všechny
pøíklady v tomto textu mají segment DATA umístìn na zaèátku  programu. Tyto
segmenty však mohou být umístìny i pod segmentem CODE. Jestliže je ve vašem
programu  segment  DATA  umístìn  na  zaèátku programu a  pøesto  dostáváte
chybové hlášení  kvùli umístìní datového segmentu, pøesuòte segment DATA na
konec vašeho programu.

   Øádek  9  definuje  zaèátek  segmentu  CODE, který leží opìt na  hranici
paragrafu (16 byte) a bude oznaèen slovem 'CODE' v køížových referencích:

9. CODE     SEGMENT  PARA 'CODE' ;DEFINUJ SEGMENT CODE


Všimnìte si poznámek na tomto a následujících øádcích.

   Následující øádek obsahuje návìští MAIN a deklaraci procedury PROC:

10.   MAIN     PROC     FAR ;PROCEDURA SE JMENUJE MAIN



   Procedury  jsou èásti programù, které jsou vykonávány  tak,  že  jsou  z
jiných  programù  volány.  Pøi  každém  vyvolání  procedury   je  procedura
provedena a øízení je vráceno zpìt volajícímu programu.

   Deklarace  procedury  zaèíná  symbolem PROC a konèí  symbolem  ENDP.  Za
symbolem PROC je uveden buï atribut NEAR nebo FAR. Tento  atribut informuje
assembler o tom, jaký typ skoku má assembler provést.  Ve  vìtšinì  pøípadù
atributy NEAR a FAR  urèují,  jaký typ návratové instrukce má být generován
pro  právì  pøekládanou  proceduru.  Volání  CALL  procedury  specifikované
atributem  NEAR ponechává na vrcholu zásobníku  jen  hodnotu  registru  IP,




                                  - 38 - 




zatímco volání  CALL  procedury  specifikované  atributem  FAR  uchovává do
zásobníku oba registry CS a IP (v uvedeném poøadí).

   Všechny  øádky  programu  se  samozøejmì  budou  ve   vašich  programech
vyskytovat v tìch èi onìch modifikacích. Každý program bude mít napø. jinak
dimenzován a inicializován segmenty  STACK  a  DATA.  Nebudou se však mìnit
následující  øádky  (11  až  17),  které   pøedstavují   standardní  prolog
assemblerovského programu. Pro tento prolog  budeme  také  používat širšího
názvu nutná programová režie .



---------------------------------------------------------------------------
Programová režie
---------------------------------------------------------------------------


   Následující   instrukce  ustavují  základní  vazby  na  tøi   definované
programové segmenty:

11.   ASSUME CS:CODE,DS:DATA,ES:DATA,SS:STACK


   Pøíkaz ASSUME øíká assembleru, že má spojit registr CS (Code  Segment) s
umístìním segmentu CODE, registry DS a ES (Data Segment a Extra  Segment) s
umístìním segmentu DATA a registr SS s umístìním segmentu STACK. Znamená to
tedy, že napø. instrukce mov ax,var naplní registr ax obsahem promìnné var,
jejíž adresa bude získána jako souèet obsahu registru DS a posunutí symbolu
var vzhledem k zaèátku segmentu DATA, na nìhož ukazuje DS.

   Následující tøi instrukce slouží  k  "zapamatování"  umístìní operaèního
systému: jakmile assemblerovský program skonèí svoji èinnost,  znovu ustaví
všechna nezbytná spojení.

12.      PUSH  DS    ;UCHOVEJ DS
13.      SUB   AX,AX ;NULUJ AX
14.      PUSH  AX    ;UCHOVEJ TAKE NULOVY OFFSET


   Øádek 12 ukládá aktuální obsah registru DS na vrchol zásobníku. Øádek 13
generuje nulovou hodnotu  pro  offset  a  na  øádku 14 je tato hodnota také
uložena do zásobníku.

   Uchování  staré  hodnoty  registru  DS  je  tak  snadné jako  jeho  nové
naplnìní. Registr DS však nemùže  být naplnìn hodnotou promìnné. To ukazují
øádky 15 a 16:

15.      MOV   AX,DATA  ;VEZMI DO A UMISTENI DATA
16.      MOV   DS,AX    ;NAPLN JIM REGISTR DS


   Naplnìní registru ES bude analogické:

17.      MOV   ES,AX





                                  - 39 - 




   V tomto pøíkladì ukazují oba registry na stejné pamìové místo. Øádek 17
je posledním øádkem programové režie  spojené  s  prologem assemblerovského
programu.

   Øádky  18 až 21 jsou vlastním algoritmem  našeho  programu.  Místo  nich
byste vložili svùj vlastní kód:

18.   ; PROGRAM PRO VYPIS ZPRAVY NA OBRAZOVKU
19.      LEA   DX,MESAGE   ;ADRESA ULOZENI ZPRAVY
20.      MOV   AX,09       ;PARAMETR DOSu
21.      INT   21H         ;VOLEJ PRERUSENI DOSu


   V tomto pøípadì bude náš program vypisovat na obrazovku text JAK  SE VAM
TO LIBI, VAZENI ?. Po vypsání  textu  program  ukonèí svoji èinnost - to je
náplní následujících øádkù:

22.         RET         ;NAVRAT RIZENI DO DOSu
23. MAIN ENDP        ;KONEC PROCEDURY MAIN
24. CODE ENDS        ;KONEC SEGMENTU CODE
25.         END         ;KONEC ZDROJOVEHO PROGRAMU


   Instrukce  RET  (øádek  22) vyzvedává návratovou adresu ze zásobníku a v
tomto pøípadì zajišuje návrat do  operaèního  systému.  Øádek  23 ukonèuje
definici procedury. Segment  CODE  je  ukonèen  pøíkazem ENDS na øádku 24 a
celý assemblerovský program  ukonèuje  instrukce END (øádek 25), která øíká
assembleru, že dosáhl konce zdrojového  programu.  Jestliže  uchováme tento
program  na  disku  jako  SAMPLE.ASM,  mùžeme  pøejít  ke druhému  kroku  v
programování v assembleru.

   KROK 2: generování relokatibilního kódu

   V následujícím  výkladu  si  ukážeme,  jak  co  nejjednodušeji generovat
soubor .OBJ - t.j. soubor uchovávající program v relokatibilním tvaru.

   Jestliže máme v jednotce A disketu s nìkterým z assemblerù a  v jednotce
B disketu se zdrojovým programem SAMPLE.ASM, jednoduše napíšeme

   B>A:MASM SAMPLE
   pro IBM Macro Assembler, nebo
   B>A:MASM SAMPLE
   pro Microsoft Assembler, nebo
   B>A:TASMB SAMPLE
   pro Turbo Editasm Assembler.


   V  pøípadì  Turbo  Editasm (na disketì pod názvem TASMB.EXE) zvolíme F7,
abychom  dostali   soubor  .OBJ.  Stiskneme  "A"  a  zaèneme  tak  pøeklad.
Implicitní jméno relokatibilního programu bude SAMPLE.OBJ.

   Všechny tøi zmínìné assemblery  nevyžadují  pøi  zadání jména souboru se
zdrojovým programem extenzi .ASM -  ta  se  pøedpokládá  implicite. Úspìšný
pøeklad vytvoøí soubor SAMPLE.OBJ a umístí  jej  na disketu v jednotce B. I
když SAMPLE.OBJ obsahuje  všechny  instrukce v jejich strojovém tvaru, není
to  ještì  program,  který mùžeme provádìt pod  operaèním  systémem.  Právì



                                  - 40 - 




SAMPLE.OBJ  je  vstupním  programem  do  poslední fáze pøi  programování  v
assembleru.

   KROK 3: spojování

   V tomto okamžiku je nutno  použít spojovací program (linker) LINK, který
transformuje  program SAMPLE.OBJ  do  proveditelného  programu  SAMPLE.EXE.
Podrobnì  je tento proces popisován v  pøíslušném  manuálu  ke  konkrétnímu
firemnímu assembleru.  Zde  si  ukážeme,  jak  jednoduše  vytvoøíme program
SAMPLE.EXE.

   Pøedpokládejme  opìt  program  SAMPLE.OBJ  na  disketì  v   jednotce  B,
spojovací program  LINK v jednotce A. Abychom vytvoøili program SAMPLE.EXE,
provedeme následující akci:

   B>A:LINK SAMPLE


   Po úspìšném ukonèení èinnosti spojovacího programu budeme mít na disketì
v jednotce B program SAMPLE.EXE. Mùžeme vyzkoušet jeho èinnost

   B>SAMPLE


   Po  vypsání  textu  na  obrazovku  program   automaticky   vrátí  øízení
operaènímu systému DOS, který se ohlásí výzvou B> .

































                                  - 41 - 































































                                  - 42 - 










                            K a p i t o l a   6

               ARCHITEKTURA : REGISTRY, PØÍZNAKY A INSTRUKCE



---------------------------------------------------------------------------
Mikroprocesor 80286
---------------------------------------------------------------------------


   Mikroprocesor 80286 má mnoho vyspìlých rysù navržených k dosažení vysoké
výkonnosti   a   vycházejících   vstøíc   potøebám   multiuživatelských   a
multiprogramových  aplikací.  Mikroprocesor  80286  má  vestavìnou  ochranu
pamìti pro operaèní systém  a  podporuje  výluènost  pøístupu uživatelských
programù k jejich datùm. Pøi kmitoètu taktovacích pulsù 10 MHz  provádí èip
80286 programy až 6x  rychleji  než obvod 8086 pøi taktovací frekvenci 4.77
MHz.

   Èip 80286 poskytuje kompatibilitu s programovým vybavením pro 8088/8086.
V  módu reálných adres (reálný mód) je  80286  kompatibilní  s  existujícím
relokatibilním kódem pro 8088/8086.  Ve  virtuálním  adresovém  módu (také:
privilegovaný mód, chránìný mód) je  80286  kompatibilní  s relokatibilními
programy  8088/8086  na  úrovni  zdrojových  programù,  ale   program  mùže
vyžadovat  jisté  úpravy,  aby  mohl  využívat  všechny  výhody virtuálního
adresového prostoru podporovaného obvodem 80286.



---------------------------------------------------------------------------
Základní architektura
---------------------------------------------------------------------------


   Obvod 80286 obsahuje osm 16-bitových  všeobecných registrù - AX, BX, CX,
DX, SP, BP, SI a DI. Registry AX, BX, CX a DX mohou být použity  jako úplné
16-bitové  registry,  nebo  mùže  být  každý  z  registrù rozdìlen  na  dva
osmibitové registry,  což  poskytuje  možnost  používat  až  8 osmibitových
registrù. Jména registrù  zakonèená  písmenem "X" (napø. BX) oznaèují úplné
registry.  Osmibitové  poloviny  jsou oznaèeny písmenem "L"  resp.  "H"  za
jménem registru (tedy AL resp. AH oznaèují dolní,  resp.  horní osmibitovou
polovinu šestnáctibitového registru AX).

   Šestnáctibitové registry SP (Stack  Pointer)  a  BP (Base Pointer) tvoøí
registrový pár, který je využíván pro manipulaci se  zásobníkem  a obsahuje
offset vzhledem k aktuálnímu zásobníku.  Registrový pár SI (Source Index) a
DI (Destination Index)  je  oznaèován jako indexové registry. Tyto registry
jsou užívány jako hodnoty  indexù,  jež mohou být zvyšovány a snižovány pøi
procházení komplexnìjšími datovými strukturami.




                                  - 43 - 




---------------------------------------------------------------------------
Segmentové registry
---------------------------------------------------------------------------


   Èip  80286 podporuje ètyøi souèasnì pøístupné  moduly  v  hlavní  pamìti
nazývané segmenty. Tyto ètyøi  segmenty  mohou  být  adresovány 16-bitovými
registry CS, DS, SS a ES .
   Kód  právì  vykonávaného  programu  pøítomného  v  operaèní   pamìti  je
adresován registrem CS (Code Segment). Báze (bázová adresa, adresa poèátku)
právì  aktivního  datového  segmentu  je  adresována  registrem   DS  (Data
Segment). Zásobníky používané k uložení mezivýsledkù a k volání podprogramù
mají také svùj vlastní segment SS (Stack Segment).  Programátor  mùže navíc
pøistupovat k druhému  aktivnímu  datovému  segmentu  nazývanému  ES (Extra
Segment), který je referován pøes registr ES.

   Adresace  elementu  uvnitø vybraného segmentu  je  zabezpeèena  vybráním
aktivního segmentu prostøednictvím jednoho ze 4 segmentových registrù - CS,
DS, SS nebo ES  a  specifikací 16-bitového offsetu vzhledem k bázové adrese
uložené ve vybraném segmentovém registru. Šestnáctibitová adresa segmentu a
16-bitový offset (posunutí vzhledem k poèátku segmentu = adrese v patøièném
segmentovém   registru)  vytváøejí  vyšší  a  nižší  polovinu   32-bitového
virtuálního adresového  ukazatele  do  pamìti.  Jakmile  je  jednou segment
vybrán, staèí jen specifikovat offset (nižších 16 bitù) v instrukci. Adresy
segmentù jsou interpretovány rùznì  v  závislosti na módu, v nìmž èip 80286
pracuje. V reálném módu segmentové  registry  obsahují  fyzické  adresy. Ve
virtuálním  (privilegovaném)  módu  obsahují  segmentové registry adresy do
virtuální pamìti a vyžadují translaci logické virtuální adresy na adresu ve
fyzické pamìti.



---------------------------------------------------------------------------
Indexové a bázové registry. Registry ukazatele
---------------------------------------------------------------------------


   Jak  jsme  již  uvedli,  fyzická  adresa  konkrétního   elementu  uvnitø
vybraného segmentu se získá kombinací  adresy  segmentu  a  offsetu. Offset
mùže  být  umístìn  v  libovolném  z  registrù  bázových  (base  register),
indexových (index register) nebo v registru ukazatele (pointer register).

   Operace  nad zásobníkem jsou umožnìny selektorem zásobníkového  segmentu
(stack segment selector)  SS  a  registry  SP (Stack Pointer) nebo BP (Base
Pointer).  Offsety vzhledem k registrùm DS a ES  jsou  získány  z  bázového
registru  BX,  komplikovanìjší  manipulace  s  daty  mohou   být  provedeny
používáním registrù SI (Source Index) a DI (Destination Index) ve spojení s
právì aktivním datovým segmentem.











                                  - 44 - 




---------------------------------------------------------------------------
Øídicí registry a registry stavu (FLAGS)
---------------------------------------------------------------------------


   Èip 80286 obsahuje registr  FLAGS  s 11 pøíznaky. Šest z tìchto pøíznakù
nazývajících se pøíznaky stavu  je  nastavováno  aritmetickými  a logickými
operacemi  a  pro  tyto  operace  poskytuje logické øídicí  podmínky.  Tyto
registry jsou oznaèeny jako pøíznak pøenosu CF (Carry Flag), pøíznak parity
PF  (Parity Flag), pøíznak pomocného pøenosu  AF  (Auxiliary  Carry  Flag),
pøíznak znaménka SF (Sign Flag) a pøíznak pøeteèení OF (Overflow Flag).

   -·pøíznak pøenosu CF  je  nastaven  na  1, když je generován pøenos nebo
výpùjèka pøi aritmetické operaci s  8-bitovými  nebo  16-bitovými operandy.
Jinak je nastaven na 0. CF je užíván také pøi instrukcích rotací a posunù a
obsahuje  pak  hodnotu  bitu  "vypadávajícího"  pøi  rotaci  nebo posunu  z
pøíslušného registru

   -·pøíznak parity PF je nastavován do 1 pøi generování liché parity  a do
0 pøi generování  parity  sudé.  Je  používán hlavnì pro aplikace spojené s
pøenosem dat.

   -·pøíznak pøídavného (pomocného) pøenosu AC je používán v BCD aritmetice
k indikaci, zda  byla  výpùjèka  z  / pøenos do nejnižší ètyøbitové èíslice
èísla reprezentovaného v kódu BCD

   -·pøíznak nuly ZF indikuje nulový výsledek operace tím, že se nastaví na
hodnotu 1

   -·pøíznak znaménka SF je nastaven do 1 v pøípadì záporného výsledku a do
0 v pøípadì výsledku kladného.

   -·pøíznak pøeteèení OF  indikuje  nastavením do 1 skuteènost, že operace
generovala  pøenos  do  nejvyššího bitu výsledku ale  nikoliv  souèasnì  ze
nejvyššího bitu nebo pøenos z nejvyššího bitu výsledku  ale  nikoliv pøenos
do tohoto nevyššího bitu (nonekvivalence).

   Tøi  z  11  pøíznakù  -  TF, IF a DF - se používají k  øízení  nìkterých
operací  procesoru.  Pøíznak  TF  (Trap  Flag) pøi svém  nastavení  pøepíná
procesor do krokového režimu a umožòuje odladìní programu. Pøíznak povolení
pøerušení  IE  (Interrupt  Enable) umožòuje pøi své  hodnotì  1  akceptovat
externí  pøerušení  a  pøi hodnotì 0 je nebere v úvahu.  Smìr  postupu  pøi
øetìzcových operacích urèuje pøíznak  DF  (Direction Flag). Pøi DF = 0 jsou
registry SI a  DE  automaticky  inkrementovány,  pøi  DF  =  1 jsou SI a DF
automaticky dekrementovány pøi procházení polem (øetìzcem).

   Pøíznaky IOPLF a  NTF  jsou  dva  nové pøíznaky, jež u pøedchozích èlenù
rodiny INTEL neexistovaly a  u  80286  jsou  využívány jen v privilegovaném
módu.  Dvoubitový IOPLF (Input/Output Privilege Level  Flag)  je  použit  k
tomu, aby instrukce vykonala jen ty operace, které má povoleny. Pøíznak NTF
(Nested  Task  Flag)  je  použit  k indikaci vnoøení právì provádìné  úlohy
(task)  do  jiné  úlohy (pøi multiprogramovém provozu). Pøi NT = 1 má právì
provádìný proces platné spojení (vazbu) s  pøedchozím  programem (procesem,
úlohou).





                                  - 45 - 




---------------------------------------------------------------------------
Registr adresy instrukce (instruction pointer)
---------------------------------------------------------------------------


   Registr adresy instrukce IP (Instruction Pointer) obsahuje offset adresy
pøíští vykonávané instrukce (vùèi CS) uvnitø právì aktivního segmentu CODE.
Umožòuje tak vytvoøení úplné 32-bitové adresy pøíští instrukce programu.



---------------------------------------------------------------------------
Stavové slovo procesoru (machine status word )
---------------------------------------------------------------------------


   Prvních pìt bitù  16-bitového  stavového  slova  procesoru  MSW (Machine
Status Word) obsahuje bit PE (Protection Enable)-nultý bit, bit MP (Monitor
CoProcessor)-první bit, bit  EM  (EMulate  Coprocessor)-druhý  bit,  bit TS
(Task Switched)-tøetí bit a ET (Processor Extension Type)-bit ètvrtý.

 -·PE je použit k aktivaci privilegovaného  módu  èipu 80286. Je-li PE = 0,
pracuje procesor v reálném módu. Pøi PE = 1 je aktivován privilegovaný mód.
 -·MP  je  použit  spolu  s  bitem  TS  ke zjištìní, zda operace WAIT  bude
generovat chybový stav "koprocesor není pøítomen" pøi TS = 1.
 -·EM  pøi  nastavení  do 1 zpùsobí,  že  všechny  kódy  koprocesoru  budou
vyvolávat chybový stav "koprocesor není pøítomen". Pøi EM = 0 budou všechny
operaèní kódy koprocesoru skuteènì realizovány koprocesorem 80287/80387.
 -·TS je nastaven do 1  automaticky, kdykoliv je provedena operace pøepnutí
úlohy  (programu)   (task  switching).  Pøi  TS·  =·1  budou  všechny  kódy
koprocesoru vyvolávat trap "koprocesor není pøítomen".



---------------------------------------------------------------------------
Mikroprocesor 80386
---------------------------------------------------------------------------


   Èip 80386  je  32-bitový  mikroprocesor  navržený  k  podpoøe operaèních
systémù optimalizovaných pro  režim  práce  více  úloh  (multitasking). Èip
80386 má 32-bitové registry a datové  cesty  a  je tedy s to podporovat 32-
bitové adresní módy. 80386 je schopen adresovat až 4 GB fyzické pamìti a 64
TB  (terrabyte  !)  pamìti  virtuální.  Integrovaná  architektura  správy a
ochrany  pamìti  v  sobì zahrnuje registry pro  translaci  adres,  ochranný
mechanismus pro podporu  operaèních  systémù a vyspìlý hardware pro podporu
režimu práce více úloh.

   Øetìzené zpracování instrukcí (pipelining), velká šíøka sbìrnice a pøímá
translace adres na èipu  80386  výraznì  zkracují prùmìrnou dobu vykonávání
instrukce  a  implikují  tak  vysokou   prùchodnost   systému.   Tento  rys
architektury 80386 se projevuje v  jeho rychlosti : 80386 pracuje rychlostí
3 - 4 milióny instrukcí za sekundu (pøi frekvenci  taktovacích  impulsù  16
MHz).





                                  - 46 - 




   Dalšími rysy 80386 je pøímý  pøístup k rychlé vyrovnávací pamìti (cache)
pro translaci stránek, self-test  a  4  nové trasovací registry (breakpoint
registers). Èip 80386 je kompatibilní na úrovni relokatibilního kódu s èipy
8088/8086/80286.



---------------------------------------------------------------------------
Datové typy 80386
---------------------------------------------------------------------------


   Èip 80386 podporuje nìkolik dalších datových  typù.  Podporuje pøedevším
32-bitová celá  èísla integer s/bez znaménka (signed and unsigned integers)
a pole bitù  v  délce  1  až  32  bitù.  Èip také podporuje standardní typy
ukazatelù jako 8086/80286 a pøidává k nim ukazatel offsetu (32 bitù)  a 48-
bitový úplný ukazatel.



---------------------------------------------------------------------------
Adresování operandù u 80386
---------------------------------------------------------------------------


   Kromì 8-bitových a 16-bitových  bezprostøedních  operandù  podporuje èip
80386 také operandy o délce  32  bitù  s  tím,  že  pole  pro bezprostøední
operand je rozšíøeno z 16 na 32 bitù. Je-li specifikován 32-bitový operand,
instrukce  RET  a  ENTER pracují s 16-bitovým  bezprostøedním  operandem  s
nulami doplnìnými do délky 32 bitù.



---------------------------------------------------------------------------
Výpoèet efektivní adresy u 80386
---------------------------------------------------------------------------


   Pøi pøístupu k segmentu delšímu než 64 kB mùže být efektivní  adresa jak
32-bitová, tak i  16-bitová.  Efektivní adresa je vytvoøena seètením obsahù
(pøípadnì použitého) bázového registru  a  (pøípadnì  použitého) indexového
registru a  (také pøípadného) pøemístìní. Kromì toho byly 32-bitové adresní
módy rozšíøeny tak, aby umožnily použití  libovolného  všeobecného registru
jako bázového èi indexového.



---------------------------------------------------------------------------
Provádìní kódu mikroprocesoru 8086 na 80386
---------------------------------------------------------------------------


   Èip 80386 má 2 módy èinnosti : reálný  a  privilegovaný.  Reálný  mód je
stejný jako u 80286  a  je módem nastaveným po RESETu mikroprocesoru 80386.
Virtuální    mód    napodobující    mikroprocesor   8086   je   podmnožinou
privilegovaného  módu  èipu   80386   a   umožòuje,   aby   instrukèní  kód



                                  - 47 - 




mikroprocesoru 8086 mohl být provádìn  v  rámci  privilegovaného  módu èipu
80386 pøi stránkovaném režimu práce procesoru.



---------------------------------------------------------------------------
Základní architektura èipu 80386
---------------------------------------------------------------------------


   Mikroprocesor  80386 poskytuje programátorovi 32 registrù. Registry  lze
rozdìlit do sedmi hlavních kategorií:

   - všeobecné registry
   - segmentové registry
   - registry adresy instrukce a pøíznaky
   - øídicí registry
   - registry systémových adres
   - ladicí a testovací registry

   Uvedené  registry  jsou  nadmnožinou  registrù  obvodù  8086   a  80286;
mikroprocesor 80386 tedy obsahuje všechny registry èipù 8086 a 80286.



---------------------------------------------------------------------------
Soubor všeobecných registrù
---------------------------------------------------------------------------


   Osm  všeobecných  registrù   èipu   80386  má  podobné  použití  jako  8
všeobecných registrù  u  80286  s  tím,  že  jsou široké 32 bitù. Všeobecné
registry jsou s to podpoøit operandy dlouhé 1,  8,  16  a  32 bitù a bitová
pole  délky  1  až 32 bitù. Tyto registry jsou oznaèeny jako EAX (støadaè),
EBX (bázový registr), ECX  (èítaè),  ESP  (ukazatel zásobníku), EDX (datový
registr),  EBP  (ukazatel  báze),  ESI  (zdrojový indexový registr)  a  EDI
(cílový indexový registr).

   Abychom  získali  pøístup  ke  všem  32-bitovým  registrùm,  je tøeba  v
referenci na nì použít prefixu "E". Každý z 8 všeobecných registrù mùže být
rozdìlen do 16-bitových ekvivalentù èipù 8086/80286 - staèí vypustit prefix
"E" v odkazu na registr.



---------------------------------------------------------------------------
Segmentové registry
---------------------------------------------------------------------------


   Èip 80386 obsahuje  šest  16-bitových  segmentových  registrù.  Tìchto 6
registrù  uchovává  hodnoty   selektorù  ukazujících  na  právì  adresovaná
pamìová místa. V  reálném  adresovém  módu  mùže mít segment velikost od 1
byte po maximum 64 kB. V privilegovaném módu je možné pracovat  se segmenty
o velikosti 1 byte až 4 GB.




                                  - 48 - 




   Soubor 6-ti 16-bitových registrù obsahuje registry CS (Code Segment), DS
(Data Segment), SS (Stack Segment), ES (Extra Segment) a registry FS  a GS.
Registry GS a FS jsou pøidány  proto,  aby byla zmírnìna "zácpa" v registru
ES  a  aby byly lépe získány hodnoty  indexového  a  bázového  registru  ze
souboru všeobecných registrù.



---------------------------------------------------------------------------
Registr adresy instrukce a EFLAGS
---------------------------------------------------------------------------


   Èip 80386 obsahuje 32-bitový registr adresy instrukce oznaèený jako EIP.
Registr EIP uchovává  hodnotu  offsetu  pøíští  provádìné  instrukce. Tento
offset  je  vždy  relativní  vzhledem  k bázi právì aktivního segmentu  CS.
Nižších 16 bitù registru EIP lze referovat samostatnì a  oznaèují  se  jako
registr IP. Tyto bity jsou užívány pøi 16- bitové adresaci.

   Registr EFLAGS má u èipu 80386 délku 32 bitù. Registr EFLAGS je použit k
øízení jistých operací a  indikuje  stav èipu 80386. EFLAGS obsahuje 2 nové
pøíznaky  (ve  srovnání  s 80286): VM (Virtual 8086 Mode flag) a pøíznak RF
(Resume Flag). EFLAGS obsahuje stejné øídicí a logické pøíznakové bity jako
èipy 8086/80286.

   Pøíznak VM povoluje  virtuální  mód  èipu  8086.  Pøi VM = 1 a nastavení
80386 do privilegovaného módu bude  èip 80386 "pøepnut" do virtuálního módu
8086 a všechny operace  se  segmentem  budou  provádìny jakoby probíhaly na
èipu 8086. Pøi této emulaci èipu 8086 bude obvod  80386  generovat  výpadky
(faults) pøi privilegovaných operaèních kódech.

   Pøíznak  RF  je  využit  spolu  s  ladicím  registrem k  nastavení  bodù
zastavení nebo k nastavení  "krokování"  procesoru. Pøi RF = 1 jsou všechny
výpadky u pøíští vykonávané instrukce  ignorovány.  RF  je  pak automaticky
nastavován na 0 pøi úspìšném dokonèení každé instrukce.



---------------------------------------------------------------------------
Øídicí registry
---------------------------------------------------------------------------


   Obvod 80386 obsahuje 4 32-bitové registry : CR0, CR1, CR2  a  CR2 . Tyto
registry  obsahují  informace  o  stavu  procesoru.  Pøístup  ke kontrolním
registrùm je umožnìn instrukcemi typu load a store.

   Registr CR0 obsahuje 6  pøeddefinovaných  pøíznakù  urèených  pro øízení
mikroprocesoru a pro zjišování jeho stavu.  Bity  0 - 15 registru CR0 jsou
oznaèovány také jako stavové slovo  procesoru  MSW  (Machine  Status Word),
vytváøejíce tak  kompatibilitu 80386 s 80286 v privilegovaném módu. Pøíkazy
LMSW a  SMSW  pracují  stejnì  u 80386 i 80286. Pøi pøístupu k registru CR0
musí programátor použít pøíkazu MOV CR0,registr.






                                  - 49 - 




   Bity ET, TS, EM, MP a PE mají stejný význam jako  u  èipu  80286. Øídicí
registr CR1 je vyhražen  pro  pøíští aplikace firmy INTEL. CR2 obsahuje 32-
bitovou lineární adresu pamìti, která zpùsobila poslední detekovaný výpadek
stránky. CR3 obsahuje fyzickou adresu báze tabulky stránek. Protože tabulka
stránek je u 80386 vždy svázána po jednotlivých stránkách, je nejnižších 12
bitù registru CR3 pøi zápisu ignorováno.



---------------------------------------------------------------------------
Registry systémových adres
---------------------------------------------------------------------------


   Mikroprocesor 80386  obsahuje 4 speciální registry, které jsou použity k
odkazùm  na  tabulky  nebo   segmenty   podporované   privilegovaným  módem
80286/80386. Tabulka GDT (Global Descriptor Table),  LDT  (Local Descriptor
Table)  a  TST  (Task Segment Table)  mají  své  adresy  uloženy  v  tìchto
speciálních  registrech. Registry systémových adres a systémových  segmentù
jsou oznaèeny GPTR, IDTR, LDTR a TR.

   Registry  GPTR  a  IDTR jsou 32-bitové registry,  které  uchovávají  32-
bitovou hodnotu lineární adresy báze  a 16- bitový limit tabulky globálních
(GTR) a lokálních (LTR)  deskriptorù.  LDTR  a  TR jsou 16-bitové registry,
které uchovávají 16-bitový selektor pro segmenty LDT a TST.



---------------------------------------------------------------------------
Ladicí a trasovací registry
---------------------------------------------------------------------------


   Mikroprocesor  80386 umožòuje programátorovi pøístup k šesti  32-bitovým
ladicím registrùm -  DR0, DR1, DR2, DR3 DR6, DR7 . DR4 a DR5 jsou vyhrazeny
pro firmu INTEL. Registr pro øízení  ladìní  DR6 je použit k nastavení bodù
zastavení (breakpoints). DR7 zobrazuje aktuální stav v bodech zastavení.

   Èip 80386 obsahuje také dva  32-bitové  testovací  registry,  které jsou
použity  k  øízení  testování  RAM  a  CAM  (Content Addressable  Memory  -
asociativní pamì) v bloku pøedvýbìru instrukcí. TR6 je použit jako registr
testu  pøíkazù  a  TR7 jako datový  registr  uchovávající  data  v  bufferu
pøedvýbìru instrukcí.



---------------------------------------------------------------------------
Zpracování výjimeèných stavù u 80286/80386
---------------------------------------------------------------------------


   Výjimeèný  stav  (výjimka,  exception)  je  vnitøní  událostí,   jež  je
detekována hardwarem bìhem  provádìní instrukce. Výjimka zpùsobí generování
pøerušení   a  provedení  odpovídajícího  programu  zpracovávajícího   toto
pøerušení. Jako synonyma pro výjimku (exception) se užívá  pojmù  trap nebo
fault  (srv.  [2]).  Zde  se  soustøedíme  jen  na problematiku  výjimek  u



                                  - 50 - 




procesoru  80286,  i  když  výjimky  generované  procesorem  80386  jsou  v
následující kapitole u všech instrukcí rovnìž uvedeny.

   V privilegovaném módu procesoru  80286  jsou  všechny reference na pamì
provìøovány vzhledem  k oprávnìnosti adresace pamìového místa a ke zpùsobu
pøístupu k tomuto místu.  Porušení  pravidel  ochrany pamìti vestavìných do
procesoru 80286 zpùsobí  pøedání  øízení  programu  pro  obsluhu pøerušení.
Pøerušení generovaná výjimkami mají stanovené  pozice  v  tabulce pøerušení
(IDT, Interrupt Descriptor Table) a shrnuje je následující tabulka.

               Tab. 6.1: Výjimky v privilegovaném módu 80286

       -------------------------------------------------------------
       Zkratka Èíslo pøerušení (v IDT) Popis
       -------------------------------------------------------------
       #UD               6        Nedefinovaný operaèní kód
       #NM               7        Není k dispozici matematická
                                  jednotka
       #DF               8        Dvojitá výjimka/výpadek
       #MP               9        Chyba ochrany matematické
                                  jednotky
       #TS               10       Neplatný segment stavu úlohy
       #NP               11       Nepøítomen/není k dispozici
       #SS               12       Chyba zásobníku
       #GP               13       Všeobecná výjimka porušení
                                  ochrany pamìti = všeobecná
                                  výjimka privilegovaného módu
       #MF               16       Matematická chyba
       -------------------------------------------------------------


   V  reálném  módu  procesoru  80286  je  v  prùbìhu zpracování  instrukcí
provádìno mnohem ménì kontrol a  je tedy generováno podstatnì ménì výjimek.
Jedna  z  èasto  se  vyskytujících  výjimek je všeobecná  výjimka  porušení
ochrany  pamìti;  dále  se èasto vyskytuje výjimka/pøerušení INT 13, jež je
generována  vždy,  když  je referován slovní operand  na  adrese  (offsetu)
OFFFFH v nìkterém segmentu (druhý byte by totiž mìl vzhledem k referovanému
registru offset 10000H,  což  pøesahuje  adresovací  kapacitu  segmentu (64
Kbyte).

   V popisu každé instrukce v  následující  kapitole  jsou  uvedeny všechny
výjimky,  které  mohou  být  v  prùbìhu jejího vykonávání generovány jak  v
reálném, tak i v privilegovaném módu.
















                                  - 51 - 































































                                  - 52 - 










                            K a p i t o l a   7

               Instrukèní soubor mikroprocesorù 80286/80386


   Pro struènost budeme reálný mód oznaèovat RM a privilegovaný mód PM

AAA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     AAA - nastav ASCII po sèítání v AL

Èasování:                      3 (80286), 4(80386)

Popis:                         Instrukce AAA by nìla  být  vykonána  jen po
                               instrukci  ADD, která ponechává v AL  bytový
                               výsledek.   AAA   konvertuje   obsah  AL  na
                               nesbalenou  dekadickou  èíslici.  AAA zkoumá
                               nižší  4  bity  registru  AL a hledá validní
                               èíslo v kódu BCD v  rozsahu  0  až  9. Ètyøi
                               vyšší   bity  AL  pøitom  nastavuje  do   0.
                               Jestliže   došlo   k   dekadickému  pøenosu,
                               pøíznaky  AF  a  AC  jsou  nastaveny  na  0.
                               Jestliže hodnota obsažená  v  nižším pùlbytu
                               je vìtší nìž 9 nebo je AF nastaven do 1, pak
                               AAA provádí následující akce: AL  je zvìtšen
                               o 6, AH je  zvìtšen  o  1,  pøíznaky AF a AC
                               jsou nastaveny do 1  a  vyšší  bity  AL jsou
                               vynulovány.

Syntaxe:                       AAA (žádné operandy)

Ovlivòuje pøíznaky:            AF, CF

Nedefinované pøíznaky:         OF, ZF, SF, PF

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       ADD AL,BL    ; Seèti èísla BCD v AL a BL
                               AAA               ;   získej    výsledek   v
                               nesbaleném tvaru

AAD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     AAD - nastav ASCII AX pøed dìlením



                                  - 53 - 




Èasování:                      3 (80286), 4 (80386)

Popis:                         Instrukce  AAD  zpracovává  èíslo  vyjádøené
                               jako  2  nesbalené  dekadické èíslice v kódu
                               BCD (nižší èíslice je v AL, vyšší je v AH) a
                               pøipravuje je k operaci dìlení,  které vrací
                               výsledek v nesbaleném tvaru. AL  je nastaven
                               na  AL  +  (AH  x  10)  a  AH je  vynulován.
                               Výsledek  je  v  AX  a  je  roven  binárnímu
                               ekvivalentu       pùvodního      nesbaleného
                               dvoumístného èísla.

Syntaxe:                       AAD (žádné operandy)

Ovlivòuje pøíznaky:            SF, ZF, PF

Nedefinované pøíznaky:         OF, AF, CF

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       AAD ; použito pøed dìlením

AAM (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     nastav ASCII AX po násobení

Èasování:                      16 (80286), 17 (80386)

Popis:                         AAM  nastaví  výsledek  v  registru   AX  po
                               násobení dvou nesbalených dekadických èísel.
                               Tato  instrukce by  mìla  být  provedena  po
                               instrukci MUL. Protože výsledek je menší než
                               100, je celý obsažen  v  registru  AL  . AAM
                               rozvíjí  sbalený tvar výsledku v AL tak,  že
                               dìlí  AL deseti a ponechává kvocient  (vyšší
                               èíslici) v AL a zbytek (nižší èíslici) v AH.

Syntaxe:                       AAM (žádné operandy)

Ovlivòuje pøíznaky:            SF, ZF, PF


Nedefinované pøíznaky:         OF, AF, CF

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       AAM ; použito po násobení



                                  - 54 - 




AAS (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     nastav ASCII AL po odeèítání

Èasování:                      3 (80286), 4 (80386)

Popis:                         Úèelem instrukce AAS je korigovat výsledek v
                               registru  AL  po  odeèítání dvou nesbalených
                               dekadických  operandù.  Výsledek  je  rovnìž
                               uložen v nesbaleném  dekadickém  tvaru. Toho
                               je  dosaženo  aplikací  následujících krokù:
                               je-li nižší pùlbyte v AL  vyšší  než  9 nebo
                               AF=1, pak se AL zvýší o 6 a AH o 1. Pøíznaky
                               CF a AF  jsou  nastaveny  na  1.  Jinak jsou
                               nulovány  CF a AF. Pùvodní hodnota  registru
                               AL  je tedy  nahrazena  bytem,  jehož  vyšší
                               polovina  je  nulová  a  nižší  polovina  je
                               èíslem v rozsahu 0 - 9.

Syntaxe:                       AAS (žádné operandy)

Ovlivòuje pøíznaky:            AF, CF

Nedefinované pøíznaky:         OF, SF, ZF a PF

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       AAS ; použito po odeèítání

ADC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     seèítání s pøenosem

Èasování:                      2 - 7 (80286), 2 - 7 (80386)

Popis:                         Seèítá dva  operandy  s  pøenosem  - provádí
                               celoèíselné seèítání. Je-li nastaven pøíznak
                               CF, je k souètu dvou operandù  pøiètena  1 a
                               výsledek je vrácen na místo urèení.

Syntaxe:                       ADC destination,source

Ovlivòuje pøíznaky:            OF, SF, ZF, AF, PF, CF

Nedefinované pøíznaky:         žádné

Výjimky v RM:                  pro  slovní operand  s  offsetem  0FFFFH  je
                               generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù



                                  - 55 - 




Pøíklad:                       Seètìme bezprostøední operand s pøenosem  do
                               støadaèe:
                                  ADC  AL,4
                                  ADC  AX, 298
                                  ADC  EBX, 22334455H ; (jen pro 80386)

                               Seètìme bezprostøední operand s pøenosem  do
                               registru nebo na pamìové místo:
                                  ADC  CX,341
                                  ADC  BL,10
                                  ADC  TABLE[SI],2
                                  ADC  MEMORY,6293
                                  ADC  NUMBER,12345678 (jen pro 80386)

                               Seètìme  data  s  pøenosem  z   registru  do
                               registru,  registru  do  pamìti,  pamìti  do
                               registru
                                  ADC  DL,BL
                                  ADC  MEM_WRD,AX
                                  ADC  SI,MEM_WRD

ADD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     seèítání

Èasování:                      2-7 (80286), 2-7 (80386)

Popis:                         ADD provádí seèítání dvou operandù. Výsledek
                               je uložen v cílovém operandu.


Syntaxe:                       ADD destination, source

Ovlivòuje pøíznaky:            AF, CF, OF, PF, SF, ZF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je-li  výsledek   v   segmentu  nepøístupném
                               zápisu,  je  generována   všeobecná  výjimka
                               porušení  ochrany  pamìti.  Pro  nedovolenou
                               efektivní adresu operandu  nacházející  se v
                               registrech  CS, DS  nebo  ES  je  generována
                               rovnìž   všeobecná   výjimka.   Jestliže  SS
                               obsahuje nedovolenou  adresu,  je generována
                               výjimeèná situace "chyba zásobníku".

Výjimky v RM:                  pro  slovní operand  s  offsetem  0FFFFH  je
                               generováno pøerušení INT 13.


Poznámka pro 80386:            šíøka slova je 32 bitù


Pøíklad:                       Z registru do registru:
                                  ADD  AX,BX



                                  - 56 - 




                                  ADD  EBX,ECX        (jen pro 80386)

                               Z registru do pamìti
                                  ADD  EXTMEM,AX

                               Z pamìti do registru
                                  ADD  DX,BUFF

                               Bezprostøední operand do støadaèe
                                  ADD  AL,4
                                  ADD  EAX,98765432H (jen pro 80386)

                               Bezprostøední operand do registru
                                  ADD  CX,1985

                               Bezprostøední operand do pamìti
                                  ADD  EXTMEM,23

AND (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     logický souèin dvou operandù

Èasování:                      2-7 (80286), 2-7 (80386)

Popis:                         Výsledek  obsahuje  jednièkované  ty  bitové
                               pozice, které mìly hodnotu 1 u cílového  i u
                               zdrojového  operandu;   jinak   jsou  pozice
                               nulovány. Pøíznaky OF a CF jsou nastaveny do
                               0.

Syntaxe:                       AND destination, source

Ovlivòuje pøíznaky:            OF = 0, CF = 0, PF, SF, ZF

Nedefinované pøíznaky:         AF

Výjimky v PM:                  Je-li  výsledek   v   segmentu  nepøístupném
                               zápisu,  je  generována   všeobecná  výjimka
                               porušení  ochrany  pamìti.  Pro  nedovolenou
                               efektivní adresu operandu  nacházející  se v
                               registrech  CS, DS  nebo  ES  je  generována
                               rovnìž   všeobecná   výjimka.   Jestliže  SS
                               obsahuje nedovolenou  adresu,  je generována
                               výjimeèná situace "chyba zásobníku".

Výjimky v RM:                  pro  slovní operand  s  offsetem  0FFFFH  je
                               generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       Bezprostøední operand do registru
                                  AND  BL,11001110B
                                  AND  EAX,11101011001100110001110000111001B
                                       (jen pro 80386)




                                  - 57 - 




                               Bezprostøední operand do pamìti
                                  AND  EXTMEM,10011100B
                                  AND  NUMBER,0F0F0F0F0H (jen pro 80386)

                               Bezprostøední operand do støadaèe
                                  AND  AX,1011100101011100B
                                  AND  AL,MASK_BYTE

                               Z registru do pamìti
                                  AND  EXTMEM,SI

                               Z registru do registru
                                  AND  AX,BX
                                  AND  EAX,ECX   (jen pro 80386)

                               Z pamìti do registru
                                  AND  DH,EXTBYTE

ARPL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav pole RPL selektoru

Èasování:                      10-11 (80286), 20-21 (80386)

Popis:                         Instrukce  ARPL  je  navržena  k  tomu,  aby
                               zabránila   systémovým    programùm   získat
                               pøístup  k  podprogramùm   s   vyšší  úrovní
                               priority.  První  operand  instrukce ARPL je
                               16-bitová  pamìová  promìnná  nebo  registr
                               délky  slova,   která(ý)   obsahuje  hodnotu
                               selektoru. Druhý operand je registr  o délce
                               slova. Je-li pole  RPL  (Requested Privilege
                               Level)  1.  operandu  menší  než   pole  RPL
                               druhého  operandu,  je  pøíznak  nuly   (ZF)
                               nastaven do 1.  Pole RPL prvního operandu je
                               zvýšeno tak, aby se  shodovalo  s  polem RPL
                               druhého operandu. Jinak  je ZF nastaven do 0
                               a první operand instrukce ARPL není nikterak
                               modifikován.

Syntaxe:                       ARPL (selektor, CS_selektor)

Ovlivòuje pøíznaky:            ZF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je-li  výsledek   v   segmentu  nepøístupném
                               zápisu,  je  generována   všeobecná  výjimka
                               porušení  ochrany  pamìti.  Pro  nedovolenou
                               efektivní adresu operandu  nacházející  se v
                               registrech  CS, DS  nebo  ES  je  generována
                               rovnìž   všeobecná   výjimka.   Jestliže  SS
                               obsahuje nedovolenou  adresu,  je generována
                               výjimeèná situace "chyba zásobníku".




                                  - 58 - 




Výjimky v RM:                  Je  generováno  pøerušení INT  6.  Instrukce
                               ARPL není v RM rozpoznána.

Poznámka pro 80386:            -

Pøíklad:                       ARPL MEM_WRD,BX

BOUND (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Konroluj index pole vzhledem k jeho hranicím

Èasování:                      13 (80286), 10 (80386)

Popis:                         Operace BOUND je používána k zajištìní toho,
                               že  index  pole  je  v  mezích  definovaných
                               dvouslovním blokem v  pamìti.  První operand
                               (registr) musí být vìtší nebo  roven prvnímu
                               slovu v  pamìti,  a  menší  než  nebo  roven
                               druhému  slovu  v  pamìti.  Nejsou-li   tyto
                               podmínky splnìny, generuje se INT 5.

Syntaxe:                       BOUND destination, source

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v RM:                  Jestliže test na hranice pole neuspìje (t.j.
                               index prvku pole leží  mimo  meze  pole), je
                               generováno  pøerušení  INT  5.  Je-li   daný
                               operand  na offsetu  0FFFDH  èi  vyšším,  je
                               generováno  pøerušení  INT 13.  Je-li  druhý
                               operand registr, je generováno pøerušení INT
                               6.

Výjimky v PM:                  Jestliže  test na hranice pole neuspìje,  je
                               generováno  pøerušení  INT  5. Pro neplatnou
                               efektivní adresu operandu  v  registrech CS,
                               DS  a ES  je  generována  všeobecná  výjimka
                               privilegovaného módu. Pøi neplatné adrese  v
                               SS je generována výjimka "chyba zásobníku".

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                       BOUND AX,MEM_WRD
                               BOUND EBX,NEW_WORD ; (jen pro 80386)

CALL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Volání procedury

Èasování:                      7-185 (80286), 3-275 (80386)





                                  - 59 - 




Popis:                         Instrukce CALL zpùsobuje,  že  adresa pøíští
                               vykonávané instrukce je uchována v zásobníku
                               a  øízení  programu   je   pøedáno  operandu
                               instrukce CALL. Po ukonèení volané procedury
                               vykonává    volající    program    instrukce
                               následující bezprostøednì za instrukcí CALL.

Syntaxe:                       CALL operand
Ovlivòuje pøíznaky:            žádné  (výjimkou  je  pøípadné pøepnutí úloh
                               (task switching))

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  a)   volání   "FAR   CALLS":  je  generována
                               všeobecná   výjimka  privilegovaného   módu,
                               výjimka  "deskriptor   neexistuje",  výjimka
                               "chyba   zásobníku"   a   výjimka  "neplatný
                               segment stavu úlohy".

                               b) volání "NEAR direct CALLS": je generována
                               všeobecná  výjimka  privilegovaného  módu  v
                               pøípadì,  že  procedura  je lokalizována vnì
                               segmentu CS

                               c)   volání   "NEAR  indirect   CALLS":   je
                               generována všeobecná výjimka privilegovaného
                               módu pøi neplatné efektivní adrese  operandu
                               v  segmentových registrech CS, DS nebo ES  a
                               nebo výjimka "chyba zásobníku" pøi  neplatné
                               adrese  v  segmentu  SS.  Všeobecná  výjimka
                               privilegovaného  módu  je  generována také v
                               pøípadì, že je získán nepøímý  offset ležící
                               mimo hranice segmentu CS.

Výjimky v RM:                  Je generováno pøerušení INT 13 v pøípadì, že
                               slovní operand má offset 0FFFFH.

Poznámka pro 80386:            Slovní operand  má  šíøku  32  bitù, operand
                               typu ukazatel má šíøku 48 bitù.

Pøíklad:                          CALL ADDER ; procedura je uvnitø nebo vnì
                               segmentu

                               pro 80386:
                                  CALL IMMPTR  ;  Operand  typu ukazatel je
                               48-bitový

                                  CALL DISP16 ;  Užívá  32-bitový rozšíøený
                               ukazatel instrukce

                                  CALL registr nebo pamì
                                       ; posunutí je 32-bitové.
                                       ; Slovní operandy jsou 32-bitové






                                  - 60 - 




CBW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Konvertuj byte na slovo

Èasování:                      2 (80286), 3 (80386)

Popis:                         Operace  CBW  konvertuje byte  se  znaménkem
                               uložený v registru  AL na slovo se znaménkem
                               v  registru  AX.  Konverze  je   zabezpeèena
                               rozšíøením  nejvýznamnìjšího  bitu v  AL  na
                               všechny   (zbývající)   bity   AH.  Viz  též
                               poznámku pro 80386.

Syntaxe:                       CBW (nemá operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            Velikost   slova  je  32  bitù.  Hodnota   s
                               rozšíøeným  znaménkem  je  v AX, výsledek je
                               uložen do EAX.

Pøíklad:                       CBW

CLC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nuluj pøíznak pøenosu (CF)

Èasování:                      2

Popis:                         Operace CLC nastavuje pøíznak pøenosu  do 0.
                               Žádné  jiné  registry  ani  pøíznaky  nejsou
                               ovlivnìny.

Syntaxe:                       CLC (nemá operandy)

Ovlivòuje pøíznaky:            CF = 0

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       CLC





                                  - 61 - 




CLD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nuluj pøíznak smìru (DF)

Èasování:                      2

Popis:                         Nuluje pøíznak DF, inkrementuje registry  SI
                               a  DI.  Žádné  jiné  registry  ani  pøíznaky
                               nejsou    ovlivnìny.    Øetìzcová    operace
                               inkrementuje registry SI a DI automaticky po
                               provedení instrukce CLD.

Syntaxe:                       CLD (nemá operandy)

Ovlivòuje pøíznaky:            DF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       CLD

CLI (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nuluj pøíznak pøerušení (IF)

Èasování:                      3

Popis:                         Operace  CLI  nuluje pøíznak  pøerušení  IF.
                               Žádné   jiné   pøíznaky   nejsou  ovlivnìny.
                               Efektem provedení operace CLI je  inaktivace
                               výskytu   všech    pøerušení    s   výjimkou
                               nemaskovatelných pøerušení, které se projeví
                               signálem NMI.

Syntaxe:                       CLI (žádné operandy)

Ovlivòuje pøíznaky:            IF = 0

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je-li  aktuální  privilegovaná  úroveò vyšší
                               než IOPL v registru pøíznakù,  je generována
                               všeobecná výjimka privilegovaného módu. IOPL
                               indikuje nejnižší privilegovanou  úroveò, na
                               které lze provést vstup/výstup.

Výjimky v RM:                  žádné

Poznámka pro 80386:            -



                                  - 62 - 




Pøíklad:                       CLI

CLTS (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nuluj  pøíznak  TS ("Pøepnuta  uloha",  task
                               switched)

Èasování:                      2 (80286), 5 (80386)

Popis:                         Instrukce CLTS nuluje pøíznak TS ve stavovém
                               slovì MSW. CLTS je privilegovaná  instrukce,
                               která mùže být provádìna jen na  úrovni  0 a
                               je  reservovaná  pro systémové  software  na
                               úrovni  operaèního  systému.   CLTS  sleduje
                               každé vykonání WAITu nebo  ESC  a  v pøípadì
                               nastavení pøíznaku  MP  v  MSW  a souèasného
                               nastavení pøíznaku TS vyvolá instrukce  CLTS
                               výjimku.

Syntaxe:                       CLTS

Ovlivòuje pøíznaky:            TS = 0

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je-li aktuální  úroveò  privilegovaného módu
                               jiná než 0, je generována  všeobecná výjimka
                               privilegovaného módu pøi pokusu o  provedení
                               CLTS.

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       CLTS

CMC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vytvoø doplnìk pøíznaku pøenosu (CF)

Èasování:                      2

Popis:                         Instrukce  CMC  invertuje   bitovou  hodnotu
                               pøíznaku  pøenosu  CF.  Je-li  CF  =  1,  je
                               nastaven do  0; je-li CF = 0, je nastaven do
                               1.

Syntaxe:                       CMC

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné



                                  - 63 - 




Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       CMC

CMP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Porovnej dva operandy

Èasování:                      2-7 (80286), 2-6 (80386)

Popis:                         Instrukce  CMP  odeète zdrojový  operand  od
                               cílového a podle vzniklého výsledku  nastaví
                               patøièné  pøíznaky.  CMP   nemìní  operandy.
                               Zdrojový  a  cílový  operand  musí  být  oba
                               stejného  typu, s  výjimkou  použití  CMP  v
                               bezprostøedním   režimu   -   zde  mùže  být
                               bezprostøední  operand  o velikosti  byte  s
                               rozšíøeným znaménkovým bitem  na  celé slovo
                               porovnán se slovem v pamìti.

Syntaxe:                       CMP destination,source

Ovlivòuje pøíznaky:            OF, SF, ZF, AF, PF, CF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže registr  CS,  DS  nebo  ES obsahují
                               nepovolenou  efektivní  adresu  operandu, je
                               generována všeobecná výjimka privilegovaného
                               módu. Jestliže SS obsahuje neplatnou adresu,
                               je generována výjimka "chyba zásobníku".

Výjimky v RM:                  Je-li  slovní  operand  umístìn  na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       Bezprostøední operand srovnán s pamìtí:
                               CMP EXTMEM,5CAFH
                               Bezprostøední operand srovnán s registrem:
                               CMP BL,5
                               CMP EAX, 0FFFF0000H (pro 80386)
                               Bezprostøední operand srovnán se støadaèem:
                               CMP AL,7
                               Registr srovnán s registrem:
                               CMP AX,BX
                               CMP EDX,EAX (jen pro 80386)
                               Registr srovnán s pamìtí:
                               CMP EXTMEM,DX
                               Pamì srovnána s registrem:
                               CMP CH,EXTMEM
                               CMP EBX,VALUE (jen pro 80386)




                                  - 64 - 




CMPS/CMPSB/CMPSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Porovnej øetìzcové operandy

Èasování:                      8 (80286), 10 (80386)

Popis:                         Instrukce    CMPS/SB/SW    srovnává    obsah
                               pamìového   místa  adresovaného   registrem
                               SI(ESI)   s    obsahem    pamìového   místa
                               adresovaného  registrem  DI(EDI).  Instrukce
                               CMPS   odeète    obsah    pamìového   místa
                               adresovaného registrem DI(EDI) od pamìového
                               místa   adresovaného    registrem   SI(ESI).
                               Výsledkem je nastavení pøíznakù, avšak obsah
                               pamìových míst není mìnìn. Registry SI(ESI)
                               a   DI(EDI)    jsou    inkrementovány   nebo
                               dekrementovány  podle  hodnoty  pøíznaku DF.
                               Je-li pøíznak DF nulován (0), jsou SI(ESI) a
                               DI(EDI)  inkremetovány,  pøi  hodnotì DF = 1
                               jsou  tyto   registry   dekrementovány.  Lze
                               specifikovat bytové nebo slovní porovnávání.
                               Inkrementace indexových  registrù  SI(ESI) a
                               DI(EDI) je o 1 pro bytové operandy a o 2 pro
                               operandy slovní.


Poznámka:                      Pravý  operand  instrukce  CMPS  je  operand
                               indexovaný  registrem DI a tento operand  je
                               adresován  registrem  ES.   Tato  implicitní
                               specifikace nemùže být zmìnìna.


Syntaxe:                       CMPS source_string,destination_string
                               CMPSB (žádné operandy)
                               CMPSW (žádné operandy)


Ovlivòuje pøíznaky:            AF, CF, PF, OF, SF, ZF


Nedefinované pøíznaky:         žádné


Výjimky v PM:                  Jestliže registr  CS,  DS  nebo  ES obsahují
                               nepovolenou  efektivní  adresu  operandu, je
                               generována všeobecná výjimka privilegovaného
                               módu. Jestliže SS obsahuje neplatnou adresu,
                               je generována výjimka "chyba zásobníku".


Výjimky v RM:                  Je-li  slovní  operand  umístìn  na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka   operandù   je  32   bitù.   Použijte
                               instrukci CDQ.



                                  - 65 - 




Pøíklad:                       MOV SI,OFFSET STRING1
                               MOV DI,OFFSET STRING2
                               CMPS STRING1,STRING2
                               CMPS DS:BYTE PTR[SI],ES:[DI]
                               LEA ESI,STRING1 (jen pro 80386)
                               LEA EDI,STRING2
                               CMPS STRING1,STRING2

CWD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Konvertuj slovo do dvouslova

Èasování:                      2

Popis:                         Instrukce CWD konvertuje slovo se  znaménkem
                               umístìné  v  registru  AX  do  dvouslova  se
                               znaménkem  v  registrech DX:AX.  Operace  je
                               provedena  tak,  že  bit  MSB registru AX je
                               rozšíøen   do   všech   (zbývajících)  pozic
                               registru DX. Viz poznámku pro 80386.

Syntaxe:                       CWD (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            Šíøka   slova  je  32  bitù.  Hodnota   pøed
                               konverzí (s rozšíøeným znaménkovým bitem) je
                               uložena v EAX, výsledek konverze  je ukládán
                               do registrového páru EDX:EAX.

Pøíklad:                       CWD

DAA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Dekadické nastavení po seèítání

Èasování:                      3 (80286), 4 (80386)

Popis:                         Instrukce  DAA by mìla být používána jen  po
                               seètení  dvou  sbalených BCD  operandù.  DAA
                               konvertuje  výsledek  v   AL   do  sbaleného
                               dekadického   tvaru    podle   následujících
                               pravidel:

                               a) Je-li nižší ètveøice bytù v AL  vìtší než
                               9 nebo je nastaven CF, je AL inkrementován o
                               6 a nastaven AF; jinak je AF nulován.




                                  - 66 - 




                               b)  Je-li   (následkem   pøedchozí  operace)
                               výsledek vìtší než 9FH nebo je CF = 1, je AL
                               inkrementován  o  60H a CF  je  nastaven  do
                               jedné; jinak je CF nulován.

Syntaxe:                       DAA (žádné operandy)

Ovlivòuje pøíznaky:            AF, CF, SF, ZF, PF

Nedefinované pøíznaky:         OF

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       MOV     AL,08
                               ADD     AL,03     ; Výsledek v AL je OBH
                               DAA               ; Výsledek v AL je 11H

DAS (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Dekadické nastavení po odeèítání

Èasování:                      3 (80286), 4 (80386)

Popis:                         Instrukce DAS  by  mìla  být  užita  jen  po
                               odeèítání   dvou   sbalených    BCD   èísel.
                               Instrukce DAS vrací nastavený výsledek  v AL
                               a postupuje podle následujících pravidel:

                               a) Je-li nižší ètveøice bytù v AL  vìtší než
                               9 nebo je nastaven AF, je AL dekrementován o
                               6 a nastaven AF; jinak je AF nulován.

                               b)  Je-li   (následkem   pøedchozí  operace)
                               výsledek vìtší než 9FH nebo je CF = 1, je AL
                               dekrementován  o  60H a CF  je  nastaven  do
                               jedné; jinak je CF nulován.

Syntaxe:                       DAS (žádné operandy)

Ovlivòuje pøíznaky:            AF, CF, SF, PF, ZF

Nedefinované pøíznaky:         OF

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                          MOV  AL,12
                                  SUB  AL,03     ; Výsledek v AL je 0FH



                                  - 67 - 




                                  DAS            ; Výsledek v AL je 09H

DEC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Dekrementace o 1

Èasování:                      2-7 (80286), 2-6 (80386)

Popis:                         Instrukce  DEC  odeète  jednièku  od  obsahu
                               (slovního  nebo   bytového)  specifikovaného
                               pamìového  místa  nebo  registru. Instrukce
                               DEC nemìní pøíznak CF.

Syntaxe:                       DEC destination

Ovlivòuje pøíznaky:            OF, SF, AF, ZF, PF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je-li  výsledek   v   segmentu  nepøístupném
                               zápisu,  je   generována   všobecná  výjimka
                               porušení  ochrany  pamìti.  Pro  nedovolenou
                               efektivní adresu operandu  nacházející  se v
                               registrech  CS, DS  nebo  ES  je  generována
                               všeobecná   výjimka  privilegovaného   módu.
                               Jestliže SS obsahuje nedovolenou adresu,  je
                               generována výjimka "chyba zásobníku".

Výjimky v RM:                  Je-li  slovní operand na offsetu OFFFFH,  je
                               generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                          DEC  AX
                                  DEC  EXTMEM
                                  DEC  TABLE[BX][SI]
                                  DEC  ECX (jen pro 80386)

DIV (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Dìlení  bez  uvažování   znaménka  (unsigned
                               division)

Èasování:                      14-25 (80286), 14-41 (80386)

Popis:                         Instrukce DIV provádí dìlení operandù. Je-li
                               specifikován  zdrojový  operand  o velikosti
                               byte,  je registr  AX  dìlen  tímto  bytovým
                               operandem   a  výsledek  je  uchován  v   AL
                               (kvocient)   a   v   AH   (zbytek).    Je-li
                               specifikován  zdrojový  operand  o velikosti
                               slova,     je     dìlen     DX:AX    slovem.
                               Nejvýznamnìjších 16 bitù  zdrojového dìlence




                                  - 68 - 




                               je uloženo v DX,  kvocient  v  AX a zbytek v
                               DX.

Syntaxe:                       DIV source

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         SF, AF, OF, PF, CF

Výjimky v PM:                  Je-li  dìlitel  roven  nule nebo je výsledek
                               dìlení  - kvocient - pøíliš velký a  nevejde
                               se   do  místa  urèení  (AL  nebo  AX),   je
                               generováno   pøerušení   INT   0.   Jestliže
                               obsahují DS,  CS  èi  ES  neplatné efektivní
                               adresy  operandù,  je  generována  všeobecná
                               výjimka  privilegovaného  módu.  Jestliže SS
                               obsahuje  neplatnou  adresu,  je  generována
                               výjimka "chyba zásobníku".

Výjimky v RM:                  Je-li  dìlitel 0  nebo  je  kvocient  pøíliš
                               velký a nevejde se do místa urèení  (AL nebo
                               AX), je generováno pøerušení INT 0. Jestliže
                               je  slovní operand  na  offsetu  OFFFFH,  je
                               generováno  pøerušení  INT  13.  Dìlení   ve
                               dvojité  pøesnosti  je možné  se  64-bitovým
                               dìlencem  v EDX:EAX, 32-bitový dìlitel je  v
                               pamìti nebo v registru, 32-bitový kvocient v
                               EAX a 32-bitový zbytek je v EDX.

Poznámka pro 80386:            -

Pøíklad:                       Dìlení bytu jiným bytem:
                                  MOV  AL,NUMER_BTE
                                  DIV  DIVSR_BTE ;Kvocient v AL,zbytek v AH

                               Dìlení slova bytem:
                                  MOV  AX,NUMER_WRD
                                  DIV  DIVSR_BTE ;Kvocient v AL,zbytek v AH

                               Dìlení dvouslova slovem:
                                  MOV  DX,NUMER_MSW
                                  MOV  AX,NUMER_LSW
                                  DIV  DIVSR_WRD ;Kvocient v AX,zbytek v DX

                               Dìlení u 80386:
                                  MOV  EDX,MSB_NUMBER
                                  MOV  EAX,LSB_NUMBER
                                  DIV  ECX  ;Kvocient v EAX, zbytek v EDX

ENTER (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vytvoø  prostor  v zásobníku  pro  parametry
                               procedury

Èasování:                      11-16 (80286), 10-19 (80386)



                                  - 69 - 




Popis:                         Instrukce  ENTER  se používá  pro  vytvoøení
                               prototypu struktury  uchovávající parametry,
                               jejíž použití je typické pro vìtšinu vyšších
                               programovacích    jazykù.   První    operand
                               specifikuje  velikost  požadované  alokované
                               dynamické  pamìti, již je tøeba vymezit  pro
                               parametry   v   zásobníku  pøi   vstupu   do
                               procedury.   Druhý   operand   udává  úroveò
                               vnoøení  podprogramu  vzhledem  k zdrojovému
                               programu  ve  vyšším  programovacím  jazyce.
                               Instrukce   ENTER   urèuje,   jaké  množství
                               ukazatelù (ze staré struktury pro volání) je
                               tøeba kopírovat do  nové  struktury. BP(EBP)
                               je   použit   jako  aktuální   ukazatel   do
                               struktury.  Je-li  druhý  operand  roven  0,
                               ENTER ukládá BP (EBP), nastavuje BP (EBP) na
                               hodnotu SP (ESP)  a odeèítá první operand od
                               SP (ESP).

Syntaxe:                       ENTER immediate_word,immediate_byte
Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Pokud registr  SP  odkazuje  na  adresu mimo
                               limit  zásobníku,   je   generována  výjimka
                               "chyba zásobníku",  a  to  v  libovolné fázi
                               vykonávání instrukce ENTER.

Výjimky v RM:                  žádné

Poznámka pro 80386:            Jsou  použity 32-bitové registry EBD a  ESP.
                               Velikost  struktury je zvìtšena ze 16 na  32
                               bitù.

HLT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zastavení provádìní programu

Èasování:                      2 (80286), 5 (80386)

Popis:                         Instrukce  HLT  zpùsobí  ukonèení  provádìní
                               programu.  Opìtovné  spuštìní   programu  je
                               možné jen externím pøerušením nebo  RESETem.
                               Nejsou ovlivnìny žádné registry ani  stavové
                               pøíznaky. Jestliže je k opìtovnému  spuštìní
                               programu   použito    pøerušení,   uschované
                               hodnoty CS:IP budou  ukazovat  na instrukci,
                               jež následuje za HLT.

Syntaxe:                       HLT (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné



                                  - 70 - 




Výjimky v PM:                  HLT  je  privilegovaná  instrukce generující
                               všeobecnou   výjimku   porušení   ochrany  v
                               pøípadì, že aktuální privilegovaná úroveò je
                               jiná než 0.

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       HLT

IDIV (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Celoèíselné dìlení (se znaménkem)

Èasování:                      17-28 (80286), 19-34 (80386)

Popis:                         Instrukce IDIV provádí operaci celoèíselného
                               dìlení    se    znaménkem.    Jestliže    je
                               specifikován  zdrojový  operand  o velikosti
                               byte, je registr AX dìlen bytovým operandem:
                               kvocient je  uložen  v  AL  a  zbytek  v AH.
                               Zdrojový  operand  o  velikosti  slova  dìlí
                               DX:AX  slovem. Vyšších 16 bitù dìlence je  v
                               registru  DX,  kvocient je umístìn  v  AX  a
                               zbytek v DX.  Zbytek má stejné znaménko jako
                               dìlenec a je vždy  menší  jako  dìlitel. Viz
                               též poznámku pro 80386.

Syntaxe:                       IDIV source

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         SF, AF, OF, PF, CF

Výjimky v PM:                  Je-li  dìlitel roven  0  nebo  je-li  zbytek
                               pøíliš  velký  pro  umístìní do požadovaného
                               registru   (AX   nebo   AL),  je  generováno
                               pøerušení INT 0. Jestliže obsahují DS, CS èi
                               ES  neplatné  efektivní  adresy operandù, je
                               generována všeobecná výjimka privilegovaného
                               módu. Jestliže SS obsahuje neplatnou adresu,
                               je generována výjimka "chyba zásobníku".

Výjimky v RM:                  Je-li  dìlitel 0  nebo  je  kvocient  pøíliš
                               velký a nevejde se do místa urèení  (AL nebo
                               AX), je generováno pøerušení INT 0. Jestliže
                               je  slovní operand  na  offsetu  OFFFFH,  je
                               generováno pøerušení INT 13.

Poznámka pro 80386:            Velikost slova je 32 bitù. Dìlení ve dvojité
                               pøesnosti   je   provádìno   s  dìlitelem  v
                               registrovém  páru  EDX:EAX. Dìlitel  je  32-
                               bitová hodnota  umístìná  v registru/pamìti.




                                  - 71 - 




                               32-bitový podíl (kvocient) je  v  EAX  a 32-
                               bitový zbytek v EDX.

Pøíklad:                       Dìlení slova bytem:
                                  MOV  AX,NUMER_WRD
                                  IDIV DIVSR_BTE

                               Dìlení slova slovem:
                                  MOV  AX,NUMER_WORD
                                  CWD       ;Konverze slova na dvouslovo
                                  IDIV DIVSR_WRD

                               Dìlení dvouslova slovem:
                                  MOV  DX,NUMER_MSW
                                  MOV  AX,NUMER_LSW
                                  IDIV DIVSR_WRD

                               Dìlení u 80386:
                                  MOV  EDX,MSB_NUMBER
                                  MOV  EAX,LSB_NUMBER
                                  IDIV DIVISOR

IMUL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Celoèíselné násobení

Èasování:                      13-24 (80286), 9-41 (80386)

Popis:                         Instrukce IMUL provádí  celoèíselné násobení
                               se znaménkem. Jestliže  je  zdrojový operand
                               jediný byte, je  vynásoben  obsahem registru
                               AL  a 16-bitový  výsledek  se  znaménkem  je
                               uložen do AX. Pøíznaky CF a OF jsou nulovány
                               v pøípadì, že registr AH je extenzí znaménka
                               hodnoty uložené v AL;  jinak  jsou  OF  a CF
                               nastaveny na 1. Viz  též  poznámku  k 80386.
                               Jestliže je zdrojový operand specifikovaný v
                               instrukci  IMUL  slovo,  pak  je   vynásoben
                               obsahem registru AX a 32-bitový  výsledek se
                               znaménkem  je  uložen  v  registrovém   páru
                               DX:AX.  Registr DX obsahuje vyšších 16  bitù
                               výsledku. Pøíznaky OF a CF jsou nastaveny do
                               nuly v pøípadì, že DX je extenzí  znaménka v
                               AX (viz poznámku u 80386); jinak  jsou  OF a
                               CF  nastaveny do 1. Jestliže instrukce  IMUL
                               specifikuje tøi operandy,  je  druhý operand
                               (jenž   je   efektivní    adresou   slovního
                               operandu) násoben tøetím operandem (jenž  je
                               bezprostøední slovní hodnotou).  Výsledek je
                               16-bitový  a je umístìn do prvního  operandu
                               instrukce IMUL,  který  specifikuje registr.
                               CF a OF jsou nastaveny do nuly v pøípadì, že
                               výsledek  je èíslo se znaménkem v  intervalu
                               (-32768,+32768);   jinak   jsou  CF   a   OF
                               nastaveny do 1.



                                  - 72 - 




Syntaxe:                       IMUL source

Ovlivòuje pøíznaky:            OF, CF

Nedefinované pøíznaky:         ZF, SF, AF, PF

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována všeobecná výjimka prušení ochrany
                               pamìti.  Jestliže   SS   obsahuje  neplatnou
                               adresu,   je   generována   výjimka   "chyba
                               zásobníku".

Výjimky v RM:                  Jestliže  leží  slovní  operand  na  offsetu
                               OFFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Velikost  slova je  32  bitù.  Je  provádìno
                               násobení ve dvojité pøesnosti a  výsledek je
                               uložen  v  registrovém páru  EDX:EAX.  Tento
                               výsledek   vzniká    vynásobením   32-bitové
                               hodnoty EAX-krát.

Pøíklad:                          MOV AL,NUMBER
                                  IMUL NUMBER ;Výsledek v AX
                                  MOV AX,VALUE1
                                  IMUL VALUE2 ;Výsledek v DX:AX

                               Pro 80386:
                                  MOV EAX,FCAB1234H
                                  IMUL NUMBER ;Výsledek v EDX:EAX

IN (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vstup slova nebo bytu (z portu)

Èasování:                      5 (80286), 5-6 (80386)

Popis:                         Instrukce  IN  nahrazuje obsah  registru  AL
                               nebo  AX   obsahem   specifikovaného  portu.
                               Pøesouvaný  datový údaj mùže být slovo  nebo
                               byte.    Programátor    mùže    specifikovat
                               libovolný  port èíslem od 0 do 65535,  které
                               uloží  do  registru  DX.  Jestliže  je  port
                               specifikován  s  datovým  bytem "inline", je
                               nastaven pøístup k portùm  0  až  255. INTEL
                               reservoval I/O adresy 00F8H až 00FFH ke svým
                               interním úèelùm  (øízení  koprocesoru, resp.
                               pøíští extenze procesoru): tyto adresy portù
                               by tedy nemìly být užívány.

Syntaxe:                       IN accumulator,port

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné



                                  - 73 - 




Výjimky v PM:                  Jestliže IOPL (v registru pøíznakù) obsahuje
                               hodnotu  vìtší  než  aktuální  privilegovaná
                               úroveò,  je  generována   všeobecná  výjimka
                               porušení ochrany pamìti.

Výjimky v RM:                  žádné

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                          IN   AL,B_P_ADR     ; vstup byte do AL
                                  IN   AX,W_P_ADR     ; vstup slova do AX
                                  IN   AL,DX          ; vstup byte do AL
                                  IN   AX,DX          ; vstup slova do AX
                                  IN   EAX,PORT8      ; jen pro 80386

INC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zvýšení o jednièku

Èasování:                      2-7

Popis:                         Instrukce   INC   zvýší   obsah  operandu  o
                               jednièku, aniž
ovlivní pøíznak CF.

Syntaxe:                       INC destination

Ovlivòuje pøíznaky:            SF, AF, OF, ZF, PF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  V pøípadì, že operand  leží  v  segmentu, do
                               nìhož nelze zapsat, je generována  všeobecná
                               výjimka   privilegovaného   módu.   Jestliže
                               registry  CS,  DS  nebo ES obsahují neplatné
                               efektivní  adresy  operandù,  je  generována
                               všeobecná výjimka  porušení  ochrany pamìti.
                               Jestliže  SS  obsahuje  neplatnou adresu, je
                               generována výjimka "chyba zásobníku".

Výjimky v RM:                  Pøi  umístìní  slovního  operandu na offsetu
                               0FFFFH je generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                          INC  AX
                                  INC  EBX       ; jen pro 80386
                                  INC  MEM_LOC

INS/INSB/INSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vstup z portu do øetìzce

Èasování:                      5 (80286), 5-8 (80386)



                                  - 74 - 




Popis:                         Instrukce  INS  pøesouvá  byte  nebo   slovo
                               øetìzce  na  pamìové   místo  specifikované
                               ES:DI.  Registr  DX  (EDX) ukazuje pøitom na
                               vstupní  port.  Instrukcí INS  je  pøesouván
                               byte  nebo  slovo  podle  prvního   operandu
                               instrukce INS.  Operand  v  pamìti  musí být
                               adresovatelný z registru  ES.  Instrukce INS
                               nedovoluje,    aby    bylo    èíslo    portu
                               specifikováno  jako  bezprostøední  hodnota.
                               Port  mùže být  adresován  jen  pøi  použití
                               registru  DS.  Po  provedení  instrukce   je
                               registr      DI       (EDI)      automaticky
                               inkrementován/dekrementován. Jestliže  je DF
                               = 0 (byla provedena  instrukce  CLD),  je DI
                               (EDI)  inkrementován. Jestliže  je  DF  =  1
                               (byla provedena instrukce STD), je  DI (EDI)
                               dekrementován. Inkrement/dekrement  je roven
                               1 pro bytový pøesun, 2 pro slovní pøesun.

Syntaxe:                       INS     destination_string,port
                               INSB    (žádné operandy)
                               INSW    (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže je hodnota  CPL  (Current Privilege
                               Level) vìtší než hodnota IOPL, je generována
                               všeobecná výjimka privilegovaného módu. Tato
                               výjimka je  generována  také  v  pøípadì, že
                               místo   urèení   (cílový   øetìzec)  leží  v
                               segmentu,  do  nìhož  nelze zapsat. Jestliže
                               registry  CS,  DS  nebo ES obsahují neplatné
                               efektivní  adresy  operandù,  je  generována
                               všeobecná výjimka  porušení  ochrany pamìti.
                               Jestliže  SS  obsahuje  neplatnou adresu, je
                               generována výjimka "chyba zásobníku".


Výjimky v RM:                  Pøi  umístìní  slovního  operandu na offsetu
                               0FFFFH je generováno pøerušení INT 13.


Poznámka pro 80386:            Šíøka slova je 32 bitù. Adresy v pamìti jsou
                               vytváøeny ze 32-bitových  efektivních adres.
                               Èíslo   portu   je   vzato  z  registru  DX.
                               Efektivní adresa neovlivní adresu I/O portu.

Pøíklad:                          INS  BTE_STRG,DX    ; vstup bytu
                                  INS  WRD_STRG,DX    ; vstup slova
                                                      ( délky øetìzcù
                                  INSB      ; vstup byte jsou vzaty z
                                  INSW      ; vstup slova registru ECS )





                                  - 75 - 




INT/INTO (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Generování  pøerušení  -  volání pøerušovací
                               procedury

Èasování:                      23-167 (80286), 33-287 (80386)

Popis:                         Instrukce  INT  generuje  volání pøerušovací
                               procedury  pomocí  softwareového  pøepínaèe.
                               Bezprostøední   operand   instrukce,   který
                               obsahuje hodnotu mezi 0 až 255 vèetnì, udává
                               "èíslo" pøerušení, jež je indexem do tabulky
                               deskriptorù  pøerušení   (IDT   -  Interrupt
                               Descriptor Table)  pøerušovací  procedury. V
                               privilegovaném    módu    sestává    tabulka
                               deskriptorù   z  osmibytových   deskriptorù.
                               Deskriptor  pro   vyvolání   pøerušení  musí
                               specifikovat   místo  pøerušení   (interrupt
                               gate),  místo  pro  výjimku  (trap  gate)  a
                               popøípadì  místo úlohy (task gate). V RM  je
                               tabulka    deskriptorù   polem    4-bytových
                               ukazatelù alokovaná na fixní adrese  00000H.
                               Instrukce INTO je identická instrukci  INT s
                               tou   výjimkou,   že  èíslo   pøerušení   je
                               implicitnì   4.   Toto   pøerušení  je  tedy
                               aktivovatelné  jen v pøípadì, že pøíznak  OF
                               je nastaven. V RM  instrukce  INT  ukládá do
                               zásobníku pøíznaky a registr CS  a návratový
                               IP (EIP) (  v uvedeném poøadí). Užívá pøitom
                               ukazatele,   který   je   indexován   èíslem
                               pøerušení.

Syntaxe:                       INT interrupt_type
                               INTO (žádné operandy)

Ovlivòuje pøíznaky:            Pøi  pøepnutí  úlohy (task  switching)  jsou
                               ovlivnìny všechny pøíznaky;  jinak instrukce
                               INT/INTO neovlivòují žádné pøíznaky.

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Mohou   být   generovány   výjimky  porušení
                               ochrany    pamìti,    výjimka    "deskriptor
                               nenalezen",   výjimka   "chyba   zásobníku",
                               výjimka "neplatný stavový segment úlohy".

Výjimky v RM:                  žádné

Poznámka pro 80386:            Šíøka  operandu  nemá  žádný význam. Hodnoty
                               registrù EIP, ESP a  FLAGS  jsou  zavádìny z
                               místa pøerušení (gate).

Pøíklad:                       INT 21H
                               INTO




                                  - 76 - 




IRET (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Návrat z pøerušení

Èasování:                      17-169 (80286), 22-275 (80386)

Popis:                         V  reálném  adresním  módu  instrukce   IRET
                               vyzvedává ze zásobníku  IP (EIP), CS a FLAGS
                               a  ukonèuje kód  programu  pøerušení.  V  PM
                               instrukce IRET závisí na nastavení  pøíznaku
                               NT (Nested Task flag):

                               1.  NT  =  1.  Instrukce "obrací" efekt CALL
                               nebo INT, které vyvolaly pøepnutí  úloh. Kód
                               provádìjící  instrukci  IRET  má  svùj  stav
                               uchován  ve svém registru stavu úlohy  (TS).
                               Znamená  to, že pøi opìtovné aktivaci  úlohy
                               bude   provedena   jako    první   instrukce
                               následující instrukci IRET.

                               2. NT = 0.  Instrukce  IRET  vrací  øízení z
                               pøerušovacího podprogramu, aniž  se vyskytlo
                               pøepnutí úloh. Privilegovaná úroveò kódu, do
                               nìhož se øízení z pøerušovacího  podprogramu
                               navrací,  musí být  stejná  nebo  menší  než
                               privilegovaná      úroveò      pøerušovacího
                               podprogramu.

Syntaxe:                       IRET (žádné operandy)

Ovlivòuje pøíznaky:            Celý  registr  pøíznakù   je   vyzvednut  ze
                               zásobníku.

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Mùže   být   generována   všeobecná  výjimka
                               porušení ochrany pamìti, výjimka "deskriptor
                               nenalezen", výjimka "chyba zásobníku".

Výjimky v RM:                  Je   generováno   pøerušení   INT   13   pøi
                               vyzvedávání obsahu zásobníku majícího offset
                               0FFFFH.

Poznámka pro 80386:            Je  použit   32-bitový   rozšíøený  ukazatel
                               instrukce.  Úroveò  INTER  ukládá  48-bitový
                               ESP. Jsou ukládány 48-bitový EIP a 32-bitový
                               FLAG.

Pøíklad:                       IRET

J(podmínka) (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     (Blízký) skok pøi splnìní podmínky




                                  - 77 - 




                               Varian. Èas. Popis:
                               JA      7    Skok pøi vìtším
                               JAE     7    Skok pøi vìtším nebo rovném
                               JB      7    Skok pøi menším
                               JBE     7-9  Skok pøi menším nebo rovném
                               JC      7-9  Skok pøi pøenosu
                               JCXZ    8    Skok pøi CX = 0
                               JE      7    Skok pøi rovnosti
                               JG      7    Skok pøi vìtším
                               JGE     7    Skok pøi vìtším nebo rovném
                               JL      7    Skok pøi menším
                               JLE     7    Skok pøi menším nebo rovném
                               JNA     7    Skok pøi ne vìtším
                               JNAE    7    Skok pøi ne vìtším nebo rovném
                               JNB     7    Skok pøi ne menším
                               JNBE    7    Skok pøi ne menším nebo rovném
                               JNC     7    Skok pøi CF = 0
                               JNE     7    Skok pøi nerovnosti
                               JNG     7    Skok pøi ne vìtším
                               JNGE    7    Skok pøi ne vìtším nebo rovném
                               JNL     7    Skok pøi ne menším
                               JNLE    7    Skok pøi ne menším nebo rovném
                               JNO     7    Skok nebylo-li pøeteèení
                               JNP     7    Skok nebyla-li parita
                               JNS     7    Skok nebylo-li znaménko
                               JO      7    Skok pøi pøeteèení
                               JP      7    Skok pøi paritì
                               JPE     7    Skok pøi sudé paritì
                               JPO     7    Skok pøi liché paritì
                               JS      7    Skok pøi znaménku
                               JZ      7    Skok pøi nule


Popis:                         Instrukce J (následovaná  podmínkou  z právì
                               uvedeného seznamu)  pøedává  øízení operandu
                               specifikovanému v instrukci. Jde o podmínìné
                               "krátké" skoky testující pøíznaky. Testovací
                               operand instrukce musí  být v dosahu -128 až
                               +127 byte od umístìní instrukce J(podmínka).
                               Toto  omezení  je podstatné  pro  assembler,
                               který vytváøí  1-bytové  pøemístìní vztažené
                               ke konci instrukce J(podmínka).


Syntaxe:                       J(test_condition)


Ovlivòuje pøíznaky:            žádné


Nedefinované pøíznaky:         žádné








                                  - 78 - 




Výjimky v PM:                  Jestliže  je  offset místa, na  nìž  má  být
                               pøedáno øízení, mimo hranice segmentu CS, je
                               generována všeobecná výjimka privilegovaného
                               módu.


Výjimky v RM:                  žádné


Poznámka pro 80386:            Užívá    32-bitový     rozšíøený    ukazatel
                               instrukce.    Pøemístìní   je    osmibitové,
                               rozšíøené  do  32  bitù  znaménkovým   bitem
                               (pokud není jinak upraveno).

Pøíklad:                       JA INST_LABEL

JMP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nepodmínìný skok


Èasování:                      7-183 (80286), 7-268 (80386)


Popis:                         Instrukce  JMP  pøedává øízení  programu  na
                               jinou  instrukci,  pøièemž  není  uchovávána
                               žádná  informace  o  návratu.  JMP   provádí
                               intrasegmentové  pøímé  a  nepøímé  skoky  a
                               mezisegmentové skoky.  Intrasegmentové pøímé
                               skoky  používají  offset umístìný  ihned  za
                               instrukcí.  Intrasegmentové   nepøímé  skoky
                               užívají obsahu pamìového místa adresovaného
                               byty, které následující po instrukèním byte.
                               Když  je  instrukce  intrasegmentovým pøímým
                               skokem,  vzdálenost  od  konce  instrukce  k
                               cílovému návìští  je  pøiètena  k  IP (EIP).
                               Mezisegmentové    skoky   nahrazují    obsah
                               registru CS. Pro pøímé skoky je to zajištìno
                               druhým  slovem  následujícím  instrukci. Pro
                               skoky nepøímé je registr CS  nahrazen druhým
                               slovem následujícím po naznaèené adrese  dat
                               (viz pøíklady).


Syntaxe:                       JMP (target)


Ovlivòuje pøíznaky:            Pøi  pøepnutí  ulohy (task  switching)  jsou
                               ovlivnìny všechny pøíznaky;  jinak nedochází
                               k ovlivnìní žádných pøíznakù.



Nedefinované pøíznaky:         žádné




                                  - 79 - 




Výjimky v PM:                  Jestliže   je  typ  skoku  NEAR,  mùže   být
                               generována   všeobecná    výjimka   porušení
                               ochrany  pamìti  v  pøípadì, že offset místa
                               urèení je mimo  hranice  aktuálního segmentu
                               CS.  Jestliže  je typ skoku  FAR,  mùže  být
                               generována také  všeobecná  výjimka ochrany.
                               Jiné  možné  výjimky  jsou: "deskriptor není
                               pøítomen",   "chyba  zásobníku",   "neplatný
                               stavový  registr  úlohy".   Jestliže   je  u
                               intersegmentového nepøímého  skoku operandem
                               registr, je generována výjimka "nedefinovaný
                               operaèní kód".

Výjimky v RM:                  Jakmile    je     v     pøípadì    nepøímého
                               intersegmentového  skoku operandem  registr,
                               je generována výjimka "nedefinovaný operaèní
                               kód".

Poznámka pro 80386:            Je  použit   32-bitový   rozšíøený  ukazatel
                               instrukce.  Ukazatelové  operandy  jsou  48-
                               bitové a jejich pøemístìní jsou 32-bitová.

Pøíklad:                       Intersegmentový pøímý skok:
                                  JMP FAR_LABEL
                                  Intersegmentový nepøímý skok:
                                  JMP TABLE[BP][DI]
                                  JMP TABLE[EBP][EDI] ; jen pro 80386
                                  Intrasegmentový pøímý skok:
                                  JMP NEAR_LABEL
                                  Intrasegmentový nepøímý skok:
                                  JMP WORDPTR[BX][DI]

LAHF (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Naplò AH pøíznakovými registry

Èasování:                      2

Popis:                         Instrukce  LAHF  pøesouvá  registry pøíznakù
                               SF,  ZF,  AF,  PF  a  CF  do  urèitých  bitù
                               registru AH:

                               SF ZF AF PF CF
                               BIT 7   BIT 0

Bitové pozice 1, 3 a 5 jsou nedefinovány.

Syntaxe:                       LAHF (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:

Výjimky v PM:                  žádné




                                  - 80 - 




Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       LAHF

LAR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zaveï  byte  pøístupových  oprávnìní (access
                               rights)

Èasování:                      14-16 (80286), 15-16(80386)

Popis:                         Druhý   operand   instrukce   LAR   obsahuje
                               selektor. Jestliže  je  pøíslušný deskriptor
                               na aktuální privilegované úrovni viditelný a
                               selektor  je  RPL,   je   byte  pøístupových
                               oprávnìní  (access  rights  byte) zaveden do
                               horního byte prvního (registrového) operandu
                               instrukce LAR a nižší byte je nastaven na 0.
                               Bylo-li zavedení dokonèeno, má ZF hodnotu 1;
                               jinak je nulován.

Syntaxe:                       LAR access_rights_byte,selector

Ovlivòuje pøíznaky:            ZF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována všeobecná výjimka ochrany pamìti.
                               Jestliže  SS  obsahuje  neplatnou adresu, je
                               generována výjimka "chyba zásobníku".

Výjimky v RM:                  Je  generováno  pøerušení  INT  6. V RM není
                               instrukce LAR rozpoznána.

Poznámka pro 80386:            -

Pøíklad:                       LAR ARB,SELECTR

LSS/LFS/LGS (80386), LDS/LES (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zaveï dvouslovní ukazatel

Èasování:                      7

Popis:                         Instrukce    LDS/LES    zavádìjí    4-bytový
                               ukazatel,     lokalizovaný     na     adrese
                               specifikované druhým operandem instrukce, do
                               segmentového  a  slovního   registru.  První
                               slovo  ukazatele  (offset)  je  zavedeno  do
                               registru  vystupujícího  jako  první operand



                                  - 81 - 




                               instrukce.  Poslední   slovo   ukazatele  je
                               zavedeno  do  DS  registru (u instrukce LDS)
                               nebo ES registru (u instrukce LES).

Syntaxe:                       LDS destination,source

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Možné   výjimky   jsou:   všeobecná  výjimka
                               porušení   ochrany   a   "deskriptor   nebyl
                               nalezen".  Jestliže  je operand  vnì  hranic
                               limitu  segmentu,  je  generována  všeobecná
                               výjimka   ochrany   nebo    výjimka   "chyba
                               zásobníku". Jestliže je  zdrojovým operandem
                               registr, je generována výjimka "nedefinovaný
                               operaèní kód".

Výjimky v RM:                  Pro  operand na offsetu 0FFFFH nebo  0FFFFDH
                               je generováno pøerušení INT 13.  Jestliže je
                               zdrojový  operand  registr,   je  generována
                               výjimka "nedefinovaný operaèní kód".

Poznámka pro 80386:            Šíøka slova je 32 bitù. Ukazetelé mají
šíøku 48 bitù.

Pøíklad:                          LDS  SI,DOUBLEWORD1
                                  LES  BX,DOUBLEWORD2

LEA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zaveï offset efektivním adresy

Èasování:                      3 (80286), 2 (80386)

Popis:                         Instrukce LEA pøesouvá offset ze  zdrojového
                               do   cílového   operandu.    První   operand
                               instrukce LEA je cílový registr, do nìhož se
                               pøesouvá offset druhého operandu.

Syntaxe:                       LEA source,destination

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je-li druhý operand  registr,  je generována
                               výjimka "nedefinovaný operaèní kód".

Výjimky v RM:                  Je-li druhý operand  registr,  je generována
                               výjimka "nedefinovaný operaèní kód".

Poznámka pro 80386:            Šíøka  slova je 32 bitù. Adresy pamìti  jsou
                               vytváøeny z 32-bitových efektivních adres.



                                  - 82 - 




Pøíklad:                          LEA  AX,[BP][DI]
                                  LEA  EBX,MYDATA ; jen pro 80386

LEAVE (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Výstup z procedury (na vyšší úrovni)

Èasování:                      5 (80286), 4 (80386)

Popis:                         Instrukce  LEAVE  provádí operaci  duální  k
                               instrukci   ENTER.   LEAVE   uvolní  všechny
                               lokální promìnné a nastaví BP na hodnotu SP,
                               navrací registrùm  hodnoty  bezprostøednì po
                               vykonání   procedury.   Když   je  BP  (EBP)
                               kopírován   do   SP   (ESP),  je  prostor  v
                               zásobníku  použitý  pro  proceduru  uvolnìn.
                               Starý  ukazatel  struktury   (viz  instrukci
                               ENTER)  je nyní  vyzvednut  ze  zásobníku  a
                               uložen  do BP  (EBP);  to  obnoví  strukturu
                               volajícího    (pod)programu   a    následuje
                               instrukce   RET   nn   odstraòující  všechny
                               argumenty uložené do  zásobníku  pro potøeby
                               procedury, která právì konèí.

Syntaxe:                       LEAVE (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Neukazuje-li  BP  (EBP)  na  pamìové  místo
                               uvnitø aktuálního zásobníkového segmentu, je
                               generována výjimka "chyba zásobníku".

Výjimky v RM:                  Je-li   operand   na  offsetu   0FFFFH,   je
                               generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka   slova  je  32  bitù.  Jsou   použity
                               registry ESP a EBP.

Pøíklad:                       LEAVE

LGDT/LIDT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zaveï registr tabulky globálních deskriptorù
                               Zaveï registr tabulky deskriptorù pøerušení

Èasování:                      11-12

Popis:                         Instrukce  LGDT  nebo  LIDT  zavádí  6  byte
                               pamìti referované efektivní adresou operandu
                               do  tabulky  globálních  deskriptorù nebo do
                               tabulky  deskriptorù  pøerušení.  Pole LIMIT
                               registru tabulky deskriptorù  je  zavádìno z



                                  - 83 - 




                               prvního slova; další tøi byte  jsou zavedeny
                               do  pole BASE uvedeného registru a  poslední
                               byte  je  ignorován.  Tyto  instrukce   jsou
                               urèeny  pro  systémové  software  (OS)  a  v
                               aplikaèních programech nejsou používány.

Syntaxe:                       LGDT memory_operand

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  V pøípadì, že aktuální privilegovaná  úroveò
                               není nulová, je generována všeobecná výjimka
                               privilegovaného   módu.  Jestliže   obsahuje
                               registr SS neplatnou  adresu,  je generována
                               výjimka  "chyba   zásobníku".   Jestliže  je
                               zdrojový  operand  registrem,  je generována
                               výjimka    "nedefinovaný   operaèní    kód".
                               Jestliže  registry  CS,DS nebo  ES  obsahují
                               neplatnou  efektivní  adresu   operandu,  je
                               generována všeobecná výjimka privilegovaného
                               módu.

Výjimky v RM:                  Jestliže leží operand na offsetu  OFFFFH, je
                               generováno pøerušení INT 13.

Poznámka pro 80386:            -

Pøíklad:                          LGDT MEM_WRD
                                  LIDT MEM_WRD

LLDT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zaveï registr tabulky lokálních deskriptorù

Èasování:                      17-19 (80286), 20 (80386)

Popis:                         Instrukce LLDT zavádí  selektor  do registru
                               tabulky   lokálních   deskriptorù.   Operand
                               word_operand instrukce LLDT by mìl obsahovat
                               selektor  ukazující  do  tabulky  globálních
                               deskriptorù. Položka v této tabulce  by mìla
                               být   tabulkou   lokálních   deskriptorù.  V
                               takovém pøípadì je registr tabulky lokálních
                               deskriptorù   zaveden   z    této   položky.
                               Instrukce je urèena pro použití v systémovém
                               (OS) software a v aplikaèním software nebývá
                               použita.

Syntaxe:                       LLDT word_operand

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné



                                  - 84 - 




Výjimky v PM:                  Jestliže aktuální privilegovaná  úroveò není
                               0, je generována všoebecná výjimka  porušení
                               ochrany pamìti. Stejná výjimka je generována
                               v pøípadì, že selektor neukazuje  na tabulku
                               globálních  deskriptorù  nebo  v pøípadì, že
                               položka  v  tabulce  globálních  deskriptorù
                               není lokální tabulkou deskriptorù. Když není
                               lokální  deskriptor  nalezen,  je generována
                               výjimka  "deskriptor   nenalezen".  Jestliže
                               registry  CS,  DS  nebo ES obsahují neplatné
                               efektivní  adresy  operandù,  je  generována
                               všeobecná výjimka  porušení  ochrany pamìti.
                               Jestliže  SS  obsahuje  neplatnou adresu, je
                               generována výjimka "chyba zásobníku".

Výjimky v RM:                  Je  generováno  pøerušení  INT  6. V RM není
                               instrukce LLDT rozpoznána.

Poznámka pro 80386:            -

Pøíklad:                       LLDT BP

LMSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav stavové slovo procesoru (MSW)

Èasování:                      3-6 (80286), 10-13 (80386)

Popis:                         Instrukce  LMSW  zavádí do  stavového  slova
                               procesoru (MSW, Machine  Status  Word) obsah
                               zdrojového   operandu.   Je   to   instrukce
                               vyhrazená   pro    systémový    software   a
                               nevyskytuje  se  v  aplikaèních  programech.
                               LMSW    lze    použít    k    pøepnutí    do
                               privilegovaného  módu  (ale  u 80286 nikoliv
                               pro   návrat   z   privilegovaného  módu  do
                               reálného) . V takovém pøípadì musí být další
                               instrukce        privilegovaného        módu
                               intrasegmentový  skok,  aby  se  "vyèistila"
                               fronta instrukcí.

Syntaxe:                       LMSW source_operand

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Není-li aktuální privilegovaná úroveò 0,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany  pamìti.  Jestliže registry  CS,  DS
                               nebo ES obsahují  neplatné  efektivní adresy
                               operandù,  je  generována  rovnìž  všeobecná
                               výjimka porušení ochrany pamìti. Jestliže SS
                               obsahuje  neplatnou  adresu,  je  generována
                               výjimka "chyba zásobníku".



                                  - 85 - 




Výjimky v RM:                  Jestliže leží operand na offsetu  OFFFFH, je
                               generováno pøerušení INT 13.

Poznámka pro 80386:            -

Pøíklad:                       LMSW SP

LOCK (80386)
---------------------------------------------------------------------------

Instrukce:                     Aktivuj signál BUS LOCK

Èasování:                      0

Popis:                         Prefix  LOCK  pøed instrukcí  vyjadøuje,  že
                               oblast   pamìti    specifikovaná   operandem
                               instrukce instruction bude zablokována. Toho
                               je  dosaženo  aktivací   signálu   BUS  LOCK
                               procesoru  80386;  oblast  pamìti zùstává ve
                               skuteènosti   zablokována  a   protektována,
                               dokud  procesor   nevykoná   instrukci,  jež
                               odblokuje pamìovou oblast stejnou s oblastí
                               specifikovanou  druhým  operandem  instrukce
                               LOCK.  Instrukce  u  80386,  jež  mohou  mít
                               prefix LOCK, jsou následující:

                               BT,BTS,BTR,BTC pamì,registr/bezpr._operand

                               XCG     pamì, registr

                               XCG     registr, pamì

                               ADC,SUB,ADC,SBB pamì,registr/bezpr_operand

                               OR,XOR,AND pamì, registr/bezpr._operand

                               NEG,INC,DEC,NOT pamì

Syntaxe:                       LOCK instruction,operand_type

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je  generována  všeobecná  výjimka  porušení
                               ochrany   pamìti   v    pøípadì,    že   I/O
                               privilegovaná úroveò je  nižší  než aktuální
                               privilegovaná úroveò .

Výjimky v RM:                  žádné

Poznámka pro 80386:            Blokovací  funkce  u  80386 jsou podmnožinou
                               blokovacích funkcí u 8086 a  80286. Aplikace
                               psané pro 8086  a 80286 tedy nemusí probíhat
                               korektnì na 80386.




                                  - 86 - 




Pøíklad:                       LOCK XCG MEM_WRD,AX

LODS/LODSW/LODSB (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zaveï bytový nebo slovní øetìzec do støadaèe

Èasování:                      5

Popis:                         Instrukce LODS pøesouvá  slovní  nebo bytový
                               operand   z   místa    zdrojového   operandu
                               referovaného registrem SI (ESI) do  støadaèe
                               AX   nebo   AL.   SI  (ESI)  je  automaticky
                               aktualizován.  Jestliže  je  DF  =  0  (bylo
                               provedeno CLD), je  SI  (ESI) inkrementován;
                               jestliže je DF = 1 (bylo provedeno  STD), je
                               SI  (ESI)  dekrementován.   Inkrement  resp.
                               dekrement je roven 1 pro bytové operandy a 2
                               pro slovní operandy.

Syntaxe:                       LODS source_string
                               LODSB (žádné operandy)
                               LODSW (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  leží  slovní  operand  na  offsetu
                               OFFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                       LEA     SLDATA    ; jsou-li data 16-bitová,
                               LODS              ; je výsledek v AX

LOOP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Cyklus øízený registrem CX

Èasování:                      8 (80286), 11 (80386)

Popis:                         Instrukce LOOP dekrementuje registr CX  o 1.
                               Žádné   pøíznaky   nejsou    ovlivnìny.   Po
                               dekrementování jsou  testovány  podmínky pro
                               instrukci  LOOPx (viz syntaxe) a pokud  jsou
                               splnìny, je proveden skok uvnitø segmentu na
                               místo   specifikované  operandem   instrukce



                                  - 87 - 




                               LOOPx.  Tento  operand  musí  ležet  (jde  o
                               návìští !) v rozsahu 128 byte pøed instrukcí
                               LOOPx až 127 byte za instrukcí LOOPx.

Syntaxe:                       LOOP short_target
                               LOOPE short_target
                               LOOPZ short_target
                               LOOPNZ short_target
                               LOOPNE short_target

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je generována všeobecná výjimka ochrany  pøi
                               pokusu  o  skok na adresu  s  offsetem  mimo
                               hranice aktuálního kódového segmentu CS.

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                               MOV CL,04H
                               AGAIN:  ADD BX,01H
                                       ADD AL,INFO[BX]
                                       DAA
                                       LOOP AGAIN
                                       MOV CX,12H
                               NEXT:   INC BX
                                       CMP TABLE[BX],0
                                       LOOPE NEXT
                                            ; jen pro 80386
                                       MOV ECX,0ABCDEH
                               REPEAT: INC BX
                                       MOV AL,TABLE_A[BX]
                                       ADD AL,TABLE_B[BX]
                                       MOV TOTAL[BX],AL
                                       LOOPNZ REPEAT

LSL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Získej limit segmentu

Èasování:                      14-16 (80286), 20-26 (80386)

Popis:                         Pokud  je selektor (druhý operand -  registr
                               nebo  pamì)  viditelný  pøi  CPL   (Current
                               Privilege  Level),  je  do cílového operandu
                               instrukce pøesunuto  slovo  z  pole  LIMIT v
                               deskriptoru.   Cílový   operand   musí   být
                               registr. Jeho hodnota udává velikost  limitu
                               pro  tento  segment.  Jestliže  byl   pøesun
                               uskuteènìn, je  pøíznak  ZF  nastaven  na 1;
                               jinak je ZF nulován.




                                  - 88 - 




Syntaxe:                       LSL seg_limit,selector

Ovlivòuje pøíznaky:            ZF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Je generováno pøerušení INT 6. Instrukce LSL
                               není v RM rozpoznána.

Poznámka pro 80386:            -

Pøíklad:                       LSL AX,SELECTR

LTR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Naplò registr úlohy

Èasování:                      17-19 (80286),23-27 (80386)

Popis:                         Instrukce  LTR  naplní registr  úlohy  (task
                               register) obsahem  zdrojového  registru nebo
                               pamìové lokace stojící na místì  zdrojového
                               operandu. Jde o instrukci operaèního systému
                               nevyskytující se v aplikaèních programech.

Syntaxe:                       LTR source_operand

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Je generováno pøerušení INT 6. Instrukce LTR
                               není v RM rozpoznána.

Poznámka pro 80386:            -

Pøíklad:                       LTR MEM_WRD







                                  - 89 - 




MOV (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Pøesun dat

Èasování:                      2-19 (80286), 2-22 (80386)

Popis:                         Instrukce  MOV  kopíruje   obsah  zdrojového
                               operandu do operandu  cílového.  K dispozici
                               je nìkolik instrukcí MOV, které mají všechny
                               stejnou funkci: kopírují zdrojový operand do
                               cílového beze zmìny zdrojového operandu.

Syntaxe:                       MOV destination,source

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  je  naplòován  segmentový registr,
                               mohou  být  generovány   výjimky:  všeobecná
                               výjimka  porušení  ochrany  pamìti,  výjimka
                               "chyba zásobníku"  nebo  výjimka "deskriptor
                               nenalezen".   Všeobecná   výjimka   porušení
                               ochrany  pamìti  mùže  být generována také v
                               pøípadì,  že cílový operand leží v  segmentu
                               nepøístupném zápisu.  Jestliže  registry CS,
                               DS  nebo  ES  obsahují  neplatné   efektivní
                               adresy  operandù,  je  generována  všeobecná
                               výjimka ochrany pamìti. Jestliže SS obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže leží operand na offsetu  OFFFFH, je
                               generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka   slova   je   32  bitù.  Adresy  jsou
                               vytvoøeny  pomocí   32-bitových  efektivních
                               adres nebo 32- bitových offsetù.

Pøíklad:                       Do støadaèe z pamìti
                               MOV AX,MEM_WRD
                               MOV ECX,MYWORD ; jen pro 80386

                               Do pamìti ze støadaèe
                               MOV MEM_BYTE,AL

                               Do pamìti/registru ze segmentového registru
                               MOV BX,ES
                               MOV TABLE[BX],SS

                               Do segmentového registru z pamìti/registru
                               MOV ES,NEXT_WRD[SI]
                               MOV DS,AX

                               Do registru z registru



                                  - 90 - 




                               MOV CX,DI
                               MOV EAX,ECX ; jen pro 80386

                               Do registru z pamìti/registru
                               MOV AX,MEM_VAL
                               MOV CX,[BP][SI]

                               Do registru z bezprostøedního operandu
                               MOV DI,513
                               MOV EAX,12345678H ;jen pro 80386

                               Do pamìti/registru z bezpr. operandu
                               MOV TABLE[BP][SI],25
                               MOV BX,77

MOVS/MOVSB/MOVSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Pøesuò bytový nebo slovní øìtìzec

Èasování:                      5 (80286), 7 (80386)

Popis:                         Instrukce MOV pøesouvají obsah slova  (bytu)
                               referovaného  [SI]  ([ESI])  do slova (byte)
                               adresovaného   ES:[DI]  (ES:[EDI]).   Cílový
                               operand  musí  být  adresovatelný z registru
                               ES. Po vykonání  instrukce jsou DI(EDI) i SI
                               (ESI)  automaticky  aktualizovány.  Pøi DF=0
                               (byla vykonána instrukce CLD) jsou  registry
                               inkrementovány,   jinak   (pøi   DF=1  (byla
                               vykonána  instrukce   STD))   jsou  registry
                               automaticky                  dekrementovány.
                               Dekrement/inkrement je 1  pro bytové a 2 pro
                               slovní operace.

Syntaxe:                       MOVS destination_string,source_string
                               MOVSB (žádné operandy)
                               MOVSW (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku". Jestliže je místo  urèení
                               v   segmentu    nepøístupném    zápisu,   je
                               generována   všeobecná    výjimka   porušení
                               ochrany pamìti.

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.




                                  - 91 - 




Poznámka pro 80386:            Adresy  v  pamìti  jsou vytváøeny pomocí 32-
                               bitové  efektivní  adresy.  Délka øetìzce je
                               odvozena od registru ECX.

Pøíklad:                       LEA SI,MYSOURCE
                               LEA DI,ES:HERDESTINATION
                               MOV CX,50
                               REP MOVS HERDESTINATION

MOVZX/MOVSX (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Pøesun s extenzí znaménkového bitu

Èasování:                      3 - 6

Popis:                         Instrukce  MOVZX a  MOVSX  jsou  doplnìny  k
                               instrukcím pøesunu  MOVx  k  tomu,  aby bylo
                               možné  pøesunout  8-mi   nebo   16-  bitovou
                               hodnotu do  registru  s  extenzí  (nuly nebo
                               znaménka) do 16-ti nebo 32 bitù.

Syntaxe:                       MOVZX register,register/memory
                               MOVSX register,register/memory

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  V  pøípadì,  že  adresa  operandu  v  pamìti
                               porušuje  pøístupová  práva  nebo  leží  vnì
                               hranic  segmentu,  je  generována  všeobecná
                               výjimka   porušení   ochrany   pamìti.   Pøi
                               neplatné adrese v segmentu SS  je generována
                               výjimka "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            -

Pøíklad:                       MOVZX EAX,BX
                               MOVZX CX,AL
                               MOVSX AX,BX ; normální pøesun
                               MOVSX ECX,CL
                               MOVSX EAX,MYMEMORY

MUL (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Násobení bez znaménka (unsigned)

Èasování:                      13-21 (80286), 9-41 (80386)






                                  - 92 - 




Popis:                         Operace MUL provádí  násobení  bez znaménka.
                               Bytový operand instrukce MUL vynásobí  obsah
                               registru AL a  výsledek uloží v registru AX.
                               Pøíznaky CF  a OF jsou nastaveny do 0 pøi AH
                               nulovém; jinak jsou nastavovány do 1. Slovní
                               operand instrukce MUL vynásobí registr  AX a
                               výsledek ponechá v  registrovém  páru DX:AX.
                               DX obsahuje 16 vyšších bitù výsledku, AX pak
                               16 nižších bitù. CF a OF jsou nastaveny do 0
                               pøi  DX nulovém; jinak jsou nastaveny do  1.
                               Viz poznámku pro 80386.

Syntaxe:                       MUL source

Ovlivòuje pøíznaky:            OF, CF

Nedefinované pøíznaky:         SF, ZF, CF, AF

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka slova je  32 bitù. Násobení ve dvojité
                               pøesnosti  je  zajištìno násobením  EAX  32-
                               bitovým pamìovým místem/registrem. Výsledek
                               je 64-bitový a je umístìn v registrovém páru
                               EDX:EAX.

Pøíklad:                       násobení bytu slovem
                               MOV AL,MULT_BTE
                               CBW ; konverze byte v AL do slova v AX
                               MUL VAL_BTE
                               násobení bytu bytem
                               MOV AL,MULTP_BTE
                               MUL VAL_BTE
                               násobení slova slovem
                               MOV AX,MULT_PWRD
                               MUL VAL_WRD ; vyšší bity v DX, nižší v AX
                               80386
                               MOV EAX,0FCAB1234H
                               MUL EBX

NEG (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Negace ve dvojkovém doplòkovém kódu

Èasování:                      2-7 (80286),2-6 (80386)





                                  - 93 - 




Popis:                         Instrukce NEG odeèítá operand od  0, pøièítá
                               k  takto vzniklé hodnotì 1 a vrací  výsledek
                               na místo pùvodního operandu, vytváøejíc  tak
                               dvojkový doplnìk. Pøíznak CF je  nastaven na
                               1  (s  výjimkou  nulového  operandu,   který
                               zpùsobí nastavení CF na 0).

Syntaxe:                       NEG destination

Ovlivòuje pøíznaky:            OF, SF, CF, ZF, AF, PF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  V   pøípadì,  že  výsledek  je  v   segmentu
                               chránìném   proti   zápisu,   je  generována
                               všeobecná výjimka  porušení  ochrany pamìti.
                               Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                       NEG AL
                               NEG EBX (jen pro 80386)

NOP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Prázdná operace

Èasování:                      3

Popis:                         Instrukce  nevyvolá  žádnou operaci.  Je  to
                               jednobytová   instrukce   modifikující   jen
                               registr IP (EIP).

Syntaxe:                       NOP (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       NOP




                                  - 94 - 




NOT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Logická negace

Èasování:                      2-7 (80286), 2-6 (80386)

Popis:                         Instrukce  NOT  neguje  každý  bit  ve  svém
                               operandu a vrací výsledek na  pùvodní místo.
                               Žádné pøíznaky nejsou ovlivnìny.

Syntaxe:                       NOT destination

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  V   pøípadì,  že  výsledek  je  v   segmentu
                               chránìném   proti   zápisu,   je  generována
                               všeobecná výjimka ochrany. Jestliže registry
                               CS,  DS nebo ES obsahují neplatné  efektivní
                               adresy  operandù,  je  generována  všeobecná
                               výjimka ochrany pamìti. Jestliže SS obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       NOT AX
                               NOT EBX ;(jen pro 80386)

OR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Logická disjunkce

Èasování:                      2-7 (80286), 2-7 (80386)

Popis:                         Instrukce  OR  provádí   inkluzívní  logický
                               souèet  nad  dvìma  operandy. Korespondující
                               bitové  dvojice  obsahující  oba bity nulové
                               vrací  hodnotu 0, jinak hodnotu 1.  Výsledek
                               je uložen v cílovém operandu.

Syntaxe:                       OR destination,source

Ovlivòuje pøíznaky:            CF = 0, OF = 0, SF, ZF, PF

Nedefinované pøíznaky:         AF

Výjimky v PM:                  V   pøípadì,  že  výsledek  je  v   segmentu
                               chránìném   proti   zápisu,   je  generována
                               všeobecná výjimka  porušení  ochrany pamìti.



                                  - 95 - 




                               Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù.

Pøíklad:                       OR CX,DI
                               OR EAX,0FFFF0000H ;(jen pro 80386)
                               OR EBX,ECX ;(jen pro 80386)

OUT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Výstup slova nebo byte

Èasování:                      3 (80286), 3-4 (80386)

Popis:                         Obsah støadaèe ( AX nebo  AL)  je  vyslán na
                               výstupní  port.  Jako   výstup   lze  použít
                               jakýkoliv port 0 až 65535.

Syntaxe:                       OUT port, accumulator

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  je   hodnota   IOPL  (Input/Output
                               Privilege Level-v  registru  pøíznakù) vyšší
                               než   aktuální   privilegovaná   úroveò,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany pamìti.

Výjimky v RM:                  žádné

Poznámka pro 80386:            šíøka slova je 32 bitù.

Pøíklad:                       OUT WRD_PORT,AX
                               OUT BYT_PORT,AL
                               OUT EDX,EAX ; (jen pro 80386)

OUTS/OUTSB/OUTSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Výstup bytového/slovního øetìzce na port

Èasování:                      5 (80286), 7 (80386)






                                  - 96 - 




Popis:                         Instrukce  OUT  pøesouvá  bytový nebo slovní
                               øetìzec  adresovaný  v  pamìti DS:SI na port
                               specifikovaný  adresou  v  DX. Druhý operand
                               instrukce  OUT  urèuje  typ pøesouvaných dat
                               (slova   nebo   byty).   SI  je  automaticky
                               inkrementován o 1 pøi DF=0; pøi DF = 1 je SI
                               dekrementován o 1. Pøírùstek je 1 pro bytové
                               a 2 pro slovní operandy.

Syntaxe:                       OUTS port,source_string
                               OUTSB (žádné operandy)
                               OUTSW (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže je hodnota  CPL  (Current Privilege
                               Level)   vìtší   nebo   rovná  hodnotì  IOPL
                               (Input/Output    Privilege     Level),    je
                               generována   všeobecná    výjimka   porušení
                               ochrany  pamìti.  Tato   výjimka   mùže  být
                               generována také v pøípadì, že CS, DS nebo ES
                               obsahuje    neplatnou    efektivní    adresu
                               operandu.  Jestliže   segment   CS  obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32  bitù.  Adresy  operandù v
                               pamìti jsou vytváøeny ze 32-bitové efektivní
                               adresy. Šestnáctibitová èást adresy je brána
                               z  registru  DX.   32-   bitová  specifikace
                               neovlivní adresu I/O portu. Délka øetìzce je
                               brána z registru ECX.

Pøíklad:                       OUTS DX,BYT_WRD
                               OUTS DX,WRD_STRNG
                               OUTSB
                               OUTSW

POP (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vyzvedni operand ze zásobníku

Èasování:                      5 (80286), 5-7 (80386)

Popis:                         Instrukce   POP   vyzvedává   obsah  vrcholu
                               zásobníku a ukládá jej do DS, ES, SS, pamìti
                               nebo  registru.  Instrukce POP  vezme  slovo
                               adresované   registrem   SP    (=   ukazatel
                               zásobníku)    a    uloží    jej   na   místo




                                  - 97 - 




                               specifikované  cílovým operandem  instrukce.
                               Ukazatel zásobníku je pak zvýšen o 2.

Syntaxe:                       POP destination

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je-li  ze  zásobníku  zavádìna  hodnota   do
                               segmentového    registru,   je    generována
                               všeobecná výjimka  porušení  ochrany pamìti,
                               výjimka  "chyba   zásobníku"   nebo  výjimka
                               "deskriptor   nenalezen".   Výjimka   "chyba
                               zásobníku" je generována také v  pøípadì, že
                               aktuální  vrchol  zásobníku není  umístìn  v
                               rozsahu  právì  adresovaného   segmentu  SS.
                               Stejnou výjimku bude generovat také umístìní
                               operandu  instrukce  v   segmentu  chránìném
                               proti zápisu. Jestliže registry CS,  DS nebo
                               ES   obsahují   neplatné   efektivní  adresy
                               operandù,  je  generována  všeobecná výjimka
                               porušení   ochrany   pamìti.   Jestliže   SS
                               obsahuje  neplatnou  adresu,  je  generována
                               výjimka "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32  bitù.  Adresy  operandù v
                               pamìti   jsou   vytváøeny    z   32-bitových
                               efektivních adres.

Pøíklad:                       Registrový operand
                               POP CX
                               POP EAX (jen pro 80386)
                               Segmentový registr
                               POP SS

POPA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vyzvedni všechny všeobecné registry

Èasování:                      19 (80286), 24 (80386)

Popis:                         Instrukce  POPA  vyzvedává  obsah všech osmi
                               šestnáctibitových registrù (DI, SI, BP,  SP,
                               BX, DX, CX,  AX)  (resp. dvaatøicetibitových
                               EDI,  ESI,  EBP, ESP, EBX,  EDX,  ECX,  EAX)
                               kromì SP (resp.  ESP). Hodnota SP (ESP) není
                               obnovována.  Instrukce  POPA  je  duální   k
                               instrukci  PUSHA,  která  všechny  všeobecné
                               registry   ukládá   na    zásobník.   Prvním
                               registrem, který instrukce POPA vyzvedává ze
                               zásobníku, je DI (EDI).



                                  - 98 - 




Syntaxe:                       POPA (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže není vrchol zásobníku uvnitø hranic
                               segmentu  SS,  je  generována výjimka "chyba
                               zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù.

Pøíklad:                       POPA

POPF (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Vyzvednutí obsahy pøíznakových registrù

Èasování:                      5

Popis:                         Instrukce  POPF  používá  regitrovou dvojici
                               SS:SP   k   referenci   vrcholu   zásobníku.
                               Instrukce POPF pak kopíruje vrchol zásobníku
                               do   registru   pøíznakù.   SP   (ESP)    je
                               automaticky inkrementován o 2. Pøíznaky jsou
                               v   takto    získaném    registru   pøíznakù
                               definovány následovnì (od bitu 15 k bitu 0):
                               Nedefinováno,  Nested  Task,  I/O  Privilege
                               Level  (dva   bity),   Overflow,  Direction,
                               Interrupt   Enabled,   Trap,   Sign,   Zero,
                               Nedefinováno, Auxiliary Carry, Nedefinováno,
                               Parity, Nedefinováno a Carry.

Syntaxe:                       POPF (žádné operandy)
Ovlivòuje pøíznaky:            Celý  registr  pøíznakù   je   vyzvednut  ze
                               zásobníku.

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  je  vrchol  zásobníku mimo hranice
                               segmentu  SS,  je  generována výjimka "chyba
                               zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù.

Pøíklad:                       POPF






                                  - 99 - 




PUSH (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Ulož slovo na vrchol zásobníku

Èasování:                      3-5 (80286), 2-5 (80386)

Popis:                         Instrukce  PUSH  snižuje  hodnotu  ukazatele
                               zásobníku SP (ESP) o  2  a  její  operand je
                               umístìn  na  nový  vrchol  zásobníku.  Je-li
                               ukládána  hodnota registru SP (ESP), pak  ji
                               instrukce  PUSH   u   procesoru  80286/80386
                               ukládá  takovou,  jaká  byla pøed provedením
                               instrukce PUSH (na rozdíl  od  PUSH  u 8086,
                               kde    byla     uchovávána     hodnota    SP
                               dekrementovaná    o    2).    Ukládat    lze
                               ES,CS,SS,DS,  pamìové místo,  bezprostøední
                               operand èi registr.

Syntaxe:                       PUSH source

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  je  nová  hodnota  SP  vnì  limitu
                               segmentu  SS,  je  generována výjimka "chyba
                               zásobníku". Jestliže registry CS,DS nebo  ES
                               obsahují neplatné efektivní adresy operandù,
                               je  generována  všeobecná  výjimka  porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù. Pamìové adresy jsou
                               vytváøeny z 32-bitových efektivních adres.

Pøíklad:                       PUSH AX
                               PUSH EBX ;(jen pro 80386)
                               PUSH CS

PUSHA (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Ulož do zásobníku všechny všeobecné registry

Èasování:                      17 (80286), 18 (80386)

Popis:                         Ukládá   registry   AX,CX,DX,BX   a  pùvodní
                               SP,BP,SI,DI (resp. EAX,ECX,EDX,EBX a pùvodní
                               ESP,EBP,ESI,EDI)  do  zásobníku,  v uvedeném
                               poøadí. Ukazatel zásobníku  je dekrementován
                               o 16 (je ukládáno 8 dvoubytových hodnot).



                                  - 100 - 




Syntaxe:                       PUSHA (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je  generována  výjimka  "chyba zásobníku" v
                               pøípadì,  že poèáteèní èi koneèná adresa  je
                               vnì rozsahu segmentu SS.

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù.

Pøíklad:                       PUSHA

PUSHF (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Ulož registr pøíznakù na zásobník

Èasování:                      3 (80286), 4 (80386)

Popis:                         Instrukce  PUSHF  dekrementuje   registr  SP
                               (ESP)  o  2  a  kopíruje registr pøíznakù (=
                               všechny pøíznakové registry) do specifických
                               bitù    slovního    operandu    adresovaného
                               registrem  SP   (ESP).   Následující  seznam
                               definuje poøadí pøíznakù  poèínaje nejvyšším
                               (15.) bitem  a  konèe  nejnižším  (0.) bitem
                               onoho   slovního   operandu:   Nedefinováno,
                               Nested Task,I/O Privilege Level (dva  bity),
                               Overflow,   Direction,  Interrupt   Enabled,
                               Trap,  Sign,  Zero,  Nedefinováno, Auxiliary
                               Carry, Nedefinováno, Parity,  Nedefinováno a
                               Carry.

Syntaxe:                       PUSHF (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je  generována  výjimka  "chyba zásobníku" v
                               pøípadì,  že poèáteèní èi koneèná adresa  je
                               vnì rozsahu segmentu SS.

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Instrukce ukládá 32-bitový rozšíøený registr
                               pøíznakù.

Pøíklad:                       PUSHF




                                  - 101 - 




RCL/RCR/ROL/ROR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Instrukce rotací

Èasování:                      2-5 (80286), 3-10 (80386)

Popis:                         Každá z uvedených  instrukcí  rotací posouvá
                               specifické bity registrového nebo pamìového
                               operandu.  Instrukce  ROL  posunuje (rotuje)
                               všechny  bity  operandu  doleva  o   1  bit,
                               pøièemž  bit  MSB  (nejvyšší) se pøesouvá na
                               místo LSB (nejnižší). Instrukce ROR  provádí
                               posuv (rotaci) pøesnì opaènì -  všechny bity
                               se posunou  o 1 místo doprava a na místo MSB
                               se  pøesune  bit LSB. Instrukce  RCL  a  RCR
                               užívají  hodnotu  pøíznaku   CF   jako  èást
                               pøesouvané velièiny. Instrukce  RCL pøesouvá
                               CF do LSB a MSB do CF. Instrukce RCR provádí
                               pøesnì opaèný pøesun: CF do MSB a LSB do CF.
                               Druhý operand  instrukcí  rotací specifikuje
                               poèet pozic, o  které se má zdrojový operand
                               posunout. Pøíznak pøeteèení  OF  je nastaven
                               jen  v  pøípadì, že u  instrukcí  rotací  je
                               druhý operand roven  1.  U  RCR  je  test na
                               pøeteèení provádìn pøed rotací, pro RCL, ROL
                               a ROR po rotaci. Pøíznak OF je  nastavován v
                               tìchto situacích:  pokud  CF  =  MSB, nastav
                               OF:=0; pokud CF<>MSB, nastav OF := 1.

Poznámka:                      Obvod 80286/80386 neumožòuje provádìt rotace
                               o více než 31 bitù. Je použito jen nižších 5
                               bitù èítaèe poètu rotací i v pøípadì,  že je
                               snaha o provedení rotace o více než 31 bitù.

Syntaxe:                       RCL destination
                               RCL destination,CL
                               RCL destination,count
                               RCR destination
                               RCR destination,CL
                               RCR destination,count
                               ROL destination
                               ROL destination,CL
                               ROL destination,count
                               ROR destination
                               ROR destination,CL
                               ROR destination,count

Ovlivòuje pøíznaky:            OF (jen pro rotaci o 1 bit),CF

Nedefinované pøíznaky:         OF pro vícebitové rotace

Výjimky v PM:                  Jestliže  registry  CS,DS nebo  ES  obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje



                                  - 102 - 




                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku". Jestliže je místo  urèení
                               v   segmentu    nepøístupném    zápisu,   je
                               generována   všeobecná    výjimka   porušení
                               ochrany pamìti.

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                       RCL AH,1
                               RCL MEMRY_BTE,REP_VAL
                               RCL DH,CL
                               RCR BL,1
                               RCR TABLE[BX][DI],CL
                               ROL CX,1
                               ROL AX,CL
                               ROR BL,1
                               ROR MEMRY_BTE,REP_VAL
                               ROR TABLE[DX][DI],CL

REP/REPZ/REPE/PEPNE/REPNZ (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Opakuj øetìzcovou operaci

Èasování:                      5+9xN, kde N je poèet iterací

Popis:                         REP, REPE  a  REPNE  jsou  prefixové operace
                               které  zpùsobují,  že primitivní  operace  s
                               øetìzci zapsaná jako operand tìchto  operací
                               bude provádìna opakovanì  tak  dlouho, dokud
                               nebude registr CX roven nule.  Pro instrukce
                               SCAS a CMPS repetice konèí v pøípadì,  že po
                               opakování instrukce za  prefixem  se pøíznak
                               ZF liší od "z"-bitu prefixu.

Syntaxe:                       REP
                               REPE
                               REPNE

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       LEA DI,VALUE1 ; pøiprav cílový øetìzec
                               LEA SI,VALUE2 ; pøprav zdrojový øetìzec
                               REPE CMPSB ; opakuj, pokud jsou si ve
                               ; srovnání byte-po-byte rovny



                                  - 103 - 




RET (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Návrat z procedury

Èasování:                      15-55 (80286), 10-68 (80386)

Popis:                         Instrukce  zabezpeèuje pokraèování  programu
                               tím, že  pøenese  øízení  progamu  na adresu
                               návratu, která byla  (pøi  volání procedury)
                               uložena do zásobníku. Tato adresa je obvykle
                               umístìna   do   zásobníku   instrukcí  CALL.
                               Intrasegmentové  (NEAR)  návraty   RET  plní
                               registr   instrukce  (instruction   pointer)
                               dvìma  nejhornìjšími   byty   umístìnými  na
                               vrcholu  zásobníku.  Tyto dva  byty  udávají
                               offset  instrukce,  která  má být vykonávána
                               jako  další.  Intersegmentové  (FAR) návraty
                               RET  zaèínají  stejnì  jako  intrasegmentové
                               pøenesením  horních  dvou  byte ze zásobníku
                               (t.j. offset  pøíští  vykonávané instrukce).
                               Jako  další akce je však provedeno  naplnìní
                               registru CS dalšími dvìma byte ze zásobníku.
                               Tyto   další   dva  byte   obsahují   adresu
                               segmentu,  v  nìmž  leží  pøíští  vykonávaná
                               instrukce.

                               Abychom provedli intrasegmentový  návrat RET
                               a zmìnili ukazatele zásobníku, je tedy tøeba
                               zavést  horní  dva  byte  ze   zásobníku  do
                               registru  instrukce.  Pak  je  tøeba  zavést
                               další dva  byte  ze  zásobníku  do ukazatele
                               zásobníku (stack pointer). Tyto poslední dva
                               byte znovu nastaví poslední obsah  ukazatele
                               zásobníku, jenž mohl pøípadnì být  uložen na
                               vrchol zásobníku pøed instrukcí CALL.
                               Abychom provedli intersegmentový  návrat RET
                               a zmìnili ukazatele zásobníku, je tøeba opìt
                               zavést  horní  dva  byte  ze   zásobníku  do
                               registru.  To  je offset  pøíští  vykonávané
                               instrukce. Další dva byte jsou  ze zásobníku
                               zavedeny   do  registr  CS.  To  je   adresa
                               segmentu,  v  nìmž  leží  pøíští  vykonávaná
                               instrukce.  Další  dva  byte ze zásobníku se
                               musí  uložit  do   ukazatele   zásobníku  ze
                               stejných pohnutek jako  pøi intrasegmentovém
                               návratu.

Syntaxe:                       RET (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné






                                  - 104 - 




Výjimky v PM:                  V   nìkterých   pøípadech    je   generována
                               všeobecná výjimka  porušení  ochrany pamìti,
                               výjimka  "deskriptor  není   pøítomen"  nebo
                               výjimka "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Je  používán  32-bitový  rozšíøený  ukazatel
                               instrukce.  Ze  zásobníku  je vyzvedáván 32-
                               bitový EIP.

Pøíklad:                       RET

SAHF (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Ulož registr AH do pøíznakù

Èasování:                      2 (80286), 3 (80386)

Popis:                         Instrukce      SAHF       plní      pøíznaky
                               SF,ZF,xx,AF,xx,PF,xx,CF            hodnotami
                               odpovídajících bitù registru  AH  (tedy bity
                               7,6,4,2
a 0).

Syntaxe:                       SAHF (žádné operandy)

Ovlivòuje pøíznaky:            SF, ZF, AF, PF, CF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       SAHF

SAL/SAR/SHL/SHR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Skupina     instrukcí      posunù     (shift
                               instructions)

Èasování:                      2-5 (80286), 3-7 (80386)

Popis:                         Instrukce SAL nebo SHL posouvá bity operandu
                               specifikovaného  v   instrukci   doleva.  To
                               zpùsobuje, že MSB je pøesunut do CF a LSB je
                               nulován. Instrukce SAR nebo SHR posouvá bity
                               svého operandu doprava. Pak je  LSB pøesunut
                               do  CF.  Instrukce  SAR  provádí   dìlení  s
                               uvažováním   znaménka:   MSB    se   nemìní.



                                  - 105 - 




                               Instrukce  SHR provádí dìlení bez ohledu  na
                               znaménko: MSB je nulován. Posuv  je opakován
                               tolikrát,   kolik   èiní   hodnota   druhého
                               operandu instrukcí  posuvu.  Tímto operandem
                               mùže být jak pøímý  operand,  tak  i registr
                               CL.  Mikroprocesory  80286/80386  nepovolují
                               posuny delší než 31. Je-li  pøesto požadován
                               posuv delší než 31  bitù,  je  uvažováno jen
                               dolních  pìt  bitù  operandu specifikujícího
                               délku posunu. Pøíznak OF  je  nastaven  do 1
                               jen pøi  posunu o 1 bit. Pro posun doleva je
                               nulován v pøípadì, že  bit  MSB  výsledku je
                               stejný   jako  výsledný  CF:  jinak  je   OF
                               nastaven na 1. U instrukce SAR je pøi posuvu
                               o 1 bit  OF  nastaven  do  0.  Instrukce SHR
                               nastavuje  pøíznak  OF  na hodnotu stejnou s
                               hodnotou MSB pùvodního  operandu  (t.j. pøed
                               provedením posuvu).

Syntaxe:                       SAL destination,count
                               SAL destination,1
                               SAL destination,CL
                               SHL destination,count
                               SHL destination,1
                               SHL destination,CL

Ovlivòuje pøíznaky:            OF (jen pøi posuvu o 1 bit),CF, AF, OF, PF a
                               SF.

Nedefinované pøíznaky:         AF

Výjimky v PM:                  Jestliže  registry  CS,DS nebo  ES  obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku". Jestliže je místo  urèení
                               v   segmentu    nepøístupném    zápisu,   je
                               generována   všeobecná    výjimka   porušení
                               ochrany pamìti.

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                       SHL MEMRY_BTE,1
                               SHL AX,CL
                               SHL TABLE[BX][DI],CL
                               SAR BL,1
                               SAR MEMRY_BTE,REP_VAL
                               SAR DH,CL
                               SAR CX,1
                               SAR MEMRY_BTE,1
                               SAR AX,CL




                                  - 106 - 




SBB (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Odeèítání s výpùjèkou

Èasování:                      2-3 (80286), 2-7 (80386)

Popis:                         Instrukce  SBB  pøièítá   druhý   operand  k
                               pøíznaku  CF a tento výsledek je odeèten  od
                               prvního  operandu.  Výsledek  je  uchován  v
                               prvním operandu.

Syntaxe:                       SBB destination,source

Ovlivòuje pøíznaky:            OF, SF, ZF, PF, CF, AF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku". Jestliže je místo  urèení
                               v   segmentu    nepøístupném    zápisu,   je
                               generována   všeobecná    výjimka   porušení
                               ochrany pamìti.

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                       SBB AX,BX
                               SBB DX,MEMRY_WRD
                               SBB TABLE[BX][DI],SI
                               SBB AL,3
                               SBB EAX,EBX ; jen pro 80386
                               SBB ECX,0ABCD1234H ; jen pro 80386

SCAS/SCASB/SCASW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Porovnání øetìzcových dat

Èasování:                      7

Popis:                         Srovnává byte(AL), slovo(AX) s ES:[DI]  nebo
                               s ES:[EDI]. Instrukce SCAS odeèítá  pamìový
                               byte nebo slovní operand adresovaný  ES:[DI]
                               (ES:[EDI])  buï  od  registru  AL  nebo  AX.
                               Výsledek je ignorován a jsou nastavovány jen
                               pøíslušné  pøíznaky.  Operand  v pamìti musí
                               být  adresován registrem ES. Po srovnání  je
                               DI (EDI) inkrementován pøi DF=0; jinak je DI




                                  - 107 - 




                               (EDI) dekrementován.  Inkrement/dekrement je
                               1 pro bytový a 2 pro slovní operand.

Syntaxe:                       SCAS destination,source
                               SCASB (žádné operandy)
                               SCASW (žádné operandy)

Ovlivòuje pøíznaky:            OF, SF, ZF, PF, CF, AF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            Šíøka slova je 32 bitù.

Pøíklad:                       MOV CL,10H   ; srovnání 16 byte
                               LEA DI,VALUE1; umístìní øetìzce
                               MOV AL,'S'   ; hledaný znak
                               REPNE SCASB  ; dokud není nalezen,
                                            ; prohlížej další byty

SGDT/SIDT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uschovej registr GDT/IDT do pamìti

Èasování:                      11 (80286), 9 (80386)

Popis:                         Instrukce SGDT i SIDT zavádí  obsah registru
                               tabulky  deskriptorù  do   šesti  pamìových
                               bytù,  na  nìž  ukazuje cílový operand. Pole
                               LIMIT  tohoto registru je umístìno v  prvním
                               slovì;  další  tøi  byte jsou naplnìny polem
                               BASE  a   poslední   ze   šestice   bytù  je
                               nedefinován.

Syntaxe:                       SGDT destination
                               SIDT destination

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Je-li   cílový    operand    registrem,   je
                               generována  výjimka  "nedefinovaný  operaèní
                               kód".  Jestliže  registry  CS,  DS  nebo  ES
                               obsahují neplatné efektivní adresy operandù,
                               je  generována  všeobecná  výjimka  porušení



                                  - 108 - 




                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Je-li   cílový    operand    registrem,   je
                               generována  výjimka  "nedefinovaný  operaèní
                               kód". Jestliže je slovní operand  na offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            -

Pøíklad:                       SGDT MEM_WRD
                               SIDT MEM_WRD

SLDT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uchovej     registr    tabulky     lokálních
                               deskriptorù

Èasování:                      2

Popis:                         Instrukce  SLDT  má jako  operand  efektivní
                               adresu  ukazující  buï na  2-bytový  registr
                               nebo  pamìové  místo  a  uchová v nìm obsah
                               tabulky lokálních deskriptorù.

Syntaxe:                       SLDT destination

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku". Jestliže je místo  urèení
                               v   segmentu    nepøístupném    zápisu,   je
                               generována   všeobecná    výjimka   porušení
                               ochrany pamìti.

Výjimky v RM:                  Je generováno INT 6 - instrukce SLDT  není v
                               RM rozpoznána.

Poznámka pro 80386:            -

Pøíklad:                       SLDT BP

SMSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uchovej stavové slovo procesoru (MSW)

Èasování:                      2



                                  - 109 - 




Popis:                         Cílový operand  (efektivní  adresa, 2-bytový
                               registr  nebo  pamìové  místo) obdrží kopii
                               stavového slova procesoru MSW.

Syntaxe:                       SMSW destination

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku". Jestliže je místo  urèení
                               v   segmentu    nepøístupném    zápisu,   je
                               generována rovnìž všeobecná  výjimka ochrany
                               pamìti.

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            -

Pøíklad:                       SMSW BP

STC (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav pøíznak pøenosu (CF)

Èasování:                      2

Popis:                         Instrukce  STC  nastavuje   pøíznak   CF  do
                               hodnoty 1.

Syntaxe:                       STC (žádné operandy)

Ovlivòuje pøíznaky:            CF = 1

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       STC


STD (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav pøíznak DF



                                  - 110 - 




Èasování:                      2

Popis:                         Instrukce  STD  nastavuje   pøíznak   DF  do
                               hodnoty  1.  To má za  následek,  že  pøíští
                               instrukce pracující s øetìzci bude  snižovat
                               obsah registru SI a/nebo DI.

Syntaxe:                       STD (žádné operandy)

Ovlivòuje pøíznaky:            DF = 1

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       STD

STI (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Nastav pøíznak pøerušení (IF)

Èasování:                      2 (80286), 3 (80386)

Popis:                         Instrukce STI nastavuje  IF = 1. To umožòuje
                               zpracovat maskovatelná externí  pøerušení po
                               vykonání pøíští instrukce.

Syntaxe:                       STI (žádné operandy)

Ovlivòuje pøíznaky:            IF = 1

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  je  aktuální  privilegovaná úroveò
                               nižší  než  I/O  privilegovaná  úroveò,   je
                               generována   všeobecná    výjimka   porušení
                               ochrany pamìti.

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       STI

STOS/STOSB/STOSW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uschovej øetìzcová data

Èasování:                      3 (80286), 4 (80386)




                                  - 111 - 




Popis:                         Instrukce STOS pøesouvá obsah buï AL nebo AX
                               na byte nebo slovo v pamìti. Tato  lokace je
                               adresována  ES:DI  (resp.   ES:EDI).  Cílový
                               operand  musí  být  adresovatelný z registru
                               ES.   Registr   DI  (EDI)   je   automaticky
                               inkrementován/dekrementován pøi DF = 0/DF  =
                               1.  Inkrement/dekrement  je  1  pro   bytové
                               pøesuny a 2 pro slovní pøesuny.

Syntaxe:                       STOS destination_string
                               STOSB (žádné operandy)
                               STOSW (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována všeobecná výjimka ochrany pamìti.
                               Jestliže  SS  obsahuje  neplatnou adresu, je
                               generována   výjimka    "chyba   zásobníku".
                               Jestliže   je   místo  urèení   v   segmentu
                               nepøístupném zápisu, je generována všeobecná
                               výjimka ochrany.

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       MOV ECX, 0FFCCAAH ; jen pro 80386
                               LEA EDI, VARIABLE
                               MOV AX,'-'
                               REP STOSB

STR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Uschovej registr úlohy (task register)

Èasování:                      2 (80286), 23-27 (80386)

Popis:                         Instrukce  STR  zpùsobí, že  obsah  registru
                               úlohy  je  kopírován  do 2-bytového registru
                               nebo pamìového místa,  které  je adresováno
                               cílovým operandem.

Syntaxe:                       STR destination

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné






                                  - 112 - 




Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku". Jestliže je místo  urèení
                               v   segmentu    nepøístupném    zápisu,   je
                               generována rovnìž všeobecná výjimka porušení
                               ochrany pamìti.

Výjimky v RM:                  Je generováno INT 6 - instrukce SLDT  není v
                               RM rozpoznána.

Poznámka pro 80386:            -

Pøíklad:                       STR BP

SUB (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Celoèíselné odeèítání

Èasování:                      2-7

Popis:                         Instrukce  SUB  odeète zdrojový  operand  od
                               cílového.  Výsledek  je  uložen  v   cílovém
                               operandu.

Syntaxe:                       SUB destination,source

Ovlivòuje pøíznaky:            OF, SF, ZF, PF, AF, CF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku". Jestliže je místo  urèení
                               v   segmentu    nepøístupném    zápisu,   je
                               generována   všeobecná    výjimka   porušení
                               ochrany pamìti.

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       SUB AX, BX
                               SUB EAX,EDX ; jen pro 80386
                               SUB DX, MEMRY_WRD
                               SUB MEMRY_WRD,AX
                               SUB MEM_BTE,7
                               SUB NUMBER,0FC991576H ; jen pro 80386




                                  - 113 - 




TEST (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Test - logické srovnání

Èasování:                      2-6 (80386), 2-5 (80386)

Popis:                         Instrukce TEST provádí  logické  AND bit-po-
                               bitu nad dvìma operandy. Každý  bit výsledku
                               je nastaven  do  1  pøi  jednièkových bitech
                               obou  srovnávaných  operandù; jinak  je  bit
                               výsledku nastaven do  0.  Výsledek instrukce
                               není použit, jsou jen nastaveny odpovídající
                               pøíznaky.

Syntaxe:                       TEST destination, source

Ovlivòuje pøíznaky:            OF = 0, CF = 0, SF, ZF, PF

Nedefinované pøíznaky:         AF

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   na  offsetu
                               0FFFFH, je generováno pøerušení INT 13.

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       TEST AX,BX
                               TEST EAX,EBX ; jen pro 80386
                               TEST MEM_BTE,6
                               TEST TABLE[BX][DI],CX
                               TEST TABLE[BX][DI],ECX ; jen pro 80386

VERR/VERW (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Verifikuj segment pro ètení nebo zápis

Èasování:                      14-16 (80286), 10-16 (80386)

Popis:                         Instrukce VERR a VERW zjišují,  zda segment
                               adresovaný    2-bytovým    registrem    nebo
                               pamìovým selektorem mùže být dosažitelný  z
                               aktuální  privilegované   úrovnì.  Instrukce
                               také zjišuje,  zda  segment  mùže  být èten
                               nebo zda je do  nìj  možné  zapisovat. Je-li
                               segment  pøístupný, je  ZF  nastaven  na  1;
                               jinak je ZF nulován.

Syntaxe:                       VERR destination_readable_selector



                                  - 114 - 




                               VERW destination_writable_selector

Ovlivòuje pøíznaky:            ZF

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Je  generováno  pøerušení  INT 6 - instrukce
                               VERR/VERW není v RM rozpoznána.

Poznámka pro 80386:            -

Pøíklad:                       VERR BP
                               VERW SELECTR

WAIT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Èekání na výskyt externího pøerušení

Èasování:                      3 (80286), 6 (80386) - minimálnì

Popis:                         Instrukce WAIT zpùsobí, že 80286/80386 èeká,
                               dokud  se   nevyskytne   externí  pøerušení.
                               Procesor  zùstává   inaktivní,   dokud  není
                               aktivován vstup TEST. Instrukci lze použít k
                               synchronizaci   externích  zaøízení   (napø.
                               koprocesoru).

Syntaxe:                       WAIT (žádné operandy)

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Poznámka pro 80386:            -

Pøíklad:                       WAIT

XCHG (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Zámìna bytù nebo slov

Èasování:                      3-5




                                  - 115 - 




Popis:                         Instrukce XCHG zamìòuje  bytový  nebo slovní
                               zdrojový  operand  s  odpovídajícím  cílovým
                               operandem.

Syntaxe:                       XCHG destination,source

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže    operand    leží    v    segmentu
                               nepøístupném zápisu, je generována všeobecná
                               výjimka  porušení  ochrany  pamìti. Jestliže
                               registry  CS,  DS  nebo ES obsahují neplatné
                               efektivní  adresy  operandù,  je  generována
                               všeobecná výjimka  porušení  ochrany pamìti.
                               Jestliže  SS  obsahuje  neplatnou adresu, je
                               generována výjimka "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   umístìn  na
                               offsetu 0FFFFH, je generováno pøerušení  INT
                               13.

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       XCHG AX,BX
                               XCHG DH,DATA_BTE
                               XCHG AL,DL
                               XCHG EAX,EBX ; jen pro 80386

Poznámka:                      Pøi užití instrukce XCHG s prefixem LOCK lze
                               efektnì implementovat  semafory  pro obsluhu
                               sdílených zdrojù v operaèním systému.

XLAT (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Pøevod podle pøevodní tabulky

Èasování:                      5

Popis:                         Instrukce  XLAT provádí translaci byte v  AL
                               pomocí  pøevodní  tabulky   (lookup  table).
                               Ukazatel na 256 bytovou pøevodní  tabulku je
                               zaveden do BX.  Byte, který má být pøeveden,
                               je  umístìn  v  AL:  slouží  jako  index  do
                               pøevodní  tabulky.  Po  provedení  instrukce
                               XLAT  je  byte v AL  nahrazen  bytem,  který
                               odpovídá bytu vzdálenému AL-bytù od  zaèátku
                               pøevodní tabulky.

Syntaxe:                       XLAT translation_table

Ovlivòuje pøíznaky:            žádné

Nedefinované pøíznaky:         žádné



                                  - 116 - 




Výjimky v PM:                  Jestliže  registry  CS,  DS nebo ES obsahují
                               neplatné  efektivní   adresy   operandù,  je
                               generována   všeobecná    výjimka   porušení
                               ochrany   pamìti.   Jestliže   SS   obsahuje
                               neplatnou  adresu,  je   generována  výjimka
                               "chyba zásobníku".

Výjimky v RM:                  Jestliže  je  slovní   operand   umístìn  na
                               offsetu 0FFFFH, je generováno pøerušení  INT
                               13.

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       LEA BX,MYTABLE ; umístìní tabulky
                               MOV AL,INDEX ; offset do tabulky
                               XLAT  MYTABLE ; hodnota z tabulky vrácena  v
                               AL

Poznámka:                      Délka  translaèní  tabulky  mùže být i menší
                               než 256 bytù.  Operand  translation_table je
                               nepovinný, protože registr BX musí  být pøed
                               provedením  instrukce  XLAT  stejnì  naplnìn
                               ukazatelem na tabulku.

XOR (80286/80386)
---------------------------------------------------------------------------

Instrukce:                     Logický exkluzívní souèet XOR

Èasování:                      2-3 (80286), 2-7 (80386)

Popis:                         Instrukce XOR srovnává každý bit  zdrojového
                               operandu  s  cílovým  a provádí "bitový" XOR
                               (nonekvivalence). Výsledek obsahuje  nuly na
                               tìch  bitových  pozicích,  kde má zdrojový i
                               cílový operand  buï  obì  jednièky  nebo obì
                               nuly.  Jinak  je  na pøíslušné bitové pozici
                               jednièka.

Syntaxe:                       XOR destination,source

Ovlivòuje pøíznaky:            OF = 0, CF = 0,SF, ZF, PF

Nedefinované pøíznaky:         AF

Výjimky v PM:                  Jestliže    operand    leží    v    segmentu
                               nepøístupném zápisu, je generována všeobecná
                               výjimka  porušení  ochrany  pamìti. Jestliže
                               registry  CS,  DS  nebo ES obsahují neplatné
                               efektivní  adresy  operandù,  je  generována
                               všeobecná výjimka  ochrany  pamìti. Jestliže
                               SS obsahuje neplatnou adresu, je  generována
                               výjimka "chyba zásobníku".






                                  - 117 - 




Výjimky v RM:                  Jestliže  je  slovní   operand   umístìn  na
                               offsetu 0FFFFH, je generováno pøerušení  INT
                               13.

Poznámka pro 80386:            šíøka slova je 32 bitù

Pøíklad:                       XOR AX,MEMRY_WRD
                               XOR AH,BL
                               XOR OP1,OP1 ; efektní nulování operand OP1
                               XOR TABLE[BX][DI],AX
                               XOR EAX,ECX ; jen pro 80386
                               XOR EDX,0CFAD1579H ; jen pro 80386















































                                  - 118 - 










                            K a p i t o l a   8

                         Speciální instrukce 80386


IBTS
---------------------------------------------------------------------------

Instrukce:                     Vlož bity do registru nebo pamìové lokace

Èasování:                      2-4

Popis:                         Instrukce IBTS vkládá nižší bity registru do
                               jiného  registru  nebo pamìové  lokace  bez
                               porušení   sousedících   bitù.   IBTS  má  4
                               operandy:  bázová  adresa  bitového øetìzce,
                               bitový offset zaèátku  podøetìzce,  který má
                               být uložen, jeho délku  a  registr,  jenž má
                               obdržet  vkládanou  hodnotu.  Bázová  adresa
                               mùže  být  registrem  nebo adresou v pamìti.
                               Offset je uložený v registru EAX  (v  AX pøi
                               16-tibitových  operandech).  Délka  pole  je
                               dána   registrem   CL   a  poslední  operand
                               instrukce  specifikuje   všeobecný  registr,
                               který má obdržet hodnotu.

Syntaxe:                       IBTS base,offset,length,source
                               IBTS reg/mem,(E)AX,CL,reg

Ovlivòuje pøíznaky:            OF,SF,ZF,AF,PF


Nedefinované pøíznaky:         CF

Výjimky v PM:                  Všeobecná  výjimka  privilegovaného  módu je
                               generována v pøípadì, že operand  nemùže být
                               použit kvùli porušení  limitu  segmentu nebo
                               pøístupových práv.

Výjimky v RM:                  Všeobecná  výjimka  privilegovaného  módu je
                               generována v pøípadì, že operand  nemùže být
                               použit  kvùli  umístìní  mimo limit segmentu
                               (offset 0FFFFH).

Pøíklad:                       IBTS BX,AX,CL,DX

MOV CRn
---------------------------------------------------------------------------

Instrukce:                     Naplò a ulož øídicí registry



                                  - 119 - 




                               MOV CRn,reg
                               MOV reg,CRn

Èasování:                      2-4

Popis:                         Instrukce  plní  nebo  ukládají hodnoty z/do
                               øídicích   registrù   CRn.   Instrukce  vždy
                               používají  32-bitové  operandy a  pro  80386
                               jsou definovány jen øídicí registry CR0, CR2
                               a CR3.

Syntaxe:                       MOV CRn,source_operand
                               MOV destination,CRn

Ovlivòuje pøíznaky:            OF, ZF, SF, PF, AF


Nedefinované pøíznaky:         CF

Výjimky v PM:                  Jde  o   privilegované   instrukce.  Jsou-li
                               vykonávány na privilegované úrovni jiné  než
                               0,  vedou  k  výpadku  ochrany   (protection
                               fault).

Výjimky v RM:                  žádné

Pøíklad:                       MOV CR2,EAX
                               MOV EBX,CR3

MOV DRn
---------------------------------------------------------------------------

Instrukce:                     Naplò a uschovej ladicí registry
                               MOV Dreg,reg
                               MOV reg,Dreg

Èasování:                      2-4

Popis:                         Instrukce zavádìjí a  uchovávají  obsahy 32-
                               bitových hodnot ladicích registrù.

Syntaxe:                       MOV Dreg,reg
                               MOV reg,Dreg

Ovlivòuje pøíznaky:            OF, ZF, SF, AF, PF


Nedefinované pøíznaky:         CF

Výjimky v PM:                  Jde  o   privilegované   instrukce.  Jsou-li
                               vykonávány na privilegované úrovni jiné  než
                               0, vedou k výpadku ochrany.

Výjimky v RM:                  žádné

Pøíklad:                       MOV DR4,EAX



                                  - 120 - 




                               MOV EBX,DR5

MOV TRn
---------------------------------------------------------------------------

Instrukce:                     Naplò a uschovej testovací registry
                               MOV Treg,reg
                               MOV reg,Treg

Èasování:                      2-4

Popis:                         Instrukce  plní  nebo  ukládají hodnoty z/do
                               testovacích  registrù  TRn. Pro  80386  jsou
                               definovány jen øídicí registry TR6 a TR7.

Syntaxe:                       MOV Treg,reg
                               MOV reg,Treg

Ovlivòuje pøíznaky:            žádné


Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jde  o   privilegované   instrukce.  Jsou-li
                               vykonávány na privilegované úrovni jiné  než
                               0, vedou k výpadku ochrany.

Výjimky v RM:                  žádné

Pøíklad:                       MOV TR6,EAX

SETcond.
---------------------------------------------------------------------------

Instrukce:                     Nastav byte podle podmínky
























                                  - 121 - 




                               --------------------------------------------
                               Instrukce    Èasování: Popis:
                               --------------------------------------------
                               SET     cond.Jednièkuje-nuluje
                                            byte podle výsledku
                                            testu podmínky
                               SETO    -    Pøeteèení
                               SETNO   -    Není pøeteèení
                               SETB    -    Menší
                               SETNAE  -    Ne vìtší nebo rovno
                               SETNB   -    Ne menší
                               SETAE   -    Vìtší nebo rovno
                               SETE    -    Rovno
                               SETZ    -    Nula
                               SETNE   -    Ne rovno
                               SETNZ   -    Ne nula
                               SETBE   -    Menší nebo rovno
                               SETNA   -    Ne vìtší
                               SETNBE  -    Ne menší nebo rovno
                               SETA    -    Vìtší
                               SETS    -    Znaménko
                               SETNS   -    Ne znaménko
                               SETP    -    Parita
                               SETPE   -    Sudá parita
                               SETNP   -    Ne parita
                               SETPO   -    Lichá parita
                               SETL    -    Menší než (se signem)
                               SETNGE  -    Ne vìtší než nebo =
                               SETNL   -    Ne menší než
                               SETGE   -    Vìtší nebo rovno
                               SETLE   -    Menší nebo rovno
                               SETNG   -    Ne vìtší než
                               SETNLE  -    Ne menší než nebo =
                               SETG    -    Vìtší než (se signem)
                               --------------------------------------------


Efekt instrukce:               Instrukce SET nastavuje vybraný byte do nuly
                               nebo   do   jednièky   podle   16   podmínek
                               definovaných pro 80386. Jediným operandem je
                               jednobytový registr  nebo  pamìový operand.
                               Jsou provedena následující  pøiøazení: pokud
                               SETcond, pak reg/mem = 1; jinak reg/mem = 0.

Syntaxe:                       SETcond reg/mem

Ovlivòuje pøíznaky:            žádné


Nedefinované pøíznaky:         žádné

Výjimky v PM:                  Jestliže   operand   nemùže   být  použit  v
                               instrukci  kvùli  porušení  limitu  segmentu
                               nebo  porušení  pøístupových  práv,  pak  je
                               generována výjimka 13.




                                  - 122 - 




Výjimky v RM:                  žádné

Pøíklad:                       SETNO

SHLD/SHRD
---------------------------------------------------------------------------

Instrukce:                     Instrukce dvojitého posuvu

Èasování:                      3-7

Popis:                         Instrukce   SHLD/SHRD    posouvají   operand
                               reprezentující  èíslo  v  dvojité  pøesnosti
                               doleva nebo doprava tak, aby vzniklo èíslo v
                               jednoduché pøesnosti.  Registr  nebo hodnota
                               pamìového místa je posunuta v závislosti na
                               hodnotì v tøetím  operandu  instrukce, který
                               je èítaèem. Tento posuv se liší od  posuvù u
                               èísel  v  jednoduché  pøesnosti  v  tom,  že
                               dvojitý posuv používá registrový operand pro
                               specifikaci  bitù,  které  se mají posouvat,
                               zatímco jednoduchý posuv  pøesouvá  jen nuly
                               nebo jednièky. Registr  nebo  pamìové místo
                               (reg/mem)   specifikuje   vstupní   operand.
                               Registr (reg) specifikuje  bity,  které mají
                               být vsunuty, a tøetí operand  (immediate/CL)
                               obsahuje poèet posuvù.

                               Pro  SHLD  obsahuje  registr  nebo  pamìový
                               operand   vyšší   bity   èísla   v   dvojité
                               pøesnosti,   a   registr   (druhý   operand)
                               obsahuje nižší bity èísla. První  operand je
                               posunut doleva, pøièemž  vyšší  bity druhého
                               operandu  jsou  vsunuty  doprava  (na  místo
                               nižšího  øádu). Výsledek je uložen v  prvním
                               operandu.

                               Pro  SHRD  obsahuje  registr  nebo  pamìový
                               operand   nižší   bity  èísla   ve   dvojité
                               pøesnosti  a   registrový   (druhý)  operand
                               obsahuje  vyšší  bity.   První   operand  je
                               posunut  doprava  a  nižší bity registrového
                               operandu  jsou  vsunuty  doleva  (na   místo
                               vyššího  øádu). Výsledek je uložen v  prvním
                               operandu.

Syntaxe:                       SHLD reg/mem,reg,immediate_operand
                               SHLD reg/mem,reg,CL

Ovlivòuje pøíznaky:            CF   je   nastaven   na  hodnotu  posledního
                               vysouvaného  bitu  OF je  nastaven  jestliže
                               posunutí posledního bitu zpùsobilo pøeteèení
                               SF,ZF  a PF  jsou  nastaveny  podle  hodnoty
                               výsledku





                                  - 123 - 




Nedefinované pøíznaky:         AF

Výjimky v PM:                  žádné

Výjimky v RM:                  žádné

Pøíklad:                       SHLD AX,BL,0AH ; 0AH = bezprostøední operand
                               SHRD AL,BL,CL ; CL = poèet posuvù

XBTS
---------------------------------------------------------------------------

Instrukce:                     Extrahuj bitový øetìzec

Èasování:                      6-13

Popis:                         Instrukce XBTS extrahuje  bitový  øetìzec, a
                               tento øetìzec je uložen zarovnaný  doprava a
                               rozšíøený (t.j. s  horními  bity nastavenými
                               do nuly) ve specifikovaném registru.
                               Instrukce XBTS má 4 operandy; bázovou adresu
                               bitového  øetìzce,  bitový   offset  zaèátku
                               podøetìzce,  jenž  má  být extrahován, délku
                               extrahovaného podøetìzce a  registr,  kam má
                               být extrahovaný  podøetìzec  umístìn. Bázová
                               adresa  mùže být umístìna v registru nebo  v
                               pamìovém  operandu.  Offset  je  uložen   v
                               registru   EAX   (resp.   AX  u  16-bitových
                               operandù).  Délka  pole  je  dána   hodnotou
                               registru   CL.   Poslední   pole   instrukce
                               specifikuje    všeobecný   registr,    který
                               obsahuje extrahovanou hodnotu.

Syntaxe:                       XBTS dest,base,offset,length
                               XBTS reg,reg/mem,(E)AX,CL

Ovlivòuje pøíznaky:            OF, SF, AF, ZF, PF


Nedefinované pøíznaky:         CF

Výjimky v PM:                  Jestliže   operand   nemùže   být  použit  v
                               instrukci  kvùli  porušení  limitu  segmentu
                               nebo  porušení  pøístupových  práv,  pak  je
                               generována výjimka 13.

Výjimky v RM:                  Jestliže  operand  leží  mimo limit segmentu
                               (0FFFFH),  je  generována  všeobecná výjimka
                               porušení ochrany pamìti.

Pøíklad:                       XBTS AX,BX,AX,CL








                                  - 124 - 










                            K a p i t o l a   9

                      Pøíklady programù v assembleru


1. Seèítání - použití bezprostøedního adresování

               ; Pro 80286/80386
               ; Ilustrace jednoduchého hexadecimálního seèítání
               ; BEZPROSTØEDNÍ ADRESOVÁNÍ

stack          segment para stack
               db 64 dup ("MYSTACK") ; zásobník o 100h slovech
stack          ends

mycode         segment para "code"      ; definuj segment kódu
myproc         proc far                 ; procedura jménem MYPROC
               assume cs:mycode,ss:stack

               push  ds                 ; uschovej datový segment
               sub   ax,ax              ; nula do ax
               push  ax                 ; uschovej do zásobníku

               ; nasleduje kód vlastniho programu -
               mov   al,12h             ; první operand = NUM1
               add   al,18h             ; pøièti druhý operand
               add   al,30h             ; pøièti tøetí operand

               ; konec seèítání - výsledek je v AL
               mov   ah,4Ch             ; návrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc         endp                     ; konec procedury MYPROC
mycode         ends                     ; konec segmentu kódu


   Jako první je v našem pøíkladì definován zásobník:  je  inicializován 64
slovy  "MYSTACK",  což  mùže  usnadnit  ladìní  našeho  programu. Následují
segment je kódový -  je  nazván "mycode" a všeobecnì musí obsahovat alespoò
jednu  proceduru - tou je u nás procedura  "MYPROC".  Procedura  seète  tøi
hexadecimální èísla a pomocí int 21 pøedá øízení DOSu. V  našem jednoduchém
pøíkladì  není  vùbec  použit  datový  segment  -  program s  žádnými  daty
uloženými v datovém segmentu nepracuje.

2. Seèítání - použití pøímého adresování

               ; Pro 80286/80386
               ; Ilustrace jednoduchého hexadecimálního seèítání
               ; PØÍMÉ ADRESOVÁNÍ




                                  - 125 - 




stack          segment para stack
               db 64 dup ("MYSTACK")    ; zásobník o 100h slovech
stack          ends

mydata         segment para "data"      ; datový segment MYDATA
               NUM1  dw 1234h           ; první slovní operand
               NUM2  dw 24h             ; druhý slovní operand
               NUM3  dw 0ABCh           ; tøetí slovní operand
               ANS   dw ?               ; slovo pro výsledek
mydata         ends                     ; konec segmentu dat

mycode         segment para "code"      ; definuj segment kódu
myproc         proc far                 ; procedura jménem MYPROC
               assume cs:mycode,ss:stack
               push  ds                 ; uschovej datový segment
               sub   ax,ax              ; nula do ax
               push  ax                 ; uschovej ax
               mov   ax,mydata          ; datový segment do AX
               mov   ds,ax              ; nastav hodnotu DS

               ; nasleduje kód vlastniho programu -
               mov   ax,NUM1            ; první operand = NUM1
               add   ax,NUM2            ; pøièti NUM2
               add   ax,NUM3            ; pøièti NUM3
               mov   ANS,ax             ; ulož výsledek do ANS

               ; konec seèítání - výsledek je v promìnné ANS
               mov   ah,4Ch             ; návrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc         endp                     ; konec procedury myproc
mycode         ends                     ; konec segmentu kódu


 V  tomto  pøíkladì  je použit pro umístìní operandù datový segment MYDATA,
zaèínající v pamìti na hranici  paragrafu (t.j. na adrese dìlitelné 16-ti).
Kromì  operandù  seèítání  je v segmentu  MYDATA  definováno  i  slovo  pro
výsledek (ANS, symbol "?" znamená, že slovo není inicializováno).

3. Seèítání ve dvojité pøesnosti - indexové adresování

               ; Pro 80286/80386
               ; Ilustrace hexadecimálního seèítání ve dvojité pøesnosti
               ; INDEXOVÉ ADRESOVÁNÍ

stack          segment para stack
               db 64 dup ("MYSTACK")    ; zásobník o 100h slovech
stack          ends

mydata         segment para "data"      ; datový segment MYDATA
TABLE          dw 1234h,5678h,9ABCh,0DEF0h,1111h,2222h,3333h
               dw 4444h,5555h,6666h,7777h,8888h,9999h,0AAAAh
               dw 0BBBBh,0CCCCh,0DDDDh,0EEEEh,0FFFFh
LSBANS         dw ?                     ; nižší byty výsledku
MSBANS         dw ?                     ; vyšší byty výsledku
mydata         ends



                                  - 126 - 




; ----------- konec segmentu dat mydata ------------

segment        para "code"              ; definuj segment kódu
myproc         proc far                 ; procedura jménem MYPROC
               assume cs:mycode,ss:stack
               push  ds                 ; uschovej datový segment
               sub   ax,ax              ; nula do ax
               push  ax                 ; uschovej ax
               mov   ax,mydata          ; datový segment do ax
               mov   ds,ax              ; nastav hodnotu ds
;----------- nasleduje kód vlastniho programu -------
               mov   si,0h              ; index=0 (1.prvek tabulky)
               mov   ax,TABLE[si]       ; vezmi první èíslo
               mov   cx,09h             ; devìt seèítání
again:         add   si,02h             ; další slovo v TABLE
               add   ax,TABLE[si]       ; pøièti jej
               adc   dx,0h              ; pøièti pøíp. pøenos k dx
               loop again               ; další pøiètení pøi cx<>0
               mov LSBANS,ax            ; hotovo-pøesun výsledku
               mov MSBANS,dx            ; i èásti MSB
; ---- konec seèítání - výsledek je v MSBANS a LSBANS -----
               mov ah,4Ch               ; návrat do DOSu
               int 21h                  ; s ERRORLEVEL 0
               ret
myproc         endp                     ; konec procedury myproc
mycode         ends                     ; konec segmentu kódu


4. Použití pøíkazu DAA pøi seèítání - registrové nepøímé
               adresování

               ; Pro 80286/80386
               ; Ilustrace použití DAA pøi seèítání
               ; REGISTROVÉ NEPØÍMÉ ADRESOVÁNÍ

stack          segment para stack
               db 64 dup ("MYSTACK")    ; zásobník o 100h slovech
stack          ends

mydata s       egment para "data" ; datový segment MYDATA
INFO           db 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
ANS            db ?                     ; výsledek
mydata         ends                     ; konec segmentu dat mydata

segment        para "code"              ; definuj segment kódu
myproc         proc  far                ; procedura jménem MYPROC
               assume cs:mycode,ss:stack
               push  ds                 ; uschovej datový segment
               sub   ax,ax              ; nula do ax
               push  ax                 ; uschovej ax
               mov   ax,mydata          ; datový segment do ax
               mov   ds,ax              ; nastav hodnotu ds
; nasleduje kód vlastniho programu -
               lea   bx,info            ; získej adresu (offset)
               mov   cx,10              ; 10 seèítání
               mov   al,INFO            ; 1. èíslo z INFO do AL



                                  - 127 - 




again:         add   bx,01h             ; další èíslo z INFO
               add   al,info[bx]        ; pøièti jej k al
               daa                      ; pøichystej AL
               loop  again              ; další seèítání
               mov   ANS,al             ; výsledek do ANS
; konec seèítání - výsledek je v ANS
               mov   ah,4Ch             ; návrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc         endp                     ; konec procedury myproc
mycode         ends                     ; konec segmentu kódu


5. Pøíklad 32-bitového seèítání u 80386

stack          segment para "stack"
               db 64 dup("MYSTACK")
stack          ends

mydata         segment para "data"
NUMS           DD 12345678h,9ABCDEF0h,23h,10000000h,0CADh
ANSWER         DD ?
mydata         ends

mycode         segment para "code"
myproc         proc far
               assume cs:mycode,ds:mydata,ss:stack
               push  ds
               sub   ax,ax
               push  ax
               mov   ax,mydata
               mov   ds,ax
; kód pro 32-bitové seèítání
               lea   bx,NUMS            ; offset NUMS do BX
               mov   eax,[bx]           ; první 32-bitové èíslo do EAX
               add   eax,[bx]+4         ; pøièti druhé
               add   eax,[bx]+8         ; a tøetí
               mov   ANSWER,eax         ; výsledek bude v ANSWER
               mov   ah,4Ch             ; návrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc endp
mycode ends
               end


6.Pøíklad jednoduchého 32-bitového násobení


stack          segment para "stack"
               db 64 dup("MYSTACK")
stack          ends

mydata         segment para "data"
NUM1           DD 12345678h
NUM2           DD 9ABCDEF0h



                                  - 128 - 




               ANSWER DD ?
mydata ends

mycode         segment para "code"
myproc         proc  far
               assume cs:mycode,ds:mydata,ss:stack
               push ds
               sub   ax,ax
               push  ax
               mov   ax,mydata
               mov   ds,ax
; kód pro 32-bitové násobení
               mov   eax,NUM1           ; první 32-bitové èíslo do EAX
               mul   eax,NUM2           ; vynásob druhým èíslem
               mov   dword ptr ANSWER,eax ;nižších 32 bitù výsledku
               mov   dword ptr ANSWER,edx ;vyšších 32 bitù výsledku
               mov   ah,4Ch             ; návrat do DOSu
               int   21h                ; s ERRORLEVEL 0
               ret
myproc endp
mycode ends
               end

   Výsledek  násobení  je  v registrech EAX a EDX. Použitím operátoru DWORD
PTR je 32-bitový obsah každého registru správnì umístìn do ètyøslova ANSWER
v datovém segmentu.

































                                  - 129 - 































































                                  - 130 - 










                                 Dodatek A

                  Reálný a privilegovaný mód 80286(80386)


   Jak již bylo naznaèeno v  kapitole 6., jsou obsahy segmentových registrù
interpretovány rùznì v závislosti na tom, zda 80286/80386 pracuje v reálném
nebo v privilegovaném módu. Speciálnì u obvodu 80286

 - v reálném módu  (real  address mode) generuje 80286 20-ti bitovou adresu
pamìové lokace podle následujícho vztahu
   ADRESA=(16xSELEKTOR) + OFFSET
kde  SELEKTOR  je  obsah  pøíslušného  segmentového  registru  a OFFSET  je
posunutí referovaného pamìového místa vzhledem k zaèátku segmentu.

 - ve  virtuálním  (privilegovaném)  módu  (virtual  address  mode) pracuje
procesor s virtuální adresou,  kterou  mapuje  do 24-bitové fyzické adresy,
vysílané na adresovou sbìrnici. V tomto módu jsou všechny pøístupy k pamìti
kontrolovány na oprávnìnost.  Pøístup  k pamìové lokaci je tedy provìøován
vzhledem  k  tzv.  privilegované   úrovni,   což   je   dvoubitová  hodnota
reprezentující relativní úroveò pøístupového  oprávnìní  k  pamìti  (00b je
maximální, 11b je minimální úroveò)
   Obsahem segmentového registru je tedy vždy selektor; struktura selektoru
je následující:


         (MSB)                       (LSB)
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
 |                I  N D E X            |TI| RPL |
 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
 15                                              0



RPL =             požadovaná  privilegovaná  úroveò  (1  až  3)  (requested
                  privilege level)

TI =              indikace tabulky deskriptorù

0 =               tabulka GDT (Global Descriptor Table)

1 =               tabulka LDT (Local Descriptor Table )

INDEX =           ukazatel do tabulky deskriptorù

Tabulka deskriptorù

   Tabulka deskriptorù (LDT nebo GDT ve virtuální pamìti,  resp.  fyzická v
pamìti  na  èipu  80286) je složena ze 48- bitových položek. Na úrovni èipu
80286 je programovì nepøístupná. Její struktura je následující



                                  - 131 - 




 47    40 39                   16 15             0
 +++++++++++++++++++++++++++++++++++++++++++++++++
 |  ARB  |      BASE ADDRESS     |     LIMIT     |  CS
 +++++++++++++++++++++++++++++++++++++++++++++++++
 +++++++++++++++++++++++++++++++++++++++++++++++++
 |  ARB  |      BASE ADDRESS     |     LIMIT     |  DS
 +++++++++++++++++++++++++++++++++++++++++++++++++
 +++++++++++++++++++++++++++++++++++++++++++++++++
 |  ARB  |      BASE ADDRESS     |     LIMIT     |  SS
 +++++++++++++++++++++++++++++++++++++++++++++++++
 +++++++++++++++++++++++++++++++++++++++++++++++++
 |  ARB  |      BASE ADDRESS     |     LIMIT     |  ES
 +++++++++++++++++++++++++++++++++++++++++++++++++

nn Každá  adresa báze segmentu je 24-bitová (t.j. pro adresaci 0 - 16 MB ).
Hovoøíme-li tedy o segmentovém registru, je pod tímto  pojmem  tøeba chápat
jak jeho programovì  pøístupnou  èást  -  selektor -, tak i èást programovì
nepøístupnou -  deskriptor. Èip 80286 tedy z dvojice SEGMENT:OFFSET vytvoøí
fyzickou adresu ve dvou krocích:
1.  selektor  urèí  index do tabulky  deskriptorù  a  je  získán  pøíslušný
deskriptor, t.j. adresa zaèátku segmentu ve fyzické pamìti
2.  tato  adresa  je seètena s 16-bitovým offsetem, což poskytne 24-bitovou
adresu jednoznaènì urèující pamìové místo ve fyzickém pamìovém prostoru
   Popsaný výpoèet fyzické  adresy  je automatickou záležitostí CPU 80286 -
programátor na úrovni  assembleru  je jen povinen naplnit øádnými hodnotami
segmentové registry a urèit offset v segmentu.



Literatura

   [1] Murray W.H.,Pappas C.H. : 80286/80386 Assembly
   Language Programming, Osborne McGraw-Hill, 1986
   [2] 80286 Assembly Language Reference Manual, Operating
   Systems and Languages Library,Olivetti, 1986



                                  - 132 - 


                                                             konec ASM.HLP
**************************************************************************

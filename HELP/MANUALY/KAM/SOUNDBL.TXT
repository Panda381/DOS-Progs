
°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°
°°                                                                           °°
°°                               Zvukov‚ karty                               °°
°°                                                                           °°
°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°


                                     Adlib
                                    -------

ADLIB  syntetiz tor  je  sestaven  z  oscil toru a gene toru ob lky. Oscil tor,
gener tor ob lky a ovlada‡ £rovnˆ jsou spojeny do jednoho celku v "oper tor":

     ÚÄÄÄÄÄÄÄÄÄÄÄ¿  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
     ³ oscil tor ÃÄ>³ gener tor ob lky ÃÄ>³ ovlada‡ £rovnˆ ÃÄÄ> v˜stup
     ÀÄÄÄÄÄÄÄÄÄÄÄÙ  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

Karta  ADLIB  obsahuje  18  oper tor–  spojen˜ch  do  p r–. Oper tory mohou b˜t
zkombinob ny t©emi r–zn˜mi zp–soby:

    1.- Frekven‡nˆ  modulovan˜  (FM)  syntez tor pou‘¡v  dva oper tory v s‚rii.
        Prvn¡ oper tor (modul tor) moduluje druh˜ oper tor (nosnou).

                                ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                frekven‡nˆ      ³  oper tor   ³  ³  oper tor   ³
                modulovan       ³      1      ÃÄ>³      2      ÃÄ> v˜stup
                synt‚za         ³ (modul tor) ³  ³   (nosn )   ³
                                ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÙ


    2.- Aditivn¡  syntez tor  pou‘¡v   dva  oper tory spojen‚ paralelnˆ, jejich
        v˜stupy se se‡¡taj¡. Tato metoda nen¡ tak zaj¡mav  jako FM synt‚za, ale
        m–‘e generovat kvalitn¡ varhann¡ zvuky.

                                ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                                ³  oper tor   ³
                                ³      1      ÃÄÄ¿
                                ³             ³  ³
                aditivn¡        ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  ³
                synt‚za                          ÃÄ> v˜stup
                                ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿  ³
                                ³  oper tor   ³  ³
                                ³      2      ÃÄÄÙ
                                ³             ³
                                ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

    3.- Kompozitn¡  sinusov˜  syntez tor  (CSW) m–‘e b˜t pou‘¡v n ke generov n¡
        ©e‡i  nebo jin˜ch podobn˜ch zvuk– p©ehr v n¡m v¨ech 9 hlas– samostatnˆ.
        P©i  pou‘it¡ t‚to metody nem–‘e generovat karta ‘ dn‚ dal¨¡ zvuky. Tato
        metoda  zde  nen¡  popisov na, proto‘e jin‚ metody umo‘¤uj¡ kvalitnˆj¨¡
        generov n¡ ©e‡i.


ADLIB  produkuje  buƒ  9  melodick˜ch zvuk– nebo 6 melodick˜ch zvuk– a 5 bic¡ch
n stroj–. Pro 9 melodick˜ch zvuk– jsou oper tory seskupeny po p rech. Pro m¢d s
bic¡mi n stroji jsou oper tory uspo© d ny takto:

         0 a‘ 5: 6 melodick˜ch n stroj– (12 oper tor–)
           6:    1 basov˜ buben BD (Bass Drum) (2 oper tory)
           7:    1 mal˜ buben SD (Snare Drum) (1 oper tor)
           8:    1 st©edn¡ buben TT (Tom-Tom) (1 oper tor)
           9:    1 ‡inel CY (Cymbal) (1 oper tor)
          10:    1 Hi-Hat HH (1 oper tor)

Proto‘e ADLIB m  pouze 9 frekven‡¡ch registr–, ‡inel a Hi-Hat jsou pevn‚.

V  m¢du  bic¡ch  n stroj–  je  k vytv ©en¡ zvuk– pou‘it ¨umov˜ gener tor. Tento
¨umov˜ gener tor pou‘¡v  frekven‡n¡ informace hlas– 7 a 8 (mal˜ buben a st©edn¡
buben) a vlastn¡ f zov˜ v˜stup. Nejlep¨¡ pomˆr sign l– je 3:1 (frekvence mal‚ho
bubnu = 3 * frekvence st©edn¡ho bubnu).


ADLIB  pou‘¡v  n sleduj¡c¡ b zov‚ adresy port– (BASE): 218h, 288h, 318h a 388h.
Implicitnˆ je pou‘¡v na adresa 388h.

BASE + 00h: (z pis) indexov˜ registr (zvol¡ se ‡¡slo registru)
            (‡ten¡) stavov˜ registr
                     bit 5: 1=dokon‡eno ‡asov n¡ ‡asova‡e T2
                     bit 6: 1=dokon‡eno ‡asov n¡ ‡asova‡e T1
                     bit 7: 1=p©eru¨en¡ IRQ (dokon‡eno ‡asov n¡ T2 nebo T1)

BASE + 01h: (z pis) datov˜ registr (viz d le)

Nejd©¡ve  se do indexov‚ho registru ulo‘¡ adresa registru, potom se do datov‚ho
registru  ulo‘¡ data ur‡en  pro tento registr. Po z pisu do indexov‚ho registru
je  nutno  ‡ekat po dobu 3.3 æs, po z pisu do datov‚ho registru 23 æs. Nejlep¨¡
je  prov dˆt  ‡ten¡ stavov‚ho registru ve smy‡ce: 6 ‡ten¡ po z pisu indexu a 36
‡ten¡ po z pisu dat.

Registry:
         01h: bit 0 a‘ bit 4: testovac¡ registr (mus¡ b˜t v‘dy = 0)
              bit 5: 1=povolena volba form tu vln podle registr– E0h-F5h
                     0=vlny maj¡ norm ln¡ sinusov˜ pr–bˆh

         02h: nastaven¡ ‡¡ta‡e 1 (rozli¨en¡ 80 æs)
               Po ukon‡en¡ ‡¡t n¡ jsou ‡¡ta‡e opˆt nastaveny stejn˜m ‡¡slem.

         03h: nastaven¡ ‡¡ta‡e 2 (rozli¨en¡ 320 æs)

         04h: bit 0: 1=start ‡asova‡e T1 (0=‡asova‡ vypnut˜)
              bit 1: 1=start ‡asova‡e T2 (0=‡asova‡ vypnut˜)
              bit 5: 1=p©¡znak p©ete‡en¡ od ‡asova‡e T2 neovlivn¡ stav. reg.
              bit 6: 1=p©¡znak p©ete‡en¡ od ‡asova‡e T1 neovlivn¡ stav. reg.
              bit 7: 1=resetov n¡ p©¡znaku p©eru¨en¡ IRQ
                   P©i nastaven¡ bitu 7 jsou v¨echny ostatn¡ bity ignorov ny.

         08h: bit 6: 1=volba re‘imu NOTE
                NOTE-SEL. Controls the split point of the keyboard. When 0, the
                keyboard split is the second bit from the bit 8 of the F-Number.
                When 1, the MSb of the F-Number is used.
              bit 7: 1=je re‘im kompozitn¡ synt‚zy CSW

     20h-35h: ovl d n¡ oper tor– 1 a‘ 18
              bit 0 a‘ bit 3: faktor n soben¡ frekvence (viz n¡‘e)
              bit 4: 1=mˆnˆn  ob lka (KSR) - vy¨¨¡ noty jsou krat¨¡ ne‘ ni‘¨¡
              bit 5: 1=st l  £rove¤ t¢nu (p©i dobˆhu se kles n¡ £rovnˆ zastav¡)
              bit 6: 1=tremolo (=frekven‡n¡ modulace)
              bit 7: 1=vibr to (=amplitudov  modulace)

                             Faktor n soben¡ frekvence:
                        ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄ¿  ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄ¿
                        ³ ‡¡slo ³ n sobek³  ³ ‡¡slo ³ n sobek³
                        ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄ´  ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄ´
                        ³   0   ³   1/2  ³  ³   8   ³    8   ³
                        ³   1   ³    1   ³  ³   9   ³    9   ³
                        ³   2   ³    2   ³  ³  10   ³   10   ³
                        ³   3   ³    3   ³  ³  11   ³   10   ³
                        ³   4   ³    4   ³  ³  12   ³   12   ³
                        ³   5   ³    5   ³  ³  13   ³   12   ³
                        ³   6   ³    6   ³  ³  14   ³   15   ³
                        ³   7   ³    7   ³  ³  15   ³   15   ³
                        ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÙ  ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÙ

     40h-55h: oper tory 1 a‘ 18
              bit 0 a‘ bit 5: v˜stupn¡ £rove¤ (hlasitost)
              bit 6 a‘ bit 7: stupe¤ sn¡‘en¡ £rovnˆ vy¨¨¡ch t¢n–

                        ÚÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
                        ³stup.³     £tlum     ³
                        ÃÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
                        ³  0  ³ -             ³
                        ³  1  ³ 1.5 dB/okt vu ³
                        ³  2  ³ 3.0 dB/okr vu ³
                        ³  3  ³ 6.0 dB/okt vu ³
                        ÀÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

     60h-75h: oper tory 1 a‘ 18
              bit 0 a‘ bit 3: rychlost dobˆhu (vy¨¨¡ ‡¡slo=rychlej¨¡ dobˆh)
              bit 4 a‘ bit 7: rychlost n bˆhu (vy¨¨¡ ‡¡slo=rychlej¨¡ n bˆh)

     80h-95h: oper tory 1 a‘ 18
              bit 0 a‘ bit 3: rychlost uvolnˆn¡ t¢nu se st lou £rovn¡ po vyp.
              bit 4 a‘ bit 7: hladina st l‚ £rovnˆ t¢nu (tj. bod, od kter‚ho
                              se p©i dobˆhu £rove¤ t¢nu p©estane sni‘ovat a
                              bude st l  - pomˆrn‚ ‡¡slo maxim ln¡ hladiny)

     A0h-A8h: v˜stupn¡ kan ly 1 a‘ 9
              frekven‡n¡ ‡¡slo t¢nu - v˜¨ka t¢nu (ni‘¨¡ch 8 bit–)

     B0h-B8h: v˜stupn¡ kan ly 1 a‘ 9
              bit 0 a‘ bit 1: frekcen‡n¡ ‡¡slo (vy¨¨¡ 2 bity)
              bit 2 a‘ bit 4: ‡¡slo bloku t¢nu (definuje zhruba okt vu)
              bit 5: maskov n¡ kan lu: 1=v˜stup kan lu je povolen

              Frekven‡n¡ ‡¡slo = Frekvence * (2^(20-Blok) / 49716 Hz

         BDh: bit 0: 1=Hi-Hat (HH) zapnut
              bit 1: 1=‡inel (CY) zapnut
              bit 2: 1=st©edn¡ buben (TT) zapnut
              bit 3: 1=mal˜ buben (SD) zapnut
              bit 4: 1=velk˜ buben (BD) zapnut
              bit 5: 1=m¢d bic¡ch n stroj–, 0=m¢d melodick˜ch n stroj–
              bit 6: tremolo: 0=7 cent–, 1=14 cent– (1 cent = 1/100 semi-t¢nu)
              bit 7: vibr to: 0=1.0 dB, 1=4.8 dB

     C0h-C8h: kan ly 1 a‘ 9
              bit 0: 1=aditivn¡ syntez tor, 0=frekven‡n¡ modulace
              bit 1 a‘ bit 3: zpˆtn˜ modula‡n¡ faktor (FeedBack Modul. Factor)

                        ÚÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄ¿
                        ³ MULTI ³ Faktor ³
                        ÃÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄ´
                        ³   0   ³   0    ³
                        ³   1   ³  ã/16  ³
                        ³   2   ³  ã/8   ³
                        ³   3   ³  ã/4   ³
                        ³   4   ³  ã/2   ³
                        ³   5   ³   ã    ³
                        ³   6   ³  2ùã   ³
                        ³   7   ³  4ùã   ³
                        ÀÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÙ

     E0h-F5h: kan ly 1 a‘ 9
              bit 0 a‘ bit 1: volba form tu vln

                        ÚÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄ¿
                        ³ WS ³ Form t vln ³
                        ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ´ /\    /\
                        ³ 00 ³ sinusovka  ³    \/    \/
                        ³ 01 ³ p–l-sinus  ³ /\    /\
                        ³ 10 ³ absol. sin.³ /\ /\ /\ /\
                        ³ 11 ³ pulsn¡ sin.³
                        ÀÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÙ


U  nˆkter˜ch  parametr–  je jeden registr na v˜stupn¡ kan l. Pro tyto parametry
m–‘e  b˜t  pou‘ito  ‡¡slo  kan lu  jako  offset  registru  parametru. Pro mnoho
parametr– je sice jeden registr na oper tor, av¨ak adresov  mapa nen¡ spojit :

ÚÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³oper.³ 1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18 ³
ÃÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³offs.³ 00h 01h 02h 03h 04h 05h 08h 09h 0Ah 0Bh 0Ch 0Dh 10h 11h 12h 13h 14h 15h³
ÀÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

N sleduj¡c¡ dvˆ tabulky ilustruj¡, kter‚ oper tory tvo©¡ spolu kan l:

ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                  melodick˜ m¢d                    ³
ÃÄÄÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄ´
³kan l ³ 0  ³ 1  ³ 2  ³ 3  ³ 4  ³ 5  ³ 6  ³ 7  ³ 8  ³
ÃÄÄÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄ´
³oper.1³ 1  ³ 2  ³ 3  ³ 7  ³ 8  ³ 9  ³ 13 ³ 14 ³ 15 ³
³oper.2³ 4  ³ 5  ³ 6  ³ 10 ³ 11 ³ 12 ³ 16 ³ 17 ³ 18 ³
ÀÄÄÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÙ

ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³                     m¢d bic¡ch n stroj–                     ³
ÃÄÄÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄÂÄÄÄÄ´
³kan l ³ 0  ³ 1  ³ 2  ³ 3  ³ 4  ³ 5  ³ BD ³ SD ³ TT ³ CY ³ HH ³
ÃÄÄÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄÅÄÄÄÄ´
³oper.1³ 1  ³ 2  ³ 3  ³ 7  ³ 8  ³ 9  ³ 13 ³ 17 ³ 15 ³ 18 ³ 14 ³
³oper.2³ 4  ³ 5  ³ 6  ³ 10 ³ 11 ³ 12 ³ 16 ³    ³    ³    ³    ³
ÀÄÄÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÁÄÄÄÄÙ

Test ‡asova‡– pro detekci karty (neum¡ vyvolat p©eru¨en¡):

    1.- zastaven¡ T1 a T2 z pisem 60h do registru 4
    2.- resetov n¡ p©¡znaku p©eru¨en¡ IRQ z pisem 80h do registru 4
    3.- ‡ten¡ stavov‚ho registru, £schova stavu AND E0h
    4.- nastaven¡ ‡asova‡e 1 na FFh z pisem FFh do registru 2
    5.- odmaskov n¡ a start ‡asova‡e 1 z pisem 21h do registru 4
    6.- ‡ek n¡ ve smy‡ce po dobu alespo¤ 80 æs
    7.- ‡ten¡ stavov‚ho registru, £schova stavu AND E0h
    8.- resetov n¡ T1, T2 a IRQ jako v kroc¡ch 1 a 2
    9.- testov n¡ v˜sledku obou ‡ten¡: prvn¡ ‡ten¡ m  b˜t 0, druh‚ C0h.
        Pokud v˜sledek operace neodpov¡d , nen¡ nainstalov na karta ADLIB

Pozn.: Tato metoda nefunguje u karty SoundBlaster.

                      Stuktura souboru banky n stroj– .BNK
                      ------------------------------------
Sekce z hlav¡:

00h: (1) verze souboru (hlavn¡ ‡¡slo)
01h: (1) verze souboru (vedlej¨¡ ‡¡slo)
02h: (6) ozna‡en¡ souboru "ADLIB-"
08h: (2) po‡et pou‘it˜ch polo‘ek v seznamu
0Ah: (2) celkov˜ po‡et polo‘ek seznamu v souboru
0Ch: (4) absolutn¡ offset v souboru za‡ tku seznamu jmen
10h: (4) absolutn¡ offset v souboru za‡ tku dat
14h: (8)  .... v˜pl¤ (nastaveno na nulu)
1Ch:

Z znam v sekci jmen n stroj–:

00h: (2) index do datov‚ sekce
02h: (1) p©¡znak: 0=z znam je pou‘it˜ (jinak 1)
03h: (9) jm‚no n stroje (max. 8 znak–, doplnˆno nulami)
0Ch:

Z znam v datov‚ sekci:

00h: (1) m¢d (0=melodick˜, 1=bic¡ n stroj)
01h: (1) ‡¡slo kan lu (hlasu) - je-li m¢d bic¡ch n stroj–

modul tor
02h: (1) hladina pro sni‘ov n¡ £rovnˆ t¢n– s v˜¨kou (key scale level)
03h: (1) n sobitel frekvence
04h: (1) zpˆtn˜ modula‡n¡ faktor
05h: (1) rychlost n bˆhu
06h: (1) hladina st l‚ho t¢nu
07h: (1) p©¡znak st l‚ho t¢nu
08h: (1) rychlost dobˆhu
09h: (1) rychlost uvolnˆn¡ st l‚ho t¢nu
0Ah: (1) v˜stupn¡ hladina (hlasitost)
0Bh: (1) vibr to (amplitudov  modulace)
0Ch: (1) tremolo (frekven‡n¡ modulace)
0Dh: (1) sni‘ov n¡ d‚lky vy¨¨¡ch not pro nosnou (envelope scaling)
0Eh: (1) 0=freknven‡n¡ synt‚za FM, 1=aditivn¡ synt‚za

nosn 
0Fh: (1) hladina pro sni‘ov n¡ £rovnˆ t¢n– s v˜¨kou (key scale level)
10h: (1) n sobitel frekvence
11h: (1) zpˆtn˜ modula‡n¡ faktor
12h: (1) rychlost n bˆhu
13h: (1) hladina st l‚ho t¢nu
14h: (1) p©¡znak st l‚ho t¢nu
15h: (1) rychlost dobˆhu
16h: (1) rychlost uvolnˆn¡ st l‚ho t¢nu
17h: (1) v˜stupn¡ hladina (hlasitost)
18h: (1) vibr to (amplitudov  modulace)
19h: (1) tremolo (frekven‡n¡ modulace)
1Ah: (1) sni‘ov n¡ d‚lky vy¨¨¡ch not pro nosnou (envelope scaling)
1Bh: (1)   nepou‘ito

1Ch: (1) typ vlny pro modul tor
1Dh: (1) typ vlny pro nosnou


                                Frekvence t¢n–:
                                ---------------
ÚÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄ¿
³nota³   1    ³   2    ³   3    ³   4    ³   5    ³   6    ³   7    ³   8    ³
ÃÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄ´
³ C  ³ 16.352 ³ 32.703 ³ 65.406 ³ 130.81 ³*261.63*³ 523.25 ³ 1046.5 ³ 2093.0 ³
³ C# ³ 17.324 ³ 34.648 ³ 69.295 ³ 138.59 ³ 277.18 ³ 554.37 ³ 1108.7 ³ 2217.5 ³
³ D  ³ 18.354 ³ 36.708 ³ 73.416 ³ 146.83 ³ 293.66 ³ 587.33 ³ 1174.7 ³ 2349.3 ³
³ D# ³ 19.445 ³ 38.890 ³ 77.781 ³ 155.56 ³ 311.13 ³ 622.25 ³ 1244.5 ³ 2489.0 ³
³ E  ³ 20.601 ³ 41.203 ³ 82.406 ³ 164.81 ³ 329.63 ³ 659.26 ³ 1318.5 ³ 2637.0 ³
³ F  ³ 21.826 ³ 43.653 ³ 87.307 ³ 174.61 ³ 349.23 ³ 698.46 ³ 1396.9 ³ 2793.8 ³
³ F# ³ 23.124 ³ 46.249 ³ 92.499 ³ 184.99 ³ 369.99 ³ 739.99 ³ 1480.0 ³ 2960.0 ³
³ G  ³ 24.499 ³ 48.999 ³ 97.998 ³ 195.99 ³ 391.99 ³ 783.99 ³ 1568.0 ³ 3136.0 ³
³ G# ³ 25.956 ³ 51.913 ³ 103.82 ³ 207.65 ³ 415.31 ³ 830.61 ³ 1661.2 ³ 3322.4 ³
³ A  ³ 27.500 ³ 55.000 ³ 110.00 ³ 220.00 ³ 440.00 ³ 880.00 ³ 1760.0 ³ 3520.0 ³
³ A# ³ 29.135 ³ 58.270 ³ 116.54 ³ 233.08 ³ 466.16 ³ 932.32 ³ 1864.7 ³ 3729.3 ³
³ B  ³ 30.867 ³ 61.735 ³ 123.47 ³ 246.94 ³ 493.88 ³ 987.77 ³ 1975.5 ³ 3951.1 ³
ÀÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÙ



                          Sound Blaster, Sound Galaxy
                          ---------------------------
SB    = Sound Blaster       (MONO, 11 kan l– FM, vzorkov n¡ do 13 kHz)
SB2   = Sound Blaster II    (MONO, 11 kan l– FM, vzorkov n¡ do 22 kHz)
SBP   = Sound Blaster PRO   (STEREO, 20 kan l– FM, vzorkov n¡ do 44 kHz,CD ROM)

BX    = Sound Galaxy BX     (MONO, 11 kan l– FM, vzorkov n¡ do 13 kHz)
NX    = Sound Galaxy NX     (MONO, 11 kan l– FM, vzorkov n¡ do 13 kHz, CD ROM)
BX2   = Sound Galaxy BX II  (MONO, 11 kan l– FM, vzorkov n¡ do 22 kHz)
NX2   = Sound Galaxy NX II  (MONO, 11 kan l– FM, vzorkov n¡ do 22 kHz, CR ROM)
NXP   = Sound Galaxy NX Pro (STEREO, 20 kan l– FM, vzorkov n¡ do 44 kHz,CD ROM)
SGP16 = Sound Galaxy PRO 16 (STEREO, 20 kan l– FM, vzorkov n¡ do 44 kHz, 16 b)

DSP = ‡ip zpracov n¡ digit ln¡ch sign l– (Digital Signal Processing Chip)

P©enos  dat DSP m–‘e b˜t prov dˆn buƒ p©¡m˜m m¢dem (p©enos ©¡d¡ program) nebo v
m¢du  DMA  (p©enos  dat  ©¡d¡  ©adi‡  DMA).  Po proveden¡ p©enosu DMA se vyvol 
p©eru¨en¡.  V  re‘imu DMA (v˜stup DAC p©i norm ln¡ rychlosti) je mo‘n‚ p©en ¨et
data  v  komprimovan‚m  form tu 1:2, 1:3 a 1:4 (nen¡ mo‘n‚ v p©¡m‚m re‘imu, pro
vstup  dat  a  pro zv˜¨enou rychlost). Prvn¡m bajtem komprimovan˜ch dat je v‘dy
referen‡n¡ bajt (hodnota, z kter‚ se vych z¡).

DSP pou‘¡v  hardwarov  p©eru¨en¡ IRQ 2,3,5 nebo 7 (SB, SB2, BX, BX2, NX a NX2 -
implicitnˆ  7), IRQ 2,5,7 nebo 10 (NXP - implicitnˆ 7) nebo IRQ 2/9, 7, 10 nebo
11  (SGP16  -  implicitnˆ  7).  B zov  adresa DSP je 220h nebo 240h (implicitnˆ
220h).  DSP  pou‘¡v   kan l  DMA  ‡¡slo  1  (BX,  BX2 a NX), kan l 1 a 3 (NX2 -
implicitnˆ 1) nebo kan ly 0, 1 a 3 (NXP - implicitnˆ 1).

Adresa ‡ipu DSP se detekuje prov dˆn¡m funkce RESET - mus¡ b˜t navr ceno 0AAh.

Vzorkovac¡ kmito‡et:  ‡asovac¡_konstanta = 256 - 1000/vzorkovac¡_kmito‡et [kHz]

Rozsah rychlost¡ pro vstup (ADC):

   BX a NX ..... 4 kHz a‘ 15 kHz
   BX2 a NX2 ... 4 kHz a‘ 13 kHz (norm ln¡ m¢d)
                 13 kHz a‘ 23 kHz (rychl˜ m¢d)
   NXP ......... 4 kHz a‘ 23 kHz (norm ln¡ m¢d MONO)
                 23 kHz a‘ 44.1 kHz (rychl˜ m¢d MONO)
                 2 kHz a‘ 11.5 kHz (norm ln¡ m¢d STEREO)
                 11.5 kHz a‘ 22.05 kHz (rychl˜ m¢d STEREO)

Rozsah rychlost¡ pro v˜stup (DAC):

   BX a NX ..... 4 kHz a‘ 23 kHz
   BX2 a NX2 ... 4 kHz a‘ 23 kHz (norm ln¡ m¢d)
                 23 kHz a‘ 44.1 kHz (rychl˜ m¢d)
   NXP ......... 4 kHz a‘ 23 kHz (norm ln¡ m¢d MONO)
                 23 kHz a‘ 44.1 kHz (rychl˜ m¢d MONO)
                 4 kHz a‘ 23 kHz (norm ln¡ m¢d STEREO)
                 23 kHz a‘ 44.1 kHz (rychl˜ m¢d STEREO)

Rychl˜ m¢d - DSP nep©ij¡m  bˆhem operace p©enosu povely. Norm ln¡ m¢d po RESET.


Game port:
----------
200h - 207h   GAME PORT (z pis/‡ten¡)

(BASE = 220h, 240h)
---------------------
BASE + 00h (‡ten¡)   Lev˜ stavov˜ port FM
           (z pis)   Lev˜ port FM adresov‚ho registru
BASE + 01h (‡ten¡)   Lev˜ datov˜ port FM
BASE + 02h (‡ten¡)   Prav˜ stavov˜ port FM
           (z pis)   Prav˜ port FM adresov‚ho registru
BASE + 03h (‡ten¡)   Prav˜ datov˜ port FM
BASE + 04h (z pis)   Port registru adresy ‡ipu mixeru
           (‡ten¡)   Pouze karta SGP16: 80h = potvrzen¡ p©evzet¡ povelu mixeru
                           06h: ... (pouze SGP 16) <- zapisuje se 3Fh
                           07h: ... (pouze SGP 16) <- zapisuje se 3Fh
                           0Bh: ... (pouze SGP 16) bit 5 (mus¡ b˜t p©i ‡ten¡ 0)
                           49h: ... (pouze SGP 16)

BASE + 05h (‡ten¡/z pis) Datov˜ port ‡ipu mixeru

BASE + 06h (z pis)   reset DSP (01h=RESET, 00h=uvolnˆn¡ RESETu)
                      - DSP  je  nutno resetovat jednou na za‡ tku obsluhy, DSP
                        vrac¡ na ‡tec¡m portu (BASE+0Eh) bajt AAh pro kontrolu.
                             1.- z pis 01h - proveden¡ funkce RESET
                             2.- ‡ek n¡ po dobu 3 æs
                             3.- z pis 00h - uvolnˆn¡ sign lu RESET
                             4.- ‡ek n¡ na bajt 0AAh na ‡tec¡m datov‚m portu
                                 (odezva trv  asi 0.1 sek; 0.5 sek -> TIME-OUT)
                     Reset DSP se prov d¡ t‚‘ pro vypnut¡ rychl‚ho m¢du.

BASE + 08h (‡ten¡)   Stavov˜ port FM
           (z pis)   Port adresov‚ho registru FM
BASE + 09h (‡ten¡)   Datov˜ port FM


BASE + 0Ah (‡ten¡)   €ten¡ dat z DSP (je-li BASE+0Eh bit 7 = 1)

BASE + 0Ch (‡ten¡)   Stav z pisov‚ho bufferu DSP (bit 7: 0=je mo‘n˜ z pis)
           (z pis)   Z pis dat nebo povelu DSP (je-li p©i ‡ten¡ bit 7 = 0)

                     Povely:

    10h = v˜stup na DAC v p©¡m‚m m¢du 8 bit– (PCM DAC) - n sleduje 1 bajt dat
          ‡asov n¡ dat na v˜stup mus¡ zajistit program (nap©. pomoc¡ INT 08h)
    14h = v˜stup na DAC v m¢du DMA 8 bit– (PCM DAC)
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH
    16h = v˜stup na DAC v m¢du DMA s 2-bitovou kompres¡, nen¡ referen‡n¡ bajt
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH
    17h = v˜stup na DAC v m¢du DMA s 2-bitovou kompres¡, 1. bajt je referen‡n¡
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH
    1Ch = v¡ceblokov˜ v˜stup na DAC v m¢du DMA 8 bit– (PCM DAC)
          P©ed  t¡mto  povelem  p©edch z¡  povel  48h, kter˜ nastav¡ d‚lku dat.
          Povel  1Ch  zah j¡  p©enos.  Po  ukon‡en¡ bloku nen¡ t©eba nastavovat
          znovu DSP, lze pokra‡ovat dal¨¡m blokem. P©enos se ukon‡¡ DAh.
    1Fh = v¡ceblokov˜ v˜stup na DAC v m¢du DMA s 2-bitovou kompres¡ (ADPCM DAC)
          P©ed  t¡mto  povelem  p©edch z¡  povel  48h, kter˜ nastav¡ d‚lku dat.
          Povel  1Fh  zah j¡  p©enos.  Po  ukon‡en¡ bloku nen¡ t©eba nastavovat
          znovu  DSP, lze pokra‡ovat dal¨¡m blokem. P©enos se ukon‡¡ DAh. Prvn¡
          bajt prvn¡ho vys¡lan‚ho bloku je pova‘ov n za referen‡n¡ bajt.

    20h = vstup dat z ADC v p©¡m‚m m¢du 8 bit– (PCM ADC) - ‡te se 1 bajt dat
    24h = vstup z ADC v m¢du DMA 8 bit– (PCM ADC)
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH
    2Ch = v˜ceblokov˜ vstup z ADC v m¢du DMA 8 bit– (PCM ADC)
          P©ed  t¡mto  povelem  p©edch z¡  povel  48h, kter˜ nastav¡ d‚lku dat.
          Povel  2Ch  zah j¡  p©enos.  Po  ukon‡en¡ bloku nen¡ t©eba nastavovat
          znovu DSP, lze pokra‡ovat dal¨¡m blokem. P©enos se ukon‡¡ DAh.

    30h = ‡ten¡ dat z MIDI v ‡ekac¡m m¢du (testuje se port BASE+0Eh)
          vypnut¡ m¢du se provede opakovan˜m vysl n¡m povelu 30h
    31h = ‡ten¡ dat z MIDI v norm ln¡m m¢du (nutno povolit masku p©eru¨en¡)
          P©i  ka‘d‚m  p©ipraven‚m bajtu vyvol  DSP p©eru¨en¡. €ten¡m stavov‚ho
          portu BASE+0Eh se potvrd¡ p©eru¨en¡. M¢d se vypne opˆt vysl n¡m 31h.
    34h = nastaven¡ ‡ekac¡ho m¢du UART ‡ten¡/z pis MIDI. N sleduj¡c¡ zapisovan 
          data  jsou  vys¡l na na MIDI, ‡ten  data jsou ‡tena z MIDI. Tento m¢d
          lze ukon‡it pouze funkc¡ RESET DSP.
    35h = nastaven¡  p©eru¨ovac¡ho  m¢du  UART  ‡ten¡/z pis  MIDI.  N sleduj¡c¡
          zapisovan   data jsou vys¡l na na MIDI, ‡ten  data jsou ‡tena z MIDI.
          Tento m¢d lze ukon‡it pouze funkc¡ RESET DSP.
    37h = stejn‚  jako povel 35h, na konci dat jsou p©id ny 2 bajty informace o
          ‡asov‚ zna‡ce
    38h = z pis bajtu na MIDI v ‡ekac¡m m¢du

    40h = nastaven¡ ‡asovac¡ konstanty
          n sleduje 1 bajt = ‡asovac¡_konstanta = 256 - 1000/kmito‡et [kHz]
    48h = nastaven¡ velikosti p©en ¨en‚ho bloku pro DMA p©enos
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH
          Po povelu se o‡ek v  startovac¡ povel pro v¡ceblokov˜ p©enos 1Ch atd.

    74h = v˜stup ma DAC v m¢du DMA se 4-bitovou kompres¡, nen¡ referen‡n¡ bajt
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH
    75h = v˜stup na DAC v m¢du DMA se 4-bitovou kompres¡, 1. bajt je referen‡n¡
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH
    76h = v˜stup na DAC v m¢du DMA se 3-bitovou kompres¡, nen¡ referen‡n¡ bajt
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH
    77h = v˜stup na DAC v m¢du DMA se 3-bitovou kompres¡, 1. bajt je referen‡n¡
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH
    7Dh = v¡ceblokov˜ v˜stup na DAC v m¢du DMA s 4-bitovou kompres¡ (ADPCM DAC)
          P©ed  t¡mto  povelem  p©edch z¡  povel  48h, kter˜ nastav¡ d‚lku dat.
          Povel  7Dh  zah j¡  p©enos.  Po  ukon‡en¡ bloku nen¡ t©eba nastavovat
          znovu  DSP, lze pokra‡ovat dal¨¡m blokem. P©enos se ukon‡¡ DAh. Prvn¡
          bajt prvn¡ho vys¡lan‚ho bloku je pova‘ov n za referen‡n¡ bajt.
    7Fh = v¡ceblokov˜ v˜stup na DAC v m¢du DMA s 3-bitovou kompres¡ (ADPCM DAC)
          P©ed  t¡mto  povelem  p©edch z¡  povel  48h, kter˜ nastav¡ d‚lku dat.
          Povel  7Fh  zah j¡  p©enos.  Po  ukon‡en¡ bloku nen¡ t©eba nastavovat
          znovu  DSP, lze pokra‡ovat dal¨¡m blokem. P©enos se ukon‡¡ DAh. Prvn¡
          bajt prvn¡ho vys¡lan‚ho bloku je pova‘ov n za referen‡n¡ bajt.

    80h = tich˜ m¢d - po zadan˜ po‡et bajt– (jakoby p©i DMA) je v˜stup tich˜
          n sleduje d‚lka dat (=po‡et bajt– - 1): 1 bajt LOW, 1 bajt HIGH

    90h = v¡ceblokov˜ rychl˜ re‘im v˜stupu na DAC v m¢du DMA 8 bit– (PCM DAC)
          P©ed  t¡mto  povelem  p©edch z¡  povel  48h, kter˜ nastav¡ d‚lku dat.
          Povel  90h  zah j¡  p©enos.  Po  ukon‡en¡ bloku nen¡ t©eba nastavovat
          znovu DSP, lze pokra‡ovat dal¨¡m blokem. P©enos se ukon‡¡ RESET DSP.
    91h = jednoblokov˜ rychl˜ re‘im v˜stupu na DAC v m¢du DMA 8 bit– (PCM DAC)
          P©ed t¡mto povelem p©edch z¡ povel 48h, kter˜ nastav¡ d‚lku dat.
    98h = v¡ceblokov˜ rychl˜ re‘im vstupu z ADC v m¢du DMA 8 bit– (PCM ADC)
          P©ed  t¡mto  povelem  p©edch z¡  povel  48h, kter˜ nastav¡ d‚lku dat.
          Povel  98h  zah j¡  p©enos.  Po  ukon‡en¡ bloku nen¡ t©eba nastavovat
          znovu DSP, lze pokra‡ovat dal¨¡m blokem. P©enos se ukon‡¡ RESET DSP.
    99h = jednoblokov˜ rychl˜ re‘im vstupu z ADC v m¢du DMA 8 bit– (PCM ADC)
          P©ed t¡mto povelem p©edch z¡ povel 48h, kter˜ nastav¡ d‚lku dat.

    A8h = start  vstupu  z ADC v re‘imu STEREO se zv˜¨enou rychlost¡ (pouze pro
          kartu NXP p©i pou‘it¡ povelu 98h). P©epnut¡ do MONO pomoc¡ RESET DSP.

    D0h = pozastaven¡ p©enosu DMA (a‘ do pokra‡ov n¡ D4h)
    D1h = zapnut¡ reproduktoru (na za‡ tku vys¡l n¡ dat)
    D3h = vypnut¡ reproduktoru (po ukon‡en¡ p©enosu dat nebo p©ed ‡ten¡m dat)
    D4h = pokra‡ov n¡ p©enosu DMA (po p©edchoz¡m pozastaven¡ povelem D0h)
    D8h = poskytnut¡ stavu reproduktoru: ‡ten¡ vstupu -> 0=vypnut, 0FFh=zapnut
    DAh = ukon‡en¡ v¡ceblokov‚ho p©enosu dat (funkce 1Ch, 1Fh, 2Ch, 7Dh, 7Fh)

    E0h = ovˆ©en¡ datov‚ho portu DSP: n sleduje vysl n¡ bajtu (nap©. 0AAh), mus¡
                                      navr tit tento bajt invertovan˜ (tedy 55h)

    E1h = poskytnut¡ verze DSP: vrac¡ 2 bajty: 1. bajt=verze, 2. bajt=podverze
                                            verze 1 = SB, BX, NX
                                                  2 = SB2, BX2, NX2
                                                  3 = SBP, NXP

BASE + 0Eh (‡ten¡)   Stav ‡tec¡ho bufferu DSP (bit 7: 1=jsou p©ipravena data)
                     €ten¡m tohoto portu se potvrd¡ t‚‘ po‘adavek p©eru¨en¡.

P©¡klad - vysl n¡ dat pomoc¡ DMA:

    1.-  22Ch <- 0D1h  (zapnut¡ reproduktoru)
    2.-  22Ch <- 40h, 22Ch <- ‡asovac¡_konstanta (vysl n¡ ‡asovac¡ konstanty)
    3.-  definice obsluhy p©eru¨en¡ DSP a povolen¡ p©eru¨en¡
    4.-  nastaven¡ ©adi‡e DMA
    5.-  22Ch <- 14h  (m¢d DMA 8 bit– DAC), n sleduje slovo d‚lky dat - 1
    6.-  p©i ka‘d‚m p©eru¨en¡ opakovat kroky 4 a 5, a‘ budou v¨echny bloky
    7.-  z kaz p©eru¨en¡
    8.-  navr cen¡ obsluhy p©eru¨en¡
    9.-  22Ch <- 0D3h  (vypnut¡ reproduktoru)


Modul MIDI MPU401: (BASE = 300h nebo 330h - pouze karta SGP16)
------------------
BASE + 00h (‡ten¡/z pis) Datov˜ port MPU401
BASE + 01h (‡ten¡/z pis) Z pis povelu/stavov˜ port MPU401


Modul syst‚mu Microsoft Windows Sound System (SGP16): (BASE=530h,E80h,F40h,604h)
--------------------------------------------------------------------------------
BASE + 00h (z pis)   konfigurace
                        bit 0 a‘ bit 2 = ‡¡slo kan lu DMA
                                          1 = DMA 0
                                          2 = DMA 1
                                          3 = DMA 3
                        bit 3 a‘ bit 5 = ‡¡slo p©eru¨en¡ IRQ
                                          1 = IRQ 7
                                          2 = IRQ 2 nebo IRQ 9
                                          3 = IRQ 10 (jen sbˆrnice AT)
                                          4 = IRQ 11 (jen sbˆrnice AT)
                        bit 6: 1=p©eru¨en¡ povoleno
BASE + 01h (‡ten¡/z pis) rezervov no
BASE + 02h (‡ten¡/z pis) rezervov no
BASE + 03h (‡ten¡)   verze
                    bit 0 a‘ bit 5 = ‡¡slo verze (pro SGP 16 mus¡ b˜t = 4)
                    bit 6 = p©¡znak p©¡chodu p©eru¨en¡
                    bit 7 = typ desky MSS (1=sbˆrnice XT, 0=sbˆrnice AT ???)
                             (sbˆrnice XT = nejsou povolena IRQ 8 a v¡ce)
               €ten¡m portu se potvrd¡ p©eru¨en¡

BASE + 04h (‡ten¡/z pis) adresa Codec (sem se zapisuje ‡¡slo registru)
                            0 =
                            2 = (hloubky L)
                            3 = (hloubky R)
                            4 = (v˜¨ky L)
                            5 = (v˜¨ky R)
                            6 = (hlasitost L)
                            7 = (hlasitost R 3fh=nula ?)
                            9 = (©¡zen¡) - registr m¢du (5, 46h, 4)
                                  (bit0 a bit1 = povolen¡ v˜stup– na kan ly ?)
                           10 = maska p©eru¨en¡: bit 1: 1=p©eru¨en¡ povoleno
                           12 =
                                 bit 0 a‘ bit 3:
                           14 = po‡et krok– DMA k p©enosu dat HIGH (bajt–/slov)
                           15 = po‡et krok– DMA k p©enosu dat LOW (bajt–/slov)
BASE + 05h (‡ten¡/z pis) data Codec (‡ten¡ a z pis dat zvolen‚ho registru)
BASE + 06h (‡ten¡/z pis) status Codec (p©¡znak p©ipravenosti dat)
                           (z pis 0 = potvrzen¡ p©eru¨en¡)
BASE + 07h (‡ten¡/z pis) Direct data Codec (data p©i p©¡m‚m p©¡stupu)


FM syntetiz tor (kompatibilita s ADLIB):
----------------------------------------
388h (‡ten¡)  stavov˜ port FM
     (z pis)  Port adresov‚ho registru FM
389h (‡ten¡)  datov˜ port FM


                    VMP - ovlada‡ zvukov‚ karty Sound Galaxy
                    ----------------------------------------
Ovlada‡  VMP  pou‘¡v   k  vol n¡  sv˜ch  funkc¡  p©eru¨en¡ INT 7Fh. P©i pou‘it¡
ovlada‡e  VMP  v  jazyku  C  je nutno vlo‘it modul "VMP.H" a p©ilinkovat moduly
CVMP.OBJ  (pro  vol n¡  FAR)  nebo CVMPS.OBJ (pro vol n¡ NEAR - typ SMALL). P©i
pou‘it¡ ovlada‡e VMP v Assembleru je mo‘n‚ doplnit VMP.MAC (makra).

Ovlada‡e za©¡zen¡:

VAPI - (Voyetra  Application  Program  Interface)  p©ehr v n¡ hudebn¡ch soubor–
       MIDI pomoc¡ interface MIDI
SAPI - (Synthesis  Application  Program  Interface)  -  p©ehr v n¡ MIDI soubor–
       pomoc¡ zvukov‚ karty
AAPI - (Audio  Application  Program Interface) - obsluha nahr v n¡ a p©ehr v n¡
       digit ln¡ch zvukov˜ch nahr vek (AUDIO)
TAPI - (Total  Application  Program  Interface)  kombinovan˜ ovlada‡ zahrnuj¡c¡
       v¨echny 3 uveden‚ typy ovlada‡– pro v¡cefunk‡n¡ karty

Pozor  na  zav dˆn¡  ovlada‡–  do  horn¡  pamˆti  - nˆkter‚ po‡¡ta‡e neumo‘¤uj¡
pou‘¡vat DMA p©enos pro horn¡ pamˆŸ.


Vol n¡ funkc¡ v Assembleru:

              mov       bl,FUNKCE      ; ‡¡slo po‘adovan‚ funkce
              mov       ax,'VM'        ; identifikace vol n¡ funkce VMP
              mov       bh,0c1h        ; identifikace vol n¡ funkce VMP
              int       7fh            ; vol n¡ po‘adovan‚ funkce VMP

Funkce  VMP  uchov v  pouze registry SI, DI, BP, DS a SS:SP. Vˆt¨inu funkc¡ VMP
je  mo‘n‚  vyvol vat  opakovanˆ  (nap©.  z  obsluhy  p©eru¨en¡  p©ed  ukon‡en¡m
prov dˆn¡ funkce VMP) - kromˆ funkc¡ OPEN_, CLOSE_ a SETUP_AUDIO. Pro zaji¨tˆn¡
v¡cen sobn‚ho  vol n¡  funkc¡ DOS z VMP je nutn‚: nepou‘¡vat funkce pro vstup z
kl vesnice  s  ‡ek n¡m, neprov dˆt odskok do syst‚mu (funkce SHELL), nepou‘¡vat
funkce  DOS velmi ‡asto. P©¡li¨n‚ vol n¡ DOS m–‘e zp–sobit zastaven¡ p©ehr v n¡
modulu.

Ovlada‡ VMP podporuje p©ehr v n¡ zvukov˜ch soubor– "VOC", "WAV", "RAW" a "VOY".
"VOC"  je form t Creative Labs pro kartu Sound Blaster. Podporuje 8 bit– mono a
stereo  a  kompresi  4,  2.6  a  2  bity  ADPCM.  "WAV" je form t Microsoft pro
Multimedia  Windows. Podporuje r–znou d‚lku vzork– (8, 16 bit– atd.) a umo‘¤uje
jemnˆj¨¡  ur‡en¡  vzorkovac¡ho  kmito‡tu  ne‘ "VOC". "RAW" je soubor obsahuj¡c¡
pouze  zvukov   data  bez z hlav¡, parametry je nutno nastavit. "VOY" je form t
Voyetra  Technologies. M  stejn‚ mo‘nosti jako "WAV", dek¢dovac¡ metodu pou‘¡v 
v¨ak jinou ne‘ line rn¡ PCM.


Test p©¡tomnosti VMP:
---------------------
Nejd©¡ve  ovˆ©it,  zda je p©eru¨en¡ INT 7Fh platn‚ (zda adresa nen¡ = 0), potom
volat funkci BL=17 - mus¡ b˜t navr ceno AX=0.

€asova‡:
-------
Aplikace by mohla po‘adovat rychlej¨¡ ‡asova‡ INT 08h (IRQ 0). K tomu je ur‡ena
funkce BL=18 - zpˆtn‚ vol n¡ obsluhy hodin.


Funkce 1: Otev©en¡ ovlada‡e VMP
--------
Vol  se p©ed prvn¡m vol n¡m jin‚ funkce VMP (kromˆ testu instalace). Jako prvn¡
funkce po t‚to funkci by mˆla b˜t vol na funkce 13 (hardware).

VSTUP:   BP = definice hodin INT 08h
                   0 = standardn¡ nastaven¡
               jinak = pou‘it  hodnota pro nastaven¡ ‡¡ta‡e hodin INT 08h
                       (tj. pokud aplikace nastavila hodiny na vy¨¨¡ rychlost)

VSTUP:  AX = -300 ovlada‡ je ji‘ otev©en (0=funkce OK)


Funkce 2: Uzav©en¡ ovlada‡e VMP
--------
Uzav¡r  ovlada‡ VMP - mus¡ b˜t vol no p©ed ukon‡en¡m aplikace.

VSTUP:  AX = -301 ovlada‡ nen¡ otev©en


Funkce 3: P©¡prava MIDI souboru k p©ehr v n¡
--------
VSTUP:   ES:SI = ukazatel FAR na MIDI soubor na‡ten˜ v pamˆti
VSTUP:  AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -309 ovlada‡ MIDI nen¡ otev©en
              -310 soubor MIDI je ji‘ otev©en
              -311 ukazatel neukazuje na soubor MIDI
              -312 prob¡h  ji‘ p©ehr v n¡ MIDI souboru

Funkce 4: Uzav©en¡ p©ehr v n¡ MIDI souboru
--------
VSTUP:  AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -309 ovlada‡ MIDI nen¡ otev©en
              -313 nen¡ otev©en soubor MIDI


Funkce 5: Start p©ehr v n¡ MIDI souboru
--------
VSTUP:  AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -307 prob¡h  ji‘ p©ehr v n¡ nebo z znam AUDIO nebo obsluha MIDI
                   (nˆkter  za©¡zen¡ neumo‘¤uj¡ sou‡asnou obsluhu)
              -309 ovlada‡ MIDI nen¡ otev©en
              -311 data souboru MIDI byla od otev©en¡ zni‡ena
              -312 prob¡h  ji‘ p©ehr v n¡ MIDI souboru
              -313 nen¡ otev©en soubor MIDI

Funkce 6: Stop p©ehr v n¡ MIDI souboru
--------
VSTUP:  AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -309 ovlada‡ MIDI nen¡ otev©en
              -313 nen¡ otev©en soubor MIDI


Funkce 7: P©¡prava digit ln¡ho AUDIO souboru k p©ehr v n¡
--------
VSTUP:   ES:SI = jm‚no AUDIO souboru ASCIIZ
         DX:CX = form t z znamu (ukazatel FAR na popisova‡ struktury)
                   0: (4) vzorkovac¡ kmito‡et v [Hz]
                   4: (2) d‚lka vzorku (po‡et bit–: 8 nebo 16)
                   6: (2) 0=MONO, 1=STEREO
                   8: (2) form t souboru
                             0 = VOC (Sound Blaster)
                             1 = WAV (Microsoft)
                             2 = RAW
                             3 = VOY (Voyetra)
                  10: (2) kompresn¡ algoritmus
                             0 = nen¡ komprese (line rn¡ PCM 8/12/16 bit–)
                             1 = 4-bitov  komprese VOC (Sound Blaster)
                             2 = 2.6-bitov  komprese VOC (Sound Blaster)
                             3 = 2-bitov  komprese VOC (Sound Blaster)
                             4 = 4-bitov  komprese (z 12 bit–) ADPCM (OKI)
                             5 = 4-bitov  komprese (z 12 bit–) ADPCM (CCITT)
                             8 = 8-bitov  komprese (z 12 bit–) æLAW
                   12: (2*3) rezervov no

VSTUP:  AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -302 ovlada‡ AAPI (AUDIO) nen¡ otev©en
              -303 chyba alokace DMA bufferu
              -304 form t souboru nen¡ podporov n
              -305 form t dat souboru nen¡ podporov n
              -306 nelze otev©¡t soubor pro z znam AUDIO
              -307 prob¡h  ji‘ p©ehr v n¡ nebo z znam AUDIO nebo obsluha MIDI
                   (nˆkter  za©¡zen¡ neumo‘¤uj¡ sou‡asnou obsluhu)

Pokud  soubor obsahuje informace o form tu dat (VOC, WAV a VOY), jsou informace
z  popisova‡e  form tu  ignorov ny,  informace  budou doplnˆny podle skute‡n‚ho
obsahu souboru. Pro soubor RAW je nutno tyto informace nastavit.


Funkce 8: P©¡prava digit ln¡ho AUDIO souboru k z znamu
--------
VSTUP:   ES:SI = jm‚no AUDIO souboru ASCIIZ
         DX:CX = form t z znamu (ukazatel FAR na popisova‡ struktury)
                   0: (4) vzorkovac¡ kmito‡et v [Hz]
                   4: (2) d‚lka vzorku (po‡et bit–: 8 nebo 16)
                   6: (2) 0=MONO, 1=STEREO
                   8: (2) form t souboru
                             0 = VOC (Sound Blaster)
                             1 = WAV (Microsoft)
                             2 = RAW
                             3 = VOY (Voyetra)
                  10: (2) kompresn¡ algoritmus
                             0 = nen¡ komprese (line rn¡ PCM 8/12/16 bit–)
                             1 = 4-bitov  komprese VOC (Sound Blaster)
                             2 = 2.6-bitov  komprese VOC (Sound Blaster)
                             3 = 2-bitov  komprese VOC (Sound Blaster)
                             4 = 4-bitov  komprese (z 12 bit–) ADPCM (OKI)
                             5 = 4-bitov  komprese (z 12 bit–) ADPCM (CCITT)
                             8 = 8-bitov  komprese (z 12 bit–) æLAW
                   12: (2*3) rezervov no

VSTUP:  CY = chyba
         NC = operace OK
         AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -302 ovlada‡ AAPI (AUDIO) nen¡ otev©en
              -303 chyba alokace DMA bufferu
              -304 form t souboru nen¡ podporov n
              -305 form t dat souboru nen¡ podporov n
              -306 nelze otev©¡t soubor pro z znam AUDIO
              -307 prob¡h  ji‘ p©ehr v n¡ nebo z znam AUDIO nebo obsluha MIDI
                   (nˆkter  za©¡zen¡ neumo‘¤uj¡ sou‡asnou obsluhu)


Funkce 9: Start operace p©ehr v n¡ nebo z znamu
--------
P©ed touto operac¡ mus¡ p©edch zet funkce pro p©¡pravu k z znamu/p©ehr v n¡.

VSTUP:  AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -302 ovlada‡ AAPI (AUDIO) nen¡ otev©en
              -307 prob¡h  ji‘ p©ehr v n¡ nebo z znam AUDIO nebo obsluha MIDI
                   (nˆkter  za©¡zen¡ neumo‘¤uj¡ sou‡asnou obsluhu)
              -308 nebyla nastavena ‘ dn  operace p©ehr v n¡/z znamu

Funkce 10: Stop operace p©ehr v n¡ nebo z znamu
---------
VSTUP:  AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -302 ovlada‡ AAPI (AUDIO) nen¡ otev©en
              -308 nebyla nastavena ‘ dn  operace p©ehr v n¡/z znamu

Funkce 11: Pokra‡ov n¡ v p©ehr v n¡ MIDI souboru (po zastaven¡ PAUSE)
---------
VSTUP:  AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -307 prob¡h  ji‘ p©ehr v n¡ nebo z znam AUDIO nebo obsluha MIDI
                   (nˆkter  za©¡zen¡ neumo‘¤uj¡ sou‡asnou obsluhu)
              -309 ovlada‡ MIDI nen¡ otev©en
              -311 data souboru MIDI byla od otev©en¡ zni‡ena
              -312 prob¡h  ji‘ p©ehr v n¡ MIDI souboru
              -313 nen¡ otev©en soubor MIDI


Funkce 13: Poskytnut¡ stavu VMP
---------
VSTUP:   ES:SI = buffer 10 bajt– k na‡ten¡ informac¡ o stavu VMP
VSTUP:            0: (1) stav ovlada‡e VMP
                            0 = ovlada‡ VMP nen¡ otev©en
                            1 = ovlada‡ VMP otev©en
                   1: (1) stav ovlada‡e VAPI
                            0 = ovlada‡ MIDI nep©¡tomen nebo nen¡ otev©en
                            1 = ovlada‡ MIDI otev©en
                            2 = hudebn¡ soubor MIDI otev©en k p©ehr v n¡
                            4 = prob¡h  p©ehr v n¡ hudebn¡ho souboru MIDI
                   2: (1) stav ovlada‡e AAPI
                            0 = ovlada‡ AUDIO nen¡ otev©en
                            1 = ovlada‡ AUDIO otev©en
                            2 = zvukov˜ soubor AUDIO otev©en k p©ehr v n¡
                            3 = zvukov˜ soubor AUDIO otev©en k z znamu (RECORD)
                            4 = prob¡h  p©ehr v n¡ zvukov‚ho souboru AUDIO
                            5 = prob¡h  z znam do zvukov‚ho souboru AUDIO
                   3: (1) stav ovlada‡e CD (MSCDEX)
                            0 = ovlada‡ MSCDEX nep©¡tomen nebo nen¡ otev©en
                            1 = ovlada‡ MSCDEX otev©en
                            2 = v jednotce CD je zasunut platn˜ CD disk
                            3 = disk CD je pozastaven, m–‘e pokra‡ovat (PAUSE)
                            4 = prob¡h  p©ehr v n¡ disku CD
                   4: (1) verze VMP - vy¨¨¡ bajt (vlevo od desetinn‚ te‡ky)
                   5: (1) verze VMP - ni‘¨¡ bajt (vpravo od desetinn‚ te‡ky)
                               (nap©. 1 a 6 -> verze 1.06)
                   6: (1) chyba digit ln¡ho zvuku
                            0 = digit ln¡ zvuk ukon‡en norm lnˆ
                            1 = ukon‡en¡ z d–vodu zaplnˆn¡ disku (RECORD)
                            2 = ukon‡en¡ z d–vodu p©¡li¨ pomal‚ho disku
                            3 = ukon‡en¡ z d–vodu omezen¡ form tu souboru
                            4 = ukon‡en¡ z d–vodu diskov‚ chyby DOS
                   7: (1) typ ovlada‡e
                            0 = VMP pou‘¡vaj¡c¡ VAPI a/nebo AAPI
                            1 = VMP pou‘¡vaj¡c¡ MMSYSTEM.DLL


Funkce 16: P©idˆlen¡ rezidentn¡ pamˆti pro p©ehr v n¡ MODI souboru
----------
P©i  startu  VMP  s  volbou /clp: je p©idˆlena pamˆŸ k p©ehr v n¡ soubor– MIDI.
Tato  funkce  testuje,  zda  je  dost rezidentn¡ pamˆti k p©ehr n¡ souboru MIDI
(nap©. pokud chce b˜t aplikace ukon‡ena a ponechat soubor p©ehr vat v pozad¡).

VSTUP:   BP = velikost souboru MIDI v KB
VSTUP:  AX = segment adresy bufferu, kam lze soubor MIDI na‡¡st (offset = 0)
         AX = 0 -> soubor je p©¡li¨ velk˜, nevejde se do bufferu VMP
                   (aplikace mus¡ vytvo©it sv–j vlastn¡ buffer k na‡ten¡ MIDI)


Funkce 17: Test p©¡tomnosti VMP
---------
Tato  funkce  by  mˆla  b˜t  vol na  d©¡ve  p©ed  vol n¡m jak‚koliv funkce VMP.
Nejd©¡ve v¨ak je nutno otestovat platnost adresy INT 7Fh (zda nen¡ = 0).

VSTUP:  AX=0 ovlada‡ VMP je nainstalov n


Funkce 18: Obsluha p©eru¨en¡ hodin
---------
Tato  funkce  je  vol na,  pokud  jsou hodiny INT 08h aplikac¡ p©edefinov ny na
vy¨¨¡  rychlost. Jako parametr je VMP p©ed na adresa obsluhy p©eru¨en¡ od hodin
aplikace. VMP p©ed v  na tuto adresu obsluhu p©i p©¡chodu ka‘d‚ho p©eru¨en¡ INT
08h.

VSTUP:   ES:SI = adresa vlastn¡ obsluhy INT 08h (kter  m  b˜t z VMP vol na)
VSTUP:  CY = chyba operace
         NC = operace OK
         AX = 0 operace OK
              -301 VMP neotev©en
              -309 MIDI ovlada‡ neotev©en

   v z sobn¡ku slovo = po‡et [ms] prodlevy od posledn¡ho vol n¡ obsluhy hodin

VMP  si  p©ed  vol n¡m  obsluhy  uschov  v¨echny registry - je mo‘n‚ je v¨echny
modifikovat. Registr SS je nedefinov n. Obsluha nesm¡ volat slu‘by DOS.


Funkce 24: P©¡prava digit ln¡ho AUDIO souboru k p©ehr v n¡ ‡ sti souboru
--------
VSTUP:   ES:SI = ukazatel FAR na popisova‡ rozsahu
                   0: (4) ukazatel FAR na jm‚no souboru ASCIIZ
                   4: (4) po‡ te‡n¡ pozice v souboru (offset)
                   8: (4) koncov  pozice v souboru (offset)
         DX:CX = form t z znamu (ukazatel FAR na popisova‡ struktury)
                   0: (4) vzorkovac¡ kmito‡et v [Hz]
                   4: (2) d‚lka vzorku (po‡et bit–: 8 nebo 16)
                   6: (2) 0=MONO, 1=STEREO
                   8: (2) form t souboru
                             0 = VOC (Sound Blaster)
                             1 = WAV (Microsoft)
                             2 = RAW
                             3 = VOY (Voyetra)
                  10: (2) kompresn¡ algoritmus
                             0 = nen¡ komprese (line rn¡ PCM 8/12/16 bit–)
                             1 = 4-bitov  komprese VOC (Sound Blaster)
                             2 = 2.6-bitov  komprese VOC (Sound Blaster)
                             3 = 2-bitov  komprese VOC (Sound Blaster)
                             4 = 4-bitov  komprese (z 12 bit–) ADPCM (OKI)
                             5 = 4-bitov  komprese (z 12 bit–) ADPCM (CCITT)
                             8 = 8-bitov  komprese (z 12 bit–) æLAW
                   12: (2*3) rezervov no

VSTUP:  AX = 0 operace OK
              -301 ovlada‡ VMP nen¡ otev©en
              -302 ovlada‡ AAPI (AUDIO) nen¡ otev©en
              -303 chyba alokace DMA bufferu
              -304 form t souboru nen¡ podporov n
              -305 form t dat souboru nen¡ podporov n
              -306 nelze otev©¡t soubor pro z znam AUDIO
              -307 prob¡h  ji‘ p©ehr v n¡ nebo z znam AUDIO nebo obsluha MIDI
                   (nˆkter  za©¡zen¡ neumo‘¤uj¡ sou‡asnou obsluhu)

Pokud  soubor obsahuje informace o form tu dat (VOC, WAV a VOY), jsou informace
z  popisova‡e  form tu  ignorov ny,  informace  budou doplnˆny podle skute‡n‚ho
obsahu souboru. Pro soubor RAW je nutno tyto informace nastavit.


VF_VU_ENABLE                  equ  25  ;

Funkce 25: P©¡stup k hodnot m £rovn¡ sign l– bˆhem AUDIO operace
---------
VSTUP:  DX:AX = ukazatel FAR na buffer indik tor– £rovn¡ (DX=0 chyba)
                   0: (2) funkce povolena
                   2: (2) lev  ¨pi‡ka
                   4: (2) lev  £rove¤
                   6: (2) prav  ¨pi‡ka
                   8: (2) prav  £rove¤
         DX = 0 -> chyba
      -> AX = -301 ovlada‡ VMP nen¡ otev©en
              -302 ovlada‡ AAPI (AUDIO) nen¡ otev©en
              -308 neprob¡h  ‘ dn  operace p©ehr v n¡/z znamu
              -318 komprimovan˜ soubor

Hodnoty  indik tor– jsou v rozsahu 0 a‘ 127 pro 8-bitov‚ karty a 0 a‘ 32767 pro
16-bitov‚ karty. —rovnˆ sign l– nelze ‡¡st pro komprimovan˜ soubor.


Funkce 26: Prov dˆn¡ funkc¡ VMP s obsluhou DOS
---------
Tato  funkce  m  zabr nit p©eru¨en¡ AUDIO operace z d–vodu p©¡li¨n‚ zat¡‘enosti
DOS  (nap©.  se  na‡¡t   velk˜ grafick˜ soubor nebo se ‡asto testuje kl vesnice
pomoc¡ DOS). Bˆhem t‚to funkce m–‘e prov dˆt VMP po‘adovan‚ operace s DOS.


Funkce 27: Nastaven¡ glob ln¡ch promˆnn˜ch k p©ehr v n¡ MIDI souboru
---------
VSTUP:   BP = glob ln¡ prommˆnn , kter  m  b˜t nastavena
         CX = hodnota k nastaven¡ glob ln¡ promˆnn‚
VSTUP:  ş



Funkce VMP pro Assembler:
------------------------


VF_SEND_MIDI_DATA             equ  12  ;
VF_SMPTE_ON                   equ  14  ;
VF_SMPTE_OFF                  equ  15  ;
VF_RESERVED1                  equ  19  ;
VF_RESERVED2                  equ  20  ;

VF_CD_CONTROL                 equ  21  ;
VF_SET_MIXER                  equ  22  ;

VF_GET_MIXER                  equ  23  ;
VF_SET_PLAY                   equ  28  ;
VF_SET_REC                    equ  29  ;


Funkce VMP pro C:
----------------
vmp_open_driver()            /* otev©en¡ ovlada‡e VMP - mus¡ b˜t vol no      */
                             /* jednou p©ed vol n¡m jak‚koliv jin‚ funkce    */


vmp_driver_present()         /* test instalace VMP -> 0 je nainstalov n OK   */


vmp_timer_callback()         /* zpˆtn‚ vol n¡ p©eru¨en¡ hodin                */
vmp_dos_yield()              /* n hrada funkce DOS dotazu na ‡as             */



N vratov‚ k¢dy funkc¡ VMP (v registru AX):
------------------------------------------
VMP_OK                        equ  0    ; operace OK
VMP_OPEN                      equ  -300 ; ovlada‡ VMP je ji‘ otev©en
VMP_NOPEN                     equ  -301 ; ovlada‡ VMP nen¡ otev©en
AA_NOPEN                      equ  -302 ; ovlada‡ AAPI nen¡ otev©en
AA_MEM_ERR                    equ  -303 
VMP_FFORMAT                   equ  -304 ; form t souboru nen¡ VMP podporov n
VMP_DFORMAT                   equ  -305 ; form t dat nen¡ VMP podporov n
VMP_DISKERR                   equ  -306 
VMP_BUSY                      equ  -307 
VMP_NSET                      equ  -308 
VA_NOPEN                      equ  -309 
VMP_MFILE_OPEN                equ  -310 
VMP_MFILE                     equ  -311 
VMP_MFILE_BUSY                equ  -312 
VMP_MFILE_NOPEN               equ  -313 
VMP_MEM_ERR                   equ  -314 
VMP_CDPOS                     equ  -315 
VMP_NOCD                      equ  -316 
VMP_BAD_FUNC                  equ  -317 
VMP_NIMP                      equ  -318

 
ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±± º
º ±±                                                                   ±± º
º ±±                            ÿD  ÿO  ÿS                             ±± º
º ±±                                                                   ±± º
º ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±± º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
                            (c) Miroslav Nˆme‡ek

    DOS  (Disk  Operating  System)  je hardwarovˆ nez visl  ‡ st opera‡n¡ho
syst‚mu,  kter   se  instaluje p©i startu opera‡n¡ho syst‚mu z diskety nebo
pevn‚ho  disku.  Zav dˆn¡ opera‡n¡ho syst‚mu se prov d¡ na‡ten¡m zav dˆc¡ho
sektoru  z  disku,  kter˜  zabezpe‡¡  spr vn‚  na‡ten¡  jednotliv˜ch  ‡ st¡
opera‡n¡ho syst‚mu z disku do pamˆti (viz slu‘by BIOS - p©eru¨en¡ INT 19H -
zaveden¡  opera‡n¡ho syst‚mu). Pro MS DOS (MicroSoft Disk Operating System)
se  opera‡n¡ syst‚m skl d  z ‡ st¡ IO.SYS (dopl¤ky vstupnˆ/v˜stupn¡ operac¡
k BIOS) a MSDOS.SYS (slu‘by DOS).

    DOS  umo‘¤uje  pou‘¡vat  dva typy syst‚mov˜ch slu‘eb: p©eru¨en¡ (pomoc¡
instrukce  procesoru  INT  xx)  a vol n¡ funkc¡ (slu‘by p©eru¨en¡ INT 21H).
Pou‘¡v n¡  syst‚mov˜ch  slu‘eb opera‡n¡ho syst‚mu umo‘¤uje u‘ivateli snadno
ps t  programy  bez  znalosti hardware po‡¡ta‡e a p©enositeln‚ mezi r–zn˜mi
typy po‡¡ta‡–.

    Syst‚mov‚  slu‘by je mo‘n‚ vyvolat z Makroassembleru jednodu¨e ulo‘en¡m
po‘adovan˜ch  dat  do  registr–  a vyvol n¡m p©eru¨en¡. Nˆkter‚ slu‘by ru¨¡
obsahy registr– a proto je nutno p©ed pou‘it¡m tˆchto funkc¡ uchovat obsahy
p©¡slu¨n˜ch registr– (instrukcemi PUSH a POP).

    P©i  vol n¡  syst‚mov˜ch  slu‘eb  z  vy¨¨¡ho  jazyka lze pou‘¡t r–zn˜ch
zp–sob–.  Nap©.  p©i  vol n¡  z  Basicu lze pou‘¡t p©¡kazy CALL nebo funkce
USER.  U  kompil toru  je  mo‘n‚  p©ekl dan˜ modul spojit s moduly v jazyku
symbolick˜ch  adres.  Microsoft  Pascal  zahrnuje funkci DOSXQQ, kterou lze
volat p©¡mo v programu v Pascalu k vol n¡ syst‚mov‚ funkce.

   K n vratu z programu do DOSu lze pou‘¡t nˆkolik zp–sob–:

         1.- Vol n¡ funkce 4CH:        MOV  AH,4CH
                                       INT  21H
             Tato metoda se pou‘¡v  nej‡astˆji.
         2.- Vol n¡ p©eru¨en¡ INT 20H (nen¡ vhodn‚ - viz popis p©eru¨en¡)
         3.- Skok na adresu 0 za‡ tku prefixu programov‚ho segmentu;
                                       JMP  0

             Adresa  0  prefixu  programov‚ho  segmentu  obsahuje instrukci
             INTú20H (viz bod 2.-) - pouze programy typu COM
         4.- Vol n¡ funkce 00H:        MOV  AH,00H
                                       INT  21H
             Tato instrukce zp–sob¡ skok na adresu 0 (viz bod 3.-).
         5.- N vrat do syst‚mu a ponech n¡ programu rezidentn¡m: INT 27H

   Funkce opera‡n¡ho syst‚mu lze rozdˆlit zhruba do dvou z kladn¡ch skupin:

         1.- znakov‚ vstupy a v˜stupy (po slu‘bu 0CH=12)
         2.- diskov‚ operace a pr ce se soubory (od slu‘by 0DH=13)

    V¨echny  funkce  DOS  pracuj¡c¡  s  FCB  navrac¡  chybov˜ k¢d operace v
registru  AL  -  p©i  bezchybn‚ funkci navr t¡ k¢d 0, p©i chybˆ navr t¡ k¢d
0FFH. Ostatn¡ funkce hl s¡ chybu nastaven¡m p©¡znaku p©enosu CF a um¡stˆn¡m
chybov‚ho  k¢du  do registru AX. DOS 2.x navrac¡ chybov‚ k¢dy 0 - 12H (18).
Pod  DOS  3.x je lep¨¡ volat funkci 59H, pomoc¡ n¡‘ lze obdr‘et podrobnˆj¨¡
informace  o  chyb ch  -  viz  popis funkce 59H, kde je t‚‘ uveden podrobn˜
seznam  chybov˜ch k¢d– DOS. Chybov‚ k¢dy nejsou u nˆkter˜ch funkc¡ z tohoto
d–vodu ji‘ uv dˆny.



                            ÿVÿeÿrÿzÿe  ÿDÿOÿS


Verze DOS 1.0 vznikla z £spˆ¨n‚ho opera‡n¡ho syst‚mu CP/M.

Verze DOS 1.1 vznikla  z  DOS 1.0 pouze opraven¡m nˆkter˜ch chyb. Pokud v ¨
              program  mus¡  b˜t  provozov n  pod  DOS  verze  1.1, nesm¡te
              pou‘¡vat funkce DOS vy¨¨¡ ne‘ 2EH.

Verze DOS 2.0 vznikla  zaveden¡m  pevn‚ho  disku 20 MB (po‡¡ta‡e XT) firmou
              IBM. Tato verze umo‘¤ovala:

              - v¡cen sobn‚   adres ©e  (tj.  podadres ©e)  ke  snadnˆj¨¡mu
                p©¡stupu na m‚dium s vy¨¨¡ kapacitou
              - vstupnˆ/v˜stupn¡   funkce   operac¡   se   soubory   pomoc¡
                identifik tor–   soubor–   (z   d–vodu  pracn‚ho  pou‘¡v n¡
                ©¡d¡c¡ch blok– soubor– FCB)
              - standardn¡  vstupy/v˜stupy  - mo‘n‚ p©esmˆ©ov n¡ podle typu
                UNIX
              - instalovateln‚  drivery  za©¡zen¡ - zprost©edkov n¡ obsluhy
                nestandardn¡ch za©¡zen¡ a RAM disk–, v‡etnˆ driveru konzoly
                ANSI.SYS

Verze DOS 2.1 odstranila  nˆkolik  chyb  verze  2.0 a p©ipojila podporu pro
              disketov‚ drivery PCjr.

Verze DOS 3.0 p©i¨la na svˆt spolu s po‡¡ta‡i AT a obsahuje podporu pevn‚ho
              disku  20  MB. P©idala podporu pro 16-bitovou tabulku alokac¡
              souboru FAT, ‡¡m‘ minimalizovala nevyu‘it‚ prostory na disku.
              P©idala  roz¨¡©en   chybov  hl ¨en¡ funkc¡ DOS (pomoc¡ funkce
              DOS 59H). Doplnˆny nov‚ povely DOS: ATTRIB, LABEL a VDISK.SYS
              (RAM-disk).

Verze DOS 3.1 obsahuje  nˆkter‚  slu‘by  pro pr ci v s¡ti (sd¡len¡ soubor–,
              uzamyk n¡  soubor–,  p©esmˆ©ov n¡). Doplnˆny nov‚ povely DOS:
              JOIN a SUBST.

Verze DOS 3.2 p©ich z¡ spolu s IBM konvertabiln¡m PC. Je roz¨¡©ena o slu‘by
              ©¡zen¡ driver– za©¡zen¡ IOCTL (funkce DOS 44H) a t¡m umo‘nila
              nap©.  form tov n¡  disku  pod ©¡zen¡m DOS atd. Doplnˆny nov‚
              povely DOS: REPLACE, XCOPY a DRIVER.SYS (logick‚ disky).

Kompatibilita: V¨eobecnˆ  by  mˆlo  platit,  ‘e  vy¨¨¡  verze  by  mˆla b˜t
               kopatibiln¡  se  star¨¡  verz¡. Mnoho program– je ps no tak,
               aby  pracovalo  pod  DOS 2.x neboŸ je tato verze dosud st le
               je¨tˆ roz¨¡©ena.

               Ov¨em  vy¨¨¡  probl‚my s kompatibilitou nast vaj¡ vzhledem k
               omezen¡  pamˆti.  Vy¨¨¡ verze DOS vy‘aduj¡ st le v¡ce a v¡ce
               pamˆti  a  ponech vaj¡ tak st le men¨¡ prostor pro aplika‡n¡
               programy.
               ÉÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
               º verze ³ prostor na disku ³ prostor v pamˆti º
               ÌÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
               º  1.0  ³     11 551       ³      12 144      º
               º  1.1  ³     13 279       ³      12 400      º
               º  2.0  ³     39 424       ³      24 800      º
               º  2.1  ³     39 551       ³      24 800      º
               º  3.0  ³     58 926       ³      37 024      º
               º  3.1  ³     60 534       ³      37 040      º
               º  3.2  ³     68 637       ³      44 704      º
               ÈÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

               Probl‚my  vznikaj¡  u  instalovateln˜ch driver– za©¡zen¡ pro
               disky  fomr tu  NON-IBM.  Nˆkter‚ pracuj¡ pdo DOS 2.x, av¨ak
               nepracuj¡ ji‘ pod DOS 3.x.


    Vˆt¨ina  verz¡  DOS  m   vysokou  kompatibilitu, av¨ak existuje nˆkolik
m¡st, kde mohou nastat probl‚my:

    - Funkce  DOS  1BH  (poskytnut¡  informac¡  FAT)  ve  verzi  DOS 2.0 se
      ukon‡uje  navr cen¡m  ukazatele  na  aktu ln¡  FAT  a  pouze  navrac¡
      ukazatel na popisova‡ m‚dia. FAT nemus¡ b˜t v pamˆti.

    - Funkce  DOS 4FH (nalezen¡ dal¨¡ho souboru) m  mal‚ zmˆny mezi verzemi
      DOS  2.x  a 3.x. Je po v s vy‘adov no ponechat DS:DX, aby ukazoval na
      informace  z  vol n¡  funkce  4EH (nalezen¡ prvn¡ho souboru). DOS 2.x
      pouze p©edpokl d , ‘e to bylo na adrese DTA.

    - Funkce  30H  (poskytnut¡  ‡¡sla  verze  DOS)  v  DOS ò 3.0 modifikuje
      registry BX a CX.

    - Funkce  DOS  38H  (n rodnostn¡ informace) navrac¡ nekompatibiln¡ blok
      n rodnostn¡ch informac¡.

    - T©i slova na konci tabulky BPB (viz drivery za©¡zen¡) se p©ep¡naj¡ ve
      verzi  DOS  3.0  z "voliteln‚ho" do "na©¡zen‚ho". Tak‘e dbejte na to,
      aby  nˆkter‚  drivery  NON-IBM  neukl daly  BPB do zav dˆc¡ho sektoru
      pevn‚ho   disku   (to  se  aplikuje  pouze  u  pevn˜ch  disk–,  kter‚
      nepou‘¡vaj¡ tabulku odd¡l– disku).





      ÿIÿnÿiÿcÿiÿaÿlÿiÿzÿaÿcÿe  ÿoÿpÿeÿrÿaÿ‡ÿnÿ¡ÿhÿo  ÿsÿyÿsÿtÿ‚ÿmÿu


    Inicializace  opera‡n¡ho syst‚mu se skl d  z nˆkolika krok–. Po zapnut¡
po‡¡ta‡e  se  p©ed   ©¡zen¡  na  adresu FFFF:0000H (standardn¡ funkce reset
procesoru) - na t‚to adrese je inicializa‡n¡ program ulo‘en˜ v pevn‚ pamˆti
ROM.  Po  vnit©n¡ch  inicializa‡n¡ch  testech po‡¡ta‡e se provede p©eru¨en¡
INTú19H  (viz  popis tohoto p©eru¨en¡ v popisu BIOS), kter‚ zp–sob¡ na‡ten¡
zav dˆc¡ho  sektoru  z  disku.  Tento  zav dˆc¡ sektor pokra‡uje v zav dˆn¡
opera‡n¡ho  syst‚mu t¡m zp–sobem, ‘e na‡te do pamˆti z disku nejd©¡ve modul
opera‡n¡ho  syst‚mu IO.SYS (roz¨i©uj¡c¡ modul BIOS) a potom modul MSDOS.SYS
(vlastn¡  ‡ st  opera‡n¡ho syst‚mu MS-DOS). Nakonec se na‡te z disku soubor
COMMAND.COM,   kter˜  slou‘¡  jako  povelov˜  interpreter,  kter˜  umo‘¤uje
u‘ivateli ovl d n¡ po‡¡ta‡e a prov dˆn¡ p©¡kaz– opera‡n¡ho syst‚mu.

    Povelov˜   interpreter   COMMAND.COM   (‡asto  naz˜van˜  t‚‘  p©¡kazov˜
procesor) se skl d  ze t©¡ ‡ st¡:

    1.- Hned  za  modulem  MSDOS.SYS  a  jeho  datovou  oblast¡  je ulo‘ena
        rezidentn¡  ‡ st  povelov‚ho  interpreteru  COMMAND.COM.  Tato ‡ st
        obsahuje  programy  pro  obsluhu  p©eru¨en¡ INT 23H (adresa obsluhy
        Ctrl-Break)  a  INT  24H  (adresa  obsluhy  kritick˜ch chyb) a tak‚
        program,  kter˜ znovu zavede do‡asnou ‡ st povelov‚ho interpreteru,
        v‘dy  kdy‘  je  to  t©eba.  V  tomto  modulu COMMAND.COM se prov d¡
        ve¨ker‚ standardn¡ zpracov n¡ chyb. To zahrnuje zobrazen¡ chybov˜ch
        zpr v a zpracov n¡ zpr v typu "Abort, Retry, Ignore, Fail ?".

    2.- Za  rezidentn¡  ‡ st¡  COMMAND.COM  n sleduje  inicializa‡n¡ modul.
        Tomuto  modulu  je  p©ed no ©¡zen¡ p©i spu¨tˆn¡ programu a obsahuje
        rutinu,  kter   zabezpe‡¡  vykon n¡  p©¡kaz–  ulo‘en˜ch  v  souboru
        AUTOEXEC.BAT. Inicializa‡n¡ modul ur‡uje adresu segmentu, na kterou
        se  budou  zav dˆt  programy.  Prvn¡m  programem, kter˜ COMMAND.COM
        zavede  do  pamˆti,  je  tento  modul p©eps n, proto‘e u‘ v¡ce nen¡
        pot©eba.

    3.- Do‡asn˜ modul se zav d¡ do horn¡ ‡ sti pamˆti. Tento modul obsahuje
        v˜konn‚  ‡ sti  v¨ech  vnit©n¡ch  p©¡kaz–  a program pro zpracov n¡
        povelov˜ch   soubor–   (tzv.   d vkov˜   procesor).  Do‡asn˜  modul
        povelov‚ho  interpreteru  vyvol   n povˆdu syst‚mu, p©e‡te p©¡kaz z
        kl vesnice  (nebo  p©¡kaz  povelov‚ho souboru) a zabezpe‡¡ vykon n¡
        tohoto  p©¡kazu.  P©¡kaz  m–‘e b˜t buƒ vnit©n¡ (obslu‘n˜ program je
        um¡stˆn  v  pamˆti) nebo vnˆj¨¡ (do pamˆti se zavede jako program a
        spust¡  se). Pro vnˆj¨¡ p©¡kazy tento modul vytvo©¡ p©¡kazov˜ © dek
        a vol  funkci EXEC (funkce 4BH), kter  provede zaveden¡ programu do
        pamˆti a jeho spu¨tˆn¡.




        ÿSÿtÿaÿrÿt  ÿpÿrÿoÿgÿrÿaÿmÿu  ÿa  ÿjÿeÿhÿo  ÿuÿkÿoÿnÿ‡ÿeÿnÿ¡


    DOS  um¡  na‡¡st  z disku a spustit dva typy soubor– (program–) - COM a
EXE  (tyto  soubory  jsou  na  disku  ozna‡eny  jm‚nem  programu, za kter˜m
n sleduje p©¡pona COM nebo EXE).

    Z d–vodu segmentovan˜ch adresov˜ch prostor– procesoru 8088/86/286/386 a
tak‚  d¡ky  skute‡nosti,  ‘e  instrukce  JMP a CALL jsou relativn¡ k jejich
adrese,  je  mo‘n‚ na‡¡st do pamˆti a spustit oba typy jmenovan˜ch program–
na  libovolnou  adresu  odstavce  do pamˆti (tj. libovoln˜ n sobek 16 - viz
popis  zp–sobu  adresov n¡  mikroprocesoru  8088/86/286/386). Tak‘e nˆkter‚
programy  mohou  b˜t  ulo‘eny  do  pamˆti  jako  rezidentn¡ (tj. jsou do n¡
um¡stˆny  trvale  a‘  do  vypnut¡ nebo resetov n¡ po‡¡ta‡e) do "n¡zk‚" ‡ ti
pamˆti  a  jin‚  programy  mohou  b˜t  na‡teny  do pamˆti nad £rove¤ tˆchto
program–  a  tam  mohou  b˜t  odstartov ny.  Programy  nejsou NIKDY ps ny s
p©edpokladem,  ‘e  by  mohly  b˜t  na‡teny  v‘dy  na  ur‡itou adresu (kromˆ
nˆkter˜ch samo-zav dˆc¡ch program– a her chr nˆn˜ch proti kop¡rov n¡).

    - Soubor  (program)  ve  form tu COM je bin rn¡ soubor obsahuj¡c¡ ‡ sti
      k¢du  programu a data programu. Soubor mus¡ b˜t men¨¡ ne‘ 64K (zav d¡
      se  pouze  do  rozsahu  jednoho  segmentu)  a  nesm¡  obsahovat ‘ dn‚
      reloka‡n¡  segmentov‚  polo‘ky  (tj.  adresy  z visl‚ na segmentu, ve
      kter‚m je program um¡stˆn).

    - Soubor  ve  form tu  EXE obsahuje na za‡ tku speci ln¡ z hlav¡, kter‚
      ur‡uje zp–sob zaveden¡ programu do pamˆti a informace o referenc¡ch k
      segmentov‚ adrese.

    P©ed  zaveden¡m jak‚hokoliv programu do pamˆti (COM nebo EXE) zvol¡ DOS
nejd©¡ve  segmentovou adresu, naz˜vanou PSP (prefix programov‚ho segmentu),
jako  b zovou  adresu  pro  zaveden¡  programu.  DOS vybere nejni‘¨¡ volnou
adresu  v  pamˆti,  av¨ak  ©¡d¡c¡  program (jako je Microsoft Windows) m–‘e
zvolit libovolnou ‡ st pamˆti. Potom DOS provede n sleduj¡c¡ kroky:

    - Provede zduplikov n¡ sou‡asn‚ho prost©ed¡ DOS pro program. Funkce DOS
      4BH (zaveden¡ programu z disku) d v  otcovsk‚mu (nad©azen‚mu) procesu
      mo‘nost  definovat  vlastn¡ odli¨n‚ prost©ed¡. Nap©. - program, kter˜
      chce vyvolat COMMAND.COM, nastav¡ prompt DOSu tak, aby obsahoval text
      "Pou‘ijte EXIT k n vratu do GENS80").

    - Verze DOS ò 3.0 um¡st¡ za konec prost©ed¡ zav dˆc¡ cestu k programu.

    - Vypln¡  polo‘ky v prefixu progamov‚ho segmentu informacemi u‘ite‡n˜mi
      pro program (viz Prefix programov‚ho segmentu):
         - celkov  voln  pamˆŸ pro program
         - segmentov  adresa prost©ed¡ DOS
         - 0-2  neotev©en‚  ©¡d¡c¡ bloky soubor– FCB jako rozbor povelov‚ho
           © dku  (parametry  zadan‚  za jm‚nem volan‚ho programu) - pozn.:
           p©i   otev©en¡   prvn¡ho   FCB   se  p©ep¡¨e  ‡ st  druh‚ho  FCB
           n sleduj¡c¡ho za prvn¡m.
         - parametry povelu, vznikl‚ rozborem povelov‚ho © dku - dopl¤uj¡c¡
           znaky zadan‚ v povelov‚m © dku za jm‚nem programu
         - sou‡asn‚ nastaven¡ vektor– INT 22H, INT 23H a INT 24H

    - Nastav¡ sou‡asnou adresu pro diskov‚ p©enosy DTA na adresu PSP:0080H.

    - Nastav¡  registr  AX  tak,  aby indikoval platnost identifikace disk–
      (pokud  jsou nˆjak‚ zad ny) parametr– zadan˜ch v povelov‚m © dku jako
      specifikace souboru. Pokud je AL=0FFH, potom prvn¡ identifikace disku
      byla  neplatn . Pokud je AH=0FFH, potom byla druh  identifikace disku
      neplatn .

    Programy  ve  form tu  EXE  definuj¡  v¡cen sobn‚  programov‚ segmenty,
v‡etnˆ  k¢du  programu,  dat  a segmentu z sobn¡ku. Soubor EXE se zav d¡ od
adresy  PSP:0100H.  P©i jeho zav dˆn¡ ‡te DOS ze z hlav¡ programu reloka‡n¡
informace  a  prov d¡  relokace  segmentov˜ch  adres. To znamen , ‘e takov‚
reference, jako

         mov       ax,data_seg         ; adresa datov‚ho segmentu
         mov       ds,ax
nebo
         call      far_proc            ; vol n¡ vzd len‚ procedury

    mus¡  b˜t  upraveny  tak, aby bylo mo‘n‚ zaveden¡ programu do libovolnˆ
zvolen‚ho segmentu pamˆti. V¡ce informac¡ viz Form t souboru EXE.

    Po relokaci se p©ed  ©¡zen¡ do zaveden‚ho modulu pomoc¡ instrukce skoku
typu FAR na adresu CS:IP, kter  je zji¨tˆna ze z hlav¡ souboru EXE.

    Pokud program ve form tu EXE p©evezme ©¡zen¡, potom:

    - registry DS a ES jsou nastaveny na PSP (prefix programov‚ho segmentu)
    - CS, IP, SS a SP se nastav¡ na hodnoty zji¨tˆn‚ ze z hlav¡ souboru EXE
    - pole  PSP  "horn¡  hranice  pamˆti"  se  nastav¡  na hodnotu udanou v
      z hlav¡ souboru EXE. Norm lnˆ se p©idˆl¡ programu cel  voln  pamˆŸ.

    Programy  ve  form tu  COM  se definuj¡ v jednom segmentu (nebo alespo¤
neprov dˆj¡  explicitnˆ  ‘ dn‚ reference do jin‚ho segmentu). Bajty souboru
typu  COM  se  jednodu¨e na‡¡taj¡ z disku a ukl daj¡ se do pamˆti od adresy
PSP:0100H (tj. stejnˆ jako program typu EXE). Poznamenejme, ‘e program typu
COM m–‘e sice pou‘¡vat v¡cen sobn‚ segmenty, av¨ak mus¡ si s m p©epo‡¡t vat
nebo  ©¡dit  segmentov‚  adresy  za pou‘it¡ programov‚ho segmentu (CS) jako
b ze.

    Program–m ve form tu COM se d v  p©ednost oproti program–m typu EXE pro
kr tk‚  programy  psan‚  ve  strojov‚m  k¢du.  Zav dˆj¡  se rychleji, neboŸ
nevy‘aduj¡  ‘ dn‚  relokace  segment–,  a  zab¡raj¡  m‚nˆ prostoru na disku
(neboŸ v zav dˆn‚m modulu nemus¡ b˜t z hlav¡ EXE ani segment z sobn¡ku).

    Po zaveden¡ programov‚ho souboru typu COM do pamˆti:

    - CS, DS, ES a SS se nastav¡ na stejn˜ segment jako PSP
    - SP  se  nastav¡  na  konec segmentu PSP (obvykle hodnota FFFEH, av¨ak
      pokud  nen¡  zaplnˆn  cel˜ segment 64 KB, m–‘e b˜t i ni‘¨¡). Slovo na
      offsetu  06H  prefixu programov‚ho segmentu PSP se nastav¡ na hodnotu
      indikuj¡c¡, kolik je v programov‚m segmentu voln‚ho m¡sta.
    - Ve¨ker    syst‚mov    pamˆŸ  nad  programov˜m  segmentem  se  p©idˆl¡
      programu.
    - Do z sobn¡ku se ulo‘¡ slovo 0000H (tak‘e lze pro n vrat pou‘¡t RET).
    - Ukazatel  IP  se  pomoc¡  skoku  JMP  na  adresu PSP:0100H nastav¡ na
      hodnotu 100H (prvn¡ bajt zaveden‚ho modulu).

    Ukon‡en¡ programu EXE nebo COM je mo‘n‚ nˆkterou z tˆchto mo‘nost¡:

    - pou‘it¡ funkce DOS 4CH (tato funkce je nejpou‘¡vanˆj¨¡)
    - pou‘it¡ funkce DOS 00H nebo vyvol n¡ INT 20H; CS mus¡ b˜t nastaven na
      hodnotu PSP - to zajist¡te nap©. t¡m, ‘e do z sobn¡ku ulo‘¡te hodnotu
      segmentu  PSP (nap©. p©i startu programu instrukc¡ PUSH DS) a slovo o
      hodnotˆ  0000H  (instrukc¡  PUSH  0).  P©i  ukon‡en¡  programu  pouze
      provedete  instrukci FAR RET (opera‡n¡ k¢d 0CBH), ‡¡m‘ p©ed te ©¡zen¡
      na INT 20H v PSP tak, jak to vy‘aduje DOS.

    Funkce  4CH  odstra¤uje  tyto  komplikace  a  umo‘¤uje  nav¡c  navracet
otcovsk‚mu  (nad©azen‚mu) procesu (obvykle COMMAND.COM) v˜stupn¡ k¢d, kter˜
m–‘e  b˜t  testov n  (v  COMMAND.COM  je to povel "IF ERRORLEVEL", otcovsk˜
proces m–‘e pou‘¡t funkci DOS 4DH).

    Program  je  mo‘n‚  t‚‘ ukon‡it s t¡m, ‘e z–stane trvale v pamˆti (tzv.
rezidentn¡  program TSR) a‘ do doby nov‚ho startu po‡¡ta‡e. K tomu je mo‘n‚
pou‘¡t  p©eru¨en¡ INT 27H (star¨¡ verze DOS) nebo funkci DOS 31H. P©eru¨en¡
INT 27H umo‘¤uje ponechat v pamˆti rezidentn¡ program o maxim ln¡ velikosti
64  KB.  Funkce DOS 31H umo‘¤uje ponechat v pamˆti i vˆt¨¡ ‡ st ne‘ 64 KB a
umo‘¤uje navracet do otcovsk‚ho procesu v˜stupn¡ k¢d.



            ÿSÿtÿaÿnÿdÿaÿrÿdÿnÿ¡  ÿvÿsÿtÿuÿpÿyÿ/ÿvÿ˜ÿsÿtÿuÿpÿy


    Verze  DOS  ò  2.0  podporuj¡  p©esmˆ©ov n¡  standardn¡ch  vstupn¡ch  a
standardn¡ch  v˜stupn¡ch  za©¡zen¡.  To je z klad techniky, kdy vstupy nebo
v˜stupy programu prob¡haj¡ do jin‚ho programu.

    Dokud   nen¡   provedeno   p©esmˆ©ov n¡,  prob¡h   standardn¡  vstup  z
kl vesnice  po‡¡ta‡e  a  standardn¡  v˜stup  na  obrazovku  (tj. za©¡zen¡ s
ozna‡en¡m  CON).  Otcovsk˜  proces  (jako  COMMAND.COM)  m–‘e p©ed p©ed n¡m
©¡zen¡  synovsk‚mu procesu p©esmˆ©ovat buƒ standardn¡ vstup nebo standardn¡
v˜stup  nebo  oba.  To  m–‘e  b˜t  velmi  v˜konn˜  zp–sob,  jak si p©ed vat
informace z procesu do procesu s minimem programov‚ho ©¡zen¡.

    Viz t‚‘ Standardn¡ identifik tory soubor–.

    Ke  ‡ten¡  nebo z pisu na standardn¡ vstupnˆ/v˜stupn¡ za©¡zen¡ pou‘ijte
znakov‚  funkce DOS 3FH (‡ten¡) a 40H (z pis). Pokud si chcete b˜t jist, ‘e
se  zobraz¡  hl ¨en¡  na  obrazovce,  pou‘ijte  identifik tor  souboru  02H
(standardn¡ chybov‚ za©¡zen¡) s funkc¡ 40H (z pis).

    - Pou‘ijte funkci DOS 46H k p©esmˆ©ov n¡ standardn¡ch vstup–/v˜stup–.
    - Pou‘ijte funkci DOS 4BH k vyvol n¡ synovsk‚ho procesu.
    - Pou‘ijte  funkci  DOS  44H  (IOCTL)  k  ur‡en¡,  zda  bylo standardn¡
      vstupnˆ/v˜stupn¡ za©¡zen¡ p©esmˆ©ov no.
    - Atribut  za©¡zen¡  (viz Instalovateln˜ driver za©¡zen¡) indikuje, zda
      je   za©¡zen¡  pou‘ito  jako  standardn¡  vstupn¡  a/nebo  standardn¡
      v˜stupn¡ za©¡zen¡.

    Povelov˜   interpreter   DOS  (tj.  COMMAND.COM)  prov d¡  p©esmˆ©ov n¡
vstup–/v˜stup–  podle  povelov‚ho  © dku  je¨tˆ  p©ed  proveden¡m vnit©n¡ho
povelu nebo p©ed vyvol n¡m programu:

    proces < specifikace_souboru       - kl vesnicov˜   vstup  probˆhne  ze
                                         souboru
    proces > specifikace_souboru       - v˜stup   na  displej  probˆhne  do
                                         souboru  (soubor  se  p©i vyvol n¡
                                         nejd©¡ve zkr t¡ na nulovou d‚lku)
    proces >> specifikace_souboru      - v˜stup na displej bude p©ipojen do
                                         souboru  (na  jeho  konec,  soubor
                                         nebude zkracov n)
    proces1 | proces2                  - 1.- vyvol   proces  1,  v˜stup  na
                                             obrazovku   jde  do  do‡asn‚ho
                                             souboru
                                         2.- vyvol    proces   2,  vstup  z
                                             kl vesnice   jde  z  do‡asn‚ho
                                             souboru
                                         3.- zru¨¡ do‡asn˜ soubor

    Pozn.: Symbol "|" lze pou‘¡t v¡cen sobnˆ:
           DIR | SORT | FIND /v "i" > soubor.txt

           Do‡asn˜  soubor  bude m¡t jedine‡n‚ jm‚no sestaven‚ z HEX ‡¡slic
           sou‡asn‚ho  data  a  ‡asu.  Vytv ©¡ se v‘dy v aktu ln¡m adres ©i
           aktu ln¡ho disku.

    P©¡klad - pou‘it¡ p©esmˆ©ov n¡ v povelu ECHO:

         ECHO ^L > PRN       (provede odstr nkov n¡ tisk rny)
         ECHO y|DEL *.*      (odpov¡ "yes" na ot zku "Are you sure?)
         ECHO ATDT 1(213)555-1234 >AUX (vyvol  telefonn¡ ‡¡slo)

    P©esmˆ©ov n¡   v˜stupu  na  za©¡zen¡  NUL  odstran¡  nˆkter   syst‚mov 
hl ¨en¡: COPY *.COM D: >NUL (odstran¡ hl ¨en¡ "1 File(s) copied").

    COMMAND.COM  bude  ignorovat  symbol  p©esmˆ©ov n¡, pokud je uzav©en do
z vorek:
         REM Pou‘¡v m znak ">" na tomto © dku.






                  ÿRÿoÿzÿdÿˆÿlÿeÿnÿ¡  ÿdÿiÿsÿkÿu  ÿDÿOÿS


    Rozdˆlen¡  disku  DOS se vztahuje k blokov‚mu za©¡zen¡, na kter‚ se DOS
odkazuje  pomoc¡  absolutn¡ch  sektor–  (tj.  sektory  s  ‡¡slem od 0 a‘ do
maxim ln¡  kapacity  disku,  obvykl  d‚lka sektoru je 512 bajt–). Absolutn¡
sektory  v¨ak  nemus¡ v‘dy odpov¡dat fyzick˜m sektor–m na disku. Pevn˜ disk
m–‘e b˜t rozdˆlen na tzv. odd¡ly (partition) a ka‘d˜ z odd¡l– se chov  jako
samostatn˜ disk. Podrobnˆji viz kapitolu "Tabulka odd¡l– disku".

    V  prvn¡m  sektoru disku jsou um¡stˆny informace o disku pro modul BIOS
(fyzick˜  form t  disku  - po‡et sektor– na stopu, d‚lka sektoru, po‡ te‡n¡
sektor  datov‚  oblasti)  a pro DOS (po‡et sektor– celkem, po‡et sektor– na
aloka‡n¡  blok,  po‡et  polo‘ek  adres ©e,  po‡ te‡n¡ sektor datov‚ oblasti
atd.).

    Dal¨¡ prostor disku je rozdˆlen podle n sleduj¡c¡ tabulky:

    - rezervovan  oblast (zav dˆc¡ sektor)
    - prvn¡ kopie tabulky p©idˆlen¡ blok– soubor–m (FAT)
    - druh  kopie tabulky p©idˆlen¡ blok– soubor–m (FAT)
    - p©¡davn‚ kopie tabulky p©idˆlen¡ blok– soubor–m (FAT) (nepovinn‚)
    - z kladn¡ (ko©enn˜) adres © disku
    - datov  oblast soubor– (sest v  z jednotliv˜ch aloka‡n¡ch blok–)

    Prostor pro soubor v datov‚ oblasti nen¡ p©idˆlen spojitˆ. P©idˆluje se
soubor–m  p©i jejich ukl d n¡ pr–bˆ‘nˆ po aloka‡n¡ch bloc¡ch. Aloka‡n¡ blok
je  ‡ st  disku,  p©edstavuje  skupinu  ur‡it‚ho  po‡tu sektor– jdouc¡ch za
sebou.  T¡mto zp–sobem je logick  posloupnost sektor– na disku rozdˆlena na
kr tk‚  £seky,  kter‚  mohou  b˜t p©idˆlov ny soubor–m. Takto vznikaj¡ sice
nevyu‘it   m¡sta  vznikl   p©i ne£pln‚m zaplnˆn¡ aloka‡n¡ho bloku souborem,
av¨ak umo‘¤uje to rychl‚ operace se soubory.

    V  adres ©i  disku  jsou adres ©ov‚ polo‘ky jednotliv˜ch soubor–. Ka‘d 
polo‘ka obsahuje ve¨ker‚ informace o p©¡slu¨n‚m souboru. Obsahuje t‚‘ ‡¡slo
prvn¡ho  aloka‡n¡ho  bloku,  kter˜ je souboru p©idˆlen. Informace o dal¨¡ch
aloka‡n¡ch  bloc¡ch  se  z¡skaj¡  z tabulky p©idˆlen¡ blok– soubor–m (FAT -
File  Allokation  Tabelle).  Tabulka  FAT  je rozdˆlena do polo‘ek, jejich‘
po‡et  odpov¡d   po‡tu  aloka‡n¡ch  blok–  na disku. Ka‘d  polo‘ka odpov¡d 
jednomu  bloku  na  disku  a  obsahuje  informaci,  kter˜ blok n sleduje za
blokem,  ke  kter‚mu  polo‘ka  n le‘¡.  T¡m se vytv ©¡ z©etˆzen¡ aloka‡n¡ch
blok– pro p©¡slu¨n˜ soubor. P©i p©¡stupu k souboru se p©e‡te nejd©¡ve ‡¡slo
prvn¡ho aloka‡n¡ho bloku (z adres ©ov‚ polo‘ky). Pro tento aloka‡n¡ blok se
nalezne  v  p©¡slu¨n‚  polo‘ce  tabulky  FAT ‡¡slo n sleduj¡c¡ho aloka‡n¡ho
bloku a tak se postupuje tak dlouho, a‘ se naraz¡ na koncovou zna‡ku (‡¡slo
aloka‡n¡ho bloku vˆt¨¡ ne‘ (F)FF8H). Polo‘ka tabulky FAT m–‘e b˜t 12-bitov 
nebo  16-bitov .  Obvykle se na disku uchov vaj¡ z lo‘n¡ kopie FAT. Kdy‘ se
na  disku  objev¡  ¨patn˜  sektor uprost©ed prvn¡ FAT, m–‘e se pou‘¡t druh 
kopie. T¡m se vyhneme ztr t v d–sledku nepou‘iteln‚ho disku.




                 ÿTÿaÿbÿuÿlÿkÿa  ÿoÿdÿdÿ¡ÿlÿ–  ÿdÿiÿsÿkÿu


    U  pevn‚ho disku neodpov¡d  absolutn¡ sektor, na kter˜ se odkazuje DOS,
p©¡mo  po©ad¡ fyzick‚ho sektoru na disku. Disk m–‘e b˜t rozdˆlen na nˆkolik
odd¡l–  (partition) a t¡m v podstatˆ na nˆkolik disk–, na kter‚ se DOS m–‘e
odkazovat.

    Fyzicky prvn¡ sektor na pevn‚m disku obsahuje "Hlavn¡ zav dˆc¡ sektor",
kter˜  se p©i zav dˆn¡ opera‡n¡ho syst‚mu zavede do pamˆti a tam se spust¡.
Konec  tohoto  sektoru obsahuje tabulku odd¡l– disku (rozdˆlen¡ disku) - je
to  tabulka  o 4 polo‘k ch, ka‘d  polo‘ka je 16 bajt– dlouh  a m–‘e ur‡ovat
jeden  logick˜  disk. S touto tabulkou je mo‘n‚ manipulovat pomoc¡ programu
FDISK (standardn¡ program opera‡n¡ho syst‚mu DOS).

    P©i  zav dˆn¡  opera‡n¡ho  syst‚mu  zavede  ROM-BIOS  do  pamˆti hlavn¡
zav dˆc¡  sektor  pevn‚ho  disku  a  p©ed   na  jeho adresu ©¡zen¡. Program
zav dˆc¡ho  sektoru  nejd©¡ve  na‡te tabulku odd¡l– disku a pomoc¡ n¡ ur‡¡,
kter˜  odd¡l  disku  je  ozna‡en  jako aktivn¡. Z tohoto odd¡lu potom na‡te
spr vn˜ zav dˆc¡ sektor do pamˆti a p©ed  tomuto sektoru ©¡zen¡.

    Struktura hlavn¡ho zav dˆc¡ho sektoru:
ÉÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º   offset   ³  velikost  ³                     obsah                     º
ÌÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 000H (  0) ³ 1BEH (446) ³ k¢d programu, kter˜ zavede a spust¡ zav dˆc¡  º
º            ³            ³ sektor z aktivn¡ho odd¡lu disku               º
º 1BEH (446) ³  10H ( 16) ³ polo‘ka odd¡lu 1                              º
º 1CEH (462) ³  10H ( 16) ³ polo‘ka odd¡lu 2                              º
º 1DEH (478) ³  10H ( 16) ³ polo‘ka odd¡lu 3                              º
º 1EEH (494) ³  10H ( 16) ³ polo‘ka odd¡lu 4                              º
º 1FEH (510) ³  02H (  2) ³ ozna‡en¡ tabulky odd¡l– disku (AA55H)         º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Struktura polo‘ky jednoho odd¡lu:
ÉÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º   offset   ³  velikost  ³                     obsah                     º
ÌÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º  00H ( 0)  ³     1      ³ zav dˆc¡ p©¡znak: 0=neaktivn¡, 80H=aktivn¡    º
º  01H ( 1)  ³     1      ³ za‡ tek odd¡lu - ‡¡slo hlavy                  º
º  02H ( 2)  ³     2      ³ za‡ tek odd¡lu - sektor a v lec zav d. sektoruº
º  04H ( 4)  ³     1      ³ k¢d syst‚mu: 0=nezn m˜, 1=FAT 12b, 4=FAT 16b  º
º  05H ( 5)  ³     1      ³ konec odd¡lu - ‡¡slo hlavy                    º
º  06H ( 6)  ³     2      ³ konec odd¡lu - sektor a v lec posledn¡ho sekt.º
º  08H ( 8)  ³     4      ³ ‡¡slo po‡ te‡n¡ho relativn¡ho sektoru         º
º  0CH (12)  ³     4      ³ velikost (celkov˜ po‡et sektor–)              º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Polo‘ka  sektoru  a  v lce  specifikuje  sv‚ hodnoty tak, ‘e nejni‘¨¡ch
6úbit–  ud v  ‡¡slo sektoru a vy¨¨¡ch 10 bit– ud v  ‡¡slo v lce. Tento £daj
je  tedy  v  takov‚m  tvaru,  kter˜  t‚‘ odpov¡d  nastaven¡ registru CX p©i
vol n¡ obsluhy INTú13H (obsluha disku). Pokud chcete nap©. ‡¡st prvn¡ odd¡l
z  disku,  mus¡te  nejd©¡ve  p©e‡¡st hlavn¡ zav dˆc¡ sektor (adresa sektoru
CX=0)  do  bufferu 'buffer'. Potom instrukc¡ MOVúCX,buffer[01c0h] nastav¡te
hodnotu  registru  CX  pro  p©eru¨en¡  INT 13H, pomoc¡ kter‚ho m–‘ete takto
p©e‡¡st zav dˆc¡ sektor disku #1.

    Relativn¡   sektor  na  offsetu  08H  ka‘d‚  polo‘ky  odd¡lu  disku  je
ekvivalentn¡  hlavˆ,  sektoru  a  v lci  po‡ te‡n¡ adresy odd¡lu. Relativn¡
sektor  0  je  ekvivalentn¡  sektoru  1 na v lci 0 a povrchu v lce ‡¡slo 0.
€¡slo  relativn¡ho  sektoru  se inkrementuje nejd©¡ve p©i ka‘d‚m sektoru na
stopˆ,  potom  p©i  ka‘d‚  hlavˆ  (resp. povrchu disku) a nakonec p©i ka‘d‚
stopˆ  (nezapome¤te,  ‘e  po‡et  hlav  - povrch– - disku m–‘e b˜t u r–zn˜ch
disk– velmi rozmanit˜). K v˜po‡tu pou‘ijte tento vztah:

        ( ‡¡slo_v lce * po‡et_sektor–_na_stopu * po‡et_hlav )
     +  ( ‡¡slo_hlavy * po‡et_sektor–_na_stopu )
     +  ( ‡¡slo_sektoru - 1 )
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     =  ‡¡slo_relativn¡ho_sektoru

    Jednotliv‚  odd¡ly  za‡¡naj¡  v‘dy  na  sud‚m ‡¡sle v lce kromˆ prvn¡ho
odd¡lu,  kter˜  m–‘e  za‡¡nat  na  v lci 0, hlavˆ 0, sektoru 2 (sektor 1 je
obsazen hlavn¡m zav dˆc¡m sektorem).

    Kdy‘  zav dˆc¡  sektor  odd¡lu  p©ej¡m   ©¡zen¡, ukazuje registrov˜ p r
DS:SI na polo‘ku tohoto odd¡lu v tabulce odd¡l– disku.




                ÿZÿaÿvÿ ÿdÿˆÿcÿ¡  ÿsÿeÿkÿtÿoÿr  ÿdÿiÿsÿkÿu

    Zav dˆc¡  sektor  disku  je  v‘dy  prvn¡m sektorem na disku a to jak na
disku  DOS  (tj. nap©. jednotliv‚ odd¡ly na pevn‚m disku), tak i jako prvn¡
fyzick˜  sektor  na pevn‚m disku (ozna‡uje se jako hlavn¡ zav dˆc¡ sektor).
Zav dˆc¡  sektor  disku  obsahuje  z kladn¡  informace  o  disku,  jako  je
rozdˆlen¡  disku,  velikosti  tabulek  FAT  a  z kladn¡ho  adres ©e, a tak‚
informaci o fyzick‚m form tu diskety (tj. kolik je sektor– na stopu) - tato
informace  se  ov¨em net˜k  stopy 0 na povrchu 0 disku, neboŸ tato stopa je
naform tov na v‘dy standardn¡m form tem (li¨¡ se pouze podle typu p©ipojen‚
disketov‚ mechaniky).

    Struktura zav dˆc¡ho sektoru:
ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º  offset  ³ velikost ³                     obsah                         º
ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 00H ( 0) ³    3     ³ instrukce skoku na za‡ tek programu zavadˆ‡e      º
º 03H ( 3) ³    8     ³ identifika‡n¡ jm‚no a verze (nap©. "IBM  3.2")    º
º 0BH (11) ³    2     ³ po‡et bajt– na sektor                             º
º 0DH (13) ³    1     ³ po‡et sektor– na aloka‡n¡ blok                    º
º 0EH (14) ³    2     ³ po‡et rezervovan˜ch sektor– (sektory p©ed FAT)    º
º 10H (16) ³    1     ³ po‡et tabulek FAT                                 º
º 11H (17) ³    2     ³ po‡et polo‘ek z kladn¡ho (ko©enn‚ho) adres ©e     º
º 13H (19) ³    2     ³ celkov˜ po‡et sektor– na m‚diu (resp. odd¡lu DOS) º
º 15H (21) ³    1     ³ popisova‡ m‚dia (stejn  hodnota jako 1. bajt FAT) º
º 16H (22) ³    2     ³ po‡et sektor– jedn‚ tabulky FAT                   º
º 18H (24) ³    2     ³ po‡et sektor– na stopu                            º
º 1AH (26) ³    2     ³ po‡et ‡tec¡ch/z pisov˜ch hlav (= povrch– disku)   º
º 1CH (28) ³    2     ³ po‡et skryt˜ch sektor–                            º
ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Polo‘ky  t‚to  struktury  od  polo‘ky  na  offsetu  0BH (po‡et bajt– na
sektor)  a‘  po  polo‘ku  na  offsetu 16H (po‡et sektor– jedn‚ tabulky FAT)
odpov¡daj¡  tabulce  blok–  parametr–  BIOS  (BPB),  kterou  vytv ©¡ driver
za©¡zen¡  p©i  povelu  vystavˆn¡  tabulky  BPB (viz kapitola Instalovateln‚
drivery za©¡zen¡).

    Na  offsetu  1EH  za‡¡n   nestandardn¡ ‡ st, kterou pou‘¡v  program pro
zav dˆn¡  opera‡n¡ho  syst‚mu.  Podrobnosti  o tomto programu viz p©eru¨en¡
INTú19H (zav dˆn¡ opera‡n¡ho syst‚mu).

    Popisova‡  m‚dia  je  1-bajtov˜  k¢d,  kter˜  m–‘e b˜t (nˆkdy) pou‘it k
identifikaci  typu  m‚dia,  kter‚ je pou‘ito v diskov‚m za©¡zen¡. Popisova‡
m‚dia (‡asto t‚‘ naz˜van˜ FAT ID = identifik tor FAT) m–‘ete tak‚ spat©it:

         - jako hodnotu obdr‘enou funkcemi DOS 1CH a 32H
         - jako prvn¡ bajt tabulky FAT (obvykle sektor DOS s ‡¡slem 1)
         - jako offset 0AH v tabulce bloku parametr– BIOS BPB
         - v datov‚m bloku pou‘it‚m funkc¡ DOS 44H/podslu‘ba 0DH
 
ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º  hodnota ³         typ m‚dia - definov no jako v DOS 3.2                º
ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º   F8H    ³  pevn˜ disk                                                  º
º   F9H    ³  disketa 5 1/4" HD, 2 strany, 15 sektor– na stopu            º
º   FCH    ³  disketa 5 1/4" DD, 1 strana, 9 sektor– na stopu             º
º   FDH    ³  disketa 5 1/4" DD, 2 strany, 9 sektor– na stopu             º
º          ³  disketa 8" (form t IBM 3740) SD, 2 strany, 26 sekt./stopu   º
º   FEH    ³  disketa 5 1/4" DD, 1 strana, 8 sektor– na stopu             º
º          ³  disketa 8" (form t IBM 3740) SD, 1 strana, 26 sekt./stopu   º
º          ³  disketa 8" DD, 2 strany, 26 sekt./stopu                     º
º   FFH    ³  disketa 5 1/4" DD, 2 strany, 8 sektor– na stopu             º
ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=2 strany; 0=nejsou 2 strany
                   ³ ÀÄÄÄ> 1: 1=8 sektor–; 0=nen¡ 8 sektor–
         1 1 1 1 1 ÀÄÄÄÄÄ> 2: 1=vyj¡mateln˜; 0=nen¡ vyj¡mateln˜

    Jak  vid¡te,  popisova‡  m‚dia neposkytuje p©¡li¨ spolehliv‚ informace,
proto  je  l‚pe  jej  p©¡li¨  nepou‘¡vat.  Nap©.  zav dˆc¡ sektor RAM-disku
(VDISK.SYS)  obsahuje  popisova‡  m‚dia indikuj¡c¡, ‘e jde o disketu 360úKB
(bez  ohledu na velikost RAM-disku). Tak‘e, popisova‡ m‚dia 0f8H se pou‘¡v 
pro v¨echny pevn‚ disky, a to je asi tak jedin˜ bod, kter˜ lze pou‘¡t.






         ÿAÿlÿoÿkÿaÿ‡ÿnÿ¡  ÿtÿaÿbÿuÿlÿkÿa  ÿsÿoÿuÿbÿoÿrÿ–  ÿFÿAÿT

    Aloka‡n¡  tabulka  soubor–  (FAT)  je  um¡stˆna  na  za‡ tku  disku  za
zav dˆc¡m  sektorem  a  p©ed  z kladn¡m  adres ©em  disku.  DOS pou‘¡v  FAT
kúur‡en¡  fyzick‚  polohy  dat  souboru  na  disku a k ur‡en¡ voln‚ho m¡sta
kúulo‘en¡  nov˜ch  soubor–.  Ka‘d‚mu  aloka‡n¡mu  bloku na disku odpov¡d  v
tabulce  FAT jedna polo‘ka. Slovo s offsetem 1AH v ka‘d‚ adres ©ov‚ polo‘ce
ud v   ‡¡slo prvn¡ho aloka‡n¡ho bloku, kter˜ p©¡slu¨¡ dan‚mu souboru. Pokud
se pod¡v te na polo‘ku v tabulce FAT, kter  odpov¡d  tomuto bloku, zjist¡te
buƒ  ‡¡slo  n sleduj¡c¡ho bloku nebo zna‡ku ur‡uj¡c¡ konec souboru (tedy ‘e
tento  blok byl posledn¡). D‚lka jedn‚ polo‘ky v tabulce FAT m  obvykle buƒ
12  bit–  nebo  16  bit–  (tj.  jedno  slovo).  Zn zornˆme  si jako p©¡klad
p©idˆlen¡ blok– souboru s polo‘kami FAT po 8 bitech:

Polo‘ka adres ©e:
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 A B C D E F
   ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
   ³S O U B O R    ³T X T³a³                   ³   ³   ³0 8³       ³
   ÃÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÅÄÁÄÁÄÅÄÅÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÅÄÁÄÅÄÁÄÅÄÁÄÅÄÁÄÁÄÁÄ´
   ³ jm‚no souboru ³ typ ³ ³    rezervov no    ³‡as³dat³ ³ ³velikost
                       atribut                           ³
                                                         ³po‡ te‡n¡
                             ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙaloka‡n¡ blok
                             ³
    00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14 15 16
   ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿
   ³ID³FF³FF³04>05>FF³00³00³09>0A>0B>12³0D>0E>0F>11³0C³FF³14³F7³15>FF³00³
   ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄ³ÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄ³ÁÄÄÁÄÄÁÄÄÁÄÄÙ
                                      ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>ÄÄÄÄÄÙÀÄÄÄÄÙ
    Tento p©¡klad zn zor¤uje n sleduj¡c¡ informace:
    - Soubor  SOUBOR.TXT  je dlouh˜ 7 aloka‡n¡ch blok–. Prvn¡ aloka‡n¡ blok
      m  ‡¡slo 08H, za n¡m n sleduj¡ aloka‡n¡ bloky 09H, 0AH, 0BH, 12H, 14H
      a 15H, aloka‡n¡ blok 15H je ozna‡en jako posledn¡.

    - Aloka‡n¡  blok  (cluster)  13H  je ozna‡en jako vadn˜ a nen¡ sou‡ st¡
      aloka‡n¡ho prostoru.

    - Bloky 06H, 07H a 16H jsou pr zdn‚ a jsou voln‚ pro dal¨¡ p©idˆlen¡.

    - Jsou  zde  je¨tˆ  dva  soubory, prvn¡ za‡¡n  na aloka‡n¡m bloku 02H a
      obsahuje  d le  bloky  03H  a‘  05H. Druh˜ soubor za‡¡n  na aloka‡n¡m
      bloku  10H  a  obsahuje  d le  bloky  0CH,  0DH,  0EH,  0FH a 11H. Ke
      zji¨tˆn¡,   kter˜m   soubor–m  tyto  bloky  pat©¡,  je  nutn‚  nal‚zt
      adres ©ov‚ polo‘ky s ‡¡sly po‡ te‡n¡ch aloka‡n¡ch blok– 03H a 10H.


Um¡stˆn¡ FAT na disku:

    FAT  norm lnˆ za‡¡n  na logick‚m sektoru 1 v oddˆlen¡ DOS (partition na
pevn‚m disku), tj. m–‘ete jej ‡¡st pomoc¡ p©eru¨en¡ INT 25H s DX=1. Jedinou
cestou,  jak  se  o  tom  p©esvˆd‡it,  je  p©e‡¡st zav dˆc¡ sektor (DX=0) a
zkontrolovat  slovo  na  offsetu  0EH.  Toto slovo ©¡k , kolik zav dˆc¡ch a
rezervovan˜ch sektor– je p©ed tabulkou FAT. Pou‘ijte toto ‡¡slo (obvykle=1)
v registru DX ke ‡ten¡ tabulky FAT pomoc¡ INT 25H.

    Na  disku m–‘e b˜t i v¡ce ne‘ jedna kopie tabulky FAT. Jsou obvykl‚ dvˆ
kompletn¡ kopie (dvˆ stejn‚ tabulky FAT). Pokud jsou tabulky dvˆ nebo v¡ce,
budou v¨echny sousedit (druh  tabulka FAT n sleduje ihned za prvn¡).

    K z¡sk n¡ informac¡ o FAT m–‘ete pou‘¡t n sleduj¡c¡ slu‘by:

         - Pou‘ijte INT 25H k p©e‡ten¡ zav dˆc¡ho sektoru.
         - Pou‘ijte  funkci  DOS  36H  nebo  1CH  k  ur‡en¡ celkov‚ho po‡tu
           sektor– nebo aloka‡n¡ch blok– na disku.
         - Pou‘ijte   funkci  DOS  44H  (pokud  driver  za©¡zen¡  podporuje
           generov n¡ IOCTL) v DOS ò 3.2
         - Pou‘ijte  funkci  DOS  32H  k z¡sk n¡ v¨ech mo‘n˜ch pou‘iteln˜ch
           informac¡.

    Pozn.: Zav dˆc¡  sektor  disku ne-zav dˆc¡ho disku (jako s¡Ÿov  blokov 
           za©¡zen¡ a star¨¡ pevn‚ disky) m–‘e obsahovat pouze nesmysly.


Pou‘it¡ 12-bitov‚/16-bitov‚ tabulky FAT:

    Tabulka  FAT  m–‘e b˜t nadefinov na pomoc¡ 12-bitov˜ch nebo 16-bitov˜ch
polo‘ek. 12-bitov‚ polo‘ky jsou velmi efektivn¡ pro m‚dia s kapacitou men¨¡
ne‘  384 KB - polo‘ka FAT m–‘e ur‡ovat jednoduch˜ 512-bajtov˜ sektor disku.
Pro  del¨¡  m‚dia  mus¡  ka‘d  polo‘ka FAT adresovat del¨¡ a del¨¡ aloka‡n¡
bloky  (neboŸ maxim ln¡ po‡et aloka‡n¡ch blok– je omezen hodnotou 212=4096)
a‘  k  bodu,  kdy  by  pevn˜  disk  20M p©i pou‘it¡ 12-bitov˜ch polo‘ek FAT
vy‘adoval  aloka‡n¡ bloky dlouh‚ 16 sektor– (jin˜mi slovy, 1-bajtov˜ soubor
by zabral na disku prostor 8 KB).

    16-bitov‚  polo‘ky  FAT  byly  zavedeny  v  DOS  3.0 z d–vodu efektivn¡
obsluhy pevn‚ho disku AT 20 MB. Av¨ak disketov‚ jednotky a pevn˜ disk 10 MB
i  nad le  pou‘¡vaj¡  12-bitov‚ polo‘ky FAT. Zda se pou‘¡v  FAT s polo‘kami
12úbit– nebo 16úbit– m–‘ete ur‡it t¡mto postupem:

    DOS 3.0 ©¡k : Pokud  m   disk  v¡ce  ne‘ 4086 (0ff6H) blok–, pou‘ije se
                  16-bitov   tabulka  FAT  (4096  je  maxim ln¡ hodnota pro
                  12-bitov‚ ‡¡slo, hodnoty nad 0ff6H jsou rezervov ny).

    DOS 3.2 ©¡k : Pokud  m  disk v¡ce ne‘ 20740 (5104H) sektor–, pou‘ije se
                  16-bitov   tabulka  FAT  (tedy jak˜koliv disk s kapacitou
                  nad 10 MB pou‘¡v  16-bitovou tabulku FAT).

    Je  v¨eobecnˆ  myln˜m  n zorem, ‘e 16-bitov  tabulka FAT neumo‘¤uje DOS
pracovat  s  disky  vˆt¨¡mi  ne‘ 32 Megabajt–. Ve skute‡nosti je omezuj¡c¡m
faktorem  kapacity  disku  to,  ‘e  p©eru¨en¡  INT  25H/26H  (‡ten¡ a z pis
absolutn¡ho sektoru na disk pro DOS) nen¡ schopn‚ adresovat SEKTOR s vy¨¨¡m
‡¡slem  ne‘ 65535, neboŸ adresa sektoru se p©ed v  v 16-bitov‚m registru DX
(a  216=65536). A proto‘e sektory maj¡ norm lnˆ velikost 512 bajt–, vypl˜v 
z  toho  omezen¡  disku  na 32 MB. Nic v¨ak ne©¡k , ‘e nem–‘ete m¡t sektory
del¨¡  ne‘  512  bajt–,  tak‘e DOS by potom teoreticky mohl obsluhovat disk
sújakoukoliv kapacitou.


€ten¡ a z pis do tabulky FAT:

    Ke  ‡ten¡  hodnoty  z  polo‘ky  FAT (nap©. p©i zmˆn ch ve FAT) nejd©¡ve
p©e‡tˆte  po‘adovanou  tabulku  FAT  do  pamˆti a z adres ©e zjistˆte ‡¡slo
po‡ te‡n¡ho  bloku (tj. t‚‘ ‡¡slo polo‘ky v tabulce FAT). Pozor - dbejte na
to,  ‘e 12-bitov‚ polo‘ky mohou le‘et na p©elomu sektor– (nen¡ vhodn‚ proto
pou‘¡vat  bufferov n¡  pouze  jednoho  sektoru  FAT).  Operace s 16-bitovou
polo‘kou  je  jednoduch   -  ka‘d‚  slovo  v  tabulce obsahuje jednu adresu
aloka‡n¡ho  bloku (a t¡m i offset slova n sleduj¡c¡ polo‘ky v tabulce FAT).
Pro 12-bitov‚ polo‘ky pou‘ijte n sleduj¡c¡ podprogramy:

readfat12:                        ; p©e‡ten¡ obsahu polo‘ky FAT 12b
                                  ; ES:0000 - adresa bufferu s tabulkou FAT
                                  ; AX - ‡¡slo po‘adovan‚ho aloka‡. bloku
         push      bx
         push      cx
         push      dx
         mov       cx,ax          ; £schova ‡¡sla po‘adovan‚ho alok. bloku
         mov       bx,0003
         mul       bx             ; vyn soben¡ ‡¡sla bloku 3*
         mov       bx,0002
         div       bx             ; vydˆlen¡ n sobku /2 (tedy blok * 1.5)
         mov       bx,ax          ; offset polo‘ky ve FAT
         mov       ax,es:[bx]     ; p©e‡ten¡ slova z FAT z vypo‡ten‚ adresy
         test      cx,1           ; rozli¨en¡, zda jde o lich˜/sud˜ blok
         jz        rdf12su        ; je sud˜  blok
         mov       cl,4           ; je lich˜ blok
         shr       ax,cl          ; rotace slova o 4 bity vpravo
rdf12su: and       ax,0fffh       ; AX = v˜sledn˜ obsah polo‘ky FAT 12b
         pop       dx
         pop       cx
         pop       bx
         ret

writefat12:                       ; nastaven¡ obsahu polo‘ky FAT 12b
                                  ; ES:0000 - adresa bufferu s tabulkou FAT
                                  ; AX - ‡¡slo po‘adovan‚ho aloka‡. bloku
                                  ; DI - nov  hodnota polo‘ky FAT
         push      ax
         pop       bx
         push      cx
         push      dx
         push      di
         mov       cx,ax          ; £schova ‡¡sla po‘adovan‚ho alok. bloku
         mov       bx,0003
         mul       bx             ; vyn soben¡ ‡¡sla bloku 3*
         mov       bx,0002
         div       bx             ; vydˆlen¡ n sobku /2 (tedy blok * 1.5)
         mov       bx,ax          ; offset polo‘ky ve FAT
         mov       ax,es:[bx]     ; p©e‡ten¡ star‚ hodnoty slova z FAT
         test      cx,1           ; rozli¨en¡, zda jde o lich˜/sud˜ blok
         jz        wrf12su        ; je sud˜ blok
         and       ax,0fh         ; zbytek p©ede¨l‚ polo‘ky
         mov       cl,4
         shl       di,cl          ; rotace slova o 4 bity vlevo
wrf12ko: or        ax,di          ; slou‡en¡ s druhou polo‘kou
         mov       es:[bx],ax     ; ulo‘en¡ nov‚ hodnoty
         pop       di
         pop       dx
         pop       cx
         pop       bx
         pop       ax
         ret
wrf12su: and       ax,0f000h      ; zbytek n sleduj¡c¡ polo‘ky
         jmp       wrf12ko        ; ulo‘en¡ nov‚ hodnoty


Obsah polo‘ek tabulky FAT:

    Prvn¡ bajt FAT se naz˜v  "popisova‡ m‚dia" (nebo t‚‘ identifika‡n¡ bajt
FAT - viz kapitolu Zav dˆc¡ sektor disku). N sleduj¡c¡ch 5 bajt– (12-bitov 
FTA)  nebo  7  bajt– (16-bitov  FAT) jsou nastaveny na 0FFH. Zbytek tabulky
FAT   je  slo‘en  z  12-bitov˜ch  nebo  16-bitov˜ch  bunˆk,  ka‘d   z  nich
reprezentuje  jeden aloka‡n¡ blok disku. Tyto bu¤ky mohou obsahovat jednu z
n sleduj¡c¡ch hodnot:

         - (0)000H .................. voln˜ aloka‡n¡ blok
         - (F)FF0H a‘ (F)FF7H ....... rezervovan‚ aloka‡n¡ bloky
         - (F)FF7H .................. vadn˜ blok (obsahuje vadn˜ sektor)
         - (F)FF8H a‘ (F)FFFH ....... konec aloka‡n¡ho ©etˆzce souboru
         - (0)002H a‘ (F)FEFH ....... ‡¡slo bloku n sleduj¡c¡ v ©etˆzci

         Pozn.: Nejvy¨¨¡  tetr da  hodnot  se  pou‘¡v  pouze pro 16-bitovou
                tabulku  FAT; tzn. ‘e vadn˜ sektor se v 12-bitvo‚ FAT zna‡¡
                0FF7H a v 16-bitov‚ FAT FFF7H.


P©evod ‡¡sla aloka‡n¡ho bloku na ‡¡slo sektoru:

    Pokud  z¡sk te  z adres ©ov‚ polo‘ky ‡¡slo po‡ te‡n¡ho aloka‡n¡ho bloku
souboru,  budete  mo‘n   cht¡t  ur‡it  lokalizaci aktu ln¡ho sektoru disku,
kter˜  obsahuje data souboru (nebo podadres ©e). Mus¡te p©itom uva‘ovat, ‘e
po‡ te‡n¡  sektor  datov‚  oblasti  disku m–‘e b˜t r–zn˜. Nap©. pro disketu
(nebo oddˆlen¡ DOS pevn‚ho disku) m  disk n sleduj¡c¡ strukturu:

         - zav dˆc¡ a rezervovan‚ sektory
         - tabulka FAT ‡¡slo 1
         - tabulka FAT ‡¡slo 2 (voliteln  - nepou‘¡v  se u RAM disk–)
         - z kladn¡ (ko©enn˜) adres ©
         - datov˜ prostor (obsahuje v¨echny soubory a podadres ©e)

    Ka‘d   sekce  t‚to struktury m–‘e m¡t r–znou d‚lku a mus¡ b˜t proto pro
spr vnou  koverzi  ‡¡sla  bloku  na ‡¡slo sektoru zn ma. N sleduj¡c¡ vztahy
reprezentuj¡ jedinou dokumentovanou metodu k ur‡en¡ ‡¡sla logick‚ho sektoru
DOS z ‡¡sla aloka‡n¡ho bloku.

Sektor–_tabulek_FAT    = Tabulek_FAT * Sektor–_tabulky_FAT

Sektor–_z kl._adres ©e = (Polo‘ek_adres ©e * 32) / Bajt–_na_sektor

Za‡ tek_dat            = Rezervovan˜ch_sektor– + Sektor–_tabulek_FAT +
                         + Sektor–_z kl.adres ©e


Logick˜_sektor = Za‡ tek_dat + ((Po‡ te‡n¡_blok - 2) * Sektor–_na_blok


    V¨echny  pot©ebn‚ polo‘ky pro v˜po‡et z¡sk te buƒ ze zav dˆc¡ho sektoru
disku  (logick˜  sektor  0)  nebo z bloku parametr– BIOS (pokud m te k nˆmu
p©¡stup pomoc¡ funkce DOS 44h - IOCTL).

    Pokud  pat©¡te mezi odv ‘n˜ typ lid¡, m–‘ete si usnadnit pr ci pou‘it¡m
nedokumentovan‚  funkce  DOS  32H  (poskytnut¡  informac¡  o  disku), kter 
prov d¡  shrnut¡  v¨ech  informac¡,  je‘  byly  ji‘ jednou p©ed-vypo‡¡t ny,
v‡etnˆ ‡¡sla sektoru za‡ tku datov‚ oblasti.

    Pozn.: Vhodn‚  pou‘it¡  tˆchto  informac¡  je nap©. k vytvo©en¡ vlastn¡
           obsluhy   pro   vyhled v n¡   adres ©e  na  disku  pro  programy
           prov dˆj¡c¡  v˜pis  v¨ech  soubor–  a  adres ©–  na disku, neboŸ
           vyhled v n¡  s  p©¡m˜m  p©¡stupem  na  sektory  adres ©– pracuje
           zhruba dvakr t tak rychleji ne‘ standardn¡ slu‘ba DOS.





                   ÿAÿdÿrÿeÿsÿ ÿ©ÿoÿvÿ   ÿpÿoÿlÿoÿ‘ÿkÿa

    Adres ©  obsahuje  jednu adres ©ovou polo‘ku pro ka‘d˜ soubor na disku.
Ka‘d  polo‘ka m  d‚lku 32 bajt–.

      Struktura adres ©ov‚ polo‘ky:
      ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
      º  offset  ³ d‚lka ³         n zev                             º
      ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
      º 00H ( 0) ³   8   ³ jm‚no souboru                             º
      º 08H ( 8) ³   3   ³ roz¨¡©en¡ jm‚na souboru                   º
      º 0BH (11) ³   1   ³ atributy souboru                          º
      º 0CH (12) ³  10   ³ rezervov no                               º
      º 16H (22) ³   2   ³ ‡as posledn¡ho z pisu                     º
      º 18H (24) ³   2   ³ datum posledn¡ho z pisu                   º
      º 1AH (26) ³   2   ³ po‡ te‡n¡ aloka‡n¡ blok dat souboru       º
      º 1CH (28) ³   4   ³ velikost souboru                          º
      ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    - Jm‚no souboru je 8 znak– ASCII. Pokud je jm‚no krat¨¡ ne‘ 8 znak–, je
      doplnˆno  zprava  mezerami. DOS pou‘¡v  prvn¡ bajt t‚to polo‘ky je¨tˆ
      pro dva zvl ¨tn¡ k¢dy:

         00H (0)   - konec p©idˆlen‚ pamˆti adres ©e (tato polo‘ka adres ©e
                     nebyla dosud je¨tˆ nikdy pou‘ita)
         E5H (229) - voln   adres ©ov   polo‘ka (soubor specifikovan˜ touto
                     polo‘kou  adres ©e  byl  zru¨en  a pokud jeho aloka‡n¡
                     bloky  nebyly pou‘ity jin˜m souborem, lze tento soubor
                     je¨tˆ  obnovit  -  m¡sto  bajtu E5H se navr t¡ p–vodn¡
                     prvn¡ znak jm‚na souboru).

    - Roz¨¡©en¡  jm‚na souboru jsou 3 znaky ASCII. Pokud je roz¨¡©en¡ jm‚na
      souboru  krat¨¡ ne‘ 3 znaky, je doplnˆno zprava mezerami. Mezi jm‚nem
      souboru a roz¨¡©en¡m jm‚na souboru se neuv d¡ te‡ka. Roz¨¡©en¡m jm‚na
      souboru mohou b˜t sam‚ mezery (tj. nen¡ roz¨¡©en¡ jm‚na souboru).

    - Atributy souboru ud vaj¡ bli‘¨¡ £daje o souboru:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0 (  1): pouze ‡ten¡ souboru (Read-only "R/O")
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1 (  2): skryt˜ soubor (Hidden "HID")
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2 (  4): syst‚mov˜ soubor (System "SYS")
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3 (  8): n vˆ¨t¡ disku (Volume Label "VOL")
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4 ( 16): podadres © (Directory "DIR")
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5 ( 32): archivn¡ soubor (Archive "ARC")
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6 ( 64): rezervov no (mus¡ b˜t nastaven na 0)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7 (128): rezervov no (mus¡ b˜t nastaven na 0)

         - Pouze  ‡ten¡  souboru  -  takto ozna‡en‚ soubory lze pouze ‡¡st,
           nelze  do  nich  zapisovat  ani  je  nijak  modifikovat. Pokus o
           otev©en¡  souboru  pro  v˜stup nebo vytvo©en¡ souboru se stejn˜m
           jm‚nem  vyvol   chybov‚ hl ¨en¡ syst‚mu. P©i vypisov n¡ adres ©e
           se soubory vypisuj¡ norm ln¡m zp–sobem.

         - Skryt˜ soubor - skryt‚ soubory se neobjevuj¡ v syst‚mov‚m v˜pisu
           adres ©e,   p©i   hled n¡  soubor–  se  v¨ak  chovaj¡  norm ln¡m
           zp–sobem.

         - Syst‚mov˜   soubor  -  takto  ozna‡en‚  soubory  jsou  pou‘¡v ny
           opera‡n¡m  syst‚mem (jako nap©. IO.SYS, MSDOS.SYS). Tyto soubory
           se neobjevuj¡ v norm ln¡m hled n¡ soubor–.

         - N vˆ¨t¡ disku je pou‘ito pro ozna‡en¡ (pojmenov n¡) disku pomoc¡
           11  znak–.  V¨echny dal¨¡ informace v adres ©ov‚ polo‘ce n vˆ¨t¡
           jsou  ignorov ny.  N vˆ¨t¡  nen¡  soubor  -  pou‘¡v  pouze jednu
           polo‘ku adres ©e, ale neobsahuje ‘ dn  dal¨¡ data. Na disku m–‘e
           b˜t  pouze jedno n vˆ¨t¡, kter‚ je um¡stˆno v z kladn¡m adres ©i
           disku.

         - Adres ©   -   tato   polo‘ka   specifikuje  vno©en˜  podadres ©.
           Podadres © je norm lnˆ vyjmut z hled n¡ soubor–.

         - Archivn¡  soubor  -  tento  bit, pokud je nastaven, indikuje, ‘e
           soubor  byl  zmˆnˆn  od  doby,  kdy byl naposledy z lohov n (tj.
           nebyl  z lohov n  programem BACKUP). Tento bit je nastaven v‘dy,
           kdykoliv je do souboru zapisov no a potom je uzav©en.

         Pozn.: Funkce  pro  hled n¡  souboru  (funkce  DOS  11H  a  4EH) s
                atributem  nastaven˜m  na  0  vyhled   v¨echny  soubory bez
                nastaven˜ch  atribut–  nebo  soubory s nastaven˜mi atributy
                "pouze ‡ten¡ souboru" a/nebo "archivn¡ soubor".

                P©¡znaky  adres ©e  a  n vˆ¨t¡  disku  nelze mˆnit pou‘it¡m
                funkce DOS CHMOD (funkce 43H).

    - €as  posledn¡ho  z znamu ud v  ‡as, kdy byl soubor naposledy vytvo©en
      nebo  aktualizov n.  Hodina,  minuta  a  sekunda jsou zaps ny ve dvou
      bajtech takto:

       vy¨¨¡ bajt (relat. adresa 17H):     ni‘¨¡ bajt (relat. adresa 16H):

       15  14  13  12  11  10   9   8       7   6   5   4   3   2   1   0
      ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿   ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
      ³ H ³ H ³ H ³ H ³ H ³ M ³ M ³ M ³   ³ M ³ M ³ M ³ S ³ S ³ S ³ S ³ S ³
      ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ   ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
       ³                 ³ ³                         ³ ³                 ³
       ÀÄ hodina (0-23) ÄÙ ÀÄÄÄÄÄ minuta (0-59) ÄÄÄÄÄÙ ÀÄ sekunda (0-29) Ù
                                                      (£daj se vyn sob¡ 2*)

    - Datum posledn¡ho z znamu ud v  den, kdy byl soubor naposledy vytvo©en
      nebo  aktualizov n.  Rok,  mˆs¡c  a  den jsou zaps ny ve dvou bajtech
      takto:

       vy¨¨¡ bajt (relat. adresa 15H):     ni‘¨¡ bajt (relat. adresa 14H):

       15  14  13  12  11  10   9   8       7   6   5   4   3   2   1   0
      ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿   ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
      ³ R ³ R ³ R ³ R ³ R ³ R ³ R ³ M ³   ³ M ³ M ³ M ³ D ³ D ³ D ³ D ³ D ³
      ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ   ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
       ³                         ³ ³                 ³ ³                 ³
       ÀÄÄÄÄÄÄ rok (0-119) ÄÄÄÄÄÄÙ ÀÄÄ mˆs¡c (1-12) ÄÙ ÀÄÄÄ den (1-31) ÄÄÙ
    (k £daji se p©i‡te 1980, tj. 1980 a‘ 2099)

    - Velikost  souboru  ud v  velikost souboru v bajtech. Prvn¡ slovo t‚to
      polo‘ky  ud v   ni‘¨¡  © d  £daje.




   ÿPÿrÿeÿfÿiÿx  ÿpÿrÿoÿgÿrÿaÿmÿoÿvÿ‚ÿhÿo  ÿsÿeÿgÿmÿeÿnÿtÿu  ÿ(ÿPÿSÿPÿ)


    Prefix  programov‚ho  segmentu  (Programm Segment Prefix - PSP) je ‡ st
programu  (datov   oblast dlouh  256 bajt–) p©edch zej¡c¡ samotn˜ program a
obsahuj¡c¡  pomocn   data  pro  pr ci programu. Prefix progamov‚ho segmentu
(PSP) se p©i po‘adavku na‡ten¡ programu vytvo©¡ na za‡ tku voln‚ho prostoru
pamˆti  (tj.  za koncem ji‘ pou‘it‚ho pracovn¡ho prostoru RAM). Za PSP (tj.
na  adresu  posunutou o 256 bajt– od za‡ tku PSP) se na‡te program COM nebo
EXE,  kter˜  m   b˜t  odstartov n.  Na  za‡ tek PSP v‘dy po startu programu
ukazuj¡  registry  DS:0000H  a ES:0000H (PSP tedy mus¡ za‡¡nat na absolutn¡
adrese,  kter   je n sobkem 16). P©i na‡ten¡ program– typu COM do pamˆti se
nastavuje  registr  CS  na za‡ tek prefixu programov‚ho segmentu a ukazatel
instrukc¡  na  hodnotu  100H  (tak‘e  po  startu programu COM je CS=DS=ES a
IP=100H).  P©i  na‡ten¡ program– typu EXE do pamˆti se nastavuje registr CS
na  datov˜  segment,  kter˜  n sleduje  ihned za PSP, ukazatel instrukc¡ se
nastav¡  obvykle na za‡ tek programu (pokud nen¡ jinak specifikov no; tak‘e
po  startu  programu EXE je DS=ES, CS=DS+0010H, IP=0). Na polo‘ky v prefixu
programov‚ho  segmentu  se  lze  tedy po startu programu odvol vat adresac¡
pomoc¡  datov‚ho  segmentu  DS nebo pomoc¡ segmentu ES, u program– typu COM
je¨tˆ nav¡c pomoc¡ programov‚ho segmentu CS.

    Prefix programov‚ho segmentu m  n sleduj¡c¡ strukturu:
ÉÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º offset ³ d‚lka ³             popis                                      º
ÌÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º   00H  ³   2   ³ instrukce INT 20H - ukon‡en¡ programu (viz popis)      º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   02H  ³   2   ³ vrchol  pamˆti  (adresa  segmentu  vrcholu  alok‡an¡ho º
º        ³       ³ bloku pamˆti programu)                                 º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   04H  ³   1   ³ rezervov no                                            º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   05H  ³   1   ³ instrukce INT 21H - vyvol n¡ funkce DOS (viz popis)    º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   06H  ³   2   ³ voln  pamˆŸ - po‡et voln˜ch bajt– v segmentu (pro COM) º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   08H  ³   2   ³ rezervov no                                            º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   0AH  ³   4   ³ adresa  ukon‡en¡  programu  (IP,CS).  Obsahuje p–vodn¡ º
º        ³       ³ adresu   obsluhy   p©eru¨en¡   pro  ukon‡en¡  programu º
º        ³       ³ (INTú22H).  Adresa  INTú22H  m–‘e  b˜t  zmˆnˆna  podle º
º        ³       ³ po‘adavk–   u‘ivatelsk‚ho   programu.   P©i   ukon‡en¡ º
º        ³       ³ programu DOS navr t¡ pomoc¡ t‚to polo‘ky p–vodn¡ obsah º
º        ³       ³ vektoru INTú22H.                                       º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   0EH  ³   4   ³ adresa  obsluhy u‘ivatelsk‚ho p©eru¨en¡ <Ctrl>-<Break> º
º        ³       ³ (<Ctrl>-C)  (IP,CS).  U‘ivatelsk˜ program m–‘e obsluhu º
º        ³       ³ u‘ivatelsk‚ho   p©eru¨en¡   <Ctrl>-<Break>  (<Ctrl>-C) º
º        ³       ³ (INTú23H)   zmˆnit  podle  sv˜ch  po‘adavk–.  DOS  p©i º
º        ³       ³ ukon‡en¡   programu   navr t¡  p–vodn¡  obsah  vektoru º
º        ³       ³ INTú23H z t‚to polo‘ky.                                º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   12H  ³   4   ³ adresa   obsluhy  kritick˜ch  chyb  (IP,CS).  Obsahuje º
º        ³       ³ p–vodn¡  adresu  obsluhy  kritick˜ch  chyb  (INTú24H). º
º        ³       ³ Adresa   INTú24H  m–‘e  b˜t  zmˆnˆna  podle  po‘adavk– º
º        ³       ³ u‘ivatelsk‚ho  programu.  P©i  ukon‡en¡  programu  DOS º
º        ³       ³ navr t¡  pomoc¡  t‚to  polo‘ky  p–vodn¡  obsah vektoru º
º        ³       ³ INTú24H.                                               º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   16H  ³   22  ³ rezervov no                                            º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   2CH  ³    2  ³ prost©ed¡ - adresa segmentu prost©ed¡ DOS              º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   2EH  ³   46  ³ rezervov no                                            º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   5CH  ³   16  ³ neotev©en˜  standardn¡ ©¡d¡c¡ blok souboru FCB1 (prvn¡ º
º        ³       ³ parametr p©¡kazov‚ho © dku - nastaveno po startu)      º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   6CH  ³   20  ³ neotev©en˜  standardn¡ ©¡d¡c¡ blok souboru FCB2 (druh˜ º
º        ³       ³ parametr p©¡kazov‚ho © dku - nastaveno po startu)      º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   80H  ³    1  ³ d‚lka parametru - po‡et bajt– parametru p©¡kaz. © dku; º
º        ³       ³ sou‡asnˆ t‚‘ implicitn¡ adresa diskov˜ch p©enos– DTA   º
ÇÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   81H  ³  127  ³ parametr   p©¡kazov‚ho  © dku  (zbytek  za  p©¡kazem). º
º        ³       ³ Pou‘¡v  se t‚‘ jako standardn¡ DTA (adresa 80H)        º
ÈÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

Pozn.: Programy  by nemˆly mˆnit ‘ dn  data v prefixu programov‚ho segmentu
       pod  adresou  5CH,  neboŸ  DOS  pou‘¡v   tyto informace p©i ukon‡en¡
       programu (jejich zmˆna m–‘e m¡t za n sledek havarii syst‚mu).

       Druh˜  ©¡d¡c¡  blok  souboru FCB2 na adrese 6CH je p©eps n, pokud je
       pou‘it  prvn¡  FCB  (na adrese 5CH) k otev©en¡ souboru. To je z toho
       d–vodu,  ‘e  pro  prvn¡  FCB  je rezervov no pouze 16 bajt–, zat¡mco
       polo‘ka  FCB  vy‘aduje  prostor  37 bajt– (p©ekryje tedy cel˜ FCB2 i
       bajt  d‚lky  parametru p©¡kazov‚ho © dku resp. prvn¡ bajt standardn¡
       vyrovn vac¡ pamˆti diskov˜ch p©enos– DTA na relativn¡ adrese 80H).




            ÿžÿ¡ÿdÿ¡ÿcÿ¡  ÿbÿlÿoÿk  ÿsÿoÿuÿbÿoÿrÿu  ÿ(ÿFÿCÿBÿ)


    Prefix  programov‚ho  segmentu  PSP obsahuje m¡sto pro dva ©¡d¡c¡ bloky
souboru  (File  Control Block - FCB) na relativn¡ch adres ch 005CH a 006CH.
Popisy   syst‚mov˜ch  slu‘eb  se  t˜kaj¡  neotev©en‚ho  a  otev©en‚ho  FCB.
Neotev©en˜ FCB je ten, kter˜ obsahuje jenom specifik tor diskov‚ jednotky a
jm‚no  souboru  (a  typ-roz¨¡©en¡  jm‚na  souboru)  a  kter˜ m–‘e obsahovat
maskovac¡  znaky (* = nahrazuje cel˜ zbytek jm‚na; ? = nahrazuje jeden znak
ve  jm‚nu,  tj. v polo‘ce adres ©e m–‘e b˜t na t‚to pozici uveden libovoln˜
znak).  Otev©en˜ FCB m  v¨echny polo‘ky FCB vyplnˆny syst‚movou slu‘bou pro
otev©en¡ nebo vytvo©en¡ souboru.

Pozn.: ž¡d¡c¡  bloky  souboru  FCB jsou poz–statky z opera‡n¡ho syst‚mu DOS
       verzeú1.  Je  v˜hodnˆj¨¡ manipulovat se soubory s pou‘it¡m novˆj¨¡ch
       slu‘eb  DOS,  kter‚  pou‘¡vaj¡ identifik tor souboru (v¨echny funkce
       nad 2EH pracuj¡c¡ se soubory).


    Struktura ©¡d¡c¡ho bloku souboru FCB:
ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍ»
º  offset  ³d‚lka³         n zev          ³ inicializov n na  ³ nastav¡  º
ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍ¹
º 00H ( 0) ³  1  ³ k¢d diskov‚ jednotky   ³ specifikace disku ³ u‘ivatel º
º 01H ( 1) ³  8  ³ jm‚no souboru          ³ jm‚no souboru     ³ u‘ivatel º
º 09H ( 9) ³  3  ³ roz¨¡©en¡ jm‚na souboru³ typ souboru       ³ u‘ivatel º
º 0CH (12) ³  2  ³ aktu ln¡ blok          ³ 00H (0)           ³ DOS      º
º 0EH (14) ³  2  ³ d‚lka jednoho z znamu  ³ 80H (128)         ³ DOS      º
º 10H (16) ³  4  ³ velikost souboru       ³ hodn. z adres ©e  ³ DOS      º
º 14H (20) ³  2  ³ datum posledn¡ho z pisu³ hodn. z adres ©e  ³ DOS      º
º 16H (22) ³  2  ³ ‡as posledn¡ho z pisu  ³ hodn. z adres ©e  ³ DOS      º
º 18H (24) ³  8  ³ rezervov no            ³                   ³          º
º 20H (32) ³  1  ³ aktu ln¡ z znam        ³ podle funkce      ³ u‘ivatel º
º 21H (33) ³  4  ³ relativn¡ z znam       ³ podle funkce      ³ u‘ivatel º
ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍ¼

    Roz¨¡©en˜  ©¡d¡c¡  blok souboru (File Control Block Extended - FCBE) se
pou‘¡v  k vytvo©en¡ nebo hled n¡ adres ©ov˜ch polo‘ek soubor– se zvl ¨tn¡mi
atributy.  Roz¨¡©en˜  ©¡d¡c¡  blok  souboru  (FCBE) se li¨¡ od standardn¡ho
©¡d¡c¡ho  bloku  souboru  (FCB) pouze doplnˆn¡m t©¡ polo‘ek p©ed standardn¡
©¡d¡c¡ blok souboru (FCB) o celkov‚ d‚lce 7 bajt–. V˜znam ostatn¡ch polo‘ek
je  nezmˆnˆn. P©i nastaven¡ adresy FCB pro danou funkci se rozli¨¡ norm ln¡
FCB  a  roz¨¡©en˜  FCBE pouze prvn¡m bajtem, kter˜ obsahuje buƒ ‡¡slo disku
(FCB) nebo identifik t roz¨¡©en‚ho ©¡d¡c¡ho bloku souboru FFH (255).

    Struktura roz¨¡©en‚ho ©¡d¡c¡ho bloku souboru FCBE:
ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍ»
º  offset  ³d‚lka³         n zev          ³    inic. na       ³ nastav¡  º
ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍ¹
º-07H (-7) ³  1  ³ identifik tor FCBE     ³ FFH (255)         ³ u‘ivatel º
º-06H (-6) ³  5  ³ rezervov no            ³ mus¡ b˜t nuly     ³ u‘ivatel º
º-01H (-1) ³  1  ³ bajt atribut–          ³ atribut souboru   ³ u‘ivatel º
º 00H ( 0) ³  1  ³ k¢d diskov‚ jednotky   ³ specifikace disku ³ u‘ivatel º
º 01H ( 1) ³  8  ³ jm‚no souboru          ³ jm‚no souboru     ³ u‘ivatel º
º 09H ( 9) ³  3  ³ roz¨¡©en¡ jm‚na souboru³ typ souboru       ³ u‘ivatel º
º 0CH (12) ³  2  ³ aktu ln¡ blok          ³ 00H (0)           ³ DOS      º
º 0EH (14) ³  2  ³ d‚lka jednoho z znamu  ³ 80H (128)         ³ DOS      º
º 10H (16) ³  4  ³ velikost souboru       ³ hodn. z adres ©e  ³ DOS      º
º 14H (20) ³  2  ³ datum posledn¡ho z pisu³ hodn. z adres ©e  ³ DOS      º
º 16H (22) ³  2  ³ ‡as posledn¡ho z pisu  ³ hodn. z adres ©e  ³ DOS      º
º 18H (24) ³  8  ³ rezervov no            ³                   ³          º
º 20H (32) ³  1  ³ aktu ln¡ z znam        ³ podle funkce      ³ u‘ivatel º
º 21H (33) ³  4  ³ relativn¡ z znam       ³ podle funkce      ³ u‘ivatel º
ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍ¼

Polo‘ky ©¡d¡c¡ho bloku souboru (FCB, FCBE):

    - Identifk tor FCBE je bajt nastaven˜ na hodnotu 0FFH (=255).

    - Bajt  atribut–  souboru  slou‘¡ k specifikaci atribut– souboru, kter‚
      maj¡   b˜t  nalezeny.  Pokud  specifikujete  nˆjakou  kombinaci  bit–
      skryt‚ho  souboru  (hodnota  02H  =  bit 1), syst‚mov‚ho souboru nebo
      adres ©e,  funkce  hled n¡ souboru bude vyhled vat norm ln¡ soubory a
      tak‚ soubory se specifikovan˜mi atributy. Pokud specifikujete atribut
      n vˆ¨t¡, bude funkce vyhled vat pouze polo‘ky n vˆ¨t¡ disku. Archivn¡
      a  read-only atributy nelze pou‘¡t jako krit‚rium pro hled n¡. V˜znam
      jednotliv˜ch bit– atributu viz "Adres ©ov  polo‘ka"-atribut souboru.

    - K¢d diskov‚ jednotky ud v  ‡¡slo disku, ke kter‚mu se soubor vztahuje
      (1=A,  2=B atd.). Pokud polo‘ka obsahuje 00H (0), operace se vztahuje
      k aktu ln¡mu (tj. vybran‚mu) disku.

    - Jm‚no souboru je 8 znak– ASCII. Pokud je jm‚no krat¨¡ ne‘ 8 znak–, je
      doplnˆno  zprava mezerami. P©i specifikaci vyhrazen‚ho jm‚na za©¡zen¡
      (nap©. LPT1) se na konci jm‚na neuv d¡ dvojte‡ka.

    - Roz¨¡©en¡  jm‚na souboru jsou 3 znaky ASCII. Pokud je roz¨¡©en¡ jm‚na
      souboru  krat¨¡ ne‘ 3 znaky, je doplnˆno zprava mezerami. Mezi jm‚nem
      souboru a roz¨¡©en¡m jm‚na souboru se neuv d¡ te‡ka. Roz¨¡©en¡m jm‚na
      souboru mohou b˜t sam‚ mezery (tj. nen¡ roz¨¡©en¡ jm‚na souboru).

    - Aktu ln¡  blok  p©edstavuje  ukazatel  na  blok  (skupina  nap©.  128
      z znam–),  kter˜  obsahuje  aktu ln¡ z zn m (tj. z znam, se kter˜m se
      bude  prov dˆt  n sleduj¡c¡  diskov   operace).  Syst‚mov  slu‘ba pro
      otev©en¡ souboru nastav¡ tuto polo‘ku na 0.

    - D‚lka  jednoho  z znamu  ud v  d‚lku logick‚ho z znamu v bajtech. DOS
      nastavuje  tuto  polo‘ku  po  otev©en¡  souboru  na  hodnotu 80H (128
      bajt–).  Pokud  chcete  pou‘¡t  jinou hodnotu, zmˆ¤te tuto polo‘ku po
      otev©en¡  souboru,  ne‘ budete prov dˆt nˆjakou diskovou operaci (tak
      lze  nap©.  ‡¡st  ze souboru po jednotliv˜ch bajtech, pokud nastav¡te
      tuto polo‘ku na hodnotu 1).

    - Velikost  souboru  ud v  velikost souboru v bajtech. Prvn¡ slovo t‚to
      polo‘ky  ud v   ni‘¨¡  © d  £daje.  Tuto  polo‘ku  nastavuje  DOS p©i
      otev©en¡ souboru podle £daje v polo‘ce adres ©e souboru.

    - Datum posledn¡ho z znamu ud v  den, kdy byl soubor naposledy vytvo©en
      nebo  aktualizov n.  Rok,  mˆs¡c  a  den jsou zaps ny ve dvou bajtech
      takto:

       vy¨¨¡ bajt (relat. adresa 15H):     ni‘¨¡ bajt (relat. adresa 14H):

       15  14  13  12  11  10   9   8       7   6   5   4   3   2   1   0
      ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿   ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
      ³ R ³ R ³ R ³ R ³ R ³ R ³ R ³ M ³   ³ M ³ M ³ M ³ D ³ D ³ D ³ D ³ D ³
      ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ   ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
       ³                         ³ ³                 ³ ³                 ³
       ÀÄÄÄ rok (1980 a‘ 2099) ÄÄÙ ÀÄÄ mˆs¡c (1-12) ÄÙ ÀÄÄÄ den (1-31) ÄÄÙ
    (k £daji se p©i‡te hodnota 1980)

    - €as  posledn¡ho  z znamu ud v  ‡as, kdy byl soubor naposledy vytvo©en
      nebo  aktualizov n.  Hodina,  minuta  a  sekunda jsou zaps ny ve dvou
      bajtech takto:

       vy¨¨¡ bajt (relat. adresa 17H):     ni‘¨¡ bajt (relat. adresa 16H):

       15  14  13  12  11  10   9   8       7   6   5   4   3   2   1   0
      ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿   ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
      ³ H ³ H ³ H ³ H ³ H ³ M ³ M ³ M ³   ³ M ³ M ³ M ³ S ³ S ³ S ³ S ³ S ³
      ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ   ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
       ³                 ³ ³                         ³ ³                 ³
       ÀÄ hodina (0-23) ÄÙ ÀÄÄÄÄÄ minuta (0-59) ÄÄÄÄÄÙ ÀÄ sekunda (0-29) Ù
                                                      (£daj se vyn sob¡ 2*)

    - Aktu ln¡ z znam ukazuje na z znam (relativnˆ v aktu ln¡m bloku - £daj
      0  a‘  127),  s kter˜m bude provedena nejbli‘¨¡ diskov  operace. Tuto
      polo‘ku nastavuje u‘ivatel p©ed operac¡ sekven‡n¡ho ‡ten¡ a z pisu.

    - Relativn¡  z znam ukazuje na aktu ln¡ z znam v souboru, s kter˜m bude
      provedena  nejbli‘¨¡  diskov   operace  n hodn‚ho  ‡ten¡ nebo z pisu.
      Polo‘ku  mus¡  nastavit  u‘ivatel  p©ed  operac¡ n hodn‚ho ‡ten¡ nebo
      z pisu  (tj.  operace  se specifikovan˜m z znamem souboru). Relativn¡
      z znam  se  vztahuje  relativnˆ k za‡ tku souboru a je ur‡en pomoc¡ 4
      bajt–.  Pokud  je  d‚lka  z znamu  men¨¡  ne‘  64 bajt–, jsou pou‘ity
      v¨echny  4  bajty  t‚to  polo‘ky;  jinak jsou pou‘ity pouze ni‘¨¡ t©i
      bajty.

      Pozn.: Pokud  je  FCB  v  prefixu  programov‚ho segmentu na relativn¡
             adrese  005CH,  je  posledn¡  bajt polo‘ky relativn¡ho z znamu
             z rove¤  prvn¡m  bajtem neform tovan‚ oblasti parametr–, kter 
             za‡¡n    na   relativn¡   adrese  0080H  prefixu  programov‚ho
             segmentu. To je implicitn¡ adresa diskov‚ho p©enosu.






    ÿSÿtÿaÿnÿdÿaÿrÿdÿnÿ¡  ÿiÿdÿeÿnÿtÿiÿfÿiÿkÿ ÿtÿoÿrÿy  ÿsÿoÿuÿbÿoÿrÿ–


    Identifik tory  soubor–  jsou  2-bajtov‚ polo‘ky, pomoc¡ nich‘ se lze v
DOS  odkazovat  p©i  diskov˜ch  operac¡ch  na soubory nebo vstupnˆ/v˜stupn¡
za©¡zen¡  (viz  funkce DOS 2CH a v˜¨e). Identifik tory se pou‘¡vaj¡ u verz¡
DOS vy¨¨¡ch ne‘ 2.0 (funkce jsou p©evzaty ze syst‚mu UNIX). Princip pr ce s
identifik tory  je  ten,  ‘e  pokud otev©ete soubor, DOS navr t¡ 16-bitovou
polo‘ku, p©edstavuj¡c¡ symbolick˜ odkaz na otev©en˜ soubor (maxim ln¡ po‡et
identifik tor–  se  specifikuje  v  souboru CONFIG.SYS p©¡kazem FILES). Zde
jsou  uvedeny  standardn¡  identifik tory  soubor–,  kter‚  jsou  v syst‚mu
rezervov ny standardn¡m vstupnˆ/v˜stupn¡m kan l–m.

    Standardn¡ vstupnˆ/v˜stupn¡ za©¡zen¡:
 ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º   standardn¡    ³                                     ³               º
 º  identifik tor  ³               n zev                 ³   ozna‡en¡    º
 º     souboru     ³                                     ³               º
 ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º        0        ³   standardn¡ vstupn¡ za©¡zen¡       ³    Stdin      º
 º        1        ³   standardn¡ v˜stupn¡ za©¡zen¡      ³    Stdout     º
 º        2        ³   standardn¡ chybov‚ za©¡zen¡       ³    Stderr     º
 º        3        ³   standardn¡ dopl¤kov‚ za©¡zen¡     ³    Stdaux     º
 º        4        ³   standardn¡ tiskov‚ za©¡zen¡       ³    Stdprn     º
 ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    - Standardn¡  vstupn¡  za©¡zen¡  (Stdin) je obvykle kl vesnice, ale lze
      prov‚st p©esmˆ©ov n¡ tak, ‘e vstup bude ‡ten ze souboru.

    - Standardn¡  v˜stupn¡  za©¡zen¡  (Stdout)  je obvykle displej, ale lze
      prov‚st p©esmˆ©ov n¡ tak, ‘e v˜stup bude zapisov n do souboru.

    - Standardn¡   chybov‚   za©¡zen¡   (Stderr)  je  displej  a  nelze  je
      p©esmˆ©ovat   z  povelov‚ho  © dku.  Toto  za©¡zen¡  se  pou‘¡v   pro
      zobrazen¡  chybov˜ch zpr v nebo pro zobrazen¡ hl ¨en¡, kter  nechcete
      p©esmˆ©ov vat spolu se standardn¡m v˜stupem.

    - Standardn¡  dopl¤kov‚ za©¡zen¡ (Stdaux) je obvykle s‚riov‚ za©¡zen¡ a
      je  stejn‚  jako  za©¡zen¡ DOS "AUX:. Z tohoto za©¡zen¡ lze jak ‡¡st,
      tak na nˆ i zapisovat.

    - Standardn¡  tiskov‚  za©¡zen¡  (Stdprn)  je  obvykle tisk rna a je to
      stejn‚  za©¡zen¡  jako za©¡zen¡ DOS "PRN:". Z tohoto za©¡zen¡ lze jak
      ‡¡st, tak na nˆ i zapisovat.

    Identifik tory  soubor–,  kter‚  byly  pops ny  v˜¨e, jsou otev©eny p©i
prvn¡m  startu  programu.  Nemus¡te  explicitnˆ  otev¡rat  ‘ dn‚  z  tˆchto
za©¡zen¡, pokud d©¡ve nˆkter˜ z tˆchto identifik tor– souboru neuzav©ete.

Pozn.: V¨ech pˆt p©eddefinovan˜ch identifik tor– souboru jsou v ASCII m¢du,
       kter˜  znamen , ‘e DOS reaguje na speci ln¡ v˜znamy nˆkter˜ch znak–,
       v‡etnˆ  <Ctrl>-<Break>  (<Ctrl>-C)  (p©eru¨en¡  programu),  <Ctrl>-S
       (pauza   p©i  prov dˆn¡  programu)  a  <Ctrl>-P  (p©ipojen¡/odpojen¡
       tisk rny).  V  ASCII  m¢du  je  znak  <Ctrl>-Z  pova‘ov n  za zna‡ku
       ozna‡uj¡c¡  konec  souboru.  Znaky  ‡ten‚  ze standardn¡ho vstupn¡ho
       za©¡zen¡  Stdin  jsou  opakov ny  na  obrazovku (echo). ž¡d¡c¡ znaky
       znaky zapisovan‚ na v˜stupn¡ a chybov‚ za©¡zen¡ Stdout a Stderr jsou
       zobrazeny  jako  posloupnost  znak–  "^"  a  X  (nap©.  ^C  je  znak
       p©eru¨en¡, k¢d 03H = 3). Tabel tory jsou nahrazeny mezerami tak, aby
       nov  pozice za‡¡nala na n sobc¡ch ‡¡sla 8.

       M¢d  tˆchto za©¡zen¡ m–‘ete zmˆnit mezi ASCII m¢dem a bin rn¡m m¢dem
       pou‘it¡m   vol n¡   funkce   IOCTL  (funkce  DOS  44H).  Nutno  v¨ak
       podotknout, ‘e z d–vodu toho, ‘e prvn¡ t©i za©¡zen¡ (Stdin, Stdout a
       Stderr) jsou vlastnˆ navz jem duplikovan  za©¡zen¡, projev¡ se zmˆna
       m¢du na jednom za©¡zen¡ i na ostatn¡ch dvou za©¡zen¡ch.





                        ÿPÿrÿoÿsÿtÿ©ÿeÿdÿ¡  ÿDÿOÿS

    DOS  pou‘¡v  pamˆŸov˜ prostor, kter˜ obsahuje nastaven¡ ©etˆzc– ASCIIZ,
kter‚ mohou b˜t pou‘ity aplika‡n¡mi programy k obdr‘en¡ informac¡ na £rovni
syst‚mu a k p©ed v n¡ dat jin˜m program–m.

    - syst‚mov˜ povel SET slou‘¡ v¨eobecnˆ v DOS k definici prost©ed¡.
    - povely PATH a PROMPT tak‚ mˆn¡ obsah prost©ed¡
    - V  povelov˜ch  souborech  lze  pou‘¡vat promˆnn‚, kter‚ jsou ozna‡en‚
      jm‚nem  promˆnn‚  a ze stran ohrani‡eny znakem procent. Tyto promˆnn‚
      jsou p©i vykon v n¡ povelov‚ho souboru nahrazov ny sv˜mi hodnotami.

Nap©.:   SET PATH=c:\adresar;%PATH%
         IF .%USER%. == .potom. GOTO navesti_potom
         ECHO %POROVNANI% > %SOUCASNA_TISKARNA^

    Prost©ed¡  m–‘e  m¡t  omezenou velikost, av¨ak vˆt¨¡ prost©ed¡ DOS m–‘e
b˜t  vytvo©eno  pomoc¡ direktivy "SHELL=" v souboru CONFIG.SYS nebo povelem
"COMMAND  /e:NNNN",  kter˜  startuje  druhou kopii povelov‚ho interpreteru,
poskytuj¡c¡ NNNN bajt– voln‚ho prostoru prost©ed¡.
  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º tvar z pisu:          ³    p©¡klad pou‘it¡ v mnemotechnice ASM:      º
  ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º jm‚no_1=hodnota_1(0)  ³  db   'COMSPEC=c:\command.com',0             º
  º jm‚no_2=hodnota_2(0)  ³  db   'PROMPT=$P$G',0                        º
  º        :              ³  db   'WP=c:\wordproc',0                     º
  º jm‚no_N=hodnota_N(0)  ³  db   'PATH=d:\;c:\dos;c:\utility',0         º
  º (0)                   ³  db   0                                      º
  ÇÄÄÄÄÄÄÄÄÄÄÄÄÄ Pro DOS 3.0 a vy¨¨¡: ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
  º (xxxx)                ³  dw   1                                      º
  º ©etˆzec_EXEC_1(0)     ³  db   'C:\ACCTNG\AR001.EXE',0                º
  º      :                ³  db   0                                      º
  º ©etˆzec_EXEC_NN(0)    ³                                              º
  º (0)                   ³                                              º
  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    kde (0) je ASCII znak NULL (k¢d 00H) a (xxxx) je 16-bitov  hodnota.

Pou‘it¡ prost©ed¡:

    Prost©ed¡  DOS  je  oblast  pamˆti  men¨¡  ne‘ 32 KB a za‡¡n  na okraji
odstavce. €¡slo odstavce, na kter‚m za‡¡n  prost©ed¡, je ud no na relativn¡
adrese 2CH prefixu programov‚ho segmentu PSP pr vˆ prob¡haj¡c¡ho programu.

    M–‘ete  nal‚zt  zvolen‚  'jm‚no'  pomoc¡  s‚rie  porovn vac¡ch  operac¡
©etˆzc–  ASCIIZ  dokud nenaraz¡te na nulov˜ ©etˆzec (tj. s nulovou d‚lkou),
indikuj¡c¡  konec  prost©ed¡.  Norm lnˆ  je  ‡ st  'jm‚no'  ka‘d‚ho ©etˆzce
prost©ed¡ ve velk˜ch p¡smenech av¨ak nen¡ to podm¡nkou.

    Jednou  typickou  operac¡  s  prost©ed¡m je pou‘it¡ program– typu SHELL
(tj.  nadstavby  opera‡n¡ho  syst‚mu), kter‚ prov d¡ druh‚ kopie povelov‚ho
interpreteru  COMMAND.COM.  Tyto programy typicky hledaj¡ polo‘ku prost©ed¡
pojmenovanou  "COMSPEC" a pou‘ij¡ jej¡ hodnotu jako ozna‡en¡ disku, cesty a
specifikace  souboru  jako  ozna‡en¡  povelov‚ho  interpreteru  DOS - tento
program je na‡ten a spu¨tˆn pomoc¡ funkce DOS 4BH.

    Nˆkter‚  programy  vy‘aduj¡  oper tor k ulo‘en¡ informace o specifikaci
dan‚ho  aplika‡n¡ho  programu do prost©ed¡ DOS pomoc¡ povelu SET. Aplika‡n¡
program  m–‘e pou‘¡vat tuto informaci poka‘d‚, kdy‘ je vyvol n. Nap©¡klad -
textov˜  procesor  m–‘e  hledat polo‘ku nazvanou "TEXTY" a pou‘¡t text jej¡
hodnoty jako specifikaci adres ©e datov˜ch soubor–.


Z kladn¡ prost©ed¡:

    Ka‘d˜  program  obdr‘¡  st lou kopii inicializa‡n¡ho prost©ed¡ syst‚mu.
Tak‘e  jak‚koliv zmˆny, kter‚ provedete v prost©ed¡, budou m¡t £‡inek pouze
pro  v¨echny  synovsk‚  (pod©¡zen‚)  procesy  (pokud nˆjak‚ jsou) ale budou
ztraceny, kdy‘ se ©¡zen¡ p©ed  do otcovsk‚ho procesu.

    Nen¡   dokumentov na   ‘ dn    cesta  k  nastavov n¡  "ko©enn‚ho"  nebo
"hlavn¡ho"  prost©ed¡  DOS.  Jednou z nedokumentovan˜ch mo‘nost¡ je pou‘it¡
p©eru¨en¡  DOS  INTú2EH.  M–‘ete  m¡t  £spˆch spu¨tˆn¡m kopie COMMAND.COM a
pr–chodem  spojovan‚ho  prost©ed¡. Potom v¨echny jeho produkty obdr‘¡ kopii
tohoto prost©ed¡.


Um¡stˆn¡ zav dˆc¡ cesty:

    P©i  odstartov n¡  porgramu v DOS verze 3.00 a vy¨¨¡ ulo‘¡ DOS p©¡davn˜
©etˆzec za konec form ln¡ho prost©ed¡, kter˜ m–‘e b˜t pou‘it k ur‡en¡ disku
a  adres ©e,  ze  kter‚ho  byl program zav dˆn. 'Chytr‚' aplika‡n¡ programy
mohou tuto pomoc vyu‘¡t k nalezen¡ sv˜ch p©ekryvn˜ch a datov˜ch soubor–.

    To  je  velmi  d–le‘it‚,  neboŸ  DOS  3.0 umo‘nil oper torovi vyvol vat
program uv dˆn¡m jm‚na cesty p©ed jm‚no startovan‚ho programu.

    N sleduj¡c¡m   za  posledn¡m  ©etˆzcem  ASCIIZ  prost©ed¡  je  bajt  0,
indikuj¡c¡  konec  form ln¡ho  prost©ed¡. N sleduj¡c¡ dva bajty p©edstavuj¡
16-bitov˜  ‡¡ta‡  p©¡davn˜ch  ©etˆzc–  (tato hodnota je norm lnˆ 0001H). Za
touto  bin rn¡  hodnotou  m–‘ete nal‚zt ©etˆzec ASCIIZ specifikace souboru,
kter˜ byl pou‘it funkc¡ DOS 4BH (EXEC) k na‡ten¡ a odstartov n¡ programu.

    Stejnˆ  tak  i  kdy‘  soubor  programu nebyl v aktu ln¡m adres ©i a DOS
musel  pou‘¡t  cestu  k  hled n¡  povelu (tj. ©etˆzec "PATH=..") k nalezen¡
souboru  programu,  ulo‘¡  DOS  za  konec  prost©ed¡  spr vnou hodnotu pln‚
specifikace souboru (d:\cesta\jm‚no_souboru.ext,0).





      ÿIÿnÿsÿtÿaÿlÿoÿvÿaÿtÿeÿlÿnÿ‚  ÿdÿrÿiÿvÿeÿrÿy  ÿzÿaÿ©ÿ¡ÿzÿeÿnÿ¡

    Instalovateln‚  drivery za©¡zen¡ umo‘¤uj¡ vytv ©et standardn¡ rozhrann¡
mezi syst‚mem DOS a nestandardn¡ sou‡ stkou nebo za©¡zen¡m.

    Instalovateln˜  driver za©¡zen¡ je speci lnˆ form tovan˜ program, kter˜
je  na‡ten  do  pamˆti  p©i zav dˆn¡ opera‡n¡ho syst‚mu. Na‡ten¡ se provede
pomoc¡  souboru CONFIG.SYS p©¡kazov˜m © dkem 'DEVICE=<identifikace souboru>
seznam  parametr–'.  Identifikace  souboru  ud v   jm‚no  driveru resp. i s
ud n¡m  p©¡stupov‚ cesty k tomuto souboru. Za identifikac¡ souboru m–‘e b˜t
uveden   libovoln˜   seznam  parametr–  pro  instalaci  driveru,  konkr‚tn¡
struktura   parametr–   z vis¡  na  konkr‚tn¡ch  po‘adavc¡ch  instalovan‚ho
driveru.

    Soubor driveru za©¡zen¡ je bin rn¡ soubor. Po p©ekladu zdrojov‚ho textu
v  assembleru  pou‘ijte program EXE2BIN, kter˜m soubor konvertujete z tvaru
EXE  do bin rn¡ho tvaru. Na rozd¡l od soubor– ve form tu COM nevkl dejte na
za‡ tek programu instrukci ORG 100H (soubor je p©ekl d n od adresy 0).

    Pokud soubor CONFIG.SYS obsahuje p©¡kaz 'DEVICE=' pro instalaci souboru
driveru,  bude soubor driveru za©¡zen¡ dan‚ho jm‚na nainstalov n do ©etˆzce
driver–  za©¡zen¡.  To  m   ten  £‡inek,  ‘e instalovan  za©¡zen¡ budou m¡t
p©ednost  p©ed  drivery  DOS pro za©¡zen¡ se stejn˜mi jm‚ny. Nap©. pokud je
instalov n  driver  ANSI.SYS,  kter˜  m   jm‚no  za©¡zen¡  CON:,  je  t¡mto
zablokov n standardn¡ driver za©¡zen¡ CON:.


    Na  za‡ tku  souboru driveru za©¡zen¡ je um¡stˆna 18-bajtov  struktura,
kter  se naz˜v  z hlav¡ za©¡zen¡:

ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º  offset: ³ velikost: ³                   popis:                     º
ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 00H ( 0) ³    4      ³ adresa FAR n sleduj¡c¡ho za©¡zen¡ v ©etˆzci  º
º 04H ( 4) ³    2      ³ atributy za©¡zen¡                            º
º 06H ( 6) ³    2      ³ offsetov  adresa rutiny strategie            º
º 08H ( 8) ³    2      ³ offsetov  adresa rutiny p©eru¨en¡            º
º 0AH (10) ³    8      ³ jm‚no za©¡zen¡                               º
ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

- N sleduj¡c¡  za©¡zen¡: Tuto  polo‘ku  nastavuje DOS p©i instalaci driveru
                         za©¡zen¡.    Obsahuje    vzd lenou   adresu   (tj.
                         segment:offset)   za‡ tku   d©¡ve  nainstalovan‚ho
                         driveru.  Drivery  za©¡zen¡ se instaluj¡ do pamˆti
                         zdola   nahoru   -   posledn¡   driver   je   tedy
                         nainstalov n   naho©e.  Prohled v n¡  driver–  p©i
                         hled n¡  po‘adovan‚ho  jm‚na  za©¡zen¡  prob¡h  od
                         posledn¡ho  za©¡zen¡  (tj.  shora dol–). P©itom je
                         adresa   n sleduj¡c¡ho  (tj.  ni‘¨¡ho  v  ©etˆzci)
                         zji¨tˆna z t‚to polo‘ky. Posledn¡ driver v ©etˆzci
                         driver–  (tj.  nejni‘¨¡)  m   nastavenu polo‘ku na
                         hodnotu  -1 (tj. FFFF:FFFFH). P©i na‡¡t n¡ souboru
                         driveru  do pamˆti mus¡ b˜t nastavena tato polo‘ka
                         na  hodnotu  t‚‘  -1 (FFFF:FFFFH). Je-li v souboru
                         v¡c   ne‘   jeden  driver,  bude  v  prvn¡m  slovˆ
                         ukazatele   relativn¡   adresa   dal¨¡ho   driveru
                         za©¡zen¡  v  souboru.  Posledn¡  driver za©¡zen¡ v
                         souboru  mus¡ m¡t ukazatel na pole z hlav¡ dal¨¡ho
                         za©¡zen¡ nastaven na hodnotu -1 (tj. FFFF:FFFFH).

- Atributy za©¡zen¡: Slovo atribut– za©¡zen¡ indikuje vlastnosti za©¡zen¡.

 ÉÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º  bit ³                        v˜znam                                  º
 ÌÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º   0  ³ 1 = standardn¡ vstupn¡ za©¡zen¡ (stdin)                        º
 º   1  ³ 1 = standardn¡ v˜stupn¡ za©¡zen¡ (stdout)                      º
 º   2  ³ 1 = standardn¡ nulov‚ za©¡zen¡ (NUL:)                          º
 º   3  ³ 1 = hodinov‚ za©¡zen¡ (CLOCK)                                  º
 º  4,5 ³   rezervov no (mus¡ b˜t 0)                                     º
 º   6  ³ 1 = podporuje logick  za©¡zen¡                                 º
 º 7-10 ³   rezervov no (mus¡ b˜t 0)                                     º
 º  11  ³ 1 = podporuje otev©en¡/uzav©en¡/v˜mˆnu m‚dia                   º
 º  12  ³   rezervov no (mus¡ b˜t 0)                                     º
 º  13  ³ 1 = je za©¡zen¡ s form tem NON-IBM (tj. nem  form t disku IBM) º
 º  14  ³ 1 = podporuje ©¡zen¡ za©¡zen¡ p©es kan l IOCTL (funkce 44H)    º
 º  15  ³ 1 = je znakov‚ za©¡zen¡; 0 = je blokov‚ za©¡zen¡               º
 ÈÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

     Pokud p©episujete stand. za©¡zen¡ CON: (konzola), nastavte bity 0 a 1.

     Za©¡zen¡ NUL nem–‘e b˜t p©e©azeno (nepokou¨ejte se je p©epsat).

     Bit  3  (hodinov‚  za©¡zen¡) indikuje, zda je p©edefinov no standardn¡
     hodinov‚  za©¡zen¡  CLOCK$. CLOCK$ je znakov‚ za©¡zen¡ ovl dan‚ pomoc¡
     po‘adavk–  na za©¡zen¡ s d‚lkou 6 bajt–. Vstupn¡ po‘adavek (k¢d povelu
     4)  by mˆl navracet 6 bajt– indikuj¡c¡ch aktu ln¡ ‡as/datum a v˜stupn¡
     po‘adavek  (k¢d povelu 8) by mˆl p©ijat 6 bajt– k nastaven¡ ‡asu/data.
     Form t dat pro CLOCK$ je:

          ÉÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
          º offset  ³ velikost³            v˜znam              º
          ÇÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
          º 00H (0) ³    2    ³ datum - po‡et dn– od 1.1.1980  º
          º 02H (2) ³    1    ³ minuta (0-59)                  º
          º 03H (3) ³    1    ³ hodina (0-23)                  º
          º 04H (4) ³    1    ³ sekunda (0-59)                 º
          º 05H (5) ³    1    ³ setiny sekundy (0-99)          º
          ÈÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

     Bit  6  (podporov no  logick‚  za©¡zen¡)  indikuje, zda je podporov no
     logick‚   za©¡zen¡   (ò   DOS   3.2)   -   viz   funkce   17H   a  18H
     (poskytnut¡/nastaven¡  logick‚ho  za©¡zen¡).  T¡mto  driverem je nap©.
     soubor DRIVER.SYS.

     Bit  11  (podpora otev©en¡/uzav©en¡/RM) indikuje, zda jsou podporov ny
     po‘adavky  na  za©¡zen¡  vztahuj¡c¡  se k v˜mˆnn˜m m‚di¡m (0DH a‘ 0FH)
     tak,  aby  mohl  driver  blokov‚ho  za©¡zen¡  optimalizovat  prov dˆn‚
     operace  lok ln¡m  shroma‘ƒov n¡m  ve  vyrovn vac¡ch pamˆtech nebo aby
     mohl driver znakov‚ho za©¡zen¡ vys¡lat inicializa‡n¡ posloupnost.

     Bit  13  (form t  za©¡zen¡  NON-IBM) m  £‡inek p©i po‘adavku sestaven¡
     bloku parametr– BIOS BPB (02H).

     Bit  14  (©¡zen¡ kan lu IOCTL) indikuje podporu ©¡zen¡ za©¡zen¡ pomoc¡
     ©¡d¡c¡ho kan lu (funkce DOS 44H).

- Strategie  za©¡zen¡: Tato  polo‘ka  je  offset  ukazuj¡c¡ na ‡ st driveru
                       (mus¡  b˜t  ve  stejn‚m  segmentu),  kter   slou‘¡ k
                       nastaven¡  adresy  po‘adavku  za©¡zen¡  podle obsahu
                       registr–  ES:BX. Adresu po‘adavku za©¡zen¡ nastavuje
                       DOS  p©i  prvn¡m  po‘adavku  p©¡stupu  na  za©¡zen¡,
                       driver  si  adresu  po‘adavku  za©¡zen¡  ulo‘¡ a p©i
                       dal¨¡ch  po‘adavc¡ch na za©¡zen¡ se operace vztahuj¡
                       na   tuto  adresu.  (Ve  v¡ce£lohov‚m  prost©ed¡  to
                       umo‘¤uje  vytv ©et  ©etˆzec  po‘adavk–  typu  FIFO -
                       prvn¡ po‘adavek bude uspokojen prvn¡ v po©ad¡).

- Rutina p©eru¨en¡: Rutinu  p©eru¨en¡  vol   DOS bez jak˜chkoliv parametr–.
                    Jeho  ‡innost  spo‡¡v   v  tom,  ‘e za pou‘it¡ poslednˆ
                    definovan‚  adresy  z hlav¡  po‘adavku  provede operaci
                    podle  k¢du  povelu,  kter˜  je v tomto z hlav¡ uveden.
                    R–zn‚  povely  za©¡zen¡ pou‘¡vaj¡ r–znou strukturu dat.
                    Typicky   obsahuje  driver  ur‡it‚  mno‘stv¡  skok–  na
                    obsluhy  jednotliv˜ch  po‘adavk–. Po ukon‡en¡ po‘adavku
                    by  mˆl  driver  nastavit stavov‚ slovo za©¡zen¡, kter‚
                    bude  indikovat  souhrn  chyb,  kter‚  se bˆhem operace
                    vyskytly   a   potom  navr tit  ©¡zen¡  do  DOS  pomoc¡
                    instrukce FAR RET.

- Jm‚no za©¡zen¡: Obsahuje  jm‚no  za©¡zen¡,  na  kter‚  se  lze pomoc¡ DOS
                  odkazovat.  Jm‚no  za©¡zen¡  je  ve form tu ASCII textu o
                  maxim ln¡m po‡tu znak– 8, za jm‚nem se neuv d¡ dvojte‡ka.
                  Pokud  je  po‡et znak– jm‚na za©¡zen¡ men¨¡ ne‘ 8, dopln¡
                  se zprava mezerami.



    Pomoc¡  rutiny  strategie  za©¡zen¡ informuje DOS driver o tom, na jak‚
adrese  (ES:BX)  je  um¡stˆn  po‘adavek  za©¡zen¡. Ka‘d˜ po‘adavek za©¡zen¡
za‡¡n   13-bajtov˜m  z hlav¡m  po‘adavku, za kter˜m n sleduje datov  oblast
promˆnn‚  d‚lky.  Z hlav¡  po‘adavku  za©¡zen¡  m   d‚lku  13  bajt–  a  m 
n sleduj¡c¡ strukturu:

  ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³    1     ³ d‚lka tohoto po‘adavku (z hlav¡ a data)      º
  º 01H ( 1) ³    1     ³ ‡¡slo jednotky (pou‘ito pouze pro blok. za©.)º
  º 02H ( 2) ³    1     ³ k¢d povelu (00H-18H) specifikuj¡c¡ po‘ad.akciº
  º 03H ( 3) ³    2     ³ stavov‚ slovo za©¡zen¡ (nastavuje driver)    º
  º 05H ( 5) ³    8     ³ rezervov no                                  º
  ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

- K¢d povelu: K¢d  povelu  specifikuje, kter  akce je po‘adov na, aby se se
              za©¡zen¡m provedla. K¢dy povel– jsou:

  ÉÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍ»
  º k¢d povelu ³ v˜znam                                        ³ pou‘it¡ º
  ÌÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍ¹
  º  00H ( 0)  ³ inicializace za©¡zen¡                         ³   Z,B   º
  º  01H ( 1)  ³ kontrola m‚dia                                ³    B    º
  º  02H ( 2)  ³ vystavˆn¡ bloku parametr– BIOS (BPB)          ³    B    º
  º  03H ( 3)  ³ vstup kan lu pro ovl d n¡ za©¡zen¡ (IOCTL)    ³  Z,B,I  º
  º  04H ( 4)  ³ vstup (‡ten¡ ze za©¡zen¡)                     ³   Z,B   º
  º  05H ( 5)  ³ nedestruktivn¡ vstup                          ³    Z    º
  º  06H ( 6)  ³ statut vstupu                                 ³    Z    º
  º  07H ( 7)  ³ vypr zdnˆn¡ vstupu                            ³    Z    º
  º  08H ( 8)  ³ v˜stup (z pis na za©¡zen¡)                    ³   Z,B   º
  º  09H ( 9)  ³ v˜stup s verifikac¡                           ³   Z,B   º
  º  0AH (10)  ³ statut v˜stupu                                ³    Z    º
  º  0BH (11)  ³ vypr zdnˆn¡ v˜stupu                           ³    Z    º
  º  0CH (12)  ³ v˜stup z kan lu pro ovl d n¡ za©¡zen¡ (IOCTL) ³  Z,B,I  º
  º  0DH (13)  ³ otev©en¡ za©¡zen¡               (DOS ò 3.0)   ³  Z,B,R  º
  º  0EH (14)  ³ uzav©en¡ za©¡zen¡               (DOS ò 3.0)   ³  Z,B,R  º
  º  0FH (15)  ³ v˜mˆna m‚dia                    (DOS ò 3.0)   ³   B,R   º
  º  13H (19)  ³ generov n¡ po‘adavku IOCTL      (DOS ò 3.2)   ³    I    º
  º  17H (23)  ³ poskytnut¡ logick‚ho za©¡zen¡   (DOS ò 3.2)   ³   Z,B   º
  º  18H (24)  ³ nastaven¡ logick‚ho za©¡zen¡    (DOS ò 3.2)   ³   Z,B   º
  ÈÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍ¼
    K¢dy pou‘it¡: Z = driver znakov‚ho za©¡zen¡
                  B = blokov‚ za©¡zen¡ (p©edev¨¡m diskov‚ drivery)
                  I = mus¡ podporovat ©¡d¡c¡ kan l za©¡zen¡ IOCTL
                  R = mus¡ podporovat otev©en¡/uzav©en¡/v˜mˆnu m‚dia

- Stavov‚ slovo za©¡zen¡: Stavov‚  slovo  mus¡  b˜t nastaveno driverem v‘dy
                          p©i  n vratu  do  DOS.  Jednotliv‚ bity stavov‚ho
                          slova  za©¡zen¡  maj¡  v˜znam  podle  n sleduj¡c¡
                          tabulky:

 ÉÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º  bit ³                        v˜znam                                  º
 ÌÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º  0-7 ³ chybov˜ k¢d (viz n sleduj¡c¡ tabulka)                          º
 º   8  ³ 1 = akce provedena (po n vratu z driveru v‘dy nastaven)        º
 º   9  ³ 1 = zanepr zdnˆn (pouze povely 06H a 0AH)                      º
 º 10-14³ rezervov no                                                    º
 º  15  ³ 1 = nastala chyba                                              º
 ÈÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

     - Chybov˜  k¢d  (bity  0  a‘ 7) nastavuje driver v p©¡padˆ, ‘e nastala
       bˆhem  po‘adovan‚  operace  chyba obsluhy za©¡zen¡ (bit 15 stavov‚ho
       slova  je  nastaven).  Chybov˜  k¢d  je  um¡stˆn  do  ni‘¨¡ch 8 bit–
       stavov‚ho slova, v˜znam jednotliv˜ch k¢d– je n sleduj¡c¡:

          ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
          º chybov˜ k¢d ³                  v˜znam                   º
          ÌÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
          º  00H ( 0)   ³    poru¨en¡ ochrany z pisu                º
          º  01H ( 1)   ³    nezn m  jednotka                       º
          º  02H ( 2)   ³    za©¡zen¡ nen¡ p©ipraveno               º
          º  03H ( 3)   ³    nezn m˜ povel                          º
          º  04H ( 4)   ³    chyba kontroln¡ho sou‡tu (CRC)         º
          º  05H ( 5)   ³    ¨patn  d‚lka struktury po‘adavku       º
          º  06H ( 6)   ³    chyba vystaven¡                        º
          º  07H ( 7)   ³    nezn m‚ m‚dium                         º
          º  08H ( 8)   ³    sektor nenalezen                       º
          º  09H ( 9)   ³    v tisk rnˆ nen¡ pap¡r                  º
          º  0AH (10)   ³    chyba z pisu                           º
          º  0BH (11)   ³    chyba ‡ten¡                            º
          º  0CH (12)   ³    v¨eobecn  chyba                        º
          º  0DH (13)   ³    (rezervov no)                          º
          º  0EH (14)   ³    (rezervov no)                          º
          º  0FH (15)   ³    neplatn  v˜mˆna disku (DOS ò 3.0)      º
          ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

     - Bit  ‡¡slo  8 ("akce provedena") nastavuje driver v‘dy p©i norm ln¡m
       ukon‡en¡ obsluhy po‘adavku.

     - Bit  ‡¡slo  9  ("zanepr zdnˆn")  je  driverem nastaven v p©¡padˆ, ‘e
       nelze  uspokojit  po‘adavek,  proto‘e  fyzick‚ za©¡zen¡ je pou‘¡v no
       p©ede¨l˜m  po‘adavkem. To je tak‚ pou‘¡v no k navr cen¡ dopl¤uj¡c¡ch
       informac¡, jako nap©. "©etˆzec kl vesnice nen¡ pr zdn˜" nebo "m‚dium
       bylo vymˆnˆno".

     - Bit  ‡¡slo 15 ("nastala chyba") pokud driver p©ijme po‘adavek, kter˜
       nem–‘e  obslou‘it,  nebo  pokud  p©i  uspokojov n¡ po‘adavku nastane
       chyba.  Pokud  je  chybov˜ bit nastaven, obsahuj¡ bity 0-7 stavov‚ho
       slova za©¡zen¡ chybov˜ k¢d.




    Za  z hlav¡m  po‘adavku n sleduje oblast dat. D‚lka t‚to oblasti z vis¡
na  k¢du  povelu  (bajt  v z hlav¡ za©¡zen¡ s offsetem 2). Nˆkter‚ z povel–
sd¡lej¡  identickou strukturu po‘adavku. Jin‚ pou‘¡vaj¡ z©etˆzen‚ struktury
a nˆkter‚ pou‘¡vaj¡ pouze z hlav¡ po‘adavku ke komunikaci s DOS.

- Inicializace za©¡zen¡ (k¢d povelu 0): Driver   inicializuje   za©¡zen¡  a
                                        navr t¡ adresu konce pamˆti, kterou
                                        chce ponechat rezidentn¡.

  ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po‘adavku                            º
  º 0DH (13) ³    1     ³ v˜stup: po‡et jednotek definovan˜ch t¡mto    º
  º          ³          ³         driverem (blokov  za©¡zen¡)          º
  º 0EH (14) ³    4     ³ v˜stup: kone‡n  adresa rezidentn¡ho k¢du     º
  º 12H (18) ³    4     ³ vstup:  adresa ©etˆzce ASCIIZ z CONFIG.SYS   º
  º          ³          ³ v˜stup: adresa bloku parametr– BIOS (BPB)    º
  º          ³          ³         pro za©¡zen¡ (blokov  za©¡zen¡)      º
  º 16H (22) ³    1     ³ ‡¡slo disku (0=A, 1=B atd.) (DOS ò 3.0)      º
  ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Po‡¡naje   verz¡   DOS   ò   3.0   obsahuje   offset  12H  (18)  adresu
    (segment:offset)  textov‚ho  ©etˆzce  ASCIIZ, kter˜ n sleduje v souboru
    CONFIG.SYS  za  povelem  "DEVICE=".  Tento  text  m–‘ete ‡¡st, pokud je
    po‘adov no  p©ed v n¡  parametr–  u‘ivatelem.  Od t‚to verze DOS je t‚‘
    um¡stˆno  na  offsetu  16H  (22)  ‡¡slo  disku. To umo‘¤uje driveru p©i
    instalaci zobrazit hl ¨en¡ informuj¡c¡ u‘ivatele o tom, jako kter˜ disk
    byl  driver  nainstalov n.  Bˆhem inicializace mohou b˜t pou‘ity slu‘by
    DOS 01H a‘ 0CH (hl ¨en¡ atd.).

- Kontrola m‚dia (k¢d povelu 1): Driver ur‡¡, zda bylo m‚dium vymˆnˆno.

  ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po‘adavku                            º
  º 0DH (13) ³    1     ³ vstup:  bajt popisova‡e m‚dia (DOS testuje,  º
  º          ³          ³         zda byl zmˆnˆn)                      º
  º 0EH (14) ³    1     ³ v˜stup: FFH = m‚dium bylo vymˆnˆno           º
  º          ³          ³         01H = m‚dium je nezmˆnˆn‚            º
  º          ³          ³         00H = nen¡ zn m‚, zda bylo vymˆnˆno  º
  º 0FH (15) ³    4     ³ v˜stup: adresa ©etˆzce ASCIIZ p©edchoz¡ho    º
  º 16H (22) ³    1     ³         identifika‡n¡ho n vˆ¨t¡ (pokud bylo  º
  º          ³          ³         m‚dium vymˆnˆno a je podporov no     º
  º          ³          ³         rozpozn n¡ v˜mˆny m‚dia              º
  ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Bajt   popisova‡e   m‚dia  (naz˜v   se  t‚‘  bajt  identifik toru  FAT)
    identifikuje   typ   m‚dia,   kter˜  je  pou‘it  v  diskov‚m  za©¡zen¡.
    Bli‘¨¡ podrobnosti viz kapitolu Zav dˆc¡ adres © disku.

- Vystavˆn¡ bloku parametr–
  BIOS (k¢d povelu 02H):      Driver  navr t¡  ukazatel  na  blok parametr–
                              BIOS  (BPB)  pro  disketu,  kter   je pr vˆ v
                              disketov‚   mechanice.   Pokud   m   za©¡zen¡
                              atribut NON-IBM (nen¡ standardn¡ form t IBM),
                              potom  nen¡  ukazatel  na offsetu 0EH (adresa
                              bufferu)  definov n. Pokud m  za©¡zen¡ form t
                              IBM,  potom  ukazuje tento ukazatel na buffer
                              obsahuj¡c¡ prvn¡ sektor tabulky FAT (kter˜ je
                              na‡ten   p©ed  povelem  pro  vystavˆn¡  bloku
                              parametr– BIOS (BPB).

  ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po‘adavku                            º
  º 0DH (13) ³    1     ³ vstup:  bajt popisova‡e m‚dia                º
  º 0EH (14) ³    4     ³ vstup:  adresa bufferu (FAT sektor 0)        º
  º 12H (18) ³    4     ³ v˜stup: adresa bloku parametr– BIOS (BPB)    º
  º          ³          ³         pro za©¡zen¡ (blokov  za©¡zen¡-disk) º
  ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Blok parametr– BIOS (BPB - d‚lka 13 bajt–):
  ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³    2     ³ bajt– na sektor                              º
  º 02H ( 2) ³    1     ³ sektor– na aloka‡n¡ blok (cluster)           º
  º 03H ( 3) ³    2     ³ zav dˆc¡ a rezervovan‚ sektory               º
  º 05H ( 5) ³    1     ³ po‡et aloka‡n¡ch tabulek soubor– (FAT)       º
  º 06H ( 6) ³    2     ³ maxim ln¡ po‡et polo‘ek adres ©e v z kl. adr.º
  º 08H ( 8) ³    2     ³ celkov˜ po‡et sektor– na m‚diu (v oddˆl.DOS) º
  º 0AH (10) ³    1     ³ popisova‡ m‚dia (=1.bajt FAT)                º
  º 0BH (11) ³    2     ³ po‡et sektor– v jedn‚ aloka‡n¡ tab.soub.(FAT)º
  ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
    Podrobnosti viz rozdˆlen¡ disku MS-DOS.


- Vstup, v˜stup (povely 03H, 04H, 08H, 09H, 0CH):

  ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po‘adavku                            º
  º 0DH (13) ³    1     ³ vstup:  bajt popisova‡e m‚dia                º
  º 0EH (14) ³    4     ³ vstup:  adresa bufferu pro p©enos dat (DTA)  º
  º 12H (18) ³    2     ³ vstup:  po‡et bajt– (pro blokov‚ za©¡zen¡    º
  º          ³          ³         po‡et sektor–)                       º
  º 14H (20) ³    2     ³ vstup:  ‡¡slo po‡ te‡n¡ho sektoru (pouze pro º
  º          ³          ³         blokov  za©¡zen¡)                    º
  º 16H (22) ³    4     ³ v˜stup: adresa ©etˆzce ASCIIZ identifika‡n¡hoº
  º          ³          ³         n vˆ¨t¡ disku (pokud navr t¡ chybu   º
  º          ³          ³         za©¡zen¡ 0FH - neplatn  v˜mˆna)      º
  ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    P©i povelech vstupu (03H, 04H) by mˆl driver p©en‚st ur‡en˜ po‡et bajt–
    (pro  blokov‚  za©¡zen¡  ur‡en˜ po‡et sektor–) ze za©¡zen¡ do pamˆti od
    adresy, jej¡‘ adresa je zad na na offsetu 0EH.

    P©i povelech v˜stupu (08H, 09H, 0CH) by mˆl driver p©en‚st ur‡en˜ po‡et
    bajt–/sektor– z pamˆti od adresy ur‡en‚ offsetem 0EH do za©¡zen¡.

- Nedestruktivn¡ ‡ten¡ (k¢d povelu 05H): Tento  povel  se pou‘¡v  pouze pro
                                         znakov  za©¡zen¡. D v  mo‘nost DOS
                                         pod¡vat  se  p©edem na znak, kter˜
                                         bude  p©ed n p©i p©¡¨t¡m po‘adavku
                                         ‡ten¡   znaku  (p©i  t‚to  operaci
                                         driver  ne‡ek ,  a‘ je nˆjak˜ znak
                                         p©ipraven).

  ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po‘adavku                            º
  º 0DH (13) ³    1     ³ v˜stup: hodnota bajtu, kter˜ je p©ipraven    º
  º          ³          ³         v ©etˆzci jako p©¡¨t¡                º
  ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

- Statut (k¢dy povel– 06H a 0AH): P©i tomto povelu nastavuje driver stavov‚
                                  slovo  za©¡zen¡,  co‘  umo‘¤uje p©edev¨¡m
                                  kontrolu bitu "zanepr zdnˆn" (bit 9). P©i
                                  vol n¡   statutu   vstupu   (povel   06H)
                                  resetuje driver bit "zanepr zdnˆn", pokud
                                  v  bufferu  je  p©ipraven  znak ke ‡ten¡.
                                  Nastavuje  jej  na  1, pokud by povel pro
                                  vstup  znaku vy‘adoval ‡ek n¡ za©¡zen¡ na
                                  p©¡chod  bajtu  (nap©.  ‡ek n¡ na znaku z
                                  kl vesnice).  P©i  vol n¡ statutu v˜stupu
                                  (povel    0AH)    resetuje   driver   bit
                                  "zanepr zdnˆn"   na  0,  pokud  neprob¡h 
                                  ‘ dn˜  po‘adavek  v˜stupu a p©¡¨t¡ v˜stup
                                  by  probˆhl  p©¡mo na za©¡zen¡. Nastavuje
                                  jej   na  1,  pokud  p©edchoz¡  po‘adavek
                                  v˜stupu nebyl dosud je¨tˆ ukon‡en.

- Vypr zdnˆn¡ (k¢dy povel– 07H a 0BH): Tyto  povely  po‘aduj¡,  aby  driver
                                       vy‡istil   vstupn¡   nebo   v˜stupn¡
                                       vyrovn vac¡   pamˆti   (tj.   zru¨il
                                       v¨echny bajty, kter‚ byly p©ipraveny
                                       ve  vyrovn vac¡ch pamˆtech pro vstup
                                       nebo v˜stup). To se vˆt¨inou pou‘¡v 
                                       k  vymaz n¡  kl ves  z  kl vesnicov‚
                                       vyrovn vac¡ pamˆti.

- Otev©en¡, uzav©en¡ (k¢dy 0DH, 0EH): Tyto    povely   se   pou‘¡vaj¡   pro
                                      za©¡zen¡,   kter    podporuj¡  funkci
                                      "otev©en¡/uzav©en¡/v˜mˆna m‚dia" (bit
                                      11    atributu   za©¡zen¡).   Blokov 
                                      za©¡zen¡  mohou  pou‘¡vat tento povel
                                      ke  spr vˆ lok ln¡ho vyrovn v n¡ dat.
                                      Po‘adavek  otev©en¡  m‚dia  (0DH)  se
                                      prov d¡  pro  ka‘d˜  soubor  p©i jeho
                                      otev©en¡,  uzav©en¡  m‚dia  (0EH)  se
                                      po‘aduje  p©i  uzav©en¡  souboru.  To
                                      umo‘¤uje  driveru  ur‡it  ‡as, kdy je
                                      mo‘n‚   vyjmout   disk   z  disketov‚
                                      mechaniky  a  prov dˆt  vyprazd¤ov n¡
                                      vyrovn vac¡ch     pamˆt¡.     Znakov 
                                      za©¡zen¡ mohou pou‘¡vat tyto povely k
                                      vysl n¡  inicializa‡n¡ho  ©etˆzce  na
                                      za©¡zen¡    (nap©.   tisk rnu)   nebo
                                      resetovat  za©¡zen¡  do  standardn¡ho
                                      stavu.

- V˜mˆna m‚dia (k¢d povelu 0FH): Tento   povel   se   pou‘¡v   pro  blokov 
                                 za©¡zen¡,     kter     podporuj¡    funkci
                                 "otev©en¡/uzav©en¡/v˜mˆna  m‚dia"  (bit 11
                                 atributu  za©¡zen¡).  Driver by mˆl sdˆlit
                                 DOSu,  zda  je  podporov na  v˜mˆna m‚dia.
                                 Povel    navrac¡    informaci    v    bitu
                                 "zanepr zdnˆn"  stavov‚ho  slova  za©¡zen¡
                                 (bit  9):  pokud  je tento bit = 0 znamen 
                                 to, ‘e m‚dium je v˜mˆnn‚ a naopak.

- Generov n¡ po‘adavku IOCTL (k¢d 13H): Drivery DOS ò 3.2, kter‚ v atributu
                                        za©¡zen¡   indikuj¡  podporu  IOCTL
                                        (©¡zen¡  vstupu/v˜stupu)  mus¡  b˜t
                                        schopny   toto   vol n¡  obslou‘it.
                                        Pou‘¡v    se   pro  r–zn‚  operace,
                                        v‡etnˆ    form tov n¡   disku.   Je
                                        navrhov no     ke     standardizaci
                                        mezistyku pro r–zn‚ typy disk– jako
                                        logick‚  drivery diskov˜ch za©¡zen¡
                                        DRIVER.SYS.   Dal¨¡  informace  viz
                                        funkci DOS 44H (IOCTL).

  ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po‘adavku                            º
  º 0DH (13) ³    1     ³ vstup:  ‡¡slo funkce                         º
  º 0EH (14) ³    1     ³ vstup:  ‡¡slo podfunkce                      º
  º 0FH (15) ³    2     ³ vstup:  hodnota v SI ve funkci DOS 44H       º
  º 11H (17) ³    4     ³ vstup:  hodnota p©ed van  v DI               º
  º 15H (21) ³    4     ³ vstup:  adresa bal¡ku dat IOCTL              º
  ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

- Poskytnut¡/nastaven¡ logick‚ho
  za©¡zen¡ (k¢dy povel– 17H a 18H): Drivery  DOS  ò  3.2,  kter‚ v atributu
                                    za©¡zen¡ indikuj¡ podporu IOCTL (©¡zen¡
                                    vstupu/v˜stupu)  mus¡  b˜t schopny toto
                                    vol n¡ obslou‘it. Pou‘¡v  se jako cesta
                                    k    p©¡stupu    na    "logick‚"   nebo
                                    "symbolick‚"  disky  instalovan‚ pomoc¡
                                    driveru  blokov˜ch za©¡zen¡ DRIVER.SYS.
                                    Zprost©edkov v    metodu   dotazu  nebo
                                    nastaven¡   driveru  na  logick˜  disk,
                                    kter˜  bude  aktivn¡  pro  dan˜ fyzick˜
                                    disk.    P©i    po‘adavku    poskytnut¡
                                    logick‚ho  disku  (18H)  by  mˆl driver
                                    um¡stit    identifik tor   driveru   do
                                    offsetu  0DH  (1=A,  2=B,  atd.). Pokud
                                    driver  obsluhuje pouze jeden disk, mˆl
                                    by  v  tomto  poli navracet v‘dy 0. Viz
                                    t‚‘  funkci DOS 44H (IOCTL) - podfunkce
                                    0EH a 0FH.

  ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po‘adavku                            º
  º 0DH (13) ³    1     ³ vstup:  k¢d jednotky                         º
  º          ³          ³ v˜stup: posledn¡ vzta‘n‚ za©¡zen¡            º
  º 0EH (14) ³    1     ³ vstup:  k¢d povelu                           º
  º 0FH (15) ³    2     ³ statut (nedokumentov no)                     º
  º 11H (17) ³    4     ³ adresa (rezervov no)                         º
  ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼





    ÿDÿrÿiÿvÿeÿr  ÿ©ÿ¡ÿzÿeÿnÿ¡  ÿkÿoÿnÿzÿoÿlÿy  ÿAÿNÿSÿIÿ.ÿSÿYÿS

    K  nainstalov n¡  driveru  pro roz¨¡©en‚ ovl d n¡ konzoly ANSI.SYS mus¡
b˜t    uveden    v   instala‡n¡m   souboru   CONFIG.SYS   p©¡kazov˜   © dek
DEVICE=ANSI.SYS.  U‘ivatelsk˜  program  potom m–‘e vys¡lat znaky na konzolu
pomoc¡  standardn¡ch  znakov˜ch  funkc¡  (nebo m–‘ete soubory vypsat pomoc¡
povelu TYPE nebo ECHO).

    V  n sleduj¡c¡  v˜pisu ozna‡uj¡ prvky v z vork ch () parametry (obvykle
numerick‚ hodnoty v ASCII form tu) a znak <ESC> je znak s k¢dem 1BH (27).
ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º            syntaxe        ³              funkce                         º
ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º <ESC>[(© dek);(pozice)H   ³ nastaven¡ pozice kurzoru (standardnˆ        º
º                           ³ je 1;1 - lev˜ horn¡ roh)                    º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[(© dek);(pozice)f   ³ stejn  funkce jako p©ede¨l                  º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[(© dk–)A            ³ p©esun kurzoru nahoru (standardn¡ po‡et     º
º                           ³ © dk– je 1; nejde p©es horn¡ okraj)         º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[(© dk–)B            ³ p©esun kurzoru dol– (standardn¡ po‡et       º
º                           ³ © dk– je 1; nejde p©es spodn¡ okraj)        º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[(pozic)C            ³ p©esun kurzoru vpravo; stand.=1             º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[(pozic)D            ³ p©esun kurzrou vlevo; stand.=1              º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[2J                  ³ zru¨en¡ obrazovky, kurzor do po‡ t.rohu     º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[K                   ³ zru¨en¡ zbytku © dku                        º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[6n                  ³ v˜stup akt.© dku a pozice ve formˆ:         º
º                           ³      <ESC>[(© dek);(pozice)R                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[s                   ³ ulo‘en¡ akt. pozice kurzoru (viz <ESC>[u)   º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[u                   ³ n vrat kurzoru na poslednˆ ulo‘enou pozici  º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[(atr.);...;(atr.)m  ³ nastaven¡ atribut– displeje. (atr.) jsou:   º
º                           ³     0 norm ln¡ (b¡l  na ‡ern‚)              º
º                           ³     1 zv˜raznˆn‚ (zv˜¨en  intenzita znak–)  º
º                           ³     4 podtr‘en‚ (pouze monochrom. displej)  º
º                           ³     5 blikaj¡c¡                             º
º                           ³     7 reverze (‡ern  na b¡l‚)               º
º                           ³     8 nezobrazuje (pozad¡=pop©ed¡)          º
º                           ³    30 ‡ern‚ pop©ed¡                         º
º                           ³    31 ‡erven‚ pop©ed¡                       º
º                           ³    32 zelen‚ pop©ed¡                        º
º                           ³    33 ‘lut‚ pop©ed¡                         º
º                           ³    34 modr‚ pop©ed¡                         º
º                           ³    35 fialov‚ pop©ed¡                       º
º                           ³    36 modrozelen‚ pop©ed¡                   º
º                           ³    37 b¡l‚ pop©ed¡                          º
º                           ³    40 ‡ern‚ pozad¡                          º
º                           ³    41 ‡erven‚ pozad¡                        º
º                           ³    42 zelen‚ pozad¡                         º
º                           ³    43 ‘lut‚ (hnˆd‚) pozad¡                  º
º                           ³    44 modr‚ pozad¡                          º
º                           ³    45 fialov‚ pozad¡                        º
º                           ³    46 modrozelen‚ pozad¡                    º
º                           ³    47 b¡l‚ pozad¡                           º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[=(m¢d)h             ³ nastaven¡ ¨¡©ky © dku obrazovky a videom¢du º
º                           ³     0 40x25 textov˜ m¢d ‡ern  a b¡l         º
º                           ³     1 40x25 textov˜ m¢d barevn˜             º
º                           ³     2 80x25 textov˜ m¢d ‡ern  a b¡l         º
º                           ³     3 80x25 textov˜ m¢d barevn˜             º
º                           ³     4 grafick˜ m¢d 320x200 barevn˜          º
º                           ³     5 grafick˜ m¢d 320x200 ‡ernob¡l˜        º
º                           ³     6 grafick˜ m¢d 640x200 ‡ernob¡l˜        º
º                           ³     7 p©esun kurzoru na konci © dku na nov˜ º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[=7l                 ³ kurzor se z konce © dku nep©esune na nov˜ ©.º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º <ESC>[(‡¡slo);...(‡¡slo)p ³ p©edefinuje kl vesu na jinou hodnotu; prvn¡ º
º       nebo                ³ ‡¡slo (nebo prvn¡ znak v ©etˆzci) ud v  k¢d º
º <ESC>["(©etˆzec)"p        ³ kl vesy, kter  m  b˜t p©edefinov na, n sle- º
º       nebo                ³ duj¡c¡ hodnoty jsou nov‚ hodnoty kl vesy    º
º <ESC>[(‡¡slo);"©etˆzec"p  ³   N sleduj¡c¡ p©¡klad p©edefinuje kl vesu   º
º       nebo                ³   F10 tak, aby vypsala DIR<Enter>:          º
º r–zn‚ kombinace           ³      <ESC>[0;68;"DIR";13p                   º
º                           ³   (viz roz¨¡©en‚ k¢dy kl ves)               º
º                           ³ K navr cen¡ k¢d– k ves na jejich p–vodn¡    º
º                           ³ hodnoty nastavte tyto kl vesy na jejich     º
º                           ³ p–vodn¡ k¢dy; nap©. n vrat hodnoty F10:     º
º                           ³      <ESC>[0;68;0;68p                       º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    K  zji¨tˆn¡,  zda  je ANSI.SYS nainstalov n, zobrazte funkci <ESC>[6n a
ihned ‡tˆte ze standardn¡ho vstupu. Mˆl byjste zde p©e‡¡st £daj ve tvaru:
    <ESC>[(© dek);(pozice)R.

    Je  obt¡‘n‚  experimentovat  se  sekvenc¡ ANSI p©¡mo z povelov‚ho © dku
syst‚mu DOS, nebo© DOS neumo‘¤uje p©¡m˜ vstup z kl vesnice znaku ESC. Jedna
z mo‘nost¡ je pou‘¡t syst‚mov˜ p©¡kaz PROMPT:

    PROMPT $e[7m                  nastav¡ inverzn¡ video
    PROMPT $e[0;68;"DIR";13p      p©edefinuje kl vesu F10 na "DIR"<Enter>
    PROMPT                        nastav¡ prompt do norm ln¡ho stavu






          ÿDÿrÿiÿvÿeÿr  ÿrÿoÿzÿ¨ÿ¡ÿ©ÿeÿnÿ‚  ÿpÿaÿmÿˆÿtÿi  ÿEÿMÿS

    Tato   kapitola  popisuje  form ln¡  specifikaci  Lotus/Intel/Microsoft
(EMS),  kter   se  pou‘¡v   k  p©¡stupu  k "roz¨i©uj¡c¡" pamˆti v syst‚mech
kompatibiln¡ch s PC.

Definice:

    - "Zvˆt¨en "  pamˆŸ  se  nach z¡  pouze  u  AT (po‡¡ta‡e PC zalo‘en‚ na
      procesoru  286). Je to pamˆŸ, kter  obsazuje fyzick˜ adresov˜ prostor
      nad  1  Megabajt.  V  DOS 3.2 se pou‘¡v  zvˆt¨en  pamˆŸ pouze pro RAM
      disky (viz p©eru¨en¡ INT 15H - funkce 87H a‘ 89H).

    - "Roz¨¡©en "   pamˆŸ   pou‘¡v   pamˆŸovou  desku  kompatibiln¡  s  EMS
      (Expanded  Memory  Specifikation  -  specifikace  roz¨¡©en‚ pamˆti) a
      softwarov˜  driver pro spr vn‚ p©ipojen¡ "str nek" pamˆti, kter  m–‘e
      b˜t  p©ep¡n na  na  nebo z fyzick˜ch adresov˜ch prostor– nad norm ln¡
      hranici  640  KB  (tj.  nad  A000:0000H  -  tyto  adresy  se norm lnˆ
      pou‘¡vaj¡ pro videopamˆŸ a BIOS-ROM). Deska EMS vytv ©¡ ‡ty©i str nky
      po 16 KB (celkem 64KB) adresovateln‚ pamˆti, kter‚ umo‘¤uj¡ zap¡nat a
      vyp¡nat a‘ 8 Megabajt– celkov‚ pamˆti.

    EMS  (specifikace  roz¨¡©en‚  pamˆti)  je  pr–myslov˜ standard d vaj¡c¡
program–m  jako  je  LOTUS  1-2-3  apod.  mo‘nost  ukl d n¡  dat pro dlouh‚
tabulky.  Pou‘¡v   se  tak‚  pro  RAM disky a pro tiskov‚ spoolery (tisky v
pozad¡).  Nˆkter‚  RAM-rezidentn¡  programy pou‘¡vaj¡ pamˆŸ EMS k uschov n¡
str nek  s  daty  a  programy  (z  d–vodu  spot©ebov n¡  minim ln¡ pamˆti z
adresov‚ho prostoru 640 KB).

    Pou‘it¡  pamˆti  EMS  se umo‘n¡ instalov n¡m driveru za©¡zen¡ se jm‚nem
za©¡zen¡ "EMSXXXX0" a je na nˆ odkazov no jako EMM (mana‘er EMS). K ur‡en¡,
zda  byl tento driver nainstalov n, m–‘ete pou‘¡t funkci DOS 3DH k pokusu o
otev©en¡  tohoto za©¡zen¡ jako souboru. Po prvn¡m otev©en¡ m–‘ete k z¡sk n¡
statutu  pou‘¡t  funkci DOS 44H (IOCTL) - podfunkci 07H. Pokud je n vratov˜
statut  (v  AL) = 0, potom nen¡ EMM instalov n a existuje pro nˆkter‚ £‡ely
diskov˜ soubor se jm‚nem "EMSXXXX0".

    Pokud  je  driver EMM instalov n, nastavuje vektor p©eru¨en¡ INT 67H na
sv‚  z hlav¡  za©¡zen¡.  Tak‘e  dal¨¡  cesta k testov n¡ p©¡tomnosti EMS je
testov n¡  adresy  vektoru  pro  INT 67H (0:091CH) a otestov n¡ offsetu 0AH
t‚to adresy. Zde by mˆl b˜t obsa‘en ©etˆzec znak– "EMSXXXX0".

    K  p©¡stupu na obsluhu roz¨¡©en‚ pamˆti (EMS) pou‘ijte vektor p©eru¨en¡
INT 67H s k¢dem funkce nastaven˜m v registru AH:
 
ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
ºk¢d funkce (AH) ³    v˜znam                                              º
ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º   40H (64)     ³ poskytnut¡ statutu EMM                                 º
º                ³ (pou‘ijte po uji¨tˆn¡ se, ‘e je EMM nainstalov n)      º
º                ³   v˜stup: AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   41H (65)     ³ poskytnut¡ fyzick‚ adresy segmentu r me‡ku EMS         º
º                ³ (64K ve ‡ty©ech 16K jednotk ch)                        º
º                ³   v˜stup: BX=adresa segmentu (pokud je AH=0)           º
º                ³           AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   42H (66)     ³ poskytnut¡ celkov‚/voln‚ pamˆti                        º
º                ³   v˜stup: DX=celkov˜ po‡et str nek EMS (16K ka‘d )     º
º                ³           BX=po‡et voln˜ch str nek EMS                 º
º                ³           AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   43H (67)     ³ otev©en¡ identifik toru EMM a p©idˆlen¡ str nky        º
º                ³   vstup:  BX=po‡et po‘adovan˜ch str nek                º
º                ³   v˜stup: DX=identifik tor EMM (dal¨¡ operace)         º
º                ³           AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   44H (68)     ³ mapov n¡ pamˆti                                        º
º                ³ (str nkov n¡ jedn‚ ze ‡ty© p©idˆlen˜ch str nek pamˆti  º
º                ³ do fyzick‚ho adresov‚ho prostoru)                      º
º                ³   vstup:  AL=‡¡slo fyzick‚ str nky (0 a‘ 3)            º
º                ³           BX=logick  str nka (0 a‘ [n-1], kde          º
º                ³               n je celkov˜ po‡et str nek na ident.     º
º                ³           DX=identifik tor EMM                         º
º                ³   v˜stup: AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   45H (69)     ³ uzav©en¡ identifik toru/uvolnˆn¡ str nek               º
º                ³ (uvoln¡ pamˆŸ p©idˆlenou funkc¡ EMM 43H)               º
º                ³   vstup:  DX=identifik tor EMM                         º
º                ³   v˜stup: AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   46H (70)     ³ poskytnut¡ ‡¡sla verze EMM                             º
º                ³   v˜stup: AL=‡¡slo verze EMM v k¢du BCD (0302H=3.2)    º
º                ³           AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   47H (71)     ³ ulo‘en¡ mapovac¡ho kontextu                            º
º                ³ (EMM ulo‘¡ aktu ln¡ mapov n¡ fyzick˜ch na logick‚      º
º                ³ str nky EMM, tak‘e programy nebo drivery za©¡zen¡      º
º                ³ mohou pou‘¡t sv‚ vlastn¡ mapov n¡ p©i sv‚m bˆhu)       º
º                ³   vstup:  DX=identifik tor EMM po‘adovan‚ho procesu    º
º                ³   v˜stup: AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   48H (72)     ³ navr cen¡ mapovac¡ho kontextu                          º
º                ³ (EMM navr t¡ str nkov‚ mapov n¡, kter‚ bylo ulo‘eno    º
º                ³ p©edch zej¡c¡m vol n¡ funkce 47H se stejn˜m identifi-  º
º                ³ k torem. Diskov‚ drivery a programy by mˆly toto       º
º                ³ pou‘¡t p©es n vratem do aplika‡n¡ho programu.)         º
º                ³   vstup:  DX=ovlada‡ EMM po‘adovan‚ho procesu          º
º                ³   v˜stup: AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   49H (73)     ³ rezervov no - pro EMM verze 3.2 nedefinov no           º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   4AH (74)     ³ rezervov no - pro EMM verze 3.2 nedefinov no           º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   4BH (75)     ³ po‡et str nek ovlada‡e                                 º
º                ³ (navrac¡ po‡et str nek EMS vlastnˆn‚ identifik torem)  º
º                ³   vstup:  DX=identifik tor EMM (proces m–‘e m¡t v¡ce   º
º                ³                                 ne‘ 1 identifik tor)   º
º                ³   v˜stup: BX=po‡et logick˜ch 16-K str nek vlastnˆn‚    º
º                ³              identifik torem (1-512)                   º
º                ³           AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   4CH (76)     ³ po‡et aktivn¡ch ovlada‡–                               º
º                ³ (pou‘¡v  se p©ed vol n¡m funkce EMM 4DH)               º
º                ³   vstup:  BX=‡¡slo aktivn¡ho identifik toru            º
º                ³           AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   4DH (77)     ³ poskytnut¡ informace o str nk ch (v¨echny identif.)    º
º                ³ (navrac¡ pole informac¡ popisuj¡c¡ kolik pamˆti EMS je º
º                ³ p©idˆleno aktivn¡mu identifik toru)                    º
º                ³   vstup:  ES:DI=adresa vyrovn vac¡ pamˆti              º
º                ³   v˜stup: BX=po‡et aktivn¡ch identifik tor– EMM        º
º                ³           ES:DI=vyrovn vac¡ pamˆŸ je zaplnˆna          º
º                ³                 2-slovn¡mi polo‘kami (po‡et je v BX).  º
º                ³                 Prvn¡ slovo je ‡¡slo identifik toru    º
º                ³                 a druh‚ je celkov˜ po‡et str nek       º
º                ³                 vlastnˆn˜ch t¡mto identifik torem      º
º                ³           AH=statut EMM                                º
ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
º   4EH (78)     ³ poskytnut¡/nastaven¡ mapy zadan‚ str nky               º
º                ³ (Tato funkce je navrhov na k podpo©e v¡ce£lohov‚ho     º
º                ³ opera‡n¡ho syst‚mu pro umo‘nˆn¡ pln‚ho ovl d n¡ EMS.   º
º                ³ Mapovac¡ pole m–‘e obsahovat r–zn‚ hardwarovˆ z visl‚  º
º                ³ informace.)                                            º
º                ³   vstup:  AL=‡¡slo podfunkce                           º
º                ³              AL=0 - poskytnut¡ mapovac¡ch registr–     º
º                ³                     do pole na adrese ES:DI            º
º                ³              AL=1 - nastaven¡ mapovac¡ch registr–      º
º                ³                     z pole na adrese DS:SI             º
º                ³              AL=2 - poskytnut¡ a nastaven¡ mapovac¡ch  º
º                ³                     registr– (kombinace funkc¡ 1 a 2)  º
º                ³              AL=3 - dotaz na velikost vyrovn vac¡      º
º                ³                     pamˆti pot©ebn‚ pro funkce 0 a‘ 2  º
º                ³   v˜stup: AL=velikost bufferu mapovac¡ch registr– (fn3)º
º                ³           ES:DI=buffer obsahuje pole informac¡ EMS     º
º                ³                 (podfunkce 0 a‘ 2)                     º
º                ³           AH=statut EMM                                º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Po n vratu z funkce zkontrolujte statut v AH. Pokud nen¡ AH=0, potom
tato funkce nebyla provedena. Chyby navr cen‚ v AH:

   ÉÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
   º statut ³      v˜znam                                              º
   ÌÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
   º  00H   ³      ‘ dn  chyba; funkce byla £spˆ¨n                     º
   º  80H   ³      vnit©n¡ chyba driveru EMM                           º
   º  81H   ³      hardwarov  chyba funkce pamˆŸov‚ desky EMS          º
   º  82H   ³      EMM je zanepr zdnˆn                                 º
   º  83H   ³      neplatn˜ identifik tor                              º
   º  84H   ³      po‘adovan  nedefinovan  funkce                      º
   º  85H   ³      nen¡ voln˜ ‘ dn˜ dal¨¡ identifik tor EMM            º
   º  86H   ³      chyba v ulo‘en¡ nebo navr cen¡ mapovac¡ho kontextu  º
   º  87H   ³      aloka‡n¡ po‘adavek byl del¨¡ ne‘ celkov  pamˆŸ EMS  º
   º  88H   ³      aloka‡n¡ po‘adavek byl del¨¡ ne‘ voln‚ str nky      º
   º  89H   ³      nem–‘ete otev©¡t identifik tor s po‡tem str nek 0   º
   º  8AH   ³      v ¨ identifik tor nevlastn¡ tak mnoho str nek       º
   º  8BH   ³      nepovolen‚ mapov n¡ - jsou definov ny pouze fyzick‚ º
   º        ³      str nky 0 a‘ 3                                      º
   º  8CH   ³      prostor pro ukl d n¡ mapovac¡ch kontext– je pln˜    º
   º  8DH   ³      m–‘ete ulo‘it kontext pouze jednou na identifik tor º
   º  8EH   ³      nem–‘ete navr tit kontext bez p©edchoz¡ho ulo‘en¡   º
   º  8FH   ³      parametr podfunkce nen¡ definovan˜                  º
   ÈÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼






                         ÿPÿ©ÿeÿrÿuÿ¨ÿeÿnÿ¡  ÿDÿOÿS

    Pro  DOS  jsou  vyhrazena  p©eru¨en¡  INT 20H a‘ INT 3FH. Tabulka adres
obslu‘n˜ch  program–  p©eru¨en¡ (vektory p©eru¨en¡) je um¡stˆna na adres ch
80H  -  FCH. U‘ivatelsk‚ programy mohou vy‘adovat pouze p©eru¨en¡ 20H, 21H,
25H,  26H  a  27H  (pro  DOS  verze  2.0  a vy¨¨¡ jsou nejlep¨¡ metodou pro
vy‘ d n¡  p©eru¨en¡  20H  a 27H funkce 4CH a 31H). P©eru¨en¡ 22H, 23H a 24H
nemohou  b˜t  po‘adov na  u‘ivatelsk˜mi  programy;  jsou  to pouze pamˆŸov 
m¡sta, kde je ulo‘ena adresa segmentu a relativn¡ adresy.

INT  20H (INT 32; 0:0080H) - ukon‡en¡ programu
INT  21H (INT 33; 0:0084H) - vol n¡ funkce DOS
INT  22H (INT 34; 0:0088H) - adresa ukon‡en¡ programu
INT  23H (INT 35; 0:008CH) - adresa obsluhy p©eru¨en¡ <Ctrl>-<Break>
INT  24H (INT 36; 0:0090H) - adresa obsluhy kritick˜ch chyb
INT  25H (INT 37; 0:0094H) - absolutn¡ ‡ten¡ z disku
INT  26H (INT 38; 0:0098H) - absolutn¡ z pis na disk
INT  27H (INT 39; 0:009CH) - ukon‡en¡ s ponech n¡m programu v pamˆti
INT  28H (INT 40; 0:00A0H) - ‡asov n¡ £sek– DOS
INT  29H (INT 41; 0:00A4H) - rezervov no
INT  2AH (INT 42; 0:00A8H) - rezervov no
INT  2BH (INT 43; 0:00ACH) - rezervov no
INT  2CH (INT 44; 0:00B0H) - rezervov no
INT  2DH (INT 45; 0:00B4H) - rezervov no
INT  2EH (INT 46; 0:00B8H) - proveden¡ povelu DOS
INT  2FH (INT 47; 0:00BCH) - p©ep¡nateln‚ p©eru¨en¡ (DOS)
INT  30H (INT 48; 0:00C0H) - rezervov no
INT  31H (INT 49; 0:00C4H) - rezervov no
INT  32H (INT 50; 0:00C8H) - rezervov no
INT  33H (INT 51; 0:00CCH) - rezervov no
INT  34H (INT 52; 0:00D0H) - rezervov no
INT  35H (INT 53; 0:00D4H) - rezervov no
INT  36H (INT 54; 0:00D8H) - rezervov no
INT  37H (INT 55; 0:00DCH) - rezervov no
INT  38H (INT 56; 0:00E0H) - rezervov no
INT  39H (INT 57; 0:00E4H) - rezervov no
INT  3AH (INT 58; 0:00E8H) - rezervov no
INT  3BH (INT 59; 0:00ECH) - rezervov no
INT  3CH (INT 60; 0:00F0H) - rezervov no
INT  3DH (INT 61; 0:00F4H) - rezervov no
INT  3EH (INT 62; 0:00F8H) - rezervov no
INT  3FH (INT 63; 0:00FCH) - rezervov no




ÿIÿNÿTÿ  ÿ2ÿ0ÿH (INT 32; 0:0080H) - ukon‡en¡ programu

    vstup:    CS = adresa segmentu prefixu programov‚ho segmentu

    v˜stup:   nen¡

    P©eru¨en¡  INT 20H ukon‡¡ zpracov van˜ proces a vr t¡ ©¡zen¡ otcovsk‚mu
procesu   (norm lnˆ   to  je  povelov˜  interpreter  COMMAND.COM).  V¨echny
vyrovn vac¡  pamˆti soubor– se vypr zdn¡, navr t¡ se p–vodn¡ obsahy vektor–
p©eru¨en¡  INT  22H  (ukon‡en¡  programu),  INT  23H (obsluha u‘ivatelsk‚ho
p©eru¨en¡  Ctrl-Break) a INT 24H (obsluha kritick‚ chyby) a p©ed  se ©¡zen¡
na adresu vektoru p©eru¨en¡ INT 22H.

    P©ed  vyvol n¡m  tohoto  p©eru¨en¡  mus¡  registr  CS  obsahovat adresu
segmentu  prefixu  programov‚ho  segmentu PSP. Pokud obsah registru CS nen¡
roven  segmentu PSP, m–‘ete prov‚st instrukci skoku JMP na adresu PSP:0000H
nebo instrukci RET (provede se skok na tuto adresu). Z prefixu programov‚ho
segmentu jsou po ukon‡en¡ obnoveny n sleduj¡c¡ n vratov‚ adresy:

           ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
           º v˜stupn¡ adresa              ³  relativn¡ adresa  º
           ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
           º ukon‡en¡ programu (INT 22H)  ³         0AH        º
           º <Ctrl>-<Break> (INT 23H)     ³         0EH        º
           º kritick  chyba (INT 24H)     ³         12H        º
           ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

Pozn.: P©ed  vy‘ d n¡m  tohoto  p©eru¨en¡ je nutno uzav©¡t v¨echny soubory,
       kter‚ zmˆnily svou d‚lku. Nen¡-li zmˆnˆn˜ soubor uzav©en, jeho d‚lka
       se  nezaznamen   do adres ©e spr vnˆ (viz funkce 10H a 3EH pro popis
       uzav©en¡ souboru).

       P©eru¨en¡ je ekvivalentn¡ funkci 00H (p©eru¨en¡ INT 21H).

       P©eru¨en¡  INT  20H  se pou‘¡v  t‚mˆ© v‘dy pro ukon‡en¡ ‡innosti p©i
       pou‘it¡ star˜ch .COM soubor–. Nov‚ programy by mˆly v¨echny pou‘¡vat
       funkci  4CH  (ukon‡en¡  procesu),  neboŸ tato funkce nevy‘aduje, aby
       registr  CS  ukazoval  adresu segmentu PSP a nav¡c umo‘¤uje p©ed vat
       otcovsk‚mu procesu v˜stupn¡ k¢d.

       Programy  ve form tu COM obvykle bˆ‘¡ s nastaven˜m registrem CS=PSP,
       tak‘e  mohou  kdykoliv  prov‚st  ukon‡en¡  programu  pomoc¡ INT 20H.
       Programy ve tvaru EXE by mˆly prov‚st instrukce FAR JMP nebo FAR RET
       k  p©ed n¡  ©¡zen¡ na adresu PSP:0000H, kter  obsahuje instrukci INT
       20H.

       Z tohoto p©eru¨en¡ neexistuje mo‘nost n vratu.




ÿIÿNÿTÿ  ÿ2ÿ1ÿH (INT 33; 0:0084H) - vol n¡ funkce DOS

    vstup:    AH = ‡¡slo funkce
              ostatn¡ registry = obsah podle po‘adavk– funkc¡

    v˜stup:   podle specifikac¡ jednotliv˜ch funkc¡

    Toto  p©eru¨en¡  je  vstupn¡m  bodem  do  vˆt¨iny  funkc¡  DOS. Program
po‘aduj¡c¡  funkci DOS mus¡ p©ipravit nejd©¡ve v¨echny registry a informace
v  ©¡d¡c¡ch  bloc¡ch, nastavit do registru AH ‡¡slo po‘adovan‚ funkce DOS a
potom  vyvolat  p©eru¨en¡  INT  21H.  Popis jednotliv˜ch funkc¡ viz "Slu‘by
modulu DOS".





ÿIÿNÿTÿ  ÿ2ÿ2ÿH (INT 34; 0:0088H) - adresa ukon‡en¡ programu

    P©i  ukon‡en¡  programu  se  p©ed   ©¡zen¡  na adresu popsanou vektorem
INTú22H  (adresa  vektoru  je  0000:0088H).  Tuto  adresu  kop¡ruje DOS p©i
vytvo©en¡  programov‚ho segmentu PSP (p©i vyvol n¡ programu funkc¡ 4BH nebo
p©i  vyvol n¡  funkce  26H  -  vytvo©en¡ PSP) do jeho prefixu na adresu 0AH
(adresa ukon‡en¡ programu). N vratovou adresu z programu lze zmˆnit vol n¡m
funkce  25H  (nastaven¡  vektoru  p©eru¨en¡).  DOS  norm lnˆ nastavuje tuto
adresu p©i prov dˆn¡ programu vol n¡m funkce EXEC. P©i ukon‡en¡ programu se
adresa   INTú22H  navr t¡  z  prefixu  programov‚ho  segmentu  ukon‡ovan‚ho
programu  zpˆt  do p–vodn¡ho stavu. Program m–‘e b˜t ukon‡en buƒ p©eru¨en¡m
INT 20H nebo INT 27H nebo funkcemi 00H, 4CH (EXIT) nebo 31H (KEEP).

    DOS  pou‘ije  tento  vektor  t‚‘  p©i po‘adavku p©eru¨en¡ bˆhem INT 24H
(obsluha kritick‚ chyby).

Pozn.: Nevyvol vejte INT 22H ani obsluhu tohoto p©eru¨en¡ p©¡mo.




ÿIÿNÿTÿ  ÿ2ÿ3ÿH (INT 35; 0:008CH) - adresa obsluhy p©eru¨en¡ Ctrl-Break

    Jestli‘e  u‘ivatel  bˆhem  vstupu  z kl vesnice nebo v˜stupu na displej
stiskne  <Ctrl>-<Break>  (<Ctrl>-C),  p©ed   se  ©¡zen¡  na  adresu obsluhy
p©eru¨en¡ Ctrl-Break ur‡enou vektorem INT 23H. Tato adresa se p©i vytvo©en¡
programov‚ho   segmentu  (tj.  p©i  funkci  DOS  26H  -  vytvo©en¡  prefixu
programov‚ho segmentu PSP, nebo funkci DOS 4BH - na‡ten¡ programu do pamˆti
a  jeho  start)  kop¡ruje  do  jeho prefixu na relativn¡ adresu 0EH (adresa
obsluhy  p©eru¨en¡  Ctrl-Break).  Po  ukon‡en¡  programu se p–vodn¡ hodnota
vektoru INT 23H z t‚to adresy PSP navr t¡.

    Jestli‘e  rutina obsluhy Ctrl-Break uchov v  v¨echny registry, m–‘e b˜t
ukon‡ena  pomoc¡  instrukce IRET (n vrat z p©eru¨en¡) a pokra‡uje prov dˆn¡
programu.  P©i  v˜skytu  p©eru¨en¡  se v¨echny registry nastav¡ na hodnotu,
kterou  mˆly  v  okam‘iku,  kdy  program  volal funkci DOS, kter  zp–sobila
p©eru¨en¡  Ctrl-Break.  Na  ‡innost obsluhy Ctrl-Break nejsou kladena ‘ dn 
omezen¡  -  v‡etnˆ  vol n¡  funkc¡ DOSu - za p©edpokladu, ‘e se p©i pou‘it¡
IRET  nezmˆn¡  registry.  Av¨ak  pokud  obslu‘n˜ program p©eru¨en¡ obsahuje
funkce  DOS pro znakov˜ vstup/v˜stup a u‘ivatel opˆt stiskne <Ctrl>-<Break>
(<Ctrl>-C), opera‡n¡ syst‚m havaruje. K nastaven¡ vektoru INT 23H na adresu
va¨eho  obslu‘n‚ho  programu  pou‘ijte  funkci  25H. Pokud chcete p©eru¨en¡
Ctrl-Break ignorovat, nastavte jako obsluhu p©eru¨en¡ pouze instrukci IRET.

    Jestli‘e  je pomoc¡ <Ctrl>-<Break> p©eru¨ena funkce 09H (v˜stup ©etˆzce
na obrazovku) nebo 0AH (vstup ©etˆzce z kl vesnice), objev¡ se na obrazovce
posloupnost bajt– 03H, 0DH, 0AH (ETX, CR, LF; bajt 03H se zobraz¡ jako text
"^C")  a  funkce  pokra‡uje  na  za‡ tku  dal¨¡ho © dku. Standardn¡ obsluha
p©eru¨en¡  INT  23H  zp–sob¡  n vrat  do  otcovsk‚ho  procesu  (obvykle  do
povelov‚ho interpreteru COMMAND.COM).

    Jestli‘e program vytv ©¡ nov˜ segment a zav d¡ do pamˆti druh˜ program,
kter˜  mˆn¡ adresu obsluhy Ctrl-Break, pak se p©i ukon‡en¡ druh‚ho programu
hodnota  adresy  obsluhy  Ctrl-Break vr t¡ do stavu p©ed prov dˆn¡m druh‚ho
programu (hodnota vektoru se obnov¡ s prefixu programov‚ho segmentu PSP).

    Norm lnˆ  prov d¡  DOS  kontrolu  p©eru¨en¡ Break pouze bˆhem znakov˜ch
vstupnˆ/v˜stupn¡ch  funkc¡  - tj. p©¡stup na konzolu, tisk rnu nebo s‚riov‚
rozhran¡,  s  roz¨¡©enou kontrolou Break (viz p©eru¨en¡ INTú21H/funkce 33H)
tak‚  bˆhem  v¨ech  ostatn¡ch vstupnˆ/v˜stupn¡ch funkc¡ (kromˆ funkc¡ 06H a
07H).

    Pokud  si  p©ejete  abortovat  program  (n vrat do otcovsk‚ho procesu),
nastavte  p©¡znak  p©enosu CF a proveƒte instrukci n vratu pomoc¡ instrukce
FAR  RET.  To zp–sob¡, ‘e DOS provede norm ln¡ £klid a odchod do otcovsk‚ho
procesu.

    Nejjednodu¨¨¡  cestou,  jak  zajistit spr vnou odezvu procesu na zad n¡
<Ctrl>-<Break>  (<Ctrl>-C),  je  prov dˆt  ka‘dou  chv¡li  funkci  DOS  0BH
(kontrola vstupn¡ho statutu konzoly).




ÿIÿNÿTÿ  ÿ2ÿ4ÿH (INT 36; 0:0090H) - adresa obsluhy kritick˜ch chyb

    vstup:    AX = dopl¤uj¡c¡ informace o chybˆ
              DI = k¢d chyby
              BP:SI = z hlav¡ za©¡zen¡

    Jestli‘e  se  p©i  prov dˆn¡  syst‚mov˜ch  slu‘eb  I/O  na disku objev¡
kritick   chyba  disku (nap©. vadn˜ sektor nebo jin  chyba hardware), p©ed 
se  ©¡zen¡ na adresu ur‡enou vektorem INT 24H. Tato adresa se p©i vytvo©en¡
programov‚ho   segmentu   (pomoc¡   funkce  DOS  26H  -  vytvo©en¡  prefixu
programov‚ho  segmentu  PSP,  nebo funkce DOS 4BH - na‡ten¡ programu a jeho
start)  kop¡ruje  do  jeho  prefixu  na  relativn¡  adresu 12H. Po ukon‡en¡
programu  (tj. p©i n vratu do otcovsk‚ho procesu) se adresa vektoru INT 24H
z  prefixu programov‚ho segmentu opˆt obnov¡ na p–vodn¡ hodnotu, jakou mˆla
p©ed startem programu.

    Kdy‘  p©eru¨en¡  INT  24H  p©ed   ©¡zen¡  programu  pro o¨et©en¡ chyby,
registry AX a DI obsahuj¡ k¢dy popisuj¡c¡ tuto chybu (tyto hodnoty registr–
nastavuje  syst‚mov   slu‘ba  p©ed  vyvol n¡m  p©eru¨en¡ INT 24H). Pokud se
chyba  vztahuje  k diskov˜m operac¡m, je bit 7 registru AH vynulov n. Je-li
bit  7  registru  AH  nastaven  na  1,  znamen  to obvykle, ‘e se nejedn  o
diskovou  chybu (a‡koliv chyba ve ¨patn‚m zobrazen¡ tabulky alokace soubor–
FAT  tak‚  nastavuje bit 7 registru AH na 1). Bity 0-7 registru DI obsahuj¡
k¢d  chyby  (bity  8-15  nejsou definov ny). Registry BP:SI obsahuj¡ adresu
©¡d¡c¡ho   bloku  z hlav¡  za©¡zen¡,  kde  mohou  b˜t  vyhled ny  dopl¤kov‚
informace.

     V  p©¡padˆ, kdy je 7. bit AH vynulov n (tj. chyba blokov‚ho za©¡zen¡),
obsahuje  AL identifika‡n¡ ‡¡slo diskov‚ mechaniky (0=A, 1=B, atd.), bity 0
a‘  5  registru  AH  obsahuj¡c¡ tyto dopl¤uj¡c¡ informace (bity 3 a‘ 5 jsou
definov ny pouze pro opera‡n¡ syst‚m DOS 3.x a vy¨¨¡):

ÉÍÍÍÑÍÍÍÑÍÍÍÑÍÍÍÑÍÍÍÑÍÍÍÑÍÍÍÑÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º 7 ³ 6 ³ 5 ³ 4 ³ 3 ³ 2 ³ 1 ³ 0 ³                v˜znam                   º
ÌÍÍÍØÍÍÍØÍÍÍØÍÍÍØÍÍÍØÍÍÍØÍÍÍØÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 0 ³ 0 ³ . ³ . ³ . ³ . ³ . ³ 0 ³ chyba ‡ten¡                             º
º 0 ³ 0 ³ . ³ . ³ . ³ . ³ . ³ 1 ³ chyba z pisu                            º
º 0 ³ 0 ³ . ³ . ³ . ³ 0 ³ 0 ³ . ³ chyba zahrnuj¡c¡ syst‚mov‚ soubory DOS  º
º 0 ³ 0 ³ . ³ . ³ . ³ 0 ³ 1 ³ . ³ chyba zahrnuj¡c¡ FAT disku              º
º 0 ³ 0 ³ . ³ . ³ . ³ 1 ³ 0 ³ . ³ chyba zahrnuj¡c¡ adres © disku          º
º 0 ³ 0 ³ . ³ . ³ . ³ 1 ³ 1 ³ . ³ chyba zahrnuj¡c¡ datov˜ prostor disku   º
º 0 ³ 0 ³ . ³ . ³ 1 ³ . ³ . ³ . ³ mo‘n‚ opu¨tˆn¡ operace s FAIL-chyba     º
º 0 ³ 0 ³ . ³ 1 ³ . ³ . ³ . ³ . ³ mo‘n‚ opu¨tˆn¡ operace s RETRY-opakov n¡º
º 0 ³ 0 ³ 1 ³ . ³ . ³ . ³ . ³ . ³ mo‘n‚ opu¨tˆn¡ operace s IGNORE-ignorov.º
ÈÍÍÍÏÍÍÍÏÍÍÍÏÍÍÍÏÍÍÍÏÍÍÍÏÍÍÍÏÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    V  p©¡padˆ,  ‘e  je  7.  bit  registru AH nastaven (tj. chyba znakov‚ho
za©¡zen¡), nejsou bity 0 a‘ 6 registru AH definov ny.

    Bity  0-7 registru DI obsahuj¡ n sleduj¡c¡ informace (vy¨¨¡ bity nejsou
definov na):

 ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º chybov˜ k¢d  ³                      popis                            º
 ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º  00H ( 0)    ³       pokus o z pis na disk chr nˆn˜ proti z pisu     º
 º  01H ( 1)    ³       nezn m‚ ‡¡slo jednotky (diskov‚)                º
 º  02H ( 2)    ³       diskov  jednotka nen¡ p©ipravena                º
 º  03H ( 3)    ³       neplatn˜ p©¡kaz                                 º
 º  04H ( 4)    ³       chyba dat (chyba kontroln¡ho sou‡tu CRC)        º
 º  05H ( 5)    ³       ¨patn  d‚lka struktury po‘adavku                º
 º  06H ( 6)    ³       chyba p©i vystaven¡                             º
 º  07H ( 7)    ³       nezn m˜ typ m‚dia                               º
 º  08H ( 8)    ³       sektor nenalezen                                º
 º  09H ( 9)    ³       v tisk rnˆ nen¡ pap¡r                           º
 º  0AH (10)    ³       chyba p©i z pisu                                º
 º  0BH (11)    ³       chyba ‡ten¡                                     º
 º  0CH (12)    ³       v¨eobecn , nespecifikovateln  chyba             º
 ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    P©eru¨en¡  obsluhy  kritick‚ chyby m–‘ete obslou‘it nab¡dkou dal¨¡ akce
u‘ivateli  (tj.  nap©.  v˜zva  k  uzav©en¡  dv¡©ek disketov‚ mechaniky nebo
zapnut¡  tisk rny).  Obsluha  p©eru¨en¡  INT  24H by nemˆla pou‘¡vat funkce
DOSu.  Je-li  to  nezbytn‚, m–‘e pou‘¡t funkce 01H a‘ 0CH (znakov‚ vstupy a
v˜stupy)  a  funkci  59H (roz¨i©uj¡c¡ chybov‚ informace). Pou‘it¡ jak‚koliv
jin‚ slu‘by zni‡¡ z sobn¡k DOSu a ponech  DOS v nedefinovan‚m stavu. Pomoc¡
funkce  DOS  59H  (roz¨i©uj¡c¡ chybov‚ informace) a pomoc¡ z hlav¡ za©¡zen¡
adresovan‚ho BP:SI m–‘ete obdr‘et roz¨i©uj¡c¡ informace o vznikl‚ chybˆ.

    U‘ivatelsk˜  z sobn¡k  bude  na  za‡ tku  programu pro obsluhu kritick‚
chyby   obsahovat   hodnoty  nastaven¡  registr–  programu,  kter˜  vyvolal
p©¡slu¨nou  funkci  DOS.  K navr cen¡ tˆchto informac¡ pou‘ijte n sleduj¡c¡
instrukce:

         push      bp                  ; pomocn‚ ulo‘en¡ registru BP
         mov       bp,sp               ; BP jako ukazatel dat v z sobn¡ku

    Obsah  dat  v u‘ivatelsk‚m z sobn¡ku od vrcholu na dno z sobn¡ku (prvn¡
polo‘ka d le popsan  je na vrcholu z sobn¡ku, tedy naposledy ulo‘en ) je:
 
ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º  SP      ³ hodnota BP, kter  byla ulo‘ena pomocnou instrukc¡ PUSH BP   º
º  SP +  2 ³ CS:IP ukazatel slu‘by DOS, kter  vyvolala p©eru¨en¡ INT 24H º
º  SP +  6 ³ registr p©¡znak– p©i p©eru¨en¡ ze slu‘by DOS                º
º  SP +  8 ³ AX (u‘ivatelsk˜ registr v okam‘iku p–vodn¡ ‘ dosti INT 21H) º
º  SP + 10 ³ BX                        -  "  -                           º
º  SP + 12 ³ CX                        -  "  -                           º
º  SP + 14 ³ DX                        -  "  -                           º
º  SP + 16 ³ SI                        -  "  -                           º
º  SP + 18 ³ DI                        -  "  -                           º
º  SP + 20 ³ BP                        -  "  -                           º
º  SP + 22 ³ DS                        -  "  -                           º
º  SP + 24 ³ ES                        -  "  -                           º
º  SP + 26 ³ CS:IP z programu, kter˜ p–vodˆ vyvolal slu‘bu INT 21H       º
º  SP + 30 ³ registr p©¡znak– z programu, kter˜ p–vodnˆ vyvolal slu‘bu   º
ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Tyto  informace  lze  pou‘¡t  k ur‡en¡, kter  funkce DOS vyvolala chybu
(‡¡slo  funkce  je  ulo‘eno v z sobn¡ku na offsetu SP+9, tj. v u‘ivatelsk‚m
registru AH, parametry jsou ulo‘eny v ostatn¡ch registrech).

    P©i  n vratu z p©eru¨en¡ instrukc¡ IRET (po obsluze chyby nebo pokusu o
jej¡ odstranˆn¡) bude DOS pokra‡ovat v ‡innosti podle obsahu AL takto:

AL = 0 - ignorov n¡ chyby
   = 1 - opakov n¡ operace
   = 2 - ukon‡en¡ programu prost©ednictv¡m INT 23H (abortov n¡)
   = 3 - n vrat do aplika‡n¡ho programu s ohl ¨en¡m chyby DOS (ò DOS 3.00)

    Volba  AL=3  by  se zd la b˜t nejvodnˆj¨¡. Nap©¡klad: pokud operace pro
otev©en¡ souboru zp–sob¡ chybu vzniklou z d–vodu nedostatku m¡sta na disku,
bylo  by  mo‘n‚  nechat  v ¨  program  obslou‘it tento stav bˆ‘n˜mi zp–soby
obsluhy chyb. Av¨ak to m  tyto nev˜hody:

    - volba AL=3 nen¡ povolen  pro verze DOS men¨¡ ne‘ DOS 3.00
    - DOS  v‘dy  navrac¡  chybov˜  k¢d  53H  (chyba  obsluhy kritick‚ chyby
      INTú24H), kter˜ neobsahuje mnoho informac¡


Pozn.: P©ed  p©ed n¡m  ©¡zen¡ obluze p©eru¨en¡ INT 24H v d–sledku diskov˜ch
       chyb se DOS pˆtkr t pokou¨¡ o nov‚ proveden¡ operace.

       Rutina se spust¡ v zablokovan‚m stavu.

       Registry SS, SP, DS, ES, BX, CX a DX je nutno zachovat.

       P©eru¨ovac¡ program nesm¡ zmˆnit obsah z hlav¡ za©¡zen¡.

       Norm ln¡  obsluha  p©eru¨en¡ INT 24H nab¡dne u‘ivateli mo‘nost volby
       dal¨¡ ‡innosti DOS:
                 Abort, Retry, Ingore, Fault ? _
            (tj. Abortovat, opakovat, ignorovat, ohl sit chybu ?)

       P©eru¨en¡  INT  24H se neprovede, jestli‘e se chyba objev¡ v pr–bˆhu
       prov dˆn¡  p©eru¨en¡  INT 25H (absolutn¡ ‡ten¡ z disku) nebo INT 26H
       (absolutn¡ z pis na disk). Tyto chyby se obvykle zpracov vaj¡ pomoc¡
       chybov‚ho programu DOS v souboru COMMAND.COM, kter˜ diskovou operaci
       znovu  spust¡,  pak  d v   u‘ivateli  mo‘nost, aby zru¨il nebo znovu
       spustil operaci nebo chybu ignoroval.

       Jestli‘e  p©eru¨ovac¡  program  bude  chyby  o¨et©ovat  m¡sto aby se
       vr til  do DOSu (do funkce, kter  vyvolala obsluhu chyby), mˆl by ze
       z sobn¡ku  obnovit  registry aplika‡n¡ho programu, odstranit v¨echna
       slova  ze  z sobn¡ku  kromˆ  posledn¡ch t©¡ (tj. n vratov  adresa do
       aplika‡n¡ho  programu  a  registr  p©¡znak–) a pak prov‚st instrukci
       IRET.  T¡m  se  vr t¡  do programu bezpost©ednˆ za instrukci INT 21H
       volaj¡c¡  funkci,  kter  zp–sobila chybu. Je nutno si uvˆdomit, ‘e v
       takov‚m  p©¡padˆ  bude DOS v nestabiln¡m stavu dokud nebude vyvol na
       funkce  vy¨¨¡  ne‘  0CH.  Bˆ‘nˆ je chyba indikov na p©ed n vratem do
       aplika‡n¡ho  programu  nastaven¡m  chybov‚ho  k¢du  do registru AX a
       nastaven¡m  p©¡znaku  p©enosu  CF  na 1 jako indikace chyby (vˆt¨ina
       dobr˜ch program– tuto techniku pou‘¡v ).







ÿIÿNÿTÿ  ÿ2ÿ5ÿH (INT 37; 0:0094H) - absolutn¡ ‡ten¡ z disku

    vstup:    AL = ‡¡slo diskov‚ jednotky (0=A, 1=B, atd.)
              DS:BX = adresa vyrovn vac¡ pamˆti (kam se provede ‡ten¡)
              CX = po‡et sektor–, kter‚ se maj¡ ‡¡st
              DX = po‡ te‡n¡ relativn¡ sektor (od za‡ tku disku)

    v˜stup:   AX = chybov˜ k¢d (je-li CF=1)
              p©¡znaky = DOS ponech  registr p©¡znak– v z sobn¡ku !

    P©eru¨en¡ INT 25H zp–sob¡ na‡ten¡ CX sektor– od sektoru DX z disku nebo
logick‚ho  za©¡zen¡  AL  do  vyrovn vac¡  pamˆti na adresu DS:BX. P©eru¨en¡
pou‘¡v   slu‘by  modulu  BIOS - ‡ten¡ sektoru z disku. Logick˜ sektor disku
za‡¡n   zav dˆc¡m  sektorem. U pevn‚ho disku je prvn¡ logick˜ sektor prvn¡m
(zav dˆc¡m)  sektorem  partie  disku,  nen¡ tedy fyzicky prvn¡m sektorem na
prvn¡ stopˆ disku - hlavn¡ zav dˆc¡ z znam pevn‚ho disku nen¡ touto slu‘bou
v–bec  p©¡stupn˜  (je  nutn‚  pou‘¡t  p©eru¨en¡ INT 13H). Logick‚ ‡¡slov n¡
sektor– na disku se zvy¨uje od ‡¡sla 0 po ka‘d‚m sektoru na stopˆ, potom po
ka‘d‚ hlavˆ a nakonec po ka‘d‚m v lci na disku.

    Chybov‚ k¢dy navr cen‚ v registru AH (pokud je CF nastaven na 1):
 ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º chybov˜ k¢d  ³                      popis                            º
 ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º  01H (  1)   ³       neplatn˜ povel                                  º
 º  02H (  2)   ³       adresov  zna‡ka nenalezena                      º
 º  03H (  3)   ³       pokud o z pis na disk chr nˆn˜ proti z pisu     º
 º  04H (  4)   ³       sektor nenalezen                                º
 º  05H (  5)   ³       chyba funkce reset                              º
 º  07H (  7)   ³       chyba aktivity diskov˜ch parametr–              º
 º  08H (  8)   ³       p©ete‡en¡ DMA                                   º
 º  09H (  9)   ³       chyba p©ekro‡en¡ okraje DMA                     º
 º  10H ( 16)   ³       chyba dat CRC nebo ECC                          º
 º  11H ( 17)   ³       mo‘n  chyba opravena pomoc¡ ECC (AL = d‚lka)    º
 º  20H ( 32)   ³       chyba ©adi‡e                                    º
 º  40H ( 64)   ³       chybn‚ vystaven¡                                º
 º  80H (128)   ³       time-out diskov‚ mechaniky                      º
 º  BBH (187)   ³       nedefinovateln  chyba                           º
 º  FFH (255)   ³       chyba rozpozn n¡ operace                        º
 ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Chybov‚ k¢dy navr cen‚ v registru AL:
 ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º chybov˜ k¢d  ³                      popis                            º
 ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º  00H ( 0)    ³       pokus o z pis na disk chr nˆn˜ proti z pisu     º
 º  01H ( 1)    ³       nezn m‚ ‡¡slo jednotky (diskov‚)                º
 º  02H ( 2)    ³       diskov  jednotka nen¡ p©ipravena                º
 º  03H ( 3)    ³       neplatn˜ p©¡kaz                                 º
 º  04H ( 4)    ³       chyba dat (chyba kontroln¡ho sou‡tu CRC)        º
 º  05H ( 5)    ³       ¨patn  d‚lka struktury po‘adavku                º
 º  06H ( 6)    ³       chyba p©i vystaven¡                             º
 º  07H ( 7)    ³       nezn m˜ typ m‚dia                               º
 º  08H ( 8)    ³       sektor nenalezen                                º
 º  09H ( 9)    ³       v tisk rnˆ nen¡ pap¡r                           º
 º  0AH (10)    ³       chyba p©i z pisu                                º
 º  0BH (11)    ³       chyba ‡ten¡                                     º
 º  0CH (12)    ³       v¨eobecn , nespecifikovateln  chyba             º
 ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

Varov n¡: P©i  vyvol n¡  p©eru¨en¡  INT  25H  ponech v   DOS  jedno slovo v
          z sobn¡ku  (obsahuje registr p©¡znak– v ‡ase vyvol n¡ p©eru¨en¡).
          Toto  slovo  mus¡te  vyjmout  instrukc¡  POP,  aby byla zachov na
          hladina z sobn¡ku.

Pozn.: P©eru¨en¡  INT  25H  zru¨¡  obsahy v¨ech registr– kromˆ segmentov˜ch
       registr–.

       DOS  ‡¡sluje sektory disku sekven‡nˆ, po‡¡naj¡ce v lcem 0, hlavou 0,
       sektorem  1.  Slu‘ba  BIOS  (p©eru¨en¡ INT 13H) identifikuje sektory
       t©emi   oddˆlen˜mi   sou©adnicemi   -  v lcem,  hlavou  a  sektorem.
       N sleduj¡c¡  formule  konvertuje  ‡¡slov n¡  sektor– BIOS do form tu
       DOS:

    ‡¡slo_sektoru_DOS = (sektor_BIOS - 1) + hlava_BIOS * sektor–_na_stopu +
                        v lec_BIOS * sektor–_na_stopu * hlav_na_disk

       DOS  pracuje  s  logick˜mi  disky,  zat¡mco  BIOS  pracuje  pouze  s
       fyzick˜mi  disky.  To  znamen ,  ‘e  p©eru¨en¡  DOS INT 25H m–‘e b˜t
       pou‘ito  ke  ‡ten¡  symbolick‚ho  disku  B, RAM disku nebo logick‚ho
       disku, kter˜ byl namapov n do fyzick‚ho disku pomoc¡ povelu ASSIGN.

       Chyby  vznikl‚  bˆhem p©eru¨en¡ INT 25H nejsou obslou‘eny p©eru¨en¡m
       INT  24H  (obsluha  kritick‚  chyby).  Chyba  se indikuje nastaven¡m
       p©¡znaku p©enosu CF na 1.

       Nen¡ vhodn‚ p©edpokl dat, ‘e sektor je exaktnˆ 512 bajt–. K zji¨tˆn¡
       skute‡n‚   velikosti   sektor–   by  mˆla  b˜t  pou‘ita  funkce  1CH
       (poskytnut¡ informac¡ FAT) nebo 32H (poskytnut¡ informac¡ FAT disku)
       nebo ‡¡st zav dˆc¡ sektor disku.

       Verze  DOS 3.4 a men¨¡ podporuj¡ maxim ln¡ kapacitu pevn‚ho disku 32
       MB  (32  767 KB). Je to d no t¡m, ‘e pro standardn¡ diskov  za©¡zen¡
       se  pou‘¡vaj¡  sektory  512  bajt–.  V registru DX lze jako parametr
       funkce INT 25H zadat maxim lnˆ 65ú535 sektor–, ‡¡m‘ vznik  maxim ln¡
       adresovateln˜  prostor  32  MB.  Verze DOS 3.50 a vy¨¨¡ ji‘ umo‘¤uj¡
       adresovat vˆt¨¡ prostor disku.

       Av¨ak   ne-IBM  diskov‚  mechaniky  (nebo  novˆj¨¡  disky  IBM)  ji‘
       podporuj¡ velikost sektor– vˆt¨¡ ne‘ 512 bajt–. Proto nen¡ prakticky
       nijak omezena kapacita disku (jeho adresovateln˜ prostor).

       Chybov˜  k¢d  navracen˜ v AH je stejn˜ jako k¢d navr cen˜ v registru
       AH p©eru¨en¡m INT 13H/slu‘ba 02H a k¢d navr cen˜ v AL je stejn˜ jako
       k¢d  nastaven˜  v  registru  DI  p©i  vyvol n¡  kritick‚  chyby (viz
       p©eru¨en¡ INT 24H).






ÿIÿNÿTÿ  ÿ2ÿ6ÿH (INT 38; 0:0098H) - absolutn¡ z pis na disk

    vstup:    AL = ‡¡slo diskov‚ jednotky (0=A, 1=B, atd.)
              DS:BX = adresa vyrovn vac¡ pamˆti (odkud se provede z pis)
              CX = po‡et sektor–, kter‚ se maj¡ zapsat
              DX = po‡ te‡n¡ relativn¡ sektor (od za‡ tku disku)

    v˜stup:   AX = chybov˜ k¢d (je-li CF=1)
              p©¡znaky = DOS ponech  registr p©¡znak– v z sobn¡ku !

    P©eru¨en¡  INT  26H  zp–sob¡  z pis  CX sektor– z vyrovn vac¡ pamˆti na
adrese  DS:BX  na  disk  nebo  na logick‚ za©¡zen¡ od sektoru DX. P©eru¨en¡
pou‘¡v  slu‘by modulu BIOS - z pis sektoru na disku.

    Popis p©eru¨en¡ je analogick˜ popisu p©eru¨en¡ INT 25H (absolutn¡ ‡ten¡
z disku) - viz popis p©eru¨en¡ INT 25H.


P©¡klad: N sleduj¡c¡ program kop¡ruje obsah jednostrann‚ diskety o kapacitˆ
         160K  (tj.  40  stop  po  8  sektorech  512 bajt–, celkem tedy 320
         sektor–)  v diskov‚ jednotce A: na disketu v diskov‚ jednotce B: a
         ovˆ©uje (verifikuje) z pis. Pou‘¡v  vyrovn vac¡ pamˆŸ 32K:

kopiruj: mov       dx,offset text           ; adresa £vodn¡ho hl ¨en¡
         mov       ah,9                     ; slu‘ba pro v˜stup ©etˆzce
         int       21h                      ; v˜stup ©etˆzce na displej
         mov       ah,8                     ; slu‘ba vstupu znaku
         int       21h                      ; ‡ek n¡ na znak z kl vesnice
         mov       ax,2e01h                 ; slu‘ba zapnut¡ verifikace
         int       21h                      ; zapnut¡ verifikace z pisu
         mov       cx,5                     ; po‡et sektor– 5 * 64 = 320
kop:     push      cx                       ; uschov n¡ ‡¡ta‡e cykl–
         mov       al,0                     ; nastaven¡ zdroje z disku A:
         mov       bx,offset buffer         ; adresa bufferu k p©enosu dat
         mov       cx,64                    ; po‡et sektor– = 64 (= 8 stop)
         mov       dx,[start]               ; po‡ te‡n¡ sektor ke ‡ten¡
         int       25h                      ; ‡ten¡ 64 sektor– z disku A:
         mov       al,1                     ; nastaven¡ c¡lov‚ho disku B:
         mov       bx,offset buffer         ; adresa bufferu k p©enosu dat
         mov       cx,64                    ; po‡et sektor– = 64 (= 8 stop)
         mov       dx,[start]               ; po‡ te‡n¡ sektor ke ‡ten¡
         int       26h                      ; z pis 64 sektor– na disk B:
         add       [start],64               ; zv˜¨en¡ ukazatele sektor–
         pop       cx                       ; n vrat ‡¡ta‡e skupin sektor–
         loop      kop                      ; dal¨¡ skupina sektor– ke kop.
         mov       ax,4c00H                 ; slu‘ba ukon‡en¡ programu
         int       21H                      ; ukon‡en¡ programu (k¢d = 0)

text     db        'Vlo‘te zdrojovou disketu do A: a c¡lovou do B:',13,10
         db        'Stiskem libovoln‚ kl vesy zah j¡te kop¡rov n¡.',13,10
         db        ' VAROVN‹ - diskety mus¡ m¡t form t 160KB !',13,10,'$'

start    dw        0
buffer   db        64 DUP (512 DUP (?))     ; buffer 64 sektor–




ÿIÿNÿTÿ  ÿ2ÿ7ÿH (INT 39; 0:009CH) - ukon‡en¡ s uchov n¡m programu v pamˆti

    vstup:    CS:DX = prvn¡ bajt n sleduj¡c¡ po posledn¡m bajtu programu

    v˜stup:   nen¡ n vrat

    Vol n¡  p©eru¨en¡  INT  27H se pou‘¡v  k ukon‡en¡ programu, je-li nutno
zachovat  program nebo jeho ‡ st v pamˆti po‡¡ta‡e. Typick˜m p©¡kladem jsou
rezidentn¡  programy  obsluhuj¡c¡  u‘ivatelsk‚  p©eru¨ovac¡  rutiny,  nap©.
p©ek¢dov n¡  kl ves  kl vesnice  a  pod. P©ed vyvol n¡m p©eru¨en¡m je nutno
nastavit  registr  DX  na  offset  n sleduj¡c¡ho voln‚ho bajtu za posledn¡m
bajtem k¢du programu, kter˜ m  z–stat uchov n v pamˆti. Registr CS obsahuje
adresu  segmentu  prefixu  programov‚ho  segmentu  PSP.  Funkce  neumo‘¤uje
navracet  chybov˜  k¢d  ani  ponech vat  v  pamˆti  vˆt¨¡ programy ne‘ 64K.
Soubory  nejsou funkc¡ uzav©eny. P©i proveden¡ p©eru¨en¡ INT 27H je program
ukon‡en, ale pracuje se s n¡m jako s roz¨¡©en¡m DOSu; tzn., ‘e nen¡ p©eps n
jin˜mi programy.

    P©i  proveden¡  INT  27H se navr t¡ obsahy vektor– p©eru¨en¡ INT 22H a‘
INT  24H  z  existuj¡c¡ho  prefixu programov‚ho segmentu (PSP), proto nelze
tuto  slu‘bu  jednodu¨e  pou‘¡t  k  trval‚  instalaci  obslu‘n˜ch  program–
p©eru¨en¡ INT 23H (obsluha u‘ivatelsk‚ho p©eru¨en¡ Ctrl-Break) nebo INT 24H
(obsluha kritick‚ chyby).

    Toto  p©eru¨en¡  zaji¨Ÿuje  kompatibilitu  verz¡  DOSu  2.0 a vy¨¨¡ch s
d©¡vˆj¨¡mi  verzemi.  Novˆ  vytv ©en‚  programy by mˆly pou‘¡vat funkci 31H
(ukon‡en¡ procesu a jeho uchov n¡ v pamˆti).





ÿIÿNÿTÿ  ÿ2ÿ8ÿH (INT 40; 0:0080H) - ‡asov n¡ £sek– DOS

    Toto  p©eru¨en¡ nen¡ standardnˆ dokumentov no v p©¡ru‡k ch MS-DOS. Toto
p©eru¨en¡  vyvol v   DOS v‘dy kdy‘ ‡ek  na stisk kl vesy a p©edch z¡ mnoh˜m
funkc¡m DOS men¨¡m nebo rovn˜m 0CH (tj. funkce znakov˜ch vstup–/v˜stup–).

    Tento vektor je obsluhov n programem PRINT (standardn¡ program DOS) aby
nalezl spr vn˜ ‡asov˜ £sek ke ‡ten¡ ti¨tˆn‚ho souboru a z pisu na tisk rnu.
Je tak‚ ‡asto pou‘¡v no mnoha rozli‡n˜mi rezidentn¡mi programy.

    Typicky  pou‘¡vaj¡  rezidentn¡  programy p©eru¨en¡ INT 28H jako jeden z
mnoha vstupn¡ch bod– do sv‚ho k¢du. Tzn. ‘e rezidentn¡ program obslou‘¡ sv‚
funkce  ‡ek n¡  na  kl vesu  a/nebo  jin‚  spou¨tˆc¡ ud losti a nastav¡ sv‚
p©¡znaky. Po proveden¡ sv‚ obsluhy p©eru¨en¡ INT 28H zavol  p–vodn¡ obsluhu
p©eru¨en¡  INT  28H  a  pokud  jsou  po‘adovan‚ p©¡znaky nastaveny, provede
obsluhu sv˜ch funkc¡.

Varov n¡: Program  obsluhy  INT  28H  nesm¡  pou‘¡vat funkce DOS men¨¡ nebo
          rovny 0CH.






ÿIÿNÿTÿ  ÿ2ÿEÿH (INT 46; 0:00B8H) - proveden¡ povelu DOS

    vstup:    DS:SI = relativn¡  adresa  ©etˆzce  obsahuj¡c¡ho  povel DOS k
                      proveden¡ (mus¡ b˜t voln  pamˆŸ k na‡ten¡ programu)

    v˜stup:   nen¡ z©ejm‚, jak obdr‘et statut operace

    zni‡en‚ registry: SS,SP

    Toto  p©eru¨en¡  nen¡ standardnˆ dokumentov no p©¡ru‡kami DOS. Slou‘¡ k
vykon n¡ povelu DOS, jakoby byl zad n z p©¡kazov‚ho © dku.

    P©i  vstupu do p©eru¨en¡ ukazuje DS:SI na ©etˆzec ASCII, kter˜ obsahuje
jako  prvn¡  bajt  ur‡uj¡c¡  d‚lku  ©etˆzce  (nepo‡¡t   se do d‚lky ©etˆzce
koncov˜ znak 0DH) a za n¡m n sleduje ©etˆzec textu p©¡kazu. Nap©.:

    db   0fh, 'set PROMPT=$p$g',0dh         ; ©etˆzec je dlouh˜ 15 bajt–

    Tento  p©¡klad ilustruje hlavn¡ pou‘it¡ t‚to slu‘by - je mo‘n‚ nastavit
hodnotu  do  hlavn¡ho  (ko©enn‚ho)  prost©ed¡  pomoc¡  povelu SET. Ve v¨ech
ostatn¡ch  p©¡padech  se  d v   p©ednost funkci DOS 4BH (na‡ten¡ a start
programu  -  nap©. proveden¡ povelu COMMAND.COM prov dˆj¡c¡ p©ik zov˜ © dek
"/c povel_dos"), neboŸ tato funkce je plnˆ dokumentov na.

Pozn.: P©ed   vyvol n¡m  p©eru¨en¡  INT  2EH  nejd©¡ve  zajistˆte  zmen¨en¡
       sou‡asn‚ho bloku pamˆti pomoc¡ funkce DOS 4AH.

       Ponechte dostatek voln‚ho m¡sta z sobn¡ku - DOS jej dost spot©ebuje.

       P©ed  vol n¡m  p©eru¨en¡ ulo‘te registry SS a SP a navraŸte je ihned
       po n vratu zpˆt.

       Tato  slu‘ba  syst‚mu  je  utajovan .  Z©ejmˆ  nen¡ pou‘¡v na ‘ dn˜m
       programem  DOS  v‡etnˆ  COMMAND.COM  a  nen¡  proto  doporu‡ov no ji
       pou‘¡vat.





ÿIÿNÿTÿ  ÿ2ÿFÿH (INT 47; 0:00BCH) - p©ep¡nateln‚ p©eru¨en¡ (DOS)


    vstup:    AH = p©ep¡nac¡ ‡¡slo
                   01H - rezidentn¡ ‡ st povelu DOS 'PRINT'
                   02H - rezidentn¡ ‡ st povelu DOS 'ASSIGN'
                   10H - rezidentn¡ ‡ st povelu DOS 'SHARE'
                   03H a‘ 7FH - rezervov no pro DOS
                   0B7H - rezidentn¡ ‡ st povelu DOS 'APPEN'D
                   80H a‘ 0FFH - mo‘n‚ pou‘¡t jin˜mi procesy
              AL = funkce, kter  bude vykon na p©ep¡nanou obsluhou

    v˜stup:   AX = chybov˜ k¢d (pokud je CF = 1)
              AL = stav instalace (procesy DOS) (pokud je CF = 0)
                   00H - nen¡ instalov n, instalace probˆhla v po© dku
                   01H - nen¡ instalov n, instalace neprobˆhla v po© dku
                   FFH - je ji‘ nainstalov n

    P©eru¨en¡   definuje   v¨eobecn˜  styk  mezi  dvˆma  procesy.  Aplikace
pou‘¡vaj¡c¡  toto  p©eru¨en¡  mus¡ definovat specifick‚ funkce a parametry.
Funkce,  kter‚ jsou standardnˆ definovan‚ v DOS jsou PRINT, ASSIGN, SHARE a
APPEND.

    Ka‘d˜ proces, kter˜ pou‘¡v  toto p©eru¨en¡, mus¡ p©i vyvol n¡ p©eru¨en¡
nejd©¡ve otestovat obsah registru AH (zda obsahuje p©ep¡nac¡ ‡¡slo pro dan˜
proces).  Pokud  proces  rozezn  sv‚ ‡¡slo, provede svou obsluhu p©eru¨en¡.
Pokud  nerozezn   sv‚ ‡¡slo, mus¡ p©edat ©¡zen¡ na adresu p–vodn¡ho vektoru
p©eru¨en¡  INT  2FH  (adresu p–vodn¡ho vektoru p©eru¨en¡ si mus¡ ulo‘it p©i
sv‚ instalaci d©¡ve, ne‘ nastav¡ svou adresu obsluhy p©eru¨en¡).

    P©ep¡nateln˜ ovlada‡ p©eru¨en¡ se vztahuje ke sv‚mu "p©ep¡nac¡mu ‡¡slu"
v registru AH. Volba p©ep¡nac¡ho ‡¡sla je p©idˆliteln ; m–‘ete p©idˆlit sv‚
funkci ‡¡slo mezi 80H a‘ FFH; ‡¡sla 0 a‘ 7FH jsou rezervov na pro DOS.

    Funkce,  kter   bude  vykon na  p©ep¡nateln˜m  ovlada‡em  p©eru¨en¡, je
specifikov na v registru AL. Ostatn¡ registry mohou podle pot©eby obsahovat
libovoln‚ dal¨¡ parametry.

    V¨echny  p©ep¡nateln‚  ovlada‡e  p©eru¨en¡  mus¡  definovat  vol n¡ pro
ALú=ú0 (poskytnut¡ stavu instalace). Hodnoty AL F8H a‘ FFH jsou rezervov ny
pro DOS.

    P©ep¡nateln‚ ovlada‡e implementovan‚ nebo rezervovan‚ pro DOS:

         AH = 01H (  1)  rezidentn¡ ‡ st PRINT
              02H (  2)  rezidentn¡ ‡ st ASSIGN
              10H ( 16)  rezidentn¡ ‡ st SHARE
              B7H (183)  rezidentn¡ ‡ st APPEND

    V¨echny ostatn¡ hodnoty od AH = 0 do AH = 7FH jsou rezervov ny pro DOS.

    P©eru¨en¡  2FH  je  mo‘n‚ aplikovat pouze u DOS verze 3.1 a pozdˆj¨¡. U
verze  DOS  3.0 bylo p©eru¨en¡ definov no pouze pro obsluhu p©¡kazu PRINT a
hodnota  registru  AH  nemˆla  ‘ dn˜ v˜znam. U d©¡vˆj¨¡ch verz¡ ne‘ DOS 3.0
nebylo p©eru¨en¡ definov no v–bec.

    Pokud  instalujete  pomoc¡  tohoto  p©eru¨en¡  obslu‘n˜ program pro sv‚
rezidentn¡ programy nap©. ve v¡ce£lohov‚m syst‚mu, objevuje se zde probl‚m:
Pokud  ur‡¡te pevnˆ p©ep¡nac¡ k¢d, riskujete mo‘nost, ‘e toto ‡¡slo pou‘¡v 
ji‘  jin˜  proces.  Proto sestavujte procesy s testov n¡m, kter‚ zaru‡¡, ‘e
neztrat¡te  vl du  nad  procesy,  kter‚  byly ji‘ d©¡ve nainstalov ny.

    Va¨e procesy by mˆly obsluhovat alespo¤ funkci AL=00H (poskytnut¡ stavu
instalace), aby byla kontrola, zda je proces ji‘ nainstalov n.

    Pokud va¨e p©ep¡nan‚ procesy pou‘¡vaj¡ slu‘by DOS nebo jsou provozov ny
s  povolen˜m  p©eru¨en¡m (IF = 1), mˆlo by b˜t mo‘n‚ do va¨eho procesu opˆt
vstoupit.





ÿIÿNÿTÿ  ÿ2ÿFÿHÿ/ÿ0ÿ1 ÿ(ÿAÿHÿ=ÿ1ÿ) - p©ep¡nateln‚ p©eru¨en¡ (PRINT)


    vstup:    AH = 01H
              AL = funkce, kter  bude vykon na p©ep¡nanou obsluhou
                 = 00H (0) - poskytnut¡ stavu instalace
                   01H (1) - p©edlo‘en¡ souboru k tisku
                   02H (2) - zru¨en¡ souboru z tiskov‚ fronty
                   03H (3) - zru¨en¡ v¨ech soubor– z tiskov‚ fronty
                   04H (4) - statut
                   05H (5) - konec statutu
                   0F8H a‘ 0FFH - rezervov no pro DOS

    v˜stup:   AL = chybov˜ k¢d (kromˆ funkce 00H a 04H)
                 = 01H ( 1) - neplatn‚ ‡¡slo funkce
                   02H ( 2) - soubor nenalezen
                   03H ( 3) - cesta nenalezena
                   04H ( 4) - p©¡li¨ mnoho otev©en˜ch soubor–
                   05H ( 5) - po‘adavek odm¡tnut
                   06H ( 6) - neplatn˜ identifik tor souboru
                   08H ( 8) - fronta pln 
                   09H ( 9) - zanepr zdnˆn
                   0CH (12) - jm‚no p©¡li¨ dlouh‚ (vˆt¨¡ ne‘ 64 bajt–)
                   0FH (15) - neplatn˜ disk



Funkce 00H (0) - poskytnut¡ stavu instalace

    vstup:    AH = 01H
              AL = 00H

    v˜stup:   AL = 00H - neinstalov n, instalace probˆhla v po© dku
                   01H - neinstalov n, instalace neprobˆhla v po© dku
                   FFH - je ji‘ nainstalov n



Funkce 01H (1) - p©edlo‘en¡ souboru k tisku

    vstup:    AH = 01H
              AL = 01H
              DS:DX = ukazatel na p©edkl dan˜ bal¡k

    v˜stup:   AX = chybov˜ k¢d (viz v˜¨e)

    P©edkl dan˜  bal¡k mus¡ obsahovat hodnotu "£rovnˆ" (jeden bajt; pro DOS
    3.0,  3.1  a‘  3.3  mus¡  b˜t  hodnota  £rovnˆ 0), n sledovanou adresou
    ©etˆzce  ASCIIZ  (adresa  se  skl d  z offsetu a segmentu) obsahuj¡c¡ho
    disk,  cestu  a jm‚no souboru, kter˜ bude ti¨tˆn. Maskovac¡ znaky * a ?
    NEJSOU povoleny.



Funkce 02H (2) - zru¨en¡ souboru z tiskov‚ fronty

    vstup:    AH = 01H
              AL = 02H
              DS:DX = ukazatel na ©etˆzec ASCIIZ specifikuj¡c¡ ru¨en˜ soub.

    v˜stup:   AX = chybov˜ k¢d (viz v˜¨e)

    Zru¨¡ soubor z tiskov‚ fronty. Maskovac¡ znaky * a ? JSOU povoleny.



Funkce 03H (3) - zru¨en¡ v¨ech soubor– z tiskov‚ fronty (vy‡i¨tˆn¡ fronty)

    vstup:    AH = 01H
              AL = 03H

    v˜stup:   ‘ dn˜



Funkce 04H (4) - za‡ tek statutu (prohl‚dnut¡ fronty)

    vstup:    AH = 01H
              AL = 04H

    v˜stup:   DX = ‡¡ta‡ chyb
              DS:SI = ukazatel na tiskovou frontu

    €¡ta‡  chyb  hl s¡ po‡et n sledn˜ch chyb vznikl˜ch p©i pokusech PRINT o
    v˜stup posledn¡ho znaku.

    Tiskov   fronta, na kterou ukazuje DS:SI, je s‚ri¡ 64-bajtov˜ch polo‘ek
    specifikuj¡c¡ch  soubory,  kter‚  jsou  ti¨tˆny  (jako ©etˆzce ASCIIZ).
    Soubor  tisknut˜  v  sou‡asnosti  vystupuje jako prvn¡. Konec fronty je
    indikov n polo‘kou za‡¡naj¡c¡ bajtem 00H (0).

    Vol n¡  funkce  statutu  zmraz¡  soubory  ve  frontˆ (aby je bylo mo‘no
    prohl¡‘et  a  pracovat  s  nimi). Zavolejte funkci pro ukon‡en¡ statutu
    (AL=5) k uvolnˆn¡ tisknut˜ch soubor–.



Funkce 05H (5) - konec statutu (uvolnˆn¡ soubor– k tisku)

    vstup:    AH = 01H
              AL = 05H

    v˜stup:   AX = chybov˜ k¢d (viz v˜¨e)





ÿIÿNÿTÿ  ÿ2ÿFÿHÿ/ÿ0ÿ2 ÿ(ÿAÿHÿ=ÿ2ÿ) - p©ep¡nateln‚ p©eru¨en¡ (ASSIGN)


    vstup:    AH = 02H
              AL = 00H (0) - poskytnut¡ stavu instalace

    v˜stup:   AL = 00H - neinstalov n, instalace probˆhla v po© dku
                   01H - neinstalov n, instalace neprobˆhla v po© dku
                   FFH - je ji‘ nainstalov n

    Funkce poskytne informaci, zda je rezidentn¡ ‡ st ASSIGN instalov na.





ÿIÿNÿTÿ  ÿ2ÿFÿHÿ/ÿ1ÿ0 ÿ(ÿAÿHÿ=ÿ1ÿ6ÿ) - p©ep¡nateln‚ p©eru¨en¡ (SHARE)


    vstup:    AH = 10H
              AL = 00H (0) - poskytnut¡ stavu instalace

    v˜stup:   AL = 00H - neinstalov n, instalace probˆhla v po© dku
                   01H - neinstalov n, instalace neprobˆhla v po© dku
                   FFH - je ji‘ nainstalov n

    Funkce poskytne informaci, zda je rezidentn¡ ‡ st SHARE instalov na.




ÿIÿNÿTÿ  ÿ2ÿFÿHÿ/ÿBÿ7 ÿ(ÿAÿHÿ=ÿ1ÿ8ÿ3ÿ) - p©ep¡nateln‚ p©eru¨en¡ (APPEND)


    vstup:    AH = B7H
              AL = 00H (0) - poskytnut¡ stavu instalace

    v˜stup:   AL = 00H - neinstalov n, instalace probˆhla v po© dku
                   01H - neinstalov n, instalace neprobˆhla v po© dku
                   FFH - je ji‘ nainstalov n

    Funkce poskytne informaci, zda je rezidentn¡ ‡ st APPEND instalov na.

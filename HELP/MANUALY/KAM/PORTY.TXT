
ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±± º
º ±±                                                                   ±± º
º ±±                             ÿPÿoÿrÿtÿy                            ±± º
º ±±                                                                   ±± º
º ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±± º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
                            (c) Miroslav Nˆme‡ek

Z kladn¡ rozdˆlen¡ port– v po‡¡ta‡i:

    * porty 0000H - 00FFH jsou rezerovv ny pro pou‘it¡ syst‚movou deskou
    * porty 0100H - 03FFH jsou  dek¢dov ny  na  I/O  sbˆrnici  pro  pou‘it¡
                          kartou adapt‚ru displeje
    * porty 0400H a v˜¨e nejsou p©¡stupn‚ na syst‚mov‚ sbˆrnici

(Pozn.: V dal¨¡m bude pou‘¡v no ozna‡en¡ I/O = vstupnˆ/v˜stupn¡)



Rozdˆlen¡ port–:

      AT:          PC/XT:  kapitola:     popis:

0000H - 001FH  0000H - 000FH  3   ©adi‡ DMA #1, 8237A-5
0020H - 003FH  0020H - 0021H  2   ©adi‡ p©eru¨en¡ #1, 8259A
0040H - 005FH  0040H - 0043H  4   ‡asova‡ 8253-5 (AT: 8254.2)
               0060H - 0063H  5   programovateln˜ perifern¡ interface (PPI)
                                  kl vesnice, p©ep¡na‡– vybaven¡, ‡asova‡e
0060H - 006FH                 5   ©adi‡ kl vesnice 8042 (AT)
0070H - 0071H                 6   hodiny   re ln‚ho   ‡asu,   pamˆŸ   CMOS,
                                  maskov n¡ NMI (nemaskovateln‚ p©eru¨en¡)
0080H                             tov rn¡ kontroln¡ diagnostick˜ bod
0081H - 009FH  0080H - 0083H  3   DMA str nkov˜ registr 74LS612
               00A0H              maska NMI (nemaskovateln‚ p©eru¨en¡)
00A0H - 00BFH                 2   ©adi‡ p©eru¨en¡ #2, 8259A
00C0H - 00DFH                 3   ©adi‡ DMA #2, 8237A-5
00F0H - 00FFH                14   matematick˜ koprocesor  8087,80287,80387

0170H - 0177H                 7   ©adi‡ druh‚ho pevn‚ho disku AT
01F0H - 01F7H                 7   ©adi‡ prvn¡ho pevn‚ho disku AT
0200H - 0207H  0200H - 020FH 13   hern¡ I/O adapt‚r (joystick, A/D port)
               0210H - 0217H 15   roz¨i©uj¡c¡ box XT
0278H - 027FH  0278H - 027FH 11   paraleln¡ port tisk rny #2 (#3 s DMA)
02C0H - 02DFH  02C0H - 02DFH 10   porty EGA #2 (druh  EGA v syst‚mu)
02F8H - 02FFH  02F8H - 02FFH 12   port asynchronn¡ho komunik. adapt‚ru #2
0300H - 031FH                     karta prototypu
               0320H - 0327H  7   ©adi‡ pevn‚ho disku XT
0370H - 0377H                 8   ©adi‡ pru‘n˜ch disk– 2 (AT)
0378H - 037FH  0378H - 037FH 11   paraleln¡ tisk rna #1 (#2 s DMA)
0380H - 038FH  0380H - 038FH      ©¡zen¡ synchronn¡ datov‚ linky (SDLC)
03A0H - 03AFH  03A0H - 03A9H      bisynchronn¡ port #1
03B0H - 03BFH  03B0H - 03BFH 10,11 adapt‚r monochrom. displeje/tisk rna #1
03C0H - 03CFH  03C0H - 03CFH 10   porty EGA #1 (hlavn¡ EGA v syst‚mu)
03D0H - 03DFH  03D0H - 03DFH 9,10 porty CGA a EGA (MC 6845)
03F0H - 03F7H  03F0H - 03F7H  8   ©adi‡ pru‘n˜ch disk– 1 XT,AT (NEC æPD765)
03F8H - 03FFH  03F8H - 03FFH 12   port asynchronn¡ho adapt‚ru #1


Rozdˆlen¡ do kapitol:

 1.- nastaven¡ syst‚mov˜ch p©ep¡na‡–
 2.- ©adi‡ p©eru¨en¡
 3.- ©adi‡ DMA
 4.- ‡asova‡
 5.- kl vesnice
 6.- pamˆŸ CMOS, maskov n¡ NMI
 7.- ©adi‡ pevn‚ho disku
 8.- ©adi‡ pru‘n˜ch disk–
 9.- grafick  karta CGA
10.- grafick  karta EGA (a MDA)
11.- paraleln¡ porty tisk ren
12.- port assynchronn¡ho adapt‚ru
13.- port hern¡ho I/O adapt‚ru
14.- matematick˜ koprocesor
15.- roz¨i©uj¡c¡ box XT




   ÿ1ÿ.ÿ-  ÿNÿaÿsÿtÿaÿvÿeÿnÿ¡  ÿsÿyÿsÿtÿ‚ÿmÿoÿvÿ˜ÿcÿh  ÿpÿ©ÿeÿpÿ¡ÿnÿaÿ‡ÿ–


    P©ep¡na‡e DIL po‡¡ta‡– PC a XT informuj¡ BIOS o vybaven¡ po‡¡ta‡e a jak
velik  pamˆŸ je nainstalov na. Tyto p©ep¡na‡e se ‡tou bˆhem inicializa‡n¡ho
testu  POST  a  nastav¡  se  podle  nich p©¡znakov‚ bity v tabulce vybaven¡
po‡¡ta‡e  v  datov‚m  prostoru  BIOS  (tato  tabulka  na  adrese 0:0410H je
program torovi p©¡stupn  p©es p©eru¨en¡ INT 11H).

    Na  p–vodn¡m  PC  (64KB  pamˆti  na z kladn¡ desce; nˆkdy se t‚‘ naz˜v 
PC-1) byly na syst‚mov‚ desce um¡stˆny dva p©ep¡na‡e DIL, ozna‡en‚ jako SW1
a SW2 (pozn.: pokud je p©ep¡na‡ v poloze ON, m  sign l hodnotu 0):

                              ÉÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍ»
                              º p©ep¡na‡e º 00(0) ³ 01(1) ³ 10(2) ³ 11(3) º
             SW1              ÌÍÍÍÑÍÍÍÑÍÍÍÎÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍ¹
ON   Ú1Â2Â3Â4Â5Â6Â7Â8¿  = 0   º 7 ³ 5 ³ 3 º  -ß-  ³  -Ü-  ³  -ß-  ³  -Ü-  º
     ³ ³ ³ ³ ³ ³ ³ ³ ³        ÇÄÄÄÅÄÄÄÅÄÄÄ×ÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄ¶
     ³ ³ ³ ³ ³ ³ ³ ³ ³  = 1   º 8 ³ 6 ³ 4 º  -ß-  ³  -ß-  ³  -Ü-  ³  -Ü-  º
OFF  ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ        ÈÍÍÍÏÍÍÍÏÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍ¼
      ³ ³ ³ ³ ³ ³ ³ ³   p©ep.
      ³ ³ ³ ³ ³ ³ ÀÄÁÄÄ> 7-8: disketov˜ch mechanik-1 (00=1;01=2;10=3;11=4)
      ³ ³ ³ ³ ÀÄÁÄÄÄÄÄÄ> 5-6: aktivn¡ m¢d displeje (rezer.,40zn,80zn,mono)
      ³ ³ ÀÄÁÄÄÄÄÄÄÄÄÄÄ> 3-4: RAM na syst‚mov‚ desce (16K, 32K, 48K, 64K)
      ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  2:  matematick˜ koprocesor 8087 (OFF=je; ON=nen¡)
      ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  1:  disketov‚ mechaniky (OFF=jsou; ON=‘ dn )

    Pou‘it¡  p©ep¡na‡–  DIL  u  po‡¡ta‡e XT je podobn‚ jako u PC s vyj¡mkou
pozice  1,  kter   aktivuje  cyklov n¡ inicializa‡n¡ho tesu POST a mus¡ b˜t
proto  v‘dy  v  poloze  OFF. Odli¨n‚ jsou t‚‘ hodnoty syst‚mov‚ pamˆti RAM,
kter‚  se  nastavuj¡  pozicemi  3-4  p©ep¡na‡e SW1 - hodnoty pamˆti jsou (v
odpov¡daj¡c¡m po©ad¡) 64K, 128K, 192K a 256K.


          SW2 (PC-1)
ON   Ú1Â2Â3Â4Â5Â6Â7Â8¿  = 0
     ³ ³ ³ ³ ³ ³ ³ ³ ³
     ³ ³ ³ ³ ³Û³Û³Û³Û³  = 1
OFF  ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
      ³ ³ ³ ³ ³ ³ ³ ³   p©ep.
      ³ ³ ³ ³ ÀÄÁÄÁÄÁÄÄ> 5-8: v‘dy v OFF
      ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄÄ> 1-4: celkov  RAM: pozice 4 = 256K (v OFF plat¡)
                                           pozice 3 = 128K (v OFF plat¡)
                                           pozice 2 =  64K (v OFF plat¡)
                                           pozice 1 =  32K (v OFF plat¡)
      Celkov   kapacita pamˆti vznikne sou‡tem jednotliv˜ch pozic p©ep¡na‡–
      a  volby  z  SW1.  Nap©.  512  KB: 3(SW1)=OFF; 4(SW1)=OFF; 1(SW2)=ON;
      2(SW2)=OFF a‘ 4(SW2)=OFF.

    Pozdˆj¨¡  verze  PC  (nˆkdy  naz˜van‚  PC-2)  maj¡  odli¨n˜ BIOS, kter˜
interpretuje  p©ep¡na‡ SW2 ponˆkud odli¨nˆ (v˜znam SW1 z–st v  stejn˜).

          SW2 (PC-2)
ON   Ú1Â2Â3Â4Â5Â6Â7Â8¿  = 0
     ³ ³ ³ ³ ³ ³ ³ ³ ³
     ³ ³ ³ ³ ³ ³Û³Û³Û³  = 1
OFF  ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
      ³ ³ ³ ³ ³ ³ ³ ³   p©ep.
      ³ ³ ³ ³ ³ ÀÄÁÄÁÄÄ> 6-8: v‘dy v OFF
      ÀÄÁÄÁÄÁÄÁÄÄÄÄÄÄÄÄ> 1-5: celkov  RAM: v˜znam stejn˜ jako u PC-1, nav¡c
                                           je pozice 5 = 512K (v OFF plat¡)
                                          Maxim ln¡ kapacita m–‘e b˜t 640K.

    Na po‡¡ta‡¡ch PC a XT m–‘ete zmˆnit £‡inek p©ep¡na‡– zmˆnou v nastaven¡
tabulky  vybaven¡ (adresa 0:0410H) a resetov n¡m DOS. P©edt¡m v¨ak nastavte
obsah  adresy  0:0472H  na  1234H  (viz zav dˆn¡ opera‡n¡ho syst‚mu, POST),
potom proveƒte INT 19H.

    Pokud  bˆhem provozu po‡¡ta‡e nastane chyba pamˆti, nebo chcete zjistit
skute‡nou velikost pamˆti, zkuste n sleduj¡c¡ postup: Nastavte p©ep¡na‡e na
malou  velikost  pamˆti (aby syst‚m fungoval bez chyby), resetujte syst‚m a
po  zaveden¡  syst‚mu  zkuste  p©¡kaz  CHKDSK  k  zji¨tˆn¡,  zda je pamˆŸ v
po© dku.  Pokud  ano,  zvˆt¨ete nastaven¡ velikosti pamˆti a opakujte reset
syst‚mu  a  kontrolu  pamˆti.  To opakujte tak dlouho, a‘ bude p©i kontrole
pamˆti hl ¨ena chyba.

    Pokud  se  v m  touto  cestou  poda©¡ zv˜¨it pomoc¡ p©ep¡na‡– DIL pamˆŸ
po‡¡ta‡e nad 640K, BIOS bude sice ¨Ÿastn˜, av¨ak DOS tuto operaci nep©e‘ije
(p©echodn  ‡ st COMMAND.COM se na‡te do nejvy¨¨¡ ‡ sti pamˆti RAM).


    Po‡¡ta‡  AT  nem  nastavov n¡ pomoc¡ p©ep¡na‡– DIL. Konfigurace syst‚mu
je nastavena pomoc¡ konfigura‡n¡ho programu SETUP, kter˜ je ulo‘en v pamˆti
ROM,  v˜sledek  nastaven¡  se  ulo‘¡  do  pamˆti  CMOS. Jedin‚ nastaven¡ se
prov d¡  pomoc¡  propojovac¡ch  m–stk–, tyto m–stky jsou v¨ak ji‘ nastaveny
tov rnˆ  podle  konkr‚tn¡ho osazen¡ syst‚mov‚ desky a nen¡ vhodn‚ je mˆnit.
Ze  zaj¡mav˜ch  m–stk–  lze  uv‚st  pouze  m–stek  J18,  kter˜ v poloze 1-2
povoluje  pou‘it¡  druh‚ ‡ sti 256K (p©i 512K na syst‚mov‚ desce), v poloze
2-3  ji  blokuje. Dal¨¡m p©ep¡na‡em AT je p©ep¡na‡ ozna‡en˜ jako SW1, kter˜
ur‡uje  inicializa‡n¡  adapt‚r  displeje  (pro  inicializa‡n¡  test POST) v
p©¡padˆ, ‘e data v CMOS jsou neplatn  (nap©. p©i v˜padku baterie). V poloze
ON  (smˆrem k zadn¡mu panelu) tento p©ep¡na‡ ur‡uje jako prim rn¡ grafickou
kartu  CGA,  v poloze OFF (smˆrem k p©edn¡mu panelu) ozna‡uje jako prim rn¡
grafickou kartu EGA. Nastaven¡ p©ep¡na‡– karty EGA - viz popis karty EGA.





                   ÿ2ÿ.ÿ-  ÿÿaÿdÿiÿ‡  ÿpÿ©ÿeÿrÿuÿ¨ÿeÿnÿ¡




adi‡  p©eru¨en¡:


Porty 0020H - 003FH: ©adi‡ p©eru¨en¡ #1 8259A
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Inicializace ©adi‡e p©eru¨en¡ 8259A:

ICW1: Inic. ©¡dic¡ slovo - zapisuje se v‘dy jako prvn¡ slovo na port 0020H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
               ³ ³   ³ ÀÄ> 0: nutno nastavit na 1
               ³ ³   ÀÄÄÄ> 1: 1=jednoduch˜ m¢d; 0=kask dn¡ m¢d (bude ICW3)
               ³ ÀÄÄÄÄÄÄÄ> 3: 1=spou¨tˆn¡ £rovn¡; 0=spou¨tˆn¡ hranou
               ÀÄÄÄÄÄÄÄÄÄ> 4: nutno nastavit na 1

ICW2: Inic. ©¡dic¡ slovo - zapisuje se bezprost©ednˆ po ICW1 na port 0021H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³         0-2: nepou‘ito, bity se dosad¡ automaticky
         ÀÄÁÄÁÄÁÄÁÄÄÄÄÄÄÄ> 3-7: bity 3 a‘ 7 ‡¡sla p©eru¨en¡ INT x

ICW3: Inic.  ©¡dic¡  slovo - zapisuje se po ICW2 na port 0021H, pokud byl v
      ICW1 nastaven bit 1 na 0 (=kask dn¡ m¢d):

    adi‡ je jako MASTER:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ³
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄ> 0-7: 1=je p©ipojen SLAVE; 0=nen¡ SLAVE

    adi‡ je jako SLAVE:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                   ³ ³ ³
                   ÀÄÁÄÁÄ> 0-2: ‡¡slo SLAVE (kam je p©ipojen k MASTER)


ICW4: Inic. ©¡dic¡ slovo - zapisuje se po ICW2 resp. po ICW3 na port 0021H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: nutno nastavit na 1
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=autom. konec p©eru¨en¡; 0=pou‘ije se EOI
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: (pouze pokud je bit 3=1): 1=MASTER; 0=SLAVE
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=buff. m¢d; 0=nen¡ buff. m¢d (bit 2 ignor.)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=spec. re‘im s £pln˜m vkl d n¡ (jen MASTER)
         ÀÄÁÄÁÄÄÄÄÄÄÄÄÄÄÄ> 5-7: nutno nastavit na 0



    Opera‡n¡ ©¡dic¡ slova (v bˆ‘n‚m provozu):

OCW1: Oper. ©¡dic¡ slovo - zapisuje se nebo ‡te z portu 0021H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ³
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄ> 0-7: p©eru¨en¡ od vstupu: 1=zak z no, 0=povoleno

OCW2: Oper. ©¡dic¡ slovo - zapisuje se na port 0020H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit        (EOI=povel pro konec p©eru¨en¡)
         ³ ³ ³ ³ ³ ³ ³ ³
         ³ ³ ³ ³ ³ ÀÄÁÄÁÄ> 0-2: £rove¤ p©eru¨en¡ 0 a‘ 7 (povely 60,C0 a E0)
         ³ ³ ³ ÀÄÁÄÄÄÄÄÄÄ> 3,4: nutno nastavit na 0
         ÀÄÁÄÁÄÄÄÄÄÄÄÄÄÄÄ> 5-7: povel: 00=rotace v automat. EOI-nulov n¡
                                       20=nespecifikovan˜ EOI
         ³ ³ ³                         40=‘ dn  operace
         ³ ³ À>1=automat. m¢d EOI      60=EOI pro zadanou £rove¤ (0-7)
         ³ ÀÄÄ>1=specifik. £rove¤ 0-7  80=rotace v automat. EOI-nastaven¡
         ÀÄÄÄÄ>1=povel se t˜k  rotace  A0=rotace v nespecifik. m¢du EOI
                                       C0=nastaven¡ priority (0-7)
                                       E0=rotace ve specif. m¢du EOI (0-7)





Porty 00A0H - 00BFH: ©adi‡ p©eru¨en¡ #2 8259A
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

00A0H - z pis: vysl n¡ bajtu 20H - signalizace konce p©eru¨en¡ IRQ 8-15
00A1H - z pis/‡ten¡: maskov n¡  p©eru¨en¡  (bit  0  a‘  7  = 0 --> povolen¡
                     p©eru¨en¡ pro vstupy IRQ 8-15)


Hardwarov   p©eru¨en¡:

    po‘adavky p©eru¨en¡ ©adi‡e p©eru¨en¡ #1:

IRQ 0    - syst‚mov‚ hodiny (p©eru¨en¡ 18.2 kr t za sekundu) (INT 08H)
IRQ 1    - p©eru¨en¡ od kl vesnice (INT 09H)
IRQ 2    - zpˆtn˜ bˆh EGA, kask dn¡ po‘adavek p©eru¨en¡ AT od #2 (INT 0AH)
IRQ 3    - p©eru¨en¡ od s‚riov‚ho portu COM2 (INT 0BH)
IRQ 4    - p©eru¨en¡ od s‚riov‚ho portu COM1 (INT 0CH)
IRQ 5    - tisk rna LPT2, ©adi‡ pevn‚ho disku XT (INT 0DH)
IRQ 6    - ©adi‡ pru‘n˜ch disk– (INT 0EH)
IRQ 7    - tisk rna LPT1 (INT 0FH)

            (n sleduj¡c¡   p©eru¨en¡   jsou  kask dnˆ  p©ipojena  k  ©adi‡i
            p©eru¨en¡ #1 p©es po‘adavek IRQ 2)

IRQ 8    - CMOS ‡asova‡ (1024 kr t za sekundu) (INT 70H)
IRQ 9    - (INT 71H)
IRQ 10   - (INT 72H)
IRQ 11   - (INT 73H)
IRQ 12   - (INT 74H)
IRQ 13   - p©eru¨en¡ koprocesory 80287 a 80387 p©i chybˆ (INT 02H, INT 75H)
IRQ 14   - ©adi‡ pevn‚ho disku AT (INT 76H)
IRQ 15   - (INT 77H)


    Nemaskovateln‚ p©eru¨en¡ NMI (INT 02H) nelze maskovat p©¡mo v porcesoru
pomoc¡  instrukce  pro  z kaz  p©eru¨en¡. Proto je umo‘nˆno v po‡¡ta‡¡ch PC
maskovat  toto  p©eru¨en¡  hardwarovˆ  (p©eru¨en¡  NMI  je  v po‡¡ta‡¡ch PC
generov no p©i vzniku chyby parity pamˆti a p©i vzniku chyby v matematick‚m
koprocesoru).  U  po‡¡ta‡–  PC/XT  se  povol¡  p©eru¨en¡  vysl n¡m  bajtu s
nastaven˜m  7.bitem  (=80H)  na  port  00A0H.  Vysl n¡m bajtu s vynulovan˜m
7.bitem  (=00H)  se p©eru¨en¡ NMI zak ‘e. U po‡¡ta‡e AT se povol¡ p©eru¨en¡
vysl n¡m  bajtu s vynulovan˜m 7.bitem (=00) na port 0070H. Vysl n¡m bajtu s
nastaven˜m  7.bitem  (=80H hodnoty jsou tedy obr cenˆ ne‘ u po‡¡ta‡– PC/XT)
se p©eru¨en¡ NMI zak ‘e (viz t‚‘ pamˆŸ CMOS - maskov n¡ NMI).





                         ÿ3ÿ.ÿ-  ÿÿaÿdÿiÿ‡  ÿDÿMÿA


    DMA  (p©¡m˜  p©¡stup do pamˆti) je zp–sob p©enosu dat mezi pamˆt¡ a I/O
za©¡zen¡m  bez  £‡asti  procesoru.  Tento  zp–sob  p©enosu  se pou‘¡v  p©i
po‘adavku  rychl‚ho  p©enosu velk‚ho mno‘stv¡ dat, jako je nap©. p©enos dat
mezi pamˆt¡ a disketovou jednotkou nebo pevn˜m diskem.

    P–vodn¡  PC  podporoval  ‡ty©i  8-bitov‚  kan ly  DMA,  p©es  20-bitov˜
adresov˜ prostor, s pou‘it¡m ©adi‡e DMA Intel 8237A.

   ÉÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
   ºkan l DMA³               pou‘it¡ v PC a XT                º
   ÌÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
   º   0     ³      ob‡erstvov n¡ pamˆti (nejvy¨¨¡ priorita)  º
   º   1     ³      nepou‘it                                  º
   º   2     ³      adapt‚r disketov‚ jednotky                º
   º   3     ³      adapt‚r pevn‚ho disku (nejni‘¨¡ priorita) º
   ÈÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Syst‚m  DMA po‡¡ta‡– AT je zalo‘en pro zv˜¨en¡ kompatibility na syst‚mu
DMA  po‡¡ta‡–  PC a XT. Ke ‡ty©em 8-bitov˜m kan l–m DMA po‡¡ta‡– PC p©id v 
AT  druh˜  ©adi‡  DMA  8237A-5, kter˜ podporuje kan ly 4-7 (‡ty©i 16-bitov‚
kan ly).

   ÉÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
   ºkan l DMA³               pou‘it¡ v AT                     º
   ÌÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹ÄÄÄÄÄÄÄÄÄÄ¿
   º   0     ³      voln˜                                     º          ³
   º   1     ³      ©¡zen¡ synchronn¡ datov‚ linky SDLC       º 8-bitov‚ ³
   º   2     ³      adapt‚r disketov‚ jednotky                º  kan ly  ³
   º   3     ³      adapt‚r pevn‚ho disku                     º          ³
   ÇÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶ÄÄÄÄÄÄÄÄÄÄ´
   º   4     ³      (©adi‡ 2) kask da pro ©adi‡ 1             º          ³
   º   5     ³      voln˜                                     º 16-bitov‚³
   º   6     ³      voln˜                                     º  kan ly  ³
   º   7     ³      voln˜                                     º          ³
   ÈÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼ÄÄÄÄÄÄÄÄÄÄÙ



Porty 0000H - 0007H: b zov‚ adresy DMA a offsetov‚ registry
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    V¨echny  registry jsou 16-bitov‚. Nejd©¡ve se ‡te/zapisuje ni‘¨¡ bajt a
potom  na  stejn‚  adrese  portu  vy¨¨¡ bajt (viz t‚‘ port 000CH - nulov n¡
klopn‚ho  obvodu ukazatele bajt–). B zov‚ adresy jsou offsetov ny v str nce
DMA.

0000H - z pis: b zov  adresa kan lu 0 DMA (t‚‘ nastav¡ sou‡asnou adresu)
        ‡ten¡: sou‡asn  adresa kan lu 0 DMA          (ob‡erstvov n¡)
0001H - z pis: b zov  adresa a ‡¡ta‡ slov kan lu 0 DMA     "
        ‡ten¡: sou‡asn˜ stav ‡¡ta‡e slov kan lu 0 DMA      "
0002H - z pis: b zov  adresa kan lu 1 DMA
        ‡ten¡: sou‡asn  adresa kan lu 1 DMA
0003H - z pis: b zov  adresa a ‡¡ta‡ slov kan lu 1 DMA
        ‡ten¡: sou‡asn˜ stav ‡¡ta‡e slov kan lu 1 DMA
0004H - z pis: b zov  adresa kan lu 2 DMA            (disketov  jednotka)
        ‡ten¡: sou‡asn  adresa kan lu 2 DMA                "
0005H - z pis: b zov  adresa a ‡¡ta‡ slov kan lu 2 DMA     "
        ‡ten¡: sou‡asn˜ stav ‡¡ta‡e slov kan lu 2 DMA      "
0006H - z pis: b zov  adresa kan lu 3 DMA            (pevn˜ disk)
        ‡ten¡: sou‡asn  adresa kan lu 3 DMA                "
0007H - z pis: b zov  adresa a ‡¡ta‡ slov kan lu 3 DMA     "
        ‡ten¡: sou‡asn˜ stav ‡¡ta‡e slov kan lu 3 DMA      "



Porty 00C0H - 00CFH: b zov‚ registry 16-bitov‚ho DMA
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Kan ly  0-3  p©enosu  DMA  pracuj¡ s 8-bitov˜m p©enosem dat (standardn¡
PC).  U  po‡¡ta‡–  AT jsou doplnˆny kan ly 4-7 podporuj¡c¡ 16-bitov˜ p©enos
dat.  P©enos pro tyto kan ly za‡¡n  v‘dy na hranici slov a v¨echny adresy a
‡¡ta‡e  pracuj¡  pro 16-bitov  slova (nap©. b zov  adresa 0123H se aktu lnˆ
vztahuje na offset 0246H od za‡ tku str nky v p©¡slu¨n‚m kan lu).

00C0H - z pis: b zov  a sou‡asn  adresa kan lu 4 DMA (bity 1-16; bit0=0)
        ‡ten¡: sou‡asn  adresa kan lu 4 DMA
00C2H - z pis: ‡¡ta‡ slov kan lu 4 DMA
        ‡ten¡: sou‡asn˜ stav ‡¡ta‡e slov kan lu 4 DMA
00C4H - z pis: b zov  a sou‡asn  adresa kan lu 5 DMA (bity 1-16; bit0=0)
        ‡ten¡: sou‡asn  adresa kan lu 5 DMA
00C6H - z pis: ‡¡ta‡ slov kan lu 5 DMA
        ‡ten¡: sou‡asn˜ stav ‡¡ta‡e slov kan lu 5 DMA
00C8H - z pis: b zov  a sou‡asn  adresa kan lu 6 DMA (bity 1-16; bit0=0)
        ‡ten¡: sou‡asn  adresa kan lu 6 DMA
00CAH - z pis: ‡¡ta‡ slov kan lu 6 DMA
        ‡ten¡: sou‡asn˜ stav ‡¡ta‡e slov kan lu 6 DMA
00CCH - z pis: b zov  a sou‡asn  adresa kan lu 7 DMA (bity 1-16; bit0=0)
        ‡ten¡: sou‡asn  adresa kan lu 7 DMA
00CEH - z pis: ‡¡ta‡ slov kan lu 7 DMA
        ‡ten¡: sou‡asn˜ stav ‡¡ta‡e slov kan lu 7 DMA



Porty 0008H - 000FH: ©¡zen¡ DMA/stavov‚ registry
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0008H - z pis: povelov˜ registr DMA

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=mo‘n˜ p©enos DMA pamˆŸ-pamˆŸ (kan. 0<-->1)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=mo‘n‚ dr‘en¡ adresy kan lu 0
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=blokov n¡ ©adi‡e
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=volba kompresn¡ho ‡asovac¡ho m¢du
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=mo‘n  rotuj¡c¡ priorita
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=volba roz¨¡©en‚ho z pisov‚ho m¢du;0=pozdn¡
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=aktivn¡ £rove¤ DRQ high; 0=low
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=aktivn¡ £rove¤ DACK high; 0=low

      - ‡ten¡: stavov˜ registr DMA

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ÀÄÁÂÁÄÙ ÀÄÁÄÁÄÁÄ> 0-3: kan l 0-3 ukon‡il ‡¡t n¡
            ÀÄÄÄÄÄÄÄÄÄÄÄÄ> 4-7: kan l 0-3 po‘aduje obsluhu

0009H - z pis: registr po‘adavku

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                   ³ ÀÄÁÄ> 0-1: v˜bˆr kan lu 0-3 (00=0; 01=1; 10=2; 11=3)
                   ÀÄÄÄÄÄ>  2:  1=nastaven bit po‘adavku kan lu; 0=resetov.

000AH - z pis: registr maskovac¡ho bitu

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                   ³ ÀÄÁÄ> 0-1: v˜bˆr kan lu 0-3 (00=0; 01=1; 10=2; 11=3)
                   ÀÄÄÄÄÄ>  2:  1=nastaven maskovac¡ bit kan lu; 0=resetov.

000BH - z pis: registr m¢du

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: volba kan lu 0-3 (00=0; 01=1; 10=2; 11=3)
         ³ ³ ³ ³ ÀÄÁÄÄÄÄÄ> 2-3: typ p©enosu (00=verif.; 01=z pis; 10=‡ten¡)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=mo‘n  automatick  inicializace
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=inkrementace adresy; 0=dekrement. adresy
         ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6-7: 00=m¢d po‘adavku; 01=jednoduch˜ m¢d;
                                10=blokov˜ p©enos; 11=kask dn¡ m¢d

000CH - z pis: Vynulov n¡  klopn‚ho obvodu ukazatele bajt–. Jak˜koliv z pis
               na  tuto adresu vynuluje klopn˜ obvod ukazatele bajt–, tak‘e
               p©i   p©¡¨t¡m   z pisu  nˆkter‚ho  16-bitov‚ho  registru  je
               zapisovan˜  bajt dek¢dov n jako ni‘¨¡ bajt. N sleduj¡c¡ bajt
               je vy¨¨¡ bajt (pak opˆt ni‘¨¡ atd.).

000DH - z pis: celkov‚ nulov n¡-jak˜koliv z pis na port nuluje ©¡zen¡ (mus¡
               b˜t znovu zinicializov no)
      - ‡ten¡: pomocn˜ registr - posledn¡ bajt p©i p©enosu pamˆŸ-pamˆŸ

000EH - z pis: vynulov n¡  maskovac¡ho  registru  - jak˜koliv z pis na port
               uvoln¡ v¨echny 4 kan ly

000FH - z pis: maskov n¡  kan l–  -  ma‘e nebo maskuje nˆkter˜ nebo v¨echny
               kan ly

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ÀÄ> 0: 1=maska kan lu 0; (0=uvolnˆn˜; 1=blokovan˜)
                 ³ ³ ÀÄÄÄ> 1: 1=maska kan lu 1; (0=uvolnˆn˜; 1=blokovan˜)
                 ³ ÀÄÄÄÄÄ> 2: 1=maska kan lu 2; (0=uvolnˆn˜; 1=blokovan˜)
                 ÀÄÄÄÄÄÄÄ> 3: 1=maska kan lu 3; (0=uvolnˆn˜; 1=blokovan˜)

      - ‡ten¡: podp–rn˜ registr - posledn¡ bajt p©i p©enosu pamˆŸ-pamˆŸ



Porty 00D0H - 00DFH: ©¡zen¡ DMA/stavov‚ registry pro 16-bitov˜ DMA
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

00D0H - z pis: povelov˜ registr DMA

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=mo‘n˜ p©enos DMA pamˆŸ-pamˆŸ (kan. 4<-->5)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=mo‘n‚ dr‘en¡ adresy kan lu 4
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=blokov n¡ ©adi‡e
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=volba kompresn¡ho ‡asovac¡ho m¢du
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=mo‘n  rotuj¡c¡ priorita
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=volba roz¨¡©en‚ho z pisov‚ho m¢du;0=pozdn¡
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=aktivn¡ £rove¤ DRQ high; 0=low
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=aktivn¡ £rove¤ DACK high; 0=low

      - ‡ten¡: stavov˜ registr DMA

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ÀÄÁÂÁÄÙ ÀÄÁÄÁÄÁÄ> 0-3: kan l 4-7 ukon‡il ‡¡t n¡
            ÀÄÄÄÄÄÄÄÄÄÄÄÄ> 4-7: kan l 4-7 po‘aduje obsluhu

00D2H - z pis: registr po‘adavku

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                   ³ ÀÄÁÄ> 0-1: v˜bˆr kan lu 4-7 (00=4; 01=5; 10=6; 11=7)
                   ÀÄÄÄÄÄ>  2:  1=nastaven bit po‘adavku kan lu; 0=resetov.

00D4H - z pis: registr maskovac¡ho bitu

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                   ³ ÀÄÁÄ> 0-1: v˜bˆr kan lu 4-7 (00=4; 01=5; 10=6; 11=7)
                   ÀÄÄÄÄÄ>  2:  1=nastaven maskovac¡ bit kan lu; 0=resetov.

00D6H - z pis: registr m¢du

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: volba kan lu 4-7 (00=4; 01=5; 10=6; 11=7)
         ³ ³ ³ ³ ÀÄÁÄÄÄÄÄ> 2-3: typ p©enosu (00=verif.; 01=z pis; 10=‡ten¡)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=mo‘n  automatick  inicializace
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=inkrementace adresy; 0=dekrement. adresy
         ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6-7: 00=m¢d po‘adavku; 01=jednoduch˜ m¢d;
                                10=blokov˜ p©enos; 11=kask dn¡ m¢d

00D8H - z pis: Vynulov n¡  klopn‚ho obvodu ukazatele bajt–. Jak˜koliv z pis
               na  tuto adresu vynuluje klopn˜ obvod ukazatele bajt–, tak‘e
               p©i   p©¡¨t¡m   z pisu  nˆkter‚ho  16-bitov‚ho  registru  je
               zapisovan˜  bajt dek¢dov n jako ni‘¨¡ bajt. N sleduj¡c¡ bajt
               je vy¨¨¡ bajt (pak opˆt ni‘¨¡ atd.).

00DAH - z pis: celkov‚ nulov n¡-jak˜koliv z pis na port nuluje ©¡zen¡ (mus¡
               b˜t znovu zinicializov no)
      - ‡ten¡: pomocn˜ registr - posledn¡ bajt p©i p©enosu pamˆŸ-pamˆŸ

00DCH - z pis: vynulov n¡  maskovac¡ho  registru  - jak˜koliv z pis na port
               uvoln¡ v¨echny 4 kan ly 4 a‘ 7

00DEH - z pis: maskov n¡  kan l–  -  ma‘e nebo maskuje nˆkter˜ nebo v¨echny
               kan ly

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ÀÄ> 0: 1=maska kan lu 4; (0=uvolnˆn˜; 1=blokovan˜)
                 ³ ³ ÀÄÄÄ> 1: 1=maska kan lu 5; (0=uvolnˆn˜; 1=blokovan˜)
                 ³ ÀÄÄÄÄÄ> 2: 1=maska kan lu 6; (0=uvolnˆn˜; 1=blokovan˜)
                 ÀÄÄÄÄÄÄÄ> 3: 1=maska kan lu 7; (0=uvolnˆn˜; 1=blokovan˜)

      - ‡ten¡: podp–rn˜ registr - posledn¡ bajt p©i p©enosu pamˆŸ-pamˆŸ


Porty 0080H - 008FH: str nkov‚ registry DMA 74LS612
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Chcete-li nastavit po‡ te‡n¡ adresu operac¡ DMA, vyberte nejd©¡ve kan l
t¡m,  ‘e  provedete instrukci OUT (hodnota 00H a‘ 0FH) na str nkov˜ registr
(porty  0081H  -  0083H)  a  potom  nastav¡te b zovou adresu (porty 0000H -
0007H) pro p©¡slu¨n˜ kan l. Str nkov˜ registr se nastav¡ 4-bitovou hodnotou
reprezentuj¡c¡ bity 16-19 20-bitov‚ adresy DMA. Proto‘e bˆ‘n  adresa ‡¡ta‡e
DMA  je  16-bitov   hodnota,  nen¡  mo‘n‚  prov dˆt  pomoc¡ DMA p©enos p©es
hranice 64K (tj. adresy 1000:0000, 2000:0000 atd.).

0081H - str nkov˜ registr kan lu 2 - adresov‚ bity 16-19 (disketov˜ DMA)
0082H - str nkov˜ registr kan lu 3 - adresov‚ bity 16-19 (pevn˜ disk)
0083H - str nkov˜ registr kan lu 1 - adresov‚ bity 16-19

    Po‡¡ta‡e  AT  pou‘¡vaj¡  pro  nastaven¡  adresy  str nky  v¨ech  8 bit–
str nkov‚ho registru. Je to z toho d–vodu, ‘e AT pou‘¡v  24-bitov˜ adresov˜
prostor.  Spodn¡ch  16  bit–  je nastaveno v adresov‚m registru kan lu DMA,
vy¨¨¡ch 8 bit– je pou‘ito ze str nkov‚ho registru. Velikost str nek je 128K
(tj  64K  slov),  tak‘e  p©enosy  DMA nesmˆj¡ p©ekra‡ovat hranici 128K (tj.
adresy 2000:0, 4000:0 atd.).

0081H - str nkov˜ registr kan lu 2 - adresov‚ bity 16-23 (disketov˜ DMA)
0082H - str nkov˜ registr kan lu 3 - adresov‚ bity 16-23 (pevn˜ disk)
0083H - str nkov˜ registr kan lu 1 - adresov‚ bity 16-23 (SDLC)
0087H - str nkov˜ registr kan lu 0 - adresov‚ bity 16-23
0089H - str nkov˜ registr kan lu 6 - adresov‚ bity 17-23
008BH - str nkov˜ registr kan lu 5 - adresov‚ bity 17-23
008AH - str nkov˜ registr kan lu 7 - adresov‚ bity 17-23
008FH - refresh

    Str nkov˜  registr  na  adrese  0080H m  u po‡¡ta‡e AT zvl ¨tn¡ funkci.
SLou‘¡   jako   diagnostick˜  bod  a  jsou  do  nˆj  st© d ny  chyby  bˆhem
inizializa‡n¡ho testu POST.


                          ÿ4ÿ.ÿ-  ÿ€ÿaÿsÿoÿvÿaÿ‡

Porty 0040H - 005FH: ‡asova‡ 8253-5 (AT: 8254.2)
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    €asova‡  pou‘¡v   sv–j  vlastn¡  krystal o kmito‡tu 14.31818 MHz, jeho‘
kmito‡et  po  vydˆlen¡  p©eddˆli‡kou  (dˆl¡c¡  v  pomˆru  1:12) na kmito‡et
1.193182úMHz  slou‘¡  jako  zdroj  hodinov˜ch impuls– ‡asova‡e (vstup CLK).
Funkce  8254.2  u  AT  se li¨¡ oproti 8253 p©edev¨¡m vˆt¨¡m po‡tem p©¡kaz–,
kter‚  umo‘¤uj¡  snadnˆj¨¡  zapamatov n¡ stavu ‡¡ta‡e bˆhem ‡¡t n¡ a zpˆtn‚
‡ten¡.

0040H -  z pis: nastaven¡ ‡¡ta‡e 0
         ‡ten¡: stav ‡¡ta‡e 0

          V˜stup  z  ‡¡ta‡e 0 je p©iveden na vstup IRQ 0 ©adi‡e p©eru¨en¡ a
pou‘¡v  se jako zdroj impuls– pro syst‚mov‚ hodiny (dˆl¡c¡ pomˆr 65279).

0041H -  z pis: nastaven¡ ‡¡ta‡e 1
         ‡ten¡: stav ‡¡ta‡e 1

          €¡ta‡  1  slou‘¡  ke generov n¡ sign lu REFRESH pro ob‡erstvov n¡
         pamˆti (dˆl¡c¡ pomˆr 4866).

0042H -  z pis: nastaven¡ ‡¡ta‡e 2
         ‡ten¡: stav ‡¡ta‡e 2

          V˜stup z ‡¡ta‡e 2 je pou‘it jako v˜stup na vestavˆn˜ reproduktor.
         V˜stup  na  reproduktor se aktivuje pomoc¡ portu 0061H (bity 0 a 1
         mus¡ b˜t nastaveny na 1).

              mov       bx,330         ; VSTUP - frekvence uveden  v Hz
              mov       cx,40000       ; VSTUP - prodleva (pomocn˜ £daj)
              mov       al,0b6h        ; povel pro nastaven¡ kan lu 2
              out       [43h],al       ; nastaven¡ povelu
              mov       dx,12h         ; vy¨¨¡ slovo konstanty
              mov       ax,34deh       ; ni‘¨¡ slovo konstanty
              div       bx             ; v˜po‡et dˆl¡c¡ho pomˆru
              out       [42h],al       ; nastaven¡ ni‘¨¡ho bajtu dˆli‡ky
              mov       al,ah          ; vy¨¨¡ bajt dˆli‡ky
              out       [42h],al       ; nastaven¡ vy¨¨¡ho bajtu dˆli‡ky
              in        al,[61h]       ; sou‡asn‚ nastaven¡ portu 61h
              or        al,3           ; nastaven¡ bit– pro reproduktor
              out       [61h],al       ; zapnut¡ zvukov‚ho v˜stupu
              loop      $              ; prodleva
              and       al,0fch        ; vynulov n¡ ovl dac¡ch bit–
              out       [61h],al       ; vypnut¡ zvukov‚ho v˜stupu

0043H -  z pis: volba m¢du ‡¡ta‡e (‡ten¡ registru u 8253 nen¡ mo‘n‚)

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=‡¡t  v k¢du BCD, 0=‡¡t  v bin rn¡m k¢du
         ³ ³ ³ ³ ÀÄÁÄÁÄÄÄ> 1-3: m¢d ‡¡ta‡e:  000 - m¢d 0     (p©i pr ci
         ³ ³ ³ ³                             001 - m¢d 1      s pomocn˜m
         ³ ³ ³ ³                             x10 - m¢d 2      registrem
         ³ ³ ³ ³                             x11 - m¢d 3      jsou tyto
         ³ ³ ³ ³                             100 - m¢d 4        bity
         ³ ³ ³ ³                             101 - m¢d 5      bezv˜znamn‚)
         ³ ³ ÀÄÁÄÄÄÄÄÄÄÄÄ> 4-5: 00 - operace   s  pomocn˜m  registrem  (p©i
         ³ ³                         ‡ten¡  stavu  ‡¡ta‡e  se okam‘it˜ stav
         ³ ³                         ‡¡ta‡e  uschov v  v pomocn‚m registru,
         ³ ³                         aby   jej   bylo   mo‘no  p©e‡¡st  bez
         ³ ³                         zastaven¡ ‡¡ta‡e)
         ³ ³                    01 - ‡ten¡/z pis jen ni‘¨¡ slabiky dˆli‡e
         ³ ³                    10 - ‡ten¡/z pis jen vy¨¨¡ slabiky dˆli‡e
         ³ ³                    11 - ‡ten¡/z pis ni‘¨¡ a potom vy¨¨¡ slab.
         ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6,7: volba ‡¡ta‡e: (0 a‘ 2, 3=neplatn˜ k¢d)

         M•D 0 - p©eru¨en¡  na  konci  ‡¡t n¡:  V˜stup  OUT  ‡¡ta‡e  se  po
                 ukon‡en¡  ‡¡t n¡  p©eklop¡  z  hodnoty L na £rove¤ H a‘ do
                 doby  nov‚ho  nastaven¡.  P©i  z pisu  p©edvolby v pr–bˆhy
                 ‡¡t n¡ se po z pisu 1. slabiky prob¡haj¡c¡ ‡¡t n¡ zastav¡,
                 po z pisu 2. slabiky se odstartuje nov‚ ‡¡t n¡. Vstup GATE
                 (pouze u ‡¡ta‡e 2 - bit 0 portu 61h) povoluje ‡¡t n¡ pouze
                 pokud je na £rovni H.
         M•D 1 - monostabiln¡ gener tor: Vzestupn  hrana vstupu GATE spust¡
                 v˜stupn¡  impuls - v˜stup OUT p©ejde na £rove¤ L a z–stane
                 v n¡ po dobu nastavenou p©edvolbou. Po t‚to dobˆ se v˜stup
                 navr t¡  zpˆt  na  £rove¤  H.  Jestli‘e byla bˆhem impulsu
                 vlo‘ena nov  p©edvolba, d‚lka impulsu se nezmˆn¡ (zmˆn¡ se
                 a‘ n sleduj¡c¡ impuls). Pr–bˆ‘n˜ stav ‡¡ta‡e m–‘e b˜t ‡ten
                 kdykoliv,  ani‘ by to ovlivnilo generov n¡ impulsu. Impuls
                 je mo‘n‚ znovu spou¨tˆt i v dobˆ jeho trv n¡.
         M•D 2 - dˆlen¡  frekvence:  V˜stup  OUT  bude  na £rovni L po dobu
                 jedn‚   periody   hodinov‚ho   impulsu  CLK,  rozte‡  mezi
                 v˜stupn¡mi  impulsy  odpov¡d   dobˆ  nastaven‚  p©edvolbou
                 ‡¡ta‡e  (v˜stupn¡  kmito‡et  OUT  je tedy N-kr t men¨¡ ne‘
                 hodinov˜ kmito‡et CLK). Jestli‘e byl obsah registru ‡¡ta‡e
                 zmˆnˆn mezi dvˆmi v˜stupn¡mi impulsy, prob¡haj¡c¡ v˜stupn¡
                 perioda  se nezmˆn¡. Vstup GATE an £rovni L p©evede OUT na
                 £rove¤  H.  Vzestupn  hrana GATE zah j¡ ‡¡t n¡ z po‡ te‡n¡
                 hodnoty  (lze  vyu‘¡t  k  synchronizaci ‡¡ta‡e). V˜stup je
                 tak‚  neaktivn¡  (tj. na £rovni H) po dobu plnˆn¡ registru
                 ‡¡ta‡e p©edvolbou.
         M•D 3 - generov n¡  obd‚ln¡kov˜ch  pr–bˆh–:  M¢d  3 je stejn˜ jako
                 m¢dú2  s  t¡m  rozd¡lem, ‘e v˜stup OUT bude na £rovni L po
                 polovinu  doby  a na £rovni H po druhou polovinu doby. Pro
                 lich‚ ‡¡slo N (p©edvolba) bude OUT o 1 takt d‚le na £rovni
                 H.  Nov  hodnota dˆli‡e se uplatn¡ ji‘ p©i dal¨¡m p–ltaktu
                 v˜stupu OUT.
         M•D 4 - strobov n¡ ovl dan‚ programem: Po nastaven¡ m¢du je OUT=H,
                 po  zaveden¡  p©edvolby  za‡ne  ‡¡tat,  po do‡¡t n¡ p©ejde
                 v˜stup  OUT  po dobu jedn‚ periody CLK na £rove¤ L a vr t¡
                 se zpˆt na £rove¤ H. Vstup GATE=L zastav¡ ‡¡t n¡.
         M•D 5 - strobov n¡   ol dan‚  obvodovˆ:  €¡ta‡  zah j¡  ‡¡t n¡  po
                 vzestupn‚  hranˆ  vstupu  GATE  (tj.  p©echod L -> H) a po
                 do‡¡t n¡  p©ejde  v˜stup  OUT po dobu jedn‚ periody CLK na
                 £rove¤  L.  Nov   vzestupn   hrana  GATE  zah j¡ ‡¡t n¡ od
                 po‡ te‡n¡ hodnoty i bˆhem ‡¡t n¡.

Pozn.: Z pis  hodnoty  0  jako  ‡asovac¡  konstanta  odpov¡d   hodnotˆ  216
       vúbin rn¡m nebo 104 v BCD k¢du.




                       ÿ5ÿ.ÿ-  ÿKÿlÿ ÿvÿeÿsÿnÿiÿcÿe


Porty 0060H - 006FH: ©adi‡ kl vesnice 8042
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0060H - (program. perifern¡ interface - kan l A) datov˜ registr kl vesnice
      - ‡ten¡: k¢d kl vesy z kl vesnice (roz¨i©uj¡c¡ k¢d kl vesy)

         IN AL,60H           ; ‡ten¡ k¢du kl vesy

        Viz  t‚‘  p©eru¨en¡  INT  09H  (p©eru¨en¡ kl vesnic¡). P©eru¨en¡ je
        vyvol no  hardwarovˆ  sign lem  IRQ 1 a je vyvol no v‘dy p©i stisku
        nebo p©i uvolnˆn¡ kter‚koliv kl vesy, resp. p©i jej¡m dr‘en¡.

0061H - (programovateln˜ perifern¡ interface PPI - kan l B)
      - z pis: ovl d n¡ reproduktoru, kl vesnice a kontroly pamˆti a I/O

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: hradlov n¡ ‡asova‡e 2 (reproduktor)Ä¿  1=zap
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: kl¡‡ov n¡ v˜stupu na reproduktor ÄÄÄÁÄ 0=vyp
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: v‘dy = 0
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=‡ten¡ horn¡ch p©ep¡na‡–; 0=doln¡ (viz 62H)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 0=mo‘n  kontrola parity RAM; 1=z kaz kontr.
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 0=mo‘n  kontrola kan lu I/O
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 0=ponech n¡ hodin kl vesnice dole
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 0=povolen  kl vesnice; 1=blokovan  kl vesnice

         Pozn.: data OR  03H ---> zapnut¡ reproduktoru
                data AND FCH ---> vypnut¡ reproduktoru

0062H - (programovateln˜ perifern¡ interface PPI - kan l C)
      - ‡ten¡: ‡ten¡ p©ep¡na‡– DIL, ‡asova‡e, stavu kontrol pamˆti a I/O

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: hodnota p©ep¡na‡– DIL (viz v˜pis vybaven¡)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4: v‘dy = 0
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5: 1=v˜stup kan lu ‡asova‡e 2
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6: 1=kontrola kan lu I/O
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7: 1=vyskytla se chyba kontroly parity RAM

0063H - (©¡d¡c¡ registr m¢du programovateln‚ho perifern¡ho interface PPI) -
        tento  registr  nastavuje,  kter˜  port  PPI  je  vstupn¡  a  kter˜
        v˜stupn¡. BIOS zde nastav¡ hodnotu 99H (porty A a C jsou vstupn¡, B
        je v˜stupn¡).

0064H - povelov˜ registr kl vesnice AT (pouze pro AT !)
      - tento  port komunikuje s 8042, kter˜ spou¨t¡ ©¡d¡c¡ program on-chip
        pro obsluhu kl vesnice. P©ij¡m  k¢dy povel– a datov‚ bajty.


    Kl vesnice   AT  (a  jej¡  mikropo‡¡ta‡ov˜  interface  Intel  8042)  je
programovateln   a  je  mnohem  zaj¡mavˆj¨¡  ne‘  kl vesnice  PC ve "star‚m
stylu".  S  pou‘it¡m  n sleduj¡c¡ch  informac¡  m–‘ete  nastavovat rychlost
opakov n¡ kl vesy a hr t hry s pou‘it¡m indik tor– LED na kl vesnici.

    Port  60H  je  ur‡en  pro z pis dat a je podporov n pro kompatibilitu s
d©¡vˆj¨¡my  modely.  Pokud  p©¡klad  pou‘¡vaj¡c¡  port 64H nebude pracovat,
zkuste pou‘¡t port 60H.

    Port  64H je ur‡en pro z pis povel– a dat a pro ‡ten¡ stavu kl vesnice.
P©ed  vysl n¡m  povelu  na  kl vesnici testuje BIOS jej¡ stav (IN AL,64H) a
ubezpe‡uje  se, ‘e nen¡ stisknuta ‘ dn  kl vesa nebo ‘e vnit©n¡ buffer nen¡
pln˜ atd. Je v tom mal˜ risk, pokud jdete p©¡mo a vy¨lete povel:

         mov       al,kod_cmd               ; ‡¡slo povelu pro kl vesnici
         out       64h,al                   ; vysl n¡ povelu



    Pro dvoud¡ln‚ povely, jako nap©. nastaven¡ rychlosti opakov n¡ kl vesy,
je rozumn‚ za©adit mezi jednotliv‚ v˜stupy malou prodlevu:

         mov       al,kod_cmd               ; ‡¡slo povelu pro kl vesnici
         out       64h,al                   ; vysl n¡ povelu
         mov       cx,2000h                 ; prodleva asi 10ms
prodl:   loop      prodl                    ; prodleva mezi v˜stupy OUT
         mov       al,hodnota_dat           ; druh  ‡ st povelu pro kl v.
         out       64h,al                   ; vysl n¡ druh‚ ‡ sti povelu

Povely pro ovl d n¡ kl vesnice AT (vy¨le se na port 64H):
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0FFH - reset kl vesnice a start vnit©n¡ diagnostiky
0FEH - opakovan‚ vysl n¡ posledn¡ho p©enosu
0FDH - 0F7H - ‘ dn  funkce (NOP)
0F6H - nastaven¡ kl vesnice na standardn¡ hodnoty a pokra‡ov n¡ v testov n¡
0F5H - nastaven¡ kl vesnice na stand. hodnoty a z kaz testov n¡ kl vesnice
0F4H - uvolnˆn¡  kl vesnice.  Kl vesnice  vy¨le  'ACK' (potvrzen¡), vy‡ist¡
       buffer a za‡ne testov n¡ kl ves
0F3H - nastaven¡  rychlosti  generov n¡  znak– a prodlevy. Nejd©¡ve vy¨lete
       bajt 0F3H (tento p©¡kaz) a potom datov˜ bajt:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ÀÄÁÄÁÄÁÄÁÄ> 0-4: nastaven¡ rychlosti opakov n¡ znaku
         ³ ÀÄÁÄÄÄÄÄÄÄÄÄÄÄ> 5-6: nastaven¡ inicial. prodlevy p©ed opakov n¡m
         ³                      00=250ms; 01=500ms; 10=750ms; 11=1000ms
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  je v‘dy nastaven na 0


    Rychlosti generov n¡ znak– ve znac¡ch za sekundu (bity 0-4):
ÉÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º hodnota ³  rychlost   º hodnota ³  rychlost   º hodnota ³  rychlost   º
ÌÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÎÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÎÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º   00H   ³    30.0     º   0BH   ³   10.9      º   16H   ³    4.3      º
º   01H   ³    26.7     º   0CH   ³   10.0      º   17H   ³    4.0      º
º   02H   ³    24.0     º   0DH   ³    9.2      º   18H   ³    3.7      º
º   03H   ³    21.8     º   0EH   ³    8.6      º   19H   ³    3.3      º
º   04H   ³    20.0     º   0FH   ³    8.0      º   1AH   ³    3.0      º
º   05H   ³    18.5     º   10H   ³    7.5      º   1BH   ³    2.7      º
º   06H   ³    17.1     º   11H   ³    6.7      º   1CH   ³    2.5      º
º   07H   ³    16.0     º   12H   ³    6.0      º   1DH   ³    2.3      º
º   08H   ³    15.0     º   13H   ³    5.5      º   1EH   ³    2.1      º
º   09H   ³    13.3     º   14H   ³    5.0      º   1FH   ³    2.0      º
º   0AH   ³    12.0     º   15H   ³    4.6      º         ³             º
ÈÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Kl vesnice  je p©i inicializaci nastavena na inicializa‡n¡ prodlevu 1/2
sekundy  (tj.  za p–l sekundy po stisku kl vesy se za‡nou generovat znaky s
automatick˜m opakov n¡m) a rychlost opakov n¡ znak– (p©i dr‘en¡ kl vesy) 10
znak– za sekundu. To je p©¡li¨ pomal‚. Datov˜ bajt 00H nastav¡ nejrychlej¨¡
stav - prodleva 1/4 sekundy a rychlost opakov n¡ 30 znak– za sekundu.

0F2H - 0EFH - ‘ dn  funkce (NOP)
0EEH - echo; diagnostick  podpora. Jednodu¨e vy¨le bajt 0EEH p©¡mo zpˆt.
0EDH - nastaven¡  svˆteln˜ch indik tor– LED. Nejd©¡ve vy¨lete povelov˜ bajt
       0EDH a potom vy¨lete datov˜ bajt:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                   ³ ³ ÀÄ> 0: signalizace Scroll Lock (1=sv¡t¡; 0=nesv¡t¡)
                   ³ ÀÄÄÄ> 1: signalizace Num Lock (1=sv¡t¡; 0=nesv¡t¡)
                   ÀÄÄÄÄÄ> 2: signalizace Caps Lock (1=sv¡t¡; 0=nesv¡t¡)

    Bitov‚  pozice 0-2 koresponduj¡ s bity 4-6 bajtu p©¡znak– kl vesnice na
adrese  0:0417H (BIOS) a se ‡ten¡m stavu kl vesnice INT 16H/slu‘ba 02H nebo
slu‘ba  12H.  P©i  nastavov n¡  indik tor– LED je pot©eba myslet na to, aby
byly indik tory mˆnˆny souhlasnˆ s nastaven¡m indik tor– v pamˆti po‡¡ta‡e.
Nap©.  pokud  chcete  nastavit  ‡¡selnou kl vesnici do ‡¡slen‚ho re‘imu (tj
zapnut  m¢d  Num  Lock),  mus¡te nastavit bit 5 na adrese 0:0417H, ale tak‚
p©¡slu¨n˜ indik tor LED (bit 1 zde popsan‚ho bajtu).

Pozn.: P©i uvolnˆn¡ kl vesy je vysl n z kl vesnice orienta‡n¡ k¢d kl vesy s
       nastaven˜m 7.bitem k¢du.




    Orienta‡n¡ k¢dy kl ves - p–vodn¡ kl vesnice PC/XT (83 a 84 kl ves):

    ÉÍÍÍÍÍÑÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»   ÉÍÍÍÍÍÑÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
    º 01H ³  1 ³ Esc               º   º 2BH ³ 43 ³ \ |               º
    º 02H ³  2 ³ 1 !               º   º 2CH ³ 44 ³ Z                 º
    º 03H ³  3 ³ 2 @               º   º 2DH ³ 45 ³ X                 º
    º 04H ³  4 ³ 3 #               º   º 2EH ³ 46 ³ C                 º
    º 05H ³  5 ³ 4 $               º   º 2FH ³ 47 ³ V                 º
    º 06H ³  6 ³ 5 %               º   º 30H ³ 48 ³ B                 º
    º 07H ³  7 ³ 6 ^               º   º 31H ³ 49 ³ N                 º
    º 08H ³  8 ³ 7 &               º   º 32H ³ 50 ³ M                 º
    º 09H ³  9 ³ 8 *               º   º 33H ³ 51 ³ , <               º
    º 0AH ³ 10 ³ 9 (               º   º 34H ³ 52 ³ . >               º
    º 0BH ³ 11 ³ 0 )               º   º 35H ³ 53 ³ / ?               º
    º 0CH ³ 12 ³ - _               º   º 36H ³ 54 ³ prav˜ Shift       º
    º 0DH ³ 13 ³ + =               º   º 37H ³ 55 ³ Print Screen      º
    º 0EH ³ 14 ³ Back space        º   º 38H ³ 56 ³ Alt               º
    º 0FH ³ 15 ³ Tab               º   º 39H ³ 57 ³ mezern¡k          º
    º 10H ³ 16 ³ Q                 º   º 3AH ³ 58 ³ Caps Lock         º
    º 11H ³ 17 ³ W                 º   º 3BH ³ 59 ³ F1                º
    º 12H ³ 18 ³ E                 º   º 3CH ³ 60 ³ F2                º
    º 13H ³ 19 ³ R                 º   º 3DH ³ 61 ³ F3                º
    º 14H ³ 20 ³ T                 º   º 3EH ³ 62 ³ F4                º
    º 15H ³ 21 ³ Y                 º   º 3FH ³ 63 ³ F5                º
    º 16H ³ 22 ³ U                 º   º 40H ³ 64 ³ F6                º
    º 17H ³ 23 ³ I                 º   º 41H ³ 65 ³ F7                º
    º 18H ³ 24 ³ O                 º   º 42H ³ 66 ³ F8                º
    º 19H ³ 25 ³ P                 º   º 43H ³ 67 ³ F9                º
    º 1AH ³ 26 ³ [ {               º   º 44H ³ 68 ³ F10               º
    º 1BH ³ 27 ³ ] }               º   º 45H ³ 69 ³ Num Lock          º
    º 1CH ³ 28 ³ Enter             º   º 46H ³ 70 ³ Scroll Lock       º
    º 1DH ³ 29 ³ Ctrl              º   º 47H ³ 71 ³ Home          [7] º
    º 1EH ³ 30 ³ A                 º   º 48H ³ 72 ³ kurzor nahoru [8] º
    º 1FH ³ 31 ³ S                 º   º 49H ³ 73 ³ Page Up       [9] º
    º 20H ³ 32 ³ D                 º   º 4AH ³ 74 ³ - (v numer. poli) º
    º 21H ³ 33 ³ F                 º   º 4BH ³ 75 ³ kurzor vlevo  [4] º
    º 22H ³ 34 ³ G                 º   º 4CH ³ 76 ³               [5] º
    º 23H ³ 35 ³ H                 º   º 4DH ³ 77 ³ kurzor vpravo [6] º
    º 24H ³ 36 ³ J                 º   º 4EH ³ 78 ³ + (v numer. poli) º
    º 25H ³ 37 ³ K                 º   º 4FH ³ 79 ³ End           [1] º
    º 26H ³ 38 ³ L                 º   º 50H ³ 80 ³ kurzor dol–   [2] º
    º 27H ³ 39 ³ ; :               º   º 51H ³ 81 ³ Page Down     [3] º
    º 28H ³ 40 ³ " '               º   º 52H ³ 82 ³ Ins           [0] º
    º 29H ³ 41 ³ ` ~               º   º 53H ³ 83 ³ Del           [.] º
    º 2AH ³ 42 ³ lev˜ Shift        º   º(54H)³(84)³(SysRq)            º
    ÈÍÍÍÍÍÏÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼   ÈÍÍÍÍÍÏÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Kl vesnice  AT  84  kl ves  se  odli¨uje od p–vodn¡ kl vesnice PC/XT 83
kl ves pouze p©id n¡m kl vesy SysRq s k¢dem 54H (84).

    Kl vesnice  AT  101  kl ves  m  t©i oddˆlen  mapov n¡ orienta‡n¡ch k¢d–
kl ves,  volen   pomoc¡ portu 64H. V z kladn¡ sadˆ k¢d– se mˆn¡ ‡i dopl¤uj¡
tyto k¢dy:

    ÉÍÍÍÍÍÑÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
    º 37H ³ 55 ³ * (v numer. poli) º
    º 56H ³ 86 ³ zdvojen   \ |     º
    º 57H ³ 87 ³ F11               º
    º 58H ³ 88 ³ F12               º
    ÈÍÍÍÍÍÏÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Pomoc¡  druh‚ho  mapov n¡  se  generuj¡  zdvojenˆ k¢dy kl ves Ins, Del,
Home,  End, Page Up, Page Down, kurzorov‚ kl vesy, Num Lock, / v numerick‚m
poli,  Enter  v  numerick‚m  poli, prav˜ Ctrl, prav˜ Alt, Caps Lock, Scroll
Lock  a  Pause.  Tyto  kl vesy generuj¡ stejn˜ orienta‡n¡ k¢d jako u PC/XT,
av¨ak je pomoc¡ p©eru¨en¡ rozli¨eno, ‘e se jedn  o jin‚ kl vesy.




         ÿ6ÿ.ÿ-  ÿPÿaÿmÿˆÿŸ  ÿCÿMÿOÿSÿ,  ÿmÿaÿsÿkÿoÿvÿ ÿnÿ¡  ÿNÿMÿI


    T©¡dy  po‡¡ta‡– AT obsahuj¡ hodiny re ln‚ho ‡asu nap jen‚ z vestavˆn˜ch
bateri¡  a  64-bajtovou  n¡zkop©¡konovou  pamˆŸ  CMOS  (tato  pamˆŸ  je p©i
vypnut‚m po‡¡ta‡i nap jena t‚‘ z bateri¡).

    PamˆŸ  CMOS  obsahuje  r–zn‚  informace,  v‡etnˆ  bˆ‘n‚ho  ‡asu a data,
nastaven¡  hardwarov‚  konfigurace  a  stavov˜ bajt pro uzav©en¡ (uzav¡rac¡
bajt  se  pou‘¡v   v mechanismu umo‘¤uj¡c¡m AT opakovanˆ startovat v m¡stˆ,
kde procesor program k ukon‡en¡ ochrann‚ho m¢du).

    Pokud  uvid¡te  bˆhem inicializa‡n¡ho testu POST hl ¨en¡ "Run Setup" je
to proto, ‘e nˆkter˜ hardware nem  ulo‘en sv–j z znam konfigurace nebo se v
CMOS RAM vyskytly nˆjak‚ jin‚ probl‚my.


Porty 0070H - 0071H: p©¡stup k pamˆti CMOS, maskov n¡ p©eru¨en¡ NMI
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0070H - z pis: nastaven¡ adresy CMOS (Bity 0 a‘ 5: adr. 0 a‘ 63; bit7: NMI)

        U   po‡¡ta‡e   AT   slou‘¡   tento   port   sou‡asnˆ   k  maskov n¡
        nemaskovateln‚ho  p©eru¨en¡  NMI.  Jak˜koliv v˜stup na tento port s
        vynulovan˜m  bitem  ‡¡slo  7 umo‘¤uje nemaskovateln‚ p©eru¨en¡ NMI;
        nastaven¡  tohoto  bitu  zp–sob¡  z kaz  p©eru¨en¡  NMI  (Maskov n¡
        p©eru¨en¡ NMI u po‡¡ta‡e PC/XT - viz kapitola ©adi‡ p©eru¨en¡).

0071H - z pis: z pis dat do CMOS na adresu nastavenou pomoc¡ OUT 70H,adr
        ‡ten¡: ‡ten¡ dat z CMOS z adresy nastaven‚ pomoc¡ OUT 70H,adr

    Ke  ‡ten¡  bajtu  z  pamˆti  CMOS vy¨lete nejd©¡ve na port o adrese 70H
adresu  pamˆŸov‚ho  m¡sta  CMOS,  kter‚  m   b˜t ‡teno nebo do kter‚ho bude
zapisov no,  potom  z  adresy  71H m–‘ete ‡¡st nebo na ni zapisovat data do
CMOS na uveden‚ adrese.

P©¡klad:                               ; ‡ten¡ typu pevn‚ho disku
         mov       al,12h              ; adresa £daje o disku = 12H
         out       70h,al              ; nastavnen¡ adresy CMOS na 12H
         jmp       $+2                 ; mal  prodleva k ust len¡ dat CMOS
         in        al,71h              ; AL nyn¡ obsahuje typ pevn‚ho disku

    Adresy  10H  a‘  20H jsou chr nˆny metodou kontroln¡ho sou‡tu, aby bylo
mo‘n‚  detekovat,  kdy‘  jsou  baterie  vybit‚  nebo  byl  do pamˆti zaps n
neplatn˜  z pis  konfigurace  (nap©. kdy‘ se "zabˆhne" program a n hodou se
provede instrukce OUT 71H - obvykle se zmˆn¡ nastaven¡ pevn‚ho disku, kter‚
bylo  ‡teno  naposled).  Kontroln¡  sou‡et  je  jednoduch˜ 16-bitov˜ sou‡et
chr nˆn˜ch bajt–.

    Pozn.: Dal¨¡  informace  o  hodin ch  re ln‚ho  ‡asu z¡sk te v p©¡ru‡ce
           Motorolla MC146818.


Obsahy pamˆti CMOS (z pis nebo ‡ten¡ podle p©edchoz¡ho popisu):
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
Adresa CMOS:     Popis:

00H    - hodiny re ln‚ho ‡asu - sekunda
01H    - alarm - sekundy
02H    - hodiny re ln‚ho ‡asu - minuta
03H    - alarm - minuty
04H    - hodiny re ln‚ho ‡asu - hodina
05H    - alarm - hodina
06H    - hodiny re ln‚ho ‡asu - den v t˜dnu
07H    - hodiny re ln‚ho ‡asu - den mˆs¡ce
08H    - hodiny re ln‚ho ‡asu - mˆs¡c
09H    - hodiny re ln‚ho ‡asu - rok

0AH    - stavov˜ registr hodin re ln‚ho ‡asu - A (‡ten¡)

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: v˜bˆr rychlosti (nastaven na 0110)
         ³ ÀÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-6: 22-stup¤ov  dˆli‡ka (nastaveno na 010)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: p©¡znak pr–bˆ‘n‚ho ulo‘en¡ (UIP) (0=‡ten¡ OK)

0BH    - stavov˜ registr hodin re ln‚ho ‡asu - B (z pis)

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: mo‘n‚ ulo‘en¡ denn¡ho cyklu (0=standard) (0)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: cyklus: 0=12; 1=24                       (1)
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: m¢d dat BCD: 1=bin rn¡; 0=BCD            (0)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: mo‘n˜ obd‚ln¡kov˜ pr–bˆh: 1=ano; 0=ne    (0)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: mo‘n‚ p©eru¨en¡ ukon‡en¡ dne: 1=ano; 0=ne(0)
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: mo‘n‚ p©eru¨en¡ alarmem: 1=ano; 0=ne     (0)
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: mo‘n‚ periodick‚ p©eru¨en¡: 1=ano; 0=ne  (0)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: p©¡znak pr–bˆ‘n‚ho ulo‘en¡ (UIP) (0=‡ten¡ OK)


0CH    - stavov˜ registr hodin re ln‚ho ‡asu - C (‡ten¡)
       - stavov‚ bity p©¡znak– p©eru¨en¡

0DH    - stavov˜ registr hodin re ln‚ho ‡asu - D (z pis)
       - bit 7 = 1 pokud CMOS=RAM je p©ipojena k nap jen¡
               = 0 idnikuje, ‘e baterie je vybit 

0EH    - stavov˜ bajt diagnostiky p©i vnit©n¡ inicializaci syst‚mu (POST)
         tento bajt ukl d  POST p©i inicializaci syst‚mu

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: = 0
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: = 0
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=‡as neplat¡ (nap©. nen¡ 30.£nor)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=¨patn˜ pevn˜ disk (nelze z nˆj zav‚st OS)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=velikost pamˆti nen¡ spr vn 
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=z znam konfigurace nen¡ spr vn˜
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=kontroln¡ sou‡et CMOS RAM nesouhlas¡
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=vybit  baterie CMOS RAM

0FH    - stavov˜ bajt p©eru¨en¡
         Tento  bajt  je ‡ten p©i startu po‡¡ta‡e po resetu procesoru kv–li
         spr vn‚mu  ur‡en¡,  zda  byl  reset  pou‘it jako cesta k p©eru¨en¡
         procesoru 80286 z ochrann‚ho m¢du.
              0 = mˆkk˜ reset (Ctrl-Alt-Del) nebo nevyj¡me‡n‚ p©eru¨en¡
              1 = p©eru¨en¡ po ur‡en¡ velikosti pamˆti
              2 = p©eru¨en¡ po proveden¡ test– pamˆti
              3 = p©eru¨en¡ po chybˆ pamˆti (kontrola parity 1 nebo 2)
              4 = p©eru¨en¡ s po‘adavkem zavadˆ‡e syst‚mu
              5 = p©eru¨en¡  instrukc¡  FAR JMP (restart vnit©n¡ho ©adi‡e a
                  skok na adresu 0:[0467H])
          6,7,8 = p©eru¨en¡ po proveden¡ testu ochrann‚ho m¢du
              9 = p©eru¨en¡ po proveden¡ blokov‚ho p©esunu (INT 15H/sl.87H)
             10 = p©eru¨en¡ instrukc¡ FAR JMP (p©¡m˜ skok na 0:[0467H])

10H    - typ disketov‚ mechaniky

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit                                 0000 = ‘ dn 
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: prvn¡ disketov  mechanika ÄÂÄ> 0001 = 360K
         ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-7: druh  disketov  mechanika ÄÙ   0000 = 1.2M

11H    - rezervov no

12H    - typ jednotky pevn‚ho disku (pro disk C: a D:, pokud je 1 a‘ 14)

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: prvn¡ pevn˜ disk (C:) ÄÂÄ> 0000 = ‘ dn˜
         ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-7: druh˜ pevn˜ disk (D:) ÄÙ   jinak= typ
                                                           1111 = 19H/1AH

    Pokud  je  pro  dan˜  disk  ud na hodnota 1111 (tj. typ 15), je pro typ
disku pou‘it £daj z adres 19H a 1AH pamˆti CMOS.

    Typy mechanik jsou p©eddefinov ny v ROM-BIOS. Vektory INT 41H a INT 46H
jsou  p©i  inicializaci  nastaveny  na tabulku ROM obsahuj¡c¡ informace pro
instalovan‚  typy mechanik pevn˜ch disk–. Viz t‚‘ Tabulka parametr– pevn‚ho
disku.


















ÉÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍ»
º  typ  ³  v lc–   ³  hlav ³ p©edkompenzace  ³ p©ist vac¡  ³ kapacita  º
º       ³          ³       ³z pisu (od stopy)³    z¢na     ³           º
ÌÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍ¹
º   1   ³   306    ³    4  ³      128        ³    305      ³   10MB    º
º   2   ³   615    ³    4  ³      300        ³    615      ³   21MB    º
º   3   ³   615    ³    6  ³      300        ³    615      ³   31MB    º
º   4   ³   940    ³    8  ³      512        ³    940      ³   64MB    º
º   5   ³   940    ³    6  ³      512        ³    940      ³   48MB    º
º   6   ³   615    ³    4  ³     FFFF        ³    615      ³   21MB    º
º   7   ³   462    ³    8  ³      256        ³    511      ³   31MB    º
º   8   ³   733    ³    5  ³     FFFF        ³    733      ³   31MB    º
º   9   ³   900    ³   15  ³     FFFF        ³    901      ³  151MB    º
º  10   ³   820    ³    3  ³     FFFF        ³    820      ³   21MB    º
º  11   ³   855    ³    5  ³     FFFF        ³    855      ³   36MB    º
º  12   ³   855    ³    7  ³     FFFF        ³    855      ³   51MB    º
º  13   ³   306    ³    8  ³      128        ³    319      ³   21MB    º
º  14   ³   733    ³    7  ³     FFFF        ³    733      ³   44MB    º
º  15   ³  (000)   ³   (0) ³     (000)       ³   (000)     ³  (00MB)   º
º  16   ³   612    ³    4  ³        0        ³    663      ³   21MB    º
º  17   ³   977    ³    5  ³      300        ³    977      ³   42MB    º
º  18   ³   977    ³    7  ³     FFFF        ³    977      ³   58MB    º
º  19   ³  1024    ³    7  ³      512        ³   1023      ³   61MB    º
º  20   ³   733    ³    5  ³      300        ³    732      ³   31MB    º
º  21   ³   733    ³    7  ³      300        ³    732      ³   42MB    º
º  22   ³   733    ³    5  ³      300        ³    733      ³   31MB    º
º  23   ³   306    ³    4  ³        0        ³    336      ³   10MB    º
º  24   ³   925    ³    7  ³        0        ³    925      ³   56MB    º
º  25   ³   925    ³    9  ³     FFFF        ³    925      ³   72MB    º
º  26   ³   754    ³    7  ³      754        ³    754      ³   46MB    º
º  27   ³   754    ³   11  ³     FFFF        ³    754      ³   72MB    º
º  28   ³   699    ³    7  ³      256        ³    699      ³   42MB    º
º  29   ³   823    ³   10  ³     FFFF        ³    823      ³   71MB    º
º  30   ³   918    ³    7  ³      918        ³    918      ³   55MB    º
º  31   ³  1024    ³   11  ³     FFFF        ³   1024      ³   98MB    º
º  32   ³  1024    ³   15  ³     FFFF        ³   1024      ³  133MB    º
º  33   ³  1024    ³    5  ³     1024        ³   1024      ³   44MB    º
º  34   ³   612    ³    2  ³      128        ³    612      ³   10MB    º
º  35   ³  1024    ³    9  ³     FFFF        ³   1024      ³   80MB    º
º  36   ³  1024    ³    8  ³      512        ³   1024      ³   71MB    º
º  37   ³   615    ³    8  ³      128        ³    615      ³   42MB    º
º  38   ³   987    ³    3  ³      987        ³    987      ³   25MB    º
º  39   ³   987    ³    7  ³      987        ³    987      ³   60MB    º
º  40   ³   820    ³    6  ³      820        ³    820      ³   42MB    º
º  41   ³   977    ³    5  ³      977        ³    977      ³   42MB    º
º  42   ³   981    ³    5  ³      981        ³    981      ³   42MB    º
º  43   ³   830    ³    7  ³      512        ³    830      ³   50MB    º
º  44   ³   830    ³   10  ³     FFFF        ³    830      ³   72MB    º
º  45   ³   917    ³   15  ³     FFFF        ³    918      ³  115MB    º
º  46   ³  (000)   ³   (0) ³     (000)       ³   (000)     ³  (00MB)   º
º  47   ³  1024    ³    8  ³        0        ³      0      ³   68MB    º
ÈÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍ¼

Pozn.: —daj  FFFF  ve  sloupci p©edkompenzace znamen , ‘e p©edkompenzace se
       nebude pou‘¡vat od ‘ dn‚ stopu.

       —daj  0 ve sloupci p©edkompenzace znamen , ‘e se p©edkompenzace bude
       pou‘¡vat pro v¨echny stopy (tj. od stopy 0).

       Disk typu 1 je origin ln¡ pevn˜ disk XT.

       Disk typu 2 je standardn¡ pevn˜ disk AT 20MB.

       Typy 16-23 jsou p©ipojeny do ROM-BIOSu od data 15.11.1985.

       Pokud  je  typ  disku  15 (0FH) znamen  to, ‘e typ disku je ulo‘en v
       CMOS na adrese 19H (disk C:) nebo na adrese 1AH (disk D:).

       Typ  disku  46  je  rezervov n  a  nepou‘¡v   se.  Disk  ‡¡slo 47 je
       u‘ivatelsky definovan˜ disk.

13H    - rezervov no









14H    - bajt vybaven¡ po‡¡ta‡e

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=disketov‚ jednotky jsou instalov ny
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=matematick˜ koprocesor je instalov n
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:
         ³ ³ ÀÄÁÄÄÄÄÄÄÄÄÄ> 4-5: prim rn¡ displej: 00 - ‘ dn˜ nebo EGA
         ³ ³                                      01 - 40 pozic CGA
         ³ ³                                      10 - 80 pozic CGA
         ³ ³                                      11 - monochromn¡ TTL
         ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6-7: disketov˜ch mechanik - 1 (00=1; 01=2; atd.)

15H    - z kladn¡ pamˆŸ (ni‘¨¡ bajt) ÄÂÄ>0100H=256K; 0200H=512K; 0280H=640K
16H    - z kladn¡ pamˆŸ (vy¨¨¡ bajt) ÄÙ
17H    - roz¨¡©en  pamˆŸ nad 1M (ni‘¨¡ bajt) ÄÂÄ>(v Kilobajtech, 0-3C00H)
18H    - roz¨¡©en  pamˆŸ nad 1M (vy¨¨¡ bajt) ÄÙ  (viz INT 15H/slu‘ba 88H)

19H    - typ pevn‚ho disku 0 (C:), pokud je (CMOS adresa 12H & 0FH) = 0FH
1AH    - typ pevn‚ho disku 1 (D:), pokud je (CMOS adresa 12H & F0H) = F0H

1BH-2DH - rezervov no

2EH    - kontroln¡ sou‡et CMOS - adresy 10H a‘ 20H (vy¨¨¡ bajt)
2FH    - kontroln¡ sou‡et CMOS - adresy 10H a‘ 20H (ni‘¨¡ bajt)

30H    - roz¨¡©en  pamˆŸ nad 1M (ni‘¨¡ bajt) ÄÂÄ>(v Kilobajtech, 0-3C00H)
31H    - roz¨¡©en  pamˆŸ nad 1M (vy¨¨¡ bajt) ÄÙ  (viz INT 15H/slu‘ba 88H)

32H    - sou‡asn‚ stolet¡ v BCD (tj. 19H)

33H    - v¨eobecn‚ informace      bit7=instalov na volba pamˆti IBM 128K
                                  bit6=pou‘ito utilitou "Setup"

34H-3FH - rezervov no. Zde m–‘ete ulo‘it na vˆky sv‚ jm‚no.







              ÿ7ÿ.ÿ-  ÿÿaÿdÿiÿ‡  ÿpÿeÿvÿnÿ˜ÿcÿh  ÿdÿiÿsÿkÿ–



    Mezi ©adi‡i pevn˜ch disk– r–zn˜ch po‡¡ta‡– jsou drobn‚ odchylky a proto
je  vhodn‚  ponechat  ovl d n¡  pevn‚ho disku na syst‚mov‚m firmware, kter‚
zamaskuje odli¨nosti mezi jednotliv˜mi ©adi‡i pevn˜ch disk–.


    adi‡  pevn‚ho  disku  po‡¡ta‡e  XT  dek¢duje porty 320H a‘ 327H. adi‡
generuje  p©eru¨en¡  £rovnˆ  5  (IRQ  5)  po  ka‘d‚  operaci (‡ten¡, z pis,
vystaven¡  atd.).  IRQ  5  je vektorov n na p©eru¨en¡ INT 0DH (kter‚ je t‚‘
p©i©azeno  jako  m‚nˆ pou‘¡van‚ p©eru¨en¡ IRQ pro LPT2). INT 0DH zak ‘e DMA
pevn‚ho disku a navr t¡ ©¡zen¡.


Porty 0320H - 0327H: ©adi‡ pevn‚ho disku po‡¡ta‡e XT
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0320H  - datov˜ registr; z pis povelu, ‡ten¡ statutu
       - z pis: Do   tohoto   registru  je  v‘dy  zapisov na  s‚rie  bajt–,
                zapisovan‚ sekven‡nˆ na tento port. Prvn¡m bajtem je p©¡kaz
                pro   ©adi‡,  n sleduj¡  parametrov‚  bajty  (a‘  5  bajt–)
                popisuj¡c¡  hlavu, v lec, sektor a ©¡d¡c¡ bajt maj¡c¡ r–zn‚
                tvary definic, p©¡li¨ obs hl‚ pro tuto p©¡ru‡ku.
       - ‡ten¡: Pokud  je  vysl na chyba (port 0321H, bit 1), m–‘ete zapsat
                do  tohoto  registru  p©¡kazovou  sekvenci dotazu na stav a
                potom  jej  ‡ty©n sobnˆ ‡¡st k obdr‘en¡ ve¨ker˜ch informac¡
                od ©adi‡e. Prvn¡ batj indikuje chybu.




0321H  - z pis: reset ©adi‡e pevn‚ho disku
                V˜stupem bajtu 00H na tento port resetujete ©adi‡.
       - ‡ten¡: stavov˜ registr ©adi‡e

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
             ³       ÀÄÄÄ> 1: 1=nastala chyba
             ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=‡¡slo logick‚ jednotky (disk 0 nebo disk 1)

0322H  - z pis: generuje pulzy v˜bˆru ©adi‡e
                Jak˜koliv  v˜stup  na  port  uvol¤uje  ©adi‡. Pou‘ijte p©ed
                povelem.

0323H  - z pis: maskovac¡ registr DMA a p©eru¨en¡

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                     ³ ÀÄ> 0: 1=mo‘n˜ DMA; 0=nepou‘¡vat DMA
                     ÀÄÄÄ> 1: 1=mo‘n‚ p©eru¨en¡ po povelu ©adi‡e (IRQ 5)



    adi‡  pevn‚ho disku po‡¡ta‡e AT je za‡lenˆn do stejn‚ adaptorov‚ desky
jako  ©adi‡  disketov˜ch mechanik. Jeho I/O porty, povely a stavov‚ sign ly
jsou odli¨n‚ od ©adi‡e po‡¡ta‡e XT.


Porty 01F0H - 01F7H: ©adi‡ prvn¡ho pevn‚ho disku po‡¡ta‡e AT
Porty 0170H - 0177H: ©adi‡ druh‚ho pevn‚ho disku po‡¡ta‡e AT
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    adi‡  pevn‚ho  disku  AT  generuje  po  ka‘d‚  operaci  (‡ten¡, z pis,
vystaven¡,  atd.)  p©eru¨en¡  £rovnˆ  14  (IRQ  14). IRQ 14 je nastaveno na
vektor  p©eru¨en¡  INT  76H,  pro kter‚ je ak‡n¡ p©¡znakov˜ bit nastaven na
adrese 0:048EH. V dal¨¡m je uv dˆn popis portu pouze ©adi‡e prvn¡ho pevn‚ho
disku, druh˜ disk se li¨¡ jen adresami port–.

01F0H - datov˜ registr. €ten /zapisovan  data z/do bufferu sektor– ©adi‡e
01F1H - z pis: z pis registru p©edkompenzace
      - ‡ten¡: chybov˜ registr. Obsahuje bity posledn¡ho chybov‚ho stavu

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=adresov  zna‡ka dat nenalezena
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=chyba stopy 0
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=p©eru¨en¡ povelu
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: (v‘dy nastaven na 0)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=nenalezen identifik tor sektoru
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: (v‘dy nastaven na 0)
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=chyba ECC: neopraviteln  chyba dat
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=chybn˜ blok

01F2H  - ‡¡ta‡ sektor– - ‡ten¡/z pis po‡tu sektor– pro proveden¡ operace
01F3H  - ‡¡slo sektoru - ‡ten¡/z pis bˆ‘n‚ho/po‡ te‡n¡ho ‡¡sla log. sektoru
01F4H  - v lec (vy¨¨¡ bajt; bity 0-1 jsou bity 8-9 10-bitov‚ho ‡¡sla v lce)
01F5H  - v lec (ni‘¨¡ bajt; bity 0-7 10-bitov‚ho ‡¡sla v lce)
01F6H  - disk a hlava - ‡ten¡/z pis: bity indikuj¡ hlavu a disk pro operaci

01F7H  - z pis: povelov˜ registr
              1xH = n vrat na v lec 0 (ni‘¨¡ tetr da = rychlost krokov n¡)
              7xH = vystaven¡ na dan˜ v lec (ni‘¨¡ tetr da = rychl. krok.)
              2xH = ‡ten¡ sektoru (ni‘¨¡ tetr da indikuje opakov n¡ a ECC)
              3xH = z pis sektoru (ni‘¨¡ tetr da indikuje opakov n¡ a ECC)
              50H = form tov n¡ stopy
              4xH = ovˆ©ovac¡ ‡ten¡ (ni‘¨¡ tetr da indikuje opakov n¡)
              90H = diagn¢za
              91H = nastaven¡  parametr–  (max.  po‡et  hlav,  sektor–) pro
                    zvolen˜ disk

       - ‡ten¡: stavov˜ registr

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=p©edchoz¡ povel ukon‡en chybou
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: index: n+staven na 1 p©i impulsu indexu
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=opraven  data (nastala chyba, korekce ECC)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=po‘adavek dat (buffer ‡ek  na data)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=vystaven¡ ukon‡eno
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=chyba z pisu
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=disk p©ipraven na vystaven¡ (je-li bit 4=1)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=zanepr zdnˆn (prov d¡ povel)





             ÿ8ÿ.ÿ-  ÿÿaÿdÿiÿ‡  ÿpÿrÿuÿ‘ÿnÿ˜ÿcÿh  ÿdÿiÿsÿkÿ–


    Tento  popis  se  vztahuje k ©adi‡i pru‘n˜ch disk– (FDC), jeho‘ hlavn¡m
prvkem  je  NEC  æPD765 (nebo kompatibiln¡ ‡ip FDC - jako I8272). Hodnoty v
registrech  pro ‡asov n¡ (nap©. rychlost krokov n¡) plat¡ pro hodiny ©adi‡e
8 Mhz.

    adi‡  pru‘n˜ch disk– po‡¡ta‡e AT je um¡stˆn na stejn‚ kartˆ jako ©adi‡
pevn‚ho  disku, av¨ak jinak je kompatibiln¡ se standardn¡m ©adi‡em pru‘n˜ch
disk–  po‡¡ta‡– PC/XT (kromˆ nˆkolika pozn mek uveden˜ch d le). Mezi hlavn¡
rozd¡ly  pat©¡ p©edev¨¡m to, ‘e ©adi‡ pru‘n˜ch disk– po‡¡ta‡e AT je schopen
v¡cen sobn˜ch  rychlost¡  p©enosu  dat, av¨ak obsluhuje pouze dvˆ disketov‚
mechaniky.

    - ©adi‡ pru‘n˜ch disk– 1 dek¢duje porty 03F0H a‘ 03F7H
    - ©adi‡ pru‘n˜ch disk– 2 dek¢duje porty 0370H a‘ 0377H (pouze AT)

    adi‡   pru‘n˜ch   disk–  generuje  po  ka‘d‚  operaci  (‡ten¡,  z pis,
vystaven¡,  rekalibrace,  atd.)  p©eru¨en¡  £rovnˆ  6  (IRQ  6),  kter‚  je
vektorov no na INT 0EH a obsluhov no BIOSem.

mechanika 5 1/4" 1.2 MB: ot ‡ky 360/minutu (tj. 6 za sekundu)
ostatn¡ mechaniky: ot ‡ky 300/minutu (tj. 5 za sekundu)


Porty 03F0H - 03F7H: ©adi‡ pru‘n˜ch disk– 1
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    adi‡  pru‘n˜ch  disk–  2  nen¡  pops n,  jeho  p©ipojen¡ je analogick‚
pou‘it¡  port–  ©adi‡e  1  (zmˆn¡ se pouze hodnoty port– z 03FxH na 037xH a
ozna‡en¡ disketov˜ch mechanik A na C a B na D).

03F2H  - z pis: registr ‡¡slicov‚ho v˜stupu
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: volba mechaniky 0-3 (AT nepou‘¡v  bit 1)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  0=reset ©adi‡e disket; 1=uvolnˆn¡ ©adi‡e
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=mo‘n˜ p©enos DMA disket a p©eru¨en¡
          ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-7: zapnut¡ motor– disketov˜ch mechanik A-D
                                 (AT nepou‘¡v  bity 6-7)

03F4H  - ‡ten¡: hlavn¡ stavov˜ registr MSR
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³R³I³D³B³  DnB  ³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: 1=disket. mech. zanepr zdnˆny (vystavuj¡)
         ³ ³ ³ ³                (AT nepou‘¡v  bity 2-3)
         ³ ³ ³ ³                - pokud je nˆkter˜ bit nastaven, ©adi‡
         ³ ³ ³ ³                  nep©ij¡m  povely pro ‡ten¡/z pis
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=©adi‡ disket zanepr zdnˆn (‡ten¡/z pis)
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=nen¡ m¢d DMA; 0=m¢d DMA aktivn¡
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  smˆr toku dat: 1=FDC do CPU; 0=CPU do FDC
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=dat. registr je p©ipraven ke ‡ten¡/z pisu


03F5H  - ‡ten¡/z pis: registr povel–/dat ©adi‡e FDC
         Tento  port se pou‘¡v  pro v¨echny p©¡kazov‚ operace ©adi‡e. Prvn¡
         - povelov˜ bajt - je v˜stup, potom n sleduj¡ parametry povelu jako
         v˜stup.  Po  proveden¡  operace je 0 nebo nˆkolik vstup– navr ceno
         jako  v˜sledek  operace.  V¨echny  p©enosy  p©es  tento  port mus¡
         n sledovat za sebou ve spr vn‚ posloupnosti.

         N sleduj¡c¡  v˜pis  povel– pou‘¡v  BIOS pro sv‚ standardn¡ funkce,
         av¨ak nejsou zde pops ny parametry n sleduj¡c¡ za p©¡kazem.

         E6H - ‡ten¡ dat (n sleduje 8 parametr–; navr ceno 7 v˜sledk–)
         C5H - z pis dat (n sleduje 8 parametr–; navr ceno 7 v˜sledk–)
         4DH - form tov n¡ stopy (n sleduje 5 param.; navr ceno 7 v˜sledk–)
         07H - rekalibrace (1 parametr; nenavr cen ‘ dn˜ v˜sledek)
         0FH - vystaven¡ na stopu (1 parametr; nenavr cen ‘ dn˜ v˜sledek)


    Stavov˜ registr ST0
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³RES³S³F³R³H³DSn³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: aktivn¡ disketov  mechanika 0-3
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  ‡¡slo aktivn¡ hlavi‡ky (0-1)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=mechanika nen¡ p©ipravena
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=p©ijat chybov˜ sign l FAULT nebo
          ³ ³ ³                    nenalezena stopa 0 p©i rekalibraci
          ³ ³ ³                    (max. 77 stop)
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=vystaven¡ na stopu ukon‡eno
          ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6-7: 00=£spˆ¨n‚ £kon‡en¡ operace
                                 01=p©¡kaz zah jen ale nedokon‡en £spˆ¨nˆ
                                 10=chybn˜ p©¡kaz (operace ani neza‡ala)
                                 11=v pr–bˆhu operace ztr ta sign lu READY

    Stavov˜ registr ST1
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³E³0³C³O³0³S³W³M³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=nelze nal‚zt adresovou zna‡ku
          ³ ³ ³ ³ ³ ³ ³          (mezi 2 indexy)
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=bˆhem z pisu ident.ochrana proti z pisu
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  1=©adi‡ nem–‘e nal‚zt zadan˜ sektor
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  nevyu‘it - v‘dy nastaven na 0
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=p©ete‡en¡ dat - CPU nesta‡¡ odeb¡rat
          ³ ³ ³                    (nap©. ©adi‡ DMA zanepr zdnˆn)
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=chyba p©i ‡ten¡ dat (chyba CRC)
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  nevyu‘it - v‘dy nastaven na 0
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=konec stopy (p©¡stup za posledn¡ sektor)


    Stavov˜ registr ST2
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0³M³E³C³S³S³B³M³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=p©i ‡ten¡ nenalezena adr.zna‡ka v datech
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=‡¡slo stopy nesouhlas¡ - mus¡ b˜t 0ffh
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  1=p©i porovn n¡ dat nenalezen sektor
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=p©i porovn n¡ dat byla data shodn 
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=‡¡slo stopy nesouhlas¡
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=chyba v datov‚m poli sektoru (CRC)
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  1=nalezen˜ sektor ozna‡en jako "smazan˜"
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  nevyu‘it - v‘dy nastaven na 0


    Stavov˜ registr ST3
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³F³W³R³T³D³H³DSn³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: stav sign l– volby jednotky (0-3)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  stav sign lu volby hlavi‡ky (0-1)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=je p©ipojena oboustrann  mechanika
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=nalezena stopa 0
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=disketov  jednotka je p©ipravena
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  1=disketa m  ochranu proti z pisu
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=chybov˜ sign l od disk. jednotky FAULT


    SPECIFY - nastaven¡ vnit©n¡ch ‡asova‡–

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0 0 1 1³ = 03h (povel SPECIFY)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³  SRT  ³  HUT  ³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: ‡as od ukon‡en¡ operace R/W do odklopen¡
          ³ ³ ³ ³                hlavi‡ky v 1/16 ms (16 a‘ 240 ms)
          ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-7: ‡as mezi kroky vystavovac¡ho motorku
                                 v 1 ms (1 ms a‘ 16 ms)
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³      HLT    ³D³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=nen¡ provoz DMA, 0=je provoz DMA
          ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÄÄ> 1-7: ‡as od p©iklopen¡ hlavi‡ky po za‡ tek R/W
                                 operace po 2 ms (2 a‘ 254 ms)

    RECALIBRATE - vystaven¡ na stopu 0 (uveden¡ hlavi‡ek na zn mou pozici)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0 1 1 1³ = 07h (povel RECALIBRATE)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0 0³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÂÁÂÙ  bit
                      ÀÄÁÄ> 0-1: ‡¡slo mechaniky pro proveden¡ rekalibrace


    SEEK - vystaven¡ hlavi‡ek na zadanou stopu (motor mus¡ b˜t zapnut)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 1 1 1 1³ = 0fh (povel SEEK)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: ‡¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  v˜bˆr hlavi‡ky (0-1)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³      NCN      ³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄ> 0-7: ‡¡slo po‘adovan‚ stopy


    READ ID - ‡ten¡ prvn¡ho identifika‡n¡ho pole ze stopy
              (umo‘¤uje zji¨tˆn¡ ‡¡sla stopy z diskety)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0³M³0 0 1 0 1 0³ = 4ah (povel READ ID)
         ÀÄÁÂÁÄÁÄÁÄÁÄÁÄÁÄÙ
            ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 0=k¢dov n¡ FM (nepou‘¡v  se), 1=k¢dov n¡ MFM

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: ‡¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  v˜bˆr hlavi‡ky (0-1)

    Po proveden¡ operace (‡ten¡ identifika‡n¡ho pole) se ‡te 7 bajt–:
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³RES³S³F³R³H³DSn³   stavov˜ registr ST0
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³E³0³C³O³0³S³W³M³   stavov˜ registr ST1
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0³M³E³C³S³S³B³M³   stavov˜ registr ST2
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     stopa     ³   stopa
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     hlava     ³   hlava (strana)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     sektor    ³   sektor
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     d‚lka     ³   d‚lka sektoru (0=128 B, 1=256 B, ...)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ


    READ DATA - ‡ten¡ dat zadan‚ho sektoru z nastaven‚ stopy

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³T³M³S³0 0 1 1 0³ = 0E6h (povel READ DATA)
         ÀÂÁÂÁÂÁÄÁÄÁÄÁÄÁÄÙ
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 1=p©esko‡¡ se vymazan˜ sektor, 0=nastav¡ se
          ³ ³                    bit6 registru ST2 a ukon‡¡ se operace
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 0=k¢dov n¡ FM (nepou‘¡v  se), 1=k¢dov n¡ MFM
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 1=operace se provede i na stranˆ 1 diskety

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: ‡¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  v˜bˆr hlavi‡ky (0-1)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     stopa     ³   stopa
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     hlava     ³   hlava (strana)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     sektor    ³   sektor
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     d‚lka     ³   d‚lka sektoru (0=128 B, 1=256 B, ...)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³  konec stopy  ³   ‡¡slo posledn¡ho sektoru na stopˆ
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³ mezisekt. mez.³   mezisektorov  mezera
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³ altern. d‚lka ³   po‡et ‡ten˜ch bajt–, je-li zadan  d‚lka = 0
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ   (je-li d‚lka zadan , m–‘e b˜t = 0ffh)

    Po  p©e‡ten¡  ka‘d‚ho  sektoru  je  ‡¡slo  sektoru v ©adi‡i automaticky
inkrementov no  a  ©adi‡  ‡te  n sleduj¡c¡  sektor.  P©¡kaz  mus¡ b˜t proto
ukon‡en sign lem TC. adi‡ p©estane vys¡lat data do CPU av¨ak operaci ‡ten¡
dokon‡¡ a zkontroluje CRC.

    Po proveden¡ operace ‡ten¡ dat se na‡te 7 bajt– jako u povelu READ ID.


    WRITE DATA - z pis dat do zadan‚ho sektoru na nastaven‚ stopˆ

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³T³M³S³0 0 1 0 1³ = 0C5h (povel WRITE DATA)
         ÀÂÁÂÁÂÁÄÁÄÁÄÁÄÁÄÙ
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 1=p©esko‡¡ se vymazan˜ sektor
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 0=k¢dov n¡ FM (nepou‘¡v  se), 1=k¢dov n¡ MFM
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 1=operace se provede na obou stran ch diskety

    Ostatn¡ postup je stejn˜ jako u povelu READ DATA.

    Mezisektorov‚ mezery:
ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º k¢dov n¡ ³ sektor ³        disketa 8"       ³      disketa 5 1/4"      º
º          ³        ³  ‡ten¡/z pis ³  form t. ³  ‡ten¡/z pis ³  form t.  º
ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍ¹
º          ³  128 B ³      7       ³   1Bh    ³      7       ³     9     º
º          ³  256 B ³     0Eh      ³   2Ah    ³     18h      ³    30h    º
º    FM    ³  512 B ³     1Bh      ³   3Ah    ³     46h      ³    87h    º
º          ³ 1024 B ³     47h      ³   8Ah    ³     C8h      ³    FFh    º
ÇÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄ¶
º          ³  256 B ³     0Eh      ³   36h    ³     0Ah      ³    0Ch    º
º   MFM    ³  512 B ³     1Bh      ³   54h    ³     2Ah      ³    50h    º
º          ³ 1024 B ³     66h      ³   74h    ³     80h      ³    F0h    º
ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍ¼


    FORMAT TRACK - form tov n¡ stopy

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0³M³0³0 1 1 0 1³ = 4dh (povel FORMAT TRACK)
         ÀÄÁÂÁÄÁÄÁÄÁÄÁÄÁÄÙ
            ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 0=k¢dov n¡ FM (nepou‘¡v  se), 1=k¢dov n¡ MFM
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: ‡¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  v˜bˆr hlavi‡ky (0-1)
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³ d‚lka sektoru ³   © d d‚lky sektoru (0=128, 1=256,...)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³ po‡et sektor– ³   po‡et sektor– na stopˆ
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³mezisekt.mezera³   d‚lka mezisektorov‚ mezery
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³  datov˜ vzor  ³   datov˜ vzor (inicializa‡n¡ bajt dat - 0E5h)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ


    Informace   k  z pisu  do  identifika‡n¡ho  pole  sektoru  je  dod v na
procesorem  bˆhem  form tov n¡ pro ka‘d˜ sektor zvl ¨Ÿ. Pro ka‘d˜ sektor je
nutno vyslat 4 bajty:
                        - ‡¡slo stopy
                        - ‡¡slo hlavy (strany)
                        - ‡¡slo sektoru
                        - d‚lka sektoru

    Je  mo‘n‚  naform tovat  disketu s libovoln˜m po©ad¡m sektor– ("SKEW"),
‡¡m‘ je mo‘n‚ zkr tit p©¡stupovou dobu na disketu.

    Form tov n¡   se  ukon‡¡  druh˜m  p©¡chodem  indexu,  sign lem  "FAULT"
(otev©en¡ dv¡©ek) nebo sign lem "READY".

    Po ukon‡en¡ form tov n¡ je navr ceno 7 bajt– jako u povelu READ ID.


    SENSE INTERRUPT STATUS - poskytnut¡ stavov˜ch informac¡
                       (pou‘¡v  se t‚‘ ke kontrole vystaven¡ na pozici)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 1 0 0 0³ = 8 (povel SENSE INTERRUPT STATUS)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ

    Povel navr t¡ 2 informa‡n¡ bajty:

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³RES³S³F³R³H³DSn³   stavov˜ registr ST0 (k ur‡en¡ smˆru INT)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     stopa     ³   aktu ln¡ pozice hlavi‡ky
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ



    Pokud  byl  zad n  neplatn˜  povel,  nastav¡  se bity D6 a D7 v hlavn¡m
stavov‚m  registru na 1 a indikuj¡, ‘e je ve stavov‚m registru p©ipraven ke
‡ten¡ stavov˜ registr ST0 obsahuj¡c¡ bajt 80h (= neplatn˜ p©¡kaz).

    Po  ukon‡en¡  operac¡ SEEK (vystaven¡) a RECALIBRATE (rekalibrace) mus¡
b˜t  vysl n  p©¡kaz  SENSE  INTERRUPT STATUS, jinak ka‘d˜ dal¨¡ p©¡kaz bude
pova‘ov n za neplatn˜ p©¡kaz.

    SENSE DRIVE STATUS - poskytnut¡ informac¡ o mechanice

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0 1 0 0³ = 4 (povel SENSE DRIVE STATUS)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: ‡¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  v˜bˆr hlavi‡ky (0-1)

    Povel navr t¡ jeden bajt - stavov˜ registr ST3:
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³F³W³R³T³D³H³DSn³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: stav sign l– volby jednotky (0-3)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  stav sign lu volby hlavi‡ky (0-1)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=je p©ipojena oboustrann  mechanika
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=nalezena stopa 0
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=disketov  jednotka je p©ipravena
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  1=disketa m  ochranu proti z pisu
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=chybov˜ sign l od disk. jednotky FAULT


    INVALID - pr zdn˜ povel

    V¨echny  ostatn¡ p©¡kazy jsou pou‘¡v ny jako neplatn‚. adi‡ po p©ijet¡
neplatn‚ho  povelu  ukon‡¡ prov dˆnou operaci (negeneruje INT) a p©iprav¡ k
navr cen¡  registr  ST0  obsahuj¡c¡  bajt 80h indikuj¡c¡ p©ijet¡ neplatn‚ho
p©¡kazu.


03F6H  - z pis (AT): registr pevn‚ho disku
03F7H  - z pis (AT): disketov˜ ©¡d¡c¡ registr
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: rychlost p©enosu dat:     00=500 Kb/s;
          ³ ³ ³ ³ ³ ³            01=300 Kb/s; 10=250 Kb/s; 11=rezervov no
          ÀÄÁÄÁÄÁÄÁÄÁÄÄÄÄÄ> 2-7:

         ‡ten¡: registr ‡¡slicov‚ho vstupu - pou‘¡v  se pro diagnostiku
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=v˜bˆr mechaniky 0
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=v˜bˆr mechaniky 1
          ³ ³ ÀÄÁÄÁÄÁÄÄÄÄÄ> 2-5: v˜bˆr hlav 0-3 (bit 2 = hlava 0 atd.)
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  1=z pisov‚ hradlo
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=sign l v˜mˆny diskety je ve stavu ON



Struktura sektoru diskety:
-------------------------
Z hlav¡ - identifik tor sektoru (13 bajt–):
  (6) synchroniza‡n¡ bajty 00h
  (1) adresov  zna‡ka identifika‡n¡ho pole
  (1) ‡¡slo v lce (0...)
  (1) ‡¡slo strany (0...)
  (1) ‡¡slo sektoru (1...)
  (1) d‚lka sektoru (0=128, 1=256, 2=512, 3=1024, ...)
  (2) kontroln¡ sou‡et z hlav¡ (polo‘ky "‡¡slo v lce" a‘ "d‚lka sektoru")

Oddˆlovac¡ mezera (11 bajt–):
  (11) identifika‡n¡ oddˆlovac¡ mezera bajty 0FFh

Datov˜ blok (9+X bajt–):
  (6) synchroniza‡n¡ bajty 00h
  (1) adresov  zna‡ka datov‚ho pole
      (pokud je na tomto m¡stˆ nalezena adresov  zna‡ka zru¨en˜ch dat, jsou
       data tohoto sektoru ignorov na a ©adi‡ ‡te n sleduj¡c¡ sektor)
  (X) vlastn¡ data
  (2) kontroln¡ sou‡et dat

Datov  mezera (27 bajt–):
  (27) oddˆlovac¡ mezera mezi sektory


Adresov‚ zna‡ky slou‘¡ k identifikaci po‡ tku identifika‡n¡ho nebo datov‚ho
pole.  Od  ostatn¡ch  dat  je  lze  rozli¨it  pomoc¡ chybˆj¡c¡ch hodinov˜ch
impuls–. Pou‘¡vaj¡ se celkem ‡ty©i r–zn‚ adresov‚ zna‡ky:
    - indexov   adresov   zna‡ka  uvnit©  indexov‚  mezery  (tj.  mezera na
      po‡ tku stopy)
    - adresov  zna‡ka identifika‡n¡ho pole
    - adresov  zna‡ka datov‚ho pole
    - adresov  zna‡ka zru¨en˜ch dat (na za‡ tku pole zru¨en˜ch dat)
                    ³ C     C     C     C     C     C     C     C
                    ³ ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿
         HODINY     ³ ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³
                   ÄÅÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄ
                    ³    1     1     0     0     0     0     1     0
         DATA       ³ ÚÄÄÄÄÄÄÄÄÄÄÄ¿                       ÚÄÄÄÄÄ¿
      (bajt C2h)    ³ ³           ³                       ³     ³
                   ÄÅÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄ
                    ³ C  1  C  1  C  0  C  0  C  0  C  0  C  1  C  0
       FM modulace  ³ ³  ³  ³  ³  ³     ³     ³     ³     ³  ³  ³
                    ³ ³  ³  ³  ³  ³     ³     ³     ³     ³  ³  ³
                   ÄÅÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÁÄÄÁÄÄÄÄÄÄÄ
                    ³ C  1  C  1  C  0  C  0  C  0  C  0  C  1  C  0
      MFM modulace  ³    ³     ³        ³     ³     ³        ³
                    ³    ³     ³        ³     ³     ³        ³
                   ÄÁÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ

    U  modulace MFM se nahr vaj¡ hodinov‚ pulsy jen tam, kde by byla dlouh 
mezera  mezi impulsy - mezi dva nulov‚ datov‚ bity se vkl d  jeden hodinov£
puls.


               ÿ9ÿ.ÿ-  ÿGÿrÿaÿfÿiÿcÿkÿ   ÿkÿaÿrÿtÿa  ÿCÿGÿA


Porty 03D0H - 03DFH: port grafick‚ karty CGA
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    CGA  je barevn˜ grafick˜ adapt‚r (Color/Graphics Adapter CGA). Grafick 
karta  CGA  je  vystavˆna  kolem  integrovan‚ho grafick‚ho ©adi‡e Motorolla
6845 (CRT controller chip).

    CGA dek¢duje porty 03D0H a‘ 03DFH (aktu lnˆ pou‘¡v  03D2H a‘ 03DCH)

    Pozn.: Tyto   porty  jsou  pro  zv˜¨en¡  kompatibility  p©ekryty  porty
           grafick‚  karty  EGA.  Kromˆ nˆkolika vyj¡mek jsou informace CGA
           aplikov ny i na EGA.

           Podle  star¨¡ch  p©¡ru‡ek  k  CGA  by  mˆla  karta CGA generovat
           hardwarov‚  p©eru¨en¡  IRQ  2  p©i vertik ln¡m zatem¤ovac¡m bˆhu
           paprsku obrazovky. Tuto mo‘nost v¨ak CGA nikdy nemˆla.

           BIOS  ukl d   obraz  hodnot  port–  pro  ovl d n¡  karty  CGA do
           datov‚ho  prostoru  BIOS.  Pokud  chcete zmˆnit jeden bit portu,
           p©e‡tˆte  hodnotu  portu  na t‚to adrese, nastavte bit, proveƒte
           instrukci OUT a ulo‘te novou hodnotu zpˆt do promˆnn‚.

03D4H  - z pis: v˜bˆr   ©¡d¡c¡ho   registru  CRT.  Pou‘ijte  tento  port  k
                nastaven¡  nˆkter‚ho  z  18  registr–  ©adi‡e CRT. Proveƒte
                instrukci   v˜stupu  ‡¡sla  registru  na  port  03D4H  (OUT
                03D4H,AL)  n sledovanou  ‡ten¡m  dat nebo z pis dat na port
                03D5H.

03D5H  - ©¡d¡c¡  registr  ©adi‡e CRT. Po v˜bˆru registru pomoc¡ portu 03D4H
         lze  p©es  tento  port  ‡¡st  nebo  p©es  nˆj  zapisovat  data  do
         nastaven‚ho vnit©n¡ho registru ©adi‡e CRT.

       - z pis: v˜znam registr– ©adi‡e displeje CRT je n sleduj¡c¡:
ÉÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º reg.³                        v˜znam                                     º
ÌÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 00H ³ celkov  d‚lka horizont ln¡ synchronizace ve znakov˜ch taktech     º
º 01H ³ po‡et zobrazen˜ch znak– na © dek                                  º
º 02H ³ horizont ln¡ synchroniz. pozice (vyst©edˆn¡ obrazu vodorovnˆ)     º
º 03H ³ ¨¡©ka vertik. a horizont. synchron. puls– (ka‘d˜ 4 bity)          º
º 04H ³ celkov˜ po‡et vertik ln¡ch © dk– znak–                            º
º 05H ³ vertik ln¡ p©izp–soben¡ (sn¡mkov n¡ 50 nebo 60 Hz)                º
º 06H ³ po‡et zobrazen˜ch vertik ln¡ch © dk– znak–                        º
º 07H ³ vertik ln¡ synchroniza‡n¡ pozice (vyst©edˆn¡ obrazu svisle)       º
º 08H ³ m¢d prokl d n¡ (bity 4 a 5) a zpˆtn‚ho bˆhu (bity 6 a 7)          º
º 09H ³ adresa maxim ln¡ pomocn‚ linky (po‡et linek na znak)              º
º 0AH ³ po‡ te‡n¡ linka kurzoru                                           º
º 0BH ³ kone‡n  linka kurzoru                                             º
º 0CH ³ po‡ te‡n¡ adresa videopamˆti-za‡ tek zobraz. str nky (vy¨¨¡ bajt) º
º 0DH ³               -  "  -   (ni‘¨¡ bajt)                              º
º 0EH ³ adresa kurzoru (vy¨¨¡ bajt)                                       º
º 0FH ³ adresa kurzoru (ni‘¨¡ bajt)                                       º
º 10H ³ adresa svˆteln‚ho pera (vy¨¨¡ bajt)                               º
º 11H ³ adresa svˆteln‚ho pera (ni‘¨¡ bajt)                               º
ÈÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

       - ‡ten¡: Registry 0CH a‘ 11H lze ‡¡st.







03D6H  - z pis: registr volby m¢du (Pozn.:BIOS ukl d  nastavenou hodnotu na
                adresu 0:0465H)
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
             ³ ³ ³ ³ ³ ÀÄ> 0: ¨¡©ka (textov‚ m¢dy): 0=40 znak–; 1=80 znak–
             ³ ³ ³ ³ ÀÄÄÄ> 1: 1=mo‘n˜ grafick˜ m¢d; 0=textov˜ m¢d
             ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=z kaz Color Burst pro slo‘kov˜ monitor
             ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=mo‘n˜ videosign l; 0=z kaz slo‘ek (‡ern )
             ³ ÀÄÄÄÄÄÄÄÄÄ> 4: bodov‚ rozli¨en¡: 0=320 bod–/2 bity; 1=640/1
             ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=mo‘n‚ blik n¡ textu; 0=intenzita pozad¡

03D8H  - z pis: registr volby barev
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
             ³ ³ ÀÄÄÄÄÄÄÄ> 0-3: barva: text.m¢d - okol¡; graf.m¢d - pozad¡
             ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  intenzita: tex.m¢d - pozad¡; graf. - body
             ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  modr : v˜bˆr graf. palet  (1 p©id  modrou)

03DAH  - ‡ten¡: stavov˜ registr
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ÀÄ> 0: zpˆtn˜ bˆh: 1=displej ve zpˆtn‚m bˆhu
                 ³ ³ ÀÄÄÄ> 1: 1=svˆteln‚ pero je aktivov no
                 ³ ÀÄÄÄÄÄ> 2: 1=sp¡na‡ svˆteln‚ho pera je otev©en
                 ÀÄÄÄÄÄÄÄ> 3: 1=prob¡h  vertik ln¡ synch. puls.
         Pozn.: Z pis  dat bˆhem vertik ln¡ho synchroniza‡n¡ho pulsu (bit 3
                nastaven na 1) nezp–sob¡ "snˆ‘en¡" obrazu.

03DBH  - ‡ten¡/z pis: libovoln˜ v˜stup vyma‘e registr svˆteln‚ho pera
03DCH  - ‡ten¡/z pis: libovoln˜ v˜stup nastav¡ registr svˆteln‚ho pera






      ÿ1ÿ0ÿ.ÿ-  ÿGÿrÿaÿfÿiÿcÿkÿ   ÿkÿaÿrÿtÿa  ÿEÿGÿA  ÿ(ÿa  ÿMÿDÿAÿ)

    Grafick   karta  EGA  (Enhanced  Graphics  Adapter)  je  kompatibiln¡ s
kartami  CGA  (Color/Graphics  Adapter) a MDA (Monochrome Display Adapter),
av¨ak m  mnoho dal¨¡ho vybaven¡, kter‚ ji p©edur‡uje k pou‘it¡ v nej¨ir¨¡ch
aplikac¡ch.

    Mezi jej¡ p©ednosti pat©¡:

    - vy¨¨¡ rozli¨itelnost v textov˜ch i grafick˜ch re‘imech
    - grafick‚ m¢dy na monochromn¡m monitoru
    - softwarovˆ definovateln‚ fonty znak– v textov˜ch m¢dech
    - spole‡n‚ zobrazen¡ v¡ce font– najednou
    - 64 barev v textov˜ch nebo grafick˜ch m¢dech
    - jemn‚ rolov n¡ obrazu (bodov‚ rolov n¡)
    - hardwarovˆ ©¡zeno rozdˆlen¡ obrazovky
    - do videopamˆti je mo‘n‚ zapisovat bez nebezpe‡¡ "snˆ‘en¡" obrazu

    EGA dek¢duje porty ve dvou oblastech:

    EGA #1 dek¢duje porty 03C0H a‘ 03DFH (kv–li slu‡itelnosti s kartou CGA)
    EGA #2 dek¢duje porty 02C0H a‘ 02DFH (druh  karta EGA v syst‚mu)

    Pro slu‡itelnost s graf. kartou MDA dek¢duje EGA porty 03B0H - 03BFH


    EGA  generuje  na za‡ tku vertik ln¡ho zpˆtn‚ho bˆhu p©eru¨en¡ £rovnˆ 2
(IRQ  2),  kter‚  m   nastaven vektor p©eru¨en¡ INT 0AH. P©i pou‘it¡ tohoto
p©eru¨en¡  mˆjte  na mysli, ‘e AT pou‘¡v  IRQ 2 jako kask dn¡ po‘adavek pro
celou t©¡du p©eru¨en¡ (IRQ 8-15).

Pozn.: BIOS  ukl d   obraz  hodnot  nastaven¡  registr– ©adi‡e CRT a jin˜ch
       informac¡ EGA do datov‚ho prostoru EGA. Pokud chcete zmˆnit nˆkterou
       hodnotu  nastavenou  na  portu,  p©e‡tˆte hodnotu ulo‘enou v tabulce
       promˆnn˜ch karty EGA, nastavte bit, proveƒte v˜stup na port a ulo‘te
       do promˆnn‚ novou hodnotu.







Porty 03B0H - 03BFH: port grafick‚ karty MDA
Porty 03C0H - 03DFH: port grafick‚ karty EGA #1
Porty 02C0H - 02DFH: port grafick‚ karty EGA #2
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

03C0H  - z pis: port adresy a dat ©adi‡e (ATC)
              proveƒte IN  al,03DAH            ; nastaven¡ m¢du adresy ATC
                       OUT 3C0H,‡¡slo_registru ; volba registru ATC
                       OUT 3C0H,hodnota        ; ulo‘en¡ hodnoty do reg.
              pozn.: bity 0-4: nastaven¡ registru ATC
                     bit 5: 1=mo‘n‚ zobrazen¡; 0=nastaven¡ registru

         Po v˜bˆru registru proveƒte v˜stup dat na port 03C0H:

    reg.00H-0FH    registry palet: nastaven¡ barev podle atribut–
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                   ³ ³ ³ ³ ³ ÀÄ> 0: R ‡erven  (intenzita 2/3)
                   ³ ³ ³ ³ ÀÄÄÄ> 1: G zelen   (intenzita 2/3)
                   ³ ³ ³ ÀÄÄÄÄÄ> 2: B modr    (intenzita 2/3)
                   ³ ³ ÀÄÄÄÄÄÄÄ> 3: b modr '  (intenzita 1/3)
                   ³ ÀÄÄÄÄÄÄÄÄÄ> 4: g zelen ' (intenzita 1/3)
                   ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: ‡erven '  (intenzita 1/3)
               bit 3 slou‘¡ t‚‘ pro emulaci podtr‘en¡ MDA
               bit 4 slou‘¡ t‚‘ pro emulaci intenzity CGA

    reg.10H   ©¡zen¡ m¢du
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                       ³ ³ ³ ÀÄ> 0: 1=grafick˜ m¢d; 0=textov˜ m¢d
                       ³ ³ ÀÄÄÄ> 1: 1=atributy MDA; 0=barevn‚ atributy
                       ³ ÀÄÄÄÄÄ> 2: 1=9.bod je 8.bod pro znaky
                       ³            0=9.bod znak– jako barva pozad¡
                       ÀÄÄÄÄÄÄÄ> 3: 1=blik n¡ textu; 0=4-bitov‚ pozad¡

    reg.11H   nastaven¡ barvy okol¡ (podobnˆ jako registr palet)

    reg.12H   mo‘n‚ roviny barev
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
                   ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: uvolnˆn¡ rovin 0-3
                   ÀÄÁÄÄÄÄÄÄÄÄÄ> 4-5: videostatut multiplexu
                                      00=R&B; 01=b&G, 10=r&g, 11=nepou‘it

    reg.13H   posuv horizont ln¡ch bod–
              Po‡et bod–, o kter‚ jsou data rotov na vlevo. Plat¡ bity 0-3.

03C2H  - z pis: r–zn‚ ©¡d¡c¡ funkce
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=volba 3BxH (MDA); 0=volba 3DxH (CGA)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=mo‘n  RAM; 0=blokov n¡ RAM
         ³ ³ ³ ³ ÀÄÁÄÄÄÄÄ> 2-3: takt bod–:00=14MHZ;01=16MHz;10=ext.;11=rez.
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=roz¨i©uj¡c¡ v˜stup; 0=internˆ
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  str nkov˜ bit pro lich˜/sud˜ m¢d
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  polarita hor.zpˆt.bˆhu: 1=negat.; 0=pozit.
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  polarita vert.zpˆt.bˆhu: 1=negat.; 0=pozit.

03C4H  - z pis: registr adresy n slednosti
03C5H  - z pis: registr dat n slednosti
              proveƒte OUT 03C4H,‡¡slo_registru; potom OUT 03C5H,data

    reg.00H   reset n slednosti (bity 0-1 indikuj¡ asynchr./synchr.reset)
    reg.01H   m¢d taktov n¡
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                       ³ ³ ³ ÀÄ> 0: 1=8 bod– na znak; 0=9 bod– na znak
                       ³ ³ ÀÄÄÄ> 1: ¨¡©ka linky displeje 1=n¡zk ; 0=¨irok 
                       ³ ÀÄÄÄÄÄ> 2: 1=mˆnit ka‘d˜ znak; 0=ka‘d˜ druh˜ znak
                       ÀÄÄÄÄÄÄÄ> 3: takt bod–: 1=p–len˜; 0=norm ln¡

    reg.02H   maskovac¡ mapa: bity 0-3 umo‘¤uj¡ z pis do bit– rovin 0-3
    reg.03H   volba mapy znak–:
                   bity 0-1 vol¡ mapu B (atributov˜ bit 3=0)
                   bity 2-3 vol¡ mapu A (atribotuv˜ bit 3=1)

    reg.04H   m¢d pamˆti:
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                         ³ ³ ÀÄ> 0: 1=textov˜ gener tor znak–; 0=grafick˜
                         ³ ÀÄÄÄ> 1: 1=EGA RAM > 64K; 0=64K
                         ÀÄÄÄÄÄ> 2: 1=sekven‡n¡; 0=lich /sud  (jako v CGA)

03CAH  - z pis: grafick  pozice 2 (pro EGA mus¡ b˜t 0)
03CCH  - z pis: grafick  pozice 1 (pro EGA mus¡ b˜t 1)

03CEH  - z pis: grafick˜ adresov˜ registr 1 a 2
03CFH  - z pis: registr dat ©adi‡e grafiky
              proveƒte OUT 03CEH,‡¡slo_registru; potom OUT 03CFH,data

    reg.00H   nastaven¡/resetov n¡. Bity 0-3 vol¡ roviny z pisov‚ho m¢du 00
    reg.01H   mo‘n‚ nastaven¡/resetov n¡
    reg.02H   porovn n¡ barev. Bity 0-3 vol¡ barvy pro ‡tec¡ m¢d 01H
    reg.03H   rotace dat a volba funkce pro z pisov˜ m¢d 00H
              bity 0-2: nastaven¡ po‡tu rotac¡ pro z pisov˜ m¢d 00H
              bity 3-4: volba funkce pro z pisov‚ m¢dy 00H a 02H
                        00=beze zmˆny; 01=AND; 10=OR; 11=XOR
    reg.04H   volba ‡tec¡ mapy. Bity 0-2 vol¡ ‡¡slo mapy pro ‡tec¡ m¢d 00H
    reg.05H   registr m¢du
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
                   ³ ³ ³ ³ ÀÄÁÄ> 0-1: z pisov˜ m¢d 0-2
                   ³ ³ ³ ÀÄÄÄÄÄ>  2:  podm¡nky testu
                   ³ ³ ÀÄÄÄÄÄÄÄ>  3:  m¢d ‡ten¡: 1=porovn. barev, 0=ur‡en‚
                   ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=pou‘¡t lich‚/sud‚ adresov n¡ RAM
                   ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=pou‘¡t rozli¨en¡ CGA (2 bity/bod)
    reg.06H   r–zn‚ grafick‚ ©¡d¡c¡ p©¡kazy
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
                       ³ ³ ³ ÀÄ>  0:  1=grafika; 0=mo‘n˜ text. gener. znak–
                       ³ ³ ÀÄÄÄ>  1:  1=zmˆna lich‚ mapy po sud‚
                       ÀÄÁÄÄÄÄÄ> 2-3: mapov n¡ pamˆti pro CPU
                                      00=A000H (128K);   01=A000H (64K)
                                      10=B000H (32K MDA);11=B800H (32K CGA)
    reg.07H   z kaz maskov n¡ barev
              bity 0-3 vyj¡maj¡ roviny z porovn v. logiky ve ‡tec¡m m¢du 01
    reg.08H   bitov   mask.  Bity  0-7  vol¡ bity, kter‚ budou maskov ny ve
              v¨ech rovin ch.

03B4H nebo 03D4H  - z pis: v˜bˆr ©¡d¡c¡ho registru CRT. Pou‘ijte tento port
                           k  nastaven¡ nˆkter‚ho z 18 registr– ©adi‡e CRT.
                           Proveƒte  instrukci  v˜stupu  ‡¡sla  registru na
                           port    03B4H    nebo   03D4H   (OUT   03B4H,AL)
                           n sledovanou  ‡ten¡m  dat nebo z pis dat na port
                           03B5H nebo 03D5H.

03B5H nebo 03D5H  - ©¡d¡c¡  registr  ©adi‡e  CRT. Po v˜bˆru registru pomoc¡
                    portu  03B4H  nebo  03D4H lze p©es tento port ‡¡st nebo
                    p©es   nˆj  zapisovat  data  do  nastaven‚ho  vnit©n¡ho
                    registru ©adi‡e CRT.

    Pozn.: Bit  0 portu 03C0H nastavuje, kter˜ p r adres port– bude pou‘it.
           (norm lnˆ je pro MDA adresa 03BxH a pro CGA adresa 03DxH).




















       - z pis: v˜znam registr– ©adi‡e displeje CRT je n sleduj¡c¡:
ÉÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º reg.³                        v˜znam                                     º
ÌÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 00H ³ celkov  d‚lka horizont ln¡ synchronizace ve znakov˜ch taktech     º
º 01H ³ po‡et zobrazen˜ch znak– na © dek                                  º
º 02H ³ po‡ tek horizont ln¡ho zatemnˆn¡ (po‡et znak–)                    º
º 03H ³ konec horizont ln¡ho zatemnˆn¡ (bity 0-4:jsou ¨¡©ka zatemnˆn¡;    º
º     ³                                 bity 5-6:mo‘n˜ posuv 0 a‘ 3)      º
º 04H ³ po‡ tek horizont ln¡ho zpˆtn‚ho bˆhu (znakov  pozice)             º
º 05H ³ konec horizont ln¡ho zpˆtn‚ho bˆhu (bity 0-4:¨¡©ka horizont ln¡ho º
º     ³    zpˆtn‚ho bˆhu; bity 5-6:prodleva zpˆtn‚ho bˆhu 0-3 znakov˜ch   º
º     ³    takt–; bit 7: 1=po‡ te‡n¡ plocha na lich‚ adrese; 0=sud‚       º
º 06H ³ po‡et zobrazen˜ch vertik ln¡ch linek celkem                       º
º 07H ³ bit 8 pro jist‚ registry CRT (jejich‘ adresy se ud vaj¡ 9-bitovˆ):º
º     ³       ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿                                           º
º     ³       ³7 6 5 4 3 2 1 0³                                           º
º     ³       ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit                                       º
º     ³            ³ ³ ³ ³ ³ ÀÄ> 0: vertik ln¡ch linek celkem (CRTC reg.6)º
º     ³            ³ ³ ³ ³ ÀÄÄÄ> 1: konec vertik l. zobraz. (CRTC reg.12H)º
º     ³            ³ ³ ³ ÀÄÄÄÄÄ> 2: za‡ t. vertik. zpˆtn‚ho bˆhu (reg.10H)º
º     ³            ³ ³ ÀÄÄÄÄÄÄÄ> 3: za‡ tek vertik. zatemnˆn¡ (reg. 15H)  º
º     ³            ³ ÀÄÄÄÄÄÄÄÄÄ> 4: porovn n¡ © dky (reg.18H)             º
º     ³            ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: pozice kurzoru (reg.0AH)              º
º 08H ³ p©ednastaven¡ prvn¡ linky © dku po vertik ln¡m zpˆtn‚m bˆhu       º
º 09H ³ adresa maxim ln¡ pomocn‚ linky (po‡et linek na znak)              º
º 0AH ³ po‡ te‡n¡ linka kurzoru                                           º
º 0BH ³ kone‡n  linka kurzoru                                             º
º 0CH ³ po‡ te‡n¡ adresa videopamˆti-za‡ tek zobraz. str nky (vy¨¨¡ bajt) º
º 0DH ³               -  "  -   (ni‘¨¡ bajt)                              º
º 0EH ³ adresa kurzoru (vy¨¨¡ bajt)                                       º
º 0FH ³ adresa kurzoru (ni‘¨¡ bajt)                                       º
º 10H ³ z pis:za‡ tek vertik ln¡ho zpˆtn‚ho bˆhu                          º
º 11H ³ z pis:konec vertik ln¡ho zpˆtn‚ho bˆhu (bity 0-3: ¨¡©ka zpˆtn‚ho  º
º     ³       bˆhu v link ch; bit 4: 0=nulov n¡ vertik.p©eru¨en¡;         º
º     ³       bit 5: 0=mo‘n‚ vertik ln¡ p©eru¨en¡ IRQ 2                   º
º 12H ³ konec zobrazen¡ ve vertik ln¡m smˆru (linka)                      º
º 13H ³ vyst©edˆn¡ obrazu ve vertik ln¡m zmˆru                            º
º 14H ³ poloha podtr‘en¡ (bity 0-5 jsou ‡¡sla linek)                      º
º 15H ³ za‡ tek vertik ln¡ho zatemnˆn¡ (linek)                            º
º 16H ³ konec vertik ln¡ho zatemnˆn¡ (linek)                              º
º 17H ³ ©¡zen¡ m¢du                                                       º
º     ³       ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿                                           º
º     ³       ³7 6 5 4 3 2 1 0³                                           º
º     ³       ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit                                       º
º     ³        ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 0=m¢d kompatibiln¡ s graf. adres. CGA º
º     ³        ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: volba ‡¡ta‡e pomocn˜ch © dk–          º
º     ³        ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: horiz.zpˆtn˜ bˆh: 1=dvojit˜ vert.zp.b.º
º     ³        ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=pou‘¡t znakov‚ hodiny/2 pro refresh º
º     ³        ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=nucen  vysok  impedance v˜stupu     º
º     ³        ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: m¢d p©ep¡n n¡ adres                   º
º     ³        ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=bajtov˜ adresov˜ m¢d; 0=slovn¡ adr. º
º     ³        ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 0=hardwarov˜ reset; 1=norm ln¡ operaceº
º 18H ³ porovn n¡ linek - pou‘¡v  se pro operace s rozdˆlenou obrazovkou  º
ÈÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

03BAH nebo 03DAH - z pis: bity 0-1 ©¡d¡ dopl¤uj¡c¡ ©¡d¡c¡ v˜stupy FC0 a FC1
                 - ‡ten¡: stavov˜ registr (jako MDA-03BAH nebo CGA-03DAH)

    Pozn.: Bit  0  portu  03C0H nastavuje, kter  adresa portu bude pou‘ita.
           (norm lnˆ je pro MDA adresa 03BxH a pro CGA adresa 03DxH).

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ÀÄ> 0: zpˆtn˜ bˆh: 1=displej ve zpˆtn‚m bˆhu
                 ³ ³ ÀÄÄÄ> 1: 1=svˆteln‚ pero je aktivov no
                 ³ ÀÄÄÄÄÄ> 2: 1=sp¡na‡ svˆteln‚ho pera je otev©en
                 ÀÄÄÄÄÄÄÄ> 3: 1=prob¡h  vertik ln¡ synch. puls.
         Pozn.: U  karty  EGA nen¡ pot©eba prov dˆt synchronizaci z pisu do
                video RAM s vertik ln¡m zpˆtn˜m bˆhem.

03BBH nebo 03DBH  - z pis: libovoln˜ v˜stup vyma‘e registr svˆteln‚ho pera
03BCH nebo 03DCH  - z pis: libovoln˜ v˜stup nastav¡ registr svˆteln‚ho pera

    Pozn.: Bit  0 portu 03C0H nastavuje, kter˜ p r adres port– bude pou‘it.
           (norm lnˆ je pro MDA adresa 03BxH a pro CGA adresa 03DxH).




Nastaven¡ p©ep¡na‡– DIL na kartˆ EGA
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Na  zadn¡  stranˆ grafick‚ karty EGA je um¡stˆno nˆkolik p©ep¡na‡– DIL,
na  kter˜ch  je  mo‘no  nastavit,  kter˜ monitor je p©ipojen ke kartˆ EGA a
kter‚  jin‚  adapt‚ry  (pokud  nˆjak‚  jsou) jsou ve stejn‚ dobˆ um¡stˆny v
syst‚mu.  Nastaven¡  p©ep¡na‡–  je  ulo‘eno  t‚‘  v  datov‚m  prostoru BIOS
(prostor dat EGA).

    Je  t©eba  db t na to, aby nebyl nikdy p©ipojen monochromatick˜ monitor
IBM  (typ TTL) k adapt‚ru EGA, dokud nebudou nastaveny p©ep¡na‡e spr vnˆ na
tento   monitor.   Chybn‚   nastaven¡  p©ep¡na‡–  zp–sob¡  fyzick‚  zni‡en¡
monitoruú!

    V    n sleduj¡c¡ch    tabulk ch    jsou    jako   "prim rn¡"   ozna‡eny
adapt‚ry/monitory,  kter‚  jsou  p©ipojeny  jako prvn¡ po zapnut¡ po‡¡ta‡e.
Jako  "sekund rn¡"  jsou  ozna‡eny voliteln‚ adapt‚ry/monitory, kter‚ mohou
b˜t p©ipojeny k syst‚mu jako druh‚.

    Barevn˜ monitor ECM je Enhanced Color Monitor (zvˆt¨en˜ bar. monit.).


ON  Ú4Â3Â2Â1¿
    ³Û³ ³ ³Û³ prim rn¡ je EGA spojen  s barevn˜m monitorem 40x25 znak–
    ³ ³Û³Û³ ³ sekund rn¡ je karta MDA
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³ ³ ³ ³ prim rn¡ je EGA spojen  s barevn˜m monitorem 80x25 znak–
    ³ ³Û³Û³Û³ sekund rn¡ je karta MDA
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³ ³Û³Û³Û³ prim rn¡ je EGA spojen  s barevn˜m monit. ECM (emulace CGA)
    ³Û³ ³ ³ ³ sekund rn¡ je karta MDA
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³ ³Û³Û³ ³ prim rn¡ je EGA spojen  s barev. monit. ECM (vy¨¨¡ rozli¨en¡)
    ³Û³ ³ ³Û³ sekund rn¡ je karta MDA
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³ ³Û³ ³Û³ prim rn¡ je EGA spojen  s monochromatick˜m monitorem
    ³Û³ ³Û³ ³ sekund rn¡ je karta CGA spojen  s barevn˜m monitorem 40x25
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³ ³Û³ ³ ³ prim rn¡ je EGA spojen  s monochromatick˜m monitorem
    ³Û³ ³Û³Û³ sekund rn¡ je karta CGA spojen  s barevn˜m monitorem 80x25
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³Û³Û³Û³ prim rn¡ je karta MDA
    ³ ³ ³ ³ ³ sekund rn¡ je karta EGA spojen  s barevn˜m monitorem 40x25
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³Û³Û³ ³ prim rn¡ je karta MDA
    ³ ³ ³ ³Û³ sekund rn¡ je karta EGA spojen  s barevn˜m monitorem 80x25
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³Û³ ³Û³ prim rn¡ je karta MDA
    ³ ³ ³Û³ ³ sekund rn¡ je karta EGA spojen  s monitorem ECM (emulace CGA)
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³Û³ ³ ³ prim rn¡ je karta MDA
    ³ ³ ³Û³Û³ sekund rn¡ je karta EGA spojen  s monitorem ECM (lep¨¡ rozl.)
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³ ³Û³Û³ prim rn¡ je karta CGA spojen  s barevn˜m monitorem 40x25
    ³ ³Û³ ³ ³ sekund rn¡ je karta EGA spojen  s monochromatick˜m monitorem
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³ ³Û³ ³ prim rn¡ je karta CGA spojen  s barevn˜m monitorem 80x25
    ³ ³Û³ ³Û³ sekund rn¡ je karta EGA spojen  s monochromatick˜m monitorem
OFF ÀÄÁÄÁÄÁÄÙ

    M–stky  EGA:  na  kartˆ  EGA  jsou  um¡stˆny  t©i  propojovac¡  m–stky,
umo‘¤uj¡c¡ dal¨¡ dopl¤uj¡c¡ nastaven¡ karty EGA.

    ÉP1Í»
  1 ºÚù¿º Podporuje barevn˜ monitor ECM (640x350 bod– a 64 barev)
  2 ºÀùÙº
  3 º ù º
    ÈÍÍÍ¼

    ÉP1Í»
  1 º ù º
  2 ºÚù¿º
  3 ºÀùÙº Podporuje pouze barevn˜ monitor (640x200 bod– a 16 barev)
    ÈÍÍÍ¼

    M–stel P2 je p©ipojen¡ pro svˆteln‚ pero.

    ÉP3Í»
  1 ºÚù¿º Nastaven¡ I/O portu EGA na 03xxH (norm ln¡ nastaven¡)
  2 ºÀùÙº
  3 º ù º
    ÈÍÍÍ¼

    ÉP3Í»
  1 º ù º
  2 ºÚù¿º
  3 ºÀùÙº Nastaven¡ I/O portu EGA na 02xxH (nepodporuje EGA BIOS)
    ÈÍÍÍ¼



        ÿ1ÿ1ÿ.ÿ-  ÿPÿaÿrÿaÿlÿeÿlÿnÿ¡  ÿpÿoÿrÿtÿy  ÿtÿiÿsÿkÿ ÿrÿeÿn

Porty 0378H - 037FH: paraleln¡ port #1 tisk rny
Porty 0278H - 027FH: paraleln¡ port #2 tisk rny
Porty 03B0H - 03BFH: monochromatick˜ displej/paraleln¡ port #3 tisk rny
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    ROM-BIOS podporuje a‘ t©i paraleln¡ porty tisk ren, kter‚ jsou ozna‡eny
jako  LPT1  - LPT3. Bˆhem inicializa‡n¡ho testu p©i zapnut¡ po‡¡ta‡e (POST)
testuje BIOS tyto porty v tomto po©ad¡:

  1.- 03BCH - nalezeno p©ipojen¡ monochromn¡ho displeje k portu/tisk rna #3
  2.- 0378H - adapt‚r paraleln¡ho portu tisk rny #1
  3.- 0278H - adapt‚r paraleln¡ho portu tisk rny #2

    a p©i©ad¡ port–m ozna‡en¡ jako LPT1-LPT3, tak jak jsou nalezeny. Ukl d 
adresy  port–  podle  v˜sledku  testu od adresy 0:0408H (adresy paraleln¡ch
port– tisk ren).

    Slu‘ba  BIOS  INT 17H umo‘¤uje plnou podporu a‘ 4 tisk ren. K p©ipojen¡
‡tvrt‚  tisk rny  mus¡te  um¡stit  jej¡ b zovou adresu do datov‚ho prostoru
BIOS jako slovo na adresu 0:0410H.


    Popisy  port–  jsou uv dˆny pouze pro adresy 0378H-037FH; ostatn¡ porty
jsou analogick‚.

0378H-037FH Adapt‚r paraleln¡ho portu tisk rny #1 (LPT1)
              03BCH je b zov  adresa monochromn¡ho displeje
              0278H je b zov  adresa adapt‚ru paraleln¡ho portu tisk rny #2

0378H  - data tisk rny
       - z pis: vysl n¡ bajtu na tisk rnu
       - ‡ten¡: ‡ten¡ posledn¡ho vyslan‚ho bajtu na tisk rnu


037AH  - ©¡zen¡ tisk rny
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: +Strobe (pin 1)         (1 = vysl n¡ bajtu)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: +AUTO LineFeed (pin 14) (1 = autom.LF po CR)
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: -INIT (pin 16)          (0 = reset tisk rny)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: +SLCT IN (pin 17)       (1 = vybere tisk rnu)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: +mo‘n‚ p©eru¨en¡ (hardwarov‚ p©eru¨en¡, kdy‘
         ³ ³ ³                                  sign l -ACK jde k nule)
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: v‘dy = 0
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: v‘dy = 0
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: v‘dy = 0

    Generovan  p©eru¨en¡:    LPT1 ÄÄÄ> IRQ 7 (INT 0FH)
                             LPT2 ÄÄÄ> IRQ 5 (INT 0DH)

0379H  - statut tisk rny (pouze ‡ten¡ portu)
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: v‘dy = 0
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: v‘dy = 0
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: v‘dy = 0
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: -ERROR (pin 15)(0=tisk rna signalizuje chybu)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: +SLCT (pin 13) (1=tisk rna je vybr na)
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: +PE (pin 12)   (1=v tisk rnˆ nen¡ pap¡r)
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: -ACK (pin 10)  (0=p©ipravena na dal¨¡ znak)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: -BUSY (pin 11) (0=zanepr zdn.,OFF-LINE,chyba)




    ÿ1ÿ2ÿ.ÿ-  ÿPÿoÿrÿt  ÿaÿsÿsÿyÿnÿcÿhÿrÿoÿnÿnÿ¡ÿhÿo  ÿaÿdÿaÿpÿtÿ‚ÿrÿu


    Prostor  dat  BIOS  obsahuje  v˜pis  b zov˜ch  adres  a‘ ‡ty© s‚riov˜ch
(komunika‡n¡ch)  port–  COM.  Bˆhem  inicializa‡n¡ho  testu  POST testuje a
inicializuje BIOS porty COM1 a COM2.

    - adapt‚r portu COM1 dek¢duje porty 03F8H a‘ 03FFH (IRQ 4 / INT 0CH)
    - adapt‚r portu COM2 dek¢duje porty 02F8H a‘ 02FFH (IRQ 3 / INT 0BH)

    P©eru¨en¡  ROM  BIOS  INT 14H bude pracovat s kter˜mkoliv z tˆchto ‡ty©
port–,  pokud ulo‘¡te b zovou adresu portu do tabulky port– COM zaa‡¡naj¡c¡
na  adrese  0:0400H.  Je  nutn‚,  aby  ‘ dn‚ dva adapt‚ry nesd¡lely stejnou
adresu nebo jinak nebudou pracovat.

Porty 03F8H - 03FFH: port asynchronn¡ho adapt‚ru COM1
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Analogicky pracuj¡ registry adapt‚ru COM2.

03F8H  - z pis: registr £schovy p©en ¨en˜ch dat - 8 bit– znaku k vysl n¡
       - ‡ten¡: registr p©ij¡mac¡ho bufferu - 8 bit– p©ijat‚ho znaku
Pro DLAB=1:
       - z pis: registr   dˆli‡ky  -  ni‘¨¡  bajt  (pokud  DLAB=1,  tj.  po
                instrukci  OUT  03FBH,80H).  Po operaci OUT 03FBH,80H tento
                port  obsahuje  ni‘¨¡ bajt dˆli‡ky taktu. Spole‡nˆ s vy¨¨¡m
                bajtem   (port   03F9H)  tvo©¡  16-bitovou  hodnotu,  kter 
                nastavuje rychlost p©enosu dat:
                ÉÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍ»
                º    baud   ³  dˆli‡ka  º    baud   ³  dˆli‡ka  º
                ÌÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÎÍÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍ¹
                º    110    ³   1040    º    1200   ³    96     º
                º    150    ³    768    º    2400   ³    48     º
                º    300    ³    384    º    4800   ³    24     º
                º    600    ³    192    º    9600   ³    12     º
                ÈÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍ¼
03F9H  - z pis: registr povolen¡ p©eru¨en¡ (DLAB=1)
                ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
                ³7 6 5 4 3 2 1 0³
                ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=mo‘n‚ p©eru¨en¡ p©i p©¡jmu dat
                 ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=mo‘n‚ p©er. p©i pr zdn‚m vys. buff.
                 ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=mo‘n‚ p©er. stavem p©ij¡mac¡ linky
                 ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=mo‘n‚ p©er. stavem modemu
                 ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: v‘dy = 0
                 ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: v‘dy = 0
                 ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: v‘dy = 0
                 ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: v‘dy = 0
       - z pis: registr   dˆli‡ky  -  vy¨¨¡  bajt  (pokud  DLAB=1,  tj.  po
                instrukci  OUT  03FBH,80H).  Po operaci OUT 03FBH,80H tento
                port  obsahuje  vy¨¨¡ bajt dˆli‡ky taktu. Spole‡nˆ s ni‘¨¡m
                bajtem   (port   03F8H)  tvo©¡  16-bitovou  hodnotu,  kter 
                nastavuje rychlost p©enosu dat.








03FAH  - ‡ten¡: identifika‡n¡  registr  p©eru¨en¡. Pokud nastane p©eru¨en¡,
                ‡tˆte  tento  registr,  pokud  chcete zjistit, co zp–sobilo
                p©eru¨en¡.
                ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
                ³7 6 5 4 3 2 1 0³
                ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
                 ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=nenastalo ‘ dn‚ p©eru¨en¡
                 ³ ³ ³ ³ ³ ÀÄÁÄÄÄ> 1-2: 00=p©eru¨en¡ stavem p©ij¡mac¡ linky
                 ³ ³ ³ ³ ³                 vznik   p©i p©ete‡en¡, paritˆ,
                 ³ ³ ³ ³ ³                 chybˆ r mu nebo p©i p©eru¨en¡.
                 ³ ³ ³ ³ ³                 Resetov n¡ ‡ten¡m stavu linky
                 ³ ³ ³ ³ ³                 (port 03FDH)
                 ³ ³ ³ ³ ³              01=p©ijat  data platn  (resetov n¡
                 ³ ³ ³ ³ ³                 ‡ten¡m p©ij¡m. bufferu 03F8H)
                 ³ ³ ³ ³ ³              10=vys¡lac¡ buffer pr zdn˜ (reset
                 ³ ³ ³ ³ ³                 z pisem do vys¡l. bufferu 03F8H)
                 ³ ³ ³ ³ ³              11=stav modemu. Vznik  p©i zmˆnˆ
                 ³ ³ ³ ³ ³                 sign l– CTS, DSR, RI nebo RLSD.
                 ³ ³ ³ ³ ³                 Reset ‡ten¡m stavu modemu 03FEH.
                 ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  v‘dy = 0
                 ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  v‘dy = 0
                 ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  v‘dy = 0
                 ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  v‘dy = 0
                 ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  v‘dy = 0

03FBH  - ‡ten¡/z pis: ©¡d¡c¡ registr linky
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: d‚lka slova: 00=5; 01=6; 10=7; 11=8
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  stop-bity: 0=1, 1=2
          ³ ³ ³ ÀÄÁÄÄÄÄÄÄÄ> 3-4: parita: x0=‘ dn ; 01=lich ; 11=sud 
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  parita znaku (BIOS nepou‘¡v )
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  mo‘n‚ ©¡zen¡ BREAK; 1=za‡ tek vys¡l n¡ 0s
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  DLAB (p©¡stupov˜ bit k registru dˆli‡ky)
                                 - ur‡uje m¢d port– 03F8H a 03F9H pro nast.
                                  (pokud je DLAB=1, je p©¡stup k dˆli‡ce)

03FCH  - z pis: ©¡d¡c¡ registr modemu
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=aktivace -DTR (-data terminal ready)
          ³ ³ ³ ³ ³ ³ ³          (informuje, ‘e ‡ek  na p©¡jem znaku)
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=aktivace -RTS (-request to send)
          ³ ³ ³ ³ ³ ³            (m  p©ipraven znak k vysl n¡)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=aktivace -OUT1 (u‘ivatelsk˜ v˜stup)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=aktivace -OUT2 (u‘ivatelsk˜ v˜stup)
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=aktivace zpˆtn‚ smy‡ky pro diagnostiku
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: v‘dy = 0
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: v‘dy = 0
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: v‘dy = 0

03FDH  - ‡ten¡: stavov˜ registr linky
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=data p©ipravena (DR) (reset ‡ten¡m dat)
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=chyba p©ete‡en¡ (OE): p©edch. znak ztracen
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=chyba parity (PE): reset ‡ten¡m st.linky
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=chyba r mu (FE): ¨patn˜ stop-bit ve znaku
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=indikace break (BI): p©ijata dlouh  mezera
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=vys¡lac¡ registr pr zdn˜ (OK k vys¡l n¡)
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=vys¡la‡ pr zdn˜. Nevys¡l  ‘ dn  data.
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: v‘dy = 0
         Pozn.: P©i povolen‚m p©eru¨en¡ (03F9H) zp–sob¡ bity 1-4 p©eru¨en¡.

03FEH  - ‡ten¡: stavov˜ registr modemu
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=zmˆna stavu DCTS (Delta Clear To Send)
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=zmˆna stavu DDSR (Delta Data Set Ready)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=aktivn¡ zvukov  signalizace TERI
          ³ ³ ³ ³ ³              (Trailing Edge Ring Indicator)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=zmˆna st. DDCD (Delta Data Carrier Detect)
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=CTS (Clear To Send) je aktivn¡
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=DSR (Data Set Ready) je aktivn¡
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=signalizace RI (Ring Indikator) je aktivn¡
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=DCD (Data Carrier Detect) je aktivn¡
         Pozn.: P©i povolen‚m p©eru¨en¡ (03F9H) zp–sob¡ bity 0-3 p©eru¨en¡.


       ÿ1ÿ3ÿ.ÿ-  ÿPÿoÿrÿt  ÿhÿeÿrÿnÿ¡ÿhÿo  ÿIÿ/ÿO  ÿaÿdÿaÿpÿtÿ‚ÿrÿu


Port 0201H: port hern¡ho I/O adapt‚ru (joystickov˜ port)
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Port 0201H je ozna‡en jako port hern¡ho adapt‚ru nebo joystickov˜ port.
Nen¡  podporov n  modulem  ROM-BIOS po‡¡ta‡– PC/XT, ale BIOS AT - p©eru¨en¡
INT 15H/slu‘ba 84H umo‘¤uje snadn‚ pou‘it¡ interface pro tento adapt‚r.

    Jde  p©edev¨¡m  o  analogovˆ/digit ln¡ konvertor, kter˜ m–‘e b˜t pou‘it
vˆdeck˜mi  mˆ©¡c¡mi p©¡stroji a jin˜mi za©¡zen¡mi, kter  obsahuj¡ analogov˜
(odporov˜)  vstup  na  interface. Umo‘¤uje pou‘¡t a‘ ‡ty©i ‡¡slicov‚ vstupy
(data  zap/vyp,  jako  je  nap©. stisk tla‡¡tka) a a‘ ‡ty©i odporov‚ vstupy
(jako  jsou  X-sou©adnice  joysticku  nebo hodnota teploty z elektronick‚ho
teplomˆru).

    Hodnota obdr‘en  instrukc¡ IN z portu 0201H m  strukturu:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: Ax Ä¿
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: Ay  ÃÄ> sou©adnice (odporov‚, ‡asovˆ
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: Bx  ³               z visl‚ vstupy)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: By ÄÙ
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: A1 Ä¿
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: A2  ÃÄ> tla‡¡tka/spou¨tˆn¡ (‡¡slicov‚ vstupy)
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: B1  ³
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: B2 ÄÙ

    Ozna‡en¡:  A=joystick  A;  B=joystick  B; x,y = sou©adnice X a Y; 1,2 =
               tla‡¡tka joysticku 1 a 2.

    Vstupy z tla‡¡tek (digit ln¡ vstupy) m–‘ete ‡¡st t¡mto zp–sobem:

         mov       dx,201h             ; adresa portu
         out       dx,al               ; inicializace ©¡zen¡ (AL=cokoliv)
         in        al,dx               ; ‡ten¡ bit– 4-7 tla‡¡tek (0=stisk)

    Joysticky,  ovlada‡e,  mˆ©¡c¡  p©¡stroje  (odporov‚  vstupy) jsou ‡teny
mˆ©en¡m  doby,  po  kterou  jsou  bity  X  nebo Y po instrukci OUTú0201H,xx
nastaveny na hodnotu 1.

    €ten¡ samostatn˜ch odporov˜ch vstup– (p©¡klad - sou©ad. X joysticku A):

         mov       dx,0201h            ; adresa portu
         out       dx,al               ; inicializace ©¡zen¡ (AL=cokoliv)
         mov       cx,-1               ; nastaven¡ ‡¡ta‡e odporu
opet:    in        al,dx               ; ‡ten¡ nastaven¡
         inc       cx                  ; ‡¡ta‡
         test      al,1                ; p©e¨el ji‘ bit sou©adnice X na 0 ?
         jnz       opet                ; ‡ek n¡ dokud je bit sou©. X = 1

    Hodnota  prodlevy  nast© dan   v  registru  CX  bude  indikovat  pozici
sou©adnice X joysticku A. Tato hodnota je relativn¡ a z vis¡ na koeficientu
p©evodu  cel‚ho p©evodn¡ho ©etˆzce, tj. p©evodu polohy na interval a mˆ©en¡
d‚lky intervalu. Pro p©esnˆj¨¡ p©evod je lep¨¡ pou‘¡t hardwarov‚ho ‡asova‡e
(odtran¡ i vliv p©eru¨en¡ na p©evod).




          ÿ1ÿ4ÿ.ÿ-  ÿMÿaÿtÿeÿmÿaÿtÿiÿcÿkÿ˜  ÿkÿoÿpÿrÿoÿcÿeÿsÿoÿr


Porty 00F0H - 00FFH: matematick˜ koprocesor
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

00F0H  - AT: vynulov n¡ registru 80287 (OUT 00F0H,0).

00F1H  - AT: reset   80287   (OUT   00F1H,0);  koprocesor  je  resetov n  z
             chr nˆn‚ho m¢du do re ln‚ho m¢du.

00F8H-00FCH  - AT: data  80287;  80286  vys¡l   opera‡n¡  k¢dy a operandy a
                   p©ij¡m  v˜sledky operac¡





               ÿ1ÿ5ÿ.ÿ-  ÿRÿoÿzÿ¨ÿiÿ©ÿuÿjÿ¡ÿcÿ¡  ÿbÿoÿx  ÿXÿT


Porty 0210H - 0217H: roz¨i©uj¡c¡ box XT
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0210H  - ©¡d¡c¡ port roz¨i©uj¡c¡ho boxu XT
0213H  - povolen¡ roz¨i©uj¡c¡ho boxu XT
0215H  - registr datov‚ sbˆrnice roz¨i©uj¡c¡ho boxu XT
       - adresov˜ registr roz¨i©uj¡c¡ho boxu XT (vi¨¨¡ bajt)
0216H  - adresov˜ registr roz¨i©uj¡c¡ho boxu XT (ni‘¨¡ bajt)

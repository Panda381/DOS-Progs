
ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±± º
º ±±                                                                   ±± º
º ±±                             ÿPÿoÿrÿtÿy                            ±± º
º ±±                                                                   ±± º
º ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±± º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
                            (c) Miroslav NØmeŸek

Z kladn¡ rozdØlen¡ port… v poŸ¡taŸi:

    * porty 0000H - 00FFH jsou rezerovv ny pro pou§it¡ syst‚movou deskou
    * porty 0100H - 03FFH jsou  dek¢dov ny  na  I/O  sbØrnici  pro  pou§it¡
                          kartou adapt‚ru displeje
    * porty 0400H a vìçe nejsou pı¡stupn‚ na syst‚mov‚ sbØrnici

(Pozn.: V dalç¡m bude pou§¡v no oznaŸen¡ I/O = vstupnØ/vìstupn¡)



RozdØlen¡ port…:

      AT:          PC/XT:  kapitola:     popis:

0000H - 001FH  0000H - 000FH  3   ıadiŸ DMA #1, 8237A-5
0020H - 003FH  0020H - 0021H  2   ıadiŸ pıeruçen¡ #1, 8259A
0040H - 005FH  0040H - 0043H  4   ŸasovaŸ 8253-5 (AT: 8254.2)
               0060H - 0063H  5   programovatelnì perifern¡ interface (PPI)
                                  kl vesnice, pıep¡naŸ… vybaven¡, ŸasovaŸe
0060H - 006FH                 5   ıadiŸ kl vesnice 8042 (AT)
0070H - 0071H                 6   hodiny   re ln‚ho   Ÿasu,   pamØœ   CMOS,
                                  maskov n¡ NMI (nemaskovateln‚ pıeruçen¡)
0080H                             tov rn¡ kontroln¡ diagnostickì bod
0081H - 009FH  0080H - 0083H  3   DMA str nkovì registr 74LS612
               00A0H              maska NMI (nemaskovateln‚ pıeruçen¡)
00A0H - 00BFH                 2   ıadiŸ pıeruçen¡ #2, 8259A
00C0H - 00DFH                 3   ıadiŸ DMA #2, 8237A-5
00F0H - 00FFH                14   matematickì koprocesor  8087,80287,80387

0170H - 0177H                 7   ıadiŸ druh‚ho pevn‚ho disku AT
01F0H - 01F7H                 7   ıadiŸ prvn¡ho pevn‚ho disku AT
0200H - 0207H  0200H - 020FH 13   hern¡ I/O adapt‚r (joystick, A/D port)
               0210H - 0217H 15   rozçiıuj¡c¡ box XT
0278H - 027FH  0278H - 027FH 11   paraleln¡ port tisk rny #2 (#3 s DMA)
02C0H - 02DFH  02C0H - 02DFH 10   porty EGA #2 (druh  EGA v syst‚mu)
02F8H - 02FFH  02F8H - 02FFH 12   port asynchronn¡ho komunik. adapt‚ru #2
0300H - 031FH                     karta prototypu
               0320H - 0327H  7   ıadiŸ pevn‚ho disku XT
0370H - 0377H                 8   ıadiŸ pru§nìch disk… 2 (AT)
0378H - 037FH  0378H - 037FH 11   paraleln¡ tisk rna #1 (#2 s DMA)
0380H - 038FH  0380H - 038FH      ı¡zen¡ synchronn¡ datov‚ linky (SDLC)
03A0H - 03AFH  03A0H - 03A9H      bisynchronn¡ port #1
03B0H - 03BFH  03B0H - 03BFH 10,11 adapt‚r monochrom. displeje/tisk rna #1
03C0H - 03CFH  03C0H - 03CFH 10   porty EGA #1 (hlavn¡ EGA v syst‚mu)
03D0H - 03DFH  03D0H - 03DFH 9,10 porty CGA a EGA (MC 6845)
03F0H - 03F7H  03F0H - 03F7H  8   ıadiŸ pru§nìch disk… 1 XT,AT (NEC ?PD765)
03F8H - 03FFH  03F8H - 03FFH 12   port asynchronn¡ho adapt‚ru #1


RozdØlen¡ do kapitol:

 1.- nastaven¡ syst‚movìch pıep¡naŸ…
 2.- ıadiŸ pıeruçen¡
 3.- ıadiŸ DMA
 4.- ŸasovaŸ
 5.- kl vesnice
 6.- pamØœ CMOS, maskov n¡ NMI
 7.- ıadiŸ pevn‚ho disku
 8.- ıadiŸ pru§nìch disk…
 9.- grafick  karta CGA
10.- grafick  karta EGA (a MDA)
11.- paraleln¡ porty tisk ren
12.- port assynchronn¡ho adapt‚ru
13.- port hern¡ho I/O adapt‚ru
14.- matematickì koprocesor
15.- rozçiıuj¡c¡ box XT




   ÿ1ÿ.ÿ-  ÿNÿaÿsÿtÿaÿvÿeÿnÿ¡  ÿsÿyÿsÿtÿ‚ÿmÿoÿvÿìÿcÿh  ÿpÿıÿeÿpÿ¡ÿnÿaÿŸÿ…


    Pıep¡naŸe DIL poŸ¡taŸ… PC a XT informuj¡ BIOS o vybaven¡ poŸ¡taŸe a jak
velik  pamØœ je nainstalov na. Tyto pıep¡naŸe se Ÿtou bØhem inicializaŸn¡ho
testu  POST  a  nastav¡  se  podle  nich pı¡znakov‚ bity v tabulce vybaven¡
poŸ¡taŸe  v  datov‚m  prostoru  BIOS  (tato  tabulka  na  adrese 0:0410H je
program torovi pı¡stupn  pıes pıeruçen¡ INT 11H).

    Na  p…vodn¡m  PC  (64KB  pamØti  na z kladn¡ desce; nØkdy se t‚§ nazìv 
PC-1) byly na syst‚mov‚ desce um¡stØny dva pıep¡naŸe DIL, oznaŸen‚ jako SW1
a SW2 (pozn.: pokud je pıep¡naŸ v poloze ON, m  sign l hodnotu 0):

                              ÉÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍ»
                              º pıep¡naŸe º 00(0) ³ 01(1) ³ 10(2) ³ 11(3) º
             SW1              ÌÍÍÍÂÍÍÍÂÍÍÍÎÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍ¹
ON   Ú1Â2Â3Â4Â5Â6Â7Â8¿  = 0   º 7 ³ 5 ³ 3 º  -ß-  ³  -Ü-  ³  -ß-  ³  -Ü-  º
     ³ ³ ³ ³ ³ ³ ³ ³ ³        ÌÄÄÄÅÄÄÄÅÄÄÄÎÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄ¹
     ³ ³ ³ ³ ³ ³ ³ ³ ³  = 1   º 8 ³ 6 ³ 4 º  -ß-  ³  -ß-  ³  -Ü-  ³  -Ü-  º
OFF  ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ        ÈÍÍÍÁÍÍÍÁÍÍÍÊÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍ¼
      ³ ³ ³ ³ ³ ³ ³ ³   pıep.
      ³ ³ ³ ³ ³ ³ ÀÄÁÄÄ> 7-8: disketovìch mechanik-1 (00=1;01=2;10=3;11=4)
      ³ ³ ³ ³ ÀÄÁÄÄÄÄÄÄ> 5-6: aktivn¡ m¢d displeje (rezer.,40zn,80zn,mono)
      ³ ³ ÀÄÁÄÄÄÄÄÄÄÄÄÄ> 3-4: RAM na syst‚mov‚ desce (16K, 32K, 48K, 64K)
      ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  2:  matematickì koprocesor 8087 (OFF=je; ON=nen¡)
      ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  1:  disketov‚ mechaniky (OFF=jsou; ON=§ dn )

    Pou§it¡  pıep¡naŸ…  DIL  u  poŸ¡taŸe XT je podobn‚ jako u PC s vyj¡mkou
pozice  1,  kter   aktivuje  cyklov n¡ inicializaŸn¡ho tesu POST a mus¡ bìt
proto  v§dy  v  poloze  OFF. Odliçn‚ jsou t‚§ hodnoty syst‚mov‚ pamØti RAM,
kter‚  se  nastavuj¡  pozicemi  3-4  pıep¡naŸe SW1 - hodnoty pamØti jsou (v
odpov¡daj¡c¡m poıad¡) 64K, 128K, 192K a 256K.


          SW2 (PC-1)
ON   Ú1Â2Â3Â4Â5Â6Â7Â8¿  = 0
     ³ ³ ³ ³ ³ ³ ³ ³ ³
     ³ ³ ³ ³ ³Û³Û³Û³Û³  = 1
OFF  ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
      ³ ³ ³ ³ ³ ³ ³ ³   pıep.
      ³ ³ ³ ³ ÀÄÁÄÁÄÁÄÄ> 5-8: v§dy v OFF
      ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄÄ> 1-4: celkov  RAM: pozice 4 = 256K (v OFF plat¡)
                                           pozice 3 = 128K (v OFF plat¡)
                                           pozice 2 =  64K (v OFF plat¡)
                                           pozice 1 =  32K (v OFF plat¡)
      Celkov   kapacita pamØti vznikne souŸtem jednotlivìch pozic pıep¡naŸ…
      a  volby  z  SW1.  Napı.  512  KB: 3(SW1)=OFF; 4(SW1)=OFF; 1(SW2)=ON;
      2(SW2)=OFF a§ 4(SW2)=OFF.

    PozdØjç¡  verze  PC  (nØkdy  nazìvan‚  PC-2)  maj¡  odliçnì BIOS, kterì
interpretuje  pıep¡naŸ SW2 ponØkud odliçnØ (vìznam SW1 z…st v  stejnì).

          SW2 (PC-2)
ON   Ú1Â2Â3Â4Â5Â6Â7Â8¿  = 0
     ³ ³ ³ ³ ³ ³ ³ ³ ³
     ³ ³ ³ ³ ³ ³Û³Û³Û³  = 1
OFF  ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
      ³ ³ ³ ³ ³ ³ ³ ³   pıep.
      ³ ³ ³ ³ ³ ÀÄÁÄÁÄÄ> 6-8: v§dy v OFF
      ÀÄÁÄÁÄÁÄÁÄÄÄÄÄÄÄÄ> 1-5: celkov  RAM: vìznam stejnì jako u PC-1, nav¡c
                                           je pozice 5 = 512K (v OFF plat¡)
                                          Maxim ln¡ kapacita m…§e bìt 640K.

    Na poŸ¡taŸ¡ch PC a XT m…§ete zmØnit £Ÿinek pıep¡naŸ… zmØnou v nastaven¡
tabulky  vybaven¡ (adresa 0:0410H) a resetov n¡m DOS. Pıedt¡m vçak nastavte
obsah  adresy  0:0472H  na  1234H  (viz zav dØn¡ operaŸn¡ho syst‚mu, POST),
potom proveÔte INT 19H.

    Pokud  bØhem provozu poŸ¡taŸe nastane chyba pamØti, nebo chcete zjistit
skuteŸnou velikost pamØti, zkuste n sleduj¡c¡ postup: Nastavte pıep¡naŸe na
malou  velikost  pamØti (aby syst‚m fungoval bez chyby), resetujte syst‚m a
po  zaveden¡  syst‚mu  zkuste  pı¡kaz  CHKDSK  k  zjiçtØn¡,  zda je pamØœ v
poı dku.  Pokud  ano,  zvØtçete nastaven¡ velikosti pamØti a opakujte reset
syst‚mu  a  kontrolu  pamØti.  To opakujte tak dlouho, a§ bude pıi kontrole
pamØti hl çena chyba.

    Pokud  se  v m  touto  cestou  podaı¡ zvìçit pomoc¡ pıep¡naŸ… DIL pamØœ
poŸ¡taŸe nad 640K, BIOS bude sice çœastnì, avçak DOS tuto operaci nepıe§ije
(pıechodn  Ÿ st COMMAND.COM se naŸte do nejvyçç¡ Ÿ sti pamØti RAM).


    PoŸ¡taŸ  AT  nem  nastavov n¡ pomoc¡ pıep¡naŸ… DIL. Konfigurace syst‚mu
je nastavena pomoc¡ konfiguraŸn¡ho programu SETUP, kterì je ulo§en v pamØti
ROM,  vìsledek  nastaven¡  se  ulo§¡  do  pamØti  CMOS. Jedin‚ nastaven¡ se
prov d¡  pomoc¡  propojovac¡ch  m…stk…, tyto m…stky jsou vçak ji§ nastaveny
tov rnØ  podle  konkr‚tn¡ho osazen¡ syst‚mov‚ desky a nen¡ vhodn‚ je mØnit.
Ze  zaj¡mavìch  m…stk…  lze  uv‚st  pouze  m…stek  J18,  kterì v poloze 1-2
povoluje  pou§it¡  druh‚ Ÿ sti 256K (pıi 512K na syst‚mov‚ desce), v poloze
2-3  ji  blokuje. Dalç¡m pıep¡naŸem AT je pıep¡naŸ oznaŸenì jako SW1, kterì
urŸuje  inicializaŸn¡  adapt‚r  displeje  (pro  inicializaŸn¡  test POST) v
pı¡padØ, §e data v CMOS jsou neplatn  (napı. pıi vìpadku baterie). V poloze
ON  (smØrem k zadn¡mu panelu) tento pıep¡naŸ urŸuje jako prim rn¡ grafickou
kartu  CGA,  v poloze OFF (smØrem k pıedn¡mu panelu) oznaŸuje jako prim rn¡
grafickou kartu EGA. Nastaven¡ pıep¡naŸ… karty EGA - viz popis karty EGA.





                   ÿ2ÿ.ÿ-  ÿüÿaÿdÿiÿŸ  ÿpÿıÿeÿrÿuÿçÿeÿnÿ¡




üadiŸ  pıeruçen¡:


Porty 0020H - 003FH: ıadiŸ pıeruçen¡ #1 8259A
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Inicializace ıadiŸe pıeruçen¡ 8259A:

ICW1: Inic. ı¡dic¡ slovo - zapisuje se v§dy jako prvn¡ slovo na port 0020H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
               ³ ³   ³ ÀÄ> 0: nutno nastavit na 1
               ³ ³   ÀÄÄÄ> 1: 1=jednoduchì m¢d; 0=kask dn¡ m¢d (bude ICW3)
               ³ ÀÄÄÄÄÄÄÄ> 3: 1=spouçtØn¡ £rovn¡; 0=spouçtØn¡ hranou
               ÀÄÄÄÄÄÄÄÄÄ> 4: nutno nastavit na 1

ICW2: Inic. ı¡dic¡ slovo - zapisuje se bezprostıednØ po ICW1 na port 0021H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³         0-2: nepou§ito, bity se dosad¡ automaticky
         ÀÄÁÄÁÄÁÄÁÄÄÄÄÄÄÄ> 3-7: bity 3 a§ 7 Ÿ¡sla pıeruçen¡ INT x

ICW3: Inic.  ı¡dic¡  slovo - zapisuje se po ICW2 na port 0021H, pokud byl v
      ICW1 nastaven bit 1 na 0 (=kask dn¡ m¢d):

    üadiŸ je jako MASTER:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ³
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄ> 0-7: 1=je pıipojen SLAVE; 0=nen¡ SLAVE

    üadiŸ je jako SLAVE:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                   ³ ³ ³
                   ÀÄÁÄÁÄ> 0-2: Ÿ¡slo SLAVE (kam je pıipojen k MASTER)


ICW4: Inic. ı¡dic¡ slovo - zapisuje se po ICW2 resp. po ICW3 na port 0021H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: nutno nastavit na 1
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=autom. konec pıeruçen¡; 0=pou§ije se EOI
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: (pouze pokud je bit 3=1): 1=MASTER; 0=SLAVE
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=buff. m¢d; 0=nen¡ buff. m¢d (bit 2 ignor.)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=spec. re§im s £plnìm vkl d n¡ (jen MASTER)
         ÀÄÁÄÁÄÄÄÄÄÄÄÄÄÄÄ> 5-7: nutno nastavit na 0



    OperaŸn¡ ı¡dic¡ slova (v bØ§n‚m provozu):

OCW1: Oper. ı¡dic¡ slovo - zapisuje se nebo Ÿte z portu 0021H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ³
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄ> 0-7: pıeruçen¡ od vstupu: 1=zak z no, 0=povoleno

OCW2: Oper. ı¡dic¡ slovo - zapisuje se na port 0020H:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit        (EOI=povel pro konec pıeruçen¡)
         ³ ³ ³ ³ ³ ³ ³ ³
         ³ ³ ³ ³ ³ ÀÄÁÄÁÄ> 0-2: £roveå pıeruçen¡ 0 a§ 7 (povely 60,C0 a E0)
         ³ ³ ³ ÀÄÁÄÄÄÄÄÄÄ> 3,4: nutno nastavit na 0
         ÀÄÁÄÁÄÄÄÄÄÄÄÄÄÄÄ> 5-7: povel: 00=rotace v automat. EOI-nulov n¡
                                       20=nespecifikovanì EOI
         ³ ³ ³                         40=§ dn  operace
         ³ ³ À>1=automat. m¢d EOI      60=EOI pro zadanou £roveå (0-7)
         ³ ÀÄÄ>1=specifik. £roveå 0-7  80=rotace v automat. EOI-nastaven¡
         ÀÄÄÄÄ>1=povel se tìk  rotace  A0=rotace v nespecifik. m¢du EOI
                                       C0=nastaven¡ priority (0-7)
                                       E0=rotace ve specif. m¢du EOI (0-7)





Porty 00A0H - 00BFH: ıadiŸ pıeruçen¡ #2 8259A
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

00A0H - z pis: vysl n¡ bajtu 20H - signalizace konce pıeruçen¡ IRQ 8-15
00A1H - z pis/Ÿten¡: maskov n¡  pıeruçen¡  (bit  0  a§  7  = 0 --> povolen¡
                     pıeruçen¡ pro vstupy IRQ 8-15)


Hardwarov   pıeruçen¡:

    po§adavky pıeruçen¡ ıadiŸe pıeruçen¡ #1:

IRQ 0    - syst‚mov‚ hodiny (pıeruçen¡ 18.2 kr t za sekundu) (INT 08H)
IRQ 1    - pıeruçen¡ od kl vesnice (INT 09H)
IRQ 2    - zpØtnì bØh EGA, kask dn¡ po§adavek pıeruçen¡ AT od #2 (INT 0AH)
IRQ 3    - pıeruçen¡ od s‚riov‚ho portu COM2 (INT 0BH)
IRQ 4    - pıeruçen¡ od s‚riov‚ho portu COM1 (INT 0CH)
IRQ 5    - tisk rna LPT2, ıadiŸ pevn‚ho disku XT (INT 0DH)
IRQ 6    - ıadiŸ pru§nìch disk… (INT 0EH)
IRQ 7    - tisk rna LPT1 (INT 0FH)

            (n sleduj¡c¡   pıeruçen¡   jsou  kask dnØ  pıipojena  k  ıadiŸi
            pıeruçen¡ #1 pıes po§adavek IRQ 2)

IRQ 8    - CMOS ŸasovaŸ (1024 kr t za sekundu) (INT 70H)
IRQ 9    - (INT 71H)
IRQ 10   - (INT 72H)
IRQ 11   - (INT 73H)
IRQ 12   - (INT 74H)
IRQ 13   - pıeruçen¡ koprocesory 80287 a 80387 pıi chybØ (INT 02H, INT 75H)
IRQ 14   - ıadiŸ pevn‚ho disku AT (INT 76H)
IRQ 15   - (INT 77H)


    Nemaskovateln‚ pıeruçen¡ NMI (INT 02H) nelze maskovat pı¡mo v porcesoru
pomoc¡  instrukce  pro  z kaz  pıeruçen¡. Proto je umo§nØno v poŸ¡taŸ¡ch PC
maskovat  toto  pıeruçen¡  hardwarovØ  (pıeruçen¡  NMI  je  v poŸ¡taŸ¡ch PC
generov no pıi vzniku chyby parity pamØti a pıi vzniku chyby v matematick‚m
koprocesoru).  U  poŸ¡taŸ…  PC/XT  se  povol¡  pıeruçen¡  vysl n¡m  bajtu s
nastavenìm  7.bitem  (=80H)  na  port  00A0H.  Vysl n¡m bajtu s vynulovanìm
7.bitem  (=00H)  se pıeruçen¡ NMI zak §e. U poŸ¡taŸe AT se povol¡ pıeruçen¡
vysl n¡m  bajtu s vynulovanìm 7.bitem (=00) na port 0070H. Vysl n¡m bajtu s
nastavenìm  7.bitem  (=80H hodnoty jsou tedy obr cenØ ne§ u poŸ¡taŸ… PC/XT)
se pıeruçen¡ NMI zak §e (viz t‚§ pamØœ CMOS - maskov n¡ NMI).





                         ÿ3ÿ.ÿ-  ÿüÿaÿdÿiÿŸ  ÿDÿMÿA


    DMA  (pı¡mì  pı¡stup do pamØti) je zp…sob pıenosu dat mezi pamØt¡ a I/O
zaı¡zen¡m  bez  £Ÿasti  procesoru.  Tento  zp…sob  pıenosu  se pou§¡v  pıi
po§adavku  rychl‚ho  pıenosu velk‚ho mno§stv¡ dat, jako je napı. pıenos dat
mezi pamØt¡ a disketovou jednotkou nebo pevnìm diskem.

    P…vodn¡  PC  podporoval  Ÿtyıi  8-bitov‚  kan ly  DMA,  pıes  20-bitovì
adresovì prostor, s pou§it¡m ıadiŸe DMA Intel 8237A.

   ÉÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
   ºkan l DMA³               pou§it¡ v PC a XT                º
   ÌÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
   º   0     ³      obŸerstvov n¡ pamØti (nejvyçç¡ priorita)  º
   º   1     ³      nepou§it                                  º
   º   2     ³      adapt‚r disketov‚ jednotky                º
   º   3     ³      adapt‚r pevn‚ho disku (nejni§ç¡ priorita) º
   ÈÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Syst‚m  DMA poŸ¡taŸ… AT je zalo§en pro zvìçen¡ kompatibility na syst‚mu
DMA  poŸ¡taŸ…  PC a XT. Ke Ÿtyıem 8-bitovìm kan l…m DMA poŸ¡taŸ… PC pıid v 
AT  druhì  ıadiŸ  DMA  8237A-5, kterì podporuje kan ly 4-7 (Ÿtyıi 16-bitov‚
kan ly).

   ÉÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
   ºkan l DMA³               pou§it¡ v AT                     º
   ÌÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹ÄÄÄÄÄÄÄÄÄÄ¿
   º   0     ³      volnì                                     º          ³
   º   1     ³      ı¡zen¡ synchronn¡ datov‚ linky SDLC       º 8-bitov‚ ³
   º   2     ³      adapt‚r disketov‚ jednotky                º  kan ly  ³
   º   3     ³      adapt‚r pevn‚ho disku                     º          ³
   ÌÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹ÄÄÄÄÄÄÄÄÄÄ´
   º   4     ³      (ıadiŸ 2) kask da pro ıadiŸ 1             º          ³
   º   5     ³      volnì                                     º 16-bitov‚³
   º   6     ³      volnì                                     º  kan ly  ³
   º   7     ³      volnì                                     º          ³
   ÈÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼ÄÄÄÄÄÄÄÄÄÄÙ



Porty 0000H - 0007H: b zov‚ adresy DMA a offsetov‚ registry
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Vçechny  registry jsou 16-bitov‚. Nejdı¡ve se Ÿte/zapisuje ni§ç¡ bajt a
potom  na  stejn‚  adrese  portu  vyçç¡ bajt (viz t‚§ port 000CH - nulov n¡
klopn‚ho  obvodu ukazatele bajt…). B zov‚ adresy jsou offsetov ny v str nce
DMA.

0000H - z pis: b zov  adresa kan lu 0 DMA (t‚§ nastav¡ souŸasnou adresu)
        Ÿten¡: souŸasn  adresa kan lu 0 DMA          (obŸerstvov n¡)
0001H - z pis: b zov  adresa a Ÿ¡taŸ slov kan lu 0 DMA     "
        Ÿten¡: souŸasnì stav Ÿ¡taŸe slov kan lu 0 DMA      "
0002H - z pis: b zov  adresa kan lu 1 DMA
        Ÿten¡: souŸasn  adresa kan lu 1 DMA
0003H - z pis: b zov  adresa a Ÿ¡taŸ slov kan lu 1 DMA
        Ÿten¡: souŸasnì stav Ÿ¡taŸe slov kan lu 1 DMA
0004H - z pis: b zov  adresa kan lu 2 DMA            (disketov  jednotka)
        Ÿten¡: souŸasn  adresa kan lu 2 DMA                "
0005H - z pis: b zov  adresa a Ÿ¡taŸ slov kan lu 2 DMA     "
        Ÿten¡: souŸasnì stav Ÿ¡taŸe slov kan lu 2 DMA      "
0006H - z pis: b zov  adresa kan lu 3 DMA            (pevnì disk)
        Ÿten¡: souŸasn  adresa kan lu 3 DMA                "
0007H - z pis: b zov  adresa a Ÿ¡taŸ slov kan lu 3 DMA     "
        Ÿten¡: souŸasnì stav Ÿ¡taŸe slov kan lu 3 DMA      "



Porty 00C0H - 00CFH: b zov‚ registry 16-bitov‚ho DMA
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Kan ly  0-3  pıenosu  DMA  pracuj¡ s 8-bitovìm pıenosem dat (standardn¡
PC).  U  poŸ¡taŸ…  AT jsou doplnØny kan ly 4-7 podporuj¡c¡ 16-bitovì pıenos
dat.  Pıenos pro tyto kan ly zaŸ¡n  v§dy na hranici slov a vçechny adresy a
Ÿ¡taŸe  pracuj¡  pro 16-bitov  slova (napı. b zov  adresa 0123H se aktu lnØ
vztahuje na offset 0246H od zaŸ tku str nky v pı¡sluçn‚m kan lu).

00C0H - z pis: b zov  a souŸasn  adresa kan lu 4 DMA (bity 1-16; bit0=0)
        Ÿten¡: souŸasn  adresa kan lu 4 DMA
00C2H - z pis: Ÿ¡taŸ slov kan lu 4 DMA
        Ÿten¡: souŸasnì stav Ÿ¡taŸe slov kan lu 4 DMA
00C4H - z pis: b zov  a souŸasn  adresa kan lu 5 DMA (bity 1-16; bit0=0)
        Ÿten¡: souŸasn  adresa kan lu 5 DMA
00C6H - z pis: Ÿ¡taŸ slov kan lu 5 DMA
        Ÿten¡: souŸasnì stav Ÿ¡taŸe slov kan lu 5 DMA
00C8H - z pis: b zov  a souŸasn  adresa kan lu 6 DMA (bity 1-16; bit0=0)
        Ÿten¡: souŸasn  adresa kan lu 6 DMA
00CAH - z pis: Ÿ¡taŸ slov kan lu 6 DMA
        Ÿten¡: souŸasnì stav Ÿ¡taŸe slov kan lu 6 DMA
00CCH - z pis: b zov  a souŸasn  adresa kan lu 7 DMA (bity 1-16; bit0=0)
        Ÿten¡: souŸasn  adresa kan lu 7 DMA
00CEH - z pis: Ÿ¡taŸ slov kan lu 7 DMA
        Ÿten¡: souŸasnì stav Ÿ¡taŸe slov kan lu 7 DMA



Porty 0008H - 000FH: ı¡zen¡ DMA/stavov‚ registry
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0008H - z pis: povelovì registr DMA

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=mo§nì pıenos DMA pamØœ-pamØœ (kan. 0<-->1)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=mo§n‚ dr§en¡ adresy kan lu 0
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=blokov n¡ ıadiŸe
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=volba kompresn¡ho Ÿasovac¡ho m¢du
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=mo§n  rotuj¡c¡ priorita
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=volba rozç¡ıen‚ho z pisov‚ho m¢du;0=pozdn¡
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=aktivn¡ £roveå DRQ high; 0=low
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=aktivn¡ £roveå DACK high; 0=low

      - Ÿten¡: stavovì registr DMA

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ÀÄÁÂÁÄÙ ÀÄÁÄÁÄÁÄ> 0-3: kan l 0-3 ukonŸil Ÿ¡t n¡
            ÀÄÄÄÄÄÄÄÄÄÄÄÄ> 4-7: kan l 0-3 po§aduje obsluhu

0009H - z pis: registr po§adavku

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                   ³ ÀÄÁÄ> 0-1: vìbØr kan lu 0-3 (00=0; 01=1; 10=2; 11=3)
                   ÀÄÄÄÄÄ>  2:  1=nastaven bit po§adavku kan lu; 0=resetov.

000AH - z pis: registr maskovac¡ho bitu

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                   ³ ÀÄÁÄ> 0-1: vìbØr kan lu 0-3 (00=0; 01=1; 10=2; 11=3)
                   ÀÄÄÄÄÄ>  2:  1=nastaven maskovac¡ bit kan lu; 0=resetov.

000BH - z pis: registr m¢du

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: volba kan lu 0-3 (00=0; 01=1; 10=2; 11=3)
         ³ ³ ³ ³ ÀÄÁÄÄÄÄÄ> 2-3: typ pıenosu (00=verif.; 01=z pis; 10=Ÿten¡)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=mo§n  automatick  inicializace
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=inkrementace adresy; 0=dekrement. adresy
         ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6-7: 00=m¢d po§adavku; 01=jednoduchì m¢d;
                                10=blokovì pıenos; 11=kask dn¡ m¢d

000CH - z pis: Vynulov n¡  klopn‚ho obvodu ukazatele bajt…. Jakìkoliv z pis
               na  tuto adresu vynuluje klopnì obvod ukazatele bajt…, tak§e
               pıi   pı¡çt¡m   z pisu  nØkter‚ho  16-bitov‚ho  registru  je
               zapisovanì  bajt dek¢dov n jako ni§ç¡ bajt. N sleduj¡c¡ bajt
               je vyçç¡ bajt (pak opØt ni§ç¡ atd.).

000DH - z pis: celkov‚ nulov n¡-jakìkoliv z pis na port nuluje ı¡zen¡ (mus¡
               bìt znovu zinicializov no)
      - Ÿten¡: pomocnì registr - posledn¡ bajt pıi pıenosu pamØœ-pamØœ

000EH - z pis: vynulov n¡  maskovac¡ho  registru  - jakìkoliv z pis na port
               uvoln¡ vçechny 4 kan ly

000FH - z pis: maskov n¡  kan l…  -  ma§e nebo maskuje nØkterì nebo vçechny
               kan ly

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ÀÄ> 0: 1=maska kan lu 0; (0=uvolnØnì; 1=blokovanì)
                 ³ ³ ÀÄÄÄ> 1: 1=maska kan lu 1; (0=uvolnØnì; 1=blokovanì)
                 ³ ÀÄÄÄÄÄ> 2: 1=maska kan lu 2; (0=uvolnØnì; 1=blokovanì)
                 ÀÄÄÄÄÄÄÄ> 3: 1=maska kan lu 3; (0=uvolnØnì; 1=blokovanì)

      - Ÿten¡: podp…rnì registr - posledn¡ bajt pıi pıenosu pamØœ-pamØœ



Porty 00D0H - 00DFH: ı¡zen¡ DMA/stavov‚ registry pro 16-bitovì DMA
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

00D0H - z pis: povelovì registr DMA

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=mo§nì pıenos DMA pamØœ-pamØœ (kan. 4<-->5)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=mo§n‚ dr§en¡ adresy kan lu 4
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=blokov n¡ ıadiŸe
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=volba kompresn¡ho Ÿasovac¡ho m¢du
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=mo§n  rotuj¡c¡ priorita
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=volba rozç¡ıen‚ho z pisov‚ho m¢du;0=pozdn¡
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=aktivn¡ £roveå DRQ high; 0=low
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=aktivn¡ £roveå DACK high; 0=low

      - Ÿten¡: stavovì registr DMA

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ÀÄÁÂÁÄÙ ÀÄÁÄÁÄÁÄ> 0-3: kan l 4-7 ukonŸil Ÿ¡t n¡
            ÀÄÄÄÄÄÄÄÄÄÄÄÄ> 4-7: kan l 4-7 po§aduje obsluhu

00D2H - z pis: registr po§adavku

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                   ³ ÀÄÁÄ> 0-1: vìbØr kan lu 4-7 (00=4; 01=5; 10=6; 11=7)
                   ÀÄÄÄÄÄ>  2:  1=nastaven bit po§adavku kan lu; 0=resetov.

00D4H - z pis: registr maskovac¡ho bitu

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                   ³ ÀÄÁÄ> 0-1: vìbØr kan lu 4-7 (00=4; 01=5; 10=6; 11=7)
                   ÀÄÄÄÄÄ>  2:  1=nastaven maskovac¡ bit kan lu; 0=resetov.

00D6H - z pis: registr m¢du

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: volba kan lu 4-7 (00=4; 01=5; 10=6; 11=7)
         ³ ³ ³ ³ ÀÄÁÄÄÄÄÄ> 2-3: typ pıenosu (00=verif.; 01=z pis; 10=Ÿten¡)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=mo§n  automatick  inicializace
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=inkrementace adresy; 0=dekrement. adresy
         ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6-7: 00=m¢d po§adavku; 01=jednoduchì m¢d;
                                10=blokovì pıenos; 11=kask dn¡ m¢d

00D8H - z pis: Vynulov n¡  klopn‚ho obvodu ukazatele bajt…. Jakìkoliv z pis
               na  tuto adresu vynuluje klopnì obvod ukazatele bajt…, tak§e
               pıi   pı¡çt¡m   z pisu  nØkter‚ho  16-bitov‚ho  registru  je
               zapisovanì  bajt dek¢dov n jako ni§ç¡ bajt. N sleduj¡c¡ bajt
               je vyçç¡ bajt (pak opØt ni§ç¡ atd.).

00DAH - z pis: celkov‚ nulov n¡-jakìkoliv z pis na port nuluje ı¡zen¡ (mus¡
               bìt znovu zinicializov no)
      - Ÿten¡: pomocnì registr - posledn¡ bajt pıi pıenosu pamØœ-pamØœ

00DCH - z pis: vynulov n¡  maskovac¡ho  registru  - jakìkoliv z pis na port
               uvoln¡ vçechny 4 kan ly 4 a§ 7

00DEH - z pis: maskov n¡  kan l…  -  ma§e nebo maskuje nØkterì nebo vçechny
               kan ly

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÄÁÄÁÄÁÄÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ÀÄ> 0: 1=maska kan lu 4; (0=uvolnØnì; 1=blokovanì)
                 ³ ³ ÀÄÄÄ> 1: 1=maska kan lu 5; (0=uvolnØnì; 1=blokovanì)
                 ³ ÀÄÄÄÄÄ> 2: 1=maska kan lu 6; (0=uvolnØnì; 1=blokovanì)
                 ÀÄÄÄÄÄÄÄ> 3: 1=maska kan lu 7; (0=uvolnØnì; 1=blokovanì)

      - Ÿten¡: podp…rnì registr - posledn¡ bajt pıi pıenosu pamØœ-pamØœ


Porty 0080H - 008FH: str nkov‚ registry DMA 74LS612
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Chcete-li nastavit poŸ teŸn¡ adresu operac¡ DMA, vyberte nejdı¡ve kan l
t¡m,  §e  provedete instrukci OUT (hodnota 00H a§ 0FH) na str nkovì registr
(porty  0081H  -  0083H)  a  potom  nastav¡te b zovou adresu (porty 0000H -
0007H) pro pı¡sluçnì kan l. Str nkovì registr se nastav¡ 4-bitovou hodnotou
reprezentuj¡c¡ bity 16-19 20-bitov‚ adresy DMA. Proto§e bØ§n  adresa Ÿ¡taŸe
DMA  je  16-bitov   hodnota,  nen¡  mo§n‚  prov dØt  pomoc¡ DMA pıenos pıes
hranice 64K (tj. adresy 1000:0000, 2000:0000 atd.).

0081H - str nkovì registr kan lu 2 - adresov‚ bity 16-19 (disketovì DMA)
0082H - str nkovì registr kan lu 3 - adresov‚ bity 16-19 (pevnì disk)
0083H - str nkovì registr kan lu 1 - adresov‚ bity 16-19

    PoŸ¡taŸe  AT  pou§¡vaj¡  pro  nastaven¡  adresy  str nky  vçech  8 bit…
str nkov‚ho registru. Je to z toho d…vodu, §e AT pou§¡v  24-bitovì adresovì
prostor.  Spodn¡ch  16  bit…  je nastaveno v adresov‚m registru kan lu DMA,
vyçç¡ch 8 bit… je pou§ito ze str nkov‚ho registru. Velikost str nek je 128K
(tj  64K  slov),  tak§e  pıenosy  DMA nesmØj¡ pıekraŸovat hranici 128K (tj.
adresy 2000:0, 4000:0 atd.).

0081H - str nkovì registr kan lu 2 - adresov‚ bity 16-23 (disketovì DMA)
0082H - str nkovì registr kan lu 3 - adresov‚ bity 16-23 (pevnì disk)
0083H - str nkovì registr kan lu 1 - adresov‚ bity 16-23 (SDLC)
0087H - str nkovì registr kan lu 0 - adresov‚ bity 16-23
0089H - str nkovì registr kan lu 6 - adresov‚ bity 17-23
008BH - str nkovì registr kan lu 5 - adresov‚ bity 17-23
008AH - str nkovì registr kan lu 7 - adresov‚ bity 17-23
008FH - refresh

    Str nkovì  registr  na  adrese  0080H m  u poŸ¡taŸe AT zvl çtn¡ funkci.
SLou§¡   jako   diagnostickì  bod  a  jsou  do  nØj  stı d ny  chyby  bØhem
inizializaŸn¡ho testu POST.


                          ÿ4ÿ.ÿ-  ÿ¬ÿaÿsÿoÿvÿaÿŸ

Porty 0040H - 005FH: ŸasovaŸ 8253-5 (AT: 8254.2)
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    ¬asovaŸ  pou§¡v   sv…j  vlastn¡  krystal o kmitoŸtu 14.31818 MHz, jeho§
kmitoŸet  po  vydØlen¡  pıeddØliŸkou  (dØl¡c¡  v  pomØru  1:12) na kmitoŸet
1.193182úMHz  slou§¡  jako  zdroj  hodinovìch impuls… ŸasovaŸe (vstup CLK).
Funkce  8254.2  u  AT  se liç¡ oproti 8253 pıedevç¡m vØtç¡m poŸtem pı¡kaz…,
kter‚  umo§åuj¡  snadnØjç¡  zapamatov n¡ stavu Ÿ¡taŸe bØhem Ÿ¡t n¡ a zpØtn‚
Ÿten¡.

0040H -  z pis: nastaven¡ Ÿ¡taŸe 0
         Ÿten¡: stav Ÿ¡taŸe 0

          Vìstup  z  Ÿ¡taŸe 0 je pıiveden na vstup IRQ 0 ıadiŸe pıeruçen¡ a
pou§¡v  se jako zdroj impuls… pro syst‚mov‚ hodiny (dØl¡c¡ pomØr 65279).

0041H -  z pis: nastaven¡ Ÿ¡taŸe 1
         Ÿten¡: stav Ÿ¡taŸe 1

          ¬¡taŸ  1  slou§¡  ke generov n¡ sign lu REFRESH pro obŸerstvov n¡
         pamØti (dØl¡c¡ pomØr 4866).

0042H -  z pis: nastaven¡ Ÿ¡taŸe 2
         Ÿten¡: stav Ÿ¡taŸe 2

          Vìstup z Ÿ¡taŸe 2 je pou§it jako vìstup na vestavØnì reproduktor.
         Vìstup  na  reproduktor se aktivuje pomoc¡ portu 0061H (bity 0 a 1
         mus¡ bìt nastaveny na 1).

              mov       bx,330         ; VSTUP - frekvence uveden  v Hz
              mov       cx,40000       ; VSTUP - prodleva (pomocnì £daj)
              mov       al,0b6h        ; povel pro nastaven¡ kan lu 2
              out       [43h],al       ; nastaven¡ povelu
              mov       dx,12h         ; vyçç¡ slovo konstanty
              mov       ax,34deh       ; ni§ç¡ slovo konstanty
              div       bx             ; vìpoŸet dØl¡c¡ho pomØru
              out       [42h],al       ; nastaven¡ ni§ç¡ho bajtu dØliŸky
              mov       al,ah          ; vyçç¡ bajt dØliŸky
              out       [42h],al       ; nastaven¡ vyçç¡ho bajtu dØliŸky
              in        al,[61h]       ; souŸasn‚ nastaven¡ portu 61h
              or        al,3           ; nastaven¡ bit… pro reproduktor
              out       [61h],al       ; zapnut¡ zvukov‚ho vìstupu
              loop      $              ; prodleva
              and       al,0fch        ; vynulov n¡ ovl dac¡ch bit…
              out       [61h],al       ; vypnut¡ zvukov‚ho vìstupu

0043H -  z pis: volba m¢du Ÿ¡taŸe (Ÿten¡ registru u 8253 nen¡ mo§n‚)

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=Ÿ¡t  v k¢du BCD, 0=Ÿ¡t  v bin rn¡m k¢du
         ³ ³ ³ ³ ÀÄÁÄÁÄÄÄ> 1-3: m¢d Ÿ¡taŸe:  000 - m¢d 0     (pıi pr ci
         ³ ³ ³ ³                             001 - m¢d 1      s pomocnìm
         ³ ³ ³ ³                             x10 - m¢d 2      registrem
         ³ ³ ³ ³                             x11 - m¢d 3      jsou tyto
         ³ ³ ³ ³                             100 - m¢d 4        bity
         ³ ³ ³ ³                             101 - m¢d 5      bezvìznamn‚)
         ³ ³ ÀÄÁÄÄÄÄÄÄÄÄÄ> 4-5: 00 - operace   s  pomocnìm  registrem  (pıi
         ³ ³                         Ÿten¡  stavu  Ÿ¡taŸe  se okam§itì stav
         ³ ³                         Ÿ¡taŸe  uschov v  v pomocn‚m registru,
         ³ ³                         aby   jej   bylo   mo§no  pıeŸ¡st  bez
         ³ ³                         zastaven¡ Ÿ¡taŸe)
         ³ ³                    01 - Ÿten¡/z pis jen ni§ç¡ slabiky dØliŸe
         ³ ³                    10 - Ÿten¡/z pis jen vyçç¡ slabiky dØliŸe
         ³ ³                    11 - Ÿten¡/z pis ni§ç¡ a potom vyçç¡ slab.
         ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6,7: volba Ÿ¡taŸe: (0 a§ 2, 3=neplatnì k¢d)

         MàD 0 - pıeruçen¡  na  konci  Ÿ¡t n¡:  Vìstup  OUT  Ÿ¡taŸe  se  po
                 ukonŸen¡  Ÿ¡t n¡  pıeklop¡  z  hodnoty L na £roveå H a§ do
                 doby  nov‚ho  nastaven¡.  Pıi  z pisu  pıedvolby v pr…bØhy
                 Ÿ¡t n¡ se po z pisu 1. slabiky prob¡haj¡c¡ Ÿ¡t n¡ zastav¡,
                 po z pisu 2. slabiky se odstartuje nov‚ Ÿ¡t n¡. Vstup GATE
                 (pouze u Ÿ¡taŸe 2 - bit 0 portu 61h) povoluje Ÿ¡t n¡ pouze
                 pokud je na £rovni H.
         MàD 1 - monostabiln¡ gener tor: Vzestupn  hrana vstupu GATE spust¡
                 vìstupn¡  impuls - vìstup OUT pıejde na £roveå L a z…stane
                 v n¡ po dobu nastavenou pıedvolbou. Po t‚to dobØ se vìstup
                 navr t¡  zpØt  na  £roveå  H.  Jestli§e byla bØhem impulsu
                 vlo§ena nov  pıedvolba, d‚lka impulsu se nezmØn¡ (zmØn¡ se
                 a§ n sleduj¡c¡ impuls). Pr…bØ§nì stav Ÿ¡taŸe m…§e bìt Ÿten
                 kdykoliv,  ani§ by to ovlivnilo generov n¡ impulsu. Impuls
                 je mo§n‚ znovu spouçtØt i v dobØ jeho trv n¡.
         MàD 2 - dØlen¡  frekvence:  Vìstup  OUT  bude  na £rovni L po dobu
                 jedn‚   periody   hodinov‚ho   impulsu  CLK,  rozteŸ  mezi
                 vìstupn¡mi  impulsy  odpov¡d   dobØ  nastaven‚  pıedvolbou
                 Ÿ¡taŸe  (vìstupn¡  kmitoŸet  OUT  je tedy N-kr t menç¡ ne§
                 hodinovì kmitoŸet CLK). Jestli§e byl obsah registru Ÿ¡taŸe
                 zmØnØn mezi dvØmi vìstupn¡mi impulsy, prob¡haj¡c¡ vìstupn¡
                 perioda  se nezmØn¡. Vstup GATE an £rovni L pıevede OUT na
                 £roveå  H.  Vzestupn  hrana GATE zah j¡ Ÿ¡t n¡ z poŸ teŸn¡
                 hodnoty  (lze  vyu§¡t  k  synchronizaci Ÿ¡taŸe). Vìstup je
                 tak‚  neaktivn¡  (tj. na £rovni H) po dobu plnØn¡ registru
                 Ÿ¡taŸe pıedvolbou.
         MàD 3 - generov n¡  obd‚ln¡kovìch  pr…bØh…:  M¢d  3 je stejnì jako
                 m¢dú2  s  t¡m  rozd¡lem, §e vìstup OUT bude na £rovni L po
                 polovinu  doby  a na £rovni H po druhou polovinu doby. Pro
                 lich‚ Ÿ¡slo N (pıedvolba) bude OUT o 1 takt d‚le na £rovni
                 H.  Nov  hodnota dØliŸe se uplatn¡ ji§ pıi dalç¡m p…ltaktu
                 vìstupu OUT.
         MàD 4 - strobov n¡ ovl dan‚ programem: Po nastaven¡ m¢du je OUT=H,
                 po  zaveden¡  pıedvolby  zaŸne  Ÿ¡tat,  po doŸ¡t n¡ pıejde
                 vìstup  OUT  po dobu jedn‚ periody CLK na £roveå L a vr t¡
                 se zpØt na £roveå H. Vstup GATE=L zastav¡ Ÿ¡t n¡.
         MàD 5 - strobov n¡   ol dan‚  obvodovØ:  ¬¡taŸ  zah j¡  Ÿ¡t n¡  po
                 vzestupn‚  hranØ  vstupu  GATE  (tj.  pıechod L -> H) a po
                 doŸ¡t n¡  pıejde  vìstup  OUT po dobu jedn‚ periody CLK na
                 £roveå  L.  Nov   vzestupn   hrana  GATE  zah j¡ Ÿ¡t n¡ od
                 poŸ teŸn¡ hodnoty i bØhem Ÿ¡t n¡.

Pozn.: Z pis  hodnoty  0  jako  Ÿasovac¡  konstanta  odpov¡d   hodnotØ  216
       vúbin rn¡m nebo 104 v BCD k¢du.




                       ÿ5ÿ.ÿ-  ÿKÿlÿ ÿvÿeÿsÿnÿiÿcÿe


Porty 0060H - 006FH: ıadiŸ kl vesnice 8042
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0060H - (program. perifern¡ interface - kan l A) datovì registr kl vesnice
      - Ÿten¡: k¢d kl vesy z kl vesnice (rozçiıuj¡c¡ k¢d kl vesy)

         IN AL,60H           ; Ÿten¡ k¢du kl vesy

        Viz  t‚§  pıeruçen¡  INT  09H  (pıeruçen¡ kl vesnic¡). Pıeruçen¡ je
        vyvol no  hardwarovØ  sign lem  IRQ 1 a je vyvol no v§dy pıi stisku
        nebo pıi uvolnØn¡ kter‚koliv kl vesy, resp. pıi jej¡m dr§en¡.

0061H - (programovatelnì perifern¡ interface PPI - kan l B)
      - z pis: ovl d n¡ reproduktoru, kl vesnice a kontroly pamØti a I/O

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: hradlov n¡ ŸasovaŸe 2 (reproduktor)Ä¿  1=zap
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: kl¡Ÿov n¡ vìstupu na reproduktor ÄÄÄÁÄ 0=vyp
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: v§dy = 0
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=Ÿten¡ horn¡ch pıep¡naŸ…; 0=doln¡ (viz 62H)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 0=mo§n  kontrola parity RAM; 1=z kaz kontr.
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 0=mo§n  kontrola kan lu I/O
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 0=ponech n¡ hodin kl vesnice dole
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 0=povolen  kl vesnice; 1=blokovan  kl vesnice

         Pozn.: data OR  03H ---> zapnut¡ reproduktoru
                data AND FCH ---> vypnut¡ reproduktoru

0062H - (programovatelnì perifern¡ interface PPI - kan l C)
      - Ÿten¡: Ÿten¡ pıep¡naŸ… DIL, ŸasovaŸe, stavu kontrol pamØti a I/O

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: hodnota pıep¡naŸ… DIL (viz vìpis vybaven¡)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4: v§dy = 0
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5: 1=vìstup kan lu ŸasovaŸe 2
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6: 1=kontrola kan lu I/O
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7: 1=vyskytla se chyba kontroly parity RAM

0063H - (ı¡d¡c¡ registr m¢du programovateln‚ho perifern¡ho interface PPI) -
        tento  registr  nastavuje,  kterì  port  PPI  je  vstupn¡  a  kterì
        vìstupn¡. BIOS zde nastav¡ hodnotu 99H (porty A a C jsou vstupn¡, B
        je vìstupn¡).

0064H - povelovì registr kl vesnice AT (pouze pro AT !)
      - tento  port komunikuje s 8042, kterì spouçt¡ ı¡d¡c¡ program on-chip
        pro obsluhu kl vesnice. Pıij¡m  k¢dy povel… a datov‚ bajty.


    Kl vesnice   AT  (a  jej¡  mikropoŸ¡taŸovì  interface  Intel  8042)  je
programovateln   a  je  mnohem  zaj¡mavØjç¡  ne§  kl vesnice  PC ve "star‚m
stylu".  S  pou§it¡m  n sleduj¡c¡ch  informac¡  m…§ete  nastavovat rychlost
opakov n¡ kl vesy a hr t hry s pou§it¡m indik tor… LED na kl vesnici.

    Port  60H  je  urŸen  pro z pis dat a je podporov n pro kompatibilitu s
dı¡vØjç¡my  modely.  Pokud  pı¡klad  pou§¡vaj¡c¡  port 64H nebude pracovat,
zkuste pou§¡t port 60H.

    Port  64H je urŸen pro z pis povel… a dat a pro Ÿten¡ stavu kl vesnice.
Pıed  vysl n¡m  povelu  na  kl vesnici testuje BIOS jej¡ stav (IN AL,64H) a
ubezpeŸuje  se, §e nen¡ stisknuta § dn  kl vesa nebo §e vnitın¡ buffer nen¡
plnì atd. Je v tom malì risk, pokud jdete pı¡mo a vyçlete povel:

         mov       al,kod_cmd               ; Ÿ¡slo povelu pro kl vesnici
         out       64h,al                   ; vysl n¡ povelu



    Pro dvoud¡ln‚ povely, jako napı. nastaven¡ rychlosti opakov n¡ kl vesy,
je rozumn‚ zaıadit mezi jednotliv‚ vìstupy malou prodlevu:

         mov       al,kod_cmd               ; Ÿ¡slo povelu pro kl vesnici
         out       64h,al                   ; vysl n¡ povelu
         mov       cx,2000h                 ; prodleva asi 10ms
prodl:   loop      prodl                    ; prodleva mezi vìstupy OUT
         mov       al,hodnota_dat           ; druh  Ÿ st povelu pro kl v.
         out       64h,al                   ; vysl n¡ druh‚ Ÿ sti povelu

Povely pro ovl d n¡ kl vesnice AT (vyçle se na port 64H):
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0FFH - reset kl vesnice a start vnitın¡ diagnostiky
0FEH - opakovan‚ vysl n¡ posledn¡ho pıenosu
0FDH - 0F7H - § dn  funkce (NOP)
0F6H - nastaven¡ kl vesnice na standardn¡ hodnoty a pokraŸov n¡ v testov n¡
0F5H - nastaven¡ kl vesnice na stand. hodnoty a z kaz testov n¡ kl vesnice
0F4H - uvolnØn¡  kl vesnice.  Kl vesnice  vyçle  'ACK' (potvrzen¡), vyŸist¡
       buffer a zaŸne testov n¡ kl ves
0F3H - nastaven¡  rychlosti  generov n¡  znak… a prodlevy. Nejdı¡ve vyçlete
       bajt 0F3H (tento pı¡kaz) a potom datovì bajt:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ÀÄÁÄÁÄÁÄÁÄ> 0-4: nastaven¡ rychlosti opakov n¡ znaku
         ³ ÀÄÁÄÄÄÄÄÄÄÄÄÄÄ> 5-6: nastaven¡ inicial. prodlevy pıed opakov n¡m
         ³                      00=250ms; 01=500ms; 10=750ms; 11=1000ms
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  je v§dy nastaven na 0


    Rychlosti generov n¡ znak… ve znac¡ch za sekundu (bity 0-4):
ÉÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º hodnota ³  rychlost   º hodnota ³  rychlost   º hodnota ³  rychlost   º
ÌÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÎÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÎÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º   00H   ³    30.0     º   0BH   ³   10.9      º   16H   ³    4.3      º
º   01H   ³    26.7     º   0CH   ³   10.0      º   17H   ³    4.0      º
º   02H   ³    24.0     º   0DH   ³    9.2      º   18H   ³    3.7      º
º   03H   ³    21.8     º   0EH   ³    8.6      º   19H   ³    3.3      º
º   04H   ³    20.0     º   0FH   ³    8.0      º   1AH   ³    3.0      º
º   05H   ³    18.5     º   10H   ³    7.5      º   1BH   ³    2.7      º
º   06H   ³    17.1     º   11H   ³    6.7      º   1CH   ³    2.5      º
º   07H   ³    16.0     º   12H   ³    6.0      º   1DH   ³    2.3      º
º   08H   ³    15.0     º   13H   ³    5.5      º   1EH   ³    2.1      º
º   09H   ³    13.3     º   14H   ³    5.0      º   1FH   ³    2.0      º
º   0AH   ³    12.0     º   15H   ³    4.6      º         ³             º
ÈÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Kl vesnice  je pıi inicializaci nastavena na inicializaŸn¡ prodlevu 1/2
sekundy  (tj.  za p…l sekundy po stisku kl vesy se zaŸnou generovat znaky s
automatickìm opakov n¡m) a rychlost opakov n¡ znak… (pıi dr§en¡ kl vesy) 10
znak… za sekundu. To je pı¡liç pomal‚. Datovì bajt 00H nastav¡ nejrychlejç¡
stav - prodleva 1/4 sekundy a rychlost opakov n¡ 30 znak… za sekundu.

0F2H - 0EFH - § dn  funkce (NOP)
0EEH - echo; diagnostick  podpora. Jednoduçe vyçle bajt 0EEH pı¡mo zpØt.
0EDH - nastaven¡  svØtelnìch indik tor… LED. Nejdı¡ve vyçlete povelovì bajt
       0EDH a potom vyçlete datovì bajt:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                   ³ ³ ÀÄ> 0: signalizace Scroll Lock (1=sv¡t¡; 0=nesv¡t¡)
                   ³ ÀÄÄÄ> 1: signalizace Num Lock (1=sv¡t¡; 0=nesv¡t¡)
                   ÀÄÄÄÄÄ> 2: signalizace Caps Lock (1=sv¡t¡; 0=nesv¡t¡)

    Bitov‚  pozice 0-2 koresponduj¡ s bity 4-6 bajtu pı¡znak… kl vesnice na
adrese  0:0417H (BIOS) a se Ÿten¡m stavu kl vesnice INT 16H/slu§ba 02H nebo
slu§ba  12H.  Pıi  nastavov n¡  indik tor… LED je potıeba myslet na to, aby
byly indik tory mØnØny souhlasnØ s nastaven¡m indik tor… v pamØti poŸ¡taŸe.
Napı.  pokud  chcete  nastavit  Ÿ¡selnou kl vesnici do Ÿ¡slen‚ho re§imu (tj
zapnut  m¢d  Num  Lock),  mus¡te nastavit bit 5 na adrese 0:0417H, ale tak‚
pı¡sluçnì indik tor LED (bit 1 zde popsan‚ho bajtu).

Pozn.: Pıi uvolnØn¡ kl vesy je vysl n z kl vesnice orientaŸn¡ k¢d kl vesy s
       nastavenìm 7.bitem k¢du.




    OrientaŸn¡ k¢dy kl ves - p…vodn¡ kl vesnice PC/XT (83 a 84 kl ves):

    ÉÍÍÍÍÍÂÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»   ÉÍÍÍÍÍÂÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
    º 01H ³  1 ³ Esc               º   º 2BH ³ 43 ³ \ |               º
    º 02H ³  2 ³ 1 !               º   º 2CH ³ 44 ³ Z                 º
    º 03H ³  3 ³ 2 @               º   º 2DH ³ 45 ³ X                 º
    º 04H ³  4 ³ 3 #               º   º 2EH ³ 46 ³ C                 º
    º 05H ³  5 ³ 4 $               º   º 2FH ³ 47 ³ V                 º
    º 06H ³  6 ³ 5 %               º   º 30H ³ 48 ³ B                 º
    º 07H ³  7 ³ 6 ^               º   º 31H ³ 49 ³ N                 º
    º 08H ³  8 ³ 7 &               º   º 32H ³ 50 ³ M                 º
    º 09H ³  9 ³ 8 *               º   º 33H ³ 51 ³ , <               º
    º 0AH ³ 10 ³ 9 (               º   º 34H ³ 52 ³ . >               º
    º 0BH ³ 11 ³ 0 )               º   º 35H ³ 53 ³ / ?               º
    º 0CH ³ 12 ³ - _               º   º 36H ³ 54 ³ pravì Shift       º
    º 0DH ³ 13 ³ + =               º   º 37H ³ 55 ³ Print Screen      º
    º 0EH ³ 14 ³ Back space        º   º 38H ³ 56 ³ Alt               º
    º 0FH ³ 15 ³ Tab               º   º 39H ³ 57 ³ mezern¡k          º
    º 10H ³ 16 ³ Q                 º   º 3AH ³ 58 ³ Caps Lock         º
    º 11H ³ 17 ³ W                 º   º 3BH ³ 59 ³ F1                º
    º 12H ³ 18 ³ E                 º   º 3CH ³ 60 ³ F2                º
    º 13H ³ 19 ³ R                 º   º 3DH ³ 61 ³ F3                º
    º 14H ³ 20 ³ T                 º   º 3EH ³ 62 ³ F4                º
    º 15H ³ 21 ³ Y                 º   º 3FH ³ 63 ³ F5                º
    º 16H ³ 22 ³ U                 º   º 40H ³ 64 ³ F6                º
    º 17H ³ 23 ³ I                 º   º 41H ³ 65 ³ F7                º
    º 18H ³ 24 ³ O                 º   º 42H ³ 66 ³ F8                º
    º 19H ³ 25 ³ P                 º   º 43H ³ 67 ³ F9                º
    º 1AH ³ 26 ³ [ {               º   º 44H ³ 68 ³ F10               º
    º 1BH ³ 27 ³ ] }               º   º 45H ³ 69 ³ Num Lock          º
    º 1CH ³ 28 ³ Enter             º   º 46H ³ 70 ³ Scroll Lock       º
    º 1DH ³ 29 ³ Ctrl              º   º 47H ³ 71 ³ Home          [7] º
    º 1EH ³ 30 ³ A                 º   º 48H ³ 72 ³ kurzor nahoru [8] º
    º 1FH ³ 31 ³ S                 º   º 49H ³ 73 ³ Page Up       [9] º
    º 20H ³ 32 ³ D                 º   º 4AH ³ 74 ³ - (v numer. poli) º
    º 21H ³ 33 ³ F                 º   º 4BH ³ 75 ³ kurzor vlevo  [4] º
    º 22H ³ 34 ³ G                 º   º 4CH ³ 76 ³               [5] º
    º 23H ³ 35 ³ H                 º   º 4DH ³ 77 ³ kurzor vpravo [6] º
    º 24H ³ 36 ³ J                 º   º 4EH ³ 78 ³ + (v numer. poli) º
    º 25H ³ 37 ³ K                 º   º 4FH ³ 79 ³ End           [1] º
    º 26H ³ 38 ³ L                 º   º 50H ³ 80 ³ kurzor dol…   [2] º
    º 27H ³ 39 ³ ; :               º   º 51H ³ 81 ³ Page Down     [3] º
    º 28H ³ 40 ³ " '               º   º 52H ³ 82 ³ Ins           [0] º
    º 29H ³ 41 ³ ` ~               º   º 53H ³ 83 ³ Del           [.] º
    º 2AH ³ 42 ³ levì Shift        º   º(54H)³(84)³(SysRq)            º
    ÈÍÍÍÍÍÁÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼   ÈÍÍÍÍÍÁÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Kl vesnice  AT  84  kl ves  se  odliçuje od p…vodn¡ kl vesnice PC/XT 83
kl ves pouze pıid n¡m kl vesy SysRq s k¢dem 54H (84).

    Kl vesnice  AT  101  kl ves  m  tıi oddØlen  mapov n¡ orientaŸn¡ch k¢d…
kl ves,  volen   pomoc¡ portu 64H. V z kladn¡ sadØ k¢d… se mØn¡ Ÿi doplåuj¡
tyto k¢dy:

    ÉÍÍÍÍÍÂÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
    º 37H ³ 55 ³ * (v numer. poli) º
    º 56H ³ 86 ³ zdvojen   \ |     º
    º 57H ³ 87 ³ F11               º
    º 58H ³ 88 ³ F12               º
    ÈÍÍÍÍÍÁÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Pomoc¡  druh‚ho  mapov n¡  se  generuj¡  zdvojenØ k¢dy kl ves Ins, Del,
Home,  End, Page Up, Page Down, kurzorov‚ kl vesy, Num Lock, / v numerick‚m
poli,  Enter  v  numerick‚m  poli, pravì Ctrl, pravì Alt, Caps Lock, Scroll
Lock  a  Pause.  Tyto  kl vesy generuj¡ stejnì orientaŸn¡ k¢d jako u PC/XT,
avçak je pomoc¡ pıeruçen¡ rozliçeno, §e se jedn  o jin‚ kl vesy.




         ÿ6ÿ.ÿ-  ÿPÿaÿmÿØÿœ  ÿCÿMÿOÿSÿ,  ÿmÿaÿsÿkÿoÿvÿ ÿnÿ¡  ÿNÿMÿI


    Tı¡dy  poŸ¡taŸ… AT obsahuj¡ hodiny re ln‚ho Ÿasu nap jen‚ z vestavØnìch
bateri¡  a  64-bajtovou  n¡zkopı¡konovou  pamØœ  CMOS  (tato  pamØœ  je pıi
vypnut‚m poŸ¡taŸi nap jena t‚§ z bateri¡).

    PamØœ  CMOS  obsahuje  r…zn‚  informace,  vŸetnØ  bØ§n‚ho  Ÿasu a data,
nastaven¡  hardwarov‚  konfigurace  a  stavovì bajt pro uzavıen¡ (uzav¡rac¡
bajt  se  pou§¡v   v mechanismu umo§åuj¡c¡m AT opakovanØ startovat v m¡stØ,
kde procesor program k ukonŸen¡ ochrann‚ho m¢du).

    Pokud  uvid¡te  bØhem inicializaŸn¡ho testu POST hl çen¡ "Run Setup" je
to proto, §e nØkterì hardware nem  ulo§en sv…j z znam konfigurace nebo se v
CMOS RAM vyskytly nØjak‚ jin‚ probl‚my.


Porty 0070H - 0071H: pı¡stup k pamØti CMOS, maskov n¡ pıeruçen¡ NMI
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0070H - z pis: nastaven¡ adresy CMOS (Bity 0 a§ 5: adr. 0 a§ 63; bit7: NMI)

        U   poŸ¡taŸe   AT   slou§¡   tento   port   souŸasnØ   k  maskov n¡
        nemaskovateln‚ho  pıeruçen¡  NMI.  Jakìkoliv vìstup na tento port s
        vynulovanìm  bitem  Ÿ¡slo  7 umo§åuje nemaskovateln‚ pıeruçen¡ NMI;
        nastaven¡  tohoto  bitu  zp…sob¡  z kaz  pıeruçen¡  NMI  (Maskov n¡
        pıeruçen¡ NMI u poŸ¡taŸe PC/XT - viz kapitola ıadiŸ pıeruçen¡).

0071H - z pis: z pis dat do CMOS na adresu nastavenou pomoc¡ OUT 70H,adr
        Ÿten¡: Ÿten¡ dat z CMOS z adresy nastaven‚ pomoc¡ OUT 70H,adr

    Ke  Ÿten¡  bajtu  z  pamØti  CMOS vyçlete nejdı¡ve na port o adrese 70H
adresu  pamØœov‚ho  m¡sta  CMOS,  kter‚  m   bìt Ÿteno nebo do kter‚ho bude
zapisov no,  potom  z  adresy  71H m…§ete Ÿ¡st nebo na ni zapisovat data do
CMOS na uveden‚ adrese.

Pı¡klad:                               ; Ÿten¡ typu pevn‚ho disku
         mov       al,12h              ; adresa £daje o disku = 12H
         out       70h,al              ; nastavnen¡ adresy CMOS na 12H
         jmp       $+2                 ; mal  prodleva k ust len¡ dat CMOS
         in        al,71h              ; AL nyn¡ obsahuje typ pevn‚ho disku

    Adresy  10H  a§  20H jsou chr nØny metodou kontroln¡ho souŸtu, aby bylo
mo§n‚  detekovat,  kdy§  jsou  baterie  vybit‚  nebo  byl  do pamØti zaps n
neplatnì  z pis  konfigurace  (napı. kdy§ se "zabØhne" program a n hodou se
provede instrukce OUT 71H - obvykle se zmØn¡ nastaven¡ pevn‚ho disku, kter‚
bylo  Ÿteno  naposled).  Kontroln¡  souŸet  je  jednoduchì 16-bitovì souŸet
chr nØnìch bajt….

    Pozn.: Dalç¡  informace  o  hodin ch  re ln‚ho  Ÿasu z¡sk te v pı¡ruŸce
           Motorolla MC146818.


Obsahy pamØti CMOS (z pis nebo Ÿten¡ podle pıedchoz¡ho popisu):
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
Adresa CMOS:     Popis:

00H    - hodiny re ln‚ho Ÿasu - sekunda
01H    - alarm - sekundy
02H    - hodiny re ln‚ho Ÿasu - minuta
03H    - alarm - minuty
04H    - hodiny re ln‚ho Ÿasu - hodina
05H    - alarm - hodina
06H    - hodiny re ln‚ho Ÿasu - den v tìdnu
07H    - hodiny re ln‚ho Ÿasu - den mØs¡ce
08H    - hodiny re ln‚ho Ÿasu - mØs¡c
09H    - hodiny re ln‚ho Ÿasu - rok

0AH    - stavovì registr hodin re ln‚ho Ÿasu - A (Ÿten¡)

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: vìbØr rychlosti (nastaven na 0110)
         ³ ÀÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-6: 22-stupåov  dØliŸka (nastaveno na 010)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: pı¡znak pr…bØ§n‚ho ulo§en¡ (UIP) (0=Ÿten¡ OK)

0BH    - stavovì registr hodin re ln‚ho Ÿasu - B (z pis)

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: mo§n‚ ulo§en¡ denn¡ho cyklu (0=standard) (0)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: cyklus: 0=12; 1=24                       (1)
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: m¢d dat BCD: 1=bin rn¡; 0=BCD            (0)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: mo§nì obd‚ln¡kovì pr…bØh: 1=ano; 0=ne    (0)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: mo§n‚ pıeruçen¡ ukonŸen¡ dne: 1=ano; 0=ne(0)
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: mo§n‚ pıeruçen¡ alarmem: 1=ano; 0=ne     (0)
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: mo§n‚ periodick‚ pıeruçen¡: 1=ano; 0=ne  (0)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: pı¡znak pr…bØ§n‚ho ulo§en¡ (UIP) (0=Ÿten¡ OK)


0CH    - stavovì registr hodin re ln‚ho Ÿasu - C (Ÿten¡)
       - stavov‚ bity pı¡znak… pıeruçen¡

0DH    - stavovì registr hodin re ln‚ho Ÿasu - D (z pis)
       - bit 7 = 1 pokud CMOS=RAM je pıipojena k nap jen¡
               = 0 idnikuje, §e baterie je vybit 

0EH    - stavovì bajt diagnostiky pıi vnitın¡ inicializaci syst‚mu (POST)
         tento bajt ukl d  POST pıi inicializaci syst‚mu

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: = 0
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: = 0
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=Ÿas neplat¡ (napı. nen¡ 30.£nor)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=çpatnì pevnì disk (nelze z nØj zav‚st OS)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=velikost pamØti nen¡ spr vn 
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=z znam konfigurace nen¡ spr vnì
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=kontroln¡ souŸet CMOS RAM nesouhlas¡
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=vybit  baterie CMOS RAM

0FH    - stavovì bajt pıeruçen¡
         Tento  bajt  je Ÿten pıi startu poŸ¡taŸe po resetu procesoru kv…li
         spr vn‚mu  urŸen¡,  zda  byl  reset  pou§it jako cesta k pıeruçen¡
         procesoru 80286 z ochrann‚ho m¢du.
              0 = mØkkì reset (Ctrl-Alt-Del) nebo nevyj¡meŸn‚ pıeruçen¡
              1 = pıeruçen¡ po urŸen¡ velikosti pamØti
              2 = pıeruçen¡ po proveden¡ test… pamØti
              3 = pıeruçen¡ po chybØ pamØti (kontrola parity 1 nebo 2)
              4 = pıeruçen¡ s po§adavkem zavadØŸe syst‚mu
              5 = pıeruçen¡  instrukc¡  FAR JMP (restart vnitın¡ho ıadiŸe a
                  skok na adresu 0:[0467H])
          6,7,8 = pıeruçen¡ po proveden¡ testu ochrann‚ho m¢du
              9 = pıeruçen¡ po proveden¡ blokov‚ho pıesunu (INT 15H/sl.87H)
             10 = pıeruçen¡ instrukc¡ FAR JMP (pı¡mì skok na 0:[0467H])

10H    - typ disketov‚ mechaniky

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit                                 0000 = § dn 
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: prvn¡ disketov  mechanika ÄÂÄ> 0001 = 360K
         ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-7: druh  disketov  mechanika ÄÙ   0000 = 1.2M

11H    - rezervov no

12H    - typ jednotky pevn‚ho disku (pro disk C: a D:, pokud je 1 a§ 14)

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: prvn¡ pevnì disk (C:) ÄÂÄ> 0000 = § dnì
         ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-7: druhì pevnì disk (D:) ÄÙ   jinak= typ
                                                           1111 = 19H/1AH

    Pokud  je  pro  danì  disk  ud na hodnota 1111 (tj. typ 15), je pro typ
disku pou§it £daj z adres 19H a 1AH pamØti CMOS.

    Typy mechanik jsou pıeddefinov ny v ROM-BIOS. Vektory INT 41H a INT 46H
jsou  pıi  inicializaci  nastaveny  na tabulku ROM obsahuj¡c¡ informace pro
instalovan‚  typy mechanik pevnìch disk…. Viz t‚§ Tabulka parametr… pevn‚ho
disku.


















ÉÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍ»
º  typ  ³  v lc…   ³  hlav ³ pıedkompenzace  ³ pıist vac¡  ³ kapacita  º
º       ³          ³       ³z pisu (od stopy)³    z¢na     ³           º
ÌÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍ¹
º   1   ³   306    ³    4  ³      128        ³    305      ³   10MB    º
º   2   ³   615    ³    4  ³      300        ³    615      ³   21MB    º
º   3   ³   615    ³    6  ³      300        ³    615      ³   31MB    º
º   4   ³   940    ³    8  ³      512        ³    940      ³   64MB    º
º   5   ³   940    ³    6  ³      512        ³    940      ³   48MB    º
º   6   ³   615    ³    4  ³     FFFF        ³    615      ³   21MB    º
º   7   ³   462    ³    8  ³      256        ³    511      ³   31MB    º
º   8   ³   733    ³    5  ³     FFFF        ³    733      ³   31MB    º
º   9   ³   900    ³   15  ³     FFFF        ³    901      ³  151MB    º
º  10   ³   820    ³    3  ³     FFFF        ³    820      ³   21MB    º
º  11   ³   855    ³    5  ³     FFFF        ³    855      ³   36MB    º
º  12   ³   855    ³    7  ³     FFFF        ³    855      ³   51MB    º
º  13   ³   306    ³    8  ³      128        ³    319      ³   21MB    º
º  14   ³   733    ³    7  ³     FFFF        ³    733      ³   44MB    º
º  15   ³  (000)   ³   (0) ³     (000)       ³   (000)     ³  (00MB)   º
º  16   ³   612    ³    4  ³        0        ³    663      ³   21MB    º
º  17   ³   977    ³    5  ³      300        ³    977      ³   42MB    º
º  18   ³   977    ³    7  ³     FFFF        ³    977      ³   58MB    º
º  19   ³  1024    ³    7  ³      512        ³   1023      ³   61MB    º
º  20   ³   733    ³    5  ³      300        ³    732      ³   31MB    º
º  21   ³   733    ³    7  ³      300        ³    732      ³   42MB    º
º  22   ³   733    ³    5  ³      300        ³    733      ³   31MB    º
º  23   ³   306    ³    4  ³        0        ³    336      ³   10MB    º
º  24   ³   925    ³    7  ³        0        ³    925      ³   56MB    º
º  25   ³   925    ³    9  ³     FFFF        ³    925      ³   72MB    º
º  26   ³   754    ³    7  ³      754        ³    754      ³   46MB    º
º  27   ³   754    ³   11  ³     FFFF        ³    754      ³   72MB    º
º  28   ³   699    ³    7  ³      256        ³    699      ³   42MB    º
º  29   ³   823    ³   10  ³     FFFF        ³    823      ³   71MB    º
º  30   ³   918    ³    7  ³      918        ³    918      ³   55MB    º
º  31   ³  1024    ³   11  ³     FFFF        ³   1024      ³   98MB    º
º  32   ³  1024    ³   15  ³     FFFF        ³   1024      ³  133MB    º
º  33   ³  1024    ³    5  ³     1024        ³   1024      ³   44MB    º
º  34   ³   612    ³    2  ³      128        ³    612      ³   10MB    º
º  35   ³  1024    ³    9  ³     FFFF        ³   1024      ³   80MB    º
º  36   ³  1024    ³    8  ³      512        ³   1024      ³   71MB    º
º  37   ³   615    ³    8  ³      128        ³    615      ³   42MB    º
º  38   ³   987    ³    3  ³      987        ³    987      ³   25MB    º
º  39   ³   987    ³    7  ³      987        ³    987      ³   60MB    º
º  40   ³   820    ³    6  ³      820        ³    820      ³   42MB    º
º  41   ³   977    ³    5  ³      977        ³    977      ³   42MB    º
º  42   ³   981    ³    5  ³      981        ³    981      ³   42MB    º
º  43   ³   830    ³    7  ³      512        ³    830      ³   50MB    º
º  44   ³   830    ³   10  ³     FFFF        ³    830      ³   72MB    º
º  45   ³   917    ³   15  ³     FFFF        ³    918      ³  115MB    º
º  46   ³  (000)   ³   (0) ³     (000)       ³   (000)     ³  (00MB)   º
º  47   ³  1024    ³    8  ³        0        ³      0      ³   68MB    º
ÈÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍ¼

Pozn.: édaj  FFFF  ve  sloupci pıedkompenzace znamen , §e pıedkompenzace se
       nebude pou§¡vat od § dn‚ stopu.

       édaj  0 ve sloupci pıedkompenzace znamen , §e se pıedkompenzace bude
       pou§¡vat pro vçechny stopy (tj. od stopy 0).

       Disk typu 1 je origin ln¡ pevnì disk XT.

       Disk typu 2 je standardn¡ pevnì disk AT 20MB.

       Typy 16-23 jsou pıipojeny do ROM-BIOSu od data 15.11.1985.

       Pokud  je  typ  disku  15 (0FH) znamen  to, §e typ disku je ulo§en v
       CMOS na adrese 19H (disk C:) nebo na adrese 1AH (disk D:).

       Typ  disku  46  je  rezervov n  a  nepou§¡v   se.  Disk  Ÿ¡slo 47 je
       u§ivatelsky definovanì disk.

13H    - rezervov no









14H    - bajt vybaven¡ poŸ¡taŸe

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=disketov‚ jednotky jsou instalov ny
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=matematickì koprocesor je instalov n
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:
         ³ ³ ÀÄÁÄÄÄÄÄÄÄÄÄ> 4-5: prim rn¡ displej: 00 - § dnì nebo EGA
         ³ ³                                      01 - 40 pozic CGA
         ³ ³                                      10 - 80 pozic CGA
         ³ ³                                      11 - monochromn¡ TTL
         ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6-7: disketovìch mechanik - 1 (00=1; 01=2; atd.)

15H    - z kladn¡ pamØœ (ni§ç¡ bajt) ÄÂÄ>0100H=256K; 0200H=512K; 0280H=640K
16H    - z kladn¡ pamØœ (vyçç¡ bajt) ÄÙ
17H    - rozç¡ıen  pamØœ nad 1M (ni§ç¡ bajt) ÄÂÄ>(v Kilobajtech, 0-3C00H)
18H    - rozç¡ıen  pamØœ nad 1M (vyçç¡ bajt) ÄÙ  (viz INT 15H/slu§ba 88H)

19H    - typ pevn‚ho disku 0 (C:), pokud je (CMOS adresa 12H & 0FH) = 0FH
1AH    - typ pevn‚ho disku 1 (D:), pokud je (CMOS adresa 12H & F0H) = F0H

1BH-2DH - rezervov no

2EH    - kontroln¡ souŸet CMOS - adresy 10H a§ 20H (vyçç¡ bajt)
2FH    - kontroln¡ souŸet CMOS - adresy 10H a§ 20H (ni§ç¡ bajt)

30H    - rozç¡ıen  pamØœ nad 1M (ni§ç¡ bajt) ÄÂÄ>(v Kilobajtech, 0-3C00H)
31H    - rozç¡ıen  pamØœ nad 1M (vyçç¡ bajt) ÄÙ  (viz INT 15H/slu§ba 88H)

32H    - souŸasn‚ stolet¡ v BCD (tj. 19H)

33H    - vçeobecn‚ informace      bit7=instalov na volba pamØti IBM 128K
                                  bit6=pou§ito utilitou "Setup"

34H-3FH - rezervov no. Zde m…§ete ulo§it na vØky sv‚ jm‚no.







              ÿ7ÿ.ÿ-  ÿüÿaÿdÿiÿŸ  ÿpÿeÿvÿnÿìÿcÿh  ÿdÿiÿsÿkÿ…



    Mezi ıadiŸi pevnìch disk… r…znìch poŸ¡taŸ… jsou drobn‚ odchylky a proto
je  vhodn‚  ponechat  ovl d n¡  pevn‚ho disku na syst‚mov‚m firmware, kter‚
zamaskuje odliçnosti mezi jednotlivìmi ıadiŸi pevnìch disk….


    üadiŸ  pevn‚ho  disku  poŸ¡taŸe  XT  dek¢duje porty 320H a§ 327H. üadiŸ
generuje  pıeruçen¡  £rovnØ  5  (IRQ  5)  po  ka§d‚  operaci (Ÿten¡, z pis,
vystaven¡  atd.).  IRQ  5  je vektorov n na pıeruçen¡ INT 0DH (kter‚ je t‚§
pıiıazeno  jako  m‚nØ pou§¡van‚ pıeruçen¡ IRQ pro LPT2). INT 0DH zak §e DMA
pevn‚ho disku a navr t¡ ı¡zen¡.


Porty 0320H - 0327H: ıadiŸ pevn‚ho disku poŸ¡taŸe XT
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0320H  - datovì registr; z pis povelu, Ÿten¡ statutu
       - z pis: Do   tohoto   registru  je  v§dy  zapisov na  s‚rie  bajt…,
                zapisovan‚ sekvenŸnØ na tento port. Prvn¡m bajtem je pı¡kaz
                pro   ıadiŸ,  n sleduj¡  parametrov‚  bajty  (a§  5  bajt…)
                popisuj¡c¡  hlavu, v lec, sektor a ı¡d¡c¡ bajt maj¡c¡ r…zn‚
                tvary definic, pı¡liç obs hl‚ pro tuto pı¡ruŸku.
       - Ÿten¡: Pokud  je  vysl na chyba (port 0321H, bit 1), m…§ete zapsat
                do  tohoto  registru  pı¡kazovou  sekvenci dotazu na stav a
                potom  jej  Ÿtyın sobnØ Ÿ¡st k obdr§en¡ veçkerìch informac¡
                od ıadiŸe. Prvn¡ batj indikuje chybu.




0321H  - z pis: reset ıadiŸe pevn‚ho disku
                Vìstupem bajtu 00H na tento port resetujete ıadiŸ.
       - Ÿten¡: stavovì registr ıadiŸe

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
             ³       ÀÄÄÄ> 1: 1=nastala chyba
             ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=Ÿ¡slo logick‚ jednotky (disk 0 nebo disk 1)

0322H  - z pis: generuje pulzy vìbØru ıadiŸe
                Jakìkoliv  vìstup  na  port  uvolåuje  ıadiŸ. Pou§ijte pıed
                povelem.

0323H  - z pis: maskovac¡ registr DMA a pıeruçen¡

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                     ³ ÀÄ> 0: 1=mo§nì DMA; 0=nepou§¡vat DMA
                     ÀÄÄÄ> 1: 1=mo§n‚ pıeruçen¡ po povelu ıadiŸe (IRQ 5)



    üadiŸ  pevn‚ho disku poŸ¡taŸe AT je zaŸlenØn do stejn‚ adaptorov‚ desky
jako  ıadiŸ  disketovìch mechanik. Jeho I/O porty, povely a stavov‚ sign ly
jsou odliçn‚ od ıadiŸe poŸ¡taŸe XT.


Porty 01F0H - 01F7H: ıadiŸ prvn¡ho pevn‚ho disku poŸ¡taŸe AT
Porty 0170H - 0177H: ıadiŸ druh‚ho pevn‚ho disku poŸ¡taŸe AT
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    üadiŸ  pevn‚ho  disku  AT  generuje  po  ka§d‚  operaci  (Ÿten¡, z pis,
vystaven¡,  atd.)  pıeruçen¡  £rovnØ  14  (IRQ  14). IRQ 14 je nastaveno na
vektor  pıeruçen¡  INT  76H,  pro kter‚ je akŸn¡ pı¡znakovì bit nastaven na
adrese 0:048EH. V dalç¡m je uv dØn popis portu pouze ıadiŸe prvn¡ho pevn‚ho
disku, druhì disk se liç¡ jen adresami port….

01F0H - datovì registr. ¬ten /zapisovan  data z/do bufferu sektor… ıadiŸe
01F1H - z pis: z pis registru pıedkompenzace
      - Ÿten¡: chybovì registr. Obsahuje bity posledn¡ho chybov‚ho stavu

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=adresov  znaŸka dat nenalezena
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=chyba stopy 0
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=pıeruçen¡ povelu
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: (v§dy nastaven na 0)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=nenalezen identifik tor sektoru
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: (v§dy nastaven na 0)
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=chyba ECC: neopraviteln  chyba dat
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=chybnì blok

01F2H  - Ÿ¡taŸ sektor… - Ÿten¡/z pis poŸtu sektor… pro proveden¡ operace
01F3H  - Ÿ¡slo sektoru - Ÿten¡/z pis bØ§n‚ho/poŸ teŸn¡ho Ÿ¡sla log. sektoru
01F4H  - v lec (vyçç¡ bajt; bity 0-1 jsou bity 8-9 10-bitov‚ho Ÿ¡sla v lce)
01F5H  - v lec (ni§ç¡ bajt; bity 0-7 10-bitov‚ho Ÿ¡sla v lce)
01F6H  - disk a hlava - Ÿten¡/z pis: bity indikuj¡ hlavu a disk pro operaci

01F7H  - z pis: povelovì registr
              1xH = n vrat na v lec 0 (ni§ç¡ tetr da = rychlost krokov n¡)
              7xH = vystaven¡ na danì v lec (ni§ç¡ tetr da = rychl. krok.)
              2xH = Ÿten¡ sektoru (ni§ç¡ tetr da indikuje opakov n¡ a ECC)
              3xH = z pis sektoru (ni§ç¡ tetr da indikuje opakov n¡ a ECC)
              50H = form tov n¡ stopy
              4xH = ovØıovac¡ Ÿten¡ (ni§ç¡ tetr da indikuje opakov n¡)
              90H = diagn¢za
              91H = nastaven¡  parametr…  (max.  poŸet  hlav,  sektor…) pro
                    zvolenì disk

       - Ÿten¡: stavovì registr

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=pıedchoz¡ povel ukonŸen chybou
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: index: n+staven na 1 pıi impulsu indexu
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=opraven  data (nastala chyba, korekce ECC)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=po§adavek dat (buffer Ÿek  na data)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=vystaven¡ ukonŸeno
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=chyba z pisu
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=disk pıipraven na vystaven¡ (je-li bit 4=1)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=zanepr zdnØn (prov d¡ povel)





             ÿ8ÿ.ÿ-  ÿüÿaÿdÿiÿŸ  ÿpÿrÿuÿ§ÿnÿìÿcÿh  ÿdÿiÿsÿkÿ…


    Tento  popis  se  vztahuje k ıadiŸi pru§nìch disk… (FDC), jeho§ hlavn¡m
prvkem  je  NEC  ?PD765 (nebo kompatibiln¡ Ÿip FDC - jako I8272). Hodnoty v
registrech  pro Ÿasov n¡ (napı. rychlost krokov n¡) plat¡ pro hodiny ıadiŸe
8 Mhz.

    üadiŸ  pru§nìch disk… poŸ¡taŸe AT je um¡stØn na stejn‚ kartØ jako ıadiŸ
pevn‚ho  disku, avçak jinak je kompatibiln¡ se standardn¡m ıadiŸem pru§nìch
disk…  poŸ¡taŸ… PC/XT (kromØ nØkolika pozn mek uvedenìch d le). Mezi hlavn¡
rozd¡ly  patı¡ pıedevç¡m to, §e ıadiŸ pru§nìch disk… poŸ¡taŸe AT je schopen
v¡cen sobnìch  rychlost¡  pıenosu  dat, avçak obsluhuje pouze dvØ disketov‚
mechaniky.

    - ıadiŸ pru§nìch disk… 1 dek¢duje porty 03F0H a§ 03F7H
    - ıadiŸ pru§nìch disk… 2 dek¢duje porty 0370H a§ 0377H (pouze AT)

    üadiŸ   pru§nìch   disk…  generuje  po  ka§d‚  operaci  (Ÿten¡,  z pis,
vystaven¡,  rekalibrace,  atd.)  pıeruçen¡  £rovnØ  6  (IRQ  6),  kter‚  je
vektorov no na INT 0EH a obsluhov no BIOSem.

mechanika 5 1/4" 1.2 MB: ot Ÿky 360/minutu (tj. 6 za sekundu)
ostatn¡ mechaniky: ot Ÿky 300/minutu (tj. 5 za sekundu)


Porty 03F0H - 03F7H: ıadiŸ pru§nìch disk… 1
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    üadiŸ  pru§nìch  disk…  2  nen¡  pops n,  jeho  pıipojen¡ je analogick‚
pou§it¡  port…  ıadiŸe  1  (zmØn¡ se pouze hodnoty port… z 03FxH na 037xH a
oznaŸen¡ disketovìch mechanik A na C a B na D).

03F2H  - z pis: registr Ÿ¡slicov‚ho vìstupu
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: volba mechaniky 0-3 (AT nepou§¡v  bit 1)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  0=reset ıadiŸe disket; 1=uvolnØn¡ ıadiŸe
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=mo§nì pıenos DMA disket a pıeruçen¡
          ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-7: zapnut¡ motor… disketovìch mechanik A-D
                                 (AT nepou§¡v  bity 6-7)

03F4H  - Ÿten¡: hlavn¡ stavovì registr MSR
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³R³I³D³B³  DnB  ³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: 1=disket. mech. zanepr zdnØny (vystavuj¡)
         ³ ³ ³ ³                (AT nepou§¡v  bity 2-3)
         ³ ³ ³ ³                - pokud je nØkterì bit nastaven, ıadiŸ
         ³ ³ ³ ³                  nepıij¡m  povely pro Ÿten¡/z pis
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=ıadiŸ disket zanepr zdnØn (Ÿten¡/z pis)
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=nen¡ m¢d DMA; 0=m¢d DMA aktivn¡
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  smØr toku dat: 1=FDC do CPU; 0=CPU do FDC
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=dat. registr je pıipraven ke Ÿten¡/z pisu


03F5H  - Ÿten¡/z pis: registr povel…/dat ıadiŸe FDC
         Tento  port se pou§¡v  pro vçechny pı¡kazov‚ operace ıadiŸe. Prvn¡
         - povelovì bajt - je vìstup, potom n sleduj¡ parametry povelu jako
         vìstup.  Po  proveden¡  operace je 0 nebo nØkolik vstup… navr ceno
         jako  vìsledek  operace.  Vçechny  pıenosy  pıes  tento  port mus¡
         n sledovat za sebou ve spr vn‚ posloupnosti.

         N sleduj¡c¡  vìpis  povel… pou§¡v  BIOS pro sv‚ standardn¡ funkce,
         avçak nejsou zde pops ny parametry n sleduj¡c¡ za pı¡kazem.

         E6H - Ÿten¡ dat (n sleduje 8 parametr…; navr ceno 7 vìsledk…)
         C5H - z pis dat (n sleduje 8 parametr…; navr ceno 7 vìsledk…)
         4DH - form tov n¡ stopy (n sleduje 5 param.; navr ceno 7 vìsledk…)
         07H - rekalibrace (1 parametr; nenavr cen § dnì vìsledek)
         0FH - vystaven¡ na stopu (1 parametr; nenavr cen § dnì vìsledek)


    Stavovì registr ST0
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³RES³S³F³R³H³DSn³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: aktivn¡ disketov  mechanika 0-3
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  Ÿ¡slo aktivn¡ hlaviŸky (0-1)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=mechanika nen¡ pıipravena
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=pıijat chybovì sign l FAULT nebo
          ³ ³ ³                    nenalezena stopa 0 pıi rekalibraci
          ³ ³ ³                    (max. 77 stop)
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=vystaven¡ na stopu ukonŸeno
          ÀÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6-7: 00=£spØçn‚ £konŸen¡ operace
                                 01=pı¡kaz zah jen ale nedokonŸen £spØçnØ
                                 10=chybnì pı¡kaz (operace ani nezaŸala)
                                 11=v pr…bØhu operace ztr ta sign lu READY

    Stavovì registr ST1
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³E³0³C³O³0³S³W³M³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=nelze nal‚zt adresovou znaŸku
          ³ ³ ³ ³ ³ ³ ³          (mezi 2 indexy)
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=bØhem z pisu ident.ochrana proti z pisu
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  1=ıadiŸ nem…§e nal‚zt zadanì sektor
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  nevyu§it - v§dy nastaven na 0
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=pıeteŸen¡ dat - CPU nestaŸ¡ odeb¡rat
          ³ ³ ³                    (napı. ıadiŸ DMA zanepr zdnØn)
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=chyba pıi Ÿten¡ dat (chyba CRC)
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  nevyu§it - v§dy nastaven na 0
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=konec stopy (pı¡stup za posledn¡ sektor)


    Stavovì registr ST2
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0³M³E³C³S³S³B³M³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=pıi Ÿten¡ nenalezena adr.znaŸka v datech
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=Ÿ¡slo stopy nesouhlas¡ - mus¡ bìt 0ffh
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  1=pıi porovn n¡ dat nenalezen sektor
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=pıi porovn n¡ dat byla data shodn 
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=Ÿ¡slo stopy nesouhlas¡
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=chyba v datov‚m poli sektoru (CRC)
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  1=nalezenì sektor oznaŸen jako "smazanì"
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  nevyu§it - v§dy nastaven na 0


    Stavovì registr ST3
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³F³W³R³T³D³H³DSn³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: stav sign l… volby jednotky (0-3)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  stav sign lu volby hlaviŸky (0-1)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=je pıipojena oboustrann  mechanika
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=nalezena stopa 0
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=disketov  jednotka je pıipravena
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  1=disketa m  ochranu proti z pisu
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=chybovì sign l od disk. jednotky FAULT


    SPECIFY - nastaven¡ vnitın¡ch ŸasovaŸ…

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0 0 1 1³ = 03h (povel SPECIFY)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³  SRT  ³  HUT  ³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: Ÿas od ukonŸen¡ operace R/W do odklopen¡
          ³ ³ ³ ³                hlaviŸky v 1/16 ms (16 a§ 240 ms)
          ÀÄÁÄÁÄÁÄÄÄÄÄÄÄÄÄ> 4-7: Ÿas mezi kroky vystavovac¡ho motorku
                                 v 1 ms (1 ms a§ 16 ms)
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³      HLT    ³D³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=nen¡ provoz DMA, 0=je provoz DMA
          ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÄÄ> 1-7: Ÿas od pıiklopen¡ hlaviŸky po zaŸ tek R/W
                                 operace po 2 ms (2 a§ 254 ms)

    RECALIBRATE - vystaven¡ na stopu 0 (uveden¡ hlaviŸek na zn mou pozici)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0 1 1 1³ = 07h (povel RECALIBRATE)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0 0³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÂÁÂÙ  bit
                      ÀÄÁÄ> 0-1: Ÿ¡slo mechaniky pro proveden¡ rekalibrace


    SEEK - vystaven¡ hlaviŸek na zadanou stopu (motor mus¡ bìt zapnut)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 1 1 1 1³ = 0fh (povel SEEK)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: Ÿ¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  vìbØr hlaviŸky (0-1)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³      NCN      ³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄ> 0-7: Ÿ¡slo po§adovan‚ stopy


    READ ID - Ÿten¡ prvn¡ho identifikaŸn¡ho pole ze stopy
              (umo§åuje zjiçtØn¡ Ÿ¡sla stopy z diskety)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0³M³0 0 1 0 1 0³ = 4ah (povel READ ID)
         ÀÄÁÂÁÄÁÄÁÄÁÄÁÄÁÄÙ
            ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 0=k¢dov n¡ FM (nepou§¡v  se), 1=k¢dov n¡ MFM

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: Ÿ¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  vìbØr hlaviŸky (0-1)

    Po proveden¡ operace (Ÿten¡ identifikaŸn¡ho pole) se Ÿte 7 bajt…:
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³RES³S³F³R³H³DSn³   stavovì registr ST0
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³E³0³C³O³0³S³W³M³   stavovì registr ST1
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0³M³E³C³S³S³B³M³   stavovì registr ST2
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     stopa     ³   stopa
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     hlava     ³   hlava (strana)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     sektor    ³   sektor
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     d‚lka     ³   d‚lka sektoru (0=128 B, 1=256 B, ...)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ


    READ DATA - Ÿten¡ dat zadan‚ho sektoru z nastaven‚ stopy

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³T³M³S³0 0 1 1 0³ = 0E6h (povel READ DATA)
         ÀÂÁÂÁÂÁÄÁÄÁÄÁÄÁÄÙ
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 1=pıeskoŸ¡ se vymazanì sektor, 0=nastav¡ se
          ³ ³                    bit6 registru ST2 a ukonŸ¡ se operace
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 0=k¢dov n¡ FM (nepou§¡v  se), 1=k¢dov n¡ MFM
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 1=operace se provede i na stranØ 1 diskety

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: Ÿ¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  vìbØr hlaviŸky (0-1)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     stopa     ³   stopa
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     hlava     ³   hlava (strana)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     sektor    ³   sektor
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     d‚lka     ³   d‚lka sektoru (0=128 B, 1=256 B, ...)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³  konec stopy  ³   Ÿ¡slo posledn¡ho sektoru na stopØ
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³ mezisekt. mez.³   mezisektorov  mezera
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³ altern. d‚lka ³   poŸet Ÿtenìch bajt…, je-li zadan  d‚lka = 0
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ   (je-li d‚lka zadan , m…§e bìt = 0ffh)

    Po  pıeŸten¡  ka§d‚ho  sektoru  je  Ÿ¡slo  sektoru v ıadiŸi automaticky
inkrementov no  a  ıadiŸ  Ÿte  n sleduj¡c¡  sektor.  Pı¡kaz  mus¡ bìt proto
ukonŸen sign lem TC. üadiŸ pıestane vys¡lat data do CPU avçak operaci Ÿten¡
dokonŸ¡ a zkontroluje CRC.

    Po proveden¡ operace Ÿten¡ dat se naŸte 7 bajt… jako u povelu READ ID.


    WRITE DATA - z pis dat do zadan‚ho sektoru na nastaven‚ stopØ

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³T³M³S³0 0 1 0 1³ = 0C5h (povel WRITE DATA)
         ÀÂÁÂÁÂÁÄÁÄÁÄÁÄÁÄÙ
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 1=pıeskoŸ¡ se vymazanì sektor
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 0=k¢dov n¡ FM (nepou§¡v  se), 1=k¢dov n¡ MFM
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 1=operace se provede na obou stran ch diskety

    Ostatn¡ postup je stejnì jako u povelu READ DATA.

    Mezisektorov‚ mezery:
ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º k¢dov n¡ ³ sektor ³        disketa 8"       ³      disketa 5 1/4"      º
º          ³        ³  Ÿten¡/z pis ³  form t. ³  Ÿten¡/z pis ³  form t.  º
ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍ¹
º          ³  128 B ³      7       ³   1Bh    ³      7       ³     9     º
º          ³  256 B ³     0Eh      ³   2Ah    ³     18h      ³    30h    º
º    FM    ³  512 B ³     1Bh      ³   3Ah    ³     46h      ³    87h    º
º          ³ 1024 B ³     47h      ³   8Ah    ³     C8h      ³    FFh    º
ÌÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄ¹
º          ³  256 B ³     0Eh      ³   36h    ³     0Ah      ³    0Ch    º
º   MFM    ³  512 B ³     1Bh      ³   54h    ³     2Ah      ³    50h    º
º          ³ 1024 B ³     66h      ³   74h    ³     80h      ³    F0h    º
ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍ¼


    FORMAT TRACK - form tov n¡ stopy

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0³M³0³0 1 1 0 1³ = 4dh (povel FORMAT TRACK)
         ÀÄÁÂÁÄÁÄÁÄÁÄÁÄÁÄÙ
            ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 0=k¢dov n¡ FM (nepou§¡v  se), 1=k¢dov n¡ MFM
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: Ÿ¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  vìbØr hlaviŸky (0-1)
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³ d‚lka sektoru ³   ı d d‚lky sektoru (0=128, 1=256,...)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³ poŸet sektor… ³   poŸet sektor… na stopØ
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³mezisekt.mezera³   d‚lka mezisektorov‚ mezery
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³  datovì vzor  ³   datovì vzor (inicializaŸn¡ bajt dat - 0E5h)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ


    Informace   k  z pisu  do  identifikaŸn¡ho  pole  sektoru  je  dod v na
procesorem  bØhem  form tov n¡ pro ka§dì sektor zvl çœ. Pro ka§dì sektor je
nutno vyslat 4 bajty:
                        - Ÿ¡slo stopy
                        - Ÿ¡slo hlavy (strany)
                        - Ÿ¡slo sektoru
                        - d‚lka sektoru

    Je  mo§n‚  naform tovat  disketu s libovolnìm poıad¡m sektor… ("SKEW"),
Ÿ¡m§ je mo§n‚ zkr tit pı¡stupovou dobu na disketu.

    Form tov n¡   se  ukonŸ¡  druhìm  pı¡chodem  indexu,  sign lem  "FAULT"
(otevıen¡ dv¡ıek) nebo sign lem "READY".

    Po ukonŸen¡ form tov n¡ je navr ceno 7 bajt… jako u povelu READ ID.


    SENSE INTERRUPT STATUS - poskytnut¡ stavovìch informac¡
                       (pou§¡v  se t‚§ ke kontrole vystaven¡ na pozici)

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 1 0 0 0³ = 8 (povel SENSE INTERRUPT STATUS)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ

    Povel navr t¡ 2 informaŸn¡ bajty:

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³RES³S³F³R³H³DSn³   stavovì registr ST0 (k urŸen¡ smØru INT)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³     stopa     ³   aktu ln¡ pozice hlaviŸky
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ



    Pokud  byl  zad n  neplatnì  povel,  nastav¡  se bity D6 a D7 v hlavn¡m
stavov‚m  registru na 1 a indikuj¡, §e je ve stavov‚m registru pıipraven ke
Ÿten¡ stavovì registr ST0 obsahuj¡c¡ bajt 80h (= neplatnì pı¡kaz).

    Po  ukonŸen¡  operac¡ SEEK (vystaven¡) a RECALIBRATE (rekalibrace) mus¡
bìt  vysl n  pı¡kaz  SENSE  INTERRUPT STATUS, jinak ka§dì dalç¡ pı¡kaz bude
pova§ov n za neplatnì pı¡kaz.

    SENSE DRIVE STATUS - poskytnut¡ informac¡ o mechanice

         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0 1 0 0³ = 4 (povel SENSE DRIVE STATUS)
         ÀÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÙ
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³0 0 0 0 0³H³DSn³
         ÀÄÁÄÁÄÁÄÁÄÁÂÁÂÁÂÙ  bit
                    ³ ÀÄÁÄ> 0-1: Ÿ¡slo mechaniky pro proveden¡ rekalibrace
                    ÀÄÄÄÄÄ>  2:  vìbØr hlaviŸky (0-1)

    Povel navr t¡ jeden bajt - stavovì registr ST3:
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³F³W³R³T³D³H³DSn³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: stav sign l… volby jednotky (0-3)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  stav sign lu volby hlaviŸky (0-1)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  1=je pıipojena oboustrann  mechanika
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=nalezena stopa 0
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=disketov  jednotka je pıipravena
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  1=disketa m  ochranu proti z pisu
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=chybovì sign l od disk. jednotky FAULT


    INVALID - pr zdnì povel

    Vçechny  ostatn¡ pı¡kazy jsou pou§¡v ny jako neplatn‚. üadiŸ po pıijet¡
neplatn‚ho  povelu  ukonŸ¡ prov dØnou operaci (negeneruje INT) a pıiprav¡ k
navr cen¡  registr  ST0  obsahuj¡c¡  bajt 80h indikuj¡c¡ pıijet¡ neplatn‚ho
pı¡kazu.


03F6H  - z pis (AT): registr pevn‚ho disku
03F7H  - z pis (AT): disketovì ı¡d¡c¡ registr
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: rychlost pıenosu dat:     00=500 Kb/s;
          ³ ³ ³ ³ ³ ³            01=300 Kb/s; 10=250 Kb/s; 11=rezervov no
          ÀÄÁÄÁÄÁÄÁÄÁÄÄÄÄÄ> 2-7:

         Ÿten¡: registr Ÿ¡slicov‚ho vstupu - pou§¡v  se pro diagnostiku
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=vìbØr mechaniky 0
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=vìbØr mechaniky 1
          ³ ³ ÀÄÁÄÁÄÁÄÄÄÄÄ> 2-5: vìbØr hlav 0-3 (bit 2 = hlava 0 atd.)
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  1=z pisov‚ hradlo
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  1=sign l vìmØny diskety je ve stavu ON



Struktura sektoru diskety:
-------------------------
Z hlav¡ - identifik tor sektoru (13 bajt…):
  (6) synchronizaŸn¡ bajty 00h
  (1) adresov  znaŸka identifikaŸn¡ho pole
  (1) Ÿ¡slo v lce (0...)
  (1) Ÿ¡slo strany (0...)
  (1) Ÿ¡slo sektoru (1...)
  (1) d‚lka sektoru (0=128, 1=256, 2=512, 3=1024, ...)
  (2) kontroln¡ souŸet z hlav¡ (polo§ky "Ÿ¡slo v lce" a§ "d‚lka sektoru")

OddØlovac¡ mezera (11 bajt…):
  (11) identifikaŸn¡ oddØlovac¡ mezera bajty 0FFh

Datovì blok (9+X bajt…):
  (6) synchronizaŸn¡ bajty 00h
  (1) adresov  znaŸka datov‚ho pole
      (pokud je na tomto m¡stØ nalezena adresov  znaŸka zruçenìch dat, jsou
       data tohoto sektoru ignorov na a ıadiŸ Ÿte n sleduj¡c¡ sektor)
  (X) vlastn¡ data
  (2) kontroln¡ souŸet dat

Datov  mezera (27 bajt…):
  (27) oddØlovac¡ mezera mezi sektory


Adresov‚ znaŸky slou§¡ k identifikaci poŸ tku identifikaŸn¡ho nebo datov‚ho
pole.  Od  ostatn¡ch  dat  je  lze  rozliçit  pomoc¡ chybØj¡c¡ch hodinovìch
impuls…. Pou§¡vaj¡ se celkem Ÿtyıi r…zn‚ adresov‚ znaŸky:
    - indexov   adresov   znaŸka  uvnitı  indexov‚  mezery  (tj.  mezera na
      poŸ tku stopy)
    - adresov  znaŸka identifikaŸn¡ho pole
    - adresov  znaŸka datov‚ho pole
    - adresov  znaŸka zruçenìch dat (na zaŸ tku pole zruçenìch dat)
                    ³ C     C     C     C     C     C     C     C
                    ³ ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿  ÚÄÄ¿
         HODINY     ³ ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³  ³
                   ÄÅÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄ
                    ³    1     1     0     0     0     0     1     0
         DATA       ³ ÚÄÄÄÄÄÄÄÄÄÄÄ¿                       ÚÄÄÄÄÄ¿
      (bajt C2h)    ³ ³           ³                       ³     ³
                   ÄÅÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄ
                    ³ C  1  C  1  C  0  C  0  C  0  C  0  C  1  C  0
       FM modulace  ³ ³  ³  ³  ³  ³     ³     ³     ³     ³  ³  ³
                    ³ ³  ³  ³  ³  ³     ³     ³     ³     ³  ³  ³
                   ÄÅÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÁÄÄÁÄÄÄÄÄÄÄ
                    ³ C  1  C  1  C  0  C  0  C  0  C  0  C  1  C  0
      MFM modulace  ³    ³     ³        ³     ³     ³        ³
                    ³    ³     ³        ³     ³     ³        ³
                   ÄÁÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ

    U  modulace MFM se nahr vaj¡ hodinov‚ pulsy jen tam, kde by byla dlouh 
mezera  mezi impulsy - mezi dva nulov‚ datov‚ bity se vkl d  jeden hodinov£
puls.


               ÿ9ÿ.ÿ-  ÿGÿrÿaÿfÿiÿcÿkÿ   ÿkÿaÿrÿtÿa  ÿCÿGÿA


Porty 03D0H - 03DFH: port grafick‚ karty CGA
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    CGA  je barevnì grafickì adapt‚r (Color/Graphics Adapter CGA). Grafick 
karta  CGA  je  vystavØna  kolem  integrovan‚ho grafick‚ho ıadiŸe Motorolla
6845 (CRT controller chip).

    CGA dek¢duje porty 03D0H a§ 03DFH (aktu lnØ pou§¡v  03D2H a§ 03DCH)

    Pozn.: Tyto   porty  jsou  pro  zvìçen¡  kompatibility  pıekryty  porty
           grafick‚  karty  EGA.  KromØ nØkolika vyj¡mek jsou informace CGA
           aplikov ny i na EGA.

           Podle  starç¡ch  pı¡ruŸek  k  CGA  by  mØla  karta CGA generovat
           hardwarov‚  pıeruçen¡  IRQ  2  pıi vertik ln¡m zatemåovac¡m bØhu
           paprsku obrazovky. Tuto mo§nost vçak CGA nikdy nemØla.

           BIOS  ukl d   obraz  hodnot  port…  pro  ovl d n¡  karty  CGA do
           datov‚ho  prostoru  BIOS.  Pokud  chcete zmØnit jeden bit portu,
           pıeŸtØte  hodnotu  portu  na t‚to adrese, nastavte bit, proveÔte
           instrukci OUT a ulo§te novou hodnotu zpØt do promØnn‚.

03D4H  - z pis: vìbØr   ı¡d¡c¡ho   registru  CRT.  Pou§ijte  tento  port  k
                nastaven¡  nØkter‚ho  z  18  registr…  ıadiŸe CRT. ProveÔte
                instrukci   vìstupu  Ÿ¡sla  registru  na  port  03D4H  (OUT
                03D4H,AL)  n sledovanou  Ÿten¡m  dat nebo z pis dat na port
                03D5H.

03D5H  - ı¡d¡c¡  registr  ıadiŸe CRT. Po vìbØru registru pomoc¡ portu 03D4H
         lze  pıes  tento  port  Ÿ¡st  nebo  pıes  nØj  zapisovat  data  do
         nastaven‚ho vnitın¡ho registru ıadiŸe CRT.

       - z pis: vìznam registr… ıadiŸe displeje CRT je n sleduj¡c¡:
ÉÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º reg.³                        vìznam                                     º
ÌÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 00H ³ celkov  d‚lka horizont ln¡ synchronizace ve znakovìch taktech     º
º 01H ³ poŸet zobrazenìch znak… na ı dek                                  º
º 02H ³ horizont ln¡ synchroniz. pozice (vystıedØn¡ obrazu vodorovnØ)     º
º 03H ³ ç¡ıka vertik. a horizont. synchron. puls… (ka§dì 4 bity)          º
º 04H ³ celkovì poŸet vertik ln¡ch ı dk… znak…                            º
º 05H ³ vertik ln¡ pıizp…soben¡ (sn¡mkov n¡ 50 nebo 60 Hz)                º
º 06H ³ poŸet zobrazenìch vertik ln¡ch ı dk… znak…                        º
º 07H ³ vertik ln¡ synchronizaŸn¡ pozice (vystıedØn¡ obrazu svisle)       º
º 08H ³ m¢d prokl d n¡ (bity 4 a 5) a zpØtn‚ho bØhu (bity 6 a 7)          º
º 09H ³ adresa maxim ln¡ pomocn‚ linky (poŸet linek na znak)              º
º 0AH ³ poŸ teŸn¡ linka kurzoru                                           º
º 0BH ³ koneŸn  linka kurzoru                                             º
º 0CH ³ poŸ teŸn¡ adresa videopamØti-zaŸ tek zobraz. str nky (vyçç¡ bajt) º
º 0DH ³               -  "  -   (ni§ç¡ bajt)                              º
º 0EH ³ adresa kurzoru (vyçç¡ bajt)                                       º
º 0FH ³ adresa kurzoru (ni§ç¡ bajt)                                       º
º 10H ³ adresa svØteln‚ho pera (vyçç¡ bajt)                               º
º 11H ³ adresa svØteln‚ho pera (ni§ç¡ bajt)                               º
ÈÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

       - Ÿten¡: Registry 0CH a§ 11H lze Ÿ¡st.







03D6H  - z pis: registr volby m¢du (Pozn.:BIOS ukl d  nastavenou hodnotu na
                adresu 0:0465H)
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
             ³ ³ ³ ³ ³ ÀÄ> 0: ç¡ıka (textov‚ m¢dy): 0=40 znak…; 1=80 znak…
             ³ ³ ³ ³ ÀÄÄÄ> 1: 1=mo§nì grafickì m¢d; 0=textovì m¢d
             ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=z kaz Color Burst pro slo§kovì monitor
             ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=mo§nì videosign l; 0=z kaz slo§ek (Ÿern )
             ³ ÀÄÄÄÄÄÄÄÄÄ> 4: bodov‚ rozliçen¡: 0=320 bod…/2 bity; 1=640/1
             ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=mo§n‚ blik n¡ textu; 0=intenzita pozad¡

03D8H  - z pis: registr volby barev
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
             ³ ³ ÀÄÄÄÄÄÄÄ> 0-3: barva: text.m¢d - okol¡; graf.m¢d - pozad¡
             ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  intenzita: tex.m¢d - pozad¡; graf. - body
             ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  modr : vìbØr graf. palet  (1 pıid  modrou)

03DAH  - Ÿten¡: stavovì registr
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ÀÄ> 0: zpØtnì bØh: 1=displej ve zpØtn‚m bØhu
                 ³ ³ ÀÄÄÄ> 1: 1=svØteln‚ pero je aktivov no
                 ³ ÀÄÄÄÄÄ> 2: 1=sp¡naŸ svØteln‚ho pera je otevıen
                 ÀÄÄÄÄÄÄÄ> 3: 1=prob¡h  vertik ln¡ synch. puls.
         Pozn.: Z pis  dat bØhem vertik ln¡ho synchronizaŸn¡ho pulsu (bit 3
                nastaven na 1) nezp…sob¡ "snØ§en¡" obrazu.

03DBH  - Ÿten¡/z pis: libovolnì vìstup vyma§e registr svØteln‚ho pera
03DCH  - Ÿten¡/z pis: libovolnì vìstup nastav¡ registr svØteln‚ho pera






      ÿ1ÿ0ÿ.ÿ-  ÿGÿrÿaÿfÿiÿcÿkÿ   ÿkÿaÿrÿtÿa  ÿEÿGÿA  ÿ(ÿa  ÿMÿDÿAÿ)

    Grafick   karta  EGA  (Enhanced  Graphics  Adapter)  je  kompatibiln¡ s
kartami  CGA  (Color/Graphics  Adapter) a MDA (Monochrome Display Adapter),
avçak m  mnoho dalç¡ho vybaven¡, kter‚ ji pıedurŸuje k pou§it¡ v nejçirç¡ch
aplikac¡ch.

    Mezi jej¡ pıednosti patı¡:

    - vyçç¡ rozliçitelnost v textovìch i grafickìch re§imech
    - grafick‚ m¢dy na monochromn¡m monitoru
    - softwarovØ definovateln‚ fonty znak… v textovìch m¢dech
    - spoleŸn‚ zobrazen¡ v¡ce font… najednou
    - 64 barev v textovìch nebo grafickìch m¢dech
    - jemn‚ rolov n¡ obrazu (bodov‚ rolov n¡)
    - hardwarovØ ı¡zeno rozdØlen¡ obrazovky
    - do videopamØti je mo§n‚ zapisovat bez nebezpeŸ¡ "snØ§en¡" obrazu

    EGA dek¢duje porty ve dvou oblastech:

    EGA #1 dek¢duje porty 03C0H a§ 03DFH (kv…li sluŸitelnosti s kartou CGA)
    EGA #2 dek¢duje porty 02C0H a§ 02DFH (druh  karta EGA v syst‚mu)

    Pro sluŸitelnost s graf. kartou MDA dek¢duje EGA porty 03B0H - 03BFH


    EGA  generuje  na zaŸ tku vertik ln¡ho zpØtn‚ho bØhu pıeruçen¡ £rovnØ 2
(IRQ  2),  kter‚  m   nastaven vektor pıeruçen¡ INT 0AH. Pıi pou§it¡ tohoto
pıeruçen¡  mØjte  na mysli, §e AT pou§¡v  IRQ 2 jako kask dn¡ po§adavek pro
celou tı¡du pıeruçen¡ (IRQ 8-15).

Pozn.: BIOS  ukl d   obraz  hodnot  nastaven¡  registr… ıadiŸe CRT a jinìch
       informac¡ EGA do datov‚ho prostoru EGA. Pokud chcete zmØnit nØkterou
       hodnotu  nastavenou  na  portu,  pıeŸtØte hodnotu ulo§enou v tabulce
       promØnnìch karty EGA, nastavte bit, proveÔte vìstup na port a ulo§te
       do promØnn‚ novou hodnotu.







Porty 03B0H - 03BFH: port grafick‚ karty MDA
Porty 03C0H - 03DFH: port grafick‚ karty EGA #1
Porty 02C0H - 02DFH: port grafick‚ karty EGA #2
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

03C0H  - z pis: port adresy a dat ıadiŸe (ATC)
              proveÔte IN  al,03DAH            ; nastaven¡ m¢du adresy ATC
                       OUT 3C0H,Ÿ¡slo_registru ; volba registru ATC
                       OUT 3C0H,hodnota        ; ulo§en¡ hodnoty do reg.
              pozn.: bity 0-4: nastaven¡ registru ATC
                     bit 5: 1=mo§n‚ zobrazen¡; 0=nastaven¡ registru

         Po vìbØru registru proveÔte vìstup dat na port 03C0H:

    reg.00H-0FH    registry palet: nastaven¡ barev podle atribut…
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                   ³ ³ ³ ³ ³ ÀÄ> 0: R Ÿerven  (intenzita 2/3)
                   ³ ³ ³ ³ ÀÄÄÄ> 1: G zelen   (intenzita 2/3)
                   ³ ³ ³ ÀÄÄÄÄÄ> 2: B modr    (intenzita 2/3)
                   ³ ³ ÀÄÄÄÄÄÄÄ> 3: b modr '  (intenzita 1/3)
                   ³ ÀÄÄÄÄÄÄÄÄÄ> 4: g zelen ' (intenzita 1/3)
                   ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: Ÿerven '  (intenzita 1/3)
               bit 3 slou§¡ t‚§ pro emulaci podtr§en¡ MDA
               bit 4 slou§¡ t‚§ pro emulaci intenzity CGA

    reg.10H   ı¡zen¡ m¢du
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                       ³ ³ ³ ÀÄ> 0: 1=grafickì m¢d; 0=textovì m¢d
                       ³ ³ ÀÄÄÄ> 1: 1=atributy MDA; 0=barevn‚ atributy
                       ³ ÀÄÄÄÄÄ> 2: 1=9.bod je 8.bod pro znaky
                       ³            0=9.bod znak… jako barva pozad¡
                       ÀÄÄÄÄÄÄÄ> 3: 1=blik n¡ textu; 0=4-bitov‚ pozad¡

    reg.11H   nastaven¡ barvy okol¡ (podobnØ jako registr palet)

    reg.12H   mo§n‚ roviny barev
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
                   ³ ³ ÀÄÁÄÁÄÁÄ> 0-3: uvolnØn¡ rovin 0-3
                   ÀÄÁÄÄÄÄÄÄÄÄÄ> 4-5: videostatut multiplexu
                                      00=R&B; 01=b&G, 10=r&g, 11=nepou§it

    reg.13H   posuv horizont ln¡ch bod…
              PoŸet bod…, o kter‚ jsou data rotov na vlevo. Plat¡ bity 0-3.

03C2H  - z pis: r…zn‚ ı¡d¡c¡ funkce
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=volba 3BxH (MDA); 0=volba 3DxH (CGA)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ>  1:  1=mo§n  RAM; 0=blokov n¡ RAM
         ³ ³ ³ ³ ÀÄÁÄÄÄÄÄ> 2-3: takt bod…:00=14MHZ;01=16MHz;10=ext.;11=rez.
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=rozçiıuj¡c¡ vìstup; 0=internØ
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  str nkovì bit pro lichì/sudì m¢d
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  polarita hor.zpØt.bØhu: 1=negat.; 0=pozit.
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  polarita vert.zpØt.bØhu: 1=negat.; 0=pozit.

03C4H  - z pis: registr adresy n slednosti
03C5H  - z pis: registr dat n slednosti
              proveÔte OUT 03C4H,Ÿ¡slo_registru; potom OUT 03C5H,data

    reg.00H   reset n slednosti (bity 0-1 indikuj¡ asynchr./synchr.reset)
    reg.01H   m¢d taktov n¡
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                       ³ ³ ³ ÀÄ> 0: 1=8 bod… na znak; 0=9 bod… na znak
                       ³ ³ ÀÄÄÄ> 1: ç¡ıka linky displeje 1=n¡zk ; 0=çirok 
                       ³ ÀÄÄÄÄÄ> 2: 1=mØnit ka§dì znak; 0=ka§dì druhì znak
                       ÀÄÄÄÄÄÄÄ> 3: takt bod…: 1=p…lenì; 0=norm ln¡

    reg.02H   maskovac¡ mapa: bity 0-3 umo§åuj¡ z pis do bit… rovin 0-3
    reg.03H   volba mapy znak…:
                   bity 0-1 vol¡ mapu B (atributovì bit 3=0)
                   bity 2-3 vol¡ mapu A (atribotuvì bit 3=1)

    reg.04H   m¢d pamØti:
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                         ³ ³ ÀÄ> 0: 1=textovì gener tor znak…; 0=grafickì
                         ³ ÀÄÄÄ> 1: 1=EGA RAM > 64K; 0=64K
                         ÀÄÄÄÄÄ> 2: 1=sekvenŸn¡; 0=lich /sud  (jako v CGA)

03CAH  - z pis: grafick  pozice 2 (pro EGA mus¡ bìt 0)
03CCH  - z pis: grafick  pozice 1 (pro EGA mus¡ bìt 1)

03CEH  - z pis: grafickì adresovì registr 1 a 2
03CFH  - z pis: registr dat ıadiŸe grafiky
              proveÔte OUT 03CEH,Ÿ¡slo_registru; potom OUT 03CFH,data

    reg.00H   nastaven¡/resetov n¡. Bity 0-3 vol¡ roviny z pisov‚ho m¢du 00
    reg.01H   mo§n‚ nastaven¡/resetov n¡
    reg.02H   porovn n¡ barev. Bity 0-3 vol¡ barvy pro Ÿtec¡ m¢d 01H
    reg.03H   rotace dat a volba funkce pro z pisovì m¢d 00H
              bity 0-2: nastaven¡ poŸtu rotac¡ pro z pisovì m¢d 00H
              bity 3-4: volba funkce pro z pisov‚ m¢dy 00H a 02H
                        00=beze zmØny; 01=AND; 10=OR; 11=XOR
    reg.04H   volba Ÿtec¡ mapy. Bity 0-2 vol¡ Ÿ¡slo mapy pro Ÿtec¡ m¢d 00H
    reg.05H   registr m¢du
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
                   ³ ³ ³ ³ ÀÄÁÄ> 0-1: z pisovì m¢d 0-2
                   ³ ³ ³ ÀÄÄÄÄÄ>  2:  podm¡nky testu
                   ³ ³ ÀÄÄÄÄÄÄÄ>  3:  m¢d Ÿten¡: 1=porovn. barev, 0=urŸen‚
                   ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  1=pou§¡t lich‚/sud‚ adresov n¡ RAM
                   ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  1=pou§¡t rozliçen¡ CGA (2 bity/bod)
    reg.06H   r…zn‚ grafick‚ ı¡d¡c¡ pı¡kazy
              ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
              ³7 6 5 4 3 2 1 0³
              ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
                       ³ ³ ³ ÀÄ>  0:  1=grafika; 0=mo§nì text. gener. znak…
                       ³ ³ ÀÄÄÄ>  1:  1=zmØna lich‚ mapy po sud‚
                       ÀÄÁÄÄÄÄÄ> 2-3: mapov n¡ pamØti pro CPU
                                      00=A000H (128K);   01=A000H (64K)
                                      10=B000H (32K MDA);11=B800H (32K CGA)
    reg.07H   z kaz maskov n¡ barev
              bity 0-3 vyj¡maj¡ roviny z porovn v. logiky ve Ÿtec¡m m¢du 01
    reg.08H   bitov   mask.  Bity  0-7  vol¡ bity, kter‚ budou maskov ny ve
              vçech rovin ch.

03B4H nebo 03D4H  - z pis: vìbØr ı¡d¡c¡ho registru CRT. Pou§ijte tento port
                           k  nastaven¡ nØkter‚ho z 18 registr… ıadiŸe CRT.
                           ProveÔte  instrukci  vìstupu  Ÿ¡sla  registru na
                           port    03B4H    nebo   03D4H   (OUT   03B4H,AL)
                           n sledovanou  Ÿten¡m  dat nebo z pis dat na port
                           03B5H nebo 03D5H.

03B5H nebo 03D5H  - ı¡d¡c¡  registr  ıadiŸe  CRT. Po vìbØru registru pomoc¡
                    portu  03B4H  nebo  03D4H lze pıes tento port Ÿ¡st nebo
                    pıes   nØj  zapisovat  data  do  nastaven‚ho  vnitın¡ho
                    registru ıadiŸe CRT.

    Pozn.: Bit  0 portu 03C0H nastavuje, kterì p r adres port… bude pou§it.
           (norm lnØ je pro MDA adresa 03BxH a pro CGA adresa 03DxH).




















       - z pis: vìznam registr… ıadiŸe displeje CRT je n sleduj¡c¡:
ÉÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º reg.³                        vìznam                                     º
ÌÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 00H ³ celkov  d‚lka horizont ln¡ synchronizace ve znakovìch taktech     º
º 01H ³ poŸet zobrazenìch znak… na ı dek                                  º
º 02H ³ poŸ tek horizont ln¡ho zatemnØn¡ (poŸet znak…)                    º
º 03H ³ konec horizont ln¡ho zatemnØn¡ (bity 0-4:jsou ç¡ıka zatemnØn¡;    º
º     ³                                 bity 5-6:mo§nì posuv 0 a§ 3)      º
º 04H ³ poŸ tek horizont ln¡ho zpØtn‚ho bØhu (znakov  pozice)             º
º 05H ³ konec horizont ln¡ho zpØtn‚ho bØhu (bity 0-4:ç¡ıka horizont ln¡ho º
º     ³    zpØtn‚ho bØhu; bity 5-6:prodleva zpØtn‚ho bØhu 0-3 znakovìch   º
º     ³    takt…; bit 7: 1=poŸ teŸn¡ plocha na lich‚ adrese; 0=sud‚       º
º 06H ³ poŸet zobrazenìch vertik ln¡ch linek celkem                       º
º 07H ³ bit 8 pro jist‚ registry CRT (jejich§ adresy se ud vaj¡ 9-bitovØ):º
º     ³       ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿                                           º
º     ³       ³7 6 5 4 3 2 1 0³                                           º
º     ³       ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit                                       º
º     ³            ³ ³ ³ ³ ³ ÀÄ> 0: vertik ln¡ch linek celkem (CRTC reg.6)º
º     ³            ³ ³ ³ ³ ÀÄÄÄ> 1: konec vertik l. zobraz. (CRTC reg.12H)º
º     ³            ³ ³ ³ ÀÄÄÄÄÄ> 2: zaŸ t. vertik. zpØtn‚ho bØhu (reg.10H)º
º     ³            ³ ³ ÀÄÄÄÄÄÄÄ> 3: zaŸ tek vertik. zatemnØn¡ (reg. 15H)  º
º     ³            ³ ÀÄÄÄÄÄÄÄÄÄ> 4: porovn n¡ ı dky (reg.18H)             º
º     ³            ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: pozice kurzoru (reg.0AH)              º
º 08H ³ pıednastaven¡ prvn¡ linky ı dku po vertik ln¡m zpØtn‚m bØhu       º
º 09H ³ adresa maxim ln¡ pomocn‚ linky (poŸet linek na znak)              º
º 0AH ³ poŸ teŸn¡ linka kurzoru                                           º
º 0BH ³ koneŸn  linka kurzoru                                             º
º 0CH ³ poŸ teŸn¡ adresa videopamØti-zaŸ tek zobraz. str nky (vyçç¡ bajt) º
º 0DH ³               -  "  -   (ni§ç¡ bajt)                              º
º 0EH ³ adresa kurzoru (vyçç¡ bajt)                                       º
º 0FH ³ adresa kurzoru (ni§ç¡ bajt)                                       º
º 10H ³ z pis:zaŸ tek vertik ln¡ho zpØtn‚ho bØhu                          º
º 11H ³ z pis:konec vertik ln¡ho zpØtn‚ho bØhu (bity 0-3: ç¡ıka zpØtn‚ho  º
º     ³       bØhu v link ch; bit 4: 0=nulov n¡ vertik.pıeruçen¡;         º
º     ³       bit 5: 0=mo§n‚ vertik ln¡ pıeruçen¡ IRQ 2                   º
º 12H ³ konec zobrazen¡ ve vertik ln¡m smØru (linka)                      º
º 13H ³ vystıedØn¡ obrazu ve vertik ln¡m zmØru                            º
º 14H ³ poloha podtr§en¡ (bity 0-5 jsou Ÿ¡sla linek)                      º
º 15H ³ zaŸ tek vertik ln¡ho zatemnØn¡ (linek)                            º
º 16H ³ konec vertik ln¡ho zatemnØn¡ (linek)                              º
º 17H ³ ı¡zen¡ m¢du                                                       º
º     ³       ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿                                           º
º     ³       ³7 6 5 4 3 2 1 0³                                           º
º     ³       ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit                                       º
º     ³        ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 0=m¢d kompatibiln¡ s graf. adres. CGA º
º     ³        ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: volba Ÿ¡taŸe pomocnìch ı dk…          º
º     ³        ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: horiz.zpØtnì bØh: 1=dvojitì vert.zp.b.º
º     ³        ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=pou§¡t znakov‚ hodiny/2 pro refresh º
º     ³        ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=nucen  vysok  impedance vìstupu     º
º     ³        ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: m¢d pıep¡n n¡ adres                   º
º     ³        ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=bajtovì adresovì m¢d; 0=slovn¡ adr. º
º     ³        ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 0=hardwarovì reset; 1=norm ln¡ operaceº
º 18H ³ porovn n¡ linek - pou§¡v  se pro operace s rozdØlenou obrazovkou  º
ÈÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

03BAH nebo 03DAH - z pis: bity 0-1 ı¡d¡ doplåuj¡c¡ ı¡d¡c¡ vìstupy FC0 a FC1
                 - Ÿten¡: stavovì registr (jako MDA-03BAH nebo CGA-03DAH)

    Pozn.: Bit  0  portu  03C0H nastavuje, kter  adresa portu bude pou§ita.
           (norm lnØ je pro MDA adresa 03BxH a pro CGA adresa 03DxH).

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ÀÄ> 0: zpØtnì bØh: 1=displej ve zpØtn‚m bØhu
                 ³ ³ ÀÄÄÄ> 1: 1=svØteln‚ pero je aktivov no
                 ³ ÀÄÄÄÄÄ> 2: 1=sp¡naŸ svØteln‚ho pera je otevıen
                 ÀÄÄÄÄÄÄÄ> 3: 1=prob¡h  vertik ln¡ synch. puls.
         Pozn.: U  karty  EGA nen¡ potıeba prov dØt synchronizaci z pisu do
                video RAM s vertik ln¡m zpØtnìm bØhem.

03BBH nebo 03DBH  - z pis: libovolnì vìstup vyma§e registr svØteln‚ho pera
03BCH nebo 03DCH  - z pis: libovolnì vìstup nastav¡ registr svØteln‚ho pera

    Pozn.: Bit  0 portu 03C0H nastavuje, kterì p r adres port… bude pou§it.
           (norm lnØ je pro MDA adresa 03BxH a pro CGA adresa 03DxH).




Nastaven¡ pıep¡naŸ… DIL na kartØ EGA
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Na  zadn¡  stranØ grafick‚ karty EGA je um¡stØno nØkolik pıep¡naŸ… DIL,
na  kterìch  je  mo§no  nastavit,  kterì monitor je pıipojen ke kartØ EGA a
kter‚  jin‚  adapt‚ry  (pokud  nØjak‚  jsou) jsou ve stejn‚ dobØ um¡stØny v
syst‚mu.  Nastaven¡  pıep¡naŸ…  je  ulo§eno  t‚§  v  datov‚m  prostoru BIOS
(prostor dat EGA).

    Je  tıeba  db t na to, aby nebyl nikdy pıipojen monochromatickì monitor
IBM  (typ TTL) k adapt‚ru EGA, dokud nebudou nastaveny pıep¡naŸe spr vnØ na
tento   monitor.   Chybn‚   nastaven¡  pıep¡naŸ…  zp…sob¡  fyzick‚  zniŸen¡
monitoruú!

    V    n sleduj¡c¡ch    tabulk ch    jsou    jako   "prim rn¡"   oznaŸeny
adapt‚ry/monitory,  kter‚  jsou  pıipojeny  jako prvn¡ po zapnut¡ poŸ¡taŸe.
Jako  "sekund rn¡"  jsou  oznaŸeny voliteln‚ adapt‚ry/monitory, kter‚ mohou
bìt pıipojeny k syst‚mu jako druh‚.

    Barevnì monitor ECM je Enhanced Color Monitor (zvØtçenì bar. monit.).


ON  Ú4Â3Â2Â1¿
    ³Û³ ³ ³Û³ prim rn¡ je EGA spojen  s barevnìm monitorem 40x25 znak…
    ³ ³Û³Û³ ³ sekund rn¡ je karta MDA
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³ ³ ³ ³ prim rn¡ je EGA spojen  s barevnìm monitorem 80x25 znak…
    ³ ³Û³Û³Û³ sekund rn¡ je karta MDA
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³ ³Û³Û³Û³ prim rn¡ je EGA spojen  s barevnìm monit. ECM (emulace CGA)
    ³Û³ ³ ³ ³ sekund rn¡ je karta MDA
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³ ³Û³Û³ ³ prim rn¡ je EGA spojen  s barev. monit. ECM (vyçç¡ rozliçen¡)
    ³Û³ ³ ³Û³ sekund rn¡ je karta MDA
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³ ³Û³ ³Û³ prim rn¡ je EGA spojen  s monochromatickìm monitorem
    ³Û³ ³Û³ ³ sekund rn¡ je karta CGA spojen  s barevnìm monitorem 40x25
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³ ³Û³ ³ ³ prim rn¡ je EGA spojen  s monochromatickìm monitorem
    ³Û³ ³Û³Û³ sekund rn¡ je karta CGA spojen  s barevnìm monitorem 80x25
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³Û³Û³Û³ prim rn¡ je karta MDA
    ³ ³ ³ ³ ³ sekund rn¡ je karta EGA spojen  s barevnìm monitorem 40x25
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³Û³Û³ ³ prim rn¡ je karta MDA
    ³ ³ ³ ³Û³ sekund rn¡ je karta EGA spojen  s barevnìm monitorem 80x25
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³Û³ ³Û³ prim rn¡ je karta MDA
    ³ ³ ³Û³ ³ sekund rn¡ je karta EGA spojen  s monitorem ECM (emulace CGA)
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³Û³ ³ ³ prim rn¡ je karta MDA
    ³ ³ ³Û³Û³ sekund rn¡ je karta EGA spojen  s monitorem ECM (lepç¡ rozl.)
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³ ³Û³Û³ prim rn¡ je karta CGA spojen  s barevnìm monitorem 40x25
    ³ ³Û³ ³ ³ sekund rn¡ je karta EGA spojen  s monochromatickìm monitorem
OFF ÀÄÁÄÁÄÁÄÙ

ON  Ú4Â3Â2Â1¿
    ³Û³ ³Û³ ³ prim rn¡ je karta CGA spojen  s barevnìm monitorem 80x25
    ³ ³Û³ ³Û³ sekund rn¡ je karta EGA spojen  s monochromatickìm monitorem
OFF ÀÄÁÄÁÄÁÄÙ

    M…stky  EGA:  na  kartØ  EGA  jsou  um¡stØny  tıi  propojovac¡  m…stky,
umo§åuj¡c¡ dalç¡ doplåuj¡c¡ nastaven¡ karty EGA.

    ÉP1Í»
  1 ºÚú¿º Podporuje barevnì monitor ECM (640x350 bod… a 64 barev)
  2 ºÀúÙº
  3 º ú º
    ÈÍÍÍ¼

    ÉP1Í»
  1 º ú º
  2 ºÚú¿º
  3 ºÀúÙº Podporuje pouze barevnì monitor (640x200 bod… a 16 barev)
    ÈÍÍÍ¼

    M…stel P2 je pıipojen¡ pro svØteln‚ pero.

    ÉP3Í»
  1 ºÚú¿º Nastaven¡ I/O portu EGA na 03xxH (norm ln¡ nastaven¡)
  2 ºÀúÙº
  3 º ú º
    ÈÍÍÍ¼

    ÉP3Í»
  1 º ú º
  2 ºÚú¿º
  3 ºÀúÙº Nastaven¡ I/O portu EGA na 02xxH (nepodporuje EGA BIOS)
    ÈÍÍÍ¼



        ÿ1ÿ1ÿ.ÿ-  ÿPÿaÿrÿaÿlÿeÿlÿnÿ¡  ÿpÿoÿrÿtÿy  ÿtÿiÿsÿkÿ ÿrÿeÿn

Porty 0378H - 037FH: paraleln¡ port #1 tisk rny
Porty 0278H - 027FH: paraleln¡ port #2 tisk rny
Porty 03B0H - 03BFH: monochromatickì displej/paraleln¡ port #3 tisk rny
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    ROM-BIOS podporuje a§ tıi paraleln¡ porty tisk ren, kter‚ jsou oznaŸeny
jako  LPT1  - LPT3. BØhem inicializaŸn¡ho testu pıi zapnut¡ poŸ¡taŸe (POST)
testuje BIOS tyto porty v tomto poıad¡:

  1.- 03BCH - nalezeno pıipojen¡ monochromn¡ho displeje k portu/tisk rna #3
  2.- 0378H - adapt‚r paraleln¡ho portu tisk rny #1
  3.- 0278H - adapt‚r paraleln¡ho portu tisk rny #2

    a pıiıad¡ port…m oznaŸen¡ jako LPT1-LPT3, tak jak jsou nalezeny. Ukl d 
adresy  port…  podle  vìsledku  testu od adresy 0:0408H (adresy paraleln¡ch
port… tisk ren).

    Slu§ba  BIOS  INT 17H umo§åuje plnou podporu a§ 4 tisk ren. K pıipojen¡
Ÿtvrt‚  tisk rny  mus¡te  um¡stit  jej¡ b zovou adresu do datov‚ho prostoru
BIOS jako slovo na adresu 0:0410H.


    Popisy  port…  jsou uv dØny pouze pro adresy 0378H-037FH; ostatn¡ porty
jsou analogick‚.

0378H-037FH Adapt‚r paraleln¡ho portu tisk rny #1 (LPT1)
              03BCH je b zov  adresa monochromn¡ho displeje
              0278H je b zov  adresa adapt‚ru paraleln¡ho portu tisk rny #2

0378H  - data tisk rny
       - z pis: vysl n¡ bajtu na tisk rnu
       - Ÿten¡: Ÿten¡ posledn¡ho vyslan‚ho bajtu na tisk rnu


037AH  - ı¡zen¡ tisk rny
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: +Strobe (pin 1)         (1 = vysl n¡ bajtu)
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: +AUTO LineFeed (pin 14) (1 = autom.LF po CR)
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: -INIT (pin 16)          (0 = reset tisk rny)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: +SLCT IN (pin 17)       (1 = vybere tisk rnu)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: +mo§n‚ pıeruçen¡ (hardwarov‚ pıeruçen¡, kdy§
         ³ ³ ³                                  sign l -ACK jde k nule)
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: v§dy = 0
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: v§dy = 0
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: v§dy = 0

    Generovan  pıeruçen¡:    LPT1 ÄÄÄ> IRQ 7 (INT 0FH)
                             LPT2 ÄÄÄ> IRQ 5 (INT 0DH)

0379H  - statut tisk rny (pouze Ÿten¡ portu)
        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: v§dy = 0
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: v§dy = 0
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: v§dy = 0
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: -ERROR (pin 15)(0=tisk rna signalizuje chybu)
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: +SLCT (pin 13) (1=tisk rna je vybr na)
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: +PE (pin 12)   (1=v tisk rnØ nen¡ pap¡r)
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: -ACK (pin 10)  (0=pıipravena na dalç¡ znak)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: -BUSY (pin 11) (0=zanepr zdn.,OFF-LINE,chyba)




    ÿ1ÿ2ÿ.ÿ-  ÿPÿoÿrÿt  ÿaÿsÿsÿyÿnÿcÿhÿrÿoÿnÿnÿ¡ÿhÿo  ÿaÿdÿaÿpÿtÿ‚ÿrÿu


    Prostor  dat  BIOS  obsahuje  vìpis  b zovìch  adres  a§ Ÿtyı s‚riovìch
(komunikaŸn¡ch)  port…  COM.  BØhem  inicializaŸn¡ho  testu  POST testuje a
inicializuje BIOS porty COM1 a COM2.

    - adapt‚r portu COM1 dek¢duje porty 03F8H a§ 03FFH (IRQ 4 / INT 0CH)
    - adapt‚r portu COM2 dek¢duje porty 02F8H a§ 02FFH (IRQ 3 / INT 0BH)

    Pıeruçen¡  ROM  BIOS  INT 14H bude pracovat s kterìmkoliv z tØchto Ÿtyı
port…,  pokud ulo§¡te b zovou adresu portu do tabulky port… COM zaaŸ¡naj¡c¡
na  adrese  0:0400H.  Je  nutn‚,  aby  § dn‚ dva adapt‚ry nesd¡lely stejnou
adresu nebo jinak nebudou pracovat.

Porty 03F8H - 03FFH: port asynchronn¡ho adapt‚ru COM1
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Analogicky pracuj¡ registry adapt‚ru COM2.

03F8H  - z pis: registr £schovy pıen çenìch dat - 8 bit… znaku k vysl n¡
       - Ÿten¡: registr pıij¡mac¡ho bufferu - 8 bit… pıijat‚ho znaku
Pro DLAB=1:
       - z pis: registr   dØliŸky  -  ni§ç¡  bajt  (pokud  DLAB=1,  tj.  po
                instrukci  OUT  03FBH,80H).  Po operaci OUT 03FBH,80H tento
                port  obsahuje  ni§ç¡ bajt dØliŸky taktu. SpoleŸnØ s vyçç¡m
                bajtem   (port   03F9H)  tvoı¡  16-bitovou  hodnotu,  kter 
                nastavuje rychlost pıenosu dat:
                ÉÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍ»
                º    baud   ³  dØliŸka  º    baud   ³  dØliŸka  º
                ÌÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÎÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍ¹
                º    110    ³   1040    º    1200   ³    96     º
                º    150    ³    768    º    2400   ³    48     º
                º    300    ³    384    º    4800   ³    24     º
                º    600    ³    192    º    9600   ³    12     º
                ÈÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍ¼
03F9H  - z pis: registr povolen¡ pıeruçen¡ (DLAB=1)
                ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
                ³7 6 5 4 3 2 1 0³
                ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
                 ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=mo§n‚ pıeruçen¡ pıi pı¡jmu dat
                 ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=mo§n‚ pıer. pıi pr zdn‚m vys. buff.
                 ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=mo§n‚ pıer. stavem pıij¡mac¡ linky
                 ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=mo§n‚ pıer. stavem modemu
                 ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: v§dy = 0
                 ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: v§dy = 0
                 ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: v§dy = 0
                 ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: v§dy = 0
       - z pis: registr   dØliŸky  -  vyçç¡  bajt  (pokud  DLAB=1,  tj.  po
                instrukci  OUT  03FBH,80H).  Po operaci OUT 03FBH,80H tento
                port  obsahuje  vyçç¡ bajt dØliŸky taktu. SpoleŸnØ s ni§ç¡m
                bajtem   (port   03F8H)  tvoı¡  16-bitovou  hodnotu,  kter 
                nastavuje rychlost pıenosu dat.








03FAH  - Ÿten¡: identifikaŸn¡  registr  pıeruçen¡. Pokud nastane pıeruçen¡,
                ŸtØte  tento  registr,  pokud  chcete zjistit, co zp…sobilo
                pıeruçen¡.
                ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
                ³7 6 5 4 3 2 1 0³
                ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
                 ³ ³ ³ ³ ³ ³ ³ ÀÄ>  0:  1=nenastalo § dn‚ pıeruçen¡
                 ³ ³ ³ ³ ³ ÀÄÁÄÄÄ> 1-2: 00=pıeruçen¡ stavem pıij¡mac¡ linky
                 ³ ³ ³ ³ ³                 vznik   pıi pıeteŸen¡, paritØ,
                 ³ ³ ³ ³ ³                 chybØ r mu nebo pıi pıeruçen¡.
                 ³ ³ ³ ³ ³                 Resetov n¡ Ÿten¡m stavu linky
                 ³ ³ ³ ³ ³                 (port 03FDH)
                 ³ ³ ³ ³ ³              01=pıijat  data platn  (resetov n¡
                 ³ ³ ³ ³ ³                 Ÿten¡m pıij¡m. bufferu 03F8H)
                 ³ ³ ³ ³ ³              10=vys¡lac¡ buffer pr zdnì (reset
                 ³ ³ ³ ³ ³                 z pisem do vys¡l. bufferu 03F8H)
                 ³ ³ ³ ³ ³              11=stav modemu. Vznik  pıi zmØnØ
                 ³ ³ ³ ³ ³                 sign l… CTS, DSR, RI nebo RLSD.
                 ³ ³ ³ ³ ³                 Reset Ÿten¡m stavu modemu 03FEH.
                 ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ>  3:  v§dy = 0
                 ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ>  4:  v§dy = 0
                 ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  v§dy = 0
                 ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  v§dy = 0
                 ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  v§dy = 0

03FBH  - Ÿten¡/z pis: ı¡d¡c¡ registr linky
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ  bit
          ³ ³ ³ ³ ³ ³ ÀÄÁÄ> 0-1: d‚lka slova: 00=5; 01=6; 10=7; 11=8
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ>  2:  stop-bity: 0=1, 1=2
          ³ ³ ³ ÀÄÁÄÄÄÄÄÄÄ> 3-4: parita: x0=§ dn ; 01=lich ; 11=sud 
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ>  5:  parita znaku (BIOS nepou§¡v )
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>  6:  mo§n‚ ı¡zen¡ BREAK; 1=zaŸ tek vys¡l n¡ 0s
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ>  7:  DLAB (pı¡stupovì bit k registru dØliŸky)
                                 - urŸuje m¢d port… 03F8H a 03F9H pro nast.
                                  (pokud je DLAB=1, je pı¡stup k dØliŸce)

03FCH  - z pis: ı¡d¡c¡ registr modemu
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=aktivace -DTR (-data terminal ready)
          ³ ³ ³ ³ ³ ³ ³          (informuje, §e Ÿek  na pı¡jem znaku)
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=aktivace -RTS (-request to send)
          ³ ³ ³ ³ ³ ³            (m  pıipraven znak k vysl n¡)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=aktivace -OUT1 (u§ivatelskì vìstup)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=aktivace -OUT2 (u§ivatelskì vìstup)
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=aktivace zpØtn‚ smyŸky pro diagnostiku
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: v§dy = 0
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: v§dy = 0
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: v§dy = 0

03FDH  - Ÿten¡: stavovì registr linky
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=data pıipravena (DR) (reset Ÿten¡m dat)
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=chyba pıeteŸen¡ (OE): pıedch. znak ztracen
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=chyba parity (PE): reset Ÿten¡m st.linky
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=chyba r mu (FE): çpatnì stop-bit ve znaku
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=indikace break (BI): pıijata dlouh  mezera
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=vys¡lac¡ registr pr zdnì (OK k vys¡l n¡)
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=vys¡laŸ pr zdnì. Nevys¡l  § dn  data.
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: v§dy = 0
         Pozn.: Pıi povolen‚m pıeruçen¡ (03F9H) zp…sob¡ bity 1-4 pıeruçen¡.

03FEH  - Ÿten¡: stavovì registr modemu
         ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
         ³7 6 5 4 3 2 1 0³
         ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
          ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=zmØna stavu DCTS (Delta Clear To Send)
          ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: 1=zmØna stavu DDSR (Delta Data Set Ready)
          ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: 1=aktivn¡ zvukov  signalizace TERI
          ³ ³ ³ ³ ³              (Trailing Edge Ring Indicator)
          ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: 1=zmØna st. DDCD (Delta Data Carrier Detect)
          ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: 1=CTS (Clear To Send) je aktivn¡
          ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: 1=DSR (Data Set Ready) je aktivn¡
          ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: 1=signalizace RI (Ring Indikator) je aktivn¡
          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: 1=DCD (Data Carrier Detect) je aktivn¡
         Pozn.: Pıi povolen‚m pıeruçen¡ (03F9H) zp…sob¡ bity 0-3 pıeruçen¡.


       ÿ1ÿ3ÿ.ÿ-  ÿPÿoÿrÿt  ÿhÿeÿrÿnÿ¡ÿhÿo  ÿIÿ/ÿO  ÿaÿdÿaÿpÿtÿ‚ÿrÿu


Port 0201H: port hern¡ho I/O adapt‚ru (joystickovì port)
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

    Port 0201H je oznaŸen jako port hern¡ho adapt‚ru nebo joystickovì port.
Nen¡  podporov n  modulem  ROM-BIOS poŸ¡taŸ… PC/XT, ale BIOS AT - pıeruçen¡
INT 15H/slu§ba 84H umo§åuje snadn‚ pou§it¡ interface pro tento adapt‚r.

    Jde  pıedevç¡m  o  analogovØ/digit ln¡ konvertor, kterì m…§e bìt pou§it
vØdeckìmi  mØı¡c¡mi pı¡stroji a jinìmi zaı¡zen¡mi, kter  obsahuj¡ analogovì
(odporovì)  vstup  na  interface. Umo§åuje pou§¡t a§ Ÿtyıi Ÿ¡slicov‚ vstupy
(data  zap/vyp,  jako  je  napı. stisk tlaŸ¡tka) a a§ Ÿtyıi odporov‚ vstupy
(jako  jsou  X-souıadnice  joysticku  nebo hodnota teploty z elektronick‚ho
teplomØru).

    Hodnota obdr§en  instrukc¡ IN z portu 0201H m  strukturu:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: Ax Ä¿
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1: Ay  ÃÄ> souıadnice (odporov‚, ŸasovØ
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2: Bx  ³               z visl‚ vstupy)
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3: By ÄÙ
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4: A1 Ä¿
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5: A2  ÃÄ> tlaŸ¡tka/spouçtØn¡ (Ÿ¡slicov‚ vstupy)
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6: B1  ³
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7: B2 ÄÙ

    OznaŸen¡:  A=joystick  A;  B=joystick  B; x,y = souıadnice X a Y; 1,2 =
               tlaŸ¡tka joysticku 1 a 2.

    Vstupy z tlaŸ¡tek (digit ln¡ vstupy) m…§ete Ÿ¡st t¡mto zp…sobem:

         mov       dx,201h             ; adresa portu
         out       dx,al               ; inicializace ı¡zen¡ (AL=cokoliv)
         in        al,dx               ; Ÿten¡ bit… 4-7 tlaŸ¡tek (0=stisk)

    Joysticky,  ovladaŸe,  mØı¡c¡  pı¡stroje  (odporov‚  vstupy) jsou Ÿteny
mØıen¡m  doby,  po  kterou  jsou  bity  X  nebo Y po instrukci OUTú0201H,xx
nastaveny na hodnotu 1.

    ¬ten¡ samostatnìch odporovìch vstup… (pı¡klad - souıad. X joysticku A):

         mov       dx,0201h            ; adresa portu
         out       dx,al               ; inicializace ı¡zen¡ (AL=cokoliv)
         mov       cx,-1               ; nastaven¡ Ÿ¡taŸe odporu
opet:    in        al,dx               ; Ÿten¡ nastaven¡
         inc       cx                  ; Ÿ¡taŸ
         test      al,1                ; pıeçel ji§ bit souıadnice X na 0 ?
         jnz       opet                ; Ÿek n¡ dokud je bit souı. X = 1

    Hodnota  prodlevy  nastı dan   v  registru  CX  bude  indikovat  pozici
souıadnice X joysticku A. Tato hodnota je relativn¡ a z vis¡ na koeficientu
pıevodu  cel‚ho pıevodn¡ho ıetØzce, tj. pıevodu polohy na interval a mØıen¡
d‚lky intervalu. Pro pıesnØjç¡ pıevod je lepç¡ pou§¡t hardwarov‚ho ŸasovaŸe
(odtran¡ i vliv pıeruçen¡ na pıevod).




          ÿ1ÿ4ÿ.ÿ-  ÿMÿaÿtÿeÿmÿaÿtÿiÿcÿkÿì  ÿkÿoÿpÿrÿoÿcÿeÿsÿoÿr


Porty 00F0H - 00FFH: matematickì koprocesor
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

00F0H  - AT: vynulov n¡ registru 80287 (OUT 00F0H,0).

00F1H  - AT: reset   80287   (OUT   00F1H,0);  koprocesor  je  resetov n  z
             chr nØn‚ho m¢du do re ln‚ho m¢du.

00F8H-00FCH  - AT: data  80287;  80286  vys¡l   operaŸn¡  k¢dy a operandy a
                   pıij¡m  vìsledky operac¡





               ÿ1ÿ5ÿ.ÿ-  ÿRÿoÿzÿçÿiÿıÿuÿjÿ¡ÿcÿ¡  ÿbÿoÿx  ÿXÿT


Porty 0210H - 0217H: rozçiıuj¡c¡ box XT
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

0210H  - ı¡d¡c¡ port rozçiıuj¡c¡ho boxu XT
0213H  - povolen¡ rozçiıuj¡c¡ho boxu XT
0215H  - registr datov‚ sbØrnice rozçiıuj¡c¡ho boxu XT
       - adresovì registr rozçiıuj¡c¡ho boxu XT (viçç¡ bajt)
0216H  - adresovì registr rozçiıuj¡c¡ho boxu XT (ni§ç¡ bajt)

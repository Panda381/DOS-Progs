 
ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±± º
º ±±                                                                   ±± º
º ±±                            ÿD  ÿO  ÿS                             ±± º
º ±±                                                                   ±± º
º ±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±± º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
                            (c) Miroslav NØmeŸek

    DOS  (Disk  Operating  System)  je hardwarovØ nez visl  Ÿ st operaŸn¡ho
syst‚mu,  kter   se  instaluje pýi startu operaŸn¡ho syst‚mu z diskety nebo
pevn‚ho  disku.  Zav dØn¡ operaŸn¡ho syst‚mu se prov d¡ naŸten¡m zav dØc¡ho
sektoru  z  disku,  kterì  zabezpeŸ¡  spr vn‚  naŸten¡  jednotlivìch  Ÿ st¡
operaŸn¡ho syst‚mu z disku do pamØti (viz slu§by BIOS - pýeruçen¡ INT 19H -
zaveden¡  operaŸn¡ho syst‚mu). Pro MS DOS (MicroSoft Disk Operating System)
se  operaŸn¡ syst‚m skl d  z Ÿ st¡ IO.SYS (doplåky vstupnØ/vìstupn¡ operac¡
k BIOS) a MSDOS.SYS (slu§by DOS).

    DOS  umo§åuje  pou§¡vat  dva typy syst‚movìch slu§eb: pýeruçen¡ (pomoc¡
instrukce  procesoru  INT  xx)  a vol n¡ funkc¡ (slu§by pýeruçen¡ INT 21H).
Pou§¡v n¡  syst‚movìch  slu§eb operaŸn¡ho syst‚mu umo§åuje u§ivateli snadno
ps t  programy  bez  znalosti hardware poŸ¡taŸe a pýenositeln‚ mezi r…znìmi
typy poŸ¡taŸ….

    Syst‚mov‚  slu§by je mo§n‚ vyvolat z Makroassembleru jednoduçe ulo§en¡m
po§adovanìch  dat  do  registr…  a vyvol n¡m pýeruçen¡. NØkter‚ slu§by ruç¡
obsahy registr… a proto je nutno pýed pou§it¡m tØchto funkc¡ uchovat obsahy
pý¡sluçnìch registr… (instrukcemi PUSH a POP).

    Pýi  vol n¡  syst‚movìch  slu§eb  z  vyçç¡ho  jazyka lze pou§¡t r…znìch
zp…sob….  Napý.  pýi  vol n¡  z  Basicu lze pou§¡t pý¡kazy CALL nebo funkce
USER.  U  kompil toru  je  mo§n‚  pýekl danì modul spojit s moduly v jazyku
symbolickìch  adres.  Microsoft  Pascal  zahrnuje funkci DOSXQQ, kterou lze
volat pý¡mo v programu v Pascalu k vol n¡ syst‚mov‚ funkce.

   K n vratu z programu do DOSu lze pou§¡t nØkolik zp…sob…:

         1.- Vol n¡ funkce 4CH:        MOV  AH,4CH
                                       INT  21H
             Tato metoda se pou§¡v  nejŸastØji.
         2.- Vol n¡ pýeruçen¡ INT 20H (nen¡ vhodn‚ - viz popis pýeruçen¡)
         3.- Skok na adresu 0 zaŸ tku prefixu programov‚ho segmentu;
                                       JMP  0

             Adresa  0  prefixu  programov‚ho  segmentu  obsahuje instrukci
             INTú20H (viz bod 2.-) - pouze programy typu COM
         4.- Vol n¡ funkce 00H:        MOV  AH,00H
                                       INT  21H
             Tato instrukce zp…sob¡ skok na adresu 0 (viz bod 3.-).
         5.- N vrat do syst‚mu a ponech n¡ programu rezidentn¡m: INT 27H

   Funkce operaŸn¡ho syst‚mu lze rozdØlit zhruba do dvou z kladn¡ch skupin:

         1.- znakov‚ vstupy a vìstupy (po slu§bu 0CH=12)
         2.- diskov‚ operace a pr ce se soubory (od slu§by 0DH=13)

    Vçechny  funkce  DOS  pracuj¡c¡  s  FCB  navrac¡  chybovì k¢d operace v
registru  AL  -  pýi  bezchybn‚ funkci navr t¡ k¢d 0, pýi chybØ navr t¡ k¢d
0FFH. Ostatn¡ funkce hl s¡ chybu nastaven¡m pý¡znaku pýenosu CF a um¡stØn¡m
chybov‚ho  k¢du  do registru AX. DOS 2.x navrac¡ chybov‚ k¢dy 0 - 12H (18).
Pod  DOS  3.x je lepç¡ volat funkci 59H, pomoc¡ n¡§ lze obdr§et podrobnØjç¡
informace  o  chyb ch  -  viz  popis funkce 59H, kde je t‚§ uveden podrobnì
seznam  chybovìch k¢d… DOS. Chybov‚ k¢dy nejsou u nØkterìch funkc¡ z tohoto
d…vodu ji§ uv dØny.



                            ÿVÿeÿrÿzÿe  ÿDÿOÿS


Verze DOS 1.0 vznikla z £spØçn‚ho operaŸn¡ho syst‚mu CP/M.

Verze DOS 1.1 vznikla  z  DOS 1.0 pouze opraven¡m nØkterìch chyb. Pokud v ç
              program  mus¡  bìt  provozov n  pod  DOS  verze  1.1, nesm¡te
              pou§¡vat funkce DOS vyçç¡ ne§ 2EH.

Verze DOS 2.0 vznikla  zaveden¡m  pevn‚ho  disku 20 MB (poŸ¡taŸe XT) firmou
              IBM. Tato verze umo§åovala:

              - v¡cen sobn‚   adres ýe  (tj.  podadres ýe)  ke  snadnØjç¡mu
                pý¡stupu na m‚dium s vyçç¡ kapacitou
              - vstupnØ/vìstupn¡   funkce   operac¡   se   soubory   pomoc¡
                identifik tor…   soubor…   (z   d…vodu  pracn‚ho  pou§¡v n¡
                ý¡d¡c¡ch blok… soubor… FCB)
              - standardn¡  vstupy/vìstupy  - mo§n‚ pýesmØýov n¡ podle typu
                UNIX
              - instalovateln‚  drivery  zaý¡zen¡ - zprostýedkov n¡ obsluhy
                nestandardn¡ch zaý¡zen¡ a RAM disk…, vŸetnØ driveru konzoly
                ANSI.SYS

Verze DOS 2.1 odstranila  nØkolik  chyb  verze  2.0 a pýipojila podporu pro
              disketov‚ drivery PCjr.

Verze DOS 3.0 pýiçla na svØt spolu s poŸ¡taŸi AT a obsahuje podporu pevn‚ho
              disku  20  MB. Pýidala podporu pro 16-bitovou tabulku alokac¡
              souboru FAT, Ÿ¡m§ minimalizovala nevyu§it‚ prostory na disku.
              Pýidala  rozç¡ýen   chybov  hl çen¡ funkc¡ DOS (pomoc¡ funkce
              DOS 59H). DoplnØny nov‚ povely DOS: ATTRIB, LABEL a VDISK.SYS
              (RAM-disk).

Verze DOS 3.1 obsahuje  nØkter‚  slu§by  pro pr ci v s¡ti (sd¡len¡ soubor…,
              uzamyk n¡  soubor…,  pýesmØýov n¡). DoplnØny nov‚ povely DOS:
              JOIN a SUBST.

Verze DOS 3.2 pýich z¡ spolu s IBM konvertabiln¡m PC. Je rozç¡ýena o slu§by
              ý¡zen¡ driver… zaý¡zen¡ IOCTL (funkce DOS 44H) a t¡m umo§nila
              napý.  form tov n¡  disku  pod ý¡zen¡m DOS atd. DoplnØny nov‚
              povely DOS: REPLACE, XCOPY a DRIVER.SYS (logick‚ disky).

Kompatibilita: VçeobecnØ  by  mØlo  platit,  §e  vyçç¡  verze  by  mØla bìt
               kopatibiln¡  se  starç¡  verz¡. Mnoho program… je ps no tak,
               aby  pracovalo  pod  DOS 2.x neboœ je tato verze dosud st le
               jeçtØ rozç¡ýena.

               Ovçem  vyçç¡  probl‚my s kompatibilitou nast vaj¡ vzhledem k
               omezen¡  pamØti.  Vyçç¡ verze DOS vy§aduj¡ st le v¡ce a v¡ce
               pamØti  a  ponech vaj¡ tak st le menç¡ prostor pro aplikaŸn¡
               programy.
               ÉÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
               º verze ³ prostor na disku ³ prostor v pamØti º
               ÌÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
               º  1.0  ³     11 551       ³      12 144      º
               º  1.1  ³     13 279       ³      12 400      º
               º  2.0  ³     39 424       ³      24 800      º
               º  2.1  ³     39 551       ³      24 800      º
               º  3.0  ³     58 926       ³      37 024      º
               º  3.1  ³     60 534       ³      37 040      º
               º  3.2  ³     68 637       ³      44 704      º
               ÈÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

               Probl‚my  vznikaj¡  u  instalovatelnìch driver… zaý¡zen¡ pro
               disky  fomr tu  NON-IBM.  NØkter‚ pracuj¡ pdo DOS 2.x, avçak
               nepracuj¡ ji§ pod DOS 3.x.


    VØtçina  verz¡  DOS  m   vysokou  kompatibilitu, avçak existuje nØkolik
m¡st, kde mohou nastat probl‚my:

    - Funkce  DOS  1BH  (poskytnut¡  informac¡  FAT)  ve  verzi  DOS 2.0 se
      ukonŸuje  navr cen¡m  ukazatele  na  aktu ln¡  FAT  a  pouze  navrac¡
      ukazatel na popisovaŸ m‚dia. FAT nemus¡ bìt v pamØti.

    - Funkce  DOS 4FH (nalezen¡ dalç¡ho souboru) m  mal‚ zmØny mezi verzemi
      DOS  2.x  a 3.x. Je po v s vy§adov no ponechat DS:DX, aby ukazoval na
      informace  z  vol n¡  funkce  4EH (nalezen¡ prvn¡ho souboru). DOS 2.x
      pouze pýedpokl d , §e to bylo na adrese DTA.

    - Funkce  30H  (poskytnut¡  Ÿ¡sla  verze  DOS)  v  DOS > 3.0 modifikuje
      registry BX a CX.

    - Funkce  DOS  38H  (n rodnostn¡ informace) navrac¡ nekompatibiln¡ blok
      n rodnostn¡ch informac¡.

    - Týi slova na konci tabulky BPB (viz drivery zaý¡zen¡) se pýep¡naj¡ ve
      verzi  DOS  3.0  z "voliteln‚ho" do "naý¡zen‚ho". Tak§e dbejte na to,
      aby  nØkter‚  drivery  NON-IBM  neukl daly  BPB do zav dØc¡ho sektoru
      pevn‚ho   disku   (to  se  aplikuje  pouze  u  pevnìch  disk…,  kter‚
      nepou§¡vaj¡ tabulku odd¡l… disku).





      ÿIÿnÿiÿcÿiÿaÿlÿiÿzÿaÿcÿe  ÿoÿpÿeÿrÿaÿŸÿnÿ¡ÿhÿo  ÿsÿyÿsÿtÿ‚ÿmÿu


    Inicializace  operaŸn¡ho syst‚mu se skl d  z nØkolika krok…. Po zapnut¡
poŸ¡taŸe  se  pýed   ý¡zen¡  na  adresu FFFF:0000H (standardn¡ funkce reset
procesoru) - na t‚to adrese je inicializaŸn¡ program ulo§enì v pevn‚ pamØti
ROM.  Po  vnitýn¡ch  inicializaŸn¡ch  testech poŸ¡taŸe se provede pýeruçen¡
INTú19H  (viz  popis tohoto pýeruçen¡ v popisu BIOS), kter‚ zp…sob¡ naŸten¡
zav dØc¡ho  sektoru  z  disku.  Tento  zav dØc¡ sektor pokraŸuje v zav dØn¡
operaŸn¡ho  syst‚mu t¡m zp…sobem, §e naŸte do pamØti z disku nejdý¡ve modul
operaŸn¡ho  syst‚mu IO.SYS (rozçiýuj¡c¡ modul BIOS) a potom modul MSDOS.SYS
(vlastn¡  Ÿ st  operaŸn¡ho syst‚mu MS-DOS). Nakonec se naŸte z disku soubor
COMMAND.COM,   kterì  slou§¡  jako  povelovì  interpreter,  kterì  umo§åuje
u§ivateli ovl d n¡ poŸ¡taŸe a prov dØn¡ pý¡kaz… operaŸn¡ho syst‚mu.

    Povelovì   interpreter   COMMAND.COM   (Ÿasto  nazìvanì  t‚§  pý¡kazovì
procesor) se skl d  ze tý¡ Ÿ st¡:

    1.- Hned  za  modulem  MSDOS.SYS  a  jeho  datovou  oblast¡  je ulo§ena
        rezidentn¡  Ÿ st  povelov‚ho  interpreteru  COMMAND.COM.  Tato Ÿ st
        obsahuje  programy  pro  obsluhu  pýeruçen¡ INT 23H (adresa obsluhy
        Ctrl-Break)  a  INT  24H  (adresa  obsluhy  kritickìch chyb) a tak‚
        program,  kterì znovu zavede doŸasnou Ÿ st povelov‚ho interpreteru,
        v§dy  kdy§  je  to  týeba.  V  tomto  modulu COMMAND.COM se prov d¡
        veçker‚ standardn¡ zpracov n¡ chyb. To zahrnuje zobrazen¡ chybovìch
        zpr v a zpracov n¡ zpr v typu "Abort, Retry, Ignore, Fail ?".

    2.- Za  rezidentn¡  Ÿ st¡  COMMAND.COM  n sleduje  inicializaŸn¡ modul.
        Tomuto  modulu  je  pýed no ý¡zen¡ pýi spuçtØn¡ programu a obsahuje
        rutinu,  kter   zabezpeŸ¡  vykon n¡  pý¡kaz…  ulo§enìch  v  souboru
        AUTOEXEC.BAT. InicializaŸn¡ modul urŸuje adresu segmentu, na kterou
        se  budou  zav dØt  programy.  Prvn¡m  programem, kterì COMMAND.COM
        zavede  do  pamØti,  je  tento  modul pýeps n, proto§e u§ v¡ce nen¡
        potýeba.

    3.- DoŸasnì modul se zav d¡ do horn¡ Ÿ sti pamØti. Tento modul obsahuje
        vìkonn‚  Ÿ sti  vçech  vnitýn¡ch  pý¡kaz…  a program pro zpracov n¡
        povelovìch   soubor…   (tzv.   d vkovì   procesor).  DoŸasnì  modul
        povelov‚ho  interpreteru  vyvol   n povØdu syst‚mu, pýeŸte pý¡kaz z
        kl vesnice  (nebo  pý¡kaz  povelov‚ho souboru) a zabezpeŸ¡ vykon n¡
        tohoto  pý¡kazu.  Pý¡kaz  m…§e bìt buÔ vnitýn¡ (obslu§nì program je
        um¡stØn  v  pamØti) nebo vnØjç¡ (do pamØti se zavede jako program a
        spust¡  se). Pro vnØjç¡ pý¡kazy tento modul vytvoý¡ pý¡kazovì ý dek
        a vol  funkci EXEC (funkce 4BH), kter  provede zaveden¡ programu do
        pamØti a jeho spuçtØn¡.




        ÿSÿtÿaÿrÿt  ÿpÿrÿoÿgÿrÿaÿmÿu  ÿa  ÿjÿeÿhÿo  ÿuÿkÿoÿnÿŸÿeÿnÿ¡


    DOS  um¡  naŸ¡st  z disku a spustit dva typy soubor… (program…) - COM a
EXE  (tyto  soubory  jsou  na  disku  oznaŸeny  jm‚nem  programu, za kterìm
n sleduje pý¡pona COM nebo EXE).

    Z d…vodu segmentovanìch adresovìch prostor… procesoru 8088/86/286/386 a
tak‚  d¡ky  skuteŸnosti,  §e  instrukce  JMP a CALL jsou relativn¡ k jejich
adrese,  je  mo§n‚ naŸ¡st do pamØti a spustit oba typy jmenovanìch program…
na  libovolnou  adresu  odstavce  do pamØti (tj. libovolnì n sobek 16 - viz
popis  zp…sobu  adresov n¡  mikroprocesoru  8088/86/286/386). Tak§e nØkter‚
programy  mohou  bìt  ulo§eny  do  pamØti  jako  rezidentn¡ (tj. jsou do n¡
um¡stØny  trvale  a§  do  vypnut¡ nebo resetov n¡ poŸ¡taŸe) do "n¡zk‚" Ÿ ti
pamØti  a  jin‚  programy  mohou  bìt  naŸteny  do pamØti nad £roveå tØchto
program…  a  tam  mohou  bìt  odstartov ny.  Programy  nejsou NIKDY ps ny s
pýedpokladem,  §e  by  mohly  bìt  naŸteny  v§dy  na  urŸitou adresu (kromØ
nØkterìch samo-zav dØc¡ch program… a her chr nØnìch proti kop¡rov n¡).

    - Soubor  (program)  ve  form tu COM je bin rn¡ soubor obsahuj¡c¡ Ÿ sti
      k¢du  programu a data programu. Soubor mus¡ bìt menç¡ ne§ 64K (zav d¡
      se  pouze  do  rozsahu  jednoho  segmentu)  a  nesm¡  obsahovat § dn‚
      relokaŸn¡  segmentov‚  polo§ky  (tj.  adresy  z visl‚ na segmentu, ve
      kter‚m je program um¡stØn).

    - Soubor  ve  form tu  EXE obsahuje na zaŸ tku speci ln¡ z hlav¡, kter‚
      urŸuje zp…sob zaveden¡ programu do pamØti a informace o referenc¡ch k
      segmentov‚ adrese.

    Pýed  zaveden¡m jak‚hokoliv programu do pamØti (COM nebo EXE) zvol¡ DOS
nejdý¡ve  segmentovou adresu, nazìvanou PSP (prefix programov‚ho segmentu),
jako  b zovou  adresu  pro  zaveden¡  programu.  DOS vybere nejni§ç¡ volnou
adresu  v  pamØti,  avçak  ý¡d¡c¡  program (jako je Microsoft Windows) m…§e
zvolit libovolnou Ÿ st pamØti. Potom DOS provede n sleduj¡c¡ kroky:

    - Provede zduplikov n¡ souŸasn‚ho prostýed¡ DOS pro program. Funkce DOS
      4BH (zaveden¡ programu z disku) d v  otcovsk‚mu (nadýazen‚mu) procesu
      mo§nost  definovat  vlastn¡ odliçn‚ prostýed¡. Napý. - program, kterì
      chce vyvolat COMMAND.COM, nastav¡ prompt DOSu tak, aby obsahoval text
      "Pou§ijte EXIT k n vratu do GENS80").

    - Verze DOS > 3.0 um¡st¡ za konec prostýed¡ zav dØc¡ cestu k programu.

    - Vypln¡  polo§ky v prefixu progamov‚ho segmentu informacemi u§iteŸnìmi
      pro program (viz Prefix programov‚ho segmentu):
         - celkov  voln  pamØœ pro program
         - segmentov  adresa prostýed¡ DOS
         - 0-2  neotevýen‚  ý¡d¡c¡ bloky soubor… FCB jako rozbor povelov‚ho
           ý dku  (parametry  zadan‚  za jm‚nem volan‚ho programu) - pozn.:
           pýi   otevýen¡   prvn¡ho   FCB   se  pýep¡çe  Ÿ st  druh‚ho  FCB
           n sleduj¡c¡ho za prvn¡m.
         - parametry povelu, vznikl‚ rozborem povelov‚ho ý dku - doplåuj¡c¡
           znaky zadan‚ v povelov‚m ý dku za jm‚nem programu
         - souŸasn‚ nastaven¡ vektor… INT 22H, INT 23H a INT 24H

    - Nastav¡ souŸasnou adresu pro diskov‚ pýenosy DTA na adresu PSP:0080H.

    - Nastav¡  registr  AX  tak,  aby indikoval platnost identifikace disk…
      (pokud  jsou nØjak‚ zad ny) parametr… zadanìch v povelov‚m ý dku jako
      specifikace souboru. Pokud je AL=0FFH, potom prvn¡ identifikace disku
      byla  neplatn . Pokud je AH=0FFH, potom byla druh  identifikace disku
      neplatn .

    Programy  ve  form tu  EXE  definuj¡  v¡cen sobn‚  programov‚ segmenty,
vŸetnØ  k¢du  programu,  dat  a segmentu z sobn¡ku. Soubor EXE se zav d¡ od
adresy  PSP:0100H.  Pýi jeho zav dØn¡ Ÿte DOS ze z hlav¡ programu relokaŸn¡
informace  a  prov d¡  relokace  segmentovìch  adres. To znamen , §e takov‚
reference, jako

         mov       ax,data_seg         ; adresa datov‚ho segmentu
         mov       ds,ax
nebo
         call      far_proc            ; vol n¡ vzd len‚ procedury

    mus¡  bìt  upraveny  tak, aby bylo mo§n‚ zaveden¡ programu do libovolnØ
zvolen‚ho segmentu pamØti. V¡ce informac¡ viz Form t souboru EXE.

    Po relokaci se pýed  ý¡zen¡ do zaveden‚ho modulu pomoc¡ instrukce skoku
typu FAR na adresu CS:IP, kter  je zjiçtØna ze z hlav¡ souboru EXE.

    Pokud program ve form tu EXE pýevezme ý¡zen¡, potom:

    - registry DS a ES jsou nastaveny na PSP (prefix programov‚ho segmentu)
    - CS, IP, SS a SP se nastav¡ na hodnoty zjiçtØn‚ ze z hlav¡ souboru EXE
    - pole  PSP  "horn¡  hranice  pamØti"  se  nastav¡  na hodnotu udanou v
      z hlav¡ souboru EXE. Norm lnØ se pýidØl¡ programu cel  voln  pamØœ.

    Programy  ve  form tu  COM  se definuj¡ v jednom segmentu (nebo alespoå
neprov dØj¡  explicitnØ  § dn‚ reference do jin‚ho segmentu). Bajty souboru
typu  COM  se  jednoduçe naŸ¡taj¡ z disku a ukl daj¡ se do pamØti od adresy
PSP:0100H (tj. stejnØ jako program typu EXE). Poznamenejme, §e program typu
COM m…§e sice pou§¡vat v¡cen sobn‚ segmenty, avçak mus¡ si s m pýepoŸ¡t vat
nebo  ý¡dit  segmentov‚  adresy  za pou§it¡ programov‚ho segmentu (CS) jako
b ze.

    Program…m ve form tu COM se d v  pýednost oproti program…m typu EXE pro
kr tk‚  programy  psan‚  ve  strojov‚m  k¢du.  Zav dØj¡  se rychleji, neboœ
nevy§aduj¡  § dn‚  relokace  segment…,  a  zab¡raj¡  m‚nØ prostoru na disku
(neboœ v zav dØn‚m modulu nemus¡ bìt z hlav¡ EXE ani segment z sobn¡ku).

    Po zaveden¡ programov‚ho souboru typu COM do pamØti:

    - CS, DS, ES a SS se nastav¡ na stejnì segment jako PSP
    - SP  se  nastav¡  na  konec segmentu PSP (obvykle hodnota FFFEH, avçak
      pokud  nen¡  zaplnØn  celì segment 64 KB, m…§e bìt i ni§ç¡). Slovo na
      offsetu  06H  prefixu programov‚ho segmentu PSP se nastav¡ na hodnotu
      indikuj¡c¡, kolik je v programov‚m segmentu voln‚ho m¡sta.
    - Veçker    syst‚mov    pamØœ  nad  programovìm  segmentem  se  pýidØl¡
      programu.
    - Do z sobn¡ku se ulo§¡ slovo 0000H (tak§e lze pro n vrat pou§¡t RET).
    - Ukazatel  IP  se  pomoc¡  skoku  JMP  na  adresu PSP:0100H nastav¡ na
      hodnotu 100H (prvn¡ bajt zaveden‚ho modulu).

    UkonŸen¡ programu EXE nebo COM je mo§n‚ nØkterou z tØchto mo§nost¡:

    - pou§it¡ funkce DOS 4CH (tato funkce je nejpou§¡vanØjç¡)
    - pou§it¡ funkce DOS 00H nebo vyvol n¡ INT 20H; CS mus¡ bìt nastaven na
      hodnotu PSP - to zajist¡te napý. t¡m, §e do z sobn¡ku ulo§¡te hodnotu
      segmentu  PSP (napý. pýi startu programu instrukc¡ PUSH DS) a slovo o
      hodnotØ  0000H  (instrukc¡  PUSH  0).  Pýi  ukonŸen¡  programu  pouze
      provedete  instrukci FAR RET (operaŸn¡ k¢d 0CBH), Ÿ¡m§ pýed te ý¡zen¡
      na INT 20H v PSP tak, jak to vy§aduje DOS.

    Funkce  4CH  odstraåuje  tyto  komplikace  a  umo§åuje  nav¡c  navracet
otcovsk‚mu  (nadýazen‚mu) procesu (obvykle COMMAND.COM) vìstupn¡ k¢d, kterì
m…§e  bìt  testov n  (v  COMMAND.COM  je to povel "IF ERRORLEVEL", otcovskì
proces m…§e pou§¡t funkci DOS 4DH).

    Program  je  mo§n‚  t‚§ ukonŸit s t¡m, §e z…stane trvale v pamØti (tzv.
rezidentn¡  program TSR) a§ do doby nov‚ho startu poŸ¡taŸe. K tomu je mo§n‚
pou§¡t  pýeruçen¡ INT 27H (starç¡ verze DOS) nebo funkci DOS 31H. Pýeruçen¡
INT 27H umo§åuje ponechat v pamØti rezidentn¡ program o maxim ln¡ velikosti
64  KB.  Funkce DOS 31H umo§åuje ponechat v pamØti i vØtç¡ Ÿ st ne§ 64 KB a
umo§åuje navracet do otcovsk‚ho procesu vìstupn¡ k¢d.



            ÿSÿtÿaÿnÿdÿaÿrÿdÿnÿ¡  ÿvÿsÿtÿuÿpÿyÿ/ÿvÿìÿsÿtÿuÿpÿy


    Verze  DOS  >  2.0  podporuj¡  pýesmØýov n¡  standardn¡ch  vstupn¡ch  a
standardn¡ch  vìstupn¡ch  zaý¡zen¡.  To je z klad techniky, kdy vstupy nebo
vìstupy programu prob¡haj¡ do jin‚ho programu.

    Dokud   nen¡   provedeno   pýesmØýov n¡,  prob¡h   standardn¡  vstup  z
kl vesnice  poŸ¡taŸe  a  standardn¡  vìstup  na  obrazovku  (tj. zaý¡zen¡ s
oznaŸen¡m  CON).  Otcovskì  proces  (jako  COMMAND.COM)  m…§e pýed pýed n¡m
ý¡zen¡  synovsk‚mu procesu pýesmØýovat buÔ standardn¡ vstup nebo standardn¡
vìstup  nebo  oba.  To  m…§e  bìt  velmi  vìkonnì  zp…sob,  jak si pýed vat
informace z procesu do procesu s minimem programov‚ho ý¡zen¡.

    Viz t‚§ Standardn¡ identifik tory soubor….

    Ke  Ÿten¡  nebo z pisu na standardn¡ vstupnØ/vìstupn¡ zaý¡zen¡ pou§ijte
znakov‚  funkce DOS 3FH (Ÿten¡) a 40H (z pis). Pokud si chcete bìt jist, §e
se  zobraz¡  hl çen¡  na  obrazovce,  pou§ijte  identifik tor  souboru  02H
(standardn¡ chybov‚ zaý¡zen¡) s funkc¡ 40H (z pis).

    - Pou§ijte funkci DOS 46H k pýesmØýov n¡ standardn¡ch vstup…/vìstup….
    - Pou§ijte funkci DOS 4BH k vyvol n¡ synovsk‚ho procesu.
    - Pou§ijte  funkci  DOS  44H  (IOCTL)  k  urŸen¡,  zda  bylo standardn¡
      vstupnØ/vìstupn¡ zaý¡zen¡ pýesmØýov no.
    - Atribut  zaý¡zen¡  (viz Instalovatelnì driver zaý¡zen¡) indikuje, zda
      je   zaý¡zen¡  pou§ito  jako  standardn¡  vstupn¡  a/nebo  standardn¡
      vìstupn¡ zaý¡zen¡.

    Povelovì   interpreter   DOS  (tj.  COMMAND.COM)  prov d¡  pýesmØýov n¡
vstup…/vìstup…  podle  povelov‚ho  ý dku  jeçtØ  pýed  proveden¡m vnitýn¡ho
povelu nebo pýed vyvol n¡m programu:

    proces < specifikace_souboru       - kl vesnicovì   vstup  probØhne  ze
                                         souboru
    proces > specifikace_souboru       - vìstup   na  displej  probØhne  do
                                         souboru  (soubor  se  pýi vyvol n¡
                                         nejdý¡ve zkr t¡ na nulovou d‚lku)
    proces >> specifikace_souboru      - vìstup na displej bude pýipojen do
                                         souboru  (na  jeho  konec,  soubor
                                         nebude zkracov n)
    proces1 | proces2                  - 1.- vyvol   proces  1,  vìstup  na
                                             obrazovku   jde  do  doŸasn‚ho
                                             souboru
                                         2.- vyvol    proces   2,  vstup  z
                                             kl vesnice   jde  z  doŸasn‚ho
                                             souboru
                                         3.- zruç¡ doŸasnì soubor

    Pozn.: Symbol "|" lze pou§¡t v¡cen sobnØ:
           DIR | SORT | FIND /v "i" > soubor.txt

           DoŸasnì  soubor  bude m¡t jedineŸn‚ jm‚no sestaven‚ z HEX Ÿ¡slic
           souŸasn‚ho  data  a  Ÿasu.  Vytv ý¡ se v§dy v aktu ln¡m adres ýi
           aktu ln¡ho disku.

    Pý¡klad - pou§it¡ pýesmØýov n¡ v povelu ECHO:

         ECHO ^L > PRN       (provede odstr nkov n¡ tisk rny)
         ECHO y|DEL *.*      (odpov¡ "yes" na ot zku "Are you sure?)
         ECHO ATDT 1(213)555-1234 >AUX (vyvol  telefonn¡ Ÿ¡slo)

    PýesmØýov n¡   vìstupu  na  zaý¡zen¡  NUL  odstran¡  nØkter   syst‚mov 
hl çen¡: COPY *.COM D: >NUL (odstran¡ hl çen¡ "1 File(s) copied").

    COMMAND.COM  bude  ignorovat  symbol  pýesmØýov n¡, pokud je uzavýen do
z vorek:
         REM Pou§¡v m znak ">" na tomto ý dku.






                  ÿRÿoÿzÿdÿØÿlÿeÿnÿ¡  ÿdÿiÿsÿkÿu  ÿDÿOÿS


    RozdØlen¡  disku  DOS se vztahuje k blokov‚mu zaý¡zen¡, na kter‚ se DOS
odkazuje  pomoc¡  absolutn¡ch  sektor…  (tj.  sektory  s  Ÿ¡slem od 0 a§ do
maxim ln¡  kapacity  disku,  obvykl  d‚lka sektoru je 512 bajt…). Absolutn¡
sektory  vçak  nemus¡ v§dy odpov¡dat fyzickìm sektor…m na disku. Pevnì disk
m…§e bìt rozdØlen na tzv. odd¡ly (partition) a ka§dì z odd¡l… se chov  jako
samostatnì disk. PodrobnØji viz kapitolu "Tabulka odd¡l… disku".

    V  prvn¡m  sektoru disku jsou um¡stØny informace o disku pro modul BIOS
(fyzickì  form t  disku  - poŸet sektor… na stopu, d‚lka sektoru, poŸ teŸn¡
sektor  datov‚  oblasti)  a pro DOS (poŸet sektor… celkem, poŸet sektor… na
alokaŸn¡  blok,  poŸet  polo§ek  adres ýe,  poŸ teŸn¡ sektor datov‚ oblasti
atd.).

    Dalç¡ prostor disku je rozdØlen podle n sleduj¡c¡ tabulky:

    - rezervovan  oblast (zav dØc¡ sektor)
    - prvn¡ kopie tabulky pýidØlen¡ blok… soubor…m (FAT)
    - druh  kopie tabulky pýidØlen¡ blok… soubor…m (FAT)
    - pý¡davn‚ kopie tabulky pýidØlen¡ blok… soubor…m (FAT) (nepovinn‚)
    - z kladn¡ (koýennì) adres ý disku
    - datov  oblast soubor… (sest v  z jednotlivìch alokaŸn¡ch blok…)

    Prostor pro soubor v datov‚ oblasti nen¡ pýidØlen spojitØ. PýidØluje se
soubor…m  pýi jejich ukl d n¡ pr…bØ§nØ po alokaŸn¡ch bloc¡ch. AlokaŸn¡ blok
je  Ÿ st  disku,  pýedstavuje  skupinu  urŸit‚ho  poŸtu sektor… jdouc¡ch za
sebou.  T¡mto zp…sobem je logick  posloupnost sektor… na disku rozdØlena na
kr tk‚  £seky,  kter‚  mohou  bìt pýidØlov ny soubor…m. Takto vznikaj¡ sice
nevyu§it   m¡sta  vznikl   pýi ne£pln‚m zaplnØn¡ alokaŸn¡ho bloku souborem,
avçak umo§åuje to rychl‚ operace se soubory.

    V  adres ýi  disku  jsou adres ýov‚ polo§ky jednotlivìch soubor…. Ka§d 
polo§ka obsahuje veçker‚ informace o pý¡sluçn‚m souboru. Obsahuje t‚§ Ÿ¡slo
prvn¡ho  alokaŸn¡ho  bloku,  kterì je souboru pýidØlen. Informace o dalç¡ch
alokaŸn¡ch  bloc¡ch  se  z¡skaj¡  z tabulky pýidØlen¡ blok… soubor…m (FAT -
File  Allokation  Tabelle).  Tabulka  FAT  je rozdØlena do polo§ek, jejich§
poŸet  odpov¡d   poŸtu  alokaŸn¡ch  blok…  na disku. Ka§d  polo§ka odpov¡d 
jednomu  bloku  na  disku  a  obsahuje  informaci,  kterì blok n sleduje za
blokem,  ke  kter‚mu  polo§ka  n le§¡.  T¡m se vytv ý¡ zýetØzen¡ alokaŸn¡ch
blok… pro pý¡sluçnì soubor. Pýi pý¡stupu k souboru se pýeŸte nejdý¡ve Ÿ¡slo
prvn¡ho alokaŸn¡ho bloku (z adres ýov‚ polo§ky). Pro tento alokaŸn¡ blok se
nalezne  v  pý¡sluçn‚  polo§ce  tabulky  FAT Ÿ¡slo n sleduj¡c¡ho alokaŸn¡ho
bloku a tak se postupuje tak dlouho, a§ se naraz¡ na koncovou znaŸku (Ÿ¡slo
alokaŸn¡ho bloku vØtç¡ ne§ (F)FF8H). Polo§ka tabulky FAT m…§e bìt 12-bitov 
nebo  16-bitov .  Obvykle se na disku uchov vaj¡ z lo§n¡ kopie FAT. Kdy§ se
na  disku  objev¡  çpatnì  sektor uprostýed prvn¡ FAT, m…§e se pou§¡t druh 
kopie. T¡m se vyhneme ztr t v d…sledku nepou§iteln‚ho disku.




                 ÿTÿaÿbÿuÿlÿkÿa  ÿoÿdÿdÿ¡ÿlÿ…  ÿdÿiÿsÿkÿu


    U  pevn‚ho disku neodpov¡d  absolutn¡ sektor, na kterì se odkazuje DOS,
pý¡mo  poýad¡ fyzick‚ho sektoru na disku. Disk m…§e bìt rozdØlen na nØkolik
odd¡l…  (partition) a t¡m v podstatØ na nØkolik disk…, na kter‚ se DOS m…§e
odkazovat.

    Fyzicky prvn¡ sektor na pevn‚m disku obsahuje "Hlavn¡ zav dØc¡ sektor",
kterì  se pýi zav dØn¡ operaŸn¡ho syst‚mu zavede do pamØti a tam se spust¡.
Konec  tohoto  sektoru obsahuje tabulku odd¡l… disku (rozdØlen¡ disku) - je
to  tabulka  o 4 polo§k ch, ka§d  polo§ka je 16 bajt… dlouh  a m…§e urŸovat
jeden  logickì  disk. S touto tabulkou je mo§n‚ manipulovat pomoc¡ programu
FDISK (standardn¡ program operaŸn¡ho syst‚mu DOS).

    Pýi  zav dØn¡  operaŸn¡ho  syst‚mu  zavede  ROM-BIOS  do  pamØti hlavn¡
zav dØc¡  sektor  pevn‚ho  disku  a  pýed   na  jeho adresu ý¡zen¡. Program
zav dØc¡ho  sektoru  nejdý¡ve  naŸte tabulku odd¡l… disku a pomoc¡ n¡ urŸ¡,
kterì  odd¡l  disku  je  oznaŸen  jako aktivn¡. Z tohoto odd¡lu potom naŸte
spr vnì zav dØc¡ sektor do pamØti a pýed  tomuto sektoru ý¡zen¡.

    Struktura hlavn¡ho zav dØc¡ho sektoru:
ÉÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º   offset   ³  velikost  ³                     obsah                     º
ÌÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 000H (  0) ³ 1BEH (446) ³ k¢d programu, kterì zavede a spust¡ zav dØc¡  º
º            ³            ³ sektor z aktivn¡ho odd¡lu disku               º
º 1BEH (446) ³  10H ( 16) ³ polo§ka odd¡lu 1                              º
º 1CEH (462) ³  10H ( 16) ³ polo§ka odd¡lu 2                              º
º 1DEH (478) ³  10H ( 16) ³ polo§ka odd¡lu 3                              º
º 1EEH (494) ³  10H ( 16) ³ polo§ka odd¡lu 4                              º
º 1FEH (510) ³  02H (  2) ³ oznaŸen¡ tabulky odd¡l… disku (AA55H)         º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Struktura polo§ky jednoho odd¡lu:
ÉÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º   offset   ³  velikost  ³                     obsah                     º
ÌÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º  00H ( 0)  ³     1      ³ zav dØc¡ pý¡znak: 0=neaktivn¡, 80H=aktivn¡    º
º  01H ( 1)  ³     1      ³ zaŸ tek odd¡lu - Ÿ¡slo hlavy                  º
º  02H ( 2)  ³     2      ³ zaŸ tek odd¡lu - sektor a v lec zav d. sektoruº
º  04H ( 4)  ³     1      ³ k¢d syst‚mu: 0=nezn mì, 1=FAT 12b, 4=FAT 16b  º
º  05H ( 5)  ³     1      ³ konec odd¡lu - Ÿ¡slo hlavy                    º
º  06H ( 6)  ³     2      ³ konec odd¡lu - sektor a v lec posledn¡ho sekt.º
º  08H ( 8)  ³     4      ³ Ÿ¡slo poŸ teŸn¡ho relativn¡ho sektoru         º
º  0CH (12)  ³     4      ³ velikost (celkovì poŸet sektor…)              º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Polo§ka  sektoru  a  v lce  specifikuje  sv‚ hodnoty tak, §e nejni§ç¡ch
6úbit…  ud v  Ÿ¡slo sektoru a vyçç¡ch 10 bit… ud v  Ÿ¡slo v lce. Tento £daj
je  tedy  v  takov‚m  tvaru,  kterì  t‚§ odpov¡d  nastaven¡ registru CX pýi
vol n¡ obsluhy INTú13H (obsluha disku). Pokud chcete napý. Ÿ¡st prvn¡ odd¡l
z  disku,  mus¡te  nejdý¡ve  pýeŸ¡st hlavn¡ zav dØc¡ sektor (adresa sektoru
CX=0)  do  bufferu 'buffer'. Potom instrukc¡ MOVúCX,buffer[01c0h] nastav¡te
hodnotu  registru  CX  pro  pýeruçen¡  INT 13H, pomoc¡ kter‚ho m…§ete takto
pýeŸ¡st zav dØc¡ sektor disku #1.

    Relativn¡   sektor  na  offsetu  08H  ka§d‚  polo§ky  odd¡lu  disku  je
ekvivalentn¡  hlavØ,  sektoru  a  v lci  poŸ teŸn¡ adresy odd¡lu. Relativn¡
sektor  0  je  ekvivalentn¡  sektoru  1 na v lci 0 a povrchu v lce Ÿ¡slo 0.
¬¡slo  relativn¡ho  sektoru  se inkrementuje nejdý¡ve pýi ka§d‚m sektoru na
stopØ,  potom  pýi  ka§d‚  hlavØ  (resp. povrchu disku) a nakonec pýi ka§d‚
stopØ  (nezapomeåte,  §e  poŸet  hlav  - povrch… - disku m…§e bìt u r…znìch
disk… velmi rozmanitì). K vìpoŸtu pou§ijte tento vztah:

        ( Ÿ¡slo_v lce * poŸet_sektor…_na_stopu * poŸet_hlav )
     +  ( Ÿ¡slo_hlavy * poŸet_sektor…_na_stopu )
     +  ( Ÿ¡slo_sektoru - 1 )
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     =  Ÿ¡slo_relativn¡ho_sektoru

    Jednotliv‚  odd¡ly  zaŸ¡naj¡  v§dy  na  sud‚m Ÿ¡sle v lce kromØ prvn¡ho
odd¡lu,  kterì  m…§e  zaŸ¡nat  na  v lci 0, hlavØ 0, sektoru 2 (sektor 1 je
obsazen hlavn¡m zav dØc¡m sektorem).

    Kdy§  zav dØc¡  sektor  odd¡lu  pýej¡m   ý¡zen¡, ukazuje registrovì p r
DS:SI na polo§ku tohoto odd¡lu v tabulce odd¡l… disku.




                ÿZÿaÿvÿ ÿdÿØÿcÿ¡  ÿsÿeÿkÿtÿoÿr  ÿdÿiÿsÿkÿu

    Zav dØc¡  sektor  disku  je  v§dy  prvn¡m sektorem na disku a to jak na
disku  DOS  (tj. napý. jednotliv‚ odd¡ly na pevn‚m disku), tak i jako prvn¡
fyzickì  sektor  na pevn‚m disku (oznaŸuje se jako hlavn¡ zav dØc¡ sektor).
Zav dØc¡  sektor  disku  obsahuje  z kladn¡  informace  o  disku,  jako  je
rozdØlen¡  disku,  velikosti  tabulek  FAT  a  z kladn¡ho  adres ýe, a tak‚
informaci o fyzick‚m form tu diskety (tj. kolik je sektor… na stopu) - tato
informace  se  ovçem netìk  stopy 0 na povrchu 0 disku, neboœ tato stopa je
naform tov na v§dy standardn¡m form tem (liç¡ se pouze podle typu pýipojen‚
disketov‚ mechaniky).

    Struktura zav dØc¡ho sektoru:
ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º  offset  ³ velikost ³                     obsah                         º
ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 00H ( 0) ³    3     ³ instrukce skoku na zaŸ tek programu zavadØŸe      º
º 03H ( 3) ³    8     ³ identifikaŸn¡ jm‚no a verze (napý. "IBM  3.2")    º
º 0BH (11) ³    2     ³ poŸet bajt… na sektor                             º
º 0DH (13) ³    1     ³ poŸet sektor… na alokaŸn¡ blok                    º
º 0EH (14) ³    2     ³ poŸet rezervovanìch sektor… (sektory pýed FAT)    º
º 10H (16) ³    1     ³ poŸet tabulek FAT                                 º
º 11H (17) ³    2     ³ poŸet polo§ek z kladn¡ho (koýenn‚ho) adres ýe     º
º 13H (19) ³    2     ³ celkovì poŸet sektor… na m‚diu (resp. odd¡lu DOS) º
º 15H (21) ³    1     ³ popisovaŸ m‚dia (stejn  hodnota jako 1. bajt FAT) º
º 16H (22) ³    2     ³ poŸet sektor… jedn‚ tabulky FAT                   º
º 18H (24) ³    2     ³ poŸet sektor… na stopu                            º
º 1AH (26) ³    2     ³ poŸet Ÿtec¡ch/z pisovìch hlav (= povrch… disku)   º
º 1CH (28) ³    2     ³ poŸet skrytìch sektor…                            º
ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Polo§ky  t‚to  struktury  od  polo§ky  na  offsetu  0BH (poŸet bajt… na
sektor)  a§  po  polo§ku  na  offsetu 16H (poŸet sektor… jedn‚ tabulky FAT)
odpov¡daj¡  tabulce  blok…  parametr…  BIOS  (BPB),  kterou  vytv ý¡ driver
zaý¡zen¡  pýi  povelu  vystavØn¡  tabulky  BPB (viz kapitola Instalovateln‚
drivery zaý¡zen¡).

    Na  offsetu  1EH  zaŸ¡n   nestandardn¡ Ÿ st, kterou pou§¡v  program pro
zav dØn¡  operaŸn¡ho  syst‚mu.  Podrobnosti  o tomto programu viz pýeruçen¡
INTú19H (zav dØn¡ operaŸn¡ho syst‚mu).

    PopisovaŸ  m‚dia  je  1-bajtovì  k¢d,  kterì  m…§e bìt (nØkdy) pou§it k
identifikaci  typu  m‚dia,  kter‚ je pou§ito v diskov‚m zaý¡zen¡. PopisovaŸ
m‚dia (Ÿasto t‚§ nazìvanì FAT ID = identifik tor FAT) m…§ete tak‚ spatýit:

         - jako hodnotu obdr§enou funkcemi DOS 1CH a 32H
         - jako prvn¡ bajt tabulky FAT (obvykle sektor DOS s Ÿ¡slem 1)
         - jako offset 0AH v tabulce bloku parametr… BIOS BPB
         - v datov‚m bloku pou§it‚m funkc¡ DOS 44H/podslu§ba 0DH
 
ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º  hodnota ³         typ m‚dia - definov no jako v DOS 3.2                º
ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º   F8H    ³  pevnì disk                                                  º
º   F9H    ³  disketa 5 1/4" HD, 2 strany, 15 sektor… na stopu            º
º   FCH    ³  disketa 5 1/4" DD, 1 strana, 9 sektor… na stopu             º
º   FDH    ³  disketa 5 1/4" DD, 2 strany, 9 sektor… na stopu             º
º          ³  disketa 8" (form t IBM 3740) SD, 2 strany, 26 sekt./stopu   º
º   FEH    ³  disketa 5 1/4" DD, 1 strana, 8 sektor… na stopu             º
º          ³  disketa 8" (form t IBM 3740) SD, 1 strana, 26 sekt./stopu   º
º          ³  disketa 8" DD, 2 strany, 26 sekt./stopu                     º
º   FFH    ³  disketa 5 1/4" DD, 2 strany, 8 sektor… na stopu             º
ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0: 1=2 strany; 0=nejsou 2 strany
                   ³ ÀÄÄÄ> 1: 1=8 sektor…; 0=nen¡ 8 sektor…
         1 1 1 1 1 ÀÄÄÄÄÄ> 2: 1=vyj¡matelnì; 0=nen¡ vyj¡matelnì

    Jak  vid¡te,  popisovaŸ  m‚dia neposkytuje pý¡liç spolehliv‚ informace,
proto  je  l‚pe  jej  pý¡liç  nepou§¡vat.  Napý.  zav dØc¡ sektor RAM-disku
(VDISK.SYS)  obsahuje  popisovaŸ  m‚dia indikuj¡c¡, §e jde o disketu 360úKB
(bez  ohledu na velikost RAM-disku). Tak§e, popisovaŸ m‚dia 0f8H se pou§¡v 
pro vçechny pevn‚ disky, a to je asi tak jedinì bod, kterì lze pou§¡t.






         ÿAÿlÿoÿkÿaÿŸÿnÿ¡  ÿtÿaÿbÿuÿlÿkÿa  ÿsÿoÿuÿbÿoÿrÿ…  ÿFÿAÿT

    AlokaŸn¡  tabulka  soubor…  (FAT)  je  um¡stØna  na  zaŸ tku  disku  za
zav dØc¡m  sektorem  a  pýed  z kladn¡m  adres ýem  disku.  DOS pou§¡v  FAT
kúurŸen¡  fyzick‚  polohy  dat  souboru  na  disku a k urŸen¡ voln‚ho m¡sta
kúulo§en¡  novìch  soubor….  Ka§d‚mu  alokaŸn¡mu  bloku na disku odpov¡d  v
tabulce  FAT jedna polo§ka. Slovo s offsetem 1AH v ka§d‚ adres ýov‚ polo§ce
ud v   Ÿ¡slo prvn¡ho alokaŸn¡ho bloku, kterì pý¡sluç¡ dan‚mu souboru. Pokud
se pod¡v te na polo§ku v tabulce FAT, kter  odpov¡d  tomuto bloku, zjist¡te
buÔ  Ÿ¡slo  n sleduj¡c¡ho bloku nebo znaŸku urŸuj¡c¡ konec souboru (tedy §e
tento  blok byl posledn¡). D‚lka jedn‚ polo§ky v tabulce FAT m  obvykle buÔ
12  bit…  nebo  16  bit…  (tj.  jedno  slovo).  Zn zornØme  si jako pý¡klad
pýidØlen¡ blok… souboru s polo§kami FAT po 8 bitech:

Polo§ka adres ýe:
    0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 A B C D E F
   ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
   ³S O U B O R    ³T X T³a³                   ³   ³   ³0 8³       ³
   ÃÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÅÄÁÄÁÄÅÄÅÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÁÄÅÄÁÄÅÄÁÄÅÄÁÄÅÄÁÄÁÄÁÄ´
   ³ jm‚no souboru ³ typ ³ ³    rezervov no    ³Ÿas³dat³ ³ ³velikost
                       atribut                           ³
                                                         ³poŸ teŸn¡
                             ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙalokaŸn¡ blok
                             ³
    00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14 15 16
   ÚÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄÂÄÄ¿
   ³ID³FF³FF³04>05>FF³00³00³09>0A>0B>12³0D>0E>0F>11³0C³FF³14³F7³15>FF³00³
   ÀÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄ³ÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄÄÁÄ³ÁÄÄÁÄÄÁÄÄÁÄÄÙ
                                      ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ>ÄÄÄÄÄÙÀÄÄÄÄÙ
    Tento pý¡klad zn zoråuje n sleduj¡c¡ informace:
    - Soubor  SOUBOR.TXT  je dlouhì 7 alokaŸn¡ch blok…. Prvn¡ alokaŸn¡ blok
      m  Ÿ¡slo 08H, za n¡m n sleduj¡ alokaŸn¡ bloky 09H, 0AH, 0BH, 12H, 14H
      a 15H, alokaŸn¡ blok 15H je oznaŸen jako posledn¡.

    - AlokaŸn¡  blok  (cluster)  13H  je oznaŸen jako vadnì a nen¡ souŸ st¡
      alokaŸn¡ho prostoru.

    - Bloky 06H, 07H a 16H jsou pr zdn‚ a jsou voln‚ pro dalç¡ pýidØlen¡.

    - Jsou  zde  jeçtØ  dva  soubory, prvn¡ zaŸ¡n  na alokaŸn¡m bloku 02H a
      obsahuje  d le  bloky  03H  a§  05H. Druhì soubor zaŸ¡n  na alokaŸn¡m
      bloku  10H  a  obsahuje  d le  bloky  0CH,  0DH,  0EH,  0FH a 11H. Ke
      zjiçtØn¡,   kterìm   soubor…m  tyto  bloky  patý¡,  je  nutn‚  nal‚zt
      adres ýov‚ polo§ky s Ÿ¡sly poŸ teŸn¡ch alokaŸn¡ch blok… 03H a 10H.


Um¡stØn¡ FAT na disku:

    FAT  norm lnØ zaŸ¡n  na logick‚m sektoru 1 v oddØlen¡ DOS (partition na
pevn‚m disku), tj. m…§ete jej Ÿ¡st pomoc¡ pýeruçen¡ INT 25H s DX=1. Jedinou
cestou,  jak  se  o  tom  pýesvØdŸit,  je  pýeŸ¡st zav dØc¡ sektor (DX=0) a
zkontrolovat  slovo  na  offsetu  0EH.  Toto slovo ý¡k , kolik zav dØc¡ch a
rezervovanìch sektor… je pýed tabulkou FAT. Pou§ijte toto Ÿ¡slo (obvykle=1)
v registru DX ke Ÿten¡ tabulky FAT pomoc¡ INT 25H.

    Na  disku m…§e bìt i v¡ce ne§ jedna kopie tabulky FAT. Jsou obvykl‚ dvØ
kompletn¡ kopie (dvØ stejn‚ tabulky FAT). Pokud jsou tabulky dvØ nebo v¡ce,
budou vçechny sousedit (druh  tabulka FAT n sleduje ihned za prvn¡).

    K z¡sk n¡ informac¡ o FAT m…§ete pou§¡t n sleduj¡c¡ slu§by:

         - Pou§ijte INT 25H k pýeŸten¡ zav dØc¡ho sektoru.
         - Pou§ijte  funkci  DOS  36H  nebo  1CH  k  urŸen¡ celkov‚ho poŸtu
           sektor… nebo alokaŸn¡ch blok… na disku.
         - Pou§ijte   funkci  DOS  44H  (pokud  driver  zaý¡zen¡  podporuje
           generov n¡ IOCTL) v DOS > 3.2
         - Pou§ijte  funkci  DOS  32H  k z¡sk n¡ vçech mo§nìch pou§itelnìch
           informac¡.

    Pozn.: Zav dØc¡  sektor  disku ne-zav dØc¡ho disku (jako s¡œov  blokov 
           zaý¡zen¡ a starç¡ pevn‚ disky) m…§e obsahovat pouze nesmysly.


Pou§it¡ 12-bitov‚/16-bitov‚ tabulky FAT:

    Tabulka  FAT  m…§e bìt nadefinov na pomoc¡ 12-bitovìch nebo 16-bitovìch
polo§ek. 12-bitov‚ polo§ky jsou velmi efektivn¡ pro m‚dia s kapacitou menç¡
ne§  384 KB - polo§ka FAT m…§e urŸovat jednoduchì 512-bajtovì sektor disku.
Pro  delç¡  m‚dia  mus¡  ka§d  polo§ka FAT adresovat delç¡ a delç¡ alokaŸn¡
bloky  (neboœ maxim ln¡ poŸet alokaŸn¡ch blok… je omezen hodnotou 212=4096)
a§  k  bodu,  kdy  by  pevnì  disk  20M pýi pou§it¡ 12-bitovìch polo§ek FAT
vy§adoval  alokaŸn¡ bloky dlouh‚ 16 sektor… (jinìmi slovy, 1-bajtovì soubor
by zabral na disku prostor 8 KB).

    16-bitov‚  polo§ky  FAT  byly  zavedeny  v  DOS  3.0 z d…vodu efektivn¡
obsluhy pevn‚ho disku AT 20 MB. Avçak disketov‚ jednotky a pevnì disk 10 MB
i  nad le  pou§¡vaj¡  12-bitov‚ polo§ky FAT. Zda se pou§¡v  FAT s polo§kami
12úbit… nebo 16úbit… m…§ete urŸit t¡mto postupem:

    DOS 3.0 ý¡k : Pokud  m   disk  v¡ce  ne§ 4086 (0ff6H) blok…, pou§ije se
                  16-bitov   tabulka  FAT  (4096  je  maxim ln¡ hodnota pro
                  12-bitov‚ Ÿ¡slo, hodnoty nad 0ff6H jsou rezervov ny).

    DOS 3.2 ý¡k : Pokud  m  disk v¡ce ne§ 20740 (5104H) sektor…, pou§ije se
                  16-bitov   tabulka  FAT  (tedy jakìkoliv disk s kapacitou
                  nad 10 MB pou§¡v  16-bitovou tabulku FAT).

    Je  vçeobecnØ  mylnìm  n zorem, §e 16-bitov  tabulka FAT neumo§åuje DOS
pracovat  s  disky  vØtç¡mi  ne§ 32 Megabajt…. Ve skuteŸnosti je omezuj¡c¡m
faktorem  kapacity  disku  to,  §e  pýeruçen¡  INT  25H/26H  (Ÿten¡ a z pis
absolutn¡ho sektoru na disk pro DOS) nen¡ schopn‚ adresovat SEKTOR s vyçç¡m
Ÿ¡slem  ne§ 65535, neboœ adresa sektoru se pýed v  v 16-bitov‚m registru DX
(a  216=65536). A proto§e sektory maj¡ norm lnØ velikost 512 bajt…, vyplìv 
z  toho  omezen¡  disku  na 32 MB. Nic vçak neý¡k , §e nem…§ete m¡t sektory
delç¡  ne§  512  bajt…,  tak§e DOS by potom teoreticky mohl obsluhovat disk
sújakoukoliv kapacitou.


¬ten¡ a z pis do tabulky FAT:

    Ke  Ÿten¡  hodnoty  z  polo§ky  FAT (napý. pýi zmØn ch ve FAT) nejdý¡ve
pýeŸtØte  po§adovanou  tabulku  FAT  do  pamØti a z adres ýe zjistØte Ÿ¡slo
poŸ teŸn¡ho  bloku (tj. t‚§ Ÿ¡slo polo§ky v tabulce FAT). Pozor - dbejte na
to,  §e 12-bitov‚ polo§ky mohou le§et na pýelomu sektor… (nen¡ vhodn‚ proto
pou§¡vat  bufferov n¡  pouze  jednoho  sektoru  FAT).  Operace s 16-bitovou
polo§kou  je  jednoduch   -  ka§d‚  slovo  v  tabulce obsahuje jednu adresu
alokaŸn¡ho  bloku (a t¡m i offset slova n sleduj¡c¡ polo§ky v tabulce FAT).
Pro 12-bitov‚ polo§ky pou§ijte n sleduj¡c¡ podprogramy:

readfat12:                        ; pýeŸten¡ obsahu polo§ky FAT 12b
                                  ; ES:0000 - adresa bufferu s tabulkou FAT
                                  ; AX - Ÿ¡slo po§adovan‚ho alokaŸ. bloku
         push      bx
         push      cx
         push      dx
         mov       cx,ax          ; £schova Ÿ¡sla po§adovan‚ho alok. bloku
         mov       bx,0003
         mul       bx             ; vyn soben¡ Ÿ¡sla bloku 3*
         mov       bx,0002
         div       bx             ; vydØlen¡ n sobku /2 (tedy blok * 1.5)
         mov       bx,ax          ; offset polo§ky ve FAT
         mov       ax,es:[bx]     ; pýeŸten¡ slova z FAT z vypoŸten‚ adresy
         test      cx,1           ; rozliçen¡, zda jde o lichì/sudì blok
         jz        rdf12su        ; je sudì  blok
         mov       cl,4           ; je lichì blok
         shr       ax,cl          ; rotace slova o 4 bity vpravo
rdf12su: and       ax,0fffh       ; AX = vìslednì obsah polo§ky FAT 12b
         pop       dx
         pop       cx
         pop       bx
         ret

writefat12:                       ; nastaven¡ obsahu polo§ky FAT 12b
                                  ; ES:0000 - adresa bufferu s tabulkou FAT
                                  ; AX - Ÿ¡slo po§adovan‚ho alokaŸ. bloku
                                  ; DI - nov  hodnota polo§ky FAT
         push      ax
         pop       bx
         push      cx
         push      dx
         push      di
         mov       cx,ax          ; £schova Ÿ¡sla po§adovan‚ho alok. bloku
         mov       bx,0003
         mul       bx             ; vyn soben¡ Ÿ¡sla bloku 3*
         mov       bx,0002
         div       bx             ; vydØlen¡ n sobku /2 (tedy blok * 1.5)
         mov       bx,ax          ; offset polo§ky ve FAT
         mov       ax,es:[bx]     ; pýeŸten¡ star‚ hodnoty slova z FAT
         test      cx,1           ; rozliçen¡, zda jde o lichì/sudì blok
         jz        wrf12su        ; je sudì blok
         and       ax,0fh         ; zbytek pýedeçl‚ polo§ky
         mov       cl,4
         shl       di,cl          ; rotace slova o 4 bity vlevo
wrf12ko: or        ax,di          ; slouŸen¡ s druhou polo§kou
         mov       es:[bx],ax     ; ulo§en¡ nov‚ hodnoty
         pop       di
         pop       dx
         pop       cx
         pop       bx
         pop       ax
         ret
wrf12su: and       ax,0f000h      ; zbytek n sleduj¡c¡ polo§ky
         jmp       wrf12ko        ; ulo§en¡ nov‚ hodnoty


Obsah polo§ek tabulky FAT:

    Prvn¡ bajt FAT se nazìv  "popisovaŸ m‚dia" (nebo t‚§ identifikaŸn¡ bajt
FAT - viz kapitolu Zav dØc¡ sektor disku). N sleduj¡c¡ch 5 bajt… (12-bitov 
FTA)  nebo  7  bajt… (16-bitov  FAT) jsou nastaveny na 0FFH. Zbytek tabulky
FAT   je  slo§en  z  12-bitovìch  nebo  16-bitovìch  bunØk,  ka§d   z  nich
reprezentuje  jeden alokaŸn¡ blok disku. Tyto buåky mohou obsahovat jednu z
n sleduj¡c¡ch hodnot:

         - (0)000H .................. volnì alokaŸn¡ blok
         - (F)FF0H a§ (F)FF7H ....... rezervovan‚ alokaŸn¡ bloky
         - (F)FF7H .................. vadnì blok (obsahuje vadnì sektor)
         - (F)FF8H a§ (F)FFFH ....... konec alokaŸn¡ho ýetØzce souboru
         - (0)002H a§ (F)FEFH ....... Ÿ¡slo bloku n sleduj¡c¡ v ýetØzci

         Pozn.: Nejvyçç¡  tetr da  hodnot  se  pou§¡v  pouze pro 16-bitovou
                tabulku  FAT; tzn. §e vadnì sektor se v 12-bitvo‚ FAT znaŸ¡
                0FF7H a v 16-bitov‚ FAT FFF7H.


Pýevod Ÿ¡sla alokaŸn¡ho bloku na Ÿ¡slo sektoru:

    Pokud  z¡sk te  z adres ýov‚ polo§ky Ÿ¡slo poŸ teŸn¡ho alokaŸn¡ho bloku
souboru,  budete  mo§n   cht¡t  urŸit  lokalizaci aktu ln¡ho sektoru disku,
kterì  obsahuje data souboru (nebo podadres ýe). Mus¡te pýitom uva§ovat, §e
poŸ teŸn¡  sektor  datov‚  oblasti  disku m…§e bìt r…znì. Napý. pro disketu
(nebo oddØlen¡ DOS pevn‚ho disku) m  disk n sleduj¡c¡ strukturu:

         - zav dØc¡ a rezervovan‚ sektory
         - tabulka FAT Ÿ¡slo 1
         - tabulka FAT Ÿ¡slo 2 (voliteln  - nepou§¡v  se u RAM disk…)
         - z kladn¡ (koýennì) adres ý
         - datovì prostor (obsahuje vçechny soubory a podadres ýe)

    Ka§d   sekce  t‚to struktury m…§e m¡t r…znou d‚lku a mus¡ bìt proto pro
spr vnou  koverzi  Ÿ¡sla  bloku  na Ÿ¡slo sektoru zn ma. N sleduj¡c¡ vztahy
reprezentuj¡ jedinou dokumentovanou metodu k urŸen¡ Ÿ¡sla logick‚ho sektoru
DOS z Ÿ¡sla alokaŸn¡ho bloku.

Sektor…_tabulek_FAT    = Tabulek_FAT * Sektor…_tabulky_FAT

Sektor…_z kl._adres ýe = (Polo§ek_adres ýe * 32) / Bajt…_na_sektor

ZaŸ tek_dat            = Rezervovanìch_sektor… + Sektor…_tabulek_FAT +
                         + Sektor…_z kl.adres ýe


Logickì_sektor = ZaŸ tek_dat + ((PoŸ teŸn¡_blok - 2) * Sektor…_na_blok


    Vçechny  potýebn‚ polo§ky pro vìpoŸet z¡sk te buÔ ze zav dØc¡ho sektoru
disku  (logickì  sektor  0)  nebo z bloku parametr… BIOS (pokud m te k nØmu
pý¡stup pomoc¡ funkce DOS 44h - IOCTL).

    Pokud  patý¡te mezi odv §nì typ lid¡, m…§ete si usnadnit pr ci pou§it¡m
nedokumentovan‚  funkce  DOS  32H  (poskytnut¡  informac¡  o  disku), kter 
prov d¡  shrnut¡  vçech  informac¡,  je§  byly  ji§ jednou pýed-vypoŸ¡t ny,
vŸetnØ Ÿ¡sla sektoru zaŸ tku datov‚ oblasti.

    Pozn.: Vhodn‚  pou§it¡  tØchto  informac¡  je napý. k vytvoýen¡ vlastn¡
           obsluhy   pro   vyhled v n¡   adres ýe  na  disku  pro  programy
           prov dØj¡c¡  vìpis  vçech  soubor…  a  adres ý…  na disku, neboœ
           vyhled v n¡  s  pý¡mìm  pý¡stupem  na  sektory  adres ý… pracuje
           zhruba dvakr t tak rychleji ne§ standardn¡ slu§ba DOS.





                   ÿAÿdÿrÿeÿsÿ ÿýÿoÿvÿ   ÿpÿoÿlÿoÿ§ÿkÿa

    Adres ý  obsahuje  jednu adres ýovou polo§ku pro ka§dì soubor na disku.
Ka§d  polo§ka m  d‚lku 32 bajt….

      Struktura adres ýov‚ polo§ky:
      ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
      º  offset  ³ d‚lka ³         n zev                             º
      ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
      º 00H ( 0) ³   8   ³ jm‚no souboru                             º
      º 08H ( 8) ³   3   ³ rozç¡ýen¡ jm‚na souboru                   º
      º 0BH (11) ³   1   ³ atributy souboru                          º
      º 0CH (12) ³  10   ³ rezervov no                               º
      º 16H (22) ³   2   ³ Ÿas posledn¡ho z pisu                     º
      º 18H (24) ³   2   ³ datum posledn¡ho z pisu                   º
      º 1AH (26) ³   2   ³ poŸ teŸn¡ alokaŸn¡ blok dat souboru       º
      º 1CH (28) ³   4   ³ velikost souboru                          º
      ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    - Jm‚no souboru je 8 znak… ASCII. Pokud je jm‚no kratç¡ ne§ 8 znak…, je
      doplnØno  zprava  mezerami. DOS pou§¡v  prvn¡ bajt t‚to polo§ky jeçtØ
      pro dva zvl çtn¡ k¢dy:

         00H (0)   - konec pýidØlen‚ pamØti adres ýe (tato polo§ka adres ýe
                     nebyla dosud jeçtØ nikdy pou§ita)
         E5H (229) - voln   adres ýov   polo§ka (soubor specifikovanì touto
                     polo§kou  adres ýe  byl  zruçen  a pokud jeho alokaŸn¡
                     bloky  nebyly pou§ity jinìm souborem, lze tento soubor
                     jeçtØ  obnovit  -  m¡sto  bajtu E5H se navr t¡ p…vodn¡
                     prvn¡ znak jm‚na souboru).

    - Rozç¡ýen¡  jm‚na souboru jsou 3 znaky ASCII. Pokud je rozç¡ýen¡ jm‚na
      souboru  kratç¡ ne§ 3 znaky, je doplnØno zprava mezerami. Mezi jm‚nem
      souboru a rozç¡ýen¡m jm‚na souboru se neuv d¡ teŸka. Rozç¡ýen¡m jm‚na
      souboru mohou bìt sam‚ mezery (tj. nen¡ rozç¡ýen¡ jm‚na souboru).

    - Atributy souboru ud vaj¡ bli§ç¡ £daje o souboru:

        ÚÄÂÄÂÄÂÄÂÄÂÄÂÄÂÄ¿
        ³7 6 5 4 3 2 1 0³
        ÀÂÁÂÁÂÁÂÁÂÁÂÁÂÁÂÙ bit
         ³ ³ ³ ³ ³ ³ ³ ÀÄ> 0 (  1): pouze Ÿten¡ souboru (Read-only "R/O")
         ³ ³ ³ ³ ³ ³ ÀÄÄÄ> 1 (  2): skrytì soubor (Hidden "HID")
         ³ ³ ³ ³ ³ ÀÄÄÄÄÄ> 2 (  4): syst‚movì soubor (System "SYS")
         ³ ³ ³ ³ ÀÄÄÄÄÄÄÄ> 3 (  8): n vØçt¡ disku (Volume Label "VOL")
         ³ ³ ³ ÀÄÄÄÄÄÄÄÄÄ> 4 ( 16): podadres ý (Directory "DIR")
         ³ ³ ÀÄÄÄÄÄÄÄÄÄÄÄ> 5 ( 32): archivn¡ soubor (Archive "ARC")
         ³ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄ> 6 ( 64): rezervov no (mus¡ bìt nastaven na 0)
         ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ> 7 (128): rezervov no (mus¡ bìt nastaven na 0)

         - Pouze  Ÿten¡  souboru  -  takto oznaŸen‚ soubory lze pouze Ÿ¡st,
           nelze  do  nich  zapisovat  ani  je  nijak  modifikovat. Pokus o
           otevýen¡  souboru  pro  vìstup nebo vytvoýen¡ souboru se stejnìm
           jm‚nem  vyvol   chybov‚ hl çen¡ syst‚mu. Pýi vypisov n¡ adres ýe
           se soubory vypisuj¡ norm ln¡m zp…sobem.

         - Skrytì soubor - skryt‚ soubory se neobjevuj¡ v syst‚mov‚m vìpisu
           adres ýe,   pýi   hled n¡  soubor…  se  vçak  chovaj¡  norm ln¡m
           zp…sobem.

         - Syst‚movì   soubor  -  takto  oznaŸen‚  soubory  jsou  pou§¡v ny
           operaŸn¡m  syst‚mem (jako napý. IO.SYS, MSDOS.SYS). Tyto soubory
           se neobjevuj¡ v norm ln¡m hled n¡ soubor….

         - N vØçt¡ disku je pou§ito pro oznaŸen¡ (pojmenov n¡) disku pomoc¡
           11  znak….  Vçechny dalç¡ informace v adres ýov‚ polo§ce n vØçt¡
           jsou  ignorov ny.  N vØçt¡  nen¡  soubor  -  pou§¡v  pouze jednu
           polo§ku adres ýe, ale neobsahuje § dn  dalç¡ data. Na disku m…§e
           bìt  pouze jedno n vØçt¡, kter‚ je um¡stØno v z kladn¡m adres ýi
           disku.

         - Adres ý   -   tato   polo§ka   specifikuje  vnoýenì  podadres ý.
           Podadres ý je norm lnØ vyjmut z hled n¡ soubor….

         - Archivn¡  soubor  -  tento  bit, pokud je nastaven, indikuje, §e
           soubor  byl  zmØnØn  od  doby,  kdy byl naposledy z lohov n (tj.
           nebyl  z lohov n  programem BACKUP). Tento bit je nastaven v§dy,
           kdykoliv je do souboru zapisov no a potom je uzavýen.

         Pozn.: Funkce  pro  hled n¡  souboru  (funkce  DOS  11H  a  4EH) s
                atributem  nastavenìm  na  0  vyhled   vçechny  soubory bez
                nastavenìch  atribut…  nebo  soubory s nastavenìmi atributy
                "pouze Ÿten¡ souboru" a/nebo "archivn¡ soubor".

                Pý¡znaky  adres ýe  a  n vØçt¡  disku  nelze mØnit pou§it¡m
                funkce DOS CHMOD (funkce 43H).

    - ¬as  posledn¡ho  z znamu ud v  Ÿas, kdy byl soubor naposledy vytvoýen
      nebo  aktualizov n.  Hodina,  minuta  a  sekunda jsou zaps ny ve dvou
      bajtech takto:

       vyçç¡ bajt (relat. adresa 17H):     ni§ç¡ bajt (relat. adresa 16H):

       15  14  13  12  11  10   9   8       7   6   5   4   3   2   1   0
      ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿   ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
      ³ H ³ H ³ H ³ H ³ H ³ M ³ M ³ M ³   ³ M ³ M ³ M ³ S ³ S ³ S ³ S ³ S ³
      ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ   ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
       ³                 ³ ³                         ³ ³                 ³
       ÀÄ hodina (0-23) ÄÙ ÀÄÄÄÄÄ minuta (0-59) ÄÄÄÄÄÙ ÀÄ sekunda (0-29) Ù
                                                      (£daj se vyn sob¡ 2*)

    - Datum posledn¡ho z znamu ud v  den, kdy byl soubor naposledy vytvoýen
      nebo  aktualizov n.  Rok,  mØs¡c  a  den jsou zaps ny ve dvou bajtech
      takto:

       vyçç¡ bajt (relat. adresa 15H):     ni§ç¡ bajt (relat. adresa 14H):

       15  14  13  12  11  10   9   8       7   6   5   4   3   2   1   0
      ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿   ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
      ³ R ³ R ³ R ³ R ³ R ³ R ³ R ³ M ³   ³ M ³ M ³ M ³ D ³ D ³ D ³ D ³ D ³
      ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ   ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
       ³                         ³ ³                 ³ ³                 ³
       ÀÄÄÄÄÄÄ rok (0-119) ÄÄÄÄÄÄÙ ÀÄÄ mØs¡c (1-12) ÄÙ ÀÄÄÄ den (1-31) ÄÄÙ
    (k £daji se pýiŸte 1980, tj. 1980 a§ 2099)

    - Velikost  souboru  ud v  velikost souboru v bajtech. Prvn¡ slovo t‚to
      polo§ky  ud v   ni§ç¡  ý d  £daje.




   ÿPÿrÿeÿfÿiÿx  ÿpÿrÿoÿgÿrÿaÿmÿoÿvÿ‚ÿhÿo  ÿsÿeÿgÿmÿeÿnÿtÿu  ÿ(ÿPÿSÿPÿ)


    Prefix  programov‚ho  segmentu  (Programm Segment Prefix - PSP) je Ÿ st
programu  (datov   oblast dlouh  256 bajt…) pýedch zej¡c¡ samotnì program a
obsahuj¡c¡  pomocn   data  pro  pr ci programu. Prefix progamov‚ho segmentu
(PSP) se pýi po§adavku naŸten¡ programu vytvoý¡ na zaŸ tku voln‚ho prostoru
pamØti  (tj.  za koncem ji§ pou§it‚ho pracovn¡ho prostoru RAM). Za PSP (tj.
na  adresu  posunutou o 256 bajt… od zaŸ tku PSP) se naŸte program COM nebo
EXE,  kterì  m   bìt  odstartov n.  Na  zaŸ tek PSP v§dy po startu programu
ukazuj¡  registry  DS:0000H  a ES:0000H (PSP tedy mus¡ zaŸ¡nat na absolutn¡
adrese,  kter   je n sobkem 16). Pýi naŸten¡ program… typu COM do pamØti se
nastavuje  registr  CS  na zaŸ tek prefixu programov‚ho segmentu a ukazatel
instrukc¡  na  hodnotu  100H  (tak§e  po  startu programu COM je CS=DS=ES a
IP=100H).  Pýi  naŸten¡ program… typu EXE do pamØti se nastavuje registr CS
na  datovì  segment,  kterì  n sleduje  ihned za PSP, ukazatel instrukc¡ se
nastav¡  obvykle na zaŸ tek programu (pokud nen¡ jinak specifikov no; tak§e
po  startu  programu EXE je DS=ES, CS=DS+0010H, IP=0). Na polo§ky v prefixu
programov‚ho  segmentu  se  lze  tedy po startu programu odvol vat adresac¡
pomoc¡  datov‚ho  segmentu  DS nebo pomoc¡ segmentu ES, u program… typu COM
jeçtØ nav¡c pomoc¡ programov‚ho segmentu CS.

    Prefix programov‚ho segmentu m  n sleduj¡c¡ strukturu:
ÉÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º offset ³ d‚lka ³             popis                                      º
ÌÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º   00H  ³   2   ³ instrukce INT 20H - ukonŸen¡ programu (viz popis)      º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   02H  ³   2   ³ vrchol  pamØti  (adresa  segmentu  vrcholu  alokŸan¡ho º
º        ³       ³ bloku pamØti programu)                                 º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   04H  ³   1   ³ rezervov no                                            º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   05H  ³   1   ³ instrukce INT 21H - vyvol n¡ funkce DOS (viz popis)    º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   06H  ³   2   ³ voln  pamØœ - poŸet volnìch bajt… v segmentu (pro COM) º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   08H  ³   2   ³ rezervov no                                            º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   0AH  ³   4   ³ adresa  ukonŸen¡  programu  (IP,CS).  Obsahuje p…vodn¡ º
º        ³       ³ adresu   obsluhy   pýeruçen¡   pro  ukonŸen¡  programu º
º        ³       ³ (INTú22H).  Adresa  INTú22H  m…§e  bìt  zmØnØna  podle º
º        ³       ³ po§adavk…   u§ivatelsk‚ho   programu.   Pýi   ukonŸen¡ º
º        ³       ³ programu DOS navr t¡ pomoc¡ t‚to polo§ky p…vodn¡ obsah º
º        ³       ³ vektoru INTú22H.                                       º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   0EH  ³   4   ³ adresa  obsluhy u§ivatelsk‚ho pýeruçen¡ <Ctrl>-<Break> º
º        ³       ³ (<Ctrl>-C)  (IP,CS).  U§ivatelskì program m…§e obsluhu º
º        ³       ³ u§ivatelsk‚ho   pýeruçen¡   <Ctrl>-<Break>  (<Ctrl>-C) º
º        ³       ³ (INTú23H)   zmØnit  podle  svìch  po§adavk….  DOS  pýi º
º        ³       ³ ukonŸen¡   programu   navr t¡  p…vodn¡  obsah  vektoru º
º        ³       ³ INTú23H z t‚to polo§ky.                                º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   12H  ³   4   ³ adresa   obsluhy  kritickìch  chyb  (IP,CS).  Obsahuje º
º        ³       ³ p…vodn¡  adresu  obsluhy  kritickìch  chyb  (INTú24H). º
º        ³       ³ Adresa   INTú24H  m…§e  bìt  zmØnØna  podle  po§adavk… º
º        ³       ³ u§ivatelsk‚ho  programu.  Pýi  ukonŸen¡  programu  DOS º
º        ³       ³ navr t¡  pomoc¡  t‚to  polo§ky  p…vodn¡  obsah vektoru º
º        ³       ³ INTú24H.                                               º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   16H  ³   22  ³ rezervov no                                            º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   2CH  ³    2  ³ prostýed¡ - adresa segmentu prostýed¡ DOS              º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   2EH  ³   46  ³ rezervov no                                            º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   5CH  ³   16  ³ neotevýenì  standardn¡ ý¡d¡c¡ blok souboru FCB1 (prvn¡ º
º        ³       ³ parametr pý¡kazov‚ho ý dku - nastaveno po startu)      º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   6CH  ³   20  ³ neotevýenì  standardn¡ ý¡d¡c¡ blok souboru FCB2 (druhì º
º        ³       ³ parametr pý¡kazov‚ho ý dku - nastaveno po startu)      º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   80H  ³    1  ³ d‚lka parametru - poŸet bajt… parametru pý¡kaz. ý dku; º
º        ³       ³ souŸasnØ t‚§ implicitn¡ adresa diskovìch pýenos… DTA   º
ÌÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   81H  ³  127  ³ parametr   pý¡kazov‚ho  ý dku  (zbytek  za  pý¡kazem). º
º        ³       ³ Pou§¡v  se t‚§ jako standardn¡ DTA (adresa 80H)        º
ÈÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

Pozn.: Programy  by nemØly mØnit § dn  data v prefixu programov‚ho segmentu
       pod  adresou  5CH,  neboœ  DOS  pou§¡v   tyto informace pýi ukonŸen¡
       programu (jejich zmØna m…§e m¡t za n sledek havarii syst‚mu).

       Druhì  ý¡d¡c¡  blok  souboru FCB2 na adrese 6CH je pýeps n, pokud je
       pou§it  prvn¡  FCB  (na adrese 5CH) k otevýen¡ souboru. To je z toho
       d…vodu,  §e  pro  prvn¡  FCB  je rezervov no pouze 16 bajt…, zat¡mco
       polo§ka  FCB  vy§aduje  prostor  37 bajt… (pýekryje tedy celì FCB2 i
       bajt  d‚lky  parametru pý¡kazov‚ho ý dku resp. prvn¡ bajt standardn¡
       vyrovn vac¡ pamØti diskovìch pýenos… DTA na relativn¡ adrese 80H).




            ÿüÿ¡ÿdÿ¡ÿcÿ¡  ÿbÿlÿoÿk  ÿsÿoÿuÿbÿoÿrÿu  ÿ(ÿFÿCÿBÿ)


    Prefix  programov‚ho  segmentu  PSP obsahuje m¡sto pro dva ý¡d¡c¡ bloky
souboru  (File  Control Block - FCB) na relativn¡ch adres ch 005CH a 006CH.
Popisy   syst‚movìch  slu§eb  se  tìkaj¡  neotevýen‚ho  a  otevýen‚ho  FCB.
Neotevýenì FCB je ten, kterì obsahuje jenom specifik tor diskov‚ jednotky a
jm‚no  souboru  (a  typ-rozç¡ýen¡  jm‚na  souboru)  a  kterì m…§e obsahovat
maskovac¡  znaky (* = nahrazuje celì zbytek jm‚na; ? = nahrazuje jeden znak
ve  jm‚nu,  tj. v polo§ce adres ýe m…§e bìt na t‚to pozici uveden libovolnì
znak).  Otevýenì FCB m  vçechny polo§ky FCB vyplnØny syst‚movou slu§bou pro
otevýen¡ nebo vytvoýen¡ souboru.

Pozn.: ü¡d¡c¡  bloky  souboru  FCB jsou poz…statky z operaŸn¡ho syst‚mu DOS
       verzeú1.  Je  vìhodnØjç¡ manipulovat se soubory s pou§it¡m novØjç¡ch
       slu§eb  DOS,  kter‚  pou§¡vaj¡ identifik tor souboru (vçechny funkce
       nad 2EH pracuj¡c¡ se soubory).


    Struktura ý¡d¡c¡ho bloku souboru FCB:
ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍ»
º  offset  ³d‚lka³         n zev          ³ inicializov n na  ³ nastav¡  º
ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍ¹
º 00H ( 0) ³  1  ³ k¢d diskov‚ jednotky   ³ specifikace disku ³ u§ivatel º
º 01H ( 1) ³  8  ³ jm‚no souboru          ³ jm‚no souboru     ³ u§ivatel º
º 09H ( 9) ³  3  ³ rozç¡ýen¡ jm‚na souboru³ typ souboru       ³ u§ivatel º
º 0CH (12) ³  2  ³ aktu ln¡ blok          ³ 00H (0)           ³ DOS      º
º 0EH (14) ³  2  ³ d‚lka jednoho z znamu  ³ 80H (128)         ³ DOS      º
º 10H (16) ³  4  ³ velikost souboru       ³ hodn. z adres ýe  ³ DOS      º
º 14H (20) ³  2  ³ datum posledn¡ho z pisu³ hodn. z adres ýe  ³ DOS      º
º 16H (22) ³  2  ³ Ÿas posledn¡ho z pisu  ³ hodn. z adres ýe  ³ DOS      º
º 18H (24) ³  8  ³ rezervov no            ³                   ³          º
º 20H (32) ³  1  ³ aktu ln¡ z znam        ³ podle funkce      ³ u§ivatel º
º 21H (33) ³  4  ³ relativn¡ z znam       ³ podle funkce      ³ u§ivatel º
ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍ¼

    Rozç¡ýenì  ý¡d¡c¡  blok souboru (File Control Block Extended - FCBE) se
pou§¡v  k vytvoýen¡ nebo hled n¡ adres ýovìch polo§ek soubor… se zvl çtn¡mi
atributy.  Rozç¡ýenì  ý¡d¡c¡  blok  souboru  (FCBE) se liç¡ od standardn¡ho
ý¡d¡c¡ho  bloku  souboru  (FCB) pouze doplnØn¡m tý¡ polo§ek pýed standardn¡
ý¡d¡c¡ blok souboru (FCB) o celkov‚ d‚lce 7 bajt…. Vìznam ostatn¡ch polo§ek
je  nezmØnØn. Pýi nastaven¡ adresy FCB pro danou funkci se rozliç¡ norm ln¡
FCB  a  rozç¡ýenì  FCBE pouze prvn¡m bajtem, kterì obsahuje buÔ Ÿ¡slo disku
(FCB) nebo identifik t rozç¡ýen‚ho ý¡d¡c¡ho bloku souboru FFH (255).

    Struktura rozç¡ýen‚ho ý¡d¡c¡ho bloku souboru FCBE:
ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍ»
º  offset  ³d‚lka³         n zev          ³    inic. na       ³ nastav¡  º
ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍ¹
º-07H (-7) ³  1  ³ identifik tor FCBE     ³ FFH (255)         ³ u§ivatel º
º-06H (-6) ³  5  ³ rezervov no            ³ mus¡ bìt nuly     ³ u§ivatel º
º-01H (-1) ³  1  ³ bajt atribut…          ³ atribut souboru   ³ u§ivatel º
º 00H ( 0) ³  1  ³ k¢d diskov‚ jednotky   ³ specifikace disku ³ u§ivatel º
º 01H ( 1) ³  8  ³ jm‚no souboru          ³ jm‚no souboru     ³ u§ivatel º
º 09H ( 9) ³  3  ³ rozç¡ýen¡ jm‚na souboru³ typ souboru       ³ u§ivatel º
º 0CH (12) ³  2  ³ aktu ln¡ blok          ³ 00H (0)           ³ DOS      º
º 0EH (14) ³  2  ³ d‚lka jednoho z znamu  ³ 80H (128)         ³ DOS      º
º 10H (16) ³  4  ³ velikost souboru       ³ hodn. z adres ýe  ³ DOS      º
º 14H (20) ³  2  ³ datum posledn¡ho z pisu³ hodn. z adres ýe  ³ DOS      º
º 16H (22) ³  2  ³ Ÿas posledn¡ho z pisu  ³ hodn. z adres ýe  ³ DOS      º
º 18H (24) ³  8  ³ rezervov no            ³                   ³          º
º 20H (32) ³  1  ³ aktu ln¡ z znam        ³ podle funkce      ³ u§ivatel º
º 21H (33) ³  4  ³ relativn¡ z znam       ³ podle funkce      ³ u§ivatel º
ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍ¼

Polo§ky ý¡d¡c¡ho bloku souboru (FCB, FCBE):

    - Identifk tor FCBE je bajt nastavenì na hodnotu 0FFH (=255).

    - Bajt  atribut…  souboru  slou§¡ k specifikaci atribut… souboru, kter‚
      maj¡   bìt  nalezeny.  Pokud  specifikujete  nØjakou  kombinaci  bit…
      skryt‚ho  souboru  (hodnota  02H  =  bit 1), syst‚mov‚ho souboru nebo
      adres ýe,  funkce  hled n¡ souboru bude vyhled vat norm ln¡ soubory a
      tak‚ soubory se specifikovanìmi atributy. Pokud specifikujete atribut
      n vØçt¡, bude funkce vyhled vat pouze polo§ky n vØçt¡ disku. Archivn¡
      a  read-only atributy nelze pou§¡t jako krit‚rium pro hled n¡. Vìznam
      jednotlivìch bit… atributu viz "Adres ýov  polo§ka"-atribut souboru.

    - K¢d diskov‚ jednotky ud v  Ÿ¡slo disku, ke kter‚mu se soubor vztahuje
      (1=A,  2=B atd.). Pokud polo§ka obsahuje 00H (0), operace se vztahuje
      k aktu ln¡mu (tj. vybran‚mu) disku.

    - Jm‚no souboru je 8 znak… ASCII. Pokud je jm‚no kratç¡ ne§ 8 znak…, je
      doplnØno  zprava mezerami. Pýi specifikaci vyhrazen‚ho jm‚na zaý¡zen¡
      (napý. LPT1) se na konci jm‚na neuv d¡ dvojteŸka.

    - Rozç¡ýen¡  jm‚na souboru jsou 3 znaky ASCII. Pokud je rozç¡ýen¡ jm‚na
      souboru  kratç¡ ne§ 3 znaky, je doplnØno zprava mezerami. Mezi jm‚nem
      souboru a rozç¡ýen¡m jm‚na souboru se neuv d¡ teŸka. Rozç¡ýen¡m jm‚na
      souboru mohou bìt sam‚ mezery (tj. nen¡ rozç¡ýen¡ jm‚na souboru).

    - Aktu ln¡  blok  pýedstavuje  ukazatel  na  blok  (skupina  napý.  128
      z znam…),  kterì  obsahuje  aktu ln¡ z zn m (tj. z znam, se kterìm se
      bude  prov dØt  n sleduj¡c¡  diskov   operace).  Syst‚mov  slu§ba pro
      otevýen¡ souboru nastav¡ tuto polo§ku na 0.

    - D‚lka  jednoho  z znamu  ud v  d‚lku logick‚ho z znamu v bajtech. DOS
      nastavuje  tuto  polo§ku  po  otevýen¡  souboru  na  hodnotu 80H (128
      bajt…).  Pokud  chcete  pou§¡t  jinou hodnotu, zmØåte tuto polo§ku po
      otevýen¡  souboru,  ne§ budete prov dØt nØjakou diskovou operaci (tak
      lze  napý.  Ÿ¡st  ze souboru po jednotlivìch bajtech, pokud nastav¡te
      tuto polo§ku na hodnotu 1).

    - Velikost  souboru  ud v  velikost souboru v bajtech. Prvn¡ slovo t‚to
      polo§ky  ud v   ni§ç¡  ý d  £daje.  Tuto  polo§ku  nastavuje  DOS pýi
      otevýen¡ souboru podle £daje v polo§ce adres ýe souboru.

    - Datum posledn¡ho z znamu ud v  den, kdy byl soubor naposledy vytvoýen
      nebo  aktualizov n.  Rok,  mØs¡c  a  den jsou zaps ny ve dvou bajtech
      takto:

       vyçç¡ bajt (relat. adresa 15H):     ni§ç¡ bajt (relat. adresa 14H):

       15  14  13  12  11  10   9   8       7   6   5   4   3   2   1   0
      ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿   ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
      ³ R ³ R ³ R ³ R ³ R ³ R ³ R ³ M ³   ³ M ³ M ³ M ³ D ³ D ³ D ³ D ³ D ³
      ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ   ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
       ³                         ³ ³                 ³ ³                 ³
       ÀÄÄÄ rok (1980 a§ 2099) ÄÄÙ ÀÄÄ mØs¡c (1-12) ÄÙ ÀÄÄÄ den (1-31) ÄÄÙ
    (k £daji se pýiŸte hodnota 1980)

    - ¬as  posledn¡ho  z znamu ud v  Ÿas, kdy byl soubor naposledy vytvoýen
      nebo  aktualizov n.  Hodina,  minuta  a  sekunda jsou zaps ny ve dvou
      bajtech takto:

       vyçç¡ bajt (relat. adresa 17H):     ni§ç¡ bajt (relat. adresa 16H):

       15  14  13  12  11  10   9   8       7   6   5   4   3   2   1   0
      ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿   ÚÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄÂÄÄÄ¿
      ³ H ³ H ³ H ³ H ³ H ³ M ³ M ³ M ³   ³ M ³ M ³ M ³ S ³ S ³ S ³ S ³ S ³
      ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ   ÀÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÁÄÄÄÙ
       ³                 ³ ³                         ³ ³                 ³
       ÀÄ hodina (0-23) ÄÙ ÀÄÄÄÄÄ minuta (0-59) ÄÄÄÄÄÙ ÀÄ sekunda (0-29) Ù
                                                      (£daj se vyn sob¡ 2*)

    - Aktu ln¡ z znam ukazuje na z znam (relativnØ v aktu ln¡m bloku - £daj
      0  a§  127),  s kterìm bude provedena nejbli§ç¡ diskov  operace. Tuto
      polo§ku nastavuje u§ivatel pýed operac¡ sekvenŸn¡ho Ÿten¡ a z pisu.

    - Relativn¡  z znam ukazuje na aktu ln¡ z znam v souboru, s kterìm bude
      provedena  nejbli§ç¡  diskov   operace  n hodn‚ho  Ÿten¡ nebo z pisu.
      Polo§ku  mus¡  nastavit  u§ivatel  pýed  operac¡ n hodn‚ho Ÿten¡ nebo
      z pisu  (tj.  operace  se specifikovanìm z znamem souboru). Relativn¡
      z znam  se  vztahuje  relativnØ k zaŸ tku souboru a je urŸen pomoc¡ 4
      bajt….  Pokud  je  d‚lka  z znamu  menç¡  ne§  64 bajt…, jsou pou§ity
      vçechny  4  bajty  t‚to  polo§ky;  jinak jsou pou§ity pouze ni§ç¡ týi
      bajty.

      Pozn.: Pokud  je  FCB  v  prefixu  programov‚ho segmentu na relativn¡
             adrese  005CH,  je  posledn¡  bajt polo§ky relativn¡ho z znamu
             z roveå  prvn¡m  bajtem neform tovan‚ oblasti parametr…, kter 
             zaŸ¡n    na   relativn¡   adrese  0080H  prefixu  programov‚ho
             segmentu. To je implicitn¡ adresa diskov‚ho pýenosu.






    ÿSÿtÿaÿnÿdÿaÿrÿdÿnÿ¡  ÿiÿdÿeÿnÿtÿiÿfÿiÿkÿ ÿtÿoÿrÿy  ÿsÿoÿuÿbÿoÿrÿ…


    Identifik tory  soubor…  jsou  2-bajtov‚ polo§ky, pomoc¡ nich§ se lze v
DOS  odkazovat  pýi  diskovìch  operac¡ch  na soubory nebo vstupnØ/vìstupn¡
zaý¡zen¡  (viz  funkce DOS 2CH a vìçe). Identifik tory se pou§¡vaj¡ u verz¡
DOS vyçç¡ch ne§ 2.0 (funkce jsou pýevzaty ze syst‚mu UNIX). Princip pr ce s
identifik tory  je  ten,  §e  pokud otevýete soubor, DOS navr t¡ 16-bitovou
polo§ku, pýedstavuj¡c¡ symbolickì odkaz na otevýenì soubor (maxim ln¡ poŸet
identifik tor…  se  specifikuje  v  souboru CONFIG.SYS pý¡kazem FILES). Zde
jsou  uvedeny  standardn¡  identifik tory  soubor…,  kter‚  jsou  v syst‚mu
rezervov ny standardn¡m vstupnØ/vìstupn¡m kan l…m.

    Standardn¡ vstupnØ/vìstupn¡ zaý¡zen¡:
 ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º   standardn¡    ³                                     ³               º
 º  identifik tor  ³               n zev                 ³   oznaŸen¡    º
 º     souboru     ³                                     ³               º
 ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º        0        ³   standardn¡ vstupn¡ zaý¡zen¡       ³    Stdin      º
 º        1        ³   standardn¡ vìstupn¡ zaý¡zen¡      ³    Stdout     º
 º        2        ³   standardn¡ chybov‚ zaý¡zen¡       ³    Stderr     º
 º        3        ³   standardn¡ doplåkov‚ zaý¡zen¡     ³    Stdaux     º
 º        4        ³   standardn¡ tiskov‚ zaý¡zen¡       ³    Stdprn     º
 ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    - Standardn¡  vstupn¡  zaý¡zen¡  (Stdin) je obvykle kl vesnice, ale lze
      prov‚st pýesmØýov n¡ tak, §e vstup bude Ÿten ze souboru.

    - Standardn¡  vìstupn¡  zaý¡zen¡  (Stdout)  je obvykle displej, ale lze
      prov‚st pýesmØýov n¡ tak, §e vìstup bude zapisov n do souboru.

    - Standardn¡   chybov‚   zaý¡zen¡   (Stderr)  je  displej  a  nelze  je
      pýesmØýovat   z  povelov‚ho  ý dku.  Toto  zaý¡zen¡  se  pou§¡v   pro
      zobrazen¡  chybovìch zpr v nebo pro zobrazen¡ hl çen¡, kter  nechcete
      pýesmØýov vat spolu se standardn¡m vìstupem.

    - Standardn¡  doplåkov‚ zaý¡zen¡ (Stdaux) je obvykle s‚riov‚ zaý¡zen¡ a
      je  stejn‚  jako  zaý¡zen¡ DOS "AUX:. Z tohoto zaý¡zen¡ lze jak Ÿ¡st,
      tak na nØ i zapisovat.

    - Standardn¡  tiskov‚  zaý¡zen¡  (Stdprn)  je  obvykle tisk rna a je to
      stejn‚  zaý¡zen¡  jako zaý¡zen¡ DOS "PRN:". Z tohoto zaý¡zen¡ lze jak
      Ÿ¡st, tak na nØ i zapisovat.

    Identifik tory  soubor…,  kter‚  byly  pops ny  vìçe, jsou otevýeny pýi
prvn¡m  startu  programu.  Nemus¡te  explicitnØ  otev¡rat  § dn‚  z  tØchto
zaý¡zen¡, pokud dý¡ve nØkterì z tØchto identifik tor… souboru neuzavýete.

Pozn.: Vçech pØt pýeddefinovanìch identifik tor… souboru jsou v ASCII m¢du,
       kterì  znamen , §e DOS reaguje na speci ln¡ vìznamy nØkterìch znak…,
       vŸetnØ  <Ctrl>-<Break>  (<Ctrl>-C)  (pýeruçen¡  programu),  <Ctrl>-S
       (pauza   pýi  prov dØn¡  programu)  a  <Ctrl>-P  (pýipojen¡/odpojen¡
       tisk rny).  V  ASCII  m¢du  je  znak  <Ctrl>-Z  pova§ov n  za znaŸku
       oznaŸuj¡c¡  konec  souboru.  Znaky  Ÿten‚  ze standardn¡ho vstupn¡ho
       zaý¡zen¡  Stdin  jsou  opakov ny  na  obrazovku (echo). ü¡d¡c¡ znaky
       znaky zapisovan‚ na vìstupn¡ a chybov‚ zaý¡zen¡ Stdout a Stderr jsou
       zobrazeny  jako  posloupnost  znak…  "^"  a  X  (napý.  ^C  je  znak
       pýeruçen¡, k¢d 03H = 3). Tabel tory jsou nahrazeny mezerami tak, aby
       nov  pozice zaŸ¡nala na n sobc¡ch Ÿ¡sla 8.

       M¢d  tØchto zaý¡zen¡ m…§ete zmØnit mezi ASCII m¢dem a bin rn¡m m¢dem
       pou§it¡m   vol n¡   funkce   IOCTL  (funkce  DOS  44H).  Nutno  vçak
       podotknout, §e z d…vodu toho, §e prvn¡ týi zaý¡zen¡ (Stdin, Stdout a
       Stderr) jsou vlastnØ navz jem duplikovan  zaý¡zen¡, projev¡ se zmØna
       m¢du na jednom zaý¡zen¡ i na ostatn¡ch dvou zaý¡zen¡ch.





                        ÿPÿrÿoÿsÿtÿýÿeÿdÿ¡  ÿDÿOÿS

    DOS  pou§¡v  pamØœovì prostor, kterì obsahuje nastaven¡ ýetØzc… ASCIIZ,
kter‚ mohou bìt pou§ity aplikaŸn¡mi programy k obdr§en¡ informac¡ na £rovni
syst‚mu a k pýed v n¡ dat jinìm program…m.

    - syst‚movì povel SET slou§¡ vçeobecnØ v DOS k definici prostýed¡.
    - povely PATH a PROMPT tak‚ mØn¡ obsah prostýed¡
    - V  povelovìch  souborech  lze  pou§¡vat promØnn‚, kter‚ jsou oznaŸen‚
      jm‚nem  promØnn‚  a ze stran ohraniŸeny znakem procent. Tyto promØnn‚
      jsou pýi vykon v n¡ povelov‚ho souboru nahrazov ny svìmi hodnotami.

Napý.:   SET PATH=c:\adresar;%PATH%
         IF .%USER%. == .potom. GOTO navesti_potom
         ECHO %POROVNANI% > %SOUCASNA_TISKARNA^

    Prostýed¡  m…§e  m¡t  omezenou velikost, avçak vØtç¡ prostýed¡ DOS m…§e
bìt  vytvoýeno  pomoc¡ direktivy "SHELL=" v souboru CONFIG.SYS nebo povelem
"COMMAND  /e:NNNN",  kterì  startuje  druhou kopii povelov‚ho interpreteru,
poskytuj¡c¡ NNNN bajt… voln‚ho prostoru prostýed¡.
  ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º tvar z pisu:          ³    pý¡klad pou§it¡ v mnemotechnice ASM:      º
  ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º jm‚no_1=hodnota_1(0)  ³  db   'COMSPEC=c:\command.com',0             º
  º jm‚no_2=hodnota_2(0)  ³  db   'PROMPT=$P$G',0                        º
  º        :              ³  db   'WP=c:\wordproc',0                     º
  º jm‚no_N=hodnota_N(0)  ³  db   'PATH=d:\;c:\dos;c:\utility',0         º
  º (0)                   ³  db   0                                      º
  ÌÄÄÄÄÄÄÄÄÄÄÄÄÄ Pro DOS 3.0 a vyçç¡: ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
  º (xxxx)                ³  dw   1                                      º
  º ýetØzec_EXEC_1(0)     ³  db   'C:\ACCTNG\AR001.EXE',0                º
  º      :                ³  db   0                                      º
  º ýetØzec_EXEC_NN(0)    ³                                              º
  º (0)                   ³                                              º
  ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    kde (0) je ASCII znak NULL (k¢d 00H) a (xxxx) je 16-bitov  hodnota.

Pou§it¡ prostýed¡:

    Prostýed¡  DOS  je  oblast  pamØti  menç¡  ne§ 32 KB a zaŸ¡n  na okraji
odstavce. ¬¡slo odstavce, na kter‚m zaŸ¡n  prostýed¡, je ud no na relativn¡
adrese 2CH prefixu programov‚ho segmentu PSP pr vØ prob¡haj¡c¡ho programu.

    M…§ete  nal‚zt  zvolen‚  'jm‚no'  pomoc¡  s‚rie  porovn vac¡ch  operac¡
ýetØzc…  ASCIIZ  dokud nenaraz¡te na nulovì ýetØzec (tj. s nulovou d‚lkou),
indikuj¡c¡  konec  prostýed¡.  Norm lnØ  je  Ÿ st  'jm‚no'  ka§d‚ho ýetØzce
prostýed¡ ve velkìch p¡smenech avçak nen¡ to podm¡nkou.

    Jednou  typickou  operac¡  s  prostýed¡m je pou§it¡ program… typu SHELL
(tj.  nadstavby  operaŸn¡ho  syst‚mu), kter‚ prov d¡ druh‚ kopie povelov‚ho
interpreteru  COMMAND.COM.  Tyto programy typicky hledaj¡ polo§ku prostýed¡
pojmenovanou  "COMSPEC" a pou§ij¡ jej¡ hodnotu jako oznaŸen¡ disku, cesty a
specifikace  souboru  jako  oznaŸen¡  povelov‚ho  interpreteru  DOS - tento
program je naŸten a spuçtØn pomoc¡ funkce DOS 4BH.

    NØkter‚  programy  vy§aduj¡  oper tor k ulo§en¡ informace o specifikaci
dan‚ho  aplikaŸn¡ho  programu do prostýed¡ DOS pomoc¡ povelu SET. AplikaŸn¡
program  m…§e pou§¡vat tuto informaci poka§d‚, kdy§ je vyvol n. Napý¡klad -
textovì  procesor  m…§e  hledat polo§ku nazvanou "TEXTY" a pou§¡t text jej¡
hodnoty jako specifikaci adres ýe datovìch soubor….


Z kladn¡ prostýed¡:

    Ka§dì  program  obdr§¡  st lou kopii inicializaŸn¡ho prostýed¡ syst‚mu.
Tak§e  jak‚koliv zmØny, kter‚ provedete v prostýed¡, budou m¡t £Ÿinek pouze
pro  vçechny  synovsk‚  (podý¡zen‚)  procesy  (pokud nØjak‚ jsou) ale budou
ztraceny, kdy§ se ý¡zen¡ pýed  do otcovsk‚ho procesu.

    Nen¡   dokumentov na   § dn    cesta  k  nastavov n¡  "koýenn‚ho"  nebo
"hlavn¡ho"  prostýed¡  DOS.  Jednou z nedokumentovanìch mo§nost¡ je pou§it¡
pýeruçen¡  DOS  INTú2EH.  M…§ete  m¡t  £spØch spuçtØn¡m kopie COMMAND.COM a
pr…chodem  spojovan‚ho  prostýed¡. Potom vçechny jeho produkty obdr§¡ kopii
tohoto prostýed¡.


Um¡stØn¡ zav dØc¡ cesty:

    Pýi  odstartov n¡  porgramu v DOS verze 3.00 a vyçç¡ ulo§¡ DOS pý¡davnì
ýetØzec za konec form ln¡ho prostýed¡, kterì m…§e bìt pou§it k urŸen¡ disku
a  adres ýe,  ze  kter‚ho  byl program zav dØn. 'Chytr‚' aplikaŸn¡ programy
mohou tuto pomoc vyu§¡t k nalezen¡ svìch pýekryvnìch a datovìch soubor….

    To  je  velmi  d…le§it‚,  neboœ  DOS  3.0 umo§nil oper torovi vyvol vat
program uv dØn¡m jm‚na cesty pýed jm‚no startovan‚ho programu.

    N sleduj¡c¡m   za  posledn¡m  ýetØzcem  ASCIIZ  prostýed¡  je  bajt  0,
indikuj¡c¡  konec  form ln¡ho  prostýed¡. N sleduj¡c¡ dva bajty pýedstavuj¡
16-bitovì  Ÿ¡taŸ  pý¡davnìch  ýetØzc…  (tato hodnota je norm lnØ 0001H). Za
touto  bin rn¡  hodnotou  m…§ete nal‚zt ýetØzec ASCIIZ specifikace souboru,
kterì byl pou§it funkc¡ DOS 4BH (EXEC) k naŸten¡ a odstartov n¡ programu.

    StejnØ  tak  i  kdy§  soubor  programu nebyl v aktu ln¡m adres ýi a DOS
musel  pou§¡t  cestu  k  hled n¡  povelu (tj. ýetØzec "PATH=..") k nalezen¡
souboru  programu,  ulo§¡  DOS  za  konec  prostýed¡  spr vnou hodnotu pln‚
specifikace souboru (d:\cesta\jm‚no_souboru.ext,0).





      ÿIÿnÿsÿtÿaÿlÿoÿvÿaÿtÿeÿlÿnÿ‚  ÿdÿrÿiÿvÿeÿrÿy  ÿzÿaÿýÿ¡ÿzÿeÿnÿ¡

    Instalovateln‚  drivery zaý¡zen¡ umo§åuj¡ vytv ýet standardn¡ rozhrann¡
mezi syst‚mem DOS a nestandardn¡ souŸ stkou nebo zaý¡zen¡m.

    Instalovatelnì  driver zaý¡zen¡ je speci lnØ form tovanì program, kterì
je  naŸten  do  pamØti  pýi zav dØn¡ operaŸn¡ho syst‚mu. NaŸten¡ se provede
pomoc¡  souboru CONFIG.SYS pý¡kazovìm ý dkem 'DEVICE=<identifikace souboru>
seznam  parametr…'.  Identifikace  souboru  ud v   jm‚no  driveru resp. i s
ud n¡m  pý¡stupov‚ cesty k tomuto souboru. Za identifikac¡ souboru m…§e bìt
uveden   libovolnì   seznam  parametr…  pro  instalaci  driveru,  konkr‚tn¡
struktura   parametr…   z vis¡  na  konkr‚tn¡ch  po§adavc¡ch  instalovan‚ho
driveru.

    Soubor driveru zaý¡zen¡ je bin rn¡ soubor. Po pýekladu zdrojov‚ho textu
v  assembleru  pou§ijte program EXE2BIN, kterìm soubor konvertujete z tvaru
EXE  do bin rn¡ho tvaru. Na rozd¡l od soubor… ve form tu COM nevkl dejte na
zaŸ tek programu instrukci ORG 100H (soubor je pýekl d n od adresy 0).

    Pokud soubor CONFIG.SYS obsahuje pý¡kaz 'DEVICE=' pro instalaci souboru
driveru,  bude soubor driveru zaý¡zen¡ dan‚ho jm‚na nainstalov n do ýetØzce
driver…  zaý¡zen¡.  To  m   ten  £Ÿinek,  §e instalovan  zaý¡zen¡ budou m¡t
pýednost  pýed  drivery  DOS pro zaý¡zen¡ se stejnìmi jm‚ny. Napý. pokud je
instalov n  driver  ANSI.SYS,  kterì  m   jm‚no  zaý¡zen¡  CON:,  je  t¡mto
zablokov n standardn¡ driver zaý¡zen¡ CON:.


    Na  zaŸ tku  souboru driveru zaý¡zen¡ je um¡stØna 18-bajtov  struktura,
kter  se nazìv  z hlav¡ zaý¡zen¡:

ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º  offset: ³ velikost: ³                   popis:                     º
ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 00H ( 0) ³    4      ³ adresa FAR n sleduj¡c¡ho zaý¡zen¡ v ýetØzci  º
º 04H ( 4) ³    2      ³ atributy zaý¡zen¡                            º
º 06H ( 6) ³    2      ³ offsetov  adresa rutiny strategie            º
º 08H ( 8) ³    2      ³ offsetov  adresa rutiny pýeruçen¡            º
º 0AH (10) ³    8      ³ jm‚no zaý¡zen¡                               º
ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

- N sleduj¡c¡  zaý¡zen¡: Tuto  polo§ku  nastavuje DOS pýi instalaci driveru
                         zaý¡zen¡.    Obsahuje    vzd lenou   adresu   (tj.
                         segment:offset)   zaŸ tku   dý¡ve  nainstalovan‚ho
                         driveru.  Drivery  zaý¡zen¡ se instaluj¡ do pamØti
                         zdola   nahoru   -   posledn¡   driver   je   tedy
                         nainstalov n   nahoýe.  Prohled v n¡  driver…  pýi
                         hled n¡  po§adovan‚ho  jm‚na  zaý¡zen¡  prob¡h  od
                         posledn¡ho  zaý¡zen¡  (tj.  shora dol…). Pýitom je
                         adresa   n sleduj¡c¡ho  (tj.  ni§ç¡ho  v  ýetØzci)
                         zjiçtØna z t‚to polo§ky. Posledn¡ driver v ýetØzci
                         driver…  (tj.  nejni§ç¡)  m   nastavenu polo§ku na
                         hodnotu  -1 (tj. FFFF:FFFFH). Pýi naŸ¡t n¡ souboru
                         driveru  do pamØti mus¡ bìt nastavena tato polo§ka
                         na  hodnotu  t‚§  -1 (FFFF:FFFFH). Je-li v souboru
                         v¡c   ne§   jeden  driver,  bude  v  prvn¡m  slovØ
                         ukazatele   relativn¡   adresa   dalç¡ho   driveru
                         zaý¡zen¡  v  souboru.  Posledn¡  driver zaý¡zen¡ v
                         souboru  mus¡ m¡t ukazatel na pole z hlav¡ dalç¡ho
                         zaý¡zen¡ nastaven na hodnotu -1 (tj. FFFF:FFFFH).

- Atributy zaý¡zen¡: Slovo atribut… zaý¡zen¡ indikuje vlastnosti zaý¡zen¡.

 ÉÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º  bit ³                        vìznam                                  º
 ÌÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º   0  ³ 1 = standardn¡ vstupn¡ zaý¡zen¡ (stdin)                        º
 º   1  ³ 1 = standardn¡ vìstupn¡ zaý¡zen¡ (stdout)                      º
 º   2  ³ 1 = standardn¡ nulov‚ zaý¡zen¡ (NUL:)                          º
 º   3  ³ 1 = hodinov‚ zaý¡zen¡ (CLOCK)                                  º
 º  4,5 ³   rezervov no (mus¡ bìt 0)                                     º
 º   6  ³ 1 = podporuje logick  zaý¡zen¡                                 º
 º 7-10 ³   rezervov no (mus¡ bìt 0)                                     º
 º  11  ³ 1 = podporuje otevýen¡/uzavýen¡/vìmØnu m‚dia                   º
 º  12  ³   rezervov no (mus¡ bìt 0)                                     º
 º  13  ³ 1 = je zaý¡zen¡ s form tem NON-IBM (tj. nem  form t disku IBM) º
 º  14  ³ 1 = podporuje ý¡zen¡ zaý¡zen¡ pýes kan l IOCTL (funkce 44H)    º
 º  15  ³ 1 = je znakov‚ zaý¡zen¡; 0 = je blokov‚ zaý¡zen¡               º
 ÈÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

     Pokud pýepisujete stand. zaý¡zen¡ CON: (konzola), nastavte bity 0 a 1.

     Zaý¡zen¡ NUL nem…§e bìt pýeýazeno (nepokouçejte se je pýepsat).

     Bit  3  (hodinov‚  zaý¡zen¡) indikuje, zda je pýedefinov no standardn¡
     hodinov‚  zaý¡zen¡  CLOCK$. CLOCK$ je znakov‚ zaý¡zen¡ ovl dan‚ pomoc¡
     po§adavk…  na zaý¡zen¡ s d‚lkou 6 bajt…. Vstupn¡ po§adavek (k¢d povelu
     4)  by mØl navracet 6 bajt… indikuj¡c¡ch aktu ln¡ Ÿas/datum a vìstupn¡
     po§adavek  (k¢d povelu 8) by mØl pýijat 6 bajt… k nastaven¡ Ÿasu/data.
     Form t dat pro CLOCK$ je:

          ÉÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
          º offset  ³ velikost³            vìznam              º
          ÌÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
          º 00H (0) ³    2    ³ datum - poŸet dn… od 1.1.1980  º
          º 02H (2) ³    1    ³ minuta (0-59)                  º
          º 03H (3) ³    1    ³ hodina (0-23)                  º
          º 04H (4) ³    1    ³ sekunda (0-59)                 º
          º 05H (5) ³    1    ³ setiny sekundy (0-99)          º
          ÈÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

     Bit  6  (podporov no  logick‚  zaý¡zen¡)  indikuje, zda je podporov no
     logick‚   zaý¡zen¡   (>   DOS   3.2)   -   viz   funkce   17H   a  18H
     (poskytnut¡/nastaven¡  logick‚ho  zaý¡zen¡).  T¡mto  driverem je napý.
     soubor DRIVER.SYS.

     Bit  11  (podpora otevýen¡/uzavýen¡/RM) indikuje, zda jsou podporov ny
     po§adavky  na  zaý¡zen¡  vztahuj¡c¡  se k vìmØnnìm m‚di¡m (0DH a§ 0FH)
     tak,  aby  mohl  driver  blokov‚ho  zaý¡zen¡  optimalizovat  prov dØn‚
     operace  lok ln¡m  shroma§Ôov n¡m  ve  vyrovn vac¡ch pamØtech nebo aby
     mohl driver znakov‚ho zaý¡zen¡ vys¡lat inicializaŸn¡ posloupnost.

     Bit  13  (form t  zaý¡zen¡  NON-IBM) m  £Ÿinek pýi po§adavku sestaven¡
     bloku parametr… BIOS BPB (02H).

     Bit  14  (ý¡zen¡ kan lu IOCTL) indikuje podporu ý¡zen¡ zaý¡zen¡ pomoc¡
     ý¡d¡c¡ho kan lu (funkce DOS 44H).

- Strategie  zaý¡zen¡: Tato  polo§ka  je  offset  ukazuj¡c¡ na Ÿ st driveru
                       (mus¡  bìt  ve  stejn‚m  segmentu),  kter   slou§¡ k
                       nastaven¡  adresy  po§adavku  zaý¡zen¡  podle obsahu
                       registr…  ES:BX. Adresu po§adavku zaý¡zen¡ nastavuje
                       DOS  pýi  prvn¡m  po§adavku  pý¡stupu  na  zaý¡zen¡,
                       driver  si  adresu  po§adavku  zaý¡zen¡  ulo§¡ a pýi
                       dalç¡ch  po§adavc¡ch na zaý¡zen¡ se operace vztahuj¡
                       na   tuto  adresu.  (Ve  v¡ce£lohov‚m  prostýed¡  to
                       umo§åuje  vytv ýet  ýetØzec  po§adavk…  typu  FIFO -
                       prvn¡ po§adavek bude uspokojen prvn¡ v poýad¡).

- Rutina pýeruçen¡: Rutinu  pýeruçen¡  vol   DOS bez jakìchkoliv parametr….
                    Jeho  Ÿinnost  spoŸ¡v   v  tom,  §e za pou§it¡ poslednØ
                    definovan‚  adresy  z hlav¡  po§adavku  provede operaci
                    podle  k¢du  povelu,  kterì  je v tomto z hlav¡ uveden.
                    R…zn‚  povely  zaý¡zen¡ pou§¡vaj¡ r…znou strukturu dat.
                    Typicky   obsahuje  driver  urŸit‚  mno§stv¡  skok…  na
                    obsluhy  jednotlivìch  po§adavk…. Po ukonŸen¡ po§adavku
                    by  mØl  driver  nastavit stavov‚ slovo zaý¡zen¡, kter‚
                    bude  indikovat  souhrn  chyb,  kter‚  se bØhem operace
                    vyskytly   a   potom  navr tit  ý¡zen¡  do  DOS  pomoc¡
                    instrukce FAR RET.

- Jm‚no zaý¡zen¡: Obsahuje  jm‚no  zaý¡zen¡,  na  kter‚  se  lze pomoc¡ DOS
                  odkazovat.  Jm‚no  zaý¡zen¡  je  ve form tu ASCII textu o
                  maxim ln¡m poŸtu znak… 8, za jm‚nem se neuv d¡ dvojteŸka.
                  Pokud  je  poŸet znak… jm‚na zaý¡zen¡ menç¡ ne§ 8, dopln¡
                  se zprava mezerami.



    Pomoc¡  rutiny  strategie  zaý¡zen¡ informuje DOS driver o tom, na jak‚
adrese  (ES:BX)  je  um¡stØn  po§adavek  zaý¡zen¡. Ka§dì po§adavek zaý¡zen¡
zaŸ¡n   13-bajtovìm  z hlav¡m  po§adavku, za kterìm n sleduje datov  oblast
promØnn‚  d‚lky.  Z hlav¡  po§adavku  zaý¡zen¡  m   d‚lku  13  bajt…  a  m 
n sleduj¡c¡ strukturu:

  ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³    1     ³ d‚lka tohoto po§adavku (z hlav¡ a data)      º
  º 01H ( 1) ³    1     ³ Ÿ¡slo jednotky (pou§ito pouze pro blok. zaý.)º
  º 02H ( 2) ³    1     ³ k¢d povelu (00H-18H) specifikuj¡c¡ po§ad.akciº
  º 03H ( 3) ³    2     ³ stavov‚ slovo zaý¡zen¡ (nastavuje driver)    º
  º 05H ( 5) ³    8     ³ rezervov no                                  º
  ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

- K¢d povelu: K¢d  povelu  specifikuje, kter  akce je po§adov na, aby se se
              zaý¡zen¡m provedla. K¢dy povel… jsou:

  ÉÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍ»
  º k¢d povelu ³ vìznam                                        ³ pou§it¡ º
  ÌÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍ¹
  º  00H ( 0)  ³ inicializace zaý¡zen¡                         ³   Z,B   º
  º  01H ( 1)  ³ kontrola m‚dia                                ³    B    º
  º  02H ( 2)  ³ vystavØn¡ bloku parametr… BIOS (BPB)          ³    B    º
  º  03H ( 3)  ³ vstup kan lu pro ovl d n¡ zaý¡zen¡ (IOCTL)    ³  Z,B,I  º
  º  04H ( 4)  ³ vstup (Ÿten¡ ze zaý¡zen¡)                     ³   Z,B   º
  º  05H ( 5)  ³ nedestruktivn¡ vstup                          ³    Z    º
  º  06H ( 6)  ³ statut vstupu                                 ³    Z    º
  º  07H ( 7)  ³ vypr zdnØn¡ vstupu                            ³    Z    º
  º  08H ( 8)  ³ vìstup (z pis na zaý¡zen¡)                    ³   Z,B   º
  º  09H ( 9)  ³ vìstup s verifikac¡                           ³   Z,B   º
  º  0AH (10)  ³ statut vìstupu                                ³    Z    º
  º  0BH (11)  ³ vypr zdnØn¡ vìstupu                           ³    Z    º
  º  0CH (12)  ³ vìstup z kan lu pro ovl d n¡ zaý¡zen¡ (IOCTL) ³  Z,B,I  º
  º  0DH (13)  ³ otevýen¡ zaý¡zen¡               (DOS > 3.0)   ³  Z,B,R  º
  º  0EH (14)  ³ uzavýen¡ zaý¡zen¡               (DOS > 3.0)   ³  Z,B,R  º
  º  0FH (15)  ³ vìmØna m‚dia                    (DOS > 3.0)   ³   B,R   º
  º  13H (19)  ³ generov n¡ po§adavku IOCTL      (DOS > 3.2)   ³    I    º
  º  17H (23)  ³ poskytnut¡ logick‚ho zaý¡zen¡   (DOS > 3.2)   ³   Z,B   º
  º  18H (24)  ³ nastaven¡ logick‚ho zaý¡zen¡    (DOS > 3.2)   ³   Z,B   º
  ÈÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍ¼
    K¢dy pou§it¡: Z = driver znakov‚ho zaý¡zen¡
                  B = blokov‚ zaý¡zen¡ (pýedevç¡m diskov‚ drivery)
                  I = mus¡ podporovat ý¡d¡c¡ kan l zaý¡zen¡ IOCTL
                  R = mus¡ podporovat otevýen¡/uzavýen¡/vìmØnu m‚dia

- Stavov‚ slovo zaý¡zen¡: Stavov‚  slovo  mus¡  bìt nastaveno driverem v§dy
                          pýi  n vratu  do  DOS.  Jednotliv‚ bity stavov‚ho
                          slova  zaý¡zen¡  maj¡  vìznam  podle  n sleduj¡c¡
                          tabulky:

 ÉÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º  bit ³                        vìznam                                  º
 ÌÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º  0-7 ³ chybovì k¢d (viz n sleduj¡c¡ tabulka)                          º
 º   8  ³ 1 = akce provedena (po n vratu z driveru v§dy nastaven)        º
 º   9  ³ 1 = zanepr zdnØn (pouze povely 06H a 0AH)                      º
 º 10-14³ rezervov no                                                    º
 º  15  ³ 1 = nastala chyba                                              º
 ÈÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

     - Chybovì  k¢d  (bity  0  a§ 7) nastavuje driver v pý¡padØ, §e nastala
       bØhem  po§adovan‚  operace  chyba obsluhy zaý¡zen¡ (bit 15 stavov‚ho
       slova  je  nastaven).  Chybovì  k¢d  je  um¡stØn  do  ni§ç¡ch 8 bit…
       stavov‚ho slova, vìznam jednotlivìch k¢d… je n sleduj¡c¡:

          ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
          º chybovì k¢d ³                  vìznam                   º
          ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
          º  00H ( 0)   ³    poruçen¡ ochrany z pisu                º
          º  01H ( 1)   ³    nezn m  jednotka                       º
          º  02H ( 2)   ³    zaý¡zen¡ nen¡ pýipraveno               º
          º  03H ( 3)   ³    nezn mì povel                          º
          º  04H ( 4)   ³    chyba kontroln¡ho souŸtu (CRC)         º
          º  05H ( 5)   ³    çpatn  d‚lka struktury po§adavku       º
          º  06H ( 6)   ³    chyba vystaven¡                        º
          º  07H ( 7)   ³    nezn m‚ m‚dium                         º
          º  08H ( 8)   ³    sektor nenalezen                       º
          º  09H ( 9)   ³    v tisk rnØ nen¡ pap¡r                  º
          º  0AH (10)   ³    chyba z pisu                           º
          º  0BH (11)   ³    chyba Ÿten¡                            º
          º  0CH (12)   ³    vçeobecn  chyba                        º
          º  0DH (13)   ³    (rezervov no)                          º
          º  0EH (14)   ³    (rezervov no)                          º
          º  0FH (15)   ³    neplatn  vìmØna disku (DOS > 3.0)      º
          ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

     - Bit  Ÿ¡slo  8 ("akce provedena") nastavuje driver v§dy pýi norm ln¡m
       ukonŸen¡ obsluhy po§adavku.

     - Bit  Ÿ¡slo  9  ("zanepr zdnØn")  je  driverem nastaven v pý¡padØ, §e
       nelze  uspokojit  po§adavek,  proto§e  fyzick‚ zaý¡zen¡ je pou§¡v no
       pýedeçlìm  po§adavkem. To je tak‚ pou§¡v no k navr cen¡ doplåuj¡c¡ch
       informac¡, jako napý. "ýetØzec kl vesnice nen¡ pr zdnì" nebo "m‚dium
       bylo vymØnØno".

     - Bit  Ÿ¡slo 15 ("nastala chyba") pokud driver pýijme po§adavek, kterì
       nem…§e  obslou§it,  nebo  pokud  pýi  uspokojov n¡ po§adavku nastane
       chyba.  Pokud  je  chybovì bit nastaven, obsahuj¡ bity 0-7 stavov‚ho
       slova zaý¡zen¡ chybovì k¢d.




    Za  z hlav¡m  po§adavku n sleduje oblast dat. D‚lka t‚to oblasti z vis¡
na  k¢du  povelu  (bajt  v z hlav¡ zaý¡zen¡ s offsetem 2). NØkter‚ z povel…
sd¡lej¡  identickou strukturu po§adavku. Jin‚ pou§¡vaj¡ zýetØzen‚ struktury
a nØkter‚ pou§¡vaj¡ pouze z hlav¡ po§adavku ke komunikaci s DOS.

- Inicializace zaý¡zen¡ (k¢d povelu 0): Driver   inicializuje   zaý¡zen¡  a
                                        navr t¡ adresu konce pamØti, kterou
                                        chce ponechat rezidentn¡.

  ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po§adavku                            º
  º 0DH (13) ³    1     ³ vìstup: poŸet jednotek definovanìch t¡mto    º
  º          ³          ³         driverem (blokov  zaý¡zen¡)          º
  º 0EH (14) ³    4     ³ vìstup: koneŸn  adresa rezidentn¡ho k¢du     º
  º 12H (18) ³    4     ³ vstup:  adresa ýetØzce ASCIIZ z CONFIG.SYS   º
  º          ³          ³ vìstup: adresa bloku parametr… BIOS (BPB)    º
  º          ³          ³         pro zaý¡zen¡ (blokov  zaý¡zen¡)      º
  º 16H (22) ³    1     ³ Ÿ¡slo disku (0=A, 1=B atd.) (DOS > 3.0)      º
  ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    PoŸ¡naje   verz¡   DOS   >   3.0   obsahuje   offset  12H  (18)  adresu
    (segment:offset)  textov‚ho  ýetØzce  ASCIIZ, kterì n sleduje v souboru
    CONFIG.SYS  za  povelem  "DEVICE=".  Tento  text  m…§ete Ÿ¡st, pokud je
    po§adov no  pýed v n¡  parametr…  u§ivatelem.  Od t‚to verze DOS je t‚§
    um¡stØno  na  offsetu  16H  (22)  Ÿ¡slo  disku. To umo§åuje driveru pýi
    instalaci zobrazit hl çen¡ informuj¡c¡ u§ivatele o tom, jako kterì disk
    byl  driver  nainstalov n.  BØhem inicializace mohou bìt pou§ity slu§by
    DOS 01H a§ 0CH (hl çen¡ atd.).

- Kontrola m‚dia (k¢d povelu 1): Driver urŸ¡, zda bylo m‚dium vymØnØno.

  ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po§adavku                            º
  º 0DH (13) ³    1     ³ vstup:  bajt popisovaŸe m‚dia (DOS testuje,  º
  º          ³          ³         zda byl zmØnØn)                      º
  º 0EH (14) ³    1     ³ vìstup: FFH = m‚dium bylo vymØnØno           º
  º          ³          ³         01H = m‚dium je nezmØnØn‚            º
  º          ³          ³         00H = nen¡ zn m‚, zda bylo vymØnØno  º
  º 0FH (15) ³    4     ³ vìstup: adresa ýetØzce ASCIIZ pýedchoz¡ho    º
  º 16H (22) ³    1     ³         identifikaŸn¡ho n vØçt¡ (pokud bylo  º
  º          ³          ³         m‚dium vymØnØno a je podporov no     º
  º          ³          ³         rozpozn n¡ vìmØny m‚dia              º
  ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Bajt   popisovaŸe   m‚dia  (nazìv   se  t‚§  bajt  identifik toru  FAT)
    identifikuje   typ   m‚dia,   kterì  je  pou§it  v  diskov‚m  zaý¡zen¡.
    Bli§ç¡ podrobnosti viz kapitolu Zav dØc¡ adres ý disku.

- VystavØn¡ bloku parametr…
  BIOS (k¢d povelu 02H):      Driver  navr t¡  ukazatel  na  blok parametr…
                              BIOS  (BPB)  pro  disketu,  kter   je pr vØ v
                              disketov‚   mechanice.   Pokud   m   zaý¡zen¡
                              atribut NON-IBM (nen¡ standardn¡ form t IBM),
                              potom  nen¡  ukazatel  na offsetu 0EH (adresa
                              bufferu)  definov n. Pokud m  zaý¡zen¡ form t
                              IBM,  potom  ukazuje tento ukazatel na buffer
                              obsahuj¡c¡ prvn¡ sektor tabulky FAT (kterì je
                              naŸten   pýed  povelem  pro  vystavØn¡  bloku
                              parametr… BIOS (BPB).

  ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po§adavku                            º
  º 0DH (13) ³    1     ³ vstup:  bajt popisovaŸe m‚dia                º
  º 0EH (14) ³    4     ³ vstup:  adresa bufferu (FAT sektor 0)        º
  º 12H (18) ³    4     ³ vìstup: adresa bloku parametr… BIOS (BPB)    º
  º          ³          ³         pro zaý¡zen¡ (blokov  zaý¡zen¡-disk) º
  ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Blok parametr… BIOS (BPB - d‚lka 13 bajt…):
  ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³    2     ³ bajt… na sektor                              º
  º 02H ( 2) ³    1     ³ sektor… na alokaŸn¡ blok (cluster)           º
  º 03H ( 3) ³    2     ³ zav dØc¡ a rezervovan‚ sektory               º
  º 05H ( 5) ³    1     ³ poŸet alokaŸn¡ch tabulek soubor… (FAT)       º
  º 06H ( 6) ³    2     ³ maxim ln¡ poŸet polo§ek adres ýe v z kl. adr.º
  º 08H ( 8) ³    2     ³ celkovì poŸet sektor… na m‚diu (v oddØl.DOS) º
  º 0AH (10) ³    1     ³ popisovaŸ m‚dia (=1.bajt FAT)                º
  º 0BH (11) ³    2     ³ poŸet sektor… v jedn‚ alokaŸn¡ tab.soub.(FAT)º
  ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
    Podrobnosti viz rozdØlen¡ disku MS-DOS.


- Vstup, vìstup (povely 03H, 04H, 08H, 09H, 0CH):

  ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po§adavku                            º
  º 0DH (13) ³    1     ³ vstup:  bajt popisovaŸe m‚dia                º
  º 0EH (14) ³    4     ³ vstup:  adresa bufferu pro pýenos dat (DTA)  º
  º 12H (18) ³    2     ³ vstup:  poŸet bajt… (pro blokov‚ zaý¡zen¡    º
  º          ³          ³         poŸet sektor…)                       º
  º 14H (20) ³    2     ³ vstup:  Ÿ¡slo poŸ teŸn¡ho sektoru (pouze pro º
  º          ³          ³         blokov  zaý¡zen¡)                    º
  º 16H (22) ³    4     ³ vìstup: adresa ýetØzce ASCIIZ identifikaŸn¡hoº
  º          ³          ³         n vØçt¡ disku (pokud navr t¡ chybu   º
  º          ³          ³         zaý¡zen¡ 0FH - neplatn  vìmØna)      º
  ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Pýi povelech vstupu (03H, 04H) by mØl driver pýen‚st urŸenì poŸet bajt…
    (pro  blokov‚  zaý¡zen¡  urŸenì poŸet sektor…) ze zaý¡zen¡ do pamØti od
    adresy, jej¡§ adresa je zad na na offsetu 0EH.

    Pýi povelech vìstupu (08H, 09H, 0CH) by mØl driver pýen‚st urŸenì poŸet
    bajt…/sektor… z pamØti od adresy urŸen‚ offsetem 0EH do zaý¡zen¡.

- Nedestruktivn¡ Ÿten¡ (k¢d povelu 05H): Tento  povel  se pou§¡v  pouze pro
                                         znakov  zaý¡zen¡. D v  mo§nost DOS
                                         pod¡vat  se  pýedem na znak, kterì
                                         bude  pýed n pýi pý¡çt¡m po§adavku
                                         Ÿten¡   znaku  (pýi  t‚to  operaci
                                         driver  neŸek ,  a§ je nØjakì znak
                                         pýipraven).

  ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po§adavku                            º
  º 0DH (13) ³    1     ³ vìstup: hodnota bajtu, kterì je pýipraven    º
  º          ³          ³         v ýetØzci jako pý¡çt¡                º
  ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

- Statut (k¢dy povel… 06H a 0AH): Pýi tomto povelu nastavuje driver stavov‚
                                  slovo  zaý¡zen¡,  co§  umo§åuje pýedevç¡m
                                  kontrolu bitu "zanepr zdnØn" (bit 9). Pýi
                                  vol n¡   statutu   vstupu   (povel   06H)
                                  resetuje driver bit "zanepr zdnØn", pokud
                                  v  bufferu  je  pýipraven  znak ke Ÿten¡.
                                  Nastavuje  jej  na  1, pokud by povel pro
                                  vstup  znaku vy§adoval Ÿek n¡ zaý¡zen¡ na
                                  pý¡chod  bajtu  (napý.  Ÿek n¡ na znaku z
                                  kl vesnice).  Pýi  vol n¡ statutu vìstupu
                                  (povel    0AH)    resetuje   driver   bit
                                  "zanepr zdnØn"   na  0,  pokud  neprob¡h 
                                  § dnì  po§adavek  vìstupu a pý¡çt¡ vìstup
                                  by  probØhl  pý¡mo na zaý¡zen¡. Nastavuje
                                  jej   na  1,  pokud  pýedchoz¡  po§adavek
                                  vìstupu nebyl dosud jeçtØ ukonŸen.

- Vypr zdnØn¡ (k¢dy povel… 07H a 0BH): Tyto  povely  po§aduj¡,  aby  driver
                                       vyŸistil   vstupn¡   nebo   vìstupn¡
                                       vyrovn vac¡   pamØti   (tj.   zruçil
                                       vçechny bajty, kter‚ byly pýipraveny
                                       ve  vyrovn vac¡ch pamØtech pro vstup
                                       nebo vìstup). To se vØtçinou pou§¡v 
                                       k  vymaz n¡  kl ves  z  kl vesnicov‚
                                       vyrovn vac¡ pamØti.

- Otevýen¡, uzavýen¡ (k¢dy 0DH, 0EH): Tyto    povely   se   pou§¡vaj¡   pro
                                      zaý¡zen¡,   kter    podporuj¡  funkci
                                      "otevýen¡/uzavýen¡/vìmØna m‚dia" (bit
                                      11    atributu   zaý¡zen¡).   Blokov 
                                      zaý¡zen¡  mohou  pou§¡vat tento povel
                                      ke  spr vØ lok ln¡ho vyrovn v n¡ dat.
                                      Po§adavek  otevýen¡  m‚dia  (0DH)  se
                                      prov d¡  pro  ka§dì  soubor  pýi jeho
                                      otevýen¡,  uzavýen¡  m‚dia  (0EH)  se
                                      po§aduje  pýi  uzavýen¡  souboru.  To
                                      umo§åuje  driveru  urŸit  Ÿas, kdy je
                                      mo§n‚   vyjmout   disk   z  disketov‚
                                      mechaniky  a  prov dØt  vyprazdåov n¡
                                      vyrovn vac¡ch     pamØt¡.     Znakov 
                                      zaý¡zen¡ mohou pou§¡vat tyto povely k
                                      vysl n¡  inicializaŸn¡ho  ýetØzce  na
                                      zaý¡zen¡    (napý.   tisk rnu)   nebo
                                      resetovat  zaý¡zen¡  do  standardn¡ho
                                      stavu.

- VìmØna m‚dia (k¢d povelu 0FH): Tento   povel   se   pou§¡v   pro  blokov 
                                 zaý¡zen¡,     kter     podporuj¡    funkci
                                 "otevýen¡/uzavýen¡/vìmØna  m‚dia"  (bit 11
                                 atributu  zaý¡zen¡).  Driver by mØl sdØlit
                                 DOSu,  zda  je  podporov na  vìmØna m‚dia.
                                 Povel    navrac¡    informaci    v    bitu
                                 "zanepr zdnØn"  stavov‚ho  slova  zaý¡zen¡
                                 (bit  9):  pokud  je tento bit = 0 znamen 
                                 to, §e m‚dium je vìmØnn‚ a naopak.

- Generov n¡ po§adavku IOCTL (k¢d 13H): Drivery DOS > 3.2, kter‚ v atributu
                                        zaý¡zen¡   indikuj¡  podporu  IOCTL
                                        (ý¡zen¡  vstupu/vìstupu)  mus¡  bìt
                                        schopny   toto   vol n¡  obslou§it.
                                        Pou§¡v    se   pro  r…zn‚  operace,
                                        vŸetnØ    form tov n¡   disku.   Je
                                        navrhov no     ke     standardizaci
                                        mezistyku pro r…zn‚ typy disk… jako
                                        logick‚  drivery diskovìch zaý¡zen¡
                                        DRIVER.SYS.   Dalç¡  informace  viz
                                        funkci DOS 44H (IOCTL).

  ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po§adavku                            º
  º 0DH (13) ³    1     ³ vstup:  Ÿ¡slo funkce                         º
  º 0EH (14) ³    1     ³ vstup:  Ÿ¡slo podfunkce                      º
  º 0FH (15) ³    2     ³ vstup:  hodnota v SI ve funkci DOS 44H       º
  º 11H (17) ³    4     ³ vstup:  hodnota pýed van  v DI               º
  º 15H (21) ³    4     ³ vstup:  adresa bal¡ku dat IOCTL              º
  ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

- Poskytnut¡/nastaven¡ logick‚ho
  zaý¡zen¡ (k¢dy povel… 17H a 18H): Drivery  DOS  >  3.2,  kter‚ v atributu
                                    zaý¡zen¡ indikuj¡ podporu IOCTL (ý¡zen¡
                                    vstupu/vìstupu)  mus¡  bìt schopny toto
                                    vol n¡ obslou§it. Pou§¡v  se jako cesta
                                    k    pý¡stupu    na    "logick‚"   nebo
                                    "symbolick‚"  disky  instalovan‚ pomoc¡
                                    driveru  blokovìch zaý¡zen¡ DRIVER.SYS.
                                    Zprostýedkov v    metodu   dotazu  nebo
                                    nastaven¡   driveru  na  logickì  disk,
                                    kterì  bude  aktivn¡  pro  danì fyzickì
                                    disk.    Pýi    po§adavku    poskytnut¡
                                    logick‚ho  disku  (18H)  by  mØl driver
                                    um¡stit    identifik tor   driveru   do
                                    offsetu  0DH  (1=A,  2=B,  atd.). Pokud
                                    driver  obsluhuje pouze jeden disk, mØl
                                    by  v  tomto  poli navracet v§dy 0. Viz
                                    t‚§  funkci DOS 44H (IOCTL) - podfunkce
                                    0EH a 0FH.

  ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
  º  offset  ³ velikost ³                  popis                       º
  ÌÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
  º 00H ( 0) ³   13     ³ z hlav¡ po§adavku                            º
  º 0DH (13) ³    1     ³ vstup:  k¢d jednotky                         º
  º          ³          ³ vìstup: posledn¡ vzta§n‚ zaý¡zen¡            º
  º 0EH (14) ³    1     ³ vstup:  k¢d povelu                           º
  º 0FH (15) ³    2     ³ statut (nedokumentov no)                     º
  º 11H (17) ³    4     ³ adresa (rezervov no)                         º
  ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼





    ÿDÿrÿiÿvÿeÿr  ÿýÿ¡ÿzÿeÿnÿ¡  ÿkÿoÿnÿzÿoÿlÿy  ÿAÿNÿSÿIÿ.ÿSÿYÿS

    K  nainstalov n¡  driveru  pro rozç¡ýen‚ ovl d n¡ konzoly ANSI.SYS mus¡
bìt    uveden    v   instalaŸn¡m   souboru   CONFIG.SYS   pý¡kazovì   ý dek
DEVICE=ANSI.SYS.  U§ivatelskì  program  potom m…§e vys¡lat znaky na konzolu
pomoc¡  standardn¡ch  znakovìch  funkc¡  (nebo m…§ete soubory vypsat pomoc¡
povelu TYPE nebo ECHO).

    V  n sleduj¡c¡  vìpisu oznaŸuj¡ prvky v z vork ch () parametry (obvykle
numerick‚ hodnoty v ASCII form tu) a znak <ESC> je znak s k¢dem 1BH (27).
ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º            syntaxe        ³              funkce                         º
ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º <ESC>[(ý dek);(pozice)H   ³ nastaven¡ pozice kurzoru (standardnØ        º
º                           ³ je 1;1 - levì horn¡ roh)                    º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[(ý dek);(pozice)f   ³ stejn  funkce jako pýedeçl                  º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[(ý dk…)A            ³ pýesun kurzoru nahoru (standardn¡ poŸet     º
º                           ³ ý dk… je 1; nejde pýes horn¡ okraj)         º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[(ý dk…)B            ³ pýesun kurzoru dol… (standardn¡ poŸet       º
º                           ³ ý dk… je 1; nejde pýes spodn¡ okraj)        º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[(pozic)C            ³ pýesun kurzoru vpravo; stand.=1             º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[(pozic)D            ³ pýesun kurzrou vlevo; stand.=1              º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[2J                  ³ zruçen¡ obrazovky, kurzor do poŸ t.rohu     º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[K                   ³ zruçen¡ zbytku ý dku                        º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[6n                  ³ vìstup akt.ý dku a pozice ve formØ:         º
º                           ³      <ESC>[(ý dek);(pozice)R                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[s                   ³ ulo§en¡ akt. pozice kurzoru (viz <ESC>[u)   º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[u                   ³ n vrat kurzoru na poslednØ ulo§enou pozici  º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[(atr.);...;(atr.)m  ³ nastaven¡ atribut… displeje. (atr.) jsou:   º
º                           ³     0 norm ln¡ (b¡l  na Ÿern‚)              º
º                           ³     1 zvìraznØn‚ (zvìçen  intenzita znak…)  º
º                           ³     4 podtr§en‚ (pouze monochrom. displej)  º
º                           ³     5 blikaj¡c¡                             º
º                           ³     7 reverze (Ÿern  na b¡l‚)               º
º                           ³     8 nezobrazuje (pozad¡=popýed¡)          º
º                           ³    30 Ÿern‚ popýed¡                         º
º                           ³    31 Ÿerven‚ popýed¡                       º
º                           ³    32 zelen‚ popýed¡                        º
º                           ³    33 §lut‚ popýed¡                         º
º                           ³    34 modr‚ popýed¡                         º
º                           ³    35 fialov‚ popýed¡                       º
º                           ³    36 modrozelen‚ popýed¡                   º
º                           ³    37 b¡l‚ popýed¡                          º
º                           ³    40 Ÿern‚ pozad¡                          º
º                           ³    41 Ÿerven‚ pozad¡                        º
º                           ³    42 zelen‚ pozad¡                         º
º                           ³    43 §lut‚ (hnØd‚) pozad¡                  º
º                           ³    44 modr‚ pozad¡                          º
º                           ³    45 fialov‚ pozad¡                        º
º                           ³    46 modrozelen‚ pozad¡                    º
º                           ³    47 b¡l‚ pozad¡                           º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[=(m¢d)h             ³ nastaven¡ ç¡ýky ý dku obrazovky a videom¢du º
º                           ³     0 40x25 textovì m¢d Ÿern  a b¡l         º
º                           ³     1 40x25 textovì m¢d barevnì             º
º                           ³     2 80x25 textovì m¢d Ÿern  a b¡l         º
º                           ³     3 80x25 textovì m¢d barevnì             º
º                           ³     4 grafickì m¢d 320x200 barevnì          º
º                           ³     5 grafickì m¢d 320x200 Ÿernob¡lì        º
º                           ³     6 grafickì m¢d 640x200 Ÿernob¡lì        º
º                           ³     7 pýesun kurzoru na konci ý dku na novì º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[=7l                 ³ kurzor se z konce ý dku nepýesune na novì ý.º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º <ESC>[(Ÿ¡slo);...(Ÿ¡slo)p ³ pýedefinuje kl vesu na jinou hodnotu; prvn¡ º
º       nebo                ³ Ÿ¡slo (nebo prvn¡ znak v ýetØzci) ud v  k¢d º
º <ESC>["(ýetØzec)"p        ³ kl vesy, kter  m  bìt pýedefinov na, n sle- º
º       nebo                ³ duj¡c¡ hodnoty jsou nov‚ hodnoty kl vesy    º
º <ESC>[(Ÿ¡slo);"ýetØzec"p  ³   N sleduj¡c¡ pý¡klad pýedefinuje kl vesu   º
º       nebo                ³   F10 tak, aby vypsala DIR<Enter>:          º
º r…zn‚ kombinace           ³      <ESC>[0;68;"DIR";13p                   º
º                           ³   (viz rozç¡ýen‚ k¢dy kl ves)               º
º                           ³ K navr cen¡ k¢d… k ves na jejich p…vodn¡    º
º                           ³ hodnoty nastavte tyto kl vesy na jejich     º
º                           ³ p…vodn¡ k¢dy; napý. n vrat hodnoty F10:     º
º                           ³      <ESC>[0;68;0;68p                       º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    K  zjiçtØn¡,  zda  je ANSI.SYS nainstalov n, zobrazte funkci <ESC>[6n a
ihned ŸtØte ze standardn¡ho vstupu. MØl byjste zde pýeŸ¡st £daj ve tvaru:
    <ESC>[(ý dek);(pozice)R.

    Je  obt¡§n‚  experimentovat  se  sekvenc¡ ANSI pý¡mo z povelov‚ho ý dku
syst‚mu DOS, neboý DOS neumo§åuje pý¡mì vstup z kl vesnice znaku ESC. Jedna
z mo§nost¡ je pou§¡t syst‚movì pý¡kaz PROMPT:

    PROMPT $e[7m                  nastav¡ inverzn¡ video
    PROMPT $e[0;68;"DIR";13p      pýedefinuje kl vesu F10 na "DIR"<Enter>
    PROMPT                        nastav¡ prompt do norm ln¡ho stavu






          ÿDÿrÿiÿvÿeÿr  ÿrÿoÿzÿçÿ¡ÿýÿeÿnÿ‚  ÿpÿaÿmÿØÿtÿi  ÿEÿMÿS

    Tato   kapitola  popisuje  form ln¡  specifikaci  Lotus/Intel/Microsoft
(EMS),  kter   se  pou§¡v   k  pý¡stupu  k "rozçiýuj¡c¡" pamØti v syst‚mech
kompatibiln¡ch s PC.

Definice:

    - "ZvØtçen "  pamØœ  se  nach z¡  pouze  u  AT (poŸ¡taŸe PC zalo§en‚ na
      procesoru  286). Je to pamØœ, kter  obsazuje fyzickì adresovì prostor
      nad  1  Megabajt.  V  DOS 3.2 se pou§¡v  zvØtçen  pamØœ pouze pro RAM
      disky (viz pýeruçen¡ INT 15H - funkce 87H a§ 89H).

    - "Rozç¡ýen "   pamØœ   pou§¡v   pamØœovou  desku  kompatibiln¡  s  EMS
      (Expanded  Memory  Specifikation  -  specifikace  rozç¡ýen‚ pamØti) a
      softwarovì  driver pro spr vn‚ pýipojen¡ "str nek" pamØti, kter  m…§e
      bìt  pýep¡n na  na  nebo z fyzickìch adresovìch prostor… nad norm ln¡
      hranici  640  KB  (tj.  nad  A000:0000H  -  tyto  adresy  se norm lnØ
      pou§¡vaj¡ pro videopamØœ a BIOS-ROM). Deska EMS vytv ý¡ Ÿtyýi str nky
      po 16 KB (celkem 64KB) adresovateln‚ pamØti, kter‚ umo§åuj¡ zap¡nat a
      vyp¡nat a§ 8 Megabajt… celkov‚ pamØti.

    EMS  (specifikace  rozç¡ýen‚  pamØti)  je  pr…myslovì standard d vaj¡c¡
program…m  jako  je  LOTUS  1-2-3  apod.  mo§nost  ukl d n¡  dat pro dlouh‚
tabulky.  Pou§¡v   se  tak‚  pro  RAM disky a pro tiskov‚ spoolery (tisky v
pozad¡).  NØkter‚  RAM-rezidentn¡  programy pou§¡vaj¡ pamØœ EMS k uschov n¡
str nek  s  daty  a  programy  (z  d…vodu  spotýebov n¡  minim ln¡ pamØti z
adresov‚ho prostoru 640 KB).

    Pou§it¡  pamØti  EMS  se umo§n¡ instalov n¡m driveru zaý¡zen¡ se jm‚nem
zaý¡zen¡ "EMSXXXX0" a je na nØ odkazov no jako EMM (mana§er EMS). K urŸen¡,
zda  byl tento driver nainstalov n, m…§ete pou§¡t funkci DOS 3DH k pokusu o
otevýen¡  tohoto zaý¡zen¡ jako souboru. Po prvn¡m otevýen¡ m…§ete k z¡sk n¡
statutu  pou§¡t  funkci DOS 44H (IOCTL) - podfunkci 07H. Pokud je n vratovì
statut  (v  AL) = 0, potom nen¡ EMM instalov n a existuje pro nØkter‚ £Ÿely
diskovì soubor se jm‚nem "EMSXXXX0".

    Pokud  je  driver EMM instalov n, nastavuje vektor pýeruçen¡ INT 67H na
sv‚  z hlav¡  zaý¡zen¡.  Tak§e  dalç¡  cesta k testov n¡ pý¡tomnosti EMS je
testov n¡  adresy  vektoru  pro  INT 67H (0:091CH) a otestov n¡ offsetu 0AH
t‚to adresy. Zde by mØl bìt obsa§en ýetØzec znak… "EMSXXXX0".

    K  pý¡stupu na obsluhu rozç¡ýen‚ pamØti (EMS) pou§ijte vektor pýeruçen¡
INT 67H s k¢dem funkce nastavenìm v registru AH:
 
ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
ºk¢d funkce (AH) ³    vìznam                                              º
ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º   40H (64)     ³ poskytnut¡ statutu EMM                                 º
º                ³ (pou§ijte po ujiçtØn¡ se, §e je EMM nainstalov n)      º
º                ³   vìstup: AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   41H (65)     ³ poskytnut¡ fyzick‚ adresy segmentu r meŸku EMS         º
º                ³ (64K ve Ÿtyýech 16K jednotk ch)                        º
º                ³   vìstup: BX=adresa segmentu (pokud je AH=0)           º
º                ³           AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   42H (66)     ³ poskytnut¡ celkov‚/voln‚ pamØti                        º
º                ³   vìstup: DX=celkovì poŸet str nek EMS (16K ka§d )     º
º                ³           BX=poŸet volnìch str nek EMS                 º
º                ³           AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   43H (67)     ³ otevýen¡ identifik toru EMM a pýidØlen¡ str nky        º
º                ³   vstup:  BX=poŸet po§adovanìch str nek                º
º                ³   vìstup: DX=identifik tor EMM (dalç¡ operace)         º
º                ³           AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   44H (68)     ³ mapov n¡ pamØti                                        º
º                ³ (str nkov n¡ jedn‚ ze Ÿtyý pýidØlenìch str nek pamØti  º
º                ³ do fyzick‚ho adresov‚ho prostoru)                      º
º                ³   vstup:  AL=Ÿ¡slo fyzick‚ str nky (0 a§ 3)            º
º                ³           BX=logick  str nka (0 a§ [n-1], kde          º
º                ³               n je celkovì poŸet str nek na ident.     º
º                ³           DX=identifik tor EMM                         º
º                ³   vìstup: AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   45H (69)     ³ uzavýen¡ identifik toru/uvolnØn¡ str nek               º
º                ³ (uvoln¡ pamØœ pýidØlenou funkc¡ EMM 43H)               º
º                ³   vstup:  DX=identifik tor EMM                         º
º                ³   vìstup: AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   46H (70)     ³ poskytnut¡ Ÿ¡sla verze EMM                             º
º                ³   vìstup: AL=Ÿ¡slo verze EMM v k¢du BCD (0302H=3.2)    º
º                ³           AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   47H (71)     ³ ulo§en¡ mapovac¡ho kontextu                            º
º                ³ (EMM ulo§¡ aktu ln¡ mapov n¡ fyzickìch na logick‚      º
º                ³ str nky EMM, tak§e programy nebo drivery zaý¡zen¡      º
º                ³ mohou pou§¡t sv‚ vlastn¡ mapov n¡ pýi sv‚m bØhu)       º
º                ³   vstup:  DX=identifik tor EMM po§adovan‚ho procesu    º
º                ³   vìstup: AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   48H (72)     ³ navr cen¡ mapovac¡ho kontextu                          º
º                ³ (EMM navr t¡ str nkov‚ mapov n¡, kter‚ bylo ulo§eno    º
º                ³ pýedch zej¡c¡m vol n¡ funkce 47H se stejnìm identifi-  º
º                ³ k torem. Diskov‚ drivery a programy by mØly toto       º
º                ³ pou§¡t pýes n vratem do aplikaŸn¡ho programu.)         º
º                ³   vstup:  DX=ovladaŸ EMM po§adovan‚ho procesu          º
º                ³   vìstup: AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   49H (73)     ³ rezervov no - pro EMM verze 3.2 nedefinov no           º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   4AH (74)     ³ rezervov no - pro EMM verze 3.2 nedefinov no           º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   4BH (75)     ³ poŸet str nek ovladaŸe                                 º
º                ³ (navrac¡ poŸet str nek EMS vlastnØn‚ identifik torem)  º
º                ³   vstup:  DX=identifik tor EMM (proces m…§e m¡t v¡ce   º
º                ³                                 ne§ 1 identifik tor)   º
º                ³   vìstup: BX=poŸet logickìch 16-K str nek vlastnØn‚    º
º                ³              identifik torem (1-512)                   º
º                ³           AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   4CH (76)     ³ poŸet aktivn¡ch ovladaŸ…                               º
º                ³ (pou§¡v  se pýed vol n¡m funkce EMM 4DH)               º
º                ³   vstup:  BX=Ÿ¡slo aktivn¡ho identifik toru            º
º                ³           AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   4DH (77)     ³ poskytnut¡ informace o str nk ch (vçechny identif.)    º
º                ³ (navrac¡ pole informac¡ popisuj¡c¡ kolik pamØti EMS je º
º                ³ pýidØleno aktivn¡mu identifik toru)                    º
º                ³   vstup:  ES:DI=adresa vyrovn vac¡ pamØti              º
º                ³   vìstup: BX=poŸet aktivn¡ch identifik tor… EMM        º
º                ³           ES:DI=vyrovn vac¡ pamØœ je zaplnØna          º
º                ³                 2-slovn¡mi polo§kami (poŸet je v BX).  º
º                ³                 Prvn¡ slovo je Ÿ¡slo identifik toru    º
º                ³                 a druh‚ je celkovì poŸet str nek       º
º                ³                 vlastnØnìch t¡mto identifik torem      º
º                ³           AH=statut EMM                                º
ÌÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¹
º   4EH (78)     ³ poskytnut¡/nastaven¡ mapy zadan‚ str nky               º
º                ³ (Tato funkce je navrhov na k podpoýe v¡ce£lohov‚ho     º
º                ³ operaŸn¡ho syst‚mu pro umo§nØn¡ pln‚ho ovl d n¡ EMS.   º
º                ³ Mapovac¡ pole m…§e obsahovat r…zn‚ hardwarovØ z visl‚  º
º                ³ informace.)                                            º
º                ³   vstup:  AL=Ÿ¡slo podfunkce                           º
º                ³              AL=0 - poskytnut¡ mapovac¡ch registr…     º
º                ³                     do pole na adrese ES:DI            º
º                ³              AL=1 - nastaven¡ mapovac¡ch registr…      º
º                ³                     z pole na adrese DS:SI             º
º                ³              AL=2 - poskytnut¡ a nastaven¡ mapovac¡ch  º
º                ³                     registr… (kombinace funkc¡ 1 a 2)  º
º                ³              AL=3 - dotaz na velikost vyrovn vac¡      º
º                ³                     pamØti potýebn‚ pro funkce 0 a§ 2  º
º                ³   vìstup: AL=velikost bufferu mapovac¡ch registr… (fn3)º
º                ³           ES:DI=buffer obsahuje pole informac¡ EMS     º
º                ³                 (podfunkce 0 a§ 2)                     º
º                ³           AH=statut EMM                                º
ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Po n vratu z funkce zkontrolujte statut v AH. Pokud nen¡ AH=0, potom
tato funkce nebyla provedena. Chyby navr cen‚ v AH:

   ÉÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
   º statut ³      vìznam                                              º
   ÌÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
   º  00H   ³      § dn  chyba; funkce byla £spØçn                     º
   º  80H   ³      vnitýn¡ chyba driveru EMM                           º
   º  81H   ³      hardwarov  chyba funkce pamØœov‚ desky EMS          º
   º  82H   ³      EMM je zanepr zdnØn                                 º
   º  83H   ³      neplatnì identifik tor                              º
   º  84H   ³      po§adovan  nedefinovan  funkce                      º
   º  85H   ³      nen¡ volnì § dnì dalç¡ identifik tor EMM            º
   º  86H   ³      chyba v ulo§en¡ nebo navr cen¡ mapovac¡ho kontextu  º
   º  87H   ³      alokaŸn¡ po§adavek byl delç¡ ne§ celkov  pamØœ EMS  º
   º  88H   ³      alokaŸn¡ po§adavek byl delç¡ ne§ voln‚ str nky      º
   º  89H   ³      nem…§ete otevý¡t identifik tor s poŸtem str nek 0   º
   º  8AH   ³      v ç identifik tor nevlastn¡ tak mnoho str nek       º
   º  8BH   ³      nepovolen‚ mapov n¡ - jsou definov ny pouze fyzick‚ º
   º        ³      str nky 0 a§ 3                                      º
   º  8CH   ³      prostor pro ukl d n¡ mapovac¡ch kontext… je plnì    º
   º  8DH   ³      m…§ete ulo§it kontext pouze jednou na identifik tor º
   º  8EH   ³      nem…§ete navr tit kontext bez pýedchoz¡ho ulo§en¡   º
   º  8FH   ³      parametr podfunkce nen¡ definovanì                  º
   ÈÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼






                         ÿPÿýÿeÿrÿuÿçÿeÿnÿ¡  ÿDÿOÿS

    Pro  DOS  jsou  vyhrazena  pýeruçen¡  INT 20H a§ INT 3FH. Tabulka adres
obslu§nìch  program…  pýeruçen¡ (vektory pýeruçen¡) je um¡stØna na adres ch
80H  -  FCH. U§ivatelsk‚ programy mohou vy§adovat pouze pýeruçen¡ 20H, 21H,
25H,  26H  a  27H  (pro  DOS  verze  2.0  a vyçç¡ jsou nejlepç¡ metodou pro
vy§ d n¡  pýeruçen¡  20H  a 27H funkce 4CH a 31H). Pýeruçen¡ 22H, 23H a 24H
nemohou  bìt  po§adov na  u§ivatelskìmi  programy;  jsou  to pouze pamØœov 
m¡sta, kde je ulo§ena adresa segmentu a relativn¡ adresy.

INT  20H (INT 32; 0:0080H) - ukonŸen¡ programu
INT  21H (INT 33; 0:0084H) - vol n¡ funkce DOS
INT  22H (INT 34; 0:0088H) - adresa ukonŸen¡ programu
INT  23H (INT 35; 0:008CH) - adresa obsluhy pýeruçen¡ <Ctrl>-<Break>
INT  24H (INT 36; 0:0090H) - adresa obsluhy kritickìch chyb
INT  25H (INT 37; 0:0094H) - absolutn¡ Ÿten¡ z disku
INT  26H (INT 38; 0:0098H) - absolutn¡ z pis na disk
INT  27H (INT 39; 0:009CH) - ukonŸen¡ s ponech n¡m programu v pamØti
INT  28H (INT 40; 0:00A0H) - Ÿasov n¡ £sek… DOS
INT  29H (INT 41; 0:00A4H) - rezervov no
INT  2AH (INT 42; 0:00A8H) - rezervov no
INT  2BH (INT 43; 0:00ACH) - rezervov no
INT  2CH (INT 44; 0:00B0H) - rezervov no
INT  2DH (INT 45; 0:00B4H) - rezervov no
INT  2EH (INT 46; 0:00B8H) - proveden¡ povelu DOS
INT  2FH (INT 47; 0:00BCH) - pýep¡nateln‚ pýeruçen¡ (DOS)
INT  30H (INT 48; 0:00C0H) - rezervov no
INT  31H (INT 49; 0:00C4H) - rezervov no
INT  32H (INT 50; 0:00C8H) - rezervov no
INT  33H (INT 51; 0:00CCH) - rezervov no
INT  34H (INT 52; 0:00D0H) - rezervov no
INT  35H (INT 53; 0:00D4H) - rezervov no
INT  36H (INT 54; 0:00D8H) - rezervov no
INT  37H (INT 55; 0:00DCH) - rezervov no
INT  38H (INT 56; 0:00E0H) - rezervov no
INT  39H (INT 57; 0:00E4H) - rezervov no
INT  3AH (INT 58; 0:00E8H) - rezervov no
INT  3BH (INT 59; 0:00ECH) - rezervov no
INT  3CH (INT 60; 0:00F0H) - rezervov no
INT  3DH (INT 61; 0:00F4H) - rezervov no
INT  3EH (INT 62; 0:00F8H) - rezervov no
INT  3FH (INT 63; 0:00FCH) - rezervov no




ÿIÿNÿTÿ  ÿ2ÿ0ÿH (INT 32; 0:0080H) - ukonŸen¡ programu

    vstup:    CS = adresa segmentu prefixu programov‚ho segmentu

    vìstup:   nen¡

    Pýeruçen¡  INT 20H ukonŸ¡ zpracov vanì proces a vr t¡ ý¡zen¡ otcovsk‚mu
procesu   (norm lnØ   to  je  povelovì  interpreter  COMMAND.COM).  Vçechny
vyrovn vac¡  pamØti soubor… se vypr zdn¡, navr t¡ se p…vodn¡ obsahy vektor…
pýeruçen¡  INT  22H  (ukonŸen¡  programu),  INT  23H (obsluha u§ivatelsk‚ho
pýeruçen¡  Ctrl-Break) a INT 24H (obsluha kritick‚ chyby) a pýed  se ý¡zen¡
na adresu vektoru pýeruçen¡ INT 22H.

    Pýed  vyvol n¡m  tohoto  pýeruçen¡  mus¡  registr  CS  obsahovat adresu
segmentu  prefixu  programov‚ho  segmentu PSP. Pokud obsah registru CS nen¡
roven  segmentu PSP, m…§ete prov‚st instrukci skoku JMP na adresu PSP:0000H
nebo instrukci RET (provede se skok na tuto adresu). Z prefixu programov‚ho
segmentu jsou po ukonŸen¡ obnoveny n sleduj¡c¡ n vratov‚ adresy:

           ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
           º vìstupn¡ adresa              ³  relativn¡ adresa  º
           ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
           º ukonŸen¡ programu (INT 22H)  ³         0AH        º
           º <Ctrl>-<Break> (INT 23H)     ³         0EH        º
           º kritick  chyba (INT 24H)     ³         12H        º
           ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

Pozn.: Pýed  vy§ d n¡m  tohoto  pýeruçen¡ je nutno uzavý¡t vçechny soubory,
       kter‚ zmØnily svou d‚lku. Nen¡-li zmØnØnì soubor uzavýen, jeho d‚lka
       se  nezaznamen   do adres ýe spr vnØ (viz funkce 10H a 3EH pro popis
       uzavýen¡ souboru).

       Pýeruçen¡ je ekvivalentn¡ funkci 00H (pýeruçen¡ INT 21H).

       Pýeruçen¡  INT  20H  se pou§¡v  t‚mØý v§dy pro ukonŸen¡ Ÿinnosti pýi
       pou§it¡ starìch .COM soubor…. Nov‚ programy by mØly vçechny pou§¡vat
       funkci  4CH  (ukonŸen¡  procesu),  neboœ tato funkce nevy§aduje, aby
       registr  CS  ukazoval  adresu segmentu PSP a nav¡c umo§åuje pýed vat
       otcovsk‚mu procesu vìstupn¡ k¢d.

       Programy  ve form tu COM obvykle bØ§¡ s nastavenìm registrem CS=PSP,
       tak§e  mohou  kdykoliv  prov‚st  ukonŸen¡  programu  pomoc¡ INT 20H.
       Programy ve tvaru EXE by mØly prov‚st instrukce FAR JMP nebo FAR RET
       k  pýed n¡  ý¡zen¡ na adresu PSP:0000H, kter  obsahuje instrukci INT
       20H.

       Z tohoto pýeruçen¡ neexistuje mo§nost n vratu.




ÿIÿNÿTÿ  ÿ2ÿ1ÿH (INT 33; 0:0084H) - vol n¡ funkce DOS

    vstup:    AH = Ÿ¡slo funkce
              ostatn¡ registry = obsah podle po§adavk… funkc¡

    vìstup:   podle specifikac¡ jednotlivìch funkc¡

    Toto  pýeruçen¡  je  vstupn¡m  bodem  do  vØtçiny  funkc¡  DOS. Program
po§aduj¡c¡  funkci DOS mus¡ pýipravit nejdý¡ve vçechny registry a informace
v  ý¡d¡c¡ch  bloc¡ch, nastavit do registru AH Ÿ¡slo po§adovan‚ funkce DOS a
potom  vyvolat  pýeruçen¡  INT  21H.  Popis jednotlivìch funkc¡ viz "Slu§by
modulu DOS".





ÿIÿNÿTÿ  ÿ2ÿ2ÿH (INT 34; 0:0088H) - adresa ukonŸen¡ programu

    Pýi  ukonŸen¡  programu  se  pýed   ý¡zen¡  na adresu popsanou vektorem
INTú22H  (adresa  vektoru  je  0000:0088H).  Tuto  adresu  kop¡ruje DOS pýi
vytvoýen¡  programov‚ho segmentu PSP (pýi vyvol n¡ programu funkc¡ 4BH nebo
pýi  vyvol n¡  funkce  26H  -  vytvoýen¡ PSP) do jeho prefixu na adresu 0AH
(adresa ukonŸen¡ programu). N vratovou adresu z programu lze zmØnit vol n¡m
funkce  25H  (nastaven¡  vektoru  pýeruçen¡).  DOS  norm lnØ nastavuje tuto
adresu pýi prov dØn¡ programu vol n¡m funkce EXEC. Pýi ukonŸen¡ programu se
adresa   INTú22H  navr t¡  z  prefixu  programov‚ho  segmentu  ukonŸovan‚ho
programu  zpØt  do p…vodn¡ho stavu. Program m…§e bìt ukonŸen buÔ pýeruçen¡m
INT 20H nebo INT 27H nebo funkcemi 00H, 4CH (EXIT) nebo 31H (KEEP).

    DOS  pou§ije  tento  vektor  t‚§  pýi po§adavku pýeruçen¡ bØhem INT 24H
(obsluha kritick‚ chyby).

Pozn.: Nevyvol vejte INT 22H ani obsluhu tohoto pýeruçen¡ pý¡mo.




ÿIÿNÿTÿ  ÿ2ÿ3ÿH (INT 35; 0:008CH) - adresa obsluhy pýeruçen¡ Ctrl-Break

    Jestli§e  u§ivatel  bØhem  vstupu  z kl vesnice nebo vìstupu na displej
stiskne  <Ctrl>-<Break>  (<Ctrl>-C),  pýed   se  ý¡zen¡  na  adresu obsluhy
pýeruçen¡ Ctrl-Break urŸenou vektorem INT 23H. Tato adresa se pýi vytvoýen¡
programov‚ho   segmentu  (tj.  pýi  funkci  DOS  26H  -  vytvoýen¡  prefixu
programov‚ho segmentu PSP, nebo funkci DOS 4BH - naŸten¡ programu do pamØti
a  jeho  start)  kop¡ruje  do  jeho prefixu na relativn¡ adresu 0EH (adresa
obsluhy  pýeruçen¡  Ctrl-Break).  Po  ukonŸen¡  programu se p…vodn¡ hodnota
vektoru INT 23H z t‚to adresy PSP navr t¡.

    Jestli§e  rutina obsluhy Ctrl-Break uchov v  vçechny registry, m…§e bìt
ukonŸena  pomoc¡  instrukce IRET (n vrat z pýeruçen¡) a pokraŸuje prov dØn¡
programu.  Pýi  vìskytu  pýeruçen¡  se vçechny registry nastav¡ na hodnotu,
kterou  mØly  v  okam§iku,  kdy  program  volal funkci DOS, kter  zp…sobila
pýeruçen¡  Ctrl-Break.  Na  Ÿinnost obsluhy Ctrl-Break nejsou kladena § dn 
omezen¡  -  vŸetnØ  vol n¡  funkc¡ DOSu - za pýedpokladu, §e se pýi pou§it¡
IRET  nezmØn¡  registry.  Avçak  pokud  obslu§nì program pýeruçen¡ obsahuje
funkce  DOS pro znakovì vstup/vìstup a u§ivatel opØt stiskne <Ctrl>-<Break>
(<Ctrl>-C), operaŸn¡ syst‚m havaruje. K nastaven¡ vektoru INT 23H na adresu
vaçeho  obslu§n‚ho  programu  pou§ijte  funkci  25H. Pokud chcete pýeruçen¡
Ctrl-Break ignorovat, nastavte jako obsluhu pýeruçen¡ pouze instrukci IRET.

    Jestli§e  je pomoc¡ <Ctrl>-<Break> pýeruçena funkce 09H (vìstup ýetØzce
na obrazovku) nebo 0AH (vstup ýetØzce z kl vesnice), objev¡ se na obrazovce
posloupnost bajt… 03H, 0DH, 0AH (ETX, CR, LF; bajt 03H se zobraz¡ jako text
"^C")  a  funkce  pokraŸuje  na  zaŸ tku  dalç¡ho ý dku. Standardn¡ obsluha
pýeruçen¡  INT  23H  zp…sob¡  n vrat  do  otcovsk‚ho  procesu  (obvykle  do
povelov‚ho interpreteru COMMAND.COM).

    Jestli§e program vytv ý¡ novì segment a zav d¡ do pamØti druhì program,
kterì  mØn¡ adresu obsluhy Ctrl-Break, pak se pýi ukonŸen¡ druh‚ho programu
hodnota  adresy  obsluhy  Ctrl-Break vr t¡ do stavu pýed prov dØn¡m druh‚ho
programu (hodnota vektoru se obnov¡ s prefixu programov‚ho segmentu PSP).

    Norm lnØ  prov d¡  DOS  kontrolu  pýeruçen¡ Break pouze bØhem znakovìch
vstupnØ/vìstupn¡ch  funkc¡  - tj. pý¡stup na konzolu, tisk rnu nebo s‚riov‚
rozhran¡,  s  rozç¡ýenou kontrolou Break (viz pýeruçen¡ INTú21H/funkce 33H)
tak‚  bØhem  vçech  ostatn¡ch vstupnØ/vìstupn¡ch funkc¡ (kromØ funkc¡ 06H a
07H).

    Pokud  si  pýejete  abortovat  program  (n vrat do otcovsk‚ho procesu),
nastavte  pý¡znak  pýenosu CF a proveÔte instrukci n vratu pomoc¡ instrukce
FAR  RET.  To zp…sob¡, §e DOS provede norm ln¡ £klid a odchod do otcovsk‚ho
procesu.

    Nejjednoduçç¡  cestou,  jak  zajistit spr vnou odezvu procesu na zad n¡
<Ctrl>-<Break>  (<Ctrl>-C),  je  prov dØt  ka§dou  chv¡li  funkci  DOS  0BH
(kontrola vstupn¡ho statutu konzoly).




ÿIÿNÿTÿ  ÿ2ÿ4ÿH (INT 36; 0:0090H) - adresa obsluhy kritickìch chyb

    vstup:    AX = doplåuj¡c¡ informace o chybØ
              DI = k¢d chyby
              BP:SI = z hlav¡ zaý¡zen¡

    Jestli§e  se  pýi  prov dØn¡  syst‚movìch  slu§eb  I/O  na disku objev¡
kritick   chyba  disku (napý. vadnì sektor nebo jin  chyba hardware), pýed 
se  ý¡zen¡ na adresu urŸenou vektorem INT 24H. Tato adresa se pýi vytvoýen¡
programov‚ho   segmentu   (pomoc¡   funkce  DOS  26H  -  vytvoýen¡  prefixu
programov‚ho  segmentu  PSP,  nebo funkce DOS 4BH - naŸten¡ programu a jeho
start)  kop¡ruje  do  jeho  prefixu  na  relativn¡  adresu 12H. Po ukonŸen¡
programu  (tj. pýi n vratu do otcovsk‚ho procesu) se adresa vektoru INT 24H
z  prefixu programov‚ho segmentu opØt obnov¡ na p…vodn¡ hodnotu, jakou mØla
pýed startem programu.

    Kdy§  pýeruçen¡  INT  24H  pýed   ý¡zen¡  programu  pro oçetýen¡ chyby,
registry AX a DI obsahuj¡ k¢dy popisuj¡c¡ tuto chybu (tyto hodnoty registr…
nastavuje  syst‚mov   slu§ba  pýed  vyvol n¡m  pýeruçen¡ INT 24H). Pokud se
chyba  vztahuje  k diskovìm operac¡m, je bit 7 registru AH vynulov n. Je-li
bit  7  registru  AH  nastaven  na  1,  znamen  to obvykle, §e se nejedn  o
diskovou  chybu (aŸkoliv chyba ve çpatn‚m zobrazen¡ tabulky alokace soubor…
FAT  tak‚  nastavuje bit 7 registru AH na 1). Bity 0-7 registru DI obsahuj¡
k¢d  chyby  (bity  8-15  nejsou definov ny). Registry BP:SI obsahuj¡ adresu
ý¡d¡c¡ho   bloku  z hlav¡  zaý¡zen¡,  kde  mohou  bìt  vyhled ny  doplåkov‚
informace.

     V  pý¡padØ, kdy je 7. bit AH vynulov n (tj. chyba blokov‚ho zaý¡zen¡),
obsahuje  AL identifikaŸn¡ Ÿ¡slo diskov‚ mechaniky (0=A, 1=B, atd.), bity 0
a§  5  registru  AH  obsahuj¡c¡ tyto doplåuj¡c¡ informace (bity 3 a§ 5 jsou
definov ny pouze pro operaŸn¡ syst‚m DOS 3.x a vyçç¡):

ÉÍÍÍÂÍÍÍÂÍÍÍÂÍÍÍÂÍÍÍÂÍÍÍÂÍÍÍÂÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º 7 ³ 6 ³ 5 ³ 4 ³ 3 ³ 2 ³ 1 ³ 0 ³                vìznam                   º
ÌÍÍÍÅÍÍÍÅÍÍÍÅÍÍÍÅÍÍÍÅÍÍÍÅÍÍÍÅÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
º 0 ³ 0 ³ . ³ . ³ . ³ . ³ . ³ 0 ³ chyba Ÿten¡                             º
º 0 ³ 0 ³ . ³ . ³ . ³ . ³ . ³ 1 ³ chyba z pisu                            º
º 0 ³ 0 ³ . ³ . ³ . ³ 0 ³ 0 ³ . ³ chyba zahrnuj¡c¡ syst‚mov‚ soubory DOS  º
º 0 ³ 0 ³ . ³ . ³ . ³ 0 ³ 1 ³ . ³ chyba zahrnuj¡c¡ FAT disku              º
º 0 ³ 0 ³ . ³ . ³ . ³ 1 ³ 0 ³ . ³ chyba zahrnuj¡c¡ adres ý disku          º
º 0 ³ 0 ³ . ³ . ³ . ³ 1 ³ 1 ³ . ³ chyba zahrnuj¡c¡ datovì prostor disku   º
º 0 ³ 0 ³ . ³ . ³ 1 ³ . ³ . ³ . ³ mo§n‚ opuçtØn¡ operace s FAIL-chyba     º
º 0 ³ 0 ³ . ³ 1 ³ . ³ . ³ . ³ . ³ mo§n‚ opuçtØn¡ operace s RETRY-opakov n¡º
º 0 ³ 0 ³ 1 ³ . ³ . ³ . ³ . ³ . ³ mo§n‚ opuçtØn¡ operace s IGNORE-ignorov.º
ÈÍÍÍÁÍÍÍÁÍÍÍÁÍÍÍÁÍÍÍÁÍÍÍÁÍÍÍÁÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    V  pý¡padØ,  §e  je  7.  bit  registru AH nastaven (tj. chyba znakov‚ho
zaý¡zen¡), nejsou bity 0 a§ 6 registru AH definov ny.

    Bity  0-7 registru DI obsahuj¡ n sleduj¡c¡ informace (vyçç¡ bity nejsou
definov na):

 ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º chybovì k¢d  ³                      popis                            º
 ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º  00H ( 0)    ³       pokus o z pis na disk chr nØnì proti z pisu     º
 º  01H ( 1)    ³       nezn m‚ Ÿ¡slo jednotky (diskov‚)                º
 º  02H ( 2)    ³       diskov  jednotka nen¡ pýipravena                º
 º  03H ( 3)    ³       neplatnì pý¡kaz                                 º
 º  04H ( 4)    ³       chyba dat (chyba kontroln¡ho souŸtu CRC)        º
 º  05H ( 5)    ³       çpatn  d‚lka struktury po§adavku                º
 º  06H ( 6)    ³       chyba pýi vystaven¡                             º
 º  07H ( 7)    ³       nezn mì typ m‚dia                               º
 º  08H ( 8)    ³       sektor nenalezen                                º
 º  09H ( 9)    ³       v tisk rnØ nen¡ pap¡r                           º
 º  0AH (10)    ³       chyba pýi z pisu                                º
 º  0BH (11)    ³       chyba Ÿten¡                                     º
 º  0CH (12)    ³       vçeobecn , nespecifikovateln  chyba             º
 ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Pýeruçen¡  obsluhy  kritick‚ chyby m…§ete obslou§it nab¡dkou dalç¡ akce
u§ivateli  (tj.  napý.  vìzva  k  uzavýen¡  dv¡ýek disketov‚ mechaniky nebo
zapnut¡  tisk rny).  Obsluha  pýeruçen¡  INT  24H by nemØla pou§¡vat funkce
DOSu.  Je-li  to  nezbytn‚, m…§e pou§¡t funkce 01H a§ 0CH (znakov‚ vstupy a
vìstupy)  a  funkci  59H (rozçiýuj¡c¡ chybov‚ informace). Pou§it¡ jak‚koliv
jin‚ slu§by zniŸ¡ z sobn¡k DOSu a ponech  DOS v nedefinovan‚m stavu. Pomoc¡
funkce  DOS  59H  (rozçiýuj¡c¡ chybov‚ informace) a pomoc¡ z hlav¡ zaý¡zen¡
adresovan‚ho BP:SI m…§ete obdr§et rozçiýuj¡c¡ informace o vznikl‚ chybØ.

    U§ivatelskì  z sobn¡k  bude  na  zaŸ tku  programu pro obsluhu kritick‚
chyby   obsahovat   hodnoty  nastaven¡  registr…  programu,  kterì  vyvolal
pý¡sluçnou  funkci  DOS.  K navr cen¡ tØchto informac¡ pou§ijte n sleduj¡c¡
instrukce:

         push      bp                  ; pomocn‚ ulo§en¡ registru BP
         mov       bp,sp               ; BP jako ukazatel dat v z sobn¡ku

    Obsah  dat  v u§ivatelsk‚m z sobn¡ku od vrcholu na dno z sobn¡ku (prvn¡
polo§ka d le popsan  je na vrcholu z sobn¡ku, tedy naposledy ulo§en ) je:
 
ÉÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
º  SP      ³ hodnota BP, kter  byla ulo§ena pomocnou instrukc¡ PUSH BP   º
º  SP +  2 ³ CS:IP ukazatel slu§by DOS, kter  vyvolala pýeruçen¡ INT 24H º
º  SP +  6 ³ registr pý¡znak… pýi pýeruçen¡ ze slu§by DOS                º
º  SP +  8 ³ AX (u§ivatelskì registr v okam§iku p…vodn¡ § dosti INT 21H) º
º  SP + 10 ³ BX                        -  "  -                           º
º  SP + 12 ³ CX                        -  "  -                           º
º  SP + 14 ³ DX                        -  "  -                           º
º  SP + 16 ³ SI                        -  "  -                           º
º  SP + 18 ³ DI                        -  "  -                           º
º  SP + 20 ³ BP                        -  "  -                           º
º  SP + 22 ³ DS                        -  "  -                           º
º  SP + 24 ³ ES                        -  "  -                           º
º  SP + 26 ³ CS:IP z programu, kterì p…vodØ vyvolal slu§bu INT 21H       º
º  SP + 30 ³ registr pý¡znak… z programu, kterì p…vodnØ vyvolal slu§bu   º
ÈÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Tyto  informace  lze  pou§¡t  k urŸen¡, kter  funkce DOS vyvolala chybu
(Ÿ¡slo  funkce  je  ulo§eno v z sobn¡ku na offsetu SP+9, tj. v u§ivatelsk‚m
registru AH, parametry jsou ulo§eny v ostatn¡ch registrech).

    Pýi  n vratu z pýeruçen¡ instrukc¡ IRET (po obsluze chyby nebo pokusu o
jej¡ odstranØn¡) bude DOS pokraŸovat v Ÿinnosti podle obsahu AL takto:

AL = 0 - ignorov n¡ chyby
   = 1 - opakov n¡ operace
   = 2 - ukonŸen¡ programu prostýednictv¡m INT 23H (abortov n¡)
   = 3 - n vrat do aplikaŸn¡ho programu s ohl çen¡m chyby DOS (> DOS 3.00)

    Volba  AL=3  by  se zd la bìt nejvodnØjç¡. Napý¡klad: pokud operace pro
otevýen¡ souboru zp…sob¡ chybu vzniklou z d…vodu nedostatku m¡sta na disku,
bylo  by  mo§n‚  nechat  v ç  program  obslou§it tento stav bØ§nìmi zp…soby
obsluhy chyb. Avçak to m  tyto nevìhody:

    - volba AL=3 nen¡ povolen  pro verze DOS menç¡ ne§ DOS 3.00
    - DOS  v§dy  navrac¡  chybovì  k¢d  53H  (chyba  obsluhy kritick‚ chyby
      INTú24H), kterì neobsahuje mnoho informac¡


Pozn.: Pýed  pýed n¡m  ý¡zen¡ obluze pýeruçen¡ INT 24H v d…sledku diskovìch
       chyb se DOS pØtkr t pokouç¡ o nov‚ proveden¡ operace.

       Rutina se spust¡ v zablokovan‚m stavu.

       Registry SS, SP, DS, ES, BX, CX a DX je nutno zachovat.

       Pýeruçovac¡ program nesm¡ zmØnit obsah z hlav¡ zaý¡zen¡.

       Norm ln¡  obsluha  pýeruçen¡ INT 24H nab¡dne u§ivateli mo§nost volby
       dalç¡ Ÿinnosti DOS:
                 Abort, Retry, Ingore, Fault ? _
            (tj. Abortovat, opakovat, ignorovat, ohl sit chybu ?)

       Pýeruçen¡  INT  24H se neprovede, jestli§e se chyba objev¡ v pr…bØhu
       prov dØn¡  pýeruçen¡  INT 25H (absolutn¡ Ÿten¡ z disku) nebo INT 26H
       (absolutn¡ z pis na disk). Tyto chyby se obvykle zpracov vaj¡ pomoc¡
       chybov‚ho programu DOS v souboru COMMAND.COM, kterì diskovou operaci
       znovu  spust¡,  pak  d v   u§ivateli  mo§nost, aby zruçil nebo znovu
       spustil operaci nebo chybu ignoroval.

       Jestli§e  pýeruçovac¡  program  bude  chyby  oçetýovat  m¡sto aby se
       vr til  do DOSu (do funkce, kter  vyvolala obsluhu chyby), mØl by ze
       z sobn¡ku  obnovit  registry aplikaŸn¡ho programu, odstranit vçechna
       slova  ze  z sobn¡ku  kromØ  posledn¡ch tý¡ (tj. n vratov  adresa do
       aplikaŸn¡ho  programu  a  registr  pý¡znak…) a pak prov‚st instrukci
       IRET.  T¡m  se  vr t¡  do programu bezpostýednØ za instrukci INT 21H
       volaj¡c¡  funkci,  kter  zp…sobila chybu. Je nutno si uvØdomit, §e v
       takov‚m  pý¡padØ  bude DOS v nestabiln¡m stavu dokud nebude vyvol na
       funkce  vyçç¡  ne§  0CH.  BØ§nØ je chyba indikov na pýed n vratem do
       aplikaŸn¡ho  programu  nastaven¡m  chybov‚ho  k¢du  do registru AX a
       nastaven¡m  pý¡znaku  pýenosu  CF  na 1 jako indikace chyby (vØtçina
       dobrìch program… tuto techniku pou§¡v ).







ÿIÿNÿTÿ  ÿ2ÿ5ÿH (INT 37; 0:0094H) - absolutn¡ Ÿten¡ z disku

    vstup:    AL = Ÿ¡slo diskov‚ jednotky (0=A, 1=B, atd.)
              DS:BX = adresa vyrovn vac¡ pamØti (kam se provede Ÿten¡)
              CX = poŸet sektor…, kter‚ se maj¡ Ÿ¡st
              DX = poŸ teŸn¡ relativn¡ sektor (od zaŸ tku disku)

    vìstup:   AX = chybovì k¢d (je-li CF=1)
              pý¡znaky = DOS ponech  registr pý¡znak… v z sobn¡ku !

    Pýeruçen¡ INT 25H zp…sob¡ naŸten¡ CX sektor… od sektoru DX z disku nebo
logick‚ho  zaý¡zen¡  AL  do  vyrovn vac¡  pamØti na adresu DS:BX. Pýeruçen¡
pou§¡v   slu§by  modulu  BIOS - Ÿten¡ sektoru z disku. Logickì sektor disku
zaŸ¡n   zav dØc¡m  sektorem. U pevn‚ho disku je prvn¡ logickì sektor prvn¡m
(zav dØc¡m)  sektorem  partie  disku,  nen¡ tedy fyzicky prvn¡m sektorem na
prvn¡ stopØ disku - hlavn¡ zav dØc¡ z znam pevn‚ho disku nen¡ touto slu§bou
v…bec  pý¡stupnì  (je  nutn‚  pou§¡t  pýeruçen¡ INT 13H). Logick‚ Ÿ¡slov n¡
sektor… na disku se zvyçuje od Ÿ¡sla 0 po ka§d‚m sektoru na stopØ, potom po
ka§d‚ hlavØ a nakonec po ka§d‚m v lci na disku.

    Chybov‚ k¢dy navr cen‚ v registru AH (pokud je CF nastaven na 1):
 ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º chybovì k¢d  ³                      popis                            º
 ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º  01H (  1)   ³       neplatnì povel                                  º
 º  02H (  2)   ³       adresov  znaŸka nenalezena                      º
 º  03H (  3)   ³       pokud o z pis na disk chr nØnì proti z pisu     º
 º  04H (  4)   ³       sektor nenalezen                                º
 º  05H (  5)   ³       chyba funkce reset                              º
 º  07H (  7)   ³       chyba aktivity diskovìch parametr…              º
 º  08H (  8)   ³       pýeteŸen¡ DMA                                   º
 º  09H (  9)   ³       chyba pýekroŸen¡ okraje DMA                     º
 º  10H ( 16)   ³       chyba dat CRC nebo ECC                          º
 º  11H ( 17)   ³       mo§n  chyba opravena pomoc¡ ECC (AL = d‚lka)    º
 º  20H ( 32)   ³       chyba ýadiŸe                                    º
 º  40H ( 64)   ³       chybn‚ vystaven¡                                º
 º  80H (128)   ³       time-out diskov‚ mechaniky                      º
 º  BBH (187)   ³       nedefinovateln  chyba                           º
 º  FFH (255)   ³       chyba rozpozn n¡ operace                        º
 ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

    Chybov‚ k¢dy navr cen‚ v registru AL:
 ÉÍÍÍÍÍÍÍÍÍÍÍÍÍÍÂÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»
 º chybovì k¢d  ³                      popis                            º
 ÌÍÍÍÍÍÍÍÍÍÍÍÍÍÍÅÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
 º  00H ( 0)    ³       pokus o z pis na disk chr nØnì proti z pisu     º
 º  01H ( 1)    ³       nezn m‚ Ÿ¡slo jednotky (diskov‚)                º
 º  02H ( 2)    ³       diskov  jednotka nen¡ pýipravena                º
 º  03H ( 3)    ³       neplatnì pý¡kaz                                 º
 º  04H ( 4)    ³       chyba dat (chyba kontroln¡ho souŸtu CRC)        º
 º  05H ( 5)    ³       çpatn  d‚lka struktury po§adavku                º
 º  06H ( 6)    ³       chyba pýi vystaven¡                             º
 º  07H ( 7)    ³       nezn mì typ m‚dia                               º
 º  08H ( 8)    ³       sektor nenalezen                                º
 º  09H ( 9)    ³       v tisk rnØ nen¡ pap¡r                           º
 º  0AH (10)    ³       chyba pýi z pisu                                º
 º  0BH (11)    ³       chyba Ÿten¡                                     º
 º  0CH (12)    ³       vçeobecn , nespecifikovateln  chyba             º
 ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÁÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼

Varov n¡: Pýi  vyvol n¡  pýeruçen¡  INT  25H  ponech v   DOS  jedno slovo v
          z sobn¡ku  (obsahuje registr pý¡znak… v Ÿase vyvol n¡ pýeruçen¡).
          Toto  slovo  mus¡te  vyjmout  instrukc¡  POP,  aby byla zachov na
          hladina z sobn¡ku.

Pozn.: Pýeruçen¡  INT  25H  zruç¡  obsahy vçech registr… kromØ segmentovìch
       registr….

       DOS  Ÿ¡sluje sektory disku sekvenŸnØ, poŸ¡naj¡ce v lcem 0, hlavou 0,
       sektorem  1.  Slu§ba  BIOS  (pýeruçen¡ INT 13H) identifikuje sektory
       týemi   oddØlenìmi   souýadnicemi   -  v lcem,  hlavou  a  sektorem.
       N sleduj¡c¡  formule  konvertuje  Ÿ¡slov n¡  sektor… BIOS do form tu
       DOS:

    Ÿ¡slo_sektoru_DOS = (sektor_BIOS - 1) + hlava_BIOS * sektor…_na_stopu +
                        v lec_BIOS * sektor…_na_stopu * hlav_na_disk

       DOS  pracuje  s  logickìmi  disky,  zat¡mco  BIOS  pracuje  pouze  s
       fyzickìmi  disky.  To  znamen ,  §e  pýeruçen¡  DOS INT 25H m…§e bìt
       pou§ito  ke  Ÿten¡  symbolick‚ho  disku  B, RAM disku nebo logick‚ho
       disku, kterì byl namapov n do fyzick‚ho disku pomoc¡ povelu ASSIGN.

       Chyby  vznikl‚  bØhem pýeruçen¡ INT 25H nejsou obslou§eny pýeruçen¡m
       INT  24H  (obsluha  kritick‚  chyby).  Chyba  se indikuje nastaven¡m
       pý¡znaku pýenosu CF na 1.

       Nen¡ vhodn‚ pýedpokl dat, §e sektor je exaktnØ 512 bajt…. K zjiçtØn¡
       skuteŸn‚   velikosti   sektor…   by  mØla  bìt  pou§ita  funkce  1CH
       (poskytnut¡ informac¡ FAT) nebo 32H (poskytnut¡ informac¡ FAT disku)
       nebo Ÿ¡st zav dØc¡ sektor disku.

       Verze  DOS 3.4 a menç¡ podporuj¡ maxim ln¡ kapacitu pevn‚ho disku 32
       MB  (32  767 KB). Je to d no t¡m, §e pro standardn¡ diskov  zaý¡zen¡
       se  pou§¡vaj¡  sektory  512  bajt….  V registru DX lze jako parametr
       funkce INT 25H zadat maxim lnØ 65ú535 sektor…, Ÿ¡m§ vznik  maxim ln¡
       adresovatelnì  prostor  32  MB.  Verze DOS 3.50 a vyçç¡ ji§ umo§åuj¡
       adresovat vØtç¡ prostor disku.

       Avçak   ne-IBM  diskov‚  mechaniky  (nebo  novØjç¡  disky  IBM)  ji§
       podporuj¡ velikost sektor… vØtç¡ ne§ 512 bajt…. Proto nen¡ prakticky
       nijak omezena kapacita disku (jeho adresovatelnì prostor).

       Chybovì  k¢d  navracenì v AH je stejnì jako k¢d navr cenì v registru
       AH pýeruçen¡m INT 13H/slu§ba 02H a k¢d navr cenì v AL je stejnì jako
       k¢d  nastavenì  v  registru  DI  pýi  vyvol n¡  kritick‚  chyby (viz
       pýeruçen¡ INT 24H).






ÿIÿNÿTÿ  ÿ2ÿ6ÿH (INT 38; 0:0098H) - absolutn¡ z pis na disk

    vstup:    AL = Ÿ¡slo diskov‚ jednotky (0=A, 1=B, atd.)
              DS:BX = adresa vyrovn vac¡ pamØti (odkud se provede z pis)
              CX = poŸet sektor…, kter‚ se maj¡ zapsat
              DX = poŸ teŸn¡ relativn¡ sektor (od zaŸ tku disku)

    vìstup:   AX = chybovì k¢d (je-li CF=1)
              pý¡znaky = DOS ponech  registr pý¡znak… v z sobn¡ku !

    Pýeruçen¡  INT  26H  zp…sob¡  z pis  CX sektor… z vyrovn vac¡ pamØti na
adrese  DS:BX  na  disk  nebo  na logick‚ zaý¡zen¡ od sektoru DX. Pýeruçen¡
pou§¡v  slu§by modulu BIOS - z pis sektoru na disku.

    Popis pýeruçen¡ je analogickì popisu pýeruçen¡ INT 25H (absolutn¡ Ÿten¡
z disku) - viz popis pýeruçen¡ INT 25H.


Pý¡klad: N sleduj¡c¡ program kop¡ruje obsah jednostrann‚ diskety o kapacitØ
         160K  (tj.  40  stop  po  8  sektorech  512 bajt…, celkem tedy 320
         sektor…)  v diskov‚ jednotce A: na disketu v diskov‚ jednotce B: a
         ovØýuje (verifikuje) z pis. Pou§¡v  vyrovn vac¡ pamØœ 32K:

kopiruj: mov       dx,offset text           ; adresa £vodn¡ho hl çen¡
         mov       ah,9                     ; slu§ba pro vìstup ýetØzce
         int       21h                      ; vìstup ýetØzce na displej
         mov       ah,8                     ; slu§ba vstupu znaku
         int       21h                      ; Ÿek n¡ na znak z kl vesnice
         mov       ax,2e01h                 ; slu§ba zapnut¡ verifikace
         int       21h                      ; zapnut¡ verifikace z pisu
         mov       cx,5                     ; poŸet sektor… 5 * 64 = 320
kop:     push      cx                       ; uschov n¡ Ÿ¡taŸe cykl…
         mov       al,0                     ; nastaven¡ zdroje z disku A:
         mov       bx,offset buffer         ; adresa bufferu k pýenosu dat
         mov       cx,64                    ; poŸet sektor… = 64 (= 8 stop)
         mov       dx,[start]               ; poŸ teŸn¡ sektor ke Ÿten¡
         int       25h                      ; Ÿten¡ 64 sektor… z disku A:
         mov       al,1                     ; nastaven¡ c¡lov‚ho disku B:
         mov       bx,offset buffer         ; adresa bufferu k pýenosu dat
         mov       cx,64                    ; poŸet sektor… = 64 (= 8 stop)
         mov       dx,[start]               ; poŸ teŸn¡ sektor ke Ÿten¡
         int       26h                      ; z pis 64 sektor… na disk B:
         add       [start],64               ; zvìçen¡ ukazatele sektor…
         pop       cx                       ; n vrat Ÿ¡taŸe skupin sektor…
         loop      kop                      ; dalç¡ skupina sektor… ke kop.
         mov       ax,4c00H                 ; slu§ba ukonŸen¡ programu
         int       21H                      ; ukonŸen¡ programu (k¢d = 0)

text     db        'Vlo§te zdrojovou disketu do A: a c¡lovou do B:',13,10
         db        'Stiskem libovoln‚ kl vesy zah j¡te kop¡rov n¡.',13,10
         db        ' VAROVµNÖ - diskety mus¡ m¡t form t 160KB !',13,10,'$'

start    dw        0
buffer   db        64 DUP (512 DUP (?))     ; buffer 64 sektor…




ÿIÿNÿTÿ  ÿ2ÿ7ÿH (INT 39; 0:009CH) - ukonŸen¡ s uchov n¡m programu v pamØti

    vstup:    CS:DX = prvn¡ bajt n sleduj¡c¡ po posledn¡m bajtu programu

    vìstup:   nen¡ n vrat

    Vol n¡  pýeruçen¡  INT  27H se pou§¡v  k ukonŸen¡ programu, je-li nutno
zachovat  program nebo jeho Ÿ st v pamØti poŸ¡taŸe. Typickìm pý¡kladem jsou
rezidentn¡  programy  obsluhuj¡c¡  u§ivatelsk‚  pýeruçovac¡  rutiny,  napý.
pýek¢dov n¡  kl ves  kl vesnice  a  pod. Pýed vyvol n¡m pýeruçen¡m je nutno
nastavit  registr  DX  na  offset  n sleduj¡c¡ho voln‚ho bajtu za posledn¡m
bajtem k¢du programu, kterì m  z…stat uchov n v pamØti. Registr CS obsahuje
adresu  segmentu  prefixu  programov‚ho  segmentu  PSP.  Funkce  neumo§åuje
navracet  chybovì  k¢d  ani  ponech vat  v  pamØti  vØtç¡ programy ne§ 64K.
Soubory  nejsou funkc¡ uzavýeny. Pýi proveden¡ pýeruçen¡ INT 27H je program
ukonŸen, ale pracuje se s n¡m jako s rozç¡ýen¡m DOSu; tzn., §e nen¡ pýeps n
jinìmi programy.

    Pýi  proveden¡  INT  27H se navr t¡ obsahy vektor… pýeruçen¡ INT 22H a§
INT  24H  z  existuj¡c¡ho  prefixu programov‚ho segmentu (PSP), proto nelze
tuto  slu§bu  jednoduçe  pou§¡t  k  trval‚  instalaci  obslu§nìch  program…
pýeruçen¡ INT 23H (obsluha u§ivatelsk‚ho pýeruçen¡ Ctrl-Break) nebo INT 24H
(obsluha kritick‚ chyby).

    Toto  pýeruçen¡  zajiçœuje  kompatibilitu  verz¡  DOSu  2.0 a vyçç¡ch s
dý¡vØjç¡mi  verzemi.  NovØ  vytv ýen‚  programy by mØly pou§¡vat funkci 31H
(ukonŸen¡ procesu a jeho uchov n¡ v pamØti).





ÿIÿNÿTÿ  ÿ2ÿ8ÿH (INT 40; 0:0080H) - Ÿasov n¡ £sek… DOS

    Toto  pýeruçen¡ nen¡ standardnØ dokumentov no v pý¡ruŸk ch MS-DOS. Toto
pýeruçen¡  vyvol v   DOS v§dy kdy§ Ÿek  na stisk kl vesy a pýedch z¡ mnohìm
funkc¡m DOS menç¡m nebo rovnìm 0CH (tj. funkce znakovìch vstup…/vìstup…).

    Tento vektor je obsluhov n programem PRINT (standardn¡ program DOS) aby
nalezl spr vnì Ÿasovì £sek ke Ÿten¡ tiçtØn‚ho souboru a z pisu na tisk rnu.
Je tak‚ Ÿasto pou§¡v no mnoha rozliŸnìmi rezidentn¡mi programy.

    Typicky  pou§¡vaj¡  rezidentn¡  programy pýeruçen¡ INT 28H jako jeden z
mnoha vstupn¡ch bod… do sv‚ho k¢du. Tzn. §e rezidentn¡ program obslou§¡ sv‚
funkce  Ÿek n¡  na  kl vesu  a/nebo  jin‚  spouçtØc¡ ud losti a nastav¡ sv‚
pý¡znaky. Po proveden¡ sv‚ obsluhy pýeruçen¡ INT 28H zavol  p…vodn¡ obsluhu
pýeruçen¡  INT  28H  a  pokud  jsou  po§adovan‚ pý¡znaky nastaveny, provede
obsluhu svìch funkc¡.

Varov n¡: Program  obsluhy  INT  28H  nesm¡  pou§¡vat funkce DOS menç¡ nebo
          rovny 0CH.






ÿIÿNÿTÿ  ÿ2ÿEÿH (INT 46; 0:00B8H) - proveden¡ povelu DOS

    vstup:    DS:SI = relativn¡  adresa  ýetØzce  obsahuj¡c¡ho  povel DOS k
                      proveden¡ (mus¡ bìt voln  pamØœ k naŸten¡ programu)

    vìstup:   nen¡ zýejm‚, jak obdr§et statut operace

    zniŸen‚ registry: SS,SP

    Toto  pýeruçen¡  nen¡ standardnØ dokumentov no pý¡ruŸkami DOS. Slou§¡ k
vykon n¡ povelu DOS, jakoby byl zad n z pý¡kazov‚ho ý dku.

    Pýi  vstupu do pýeruçen¡ ukazuje DS:SI na ýetØzec ASCII, kterì obsahuje
jako  prvn¡  bajt  urŸuj¡c¡  d‚lku  ýetØzce  (nepoŸ¡t   se do d‚lky ýetØzce
koncovì znak 0DH) a za n¡m n sleduje ýetØzec textu pý¡kazu. Napý.:

    db   0fh, 'set PROMPT=$p$g',0dh         ; ýetØzec je dlouhì 15 bajt…

    Tento  pý¡klad ilustruje hlavn¡ pou§it¡ t‚to slu§by - je mo§n‚ nastavit
hodnotu  do  hlavn¡ho  (koýenn‚ho)  prostýed¡  pomoc¡  povelu SET. Ve vçech
ostatn¡ch  pý¡padech  se  d v   pýednost funkci DOS 4BH (naŸten¡ a start
programu  -  napý. proveden¡ povelu COMMAND.COM prov dØj¡c¡ pýik zovì ý dek
"/c povel_dos"), neboœ tato funkce je plnØ dokumentov na.

Pozn.: Pýed   vyvol n¡m  pýeruçen¡  INT  2EH  nejdý¡ve  zajistØte  zmençen¡
       souŸasn‚ho bloku pamØti pomoc¡ funkce DOS 4AH.

       Ponechte dostatek voln‚ho m¡sta z sobn¡ku - DOS jej dost spotýebuje.

       Pýed  vol n¡m  pýeruçen¡ ulo§te registry SS a SP a navraœte je ihned
       po n vratu zpØt.

       Tato  slu§ba  syst‚mu  je  utajovan .  ZýejmØ  nen¡ pou§¡v na § dnìm
       programem  DOS  vŸetnØ  COMMAND.COM  a  nen¡  proto  doporuŸov no ji
       pou§¡vat.





ÿIÿNÿTÿ  ÿ2ÿFÿH (INT 47; 0:00BCH) - pýep¡nateln‚ pýeruçen¡ (DOS)


    vstup:    AH = pýep¡nac¡ Ÿ¡slo
                   01H - rezidentn¡ Ÿ st povelu DOS 'PRINT'
                   02H - rezidentn¡ Ÿ st povelu DOS 'ASSIGN'
                   10H - rezidentn¡ Ÿ st povelu DOS 'SHARE'
                   03H a§ 7FH - rezervov no pro DOS
                   0B7H - rezidentn¡ Ÿ st povelu DOS 'APPEN'D
                   80H a§ 0FFH - mo§n‚ pou§¡t jinìmi procesy
              AL = funkce, kter  bude vykon na pýep¡nanou obsluhou

    vìstup:   AX = chybovì k¢d (pokud je CF = 1)
              AL = stav instalace (procesy DOS) (pokud je CF = 0)
                   00H - nen¡ instalov n, instalace probØhla v poý dku
                   01H - nen¡ instalov n, instalace neprobØhla v poý dku
                   FFH - je ji§ nainstalov n

    Pýeruçen¡   definuje   vçeobecnì  styk  mezi  dvØma  procesy.  Aplikace
pou§¡vaj¡c¡  toto  pýeruçen¡  mus¡ definovat specifick‚ funkce a parametry.
Funkce,  kter‚ jsou standardnØ definovan‚ v DOS jsou PRINT, ASSIGN, SHARE a
APPEND.

    Ka§dì proces, kterì pou§¡v  toto pýeruçen¡, mus¡ pýi vyvol n¡ pýeruçen¡
nejdý¡ve otestovat obsah registru AH (zda obsahuje pýep¡nac¡ Ÿ¡slo pro danì
proces).  Pokud  proces  rozezn  sv‚ Ÿ¡slo, provede svou obsluhu pýeruçen¡.
Pokud  nerozezn   sv‚ Ÿ¡slo, mus¡ pýedat ý¡zen¡ na adresu p…vodn¡ho vektoru
pýeruçen¡  INT  2FH  (adresu p…vodn¡ho vektoru pýeruçen¡ si mus¡ ulo§it pýi
sv‚ instalaci dý¡ve, ne§ nastav¡ svou adresu obsluhy pýeruçen¡).

    Pýep¡natelnì ovladaŸ pýeruçen¡ se vztahuje ke sv‚mu "pýep¡nac¡mu Ÿ¡slu"
v registru AH. Volba pýep¡nac¡ho Ÿ¡sla je pýidØliteln ; m…§ete pýidØlit sv‚
funkci Ÿ¡slo mezi 80H a§ FFH; Ÿ¡sla 0 a§ 7FH jsou rezervov na pro DOS.

    Funkce,  kter   bude  vykon na  pýep¡natelnìm  ovladaŸem  pýeruçen¡, je
specifikov na v registru AL. Ostatn¡ registry mohou podle potýeby obsahovat
libovoln‚ dalç¡ parametry.

    Vçechny  pýep¡nateln‚  ovladaŸe  pýeruçen¡  mus¡  definovat  vol n¡ pro
ALú=ú0 (poskytnut¡ stavu instalace). Hodnoty AL F8H a§ FFH jsou rezervov ny
pro DOS.

    Pýep¡nateln‚ ovladaŸe implementovan‚ nebo rezervovan‚ pro DOS:

         AH = 01H (  1)  rezidentn¡ Ÿ st PRINT
              02H (  2)  rezidentn¡ Ÿ st ASSIGN
              10H ( 16)  rezidentn¡ Ÿ st SHARE
              B7H (183)  rezidentn¡ Ÿ st APPEND

    Vçechny ostatn¡ hodnoty od AH = 0 do AH = 7FH jsou rezervov ny pro DOS.

    Pýeruçen¡  2FH  je  mo§n‚ aplikovat pouze u DOS verze 3.1 a pozdØjç¡. U
verze  DOS  3.0 bylo pýeruçen¡ definov no pouze pro obsluhu pý¡kazu PRINT a
hodnota  registru  AH  nemØla  § dnì vìznam. U dý¡vØjç¡ch verz¡ ne§ DOS 3.0
nebylo pýeruçen¡ definov no v…bec.

    Pokud  instalujete  pomoc¡  tohoto  pýeruçen¡  obslu§nì program pro sv‚
rezidentn¡ programy napý. ve v¡ce£lohov‚m syst‚mu, objevuje se zde probl‚m:
Pokud  urŸ¡te pevnØ pýep¡nac¡ k¢d, riskujete mo§nost, §e toto Ÿ¡slo pou§¡v 
ji§  jinì  proces.  Proto sestavujte procesy s testov n¡m, kter‚ zaruŸ¡, §e
neztrat¡te  vl du  nad  procesy,  kter‚  byly ji§ dý¡ve nainstalov ny.

    Vaçe procesy by mØly obsluhovat alespoå funkci AL=00H (poskytnut¡ stavu
instalace), aby byla kontrola, zda je proces ji§ nainstalov n.

    Pokud vaçe pýep¡nan‚ procesy pou§¡vaj¡ slu§by DOS nebo jsou provozov ny
s  povolenìm  pýeruçen¡m (IF = 1), mØlo by bìt mo§n‚ do vaçeho procesu opØt
vstoupit.





ÿIÿNÿTÿ  ÿ2ÿFÿHÿ/ÿ0ÿ1 ÿ(ÿAÿHÿ=ÿ1ÿ) - pýep¡nateln‚ pýeruçen¡ (PRINT)


    vstup:    AH = 01H
              AL = funkce, kter  bude vykon na pýep¡nanou obsluhou
                 = 00H (0) - poskytnut¡ stavu instalace
                   01H (1) - pýedlo§en¡ souboru k tisku
                   02H (2) - zruçen¡ souboru z tiskov‚ fronty
                   03H (3) - zruçen¡ vçech soubor… z tiskov‚ fronty
                   04H (4) - statut
                   05H (5) - konec statutu
                   0F8H a§ 0FFH - rezervov no pro DOS

    vìstup:   AL = chybovì k¢d (kromØ funkce 00H a 04H)
                 = 01H ( 1) - neplatn‚ Ÿ¡slo funkce
                   02H ( 2) - soubor nenalezen
                   03H ( 3) - cesta nenalezena
                   04H ( 4) - pý¡liç mnoho otevýenìch soubor…
                   05H ( 5) - po§adavek odm¡tnut
                   06H ( 6) - neplatnì identifik tor souboru
                   08H ( 8) - fronta pln 
                   09H ( 9) - zanepr zdnØn
                   0CH (12) - jm‚no pý¡liç dlouh‚ (vØtç¡ ne§ 64 bajt…)
                   0FH (15) - neplatnì disk



Funkce 00H (0) - poskytnut¡ stavu instalace

    vstup:    AH = 01H
              AL = 00H

    vìstup:   AL = 00H - neinstalov n, instalace probØhla v poý dku
                   01H - neinstalov n, instalace neprobØhla v poý dku
                   FFH - je ji§ nainstalov n



Funkce 01H (1) - pýedlo§en¡ souboru k tisku

    vstup:    AH = 01H
              AL = 01H
              DS:DX = ukazatel na pýedkl danì bal¡k

    vìstup:   AX = chybovì k¢d (viz vìçe)

    Pýedkl danì  bal¡k mus¡ obsahovat hodnotu "£rovnØ" (jeden bajt; pro DOS
    3.0,  3.1  a§  3.3  mus¡  bìt  hodnota  £rovnØ 0), n sledovanou adresou
    ýetØzce  ASCIIZ  (adresa  se  skl d  z offsetu a segmentu) obsahuj¡c¡ho
    disk,  cestu  a jm‚no souboru, kterì bude tiçtØn. Maskovac¡ znaky * a ?
    NEJSOU povoleny.



Funkce 02H (2) - zruçen¡ souboru z tiskov‚ fronty

    vstup:    AH = 01H
              AL = 02H
              DS:DX = ukazatel na ýetØzec ASCIIZ specifikuj¡c¡ ruçenì soub.

    vìstup:   AX = chybovì k¢d (viz vìçe)

    Zruç¡ soubor z tiskov‚ fronty. Maskovac¡ znaky * a ? JSOU povoleny.



Funkce 03H (3) - zruçen¡ vçech soubor… z tiskov‚ fronty (vyŸiçtØn¡ fronty)

    vstup:    AH = 01H
              AL = 03H

    vìstup:   § dnì



Funkce 04H (4) - zaŸ tek statutu (prohl‚dnut¡ fronty)

    vstup:    AH = 01H
              AL = 04H

    vìstup:   DX = Ÿ¡taŸ chyb
              DS:SI = ukazatel na tiskovou frontu

    ¬¡taŸ  chyb  hl s¡ poŸet n slednìch chyb vzniklìch pýi pokusech PRINT o
    vìstup posledn¡ho znaku.

    Tiskov   fronta, na kterou ukazuje DS:SI, je s‚ri¡ 64-bajtovìch polo§ek
    specifikuj¡c¡ch  soubory,  kter‚  jsou  tiçtØny  (jako ýetØzce ASCIIZ).
    Soubor  tisknutì  v  souŸasnosti  vystupuje jako prvn¡. Konec fronty je
    indikov n polo§kou zaŸ¡naj¡c¡ bajtem 00H (0).

    Vol n¡  funkce  statutu  zmraz¡  soubory  ve  frontØ (aby je bylo mo§no
    prohl¡§et  a  pracovat  s  nimi). Zavolejte funkci pro ukonŸen¡ statutu
    (AL=5) k uvolnØn¡ tisknutìch soubor….



Funkce 05H (5) - konec statutu (uvolnØn¡ soubor… k tisku)

    vstup:    AH = 01H
              AL = 05H

    vìstup:   AX = chybovì k¢d (viz vìçe)





ÿIÿNÿTÿ  ÿ2ÿFÿHÿ/ÿ0ÿ2 ÿ(ÿAÿHÿ=ÿ2ÿ) - pýep¡nateln‚ pýeruçen¡ (ASSIGN)


    vstup:    AH = 02H
              AL = 00H (0) - poskytnut¡ stavu instalace

    vìstup:   AL = 00H - neinstalov n, instalace probØhla v poý dku
                   01H - neinstalov n, instalace neprobØhla v poý dku
                   FFH - je ji§ nainstalov n

    Funkce poskytne informaci, zda je rezidentn¡ Ÿ st ASSIGN instalov na.





ÿIÿNÿTÿ  ÿ2ÿFÿHÿ/ÿ1ÿ0 ÿ(ÿAÿHÿ=ÿ1ÿ6ÿ) - pýep¡nateln‚ pýeruçen¡ (SHARE)


    vstup:    AH = 10H
              AL = 00H (0) - poskytnut¡ stavu instalace

    vìstup:   AL = 00H - neinstalov n, instalace probØhla v poý dku
                   01H - neinstalov n, instalace neprobØhla v poý dku
                   FFH - je ji§ nainstalov n

    Funkce poskytne informaci, zda je rezidentn¡ Ÿ st SHARE instalov na.




ÿIÿNÿTÿ  ÿ2ÿFÿHÿ/ÿBÿ7 ÿ(ÿAÿHÿ=ÿ1ÿ8ÿ3ÿ) - pýep¡nateln‚ pýeruçen¡ (APPEND)


    vstup:    AH = B7H
              AL = 00H (0) - poskytnut¡ stavu instalace

    vìstup:   AL = 00H - neinstalov n, instalace probØhla v poý dku
                   01H - neinstalov n, instalace neprobØhla v poý dku
                   FFH - je ji§ nainstalov n

    Funkce poskytne informaci, zda je rezidentn¡ Ÿ st APPEND instalov na.




Adresy CS=210E
       DS=20FE
       ES=20FE
       SS=2F9C
       SP=0800



; ------ kontrola verze syst‚mu

28C8 B430           MOV    AH,30
28CA CD21           INT    21
28CC 3C02           CMP    AL,02
28CE 7305           JNB    28D5
28D0 33C0           XOR    AX,AX
28D2 06             PUSH   ES
28D3 50             PUSH   AX
28D4 CB             RETF                    ; p©i n¡zk‚ verzi konec

; ------ velikost voln‚ pamˆti pro datov˜ segment

28D5 BFFB24     *** MOV    DI,24FB          ; datov˜ segment
28D8 8B360200       MOV    SI,[0002]        ; konec pamˆti
28DC 2BF7           SUB    SI,DI            ; voln  pamˆŸ
28DE 81FE0010       CMP    SI,1000          ; je v¡ce pamˆti ne‘ 64 KB ?
28E2 7203           JB     28E7             ; je m‚nˆ pamˆti ne‘ 64 KB
28E4 BE0010         MOV    SI,1000          ; omezen¡ na 64 KB

; ------ p©edefinov ni z sobn¡ku

28E7 FA             CLI
28E8 8ED7           MOV    SS,DI            ; SS <- datov˜ segment
28EA 81C40EAA       ADD    SP,AA0E          ; posun o velikost datov‚ho segmentu
28EE FB             STI
28EF 7310           JNB    2901

; ------ chyba p©ete‡en¡ z sobn¡ku

28F1 16             PUSH   SS
28F2 1F             POP    DS               ; DS <- datov˜ segment
28F3 E86A07         CALL   3060             ; zobrazen¡ textu "run-time error"
28F6 33C0           XOR    AX,AX            ; chybov‚ hl ¨en¡ 0 - z sobn¡k
28F8 50             PUSH   AX
28F9 E84309         CALL   323F             ; zobrazen¡ chybov‚ho hl ¨en¡
28FC B8FF4C         MOV    AX,4CFF
28FF CD21           INT    21               ; chybov˜ n vrat

; ------ konec datov‚ho segmentu

2901 8BC6           MOV    AX,SI            ; velikost voln‚ pamˆti
2903 B104           MOV    CL,04
2905 D3E0           SHL    AX,CL            ; p©epo‡et voln‚ pamˆti na bajty
2907 48             DEC    AX               ; konec voln‚ pamˆti
2908 36A37010       MOV    SS:[1070],AX     ; konec voln‚ pamˆti


290C BB7210         MOV    BX,1072          ;
290F 368C17         MOV    SS:[BX],SS
2912 83E4FE         AND    SP,-02           ; zarovn n¡ SP na sudou adresu
2915 36896704       MOV    SS:[BX+04],SP    ;


2919 B8FEFF         MOV    AX,FFFE
291C 50             PUSH   AX
291D 3689670A       MOV    SS:[BX+0A],SP
2921 F7D0           NOT    AX
2923 50             PUSH   AX
2924 36896706       MOV    SS:[BX+06],SP
2928 36896708       MOV    SS:[BX+08],SP
292C 3689266C10     MOV    SS:[106C],SP
2931 03F7           ADD    SI,DI
2933 89360200       MOV    [0002],SI        ; nov˜ konec pamˆti

; ------ zmen¨en¡ alok. bloku programu

2937 8CC3           MOV    BX,ES
2939 2BDE           SUB    BX,SI
293B F7DB           NEG    BX
293D B44A           MOV    AH,4A                         ;'J'
293F CD21           INT    21               ; zmen¨en¡ bloku programu

; ------

2941 368C1EAC10     MOV    SS:[10AC],DS     ; £schova PSP
2946 16             PUSH   SS
2947 07             POP    ES               ; ES <- datov˜ segment

; ------ vymaz n¡ datov˜ch buffer–

2948 FC             CLD
2949 BF0E12         MOV    DI,120E          ;
294C B910AA         MOV    CX,AA10
294F 2BCF           SUB    CX,DI
2951 33C0           XOR    AX,AX
2953 F3             REPZ
2954 AA             STOSB                   ; vymaz n¡ bufferu

; ------

2955 16             PUSH   SS
2956 1F             POP    DS
2957 8B0E3411       MOV    CX,[1134]
295B E302           JCXZ   295F
295D FFD1           CALL   CX

; ------

295F E89CE8       * CALL   11FE             ; RET
2962 E82107         CALL   3086             ; p©¡prava bufferu parametr–
2965 33ED           XOR    BP,BP
2967 E84800         CALL   29B2             ; instalace INT 00h a stand.za©¡zen¡
296A 16             PUSH   SS
296B 1F             POP    DS
296C FF36CD10       PUSH   [10CD]
2970 FF36CB10       PUSH   [10CB]
2974 FF36C910       PUSH   [10C9]           ; po‡et parametr– p©¡kaz. © dku
2978 E889E8         CALL   1204             ; hlavn¡ procedura
297B 50             PUSH   AX
297C E80101         CALL   2A80             ; odinstalov n¡ programu, konec

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

297F C3             RET

; -----------------------------------------------------------------------------
;    obsluha INT 00h
; -----------------------------------------------------------------------------

2980 2EA1AF29       MOV    AX,CS:[29AF]
2984 8ED8           MOV    DS,AX
2986 B80300         MOV    AX,0003
2989 36C7066E10802A MOV    Word Ptr SS:[106E],2A80
2990 50             PUSH   AX
2991 E8CC06         CALL   3060
2994 E8A808         CALL   323F
2997 36813E3611D6D6 CMP    Word Ptr SS:[1136],D6D6
299E 7507           JNZ    29A7
29A0 58             POP    AX
29A1 50             PUSH   AX
29A2 36FF163A11     CALL   SS:[113A]
29A7 B8FF00         MOV    AX,00FF
29AA 50             PUSH   AX
29AB FF166E10       CALL   [106E]

29AF FB24           dw     24fbh            ; datov˜ segment
     00             db     0

; -----------------------------------------------------------------------------
;    instalace INT 00h a informace o za©¡zen¡ch
; -----------------------------------------------------------------------------

29B2 B80035         MOV    AX,3500
29B5 CD21           INT    21               ; poskytnut¡ INT 00
29B7 891E9810       MOV    [1098],BX
29BB 8C069A10       MOV    [109A],ES
29BF 0E             PUSH   CS
29C0 1F             POP    DS
29C1 B80025         MOV    AX,2500
29C4 BA8029         MOV    DX,2980          ; adresa obsluhy INT 00
29C7 CD21           INT    21
29C9 16             PUSH   SS
29CA 1F             POP    DS
29CB 833E461100     CMP    Word Ptr [1146],+00
29D0 7436           JZ     2A08

29D2 8C0E4811       MOV    [1148],CS
29D6 8C0E5011       MOV    [1150],CS
29DA 8E06AC10       MOV    ES,[10AC]
29DE 268B362C00     MOV    SI,ES:[002C]
29E3 C5064A11       LDS    AX,[114A]
29E7 8CDA           MOV    DX,DS
29E9 33DB           XOR    BX,BX
29EB 36FF1E4611     CALL   FAR SS:[1146]
29F0 7305           JNB    29F7
29F2 16             PUSH   SS
29F3 1F             POP    DS
29F4 E98906         JMP    3080

29F7 36C5064E11     LDS    AX,SS:[114E]
29FC 8CDA           MOV    DX,DS
29FE BB0300         MOV    BX,0003
2A01 36FF1E4611     CALL   FAR SS:[1146]
2A06 16             PUSH   SS
2A07 1F             POP    DS

; ------ nalezen¡ parametru popisova‡e standardn¡ch soubor–

2A08 8E06AC10     * MOV    ES,[10AC]        ; PSP
2A0C 268B0E2C00     MOV    CX,ES:[002C]     ; segment prost©ed¡
2A11 E33E           JCXZ   2A51
2A13 8EC1           MOV    ES,CX
2A15 33FF           XOR    DI,DI
2A17 26803D00       CMP    Byte Ptr ES:[DI],00
2A1B 7434           JZ     2A51
2A1D B90D00         MOV    CX,000D
2A20 BE8A10         MOV    SI,108A          ; parametr "_C_FILE_INFO="
2A23 F3             REPZ
2A24 A6             CMPSB
2A25 740B           JZ     2A32             ; nalezen
2A27 B9FF7F         MOV    CX,7FFF
2A2A 33C0           XOR    AX,AX
2A2C F2             REPNZ
2A2D AE             SCASB                   ; konec parametru
2A2E 7521           JNZ    2A51
2A30 EBE5           JMP    2A17

2A32 06             PUSH   ES
2A33 1E             PUSH   DS
2A34 07             POP    ES
2A35 1F             POP    DS
2A36 8BF7           MOV    SI,DI
2A38 BFB510         MOV    DI,10B5
2A3B B104           MOV    CL,04
2A3D AC             LODSB
2A3E 2C41           SUB    AL,41                         ;'A'
2A40 720D           JB     2A4F
2A42 D2E0           SHL    AL,CL
2A44 92             XCHG   AX,DX
2A45 AC             LODSB
2A46 2C41           SUB    AL,41                         ;'A'
2A48 7205           JB     2A4F
2A4A 0AC2           OR     AL,DL
2A4C AA             STOSB
2A4D EBEE           JMP    2A3D

; ------ informace o za©¡zen¡ch

2A4F 16             PUSH   SS
2A50 1F             POP    DS
2A51 BB0400         MOV    BX,0004          ; za©¡zen¡
2A54 80A7B510BF     AND    Byte Ptr [BX+10B5],BF
2A59 B80044         MOV    AX,4400
2A5C CD21           INT    21               ; test stavu
2A5E 720A           JB     2A6A
2A60 F6C280         TEST   DL,80
2A63 7405           JZ     2A6A
2A65 808FB51040     OR     Byte Ptr [BX+10B5],40         ;'@'
2A6A 4B           * DEC    BX
2A6B 79E7           JNS    2A54
2A6D BE5211         MOV    SI,1152
2A70 BF5211         MOV    DI,1152
2A73 E8C700         CALL   2B3D
2A76 BE5211         MOV    SI,1152
2A79 BF5211         MOV    DI,1152
2A7C E8AF00         CALL   2B2E
2A7F C3             RET

; -----------------------------------------------------------------------------
;    odinstalov n¡ programu a konec
; -----------------------------------------------------------------------------

2A80 55             PUSH   BP
2A81 8BEC           MOV    BP,SP
2A83 33C9           XOR    CX,CX
2A85 EB1A           JMP    2AA1

; -----------------------------------------------------------------------------
;    konec programu
; -----------------------------------------------------------------------------

2A87 55             PUSH   BP
2A88 8BEC           MOV    BP,SP
2A8A B90100         MOV    CX,0001
2A8D EB12           JMP    2AA1

2A8F 55             PUSH   BP
2A90 8BEC           MOV    BP,SP
2A92 56             PUSH   SI
2A93 57             PUSH   DI
2A94 B90001         MOV    CX,0100
2A97 EB08           JMP    2AA1

2A99 55             PUSH   BP
2A9A 8BEC           MOV    BP,SP
2A9C 56             PUSH   SI
2A9D 57             PUSH   DI
2A9E B90101         MOV    CX,0101

2AA1 51             PUSH   CX
2AA2 0AC9           OR     CL,CL
2AA4 751E           JNZ    2AC4
2AA6 BE5E12         MOV    SI,125E
2AA9 BF5E12         MOV    DI,125E
2AAC E87F00         CALL   2B2E
2AAF BE5211         MOV    SI,1152
2AB2 BF5211         MOV    DI,1152
2AB5 E87600         CALL   2B2E
2AB8 813E3611D6D6   CMP    Word Ptr [1136],D6D6
2ABE 7504           JNZ    2AC4
2AC0 FF163C11       CALL   [113C]
2AC4 BE5211       * MOV    SI,1152
2AC7 BF5211         MOV    DI,1152
2ACA E86100         CALL   2B2E
2ACD BE5211         MOV    SI,1152
2AD0 BF5211         MOV    DI,1152
2AD3 E86700         CALL   2B3D
2AD6 E827E7         CALL   1200
2AD9 0BC0           OR     AX,AX
2ADB 7411           JZ     2AEE
2ADD 58             POP    AX
2ADE 0AE4           OR     AH,AH
2AE0 50             PUSH   AX
2AE1 750B           JNZ    2AEE
2AE3 837E0400       CMP    Word Ptr [BP+04],+00
2AE7 7505           JNZ    2AEE
2AE9 C74604FF00     MOV    Word Ptr [BP+04],00FF
2AEE E81000         CALL   2B01
2AF1 58             POP    AX
2AF2 0AE4           OR     AH,AH
2AF4 7507           JNZ    2AFD
2AF6 8B4604         MOV    AX,[BP+04]
2AF9 B44C           MOV    AH,4C                         ;'L'
2AFB CD21           INT    21
2AFD 5F             POP    DI
2AFE 5E             POP    SI
2AFF 5D             POP    BP
2B00 C3             RET


2B01 8B0E4811       MOV    CX,[1148]
2B05 E307           JCXZ   2B0E
2B07 BB0200         MOV    BX,0002
2B0A FF1E4611       CALL   FAR [1146]
2B0E 1E             PUSH   DS
2B0F C5169810       LDS    DX,[1098]
2B13 B80025         MOV    AX,2500
2B16 CD21           INT    21
2B18 1F             POP    DS
2B19 803ED61000     CMP    Byte Ptr [10D6],00
2B1E 740D           JZ     2B2D
2B20 1E             PUSH   DS
2B21 A0D710         MOV    AL,[10D7]
2B24 C516D810       LDS    DX,[10D8]
2B28 B425           MOV    AH,25                         ;'%'
2B2A CD21           INT    21
2B2C 1F             POP    DS
2B2D C3             RET

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

2B2E 3BF7           CMP    SI,DI
2B30 730A           JNB    2B3C
2B32 4F             DEC    DI
2B33 4F             DEC    DI
2B34 8B0D           MOV    CX,[DI]
2B36 E3F6           JCXZ   2B2E
2B38 FFD1           CALL   CX
2B3A EBF2           JMP    2B2E
2B3C C3             RET

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

2B3D 3BF7           CMP    SI,DI
2B3F 730E           JNB    2B4F
2B41 83EF04         SUB    DI,+04
2B44 8B05           MOV    AX,[DI]
2B46 0B4502         OR     AX,[DI+02]
2B49 74F2           JZ     2B3D
2B4B FF1D           CALL   FAR [DI]
2B4D EBEE           JMP    2B3D
2B4F C3             RET

; -----------------------------------------------------------------------------
;    nastaven¡ ukazatele v souboru
; -----------------------------------------------------------------------------

2B50 55             PUSH   BP
2B51 8BEC           MOV    BP,SP
2B53 83EC04         SUB    SP,+04
2B56 8B5E04         MOV    BX,[BP+04]
2B59 3B1EB310       CMP    BX,[10B3]
2B5D 7205           JB     2B64
2B5F B80009         MOV    AX,0900
2B62 EB2A           JMP    2B8E
2B64 F746080080     TEST   Word Ptr [BP+08],8000
2B69 7448           JZ     2BB3
2B6B 837E0A00       CMP    Word Ptr [BP+0A],+00
2B6F 741A           JZ     2B8B
2B71 33C9           XOR    CX,CX
2B73 8BD1           MOV    DX,CX
2B75 B80142         MOV    AX,4201
2B78 CD21           INT    21               ; ‡ten¡ pozice v souboru
2B7A 724B           JB     2BC7
2B7C F7460A0200     TEST   Word Ptr [BP+0A],0002
2B81 750E           JNZ    2B91
2B83 034606         ADD    AX,[BP+06]
2B86 135608         ADC    DX,[BP+08]
2B89 7928           JNS    2BB3
2B8B B80016         MOV    AX,1600
2B8E F9             STC
2B8F EB36           JMP    2BC7


2B91 8956FE         MOV    [BP-02],DX
2B94 8946FC         MOV    [BP-04],AX
2B97 8BD1           MOV    DX,CX
2B99 B80242         MOV    AX,4202
2B9C CD21           INT    21               ;
2B9E 034606         ADD    AX,[BP+06]
2BA1 135608         ADC    DX,[BP+08]
2BA4 790D           JNS    2BB3
2BA6 8B4EFE         MOV    CX,[BP-02]
2BA9 8B56FC         MOV    DX,[BP-04]
2BAC B80042         MOV    AX,4200
2BAF CD21           INT    21               ; ukazatel od za‡ tku
2BB1 EBD8           JMP    2B8B

2BB3 8B5606         MOV    DX,[BP+06]
2BB6 8B4E08         MOV    CX,[BP+08]
2BB9 8A460A         MOV    AL,[BP+0A]
2BBC B442           MOV    AH,42                         ;'B'
2BBE CD21           INT    21               ; nastaven¡ ukazatele v souboru
2BC0 7205           JB     2BC7
2BC2 80A7B510FD     AND    Byte Ptr [BX+10B5],FD
2BC7 E9BF06         JMP    3289

2BCA E91E07         JMP    32EB


2BCD 00558B         ADD    [DI-75],DL
2BD0 EC             IN     AL,DX
2BD1 56             PUSH   SI
2BD2 C47604         LES    SI,[BP+04]
2BD5 8CC1           MOV    CX,ES
2BD7 E305           JCXZ   2BDE
2BD9 26804CFE01     OR     Byte Ptr ES:[SI-02],01
2BDE 5E             POP    SI
2BDF 5D             POP    BP
2BE0 C3             RET

; -----------------------------------------------------------------------------
;    vytvo©en¡ datov‚ho bloku
; -----------------------------------------------------------------------------

2BE1 55             PUSH   BP
2BE2 8BEC           MOV    BP,SP
2BE4 56             PUSH   SI
2BE5 57             PUSH   DI
2BE6 8B4E04         MOV    CX,[BP+04]       ; velikost datov‚ho bloku
2BE9 83F9E8         CMP    CX,-18
2BEC 7769           JA     2C57

2BEE 1E             PUSH   DS
2BEF A11411         MOV    AX,[1114]
2BF2 0BC0           OR     AX,AX
2BF4 7448           JZ     2C3E

2BF6 BF1433         MOV    DI,3314
2BF9 8B361C11       MOV    SI,[111C]
2BFD C51E1611       LDS    BX,[1116]
2C01 1E             PUSH   DS
2C02 56             PUSH   SI
2C03 57             PUSH   DI
2C04 FFD7           CALL   DI
2C06 5F             POP    DI
2C07 5E             POP    SI
2C08 732B           JNB    2C35
2C0A 8CDA           MOV    DX,DS
2C0C C55F0C         LDS    BX,[BX+0C]
2C0F 3BD6           CMP    DX,SI
2C11 75EF           JNZ    2C02
2C13 58             POP    AX
2C14 1F             POP    DS
2C15 1E             PUSH   DS
2C16 C4361611       LES    SI,[1116]
2C1A 268B7412       MOV    SI,ES:[SI+12]
2C1E C51E1211       LDS    BX,[1112]
2C22 8CDA           MOV    DX,DS
2C24 3BD0           CMP    DX,AX
2C26 75D9           JNZ    2C01
2C28 1F             POP    DS
2C29 1E             PUSH   DS
2C2A 81FF9033       CMP    DI,3390
2C2E 740E           JZ     2C3E
2C30 BF9033         MOV    DI,3390
2C33 EBC4           JMP    2BF9
2C35 5E             POP    SI
2C36 81FF1433       CMP    DI,3314
2C3A 740F           JZ     2C4B
2C3C EB0A           JMP    2C48
2C3E 07             POP    ES
2C3F 06             PUSH   ES
2C40 BF1211         MOV    DI,1112
2C43 E84808         CALL   348E             ; vytvo©en¡ aloka‡n¡ho bloku
2C46 720E           JB     2C56
2C48 E8C906         CALL   3314
2C4B 1F             POP    DS
2C4C 89161811       MOV    [1118],DX
2C50 891E1611       MOV    [1116],BX
2C54 EB04           JMP    2C5A
2C56 1F             POP    DS

2C57 33C0           XOR    AX,AX
2C59 99             CWD
2C5A 5F             POP    DI
2C5B 5E             POP    SI
2C5C 5D             POP    BP
2C5D C3             RET

; -----------------------------------------------------------------------------
;    zji¨tˆn¡ d‚lky textu ASCIIZ
; -----------------------------------------------------------------------------

2C5E 55             PUSH   BP
2C5F 8BEC           MOV    BP,SP
2C61 8BD7           MOV    DX,DI
2C63 8CD8           MOV    AX,DS
2C65 8EC0           MOV    ES,AX
2C67 8B7E04         MOV    DI,[BP+04]
2C6A 33C0           XOR    AX,AX
2C6C B9FFFF         MOV    CX,FFFF
2C6F F2             REPNZ
2C70 AE             SCASB
2C71 F7D1           NOT    CX
2C73 49             DEC    CX
2C74 91             XCHG   AX,CX
2C75 8BFA           MOV    DI,DX
2C77 5D             POP    BP
2C78 C3             RET

; -----------------------------------------------------------------------------
;    p©enesen¡ textu ASCIIZ
; -----------------------------------------------------------------------------

2C79 00558B         ADD    [DI-75],DL
2C7C EC             IN     AL,DX
2C7D 57             PUSH   DI
2C7E 56             PUSH   SI
2C7F 1E             PUSH   DS
2C80 07             POP    ES
2C81 8B7E04         MOV    DI,[BP+04]
2C84 8B7606         MOV    SI,[BP+06]
2C87 8BDF           MOV    BX,DI
2C89 8B4E08         MOV    CX,[BP+08]
2C8C E30C           JCXZ   2C9A
2C8E AC             LODSB
2C8F 0AC0           OR     AL,AL
2C91 7403           JZ     2C96
2C93 AA             STOSB
2C94 E2F8           LOOP   2C8E
2C96 32C0           XOR    AL,AL
2C98 F3             REPZ
2C99 AA             STOSB
2C9A 8BC3           MOV    AX,BX
2C9C 5E             POP    SI
2C9D 5F             POP    DI
2C9E 8BE5           MOV    SP,BP
2CA0 5D             POP    BP
2CA1 C3             RET

; -----------------------------------------------------------------------------
;    dek¢dov n¡ ‡¡sla
; -----------------------------------------------------------------------------

2CA2 55             PUSH   BP
2CA3 8BEC           MOV    BP,SP
2CA5 56             PUSH   SI
2CA6 57             PUSH   DI
2CA7 B301           MOV    BL,01
2CA9 8B4E08         MOV    CX,[BP+08]
2CAC 8B4604         MOV    AX,[BP+04]
2CAF 33D2           XOR    DX,DX
2CB1 83F90A         CMP    CX,+0A
2CB4 7501           JNZ    2CB7
2CB6 99             CWD
2CB7 8B7E06         MOV    DI,[BP+06]
2CBA E92108         JMP    34DE

; -----------------------------------------------------------------------------
;    dek¢dov n¡ ‡¡sla
; -----------------------------------------------------------------------------

2CBD 00558B         ADD    [DI-75],DL
2CC0 EC             IN     AL,DX
2CC1 56             PUSH   SI
2CC2 57             PUSH   DI
2CC3 B300           MOV    BL,00
2CC5 E90A08         JMP    34D2

; -----------------------------------------------------------------------------
;    test, zda je p©ipraven znak z kl vesnice
; -----------------------------------------------------------------------------

2CC8 A1DC10         MOV    AX,[10DC]
2CCB 0AE4           OR     AH,AH
2CCD B0FF           MOV    AL,FF
2CCF 7417           JZ     2CE8
2CD1 813E3611D6D6   CMP    Word Ptr [1136],D6D6
2CD7 7509           JNZ    2CE2
2CD9 53             PUSH   BX
2CDA BBFFFF         MOV    BX,FFFF
2CDD FF163811       CALL   [1138]
2CE1 5B             POP    BX
2CE2 B40B         * MOV    AH,0B
2CE4 CD21           INT    21               ; test p©eru¨en¡
2CE6 B400           MOV    AH,00
2CE8 C3             RET

2CE9 00B601EB       ADD    [BP+EB01],DH

; -----------------------------------------------------------------------------
;    vstup znaku z konzoly
; -----------------------------------------------------------------------------

2CED 02B608A1       ADD    DH,[BP+A108]
2CF1 DC10           FCOM   QWord Ptr [BX+SI]
2CF3 0AE4           OR     AH,AH
2CF5 7508           JNZ    2CFF
2CF7 C706DC10FFFF   MOV    Word Ptr [10DC],FFFF
2CFD EB16           JMP    2D15
2CFF 813E3611D6D6   CMP    Word Ptr [1136],D6D6
2D05 7509           JNZ    2D10
2D07 53             PUSH   BX
2D08 BBFFFF         MOV    BX,FFFF
2D0B FF163811       CALL   [1138]
2D0F 5B             POP    BX
2D10 92             XCHG   AX,DX
2D11 CD21           INT    21
2D13 B400           MOV    AH,00
2D15 C3             RET

; -----------------------------------------------------------------------------
;    vyvol n¡ funkce DOS
; -----------------------------------------------------------------------------

2D16 55             PUSH   BP
2D17 8BEC           MOV    BP,SP
2D19 8A6604         MOV    AH,[BP+04]
2D1C 8B5606         MOV    DX,[BP+06]
2D1F 8A4608         MOV    AL,[BP+08]
2D22 CD21           INT    21
2D24 8BE5           MOV    SP,BP
2D26 5D             POP    BP
2D27 C3             RET

; -----------------------------------------------------------------------------
;    Nalezen¡ prvn¡ho znaku v textu ASCIIZ
; -----------------------------------------------------------------------------

2D28 55             PUSH   BP
2D29 8BEC           MOV    BP,SP
2D2B 57             PUSH   DI
2D2C 8B7E04         MOV    DI,[BP+04]
2D2F 1E             PUSH   DS
2D30 07             POP    ES
2D31 8BDF           MOV    BX,DI
2D33 33C0           XOR    AX,AX
2D35 B9FFFF         MOV    CX,FFFF
2D38 F2             REPNZ
2D39 AE             SCASB
2D3A 41             INC    CX
2D3B F7D9           NEG    CX
2D3D 8A4606         MOV    AL,[BP+06]
2D40 8BFB           MOV    DI,BX
2D42 F2             REPNZ
2D43 AE             SCASB
2D44 4F             DEC    DI
2D45 3805           CMP    [DI],AL
2D47 7402           JZ     2D4B
2D49 33FF           XOR    DI,DI
2D4B 8BC7           MOV    AX,DI
2D4D 5F             POP    DI
2D4E 8BE5           MOV    SP,BP
2D50 5D             POP    BP
2D51 C3             RET

; -----------------------------------------------------------------------------
;    Nalezen¡ posledn¡ho znaku v textu ASCIIZ
; -----------------------------------------------------------------------------

2D52 55             PUSH   BP
2D53 8BEC           MOV    BP,SP
2D55 57             PUSH   DI
2D56 1E             PUSH   DS
2D57 07             POP    ES
2D58 8B7E04         MOV    DI,[BP+04]
2D5B 33C0           XOR    AX,AX
2D5D B9FFFF         MOV    CX,FFFF
2D60 F2             REPNZ
2D61 AE             SCASB
2D62 41             INC    CX
2D63 F7D9           NEG    CX
2D65 4F             DEC    DI
2D66 8A4606         MOV    AL,[BP+06]
2D69 FD             STD
2D6A F2             REPNZ
2D6B AE             SCASB
2D6C 47             INC    DI
2D6D 3805           CMP    [DI],AL
2D6F 7404           JZ     2D75
2D71 33C0           XOR    AX,AX
2D73 EB02           JMP    2D77
2D75 8BC7           MOV    AX,DI
2D77 FC             CLD
2D78 5F             POP    DI
2D79 8BE5           MOV    SP,BP
2D7B 5D             POP    BP
2D7C C3             RET
2D7D 00

; -----------------------------------------------------------------------------
;    konverze textu ASCIIZ na velk  p¡smena
; -----------------------------------------------------------------------------

2D7E 55             PUSH   BP
2D7F 8BEC           MOV    BP,SP
2D81 8B5E04         MOV    BX,[BP+04]       ; soubor
2D84 8BD3           MOV    DX,BX
2D86 EB0B           JMP    2D93

2D88 2C61           SUB    AL,61                         ;'a'
2D8A 3C1A           CMP    AL,1A
2D8C 7304           JNB    2D92
2D8E 0441           ADD    AL,41                         ;'A'
2D90 8807           MOV    [BX],AL
2D92 43             INC    BX

2D93 8A07           MOV    AL,[BX]
2D95 0AC0           OR     AL,AL
2D97 75EF           JNZ    2D88
2D99 92             XCHG   AX,DX
2D9A 5D             POP    BP
2D9B C3             RET

; -----------------------------------------------------------------------------
; -----------------------------------------------------------------------------

2D9C 55             PUSH   BP
2D9D 8BEC           MOV    BP,SP
2D9F 83EC20         SUB    SP,+20
2DA2 56             PUSH   SI
2DA3 57             PUSH   DI
2DA4 8B7606         MOV    SI,[BP+06]
2DA7 8CD0           MOV    AX,SS
2DA9 8EC0           MOV    ES,AX
2DAB B91000         MOV    CX,0010
2DAE 33C0           XOR    AX,AX
2DB0 8D7EE0         LEA    DI,[BP-20]
2DB3 F3             REPZ
2DB4 AB             STOSW
2DB5 AC             LODSB
2DB6 0AC0           OR     AL,AL
2DB8 7414           JZ     2DCE
2DBA 8BF8           MOV    DI,AX
2DBC 8BC8           MOV    CX,AX
2DBE B001           MOV    AL,01
2DC0 80E107         AND    CL,07
2DC3 D2E0           SHL    AL,CL
2DC5 B103           MOV    CL,03
2DC7 D3EF           SHR    DI,CL
2DC9 0843E0         OR     [BP+DI-20],AL
2DCC EBE7           JMP    2DB5
2DCE 8B7604         MOV    SI,[BP+04]
2DD1 AC             LODSB
2DD2 25FF00         AND    AX,00FF
2DD5 7417           JZ     2DEE
2DD7 8BF8           MOV    DI,AX
2DD9 8BC8           MOV    CX,AX
2DDB B001           MOV    AL,01
2DDD 80E107         AND    CL,07
2DE0 D2E0           SHL    AL,CL
2DE2 B103           MOV    CL,03
2DE4 D3EF           SHR    DI,CL
2DE6 2243E0         AND    AL,[BP+DI-20]
2DE9 74E6           JZ     2DD1
2DEB 8D44FF         LEA    AX,[SI-01]
2DEE 5F             POP    DI
2DEF 5E             POP    SI
2DF0 8BE5           MOV    SP,BP
2DF2 5D             POP    BP
2DF3 C3             RET

2df4                db     2,4,8,11,15,22

; -----------------------------------------------------------------------------
;    instalace p©eru¨en¡ INT 23h
; -----------------------------------------------------------------------------

2DFA 55             PUSH   BP
2DFB 8BEC           MOV    BP,SP
2DFD 83EC04         SUB    SP,+04
2E00 8B4604         MOV    AX,[BP+04]       ; ‡¡slo p©eru¨en¡
2E03 3D0800         CMP    AX,0008          ; je p©eru¨en¡ 8 ?
2E06 7511           JNZ    2E19
2E08 8B1E4611       MOV    BX,[1146]
2E0C 0B1E4811       OR     BX,[1148]
2E10 7507           JNZ    2E19

2E12 B80016       * MOV    AX,1600
2E15 F9             STC
2E16 E97004         JMP    3289

; ------ £schova p–vodn¡ adresy p©eru¨en¡

2E19 E87B00       * CALL   2E97             ; adresa vektoru p©eru¨en¡ v tabulce
2E1C 72F4           JB     2E12             ; nen¡ instalovateln‚
2E1E 8B07           MOV    AX,[BX]          ; p–vodn¡ adresa
2E20 8946FE         MOV    [BP-02],AX
2E23 8B4702         MOV    AX,[BX+02]
2E26 8946FC         MOV    [BP-04],AX

; ------ kontrola nov‚ adresy p©eru¨en¡

2E29 8B4606         MOV    AX,[BP+06]       ; adresa obsluhy p©eru¨en¡
2E2C 33D2           XOR    DX,DX
2E2E 3D0100         CMP    AX,0001
2E31 7605           JBE    2E38
2E33 3D0400         CMP    AX,0004
2E36 76DA           JBE    2E12

2E38 8907         * MOV    [BX],AX          ; £schova nov‚ adresy
2E3A 895702         MOV    [BX+02],DX

; ------ instalace p©eru¨en¡ INT 23h

2E3D 8B4E04         MOV    CX,[BP+04]       ; ‡¡slo p©eru¨en¡
2E40 83F902         CMP    CX,+02
2E43 7528           JNZ    2E6D
2E45 0BC0           OR     AX,AX
2E47 7424           JZ     2E6D
2E49 833E2E1100     CMP    Word Ptr [112E],+00
2E4E 751D           JNZ    2E6D
2E50 53             PUSH   BX
2E51 B023           MOV    AL,23                         ;'#'
2E53 B435           MOV    AH,35                         ;'5'
2E55 CD21           INT    21               ; poskytnut¡ INT 23h
2E57 8C062E11       MOV    [112E],ES
2E5B 891E3011       MOV    [1130],BX
2E5F 5B             POP    BX
2E60 BABE2E         MOV    DX,2EBE          ; adresa INT 23h
2E63 1E             PUSH   DS
2E64 0E             PUSH   CS
2E65 1F             POP    DS
2E66 B023           MOV    AL,23                         ;'#'
2E68 B425           MOV    AH,25                         ;'%'
2E6A CD21           INT    21               ; instalace INT 23h
2E6C 1F             POP    DS


2E6D 83F908         CMP    CX,+08
2E70 751B           JNZ    2E8D
2E72 B83F2F         MOV    AX,2F3F
2E75 8B0F           MOV    CX,[BX]
2E77 83F902         CMP    CX,+02
2E7A 7308           JNB    2E84
2E7C B83A2F         MOV    AX,2F3A
2E7F E303           JCXZ   2E84
2E81 B8392F         MOV    AX,2F39
2E84 8CCA           MOV    DX,CS
2E86 BB0300         MOV    BX,0003
2E89 FF1E4611       CALL   FAR [1146]
2E8D 8B46FE         MOV    AX,[BP-02]
2E90 8B56FC         MOV    DX,[BP-04]
2E93 8BE5           MOV    SP,BP
2E95 5D             POP    BP
2E96 C3             RET

; -----------------------------------------------------------------------------
;    adresa v tabulce adres p©eru¨en¡
; -----------------------------------------------------------------------------

2E97 55             PUSH   BP
2E98 8BEC           MOV    BP,SP
2E9A 8D1EF92D       LEA    BX,[2DF9]        ; konec tabulky
2E9E B90600         MOV    CX,0006          ; po‡et vektor– v tabulce
2EA1 2E3807       * CMP    CS:[BX],AL
2EA4 7406           JZ     2EAC
2EA6 4B             DEC    BX
2EA7 E2F8           LOOP   2EA1
2EA9 F9             STC
2EAA EB0E           JMP    2EBA
2EAC 49           * DEC    CX
2EAD 8BC1           MOV    AX,CX
2EAF D1E0           SHL    AX,1
2EB1 D1E0           SHL    AX,1
2EB3 8D1EDE10       LEA    BX,[10DE]        ; tabulka adres vektor– p©eru¨en¡
2EB7 03D8           ADD    BX,AX
2EB9 F8             CLC
2EBA 8BE5         * MOV    SP,BP
2EBC 5D             POP    BP
2EBD C3             RET

; -----------------------------------------------------------------------------
;    obsluha INT 23h
; -----------------------------------------------------------------------------

2EBE 50             PUSH   AX
2EBF 9F             LAHF                    ; £schova registru p©¡znak–
2EC0 50             PUSH   AX
2EC1 1E             PUSH   DS
2EC2 52             PUSH   DX
2EC3 2EA1AF29       MOV    AX,CS:[29AF]     ; datov˜ segment
2EC7 8ED8           MOV    DS,AX            ; datov˜ segment

2EC9 833ED41000     CMP    Word Ptr [10D4],+00
2ECE 7510           JNZ    2EE0
2ED0 A1DE10         MOV    AX,[10DE]
2ED3 8B16E010       MOV    DX,[10E0]
2ED7 3D0100         CMP    AX,0001
2EDA 7731           JA     2F0D
2EDC 0BC0           OR     AX,AX
2EDE 7552           JNZ    2F32

2EE0 83EC04       * SUB    SP,+04
2EE3 55             PUSH   BP
2EE4 8BEC           MOV    BP,SP
2EE6 83C502         ADD    BP,+02
2EE9 B004           MOV    AL,04
2EEB 8B5604       * MOV    DX,[BP+04]
2EEE 895600         MOV    [BP+00],DX
2EF1 45             INC    BP
2EF2 45             INC    BP
2EF3 FEC8           DEC    AL
2EF5 3C00           CMP    AL,00
2EF7 75F2           JNZ    2EEB
2EF9 A13011         MOV    AX,[1130]
2EFC 894600         MOV    [BP+00],AX
2EFF A12E11         MOV    AX,[112E]
2F02 894602         MOV    [BP+02],AX
2F05 5D             POP    BP
2F06 5A             POP    DX
2F07 1F             POP    DS
2F08 58             POP    AX
2F09 9E             SAHF                    ; n vrat registru p©¡znak–
2F0A 58             POP    AX               ; n vrat AX
2F0B F9             STC                     ; p©¡znak p©eru¨en¡ programu
2F0C CB             RETF


2F0D A3F610         MOV    [10F6],AX
2F10 8916F810       MOV    [10F8],DX
2F14 06             PUSH   ES
2F15 55             PUSH   BP
2F16 57             PUSH   DI
2F17 56             PUSH   SI
2F18 51             PUSH   CX
2F19 53             PUSH   BX
2F1A 33C0           XOR    AX,AX
2F1C A3DE10         MOV    [10DE],AX
2F1F A3E010         MOV    [10E0],AX
2F22 B80200         MOV    AX,0002
2F25 50             PUSH   AX
2F26 FC             CLD
2F27 FF16F610       CALL   [10F6]
2F2B 58             POP    AX
2F2C 5B             POP    BX
2F2D 59             POP    CX
2F2E 5E             POP    SI
2F2F 5F             POP    DI
2F30 5D             POP    BP
2F31 07             POP    ES
2F32 5A             POP    DX
2F33 1F             POP    DS
2F34 58             POP    AX
2F35 9E             SAHF
2F36 58             POP    AX
2F37 F8             CLC
2F38 CB             RETF
2F39 CB             RETF

2F3A 36FF2E4E11     JMP    FAR SS:[114E]

2F3F 53             PUSH   BX
2F40 51             PUSH   CX
2F41 52             PUSH   DX
2F42 06             PUSH   ES
2F43 32E4           XOR    AH,AH
2F45 50             PUSH   AX
2F46 B80800         MOV    AX,0008
2F49 50             PUSH   AX
2F4A E84AFF         CALL   2E97
2F4D 16             PUSH   SS
2F4E 1F             POP    DS
2F4F FF17           CALL   [BX]
2F51 83C404         ADD    SP,+04
2F54 07             POP    ES
2F55 5A             POP    DX
2F56 59             POP    CX
2F57 5B             POP    BX
2F58 CB             RETF

; -----------------------------------------------------------------------------
;    p©ejmenov n¡ souboru
; -----------------------------------------------------------------------------

2F59 00558B         ADD    [DI-75],DL
2F5C EC             IN     AL,DX
2F5D 57             PUSH   DI
2F5E 8B5604         MOV    DX,[BP+04]
2F61 8B7E06         MOV    DI,[BP+06]
2F64 1E             PUSH   DS
2F65 07             POP    ES
2F66 B456           MOV    AH,56                         ;'V'
2F68 CD21           INT    21
2F6A 5F             POP    DI
2F6B E90603         JMP    3274

; -----------------------------------------------------------------------------
;    zru¨en¡ souboru
; -----------------------------------------------------------------------------

2F6E 55             PUSH   BP
2F6F 8BEC           MOV    BP,SP
2F71 8B5604         MOV    DX,[BP+04]
2F74 B441           MOV    AH,41                         ;'A'
2F76 CD21           INT    21               ; zru¨en¡ souboru
2F78 E9F902         JMP    3274             ; n vratov˜ k¢d operace

; -----------------------------------------------------------------------------
;    nalezen¡ dal¨¡ho souboru
; -----------------------------------------------------------------------------

2F7B 00558B         ADD    [DI-75],DL
2F7E EC             IN     AL,DX
2F7F 1E             PUSH   DS
2F80 B04F           MOV    AL,4F                         ;'O'
2F82 8B5604         MOV    DX,[BP+04]
2F85 EB09           JMP    2F90

; -----------------------------------------------------------------------------
;    nalezen¡ prvn¡ho souboru
; -----------------------------------------------------------------------------

2F87 55             PUSH   BP
2F88 8BEC           MOV    BP,SP
2F8A 1E             PUSH   DS
2F8B B04E           MOV    AL,4E            ; funkce - hledat prvn¡
2F8D 8B5608         MOV    DX,[BP+08]       ; adresa DTA
2F90 B42F           MOV    AH,2F                         ;'/'
2F92 CD21           INT    21               ; poskytnut¡ adresy DTA (ES:BX)
2F94 B41A           MOV    AH,1A
2F96 CD21           INT    21               ; nastaven¡ adresy DTA
2F98 3C4E           CMP    AL,4E            ;
2F9A 7506           JNZ    2FA2
2F9C 8B5604         MOV    DX,[BP+04]       ; jm‚no souboru
2F9F 8B4E06         MOV    CX,[BP+06]       ; atributy
2FA2 8AE0         * MOV    AH,AL
2FA4 CD21           INT    21               ; nalezen¡ souboru
2FA6 50             PUSH   AX
2FA7 9F             LAHF
2FA8 50             PUSH   AX
2FA9 8CC2           MOV    DX,ES
2FAB 8EDA           MOV    DS,DX
2FAD 8BD3           MOV    DX,BX
2FAF B41A           MOV    AH,1A
2FB1 CD21           INT    21               ; nastaven¡ adresy DTA
2FB3 58             POP    AX
2FB4 9E             SAHF
2FB5 58             POP    AX
2FB6 1F             POP    DS
2FB7 E9C202         JMP    327C             ; n vratov˜ k¢d

; -----------------------------------------------------------------------------
;    nastaven¡ data a ‡asu souboru
; -----------------------------------------------------------------------------

2FBA 55             PUSH   BP
2FBB 8BEC           MOV    BP,SP
2FBD 8B5E04         MOV    BX,[BP+04]
2FC0 8B4E08         MOV    CX,[BP+08]
2FC3 8B5606         MOV    DX,[BP+06]
2FC6 B80157         MOV    AX,5701
2FC9 CD21           INT    21               ; nastaven¡ data a ‡asu souboru
2FCB E9AE02         JMP    327C

; -----------------------------------------------------------------------------
;    vyn soben¡ ‡¡sel LONG INTEGER
; -----------------------------------------------------------------------------

2FCE 55             PUSH   BP
2FCF 8BEC           MOV    BP,SP
2FD1 8B4606         MOV    AX,[BP+06]
2FD4 8B4E0A         MOV    CX,[BP+0A]
2FD7 0BC8           OR     CX,AX
2FD9 8B4E08         MOV    CX,[BP+08]
2FDC 7509           JNZ    2FE7
2FDE 8B4604         MOV    AX,[BP+04]
2FE1 F7E1           MUL    CX
2FE3 5D             POP    BP
2FE4 C20800         RET    0008

2FE7 53             PUSH   BX
2FE8 F7E1           MUL    CX
2FEA 8BD8           MOV    BX,AX
2FEC 8B4604         MOV    AX,[BP+04]
2FEF F7660A         MUL    Word Ptr [BP+0A]
2FF2 03D8           ADD    BX,AX
2FF4 8B4604         MOV    AX,[BP+04]
2FF7 F7E1           MUL    CX
2FF9 03D3           ADD    DX,BX
2FFB 5B             POP    BX
2FFC 5D             POP    BP
2FFD C20800         RET    0008

; -----------------------------------------------------------------------------
;    vydˆlen¡ ‡¡sel LONG INTEGER
; -----------------------------------------------------------------------------

3000 55             PUSH   BP
3001 8BEC           MOV    BP,SP
3003 53             PUSH   BX
3004 56             PUSH   SI
3005 8B460A         MOV    AX,[BP+0A]
3008 0BC0           OR     AX,AX
300A 7515           JNZ    3021
300C 8B4E08         MOV    CX,[BP+08]
300F 8B4606         MOV    AX,[BP+06]
3012 33D2           XOR    DX,DX
3014 F7F1           DIV    CX
3016 8BD8           MOV    BX,AX
3018 8B4604         MOV    AX,[BP+04]
301B F7F1           DIV    CX
301D 8BD3           MOV    DX,BX
301F EB38           JMP    3059
3021 8BC8           MOV    CX,AX
3023 8B5E08         MOV    BX,[BP+08]
3026 8B5606         MOV    DX,[BP+06]
3029 8B4604         MOV    AX,[BP+04]
302C D1E9           SHR    CX,1
302E D1DB           RCR    BX,1
3030 D1EA           SHR    DX,1
3032 D1D8           RCR    AX,1
3034 0BC9           OR     CX,CX
3036 75F4           JNZ    302C
3038 F7F3           DIV    BX
303A 8BF0           MOV    SI,AX
303C F7660A         MUL    Word Ptr [BP+0A]
303F 91             XCHG   AX,CX
3040 8B4608         MOV    AX,[BP+08]
3043 F7E6           MUL    SI
3045 03D1           ADD    DX,CX
3047 720C           JB     3055
3049 3B5606         CMP    DX,[BP+06]
304C 7707           JA     3055
304E 7206           JB     3056
3050 3B4604         CMP    AX,[BP+04]
3053 7601           JBE    3056
3055 4E             DEC    SI
3056 33D2           XOR    DX,DX
3058 96             XCHG   AX,SI
3059 5E             POP    SI
305A 5B             POP    BX
305B 5D             POP    BP
305C C20800         RET    0008
305F 00

; -----------------------------------------------------------------------------
;    zobrazen¡ textu "run-time error"
; -----------------------------------------------------------------------------

3060 55             PUSH   BP
3061 8BEC           MOV    BP,SP
3063 B8FC00         MOV    AX,00FC          ; ‡¡slo textu od© dkov n¡
3066 50             PUSH   AX
3067 E8D501         CALL   323F             ; od© dkov n¡ textu
306A 833EFA1000     CMP    Word Ptr [10FA],+00
306F 7404           JZ     3075
3071 FF16FA10       CALL   [10FA]           ; ???
3075 B8FF00       * MOV    AX,00FF          ;
3078 50             PUSH   AX
3079 E8C301         CALL   323F             ; zobrazen¡ textu "run-time ..."
307C 8BE5           MOV    SP,BP
307E 5D             POP    BP
307F C3             RET


3080 B80200         MOV    AX,0002
3083 E90AF9         JMP    2990

; -----------------------------------------------------------------------------
;    p©¡prava bufferu parametr– z p©¡kazov‚ho © dku a jm‚na programu
; -----------------------------------------------------------------------------

; ------ zji¨tˆn¡ verze syst‚mu

3086 8F06FC10       POP    [10FC]           ; n vratov  adresa
308A B430           MOV    AH,30
308C CD21           INT    21               ; verze syst‚mu
308E A3AE10         MOV    [10AE],AX        ; verze syst‚mu

; ------ adresa jm‚na programu v prost©ed¡

3091 BA0100         MOV    DX,0001          ; d‚lka - 1 bajt
3094 3C02           CMP    AL,02            ; je verze syst‚mu 2 ?
3096 7429           JZ     30C1             ; je syst‚m 2 - nen¡ ©etˆzec
3098 8E06AC10       MOV    ES,[10AC]        ; PSP
309C 268E062C00     MOV    ES,ES:[002C]     ; prost©ed¡
30A1 8C06D110       MOV    [10D1],ES        ; segment prost©ed¡
30A5 33C0           XOR    AX,AX
30A7 99             CWD
30A8 B90080         MOV    CX,8000          ; max. d‚lka
30AB 33FF           XOR    DI,DI
30AD F2AE         * REPNZ  SCASB            ; nalezen¡ konce textu
30AF AE             SCASB                   ; je konec prost©ed¡ ?
30B0 75FB           JNZ    30AD             ; nen¡ je¨tˆ konec - dal¨¡ ©etˆzec
30B2 47             INC    DI
30B3 47             INC    DI
30B4 893ECF10       MOV    [10CF],DI        ; adresa jm‚na programu
30B8 B9FFFF         MOV    CX,FFFF
30BB F2             REPNZ
30BC AE             SCASB
30BD F7D1           NOT    CX
30BF 8BD1           MOV    DX,CX            ; d‚lka textu

; ------- dek¢dov n¡ p©¡kazov‚ho © dku

30C1 BF0100       * MOV    DI,0001          ; ‡¡ta‡ parametr–
30C4 BE8100         MOV    SI,0081          ; p©¡kazov˜ © dek
30C7 8E1EAC10       MOV    DS,[10AC]        ; PSP

; ------ vypu¨tˆn¡ mezer

30CB AC           * LODSB
30CC 3C20           CMP    AL,20                         ;' '
30CE 74FB           JZ     30CB
30D0 3C09           CMP    AL,09
30D2 74F7           JZ     30CB

; ------ test, zda je konec

30D4 3C0D           CMP    AL,0D
30D6 746F           JZ     3147             ; CR
30D8 0AC0           OR     AL,AL
30DA 746B           JZ     3147             ; konec 0
30DC 47             INC    DI
30DD 4E             DEC    SI

; ------ nalezen¡ konce parametru

30DE AC           * LODSB
30DF 3C20           CMP    AL,20                         ;' '
30E1 74E8           JZ     30CB             ; mezera
30E3 3C09           CMP    AL,09
30E5 74E4           JZ     30CB
30E7 3C0D           CMP    AL,0D
30E9 745C           JZ     3147
30EB 0AC0           OR     AL,AL
30ED 7458           JZ     3147
30EF 3C22           CMP    AL,22                         ;'"'
30F1 7424           JZ     3117
30F3 3C5C           CMP    AL,5C                         ;'\'
30F5 7403           JZ     30FA
30F7 42             INC    DX
30F8 EBE4           JMP    30DE

30FA 33C9           XOR    CX,CX
30FC 41             INC    CX
30FD AC             LODSB
30FE 3C5C           CMP    AL,5C                         ;'\'
3100 74FA           JZ     30FC
3102 3C22           CMP    AL,22                         ;'"'
3104 7404           JZ     310A
3106 03D1           ADD    DX,CX
3108 EBD3           JMP    30DD
310A 8BC1           MOV    AX,CX
310C D1E9           SHR    CX,1
310E 13D1           ADC    DX,CX
3110 A801           TEST   AL,01
3112 75CA           JNZ    30DE
3114 EB01           JMP    3117
3116 4E             DEC    SI

3117 AC             LODSB
3118 3C0D           CMP    AL,0D
311A 742B           JZ     3147
311C 0AC0           OR     AL,AL
311E 7427           JZ     3147
3120 3C22           CMP    AL,22                         ;'"'
3122 74BA           JZ     30DE
3124 3C5C           CMP    AL,5C                         ;'\'
3126 7403           JZ     312B
3128 42             INC    DX
3129 EBEC           JMP    3117

312B 33C9           XOR    CX,CX
312D 41             INC    CX
312E AC             LODSB
312F 3C5C           CMP    AL,5C                         ;'\'
3131 74FA           JZ     312D
3133 3C22           CMP    AL,22                         ;'"'
3135 7404           JZ     313B
3137 03D1           ADD    DX,CX
3139 EBDB           JMP    3116
313B 8BC1           MOV    AX,CX
313D D1E9           SHR    CX,1
313F 13D1           ADC    DX,CX
3141 A801           TEST   AL,01
3143 75D2           JNZ    3117
3145 EB97           JMP    30DE


3147 16             PUSH   SS
3148 1F             POP    DS
3149 893EC910       MOV    [10C9],DI        ; po‡et parametr–
314D 03D7           ADD    DX,DI            ; d‚lka bufferu parametr–
314F 47             INC    DI
3150 D1E7           SHL    DI,1
3152 03D7           ADD    DX,DI
3154 42             INC    DX
3155 80E2FE         AND    DL,FE
3158 2BE2           SUB    SP,DX            ; posun z sobn¡ku dol–
315A 8BC4           MOV    AX,SP
315C A3CB10         MOV    [10CB],AX        ; adresa bufferu parametr–
315F 8BD8           MOV    BX,AX            ;
3161 03FB           ADD    DI,BX
3163 16             PUSH   SS
3164 07             POP    ES
3165 36893F         MOV    SS:[BX],DI       ; adresa parametru
3168 43             INC    BX
3169 43             INC    BX

316A C536CF10       LDS    SI,[10CF]        ; adresa jm‚na programu
316E AC           * LODSB
316F AA             STOSB
3170 0AC0           OR     AL,AL
3172 75FA           JNZ    316E
3174 368E1EAC10     MOV    DS,SS:[10AC]
3179 BE8100         MOV    SI,0081
317C EB03           JMP    3181

317E 33C0           XOR    AX,AX
3180 AA             STOSB

3181 AC             LODSB
3182 3C20           CMP    AL,20                         ;' '
3184 74FB           JZ     3181
3186 3C09           CMP    AL,09
3188 74F7           JZ     3181
318A 3C0D           CMP    AL,0D
318C 747C           JZ     320A
318E 0AC0           OR     AL,AL
3190 7478           JZ     320A
3192 36893F         MOV    SS:[BX],DI
3195 43             INC    BX
3196 43             INC    BX
3197 4E             DEC    SI
3198 AC             LODSB
3199 3C20           CMP    AL,20                         ;' '
319B 74E1           JZ     317E
319D 3C09           CMP    AL,09
319F 74DD           JZ     317E
31A1 3C0D           CMP    AL,0D
31A3 7462           JZ     3207
31A5 0AC0           OR     AL,AL
31A7 745E           JZ     3207
31A9 3C22           CMP    AL,22                         ;'"'
31AB 7427           JZ     31D4
31AD 3C5C           CMP    AL,5C                         ;'\'
31AF 7403           JZ     31B4
31B1 AA             STOSB
31B2 EBE4           JMP    3198

31B4 33C9           XOR    CX,CX
31B6 41             INC    CX
31B7 AC             LODSB
31B8 3C5C           CMP    AL,5C                         ;'\'
31BA 74FA           JZ     31B6
31BC 3C22           CMP    AL,22                         ;'"'
31BE 7406           JZ     31C6
31C0 B05C           MOV    AL,5C                         ;'\'
31C2 F3             REPZ
31C3 AA             STOSB
31C4 EBD1           JMP    3197
31C6 B05C           MOV    AL,5C                         ;'\'
31C8 D1E9           SHR    CX,1
31CA F3             REPZ
31CB AA             STOSB
31CC 7306           JNB    31D4
31CE B022           MOV    AL,22                         ;'"'
31D0 AA             STOSB
31D1 EBC5           JMP    3198
31D3 4E             DEC    SI
31D4 AC             LODSB
31D5 3C0D           CMP    AL,0D
31D7 742E           JZ     3207
31D9 0AC0           OR     AL,AL
31DB 742A           JZ     3207
31DD 3C22           CMP    AL,22                         ;'"'
31DF 74B7           JZ     3198
31E1 3C5C           CMP    AL,5C                         ;'\'
31E3 7403           JZ     31E8
31E5 AA             STOSB
31E6 EBEC           JMP    31D4
31E8 33C9           XOR    CX,CX
31EA 41             INC    CX
31EB AC             LODSB
31EC 3C5C           CMP    AL,5C                         ;'\'
31EE 74FA           JZ     31EA
31F0 3C22           CMP    AL,22                         ;'"'
31F2 7406           JZ     31FA
31F4 B05C           MOV    AL,5C                         ;'\'
31F6 F3             REPZ
31F7 AA             STOSB
31F8 EBD9           JMP    31D3
31FA B05C           MOV    AL,5C                         ;'\'
31FC D1E9           SHR    CX,1
31FE F3             REPZ
31FF AA             STOSB
3200 7396           JNB    3198
3202 B022           MOV    AL,22                         ;'"'
3204 AA             STOSB
3205 EBCD           JMP    31D4
3207 33C0           XOR    AX,AX
3209 AA             STOSB
320A 16             PUSH   SS
320B 1F             POP    DS
320C C7070000       MOV    Word Ptr [BX],0000
3210 FF26FC10       JMP    [10FC]           ; n vrat

; -----------------------------------------------------------------------------
;    nalezen¡ adresy chybov‚ho hl ¨en¡
; -----------------------------------------------------------------------------

3214 55             PUSH   BP
3215 8BEC           MOV    BP,SP
3217 56             PUSH   SI
3218 57             PUSH   DI
3219 1E             PUSH   DS
321A 07             POP    ES
321B 8B5604         MOV    DX,[BP+04]       ; k¢d hledan‚ chyby
321E BE5A11         MOV    SI,115A          ; tabulka chybov˜ch hl ¨en¡
3221 AD             LODSW                   ; na‡ten¡ ‡¡sla chyby hl ¨en¡
3222 3BC2           CMP    AX,DX
3224 7410           JZ     3236             ; text nalezen
3226 40             INC    AX               ; je ji‘ konec ?
3227 96             XCHG   AX,SI
3228 740C           JZ     3236             ; konec tabulky
322A 97             XCHG   AX,DI
322B 33C0           XOR    AX,AX
322D B9FFFF         MOV    CX,FFFF
3230 F2             REPNZ
3231 AE             SCASB                   ; nalezen¡ konce textu
3232 8BF7           MOV    SI,DI
3234 EBEB           JMP    3221

3236 96           * XCHG   AX,SI
3237 5F             POP    DI
3238 5E             POP    SI
3239 8BE5           MOV    SP,BP
323B 5D             POP    BP
323C C20200         RET    0002

; -----------------------------------------------------------------------------
;    zobrazen¡ chybov‚ho hl ¨en¡
; -----------------------------------------------------------------------------

323F 55             PUSH   BP
3240 8BEC           MOV    BP,SP
3242 57             PUSH   DI
3243 FF7604         PUSH   [BP+04]          ; ‡¡slo chyby
3246 E8CBFF         CALL   3214             ; nalezen¡ adresy chybov‚ho hl ¨en¡
3249 0BC0           OR     AX,AX
324B 7420           JZ     326D             ; chybov‚ hl ¨en¡ nenalezeno
324D 92             XCHG   AX,DX
324E 8BFA           MOV    DI,DX
3250 33C0           XOR    AX,AX
3252 B9FFFF         MOV    CX,FFFF
3255 F2             REPNZ
3256 AE             SCASB
3257 F7D1           NOT    CX
3259 49             DEC    CX               ; d‚lka textu
325A BB0200         MOV    BX,0002          ; identifik tor - standardn¡ v˜stup
325D 813E3611D6D6   CMP    Word Ptr [1136],D6D6
3263 7504           JNZ    3269
3265 FF163811       CALL   [1138]
3269 B440           MOV    AH,40                         ;'@'
326B CD21           INT    21               ; zobrazen¡ hl ¨en¡
326D 5F           * POP    DI
326E 8BE5           MOV    SP,BP
3270 5D             POP    BP
3271 C20200         RET    0002

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

3274 7215           JB     328B
3276 33C0           XOR    AX,AX
3278 8BE5           MOV    SP,BP
327A 5D             POP    BP
327B C3             RET

327C 73F8           JNB    3276
327E 50             PUSH   AX
327F E81A00         CALL   329C
3282 58             POP    AX
3283 32E4           XOR    AH,AH
3285 8BE5           MOV    SP,BP
3287 5D             POP    BP
3288 C3             RET


3289 7307           JNB    3292
328B E80E00         CALL   329C
328E B8FFFF         MOV    AX,FFFF
3291 99             CWD
3292 8BE5           MOV    SP,BP
3294 5D             POP    BP
3295 C3             RET

3296 32E4           XOR    AH,AH
3298 E80100         CALL   329C
329B C3             RET

329C A2B110         MOV    [10B1],AL        ; k¢d chyby se souborem
329F 0AE4           OR     AH,AH
32A1 7522           JNZ    32C5
32A3 803EAE1003     CMP    Byte Ptr [10AE],03
32A8 720C           JB     32B6
32AA 3C22           CMP    AL,22                         ;'"'
32AC 730C           JNB    32BA
32AE 3C20           CMP    AL,20                         ;' '
32B0 7204           JB     32B6
32B2 B005           MOV    AL,05
32B4 EB06           JMP    32BC
32B6 3C13           CMP    AL,13
32B8 7602           JBE    32BC
32BA B013           MOV    AL,13
32BC BBFE10         MOV    BX,10FE
32BF D7             XLAT
32C0 98             CBW
32C1 A3A610         MOV    [10A6],AX
32C4 C3             RET

32C5 8AC4           MOV    AL,AH
32C7 EBF7           JMP    32C0


32C9 00558B         ADD    [DI-75],DL
32CC EC             IN     AL,DX
32CD 56             PUSH   SI
32CE 8B5E04         MOV    BX,[BP+04]
32D1 BE7210         MOV    SI,1072
32D4 395C06         CMP    [SI+06],BX
32D7 730D           JNB    32E6
32D9 4B             DEC    BX
32DA 4B             DEC    BX
32DB 800F01         OR     Byte Ptr [BX],01
32DE 395C08         CMP    [SI+08],BX
32E1 7603           JBE    32E6
32E3 895C08         MOV    [SI+08],BX
32E6 5E             POP    SI
32E7 8BE5           MOV    SP,BP
32E9 5D             POP    BP
32EA C3             RET

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

32EB 55             PUSH   BP
32EC 8BEC           MOV    BP,SP
32EE 56             PUSH   SI
32EF 57             PUSH   DI
32F0 8B4E04         MOV    CX,[BP+04]
32F3 83F9E8         CMP    CX,-18
32F6 7712           JA     330A
32F8 BB7210         MOV    BX,1072
32FB E81600         CALL   3314
32FE 730F           JNB    330F
3300 E88D00         CALL   3390
3303 7205           JB     330A
3305 E80C00         CALL   3314
3308 7305           JNB    330F
330A 33C0           XOR    AX,AX
330C 99             CWD
330D EB00           JMP    330F
330F 5F             POP    DI
3310 5E             POP    SI
3311 5D             POP    BP
3312 C3             RET
3313 004180         ADD    [BX+DI-80],AL

; -----------------------------------------------------------------------------
;
; -----------------------------------------------------------------------------

3314 41             INC    CX
3315 80E1FE         AND    CL,FE
3318 53             PUSH   BX
3319 FC             CLD
331A 8B7708         MOV    SI,[BX+08]
331D 8B5F0A         MOV    BX,[BX+0A]
3320 33FF           XOR    DI,DI
3322 EB23           JMP    3347

3324 8BC3           MOV    AX,BX
3326 5B             POP    BX
3327 A801           TEST   AL,01
3329 7542           JNZ    336D
332B 53             PUSH   BX
332C 8B7706         MOV    SI,[BX+06]
332F 8B5F08         MOV    BX,[BX+08]
3332 3BDE           CMP    BX,SI
3334 7436           JZ     336C
3336 4B             DEC    BX
3337 33FF           XOR    DI,DI
3339 EB0C           JMP    3347
333B 90             NOP

333C 8D54FE         LEA    DX,[SI-02]
333F 3BD3           CMP    DX,BX
3341 73E1           JNB    3324
3343 03F0           ADD    SI,AX
3345 7223           JB     336A


3347 AD             LODSW
3348 A801           TEST   AL,01
334A 74F0           JZ     333C
334C 8BFE           MOV    DI,SI
334E 48             DEC    AX
334F 3BC1           CMP    AX,CX
3351 7323           JNB    3376
3353 03F0           ADD    SI,AX
3355 7213           JB     336A
3357 8BD0           MOV    DX,AX
3359 AD             LODSW
335A A801           TEST   AL,01
335C 74DE           JZ     333C
335E 03C2           ADD    AX,DX
3360 050200         ADD    AX,0002
3363 8BF7           MOV    SI,DI
3365 8944FE         MOV    [SI-02],AX
3368 EBE4           JMP    334E
336A 8BC0           MOV    AX,AX
336C 5B             POP    BX
336D 8B4706         MOV    AX,[BX+06]
3370 894708         MOV    [BX+08],AX
3373 F9             STC
3374 EB19           JMP    338F
3376 5B             POP    BX
3377 894CFE         MOV    [SI-02],CX
337A 7409           JZ     3385
337C 03F9           ADD    DI,CX
337E 2BC1           SUB    AX,CX
3380 48             DEC    AX
3381 8905           MOV    [DI],AX
3383 2BF9           SUB    DI,CX
3385 03F9           ADD    DI,CX
3387 897F08         MOV    [BX+08],DI
338A 8BC6           MOV    AX,SI
338C 8CDA           MOV    DX,DS
338E F8             CLC
338F C3             RET
3390 51             PUSH   CX
3391 57             PUSH   DI
3392 F6470201       TEST   Byte Ptr [BX+02],01
3396 7463           JZ     33FB
3398 E8D200         CALL   346D
339B 8BFE           MOV    DI,SI
339D 8B04           MOV    AX,[SI]
339F A801           TEST   AL,01
33A1 7403           JZ     33A6
33A3 2BC8           SUB    CX,AX
33A5 49             DEC    CX
33A6 41             INC    CX
33A7 41             INC    CX
33A8 8B7704         MOV    SI,[BX+04]
33AB 0BF6           OR     SI,SI
33AD 744C           JZ     33FB
33AF 03CE           ADD    CX,SI
33B1 7309           JNB    33BC
33B3 33C0           XOR    AX,AX
33B5 BAF0FF         MOV    DX,FFF0
33B8 E330           JCXZ   33EA
33BA EB3F           JMP    33FB
33BC 16             PUSH   SS
33BD 07             POP    ES
33BE 26A12011       MOV    AX,ES:[1120]
33C2 3D0020         CMP    AX,2000
33C5 7416           JZ     33DD
33C7 BA0080         MOV    DX,8000
33CA 3BD0           CMP    DX,AX
33CC 7206           JB     33D4
33CE D1EA           SHR    DX,1
33D0 75F8           JNZ    33CA
33D2 EB22           JMP    33F6
33D4 83FA08         CMP    DX,+08
33D7 721D           JB     33F6
33D9 D1E2           SHL    DX,1
33DB 8BC2           MOV    AX,DX
33DD 48             DEC    AX
33DE 8BD0           MOV    DX,AX
33E0 03C1           ADD    AX,CX
33E2 7302           JNB    33E6
33E4 33C0           XOR    AX,AX
33E6 F7D2           NOT    DX
33E8 23C2           AND    AX,DX
33EA 52             PUSH   DX
33EB E82E00         CALL   341C
33EE 5A             POP    DX
33EF 730D           JNB    33FE
33F1 83FAF0         CMP    DX,-10
33F4 7405           JZ     33FB
33F6 B81000         MOV    AX,0010
33F9 EBE2           JMP    33DD
33FB F9             STC
33FC EB1B           JMP    3419
33FE 8BD0           MOV    DX,AX
3400 2B5704         SUB    DX,[BX+04]
3403 894704         MOV    [BX+04],AX
3406 897F08         MOV    [BX+08],DI
3409 8B770A         MOV    SI,[BX+0A]
340C 4A             DEC    DX
340D 8914           MOV    [SI],DX
340F 42             INC    DX
3410 03F2           ADD    SI,DX
3412 C704FEFF       MOV    Word Ptr [SI],FFFE
3416 89770A         MOV    [BX+0A],SI
3419 5F             POP    DI
341A 59             POP    CX
341B C3             RET
341C 8BD0           MOV    DX,AX
341E F6470204       TEST   Byte Ptr [BX+02],04
3422 740F           JZ     3433
3424 4A             DEC    DX
3425 8B7704         MOV    SI,[BX+04]
3428 4E             DEC    SI
3429 3BD6           CMP    DX,SI
342B 7205           JB     3432
342D 3957FE         CMP    [BX-02],DX
3430 7336           JNB    3468
3432 42             INC    DX
3433 53             PUSH   BX
3434 51             PUSH   CX
3435 8CDE           MOV    SI,DS
3437 8EC6           MOV    ES,SI
3439 B104           MOV    CL,04
343B D3E8           SHR    AX,CL
343D 7503           JNZ    3442
343F B80010         MOV    AX,1000
3442 F6470204       TEST   Byte Ptr [BX+02],04
3446 740A           JZ     3452
3448 03C6           ADD    AX,SI
344A 8B1EAC10       MOV    BX,[10AC]
344E 2BC3           SUB    AX,BX
3450 8EC3           MOV    ES,BX
3452 8BD8           MOV    BX,AX
3454 B44A           MOV    AH,4A                         ;'J'
3456 CD21           INT    21
3458 59             POP    CX
3459 5B             POP    BX
345A 7210           JB     346C
345C 8BC2           MOV    AX,DX
345E F6470204       TEST   Byte Ptr [BX+02],04
3462 7404           JZ     3468
3464 4A             DEC    DX
3465 8957FE         MOV    [BX-02],DX
3468 F8             CLC
3469 EB01           JMP    346C
346B F9             STC
346C C3             RET
346D 57             PUSH   DI
346E 8B7708         MOV    SI,[BX+08]
3471 3B770A         CMP    SI,[BX+0A]
3474 7503           JNZ    3479
3476 8B7706         MOV    SI,[BX+06]
3479 AD             LODSW
347A 3DFEFF         CMP    AX,FFFE
347D 7408           JZ     3487
347F 8BFE           MOV    DI,SI
3481 24FE           AND    AL,FE
3483 03F0           ADD    SI,AX
3485 EBF2           JMP    3479
3487 4F             DEC    DI
3488 4F             DEC    DI
3489 8BF7           MOV    SI,DI
348B 5F             POP    DI
348C C3             RET

; -----------------------------------------------------------------------------
;    vytvo©en¡ aloka‡n¡ho bloku
; -----------------------------------------------------------------------------

348E 8BD1           MOV    DX,CX
3490 83C227         ADD    DX,+27           ; zaokrouhlen¡
3493 80E2F0         AND    DL,F0            ; zarovn n¡
3496 8BDA           MOV    BX,DX
3498 F7DB           NEG    BX
349A F7DB           NEG    BX
349C F5             CMC
349D D1DB           RCR    BX,1
349F D1EB           SHR    BX,1
34A1 D1EB           SHR    BX,1
34A3 D1EB           SHR    BX,1
34A5 B448           MOV    AH,48                         ;'H'
34A7 CD21           INT    21               ; vytvo©en¡ aloka‡n¡ho bloku
34A9 7226           JB     34D1
34AB 3B068810       CMP    AX,[1088]
34AF 76F4           JBE    34A5
34B1 3B068610       CMP    AX,[1086]
34B5 7603           JBE    34BA
34B7 A38610         MOV    [1086],AX
34BA 8ED8           MOV    DS,AX
34BC 33DB           XOR    BX,BX
34BE 268B450C       MOV    AX,ES:[DI+0C]
34C2 894702         MOV    [BX+02],AX
34C5 8BC2           MOV    AX,DX
34C7 E86800         CALL   3532
34CA E89900         CALL   3566
34CD F8             CLC
34CE EB01           JMP    34D1
34D0 F9             STC
34D1 C3             RET

; -----------------------------------------------------------------------------
;    dek¢dov n¡ ‡¡sla
; -----------------------------------------------------------------------------

34D2 8B4E0A         MOV    CX,[BP+0A]
34D5 8B4604         MOV    AX,[BP+04]
34D8 8B5606         MOV    DX,[BP+06]
34DB 8B7E08         MOV    DI,[BP+08]
34DE 57             PUSH   DI
34DF 1E             PUSH   DS
34E0 07             POP    ES
34E1 FC             CLD
34E2 93             XCHG   AX,BX
34E3 0AC0           OR     AL,AL
34E5 7413           JZ     34FA
34E7 83F90A         CMP    CX,+0A
34EA 750E           JNZ    34FA
34EC 0BD2           OR     DX,DX
34EE 790A           JNS    34FA
34F0 B02D           MOV    AL,2D                         ;'-'
34F2 AA             STOSB
34F3 F7DB           NEG    BX
34F5 83D200         ADC    DX,+00
34F8 F7DA           NEG    DX
34FA 8BF7           MOV    SI,DI
34FC 92             XCHG   AX,DX
34FD 33D2           XOR    DX,DX
34FF 0BC0           OR     AX,AX
3501 7402           JZ     3505
3503 F7F1           DIV    CX
3505 93             XCHG   AX,BX
3506 F7F1           DIV    CX
3508 92             XCHG   AX,DX
3509 87D3           XCHG   DX,BX
350B 0430           ADD    AL,30                         ;'0'
350D 3C39           CMP    AL,39                         ;'9'
350F 7602           JBE    3513
3511 0427           ADD    AL,27                         ;'''
3513 AA             STOSB
3514 8BC2           MOV    AX,DX
3516 0BC3           OR     AX,BX
3518 75E2           JNZ    34FC
351A 8805           MOV    [DI],AL
351C 4F             DEC    DI
351D AC             LODSB
351E 8605           XCHG   AL,[DI]
3520 8844FF         MOV    [SI-01],AL
3523 8D4401         LEA    AX,[SI+01]
3526 3BC7           CMP    AX,DI
3528 72F2           JB     351C
352A 58             POP    AX
352B 5F             POP    DI
352C 5E             POP    SI
352D 8BE5           MOV    SP,BP
352F 5D             POP    BP
3530 C3             RET


3531 0006578B       ADD    [8B57],AL
3535 F8             CLC
3536 03FB           ADD    DI,BX
3538 897F04         MOV    [BX+04],DI
353B 4F             DEC    DI
353C 4F             DEC    DI
353D 2D1600         SUB    AX,0016
3540 8D7714         LEA    SI,[BX+14]
3543 C705FEFF       MOV    Word Ptr [DI],FFFE
3547 897F0A         MOV    [BX+0A],DI
354A 48             DEC    AX
354B 8904           MOV    [SI],AX
354D 8C1F           MOV    [BX],DS
354F 8BC6           MOV    AX,SI
3551 8CDA           MOV    DX,DS
3553 8EC2           MOV    ES,DX
3555 8D7F06         LEA    DI,[BX+06]
3558 FC             CLD
3559 AB             STOSW
355A AB             STOSW
355B 47             INC    DI
355C 47             INC    DI
355D 33C0           XOR    AX,AX
355F AB             STOSW
3560 AB             STOSW
3561 AB             STOSW
3562 AB             STOSW
3563 5F             POP    DI
3564 07             POP    ES
3565 C3             RET
3566 268B4502       MOV    AX,ES:[DI+02]
356A 0BC0           OR     AX,AX
356C 7509           JNZ    3577
356E 268C5D02       MOV    ES:[DI+02],DS
3572 26891D         MOV    ES:[DI],BX
3575 EB14           JMP    358B
3577 06             PUSH   ES
3578 26C47508       LES    SI,ES:[DI+08]
357C 268C5C0E       MOV    ES:[SI+0E],DS
3580 26895C0C       MOV    ES:[SI+0C],BX
3584 8C4712         MOV    [BX+12],ES
3587 897710         MOV    [BX+10],SI
358A 07             POP    ES
358B 268C5D0A       MOV    ES:[DI+0A],DS
358F 26895D08       MOV    ES:[DI+08],BX
3593 268C5D06       MOV    ES:[DI+06],DS
3597 26895D04       MOV    ES:[DI+04],BX
359B C3             RET
3590  89 5D 08 26 8C 5D 06 26-89 5D 04 C3 00 00 00 00  .].&.].&.].C....

; -----------------------------------------------------------------------------
;    zavadˆ‡ COM - segment 2468h
; -----------------------------------------------------------------------------
;þ
0000                db     100h dup(0)

; ------ kontrola pamˆti

0100 B80000         MOV    AX,0000          ; adresa konce po rozbalen¡
0103 BA0000         MOV    DX,0000          ; velikost p©ed rozbalen¡m
0106 3BC4           CMP    AX,SP            ; kontrola pamˆti
0108 7367           JNB    0171             ; nedostatek pamˆti

010A 8BC4           MOV    AX,SP            ; ukazatel z sobn¡ku
010C 2D4403         SUB    AX,0344          ; rezerva pro zavadˆ‡
010F 25F0FF         AND    AX,FFF0          ; zarovn n¡ na odstavec
0112 8BF8           MOV    DI,AX            ; ukl dac¡ adresa
0114 B9A200         MOV    CX,00A2          ; d‚lka zavadˆ‡e ve slovech
0117 BE7C01         MOV    SI,017C          ; za‡ tek zavadˆ‡e
011A FC             CLD
011B F3A5           REPZ   MOVSW            ; p©esun zavadˆ‡e nahoru
011D 8BD8           MOV    BX,AX            ; po‡ te‡n¡ adresa zavadˆ‡e
011F B104           MOV    CL,04            ; po‡et rotac¡
0121 D3EB           SHR    BX,CL            ; p©epo‡et na odstavec
0123 8CD9           MOV    CX,DS            ; adresa PSP
0125 03D9           ADD    BX,CX            ; adresa za‡ tku zavadˆ‡e
0127 53             PUSH   BX               ; segment zavadˆ‡e
0128 33DB           XOR    BX,BX            ; po‡ te‡n¡ adresa zavadˆ‡e
012A 53             PUSH   BX
012B CB             RETF                    ; skok do kopie zavadˆ‡e

012c                db     0ch,1

012e                db     'PKLITE Copr. 1991 PKWARE Inc. '
014c                db     'All Rights Reserved'
015f                db     'Not enough memory$

; ------ chyba - nedostatek pamˆti

0171 B80009         MOV    AX,0900
0174 BA5F01         MOV    DX,015F
0177 CD21           INT    21
0179 CD20           INT    20
017B 90             NOP

; ------ odsun dat nahoru

017C FD             STD
017D 8BF8           MOV    DI,AX            ; adresa k ulo‘en¡ dat
017F 4F             DEC    DI
0180 4F             DEC    DI               ; posledn¡ slovo
0181 BEBE02         MOV    SI,02BE          ; adresa za‡ tku dat
0184 03F2           ADD    SI,DX            ; adresa konce dat
0186 8BCA           MOV    CX,DX            ; d‚lka dat
0188 D1E9           SHR    CX,1             ; p©epo‡et na slova
018A F3A5           REPZ   MOVSW            ; p©esun dat nahoru

; ------ p©¡prava k dek¢dov n¡

018C FC             CLD
018D 87F7           XCHG   SI,DI
018F 46             INC    SI
0190 46             INC    SI
0191 BF0001         MOV    DI,0100
0194 AD             LODSW
0195 95             XCHG   AX,BP
0196 BA1000         MOV    DX,0010
0199 EB32           JMP    01CD
019B 90             NOP


019C AD             LODSW
019D 95             XCHG   AX,BP
019E B210           MOV    DL,10
01A0 EB3B           JMP    01DD

01A2 AD             LODSW
01A3 95             XCHG   AX,BP
01A4 B210           MOV    DL,10
01A6 EB3C           JMP    01E4

01A8 AD             LODSW
01A9 95             XCHG   AX,BP
01AA B210           MOV    DL,10
01AC EB41           JMP    01EF

01AE AD             LODSW
01AF 95             XCHG   AX,BP
01B0 B210           MOV    DL,10
01B2 EB63           JMP    0217

01B4 AD             LODSW
01B5 95             XCHG   AX,BP
01B6 B210           MOV    DL,10
01B8 EB64           JMP    021E

01BA AD             LODSW
01BB 95             XCHG   AX,BP
01BC B210           MOV    DL,10
01BE EB65           JMP    0225

01C0 AD             LODSW
01C1 95             XCHG   AX,BP
01C2 B210           MOV    DL,10
01C4 EB66           JMP    022C

01C6 AD             LODSW
01C7 95             XCHG   AX,BP
01C8 B210           MOV    DL,10
01CA 7208           JB     01D4

01CC A4             MOVSB

01CD D1ED           SHR    BP,1
01CF 4A             DEC    DX
01D0 74F4           JZ     01C6
01D2 73F8           JNB    01CC

01D4 33C9           XOR    CX,CX
01D6 33DB           XOR    BX,BX
01D8 D1ED           SHR    BP,1
01DA 4A             DEC    DX
01DB 74BF           JZ     019C
01DD D1D3           RCL    BX,1

01DF D1ED           SHR    BP,1
01E1 4A             DEC    DX
01E2 74BE           JZ     01A2
01E4 D1D3           RCL    BX,1

01E6 85DB           TEST   BX,BX
01E8 7417           JZ     0201

01EA D1ED           SHR    BP,1
01EC 4A             DEC    DX
01ED 74B9           JZ     01A8
01EF D1D3           RCL    BX,1

01F1 80FB06         CMP    BL,06
01F4 720B           JB     0201

01F6 D1ED           SHR    BP,1
01F8 4A             DEC    DX
01F9 7504           JNZ    01FF
01FB AD             LODSW
01FC 95             XCHG   AX,BP
01FD B210           MOV    DL,10
01FF D1D3           RCL    BX,1

0201 2E8A8F1C01     MOV    CL,CS:[BX+011C]
0206 80F90A         CMP    CL,0A
0209 743A           JZ     0245

020B 33DB           XOR    BX,BX
020D 83F902         CMP    CX,+02
0210 7426           JZ     0238
0212 D1ED           SHR    BP,1
0214 4A             DEC    DX
0215 7497           JZ     01AE
0217 721F           JB     0238

0219 D1ED           SHR    BP,1
021B 4A             DEC    DX
021C 7496           JZ     01B4
021E D1D3           RCL    BX,1

0220 D1ED           SHR    BP,1
0222 4A             DEC    DX
0223 7495           JZ     01BA
0225 D1D3           RCL    BX,1

0227 D1ED           SHR    BP,1
0229 4A             DEC    DX
022A 7494           JZ     01C0
022C D1D3           RCL    BX,1

022E 80FB02         CMP    BL,02
0231 731E           JNB    0251

0233 2E8ABF2C01     MOV    BH,CS:[BX+012C]
0238 AC             LODSB
0239 8AD8           MOV    BL,AL
023B 56             PUSH   SI
023C 8BF7           MOV    SI,DI
023E 2BF3           SUB    SI,BX
0240 F3             REPZ
0241 A4             MOVSB
0242 5E             POP    SI
0243 EB88           JMP    01CD

0245 AC             LODSB
0246 02C8           ADD    CL,AL
0248 80D500         ADC    CH,00
024B 3CFF           CMP    AL,FF
024D 75BC           JNZ    020B
024F EB33           JMP    0284

0251 D1ED           SHR    BP,1
0253 4A             DEC    DX
0254 7504           JNZ    025A
0256 AD             LODSW
0257 95             XCHG   AX,BP
0258 B210           MOV    DL,10
025A D1D3           RCL    BX,1
025C 80FB08         CMP    BL,08
025F 72D2           JB     0233
0261 D1ED           SHR    BP,1
0263 4A             DEC    DX
0264 7504           JNZ    026A

0266 AD             LODSW
0267 95             XCHG   AX,BP
0268 B210           MOV    DL,10
026A D1D3           RCL    BX,1
026C 80FB17         CMP    BL,17
026F 72C2           JB     0233

0271 D1ED           SHR    BP,1
0273 4A             DEC    DX
0274 7504           JNZ    027A
0276 AD             LODSW
0277 95             XCHG   AX,BP
0278 B210           MOV    DL,10
027A D1D3         * RCL    BX,1
027C 81E3DF00       AND    BX,00DF
0280 86DF           XCHG   BL,BH
0282 EBB4           JMP    0238

; -----------------------------------------------------------------------------
;    inicializace registr– a skok do programu
; -----------------------------------------------------------------------------

0284 33C0           XOR    AX,AX
0286 06             PUSH   ES
0287 BB0001         MOV    BX,0100
028A 53             PUSH   BX
028B 8BD8           MOV    BX,AX
028D 8BC8           MOV    CX,AX
028F 8BD0           MOV    DX,AX
0291 8BE8           MOV    BP,AX
0293 8BF0           MOV    SI,AX
0295 8BF8           MOV    DI,AX
0297 CB             RETF

                                            ; tabulka d‚lek (adresa 011ch)
0298                db     3,0              ; 0,1
                    db     2,10,4,5,0,0,0,0,0,0 ; 2 a‘ 0bh
                    db     6,7,8,9          ; 0ch,0dh,0eh,0fh

                                            ; tabulka offset– (adresa 012ch)
02a8                db     1,2,0,0          ; 0,1
                    db     3,4,5,6,0,0,0,0,0,0,0,0 ; 4 a‘ 7
                    db     7,8,9,0ah,0bh,0ch,0dh ; 10h a‘ 16h

0290  D0 8B E8 8B F0 8B F8 CB-03 00 02 0A 04 05 00 00  P.h.p.xK........
02A0  00 00 00 00 06 07 08 09-01 02 00 00 03 04 05 06  ................
02B0  00 00 00 00 00 00 00 00-07 08 09 0A 0B 0C 0D 90  ................

; -----------------------------------------------------------------------------
;    zavadˆ‡ EXE mal˜ - segment 2494h
; -----------------------------------------------------------------------------
;þ
0000                db     100h dup(0)

; ------ kontrola pamˆti

0100 B81B0A         MOV    AX,0A1B          ; velikost programu v odstavc¡ch
0103 BA9A06         MOV    DX,069A
0106 050E21    **** ADD    AX,210E          ; konec programu po rozbalen¡
0109 3B060200       CMP    AX,[0002]        ; je p©ete‡en¡ konce pamˆti ?
010D 731A           JNB    0129             ; je p©ete‡en¡ pamˆti

; ------ posun z sobn¡ku nahoru

010F 2D2000         SUB    AX,0020          ; rezerva pro z sobn¡k
0112 FA             CLI
0113 8ED0           MOV    SS,AX            ; segment z sobn¡ku
0115 FB             STI

; ------ p©esun zavadˆ‡e nahoru

0116 2D1900         SUB    AX,0019          ; segment pro zavadˆ‡ programu
0119 8EC0           MOV    ES,AX            ; nov  adresa zavadˆ‡e programu
011B 50             PUSH   AX               ; nov  adresa zavadˆ‡e programu
011C B9C300         MOV    CX,00C3          ; d‚lka zavadˆ‡e ve slovech
011F 33FF           XOR    DI,DI            ; nov  c¡lov  adresa
0121 57             PUSH   DI               ; nov  c¡lov  adresa
0122 BE4401         MOV    SI,0144          ; pokra‡ov n¡ zavadˆ‡e
0125 FC             CLD
0126 F3A5           REPZ   MOVSW            ; p©esun zavadˆ‡e nahoru
0128 CB             RETF                    ; skok na zavadˆ‡

; ------ chyba - nedostatek pamˆti

0129 B409         * MOV    AH,09
012B BA3201         MOV    DX,0132          ; text chyby
012E CD21           INT    21               ; zobrazen¡ textu
0130 CD20           INT    20               ; chybov˜ n vrat

0132                db     'Not enough memory$'

; ------ odsun dat nahoru

0144 FD             STD                     ; bude dek¢dov n¡ smˆrem dol–
0145 8CDB           MOV    BX,DS            ; segment PSP
0147 53             PUSH   BX               ; £schova segmentu PSP
0148 83C32D         ADD    BX,+2D
014B 03DA           ADD    BX,DX
014D 8CCD           MOV    BP,CS
014F 8BC2           MOV    AX,DX
0151 80E40F         AND    AH,0F
0154 B104           MOV    CL,04
0156 8BF2           MOV    SI,DX
0158 D3E6           SHL    SI,CL
015A 8BCE           MOV    CX,SI
015C D1E9           SHR    CX,1
015E 4E             DEC    SI
015F 4E             DEC    SI
0160 8BFE           MOV    DI,SI
0162 2BE8           SUB    BP,AX
0164 2BD8           SUB    BX,AX
0166 8EC5           MOV    ES,BP
0168 8EDB           MOV    DS,BX
016A F3             REPZ
016B A5             MOVSW                   ; odsun dat nahoru

; -----------------------------------------------------------------------------
; Diagram k¢dov n¡          (1 bit)
; ----------------         ÚÄÄÄÂÄÄÄ¿
;                          ³ 0 ³ 1 ³
;                          ÀÄÂÄÁÄÂÄÙ
;       ÚÄÄÄÄÄ(1 bajt)ÄÄÄÄÄÄÄÙ   ÀÄÄÄÄ(2 bity)ÄÄÄ¿
;ÚÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿      ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
;³ p©enos bajtu ³   ÚÄÄÁÄÄÄ¿                  (1 bit)
;³  beze zmˆny  ³   ³stav 0³            ÚÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
;ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ   ÀÄÄÂÄÄÄÙ      ÚÄÄÄÄÄÁÄÄÄÄÄ¿         ³        ÚÄÄÄÄÁÄÄÄÄÄÄ¿
;                ÚÄÄÄÄÄÁÄÄÄÄÄÄ¿   ³stav 2,4,5 ³      (1 bit)     ³ stav 10   ³
;                ³ d‚lka = 3  ³   ÀÄÄÄÄÄÂÄÄÄÄÄÙ  ÚÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿ÀÄÄÄÄÂÄÄÄÄÄÄÙ
;                ÀÄÄÄÄÄÂÄÄÄÄÄÄÙ ÚÄÄÄÄÄÄÄÁÄÄÄÄÄÄ¿ ³d‚lka = 6 a‘ 9³     ³
;                      ³        ³d‚lka = 2,4,5 ³ ÀÄÄÄÄÄÄÂÄÄÄÄÄÄÄÙ  (1 bajt)
;                      ³        ÀÄÄÄÄÄÄÄÂÄÄÄÄÄÄÙ        ³    ÚÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿
;                      ³                ³               ³    ³d‚lka 10 a‘ 264 ³
;      d‚lka = 265     ³                ³               ³    ÀÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÙ
;   ÚÄÄÄÄÄÄÄÄÄÄÄ<ÄÄÄÄÄ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
;   ³                                   ³
;   ³       ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
;   ³       ³       (1 bit)  ÚÄÄÄÄÄÄÄ¿
;   ³       ³          ³     ³    (3 bity)
;   ³       ³      ÚÄÄÄÅÄÄÄ¿ ³       ÃÄÄÄÄÄÄÄÄÄÄÄ¿
;   ³       ³      ³ 1 ³ 0 ³ ³ ÚÄÄÄÄÄÁÄÄÄÄ¿   (1 bit)
;   ³       ³      ÀÄÂÄÁÄÂÄÙ ³ ³stav 0, 1 ³      ÃÄÄÄÄÄÄÄÄÄÄ¿
;   ³       ³        ³   ÀÄÄÄÙ ÀÄÄÄÄÄÂÄÄÄÄÙÚÄÄÄÄÄÁÄÄÄÄÄÄÄ¿  ³
;   ³       ³        ³         ÚÄÄÄÄÄÁÄÄÄÄ¿³ stav 4 a‘ 7 ³  ³
;   ³       ³        ³         ³HIGH = 1,2³ÀÄÄÄÄÄÄÂÄÄÄÄÄÄÙ  ³
;   ³       ³   ÚÄÄÄÄÁÄÄÄÄÄ¿   ÀÄÄÄÄÄÂÄÄÄÄÙÚÄÄÄÄÄÄÁÄÄÄÄÄÄ¿  ³
;   ³       ³   ³ HIGH = 0 ³         ³     ³HIGH = 3 a‘ 6³(1 bit)
;   ³       ³   ÀÄÄÄÄÂÄÄÄÄÄÙ         ³     ÀÄÄÄÄÄÄÂÄÄÄÄÄÄÙ  ÃÄÄÄÄÄÄÄÄÄ¿
;   ³ ÚÄÄÄÄÄÁÄÄÄÄÄ¿  ³               ³            ³ ÚÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿ ³
;   ³ ³ d‚lka = 2 ³  ³               ³            ³ ³stav 10h a‘ 16h³ ³
;   ³ ³ HIGH  = 0 ³  ³               ³            ³ ÀÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÙ ³
;   ³ ÀÄÄÄÄÄÂÄÄÄÄÄÙ  ³               ³            ³ ÚÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿ ³
;   ³       ³        ³               ³            ³ ³HIGH = 7 a‘ 0dh³ ³
;   ³       ³        ³               ³            ³ ÀÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÙ ³
;   ³       ³        ³               ³            ³         ³      (1 bit)
;   ³       ³        ³               ³            ³         ³         ³
;   ³       ³        ³               ³            ³         ³ ÚÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿
;   ³       ³        ³               ³            ³         ³ ³HIGH=0eh a‘ 1fh³
;   ³       ³        ³               ³            ³         ³ ÀÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÙ
;   ³       ÀÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÙ
;   ³                            ³
;   ³                  (1 bajt) = offset LOW
;   ³                            ³
;   ³                  ÚÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ¿
;   ³                  ³ opakov n¡ ©etˆzce ³
;   ³                  ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
; konec
;

; ------ p©¡prava k dek¢dov n¡

016C FC             CLD
016D 8EDD           MOV    DS,BP            ; segment se zak¢dovan˜m programem
016F 07             POP    ES               ; segment PSP
0170 06             PUSH   ES
0171 BF0001         MOV    DI,0100          ; ukl dac¡ adresa
0174 33F6           XOR    SI,SI            ; ‡tec¡ adresa zak¢dovan˜ch dat
0176 AD             LODSW                   ; na‡ten¡ slova p©¡znak–
0177 95             XCHG   AX,BP            ; BP <- slovo p©¡znak–
0178 BA1000         MOV    DX,0010          ; po‡et bit– slova p©¡znak–
017B EB2C           JMP    01A9             ; za‡ tek dek¢dov n¡
017D 90             NOP

; ------ dal¨¡ slovo p©¡znak– pro druh˜ bit p©¡znak–

017E AD           * LODSW
017F 95             XCHG   AX,BP
0180 B210           MOV    DL,10
0182 EB35           JMP    01B9

; ------ dal¨¡ slovo p©¡znak– pro t©et¡ bit p©¡znak–

0184 AD           * LODSW
0185 95             XCHG   AX,BP
0186 B210           MOV    DL,10
0188 EB36           JMP    01C0

; ------ dal¨¡ slovo p©¡znak– pro ‡tvrt˜ bit p©¡znak–

018A AD             LODSW
018B 95             XCHG   AX,BP
018C B210           MOV    DL,10
018E EB3B           JMP    01CB

0190 AD             LODSW
0191 95             XCHG   AX,BP
0192 B210           MOV    DL,10
0194 EB5D           JMP    01F3

0196 AD             LODSW
0197 95             XCHG   AX,BP
0198 B210           MOV    DL,10
019A EB5E           JMP    01FA

019C AD             LODSW
019D 95             XCHG   AX,BP
019E B210           MOV    DL,10
01A0 EB5F           JMP    0201

; ------ nov‚ slovo p©¡znak– pro prvn¡ bit p©¡znak–

01A2 AD           * LODSW
01A3 95             XCHG   AX,BP
01A4 B210           MOV    DL,10
01A6 7208           JB     01B0

; -----------------------------------------------------------------------------
;    p©enos bajtu beze zmˆny
; -----------------------------------------------------------------------------

; ------ p©enos bajtu beze zmˆny

01A8 A4           * MOVSB                   ; p©enos bajtu beze zmˆny

; ------ prvn¡ bit p©¡znak–

01A9 D1ED         * SHR    BP,1             ; p©¡znak
01AB 4A             DEC    DX               ; ‡¡ta‡ bit– slova p©¡znak–
01AC 74F4           JZ     01A2             ; jsou ji‘ v¨echny bity p©¡znak–
01AE 73F8           JNB    01A8             ; je p©enos bajtu beze zmˆny

; -----------------------------------------------------------------------------
;    d‚lka ©etˆzce k opakov n¡
; -----------------------------------------------------------------------------

; ------ druh˜ bit p©¡znak–

01B0 33C9         * XOR    CX,CX            ; p©ednastaven¡ po‡tu bajt–
01B2 33DB           XOR    BX,BX            ; st©ada‡ bit– p©¡znak–
01B4 D1ED           SHR    BP,1             ; dal¨¡ bit p©¡znak–
01B6 4A             DEC    DX
01B7 74C5           JZ     017E             ; jsou ji‘ v¨echny p©¡znaky - dal¨¡
01B9 D1D3         * RCL    BX,1             ; £schova p©¡znaku do BX

; ------ t©et¡ bit p©¡znak–

01BB D1ED           SHR    BP,1             ; dal¨¡ bit p©¡znak–
01BD 4A             DEC    DX
01BE 74C4           JZ     0184             ; jsou ji‘ v¨echny p©¡znaky - dal¨¡
01C0 D1D3         * RCL    BX,1             ; £schova p©¡znaku do BX

; ------ stav "0" - kr tk‚ opakov n¡ 3 bajty

01C2 85DB           TEST   BX,BX            ; je stav "0" ?
01C4 7417           JZ     01DD             ; je stav "0"

; ------ ‡tvrt˜ bit p©¡znak–

01C6 D1ED           SHR    BP,1             ; dal¨¡ bit p©¡znak–
01C8 4A             DEC    DX               ; ‡¡ta‡ bit– slova p©¡znak–
01C9 74BF           JZ     018A             ; jsou ji‘ v¨echny bity p©¡znak–
01CB D1D3         * RCL    BX,1             ; dal¨¡ bit offsetu

; ------ stav "2" a‘ "5" - st©edn¡ d‚lka opakov n¡ 2, 4 nebo 5 bajt–

01CD 80FB06         CMP    BL,06            ; je stav "2" a‘ "5" ?
01D0 720B           JB     01DD             ; st©edn¡ d‚lka opakov n¡

; ------ p t˜ bit p©¡znak– - stav "0ch" a‘ "0fh" - dlouh‚ opakov n¡ 6 a‘ 9 bajt–

01D2 D1ED           SHR    BP,1             ; dal¨¡ bit p©¡znak–
01D4 4A             DEC    DX               ; ‡¡ta‡ bit– slova p©¡znak–
01D5 7504           JNZ    01DB             ; nejsou je¨tˆ v¨echny bity p©¡znak–
01D7 AD             LODSW                   ; na‡ten¡ dal¨¡ho slova p©¡znak–
01D8 95             XCHG   AX,BP            ; BP <- nov‚ slovo p©¡znak–
01D9 B210           MOV    DL,10            ; nov˜ po‡et bit– p©¡znak–
01DB D1D3         * RCL    BX,1             ; dal¨¡ bit offsetu

; ------ d‚lka ©etˆzce k opakov n¡

01DD 2E8A8F5E01     MOV    CL,CS:[BX+015E]  ; = tabulka d‚lek 02A2h
01E2 80F90A         CMP    CL,0A            ; je velmi dlouh‚ opakov n¡ ?
01E5 7474           JZ     025B             ; je velmi dlouh‚ opakov n¡

; -----------------------------------------------------------------------------
;    vzd lenost opakov n¡
; -----------------------------------------------------------------------------

; ------ d‚lka 2 nebo bit "1" - velmi bl¡zk‚ opakov n¡ - offset HIGH = 0

01E7 33DB         * XOR    BX,BX            ; BX <- 0 offset HIGH
01E9 83F902         CMP    CX,+02           ; jsou 2 bajty ?
01EC 742A           JZ     0218             ; shoda 2 bajt– - bl¡zk‚ opakov n¡
01EE D1ED           SHR    BP,1
01F0 4A             DEC    DX
01F1 749D           JZ     0190
01F3 7223         * JB     0218             ; "1" - bl¡zk‚ opakov n¡

; ------ bit p©¡znak–

01F5 D1ED           SHR    BP,1
01F7 4A             DEC    DX
01F8 749C           JZ     0196
01FA D1D3         * RCL    BX,1

; ------ bit p©¡znak–

01FC D1ED           SHR    BP,1
01FE 4A             DEC    DX
01FF 749B           JZ     019C
0201 D1D3         * RCL    BX,1

; ------ bit p©¡znak–

0203 D1ED           SHR    BP,1
0205 4A             DEC    DX
0206 7504           JNZ    020C
0208 AD             LODSW
0209 95             XCHG   AX,BP
020A B210           MOV    DL,10
020C D1D3         * RCL    BX,1

; ------ stav 0 a‘ 1 - bl¡zk‚ opakov n¡ s offsetem HIGH 1 a‘ 2

020E 80FB02         CMP    BL,02
0211 7315           JNB    0228             ; stav 2 a‘ 7
                                            ; jinak offset HIGH 1 a 2

; ------ kopie (opakov n¡) ©etˆzce

0213 2E8ABF6E01   * MOV    BH,CS:[BX+016E]  ; = tabulka 02b2h - offset HIGH
0218 AC           * LODSB                   ; offset LOW
0219 8AD8           MOV    BL,AL            ; offset LOW
021B 56             PUSH   SI               ; £schova SI
021C 8BF7           MOV    SI,DI            ; adresa ukazatele
021E 2BF3           SUB    SI,BX            ; adresa shodn‚ho ©etˆzce
0220 FA             CLI                     ; z kaz p©eru¨en¡
0221 F3             REPZ
0222 26A4           MOVSB  ES:              ; kopie shodn‚ho ©etˆzce
0224 FB             STI                     ; povolen¡ p©eru¨en¡
0225 5E             POP    SI               ; n vrat SI
0226 EB81           JMP    01A9             ; dal¨¡ dekomprese

; ------ st©edn¡ opakov n¡ s offsetem HIGH 3 a‘ 6

0228 D1ED         * SHR    BP,1             ; dal¨¡ bit p©¡znak–
022A 4A             DEC    DX
022B 7504           JNZ    0231             ; nejsou v¨echny bity
022D AD             LODSW                   ; dal¨¡ slovo p©¡znak–
022E 95             XCHG   AX,BP            ; BP <- slovo p©¡znak–
022F B210           MOV    DL,10            ; nov˜ ‡¡ta‡ bit– p©¡znak–
0231 D1D3         * RCL    BX,1             ; rotace bitu p©¡znak– do BX
0233 80FB08         CMP    BL,08            ; stav 4 a‘ 7
0236 72DB           JB     0213             ; 4 a‘ 7 = offset HIGH 3 a‘ 6
                                            ; jinak stav 8 a‘ 0fh

; ------ vzd len‚ opakov n¡ s offsetem HIGH 7 a‘ 0dh

0238 D1ED           SHR    BP,1             ; dal¨¡ bit p©¡znak–
023A 4A             DEC    DX
023B 7504           JNZ    0241
023D AD             LODSW
023E 95             XCHG   AX,BP
023F B210           MOV    DL,10
0241 D1D3         * RCL    BX,1
0243 80FB17         CMP    BL,17            ; stav 10h a‘ 16h
0246 72CB           JB     0213             ; 10h a‘ 16h = offset 7 a‘ 0dh
                                            ; jinak stav 17h a‘ 1fh

; ------ velmi vzd len‚ opakov n¡ HIGH 0eh a‘ 1fh

0248 D1ED           SHR    BP,1             ; dal¨¡ bit p©¡znak–
024A 4A             DEC    DX
024B 7504           JNZ    0251
024D AD             LODSW
024E 95             XCHG   AX,BP
024F B210           MOV    DL,10
0251 D1D3         * RCL    BX,1             ; stav 2eh a‘ 3fh
0253 81E3DF00       AND    BX,00DF          ; korekce na 0eh a‘ 1fh
0257 86DF           XCHG   BL,BH            ; BH <- offset HIGH
0259 EBBD           JMP    0218             ; p©enos dat

; ------ stav 10 - velmi dlouh‚ opakov n¡ ©etˆzce 10 a‘ 264 bajt–

025B AC             LODSB                   ; d‚lka ©etˆzce
025C 02C8           ADD    CL,AL
025E 80D500         ADC    CH,00
0261 3CFF           CMP    AL,FF            ; je konec souboru ?
0263 7582           JNZ    01E7

; -----------------------------------------------------------------------------
;                       relokace polo‘ek
; -----------------------------------------------------------------------------

; ------ p©¡prava k relokaci polo‘ek

0265 5B             POP    BX               ; segment adresy PSP
0266 8BEB           MOV    BP,BX            ; segment adresy PSP
0268 83C310         ADD    BX,+10           ; reloka‡n¡ segment

; ------ p©¡prava segmentu k relokaci polo‘ek

026B 33C0         * XOR    AX,AX            ; AX <- 0
026D AC             LODSB                   ; po‡et polo‘ek k relokaci v segm.
026E 91             XCHG   AX,CX            ; CX <- po‡et polo‘ek k relokaci
026F E30E           JCXZ   027F             ; nen¡ ‘ dn  polo‘ka-start programu
0271 AD             LODSW                   ; offset segmentu k relokaci
0272 03C3           ADD    AX,BX            ; segment za‡ tku programu
0274 8EC0           MOV    ES,AX            ; segment bloku k relokaci

; ------ relokace polo‘ek programu v jednom segmentu

0276 AD           * LODSW                   ; na‡ten¡ offsetu relokovan‚ polo‘ky
0277 97             XCHG   AX,DI            ; DI <- offset relokovan‚ polo‘ky
0278 26011D         ADD    ES:[DI],BX       ; relokace polo‘ky
027B E2F9           LOOP   0276             ; relokace dal¨¡ polo‘ky
027D EBEC           JMP    026B             ; relokace dal¨¡ho segmentu

; -----------------------------------------------------------------------------
;    inicializace registr– a skok do programu
; -----------------------------------------------------------------------------

; ------ inicializace registr– SS:SP a CS:IP

027F AD           * LODSW                   ; offset segmentu z sobn¡ku SS
0280 03C3           ADD    AX,BX            ; alokace adresy segmentu z sobn¡ku
0282 FA             CLI
0283 8ED0           MOV    SS,AX            ; nov˜ segment z sobn¡ku
0285 AD             LODSW                   ; offset z sobn¡ku
0286 8BE0           MOV    SP,AX            ; nov˜ offset z sobn¡ku
0288 FB             STI
0289 AD             LODSW                   ; offset segmentu CS
028A 03D8           ADD    BX,AX            ; alokace adresy segmentu CS
028C 53             PUSH   BX               ; £schova CS do z sobn¡ku
028D AD             LODSW                   ; offset adresy za‡ tku programu IP
028E 50             PUSH   AX               ; £schova IP do z sobn¡ku

; ------ inicializace registr–

028F 8EC5           MOV    ES,BP            ; n vrat p–vodn¡ho PSP
0291 8EDD           MOV    DS,BP            ; n vrat p–vodn¡ho PSP
0293 33C0           XOR    AX,AX            ; AX <- 0
0295 8BD8           MOV    BX,AX            ; BX <- 0
0297 8BC8           MOV    CX,AX            ; CX <- 0
0299 8BD0           MOV    DX,AX            ; DX <- 0
029B 8BE8           MOV    BP,AX            ; BP <- 0
029D 8BF0           MOV    SI,AX            ; SI <- 0
029F 8BF8           MOV    DI,AX            ; DI <- 0
02A1 CB             RETF                    ; skok do p–vodn¡ho programu

                                            ; tabulka d‚lek (adresa 015eh)
02A2                db     3,0              ; 0,1
                    db     2,10,4,5,0,0,0,0,0,0 ; 2 a‘ 0bh
                    db     6,7,8,9          ; 0ch,0dh,0eh,0fh

                                            ; tabulka offset– (adresa 016eh)
02b2                db     1,2,0,0          ; 0,1
                    db     3,4,5,6,0,0,0,0,0,0,0,0 ; 4 a‘ 7
                    db     7,8,9,0ah,0bh,0ch,0dh ; 10h a‘ 16h

02C0  00 00 07 08 09 0A 0B 0C-0D 00 00 00 00 00 00 00  ................

; -----------------------------------------------------------------------------
;    zavadˆ‡ EXE velk˜ - segment 24C1h
; -----------------------------------------------------------------------------
;þ
0000                db     100h dup(0)

; ------ kontrola pamˆti

0100 B80000         MOV    AX,0000          ; velikost programu po rozbalen¡
0103 BA0000         MOV    DX,0000          ; velikost programu zkomprimovan‚ho
0106 050000    **** ADD    AX,0000          ; + segment = konec prog. po rozbal.
0109 3B060200       CMP    AX,[0002]        ; je p©ete‡en¡ konce pamˆti ?
010D 731A           JNB    0129             ; je p©ete‡en¡ pamˆti

; ------ posun z sobn¡ku nahoru

010F 2D2000         SUB    AX,0020          ; rezerva pro z sobn¡k
0112 FA             CLI                     
0113 8ED0           MOV    SS,AX            ; segment z sobn¡ku
0115 FB             STI

; ------ p©esun zavadˆ‡e nahoru

0116 2D2500         SUB    AX,0025          ; segment pro zavadˆ‡ programu
0119 8EC0           MOV    ES,AX            ; nov  adresa zavadˆ‡e programu
011B 50             PUSH   AX               ; nov  adresa zavadˆ‡e programu
011C B92201         MOV    CX,0122          ; d‚lka zavadˆ‡e ve slovech
011F 33FF           XOR    DI,DI            ; nov  c¡lov  adresa
0121 57             PUSH   DI               ; nov  c¡lov  adresa
0122 BE4401         MOV    SI,0144          ; pokra‡ov n¡ zavadˆ‡e
0125 FC             CLD                     
0126 F3A5           REPZ   MOVSW            ; p©esun zavadˆ‡e nahoru
0128 CB             RETF                    ; skok na zavadˆ‡

; ------ chyba - nedostatek pamˆti

0129 B409         * MOV    AH,09
012B BA3201         MOV    DX,0132          ; text chyby
012E CD21           INT    21               ; zobrazen¡ textu
0130 CD20           INT    20               ; chybov˜ n vrat

0132                db     'Not enough memory$'

; ------ odsun dat nahoru

0144 FD             STD                     ; bude dek¢dov n¡ smˆrem dol–
0145 8CDB           MOV    BX,DS            ; segment PSP
0147 53             PUSH   BX               ; £schova segmentu PSP
0148 83C339         ADD    BX,+39           ; + d‚lka zavadˆ‡e v odstavc¡ch
014B 03DA           ADD    BX,DX            : + data = segment konec dat
014D 8CCD           MOV    BP,CS            ; £schova CS
014F 8BC2           MOV    AX,DX            ; d‚lka zkomprimovan˜ch dat
0151 80E40F         AND    AH,0F            ; zbytek v jednom segmentu
0154 B104           MOV    CL,04            ; po‡et rotac¡
0156 8BF2           MOV    SI,DX            ; d‚lka zkomprimovan˜ch dat
0158 D3E6           SHL    SI,CL            ; offset konce dat v segmentu
015A D3EA           SHR    DX,CL            ; d‚lka / 16
015C FEC6           INC    DH               ; po‡et segment– 64 KB
015E 8BCE           MOV    CX,SI            ; offset konce dat v segmentu
0160 D1E9           SHR    CX,1             ; p©epo‡et na slova
0162 4E             DEC    SI
0163 4E             DEC    SI               ; adresa posledn¡ho slova
0164 8BFE           MOV    DI,SI            ; adresa posledn¡ho slova
0166 2BE8         * SUB    BP,AX            ; posun segmentu o blok
0168 2BD8           SUB    BX,AX            ;
016A 8EC5           MOV    ES,BP            ;
016C 8EDB           MOV    DS,BX
016E F3             REPZ
016F A5             MOVSW                   ; odsun dat nahoru
0170 B80010         MOV    AX,1000          ; velikost dal¨¡ho bloku 64 KB
0173 B580           MOV    CH,80            ; nov˜ ‡¡ta‡ slov
0175 FECE           DEC    DH               ; ‡¡ta‡ segment–
0177 75ED           JNZ    0166             ; posun dal¨¡ho segmentu

; -----------------------------------------------------------------------------
; Diagram k¢dov n¡          (1 bit)
; ----------------         ÚÄÄÄÂÄÄÄ¿
;                          ³ 0 ³ 1 ³
;                          ÀÄÂÄÁÄÂÄÙ
;       ÚÄÄÄÄÄ(1 bajt)ÄÄÄÄÄÄÄÙ   ÀÄ(2 bity)ÄÄ¿
;ÚÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿       ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
;³ p©enos bajtu ³   ÚÄÄÄÁÄÄÄÄ¿            (1 bit)
;³  beze zmˆny  ³   ³stav 2,3³        ÚÄÄÄÄÄÄÁÄÄÄÄ¿
;ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ   ÀÄÄÄÂÄÄÄÄÙ   ÚÄÄÄÄÁÄÄÄÄ¿      ³
;                ÚÄÄÄÄÄÄÁÄÄÄÄÄÄ¿ ³ stav 0  ³   (1 bit)
;                ³ d‚lka = 2,3 ³ ÀÄÄÄÄÂÄÄÄÄÙ      ÃÄÄÄÄÄÄÄÄÄÄ¿
;                ÀÄÄÄÄÄÄÂÄÄÄÄÄÄÙÚÄÄÄÄÄÁÄÄÄÄÄ¿ÚÄÄÄÄÁÄÄÄÄ¿  (1 bit)
;                       ³       ³ d‚lka = 4 ³³ stav 2-4³     ÃÄÄÄÄÄÄÄÄÄÄÄÄ¿
;                       ³       ÀÄÄÄÄÄÂÄÄÄÄÄÙÀÄÄÄÄÂÄÄÄÄÙÚÄÄÄÄÁÄÄÄÄÄ¿   (1 bit)
;                       ³             ³      ÚÄÄÄÄÁÄÄÄÄ¿³stav 0a-0c³      ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
;                       ³             ³      ³d‚lka 5-7³ÀÄÄÄÄÂÄÄÄÄÄÙ ÚÄÄÄÄÁÄÄÄÄÄÄ¿        (1 bit)
;                       ³             ³      ÀÄÄÄÄÂÄÄÄÄÙÚÄÄÄÄÁÄÄÄÄÄ¿ ³stav 2 a‘ 4³            ³
;                       ³             ³           ³     ³d‚lka 8-10³ ÀÄÄÄÄÂÄÄÄÄÄÄÙ
;                       ³             ³           ³     ÀÄÄÄÄÂÄÄÄÄÄÙÚÄÄÄÄÄÁÄÄÄÄÄÄÄÄ¿
;                       ³             ³           ³          ³      ³d‚lka 11,12,25³
;                       ³             ³           ³          ³      ÀÄÄÄÄÄÂÄÄÄÄÄÄÄÄÙ
;                       ³             ³           ³          ³            ³
;                       ³             ³           ³          ³            ÃÄÄÄÄÄÄÄÄ¿
;                       ³             ³           ³          ³            ³ ÚÄÄÄÄÄÄÁÄÄÄÄ¿
;                       ³             ³           ³          ³            ³ ³ d‚lka 25  ³
;                       ³             ³           ³          ³            ³ ÀÄÄÄÄÄÂÄÄÄÄÄÙ
;                       ³             ³           ³          ³            ³    (1 bajt)
;                       ³             ³           ³          ³            ³ ÚÄÄÄÄÄÁÄÄÄÄÄÄ¿
;                       ³             ³           ³          ³            ³ ³d‚lka 25-290³
;                       ³             ³           ³          ³            ³ ÀÄÄÄÄÄÂÄÄÄÄÄÄÙ
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;                       ³             ³           ³          ³            ³       ³
;      d‚lka = 289,290  ³             ³           ³          ³            ³       ³
;   ÚÄÄÄÄÄÄÄÄÄÄÄ<ÄÄÄÄÄÄ ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÙ
;   ³                                 ³
;   ³       ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
;   ³       ³       (1 bit)  ÚÄÄÄÄÄÄÄ¿
;   ³       ³          ³     ³    (3 bity)
;   ³       ³      ÚÄÄÄÅÄÄÄ¿ ³       ÃÄÄÄÄÄÄÄÄÄÄÄ¿
;   ³       ³      ³ 1 ³ 0 ³ ³ ÚÄÄÄÄÄÁÄÄÄÄ¿   (1 bit)
;   ³       ³      ÀÄÂÄÁÄÂÄÙ ³ ³stav 0, 1 ³      ÃÄÄÄÄÄÄÄÄÄÄ¿
;   ³       ³        ³   ÀÄÄÄÙ ÀÄÄÄÄÄÂÄÄÄÄÙÚÄÄÄÄÄÁÄÄÄÄÄÄÄ¿  ³
;   ³       ³        ³         ÚÄÄÄÄÄÁÄÄÄÄ¿³ stav 4 a‘ 7 ³  ³
;   ³       ³        ³         ³HIGH = 1,2³ÀÄÄÄÄÄÄÂÄÄÄÄÄÄÙ  ³
;   ³       ³   ÚÄÄÄÄÁÄÄÄÄÄ¿   ÀÄÄÄÄÄÂÄÄÄÄÙÚÄÄÄÄÄÄÁÄÄÄÄÄÄ¿  ³
;   ³       ³   ³ HIGH = 0 ³         ³     ³HIGH = 3 a‘ 6³(1 bit)
;   ³       ³   ÀÄÄÄÄÂÄÄÄÄÄÙ         ³     ÀÄÄÄÄÄÄÂÄÄÄÄÄÄÙ  ÃÄÄÄÄÄÄÄÄÄ¿
;   ³ ÚÄÄÄÄÄÁÄÄÄÄÄ¿  ³               ³            ³ ÚÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿ ³
;   ³ ³ d‚lka = 2 ³  ³               ³            ³ ³stav 10h a‘ 16h³ ³
;   ³ ³ HIGH  = 0 ³  ³               ³            ³ ÀÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÙ ³
;   ³ ÀÄÄÄÄÄÂÄÄÄÄÄÙ  ³               ³            ³ ÚÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿ ³
;   ³       ³        ³               ³            ³ ³HIGH = 7 a‘ 0dh³ ³
;   ³       ³        ³               ³            ³ ÀÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÙ ³
;   ³       ³        ³               ³            ³         ³      (1 bit)
;   ³       ³        ³               ³            ³         ³         ³
;   ³       ³        ³               ³            ³         ³ ÚÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄ¿
;   ³       ³        ³               ³            ³         ³ ³HIGH=0eh a‘ 1fh³
;   ³       ³        ³               ³            ³         ³ ÀÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÙ
;   ³       ÀÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÙ
;   ³                            ³
;   ÃÄÄÄÄÄÄÄÄÄ¿        (1 bajt) = offset LOW
;   ³    ÚÄÄÄÄÁÄÄÄÄ¿             ³
;   ³    ³d‚lka 289³   ÚÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ¿
;   ³    ÀÄÄÄÄÂÄÄÄÄÙ   ³ opakov n¡ ©etˆzce ³
;   ³         ³        ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
; konec   normalizace
;           adres

; ------ p©¡prava k dek¢dov n¡

0179 FC             CLD
017A 8EDD           MOV    DS,BP            ; segment se zak¢dovan˜m programem
017C 07             POP    ES               ; segment PSP
017D 06             PUSH   ES               
017E BF0001         MOV    DI,0100          ; ukl dac¡ adresa
0181 33F6           XOR    SI,SI            ; ‡tec¡ adresa zak¢dovan˜ch dat
0183 AD             LODSW                   ; na‡ten¡ slova p©¡znak–
0184 95             XCHG   AX,BP            ; BP <- slovo p©¡znak–
0185 BA1000         MOV    DX,0010          ; po‡et bit– slova p©¡znak–
0188 EB37           JMP    01C1             ; za‡ tek dek¢dov n¡

; ------ dal¨¡ slovo p©¡znak– pro druh˜ bit p©¡znak–

018A AD             LODSW
018B 95             XCHG   AX,BP
018C B210           MOV    DL,10
018E EB41           JMP    01D1

; ------ dal¨¡ slovo p©¡znak– pro t©et¡ bit p©¡znak–

0190 AD             LODSW
0191 95             XCHG   AX,BP
0192 B210           MOV    DL,10
0194 EB42           JMP    01D8

; ------ dal¨¡ slovo p©¡znak– pro ‡tvrt˜ bit p©¡znak–

0196 AD             LODSW
0197 95             XCHG   AX,BP
0198 B210           MOV    DL,10
019A EB48           JMP    01E4


019C AD             LODSW
019D 95             XCHG   AX,BP
019E B210           MOV    DL,10
01A0 EB4D           JMP    01EF


01A2 AD             LODSW
01A3 95             XCHG   AX,BP
01A4 B210           MOV    DL,10
01A6 EB53           JMP    01FB


01A8 AD             LODSW
01A9 95             XCHG   AX,BP
01AA B210           MOV    DL,10
01AC EB67           JMP    0215


01AE AD             LODSW
01AF 95             XCHG   AX,BP
01B0 B210           MOV    DL,10
01B2 EB68           JMP    021C


01B4 AD             LODSW
01B5 95             XCHG   AX,BP
01B6 B210           MOV    DL,10
01B8 EB69           JMP    0223

; ------ nov‚ slovo p©¡znak– pro prvn¡ bit p©¡znak–

01BA AD             LODSW
01BB 95             XCHG   AX,BP
01BC B210           MOV    DL,10
01BE 7208           JB     01C8

; -----------------------------------------------------------------------------
;    p©enos bajtu beze zmˆny
; -----------------------------------------------------------------------------

; ------ p©enos bajtu beze zmˆny

01C0 A4             MOVSB                   ; p©enos bajtu beze zmˆny

; ------ prvn¡ bit p©¡znak–

01C1 D1ED           SHR    BP,1             ; p©¡znak
01C3 4A             DEC    DX               ; ‡¡ta‡ bit– slova p©¡znak–
01C4 74F4           JZ     01BA             ; jsou ji‘ v¨echny bity p©¡znak–
01C6 73F8           JNB    01C0             ; je p©enos bajtu beze zmˆny

; -----------------------------------------------------------------------------
;    d‚lka ©etˆzce k opakov n¡
; -----------------------------------------------------------------------------

; ------ druh˜ bit p©¡znak–

01C8 33C9           XOR    CX,CX            ; p©ednastaven¡ po‡tu bajt–
01CA 33DB           XOR    BX,BX            ; st©ada‡ bit– p©¡znak–
01CC D1ED           SHR    BP,1             ; dal¨¡ bit p©¡znak–
01CE 4A             DEC    DX               
01CF 74B9           JZ     018A             ; jsou ji‘ v¨echny p©¡znaky - dal¨¡
01D1 D1D3           RCL    BX,1             ; £schova p©¡znaku do BX

; ------ t©et¡ bit p©¡znak–

01D3 D1ED           SHR    BP,1             ; dal¨¡ bit p©¡znak–
01D5 4A             DEC    DX               
01D6 74B8           JZ     0190             ; jsou ji‘ v¨echny p©¡znaky - dal¨¡
01D8 D1D3           RCL    BX,1             ; £schova p©¡znaku do BX
                                            ; stav 0 a‘ 3
; ------ d‚lka 2 nebo 3

01DA 80FB02         CMP    BL,02            ; d‚lka 2 nebo 3
01DD 7328           JNB    0207
                                            ; stav 0 a‘ 1

; ------ ‡trvt˜ bit p©¡znak–

01DF D1ED           SHR    BP,1
01E1 4A             DEC    DX
01E2 74B2           JZ     0196
01E4 D1D3           RCL    BX,1
                                            ; stav 0 a‘ 3

; ------ stav "0" - opakov n¡ 4 bajty

01E6 85DB           TEST   BX,BX
01E8 7418           JZ     0202
                                            ; stav 1 a‘ 3

; ------ p t˜ bit p©¡znak–

01EA D1ED           SHR    BP,1
01EC 4A             DEC    DX
01ED 74AD           JZ     019C
01EF D1D3           RCL    BX,1
                                            ; stav 2 a‘ 7
; ------ stav "2" a‘ "4" - d‚lka 5 a‘ 7

01F1 80FB05         CMP    BL,05            ;
01F4 720C           JB     0202             ; stav 2 a‘ 4 = d‚lka 5 a‘ 7
                                            ; stav 5 a‘ 7
; ------ dal¨¡ bit p©¡znak–

01F6 D1ED           SHR    BP,1
01F8 4A             DEC    DX
01F9 74A7           JZ     01A2
01FB D1D3           RCL    BX,1
                                            ; stav 0ah a‘ 0fh

; ------ stav "0dh" a‘ "0fh" - dlouh‚ opakov n¡

01FD 80FB0C         CMP    BL,0C
0200 777C           JA     027E             ; stav 0dh a‘ 0fh
                                            ; stav 0ah a‘ 0ch - d‚lka 8 a‘ 10

; ------ d‚lka ©etˆzce k opakov n¡

0202 2E8A9F0602     MOV    BL,CS:[BX+0206]  ; d‚lka
0207 87D9           XCHG   BX,CX            ; CX <- d‚lka

; -----------------------------------------------------------------------------
;    vzd lenost opakov n¡
; -----------------------------------------------------------------------------

; ------ d‚lka 2 nebo bit "1" - velmi bl¡zk‚ opakov n¡ - offset HIGH = 0

0209 33DB           XOR    BX,BX            ; BX <- 0
020B 83F902         CMP    CX,+02
020E 742A           JZ     023A
0210 D1ED           SHR    BP,1
0212 4A             DEC    DX
0213 7493           JZ     01A8
0215 7223           JB     023A


0217 D1ED           SHR    BP,1
0219 4A             DEC    DX
021A 7492           JZ     01AE
021C D1D3           RCL    BX,1

021E D1ED           SHR    BP,1
0220 4A             DEC    DX
0221 7491           JZ     01B4
0223 D1D3           RCL    BX,1

0225 D1ED           SHR    BP,1
0227 4A             DEC    DX
0228 7504           JNZ    022E
022A AD             LODSW
022B 95             XCHG   AX,BP
022C B210           MOV    DL,10
022E D1D3           RCL    BX,1

0230 80FB02         CMP    BL,02
0233 7316           JNB    024B

0235 2E8ABF2C02     MOV    BH,CS:[BX+022C]
023A AC             LODSB
023B 8AD8           MOV    BL,AL
023D 56             PUSH   SI
023E 8BF7           MOV    SI,DI
0240 2BF3           SUB    SI,BX
0242 FA             CLI
0243 F3             REPZ
0244 26A4           MOVSB  ES:
0246 FB             STI
0247 5E             POP    SI
0248 E976FF         JMP    01C1

024B D1ED           SHR    BP,1
024D 4A             DEC    DX
024E 7504           JNZ    0254
0250 AD             LODSW
0251 95             XCHG   AX,BP
0252 B210           MOV    DL,10
0254 D1D3           RCL    BX,1
0256 80FB08         CMP    BL,08
0259 72DA           JB     0235

025B D1ED           SHR    BP,1
025D 4A             DEC    DX
025E 7504           JNZ    0264
0260 AD             LODSW
0261 95             XCHG   AX,BP
0262 B210           MOV    DL,10
0264 D1D3           RCL    BX,1
0266 80FB17         CMP    BL,17
0269 72CA           JB     0235

026B D1ED           SHR    BP,1
026D 4A             DEC    DX
026E 7504           JNZ    0274
0270 AD             LODSW
0271 95             XCHG   AX,BP
0272 B210           MOV    DL,10
0274 D1D3           RCL    BX,1
0276 81E3DF00       AND    BX,00DF
027A 86DF           XCHG   BL,BH
027C EBBC           JMP    023A

; ------ stav "0dh" a‘ "0fh"

027E 80E303         AND    BL,03            ; stav "1" a‘ "3"
0281 D1ED           SHR    BP,1
0283 4A             DEC    DX
0284 7504           JNZ    028A
0286 AD             LODSW
0287 95             XCHG   AX,BP
0288 B210           MOV    DL,10
028A D1D3         * RCL    BX,1             ; dal¨¡ bit - stav "2" a‘ "7"

028C 80FB05         CMP    BL,05
028F 7210           JB     02A1             ; stav "2" a‘ "4" - d‚lka 11,12,25
0291 D1ED           SHR    BP,1
0293 4A             DEC    DX
0294 7504           JNZ    029A
0296 AD             LODSW
0297 95             XCHG   AX,BP
0298 B210           MOV    DL,10
029A D1D3         * RCL    BX,1
                                            ; stav "0a"-"0f"
029C 80FB0C         CMP    BL,0C
029F 7745           JA     02E6

02A1 2E8A8F1102   * MOV    CL,CS:[BX+0211]  ; d‚lka
02A6 80F919         CMP    CL,19
02A9 7403           JZ     02AE             ; 25 - velmi dlouh‚ opakov n¡
02AB E95BFF         JMP    0209

02AE AC             LODSB
02AF 02C8           ADD    CL,AL
02B1 80D500         ADC    CH,00
02B4 3CFE           CMP    AL,FE
02B6 7303           JNB    02BB
02B8 E94EFF         JMP    0209

; ------ normalizace adres

02BB 50             PUSH   AX
02BC 8D9D00E0       LEA    BX,[DI+E000]
02C0 83E70F         AND    DI,+0F
02C3 81C70020       ADD    DI,2000
02C7 B104           MOV    CL,04
02C9 D3EB           SHR    BX,CL
02CB 8CC0           MOV    AX,ES
02CD 03C3           ADD    AX,BX
02CF 8EC0           MOV    ES,AX
02D1 8CD8           MOV    AX,DS
02D3 8BDE           MOV    BX,SI
02D5 83E60F         AND    SI,+0F
02D8 D3EB           SHR    BX,CL
02DA 03C3           ADD    AX,BX
02DC 8ED8           MOV    DS,AX
02DE 58             POP    AX

02DF 3CFF           CMP    AL,FF
02E1 7429           JZ     030C             ; konec
02E3 E9DBFE         JMP    01C1

02E6 80E303         AND    BL,03
02E9 D1ED           SHR    BP,1
02EB 4A             DEC    DX
02EC 7504           JNZ    02F2
02EE AD             LODSW
02EF 95             XCHG   AX,BP
02F0 B210           MOV    DL,10
02F2 D1D3           RCL    BX,1
02F4 80FB05         CMP    BL,05
02F7 720B           JB     0304
02F9 D1ED           SHR    BP,1
02FB 4A             DEC    DX
02FC 7504           JNZ    0302
02FE AD             LODSW
02FF 95             XCHG   AX,BP
0300 B210           MOV    DL,10
0302 D1D3           RCL    BX,1
0304 2E8A8F1C02     MOV    CL,CS:[BX+021C]
0309 E9FDFE         JMP    0209

; -----------------------------------------------------------------------------
;                       relokace polo‘ek
; -----------------------------------------------------------------------------

; ------ p©¡prava k relokaci polo‘ek

030C 5B             POP    BX
030D 8BEB           MOV    BP,BX
030F 83C310         ADD    BX,+10

0312 33C0           XOR    AX,AX
0314 AC             LODSB
0315 91             XCHG   AX,CX
0316 E30F           JCXZ   0327
0318 AD             LODSW
0319 03C3           ADD    AX,BX
031B 8EC0           MOV    ES,AX
031D 90             NOP

031E AD             LODSW
031F 97             XCHG   AX,DI
0320 26011D         ADD    ES:[DI],BX
0323 E2F9           LOOP   031E
0325 EBEB           JMP    0312

; -----------------------------------------------------------------------------
;    inicializace registr– a skok do programu
; -----------------------------------------------------------------------------

; ------ inicializace registr– SS:SP a CS:IP

0327 AD             LODSW
0328 03C3           ADD    AX,BX
032A FA             CLI
032B 8ED0           MOV    SS,AX
032D AD             LODSW
032E 8BE0           MOV    SP,AX
0330 FB             STI
0331 AD             LODSW
0332 03D8           ADD    BX,AX
0334 53             PUSH   BX
0335 AD             LODSW
0336 50             PUSH   AX

; ------ inicializace registr–

0337 8EC5           MOV    ES,BP
0339 8EDD           MOV    DS,BP
033B 33C0           XOR    AX,AX
033D 8BD8           MOV    BX,AX
033F 8BC8           MOV    CX,AX
0341 8BD0           MOV    DX,AX
0343 8BE8           MOV    BP,AX
0345 8BF0           MOV    SI,AX
0347 8BF8           MOV    DI,AX
0349 CB             RETF

; ------ tabulka d‚lek (adresa 0206h)

034a                db     4,0              ; 0
                    db     5,6,7,0,0,0,0,0  ; 2,3,4
                    db     8,9,10,11,12     ; 0ah,0bh,0ch,0dh,0eh
                    db     25,0,0,0,0,0     ; 0fh
                    db     13,14,15,16,17,18,0,0,0,0,0 ; 15h,16h,17h,18h,19h,1ah
                    db     19,20,21,22,23,24 ; 20h,21h,22h,23h,24h,25h

0370                db     1,2,0,0
                    db     3,4,5,6,0,0,0,0,0,0,0,0
                    db     7,8,9,10,11,12,13,0,0,0,0,0,0,0,0,0

0390           **** dw     24fbh            ; (adresa 3EC0h)
                    db     14 dup(0)

; -----------------------------------------------------------------------------
;    datov˜ segment 24FB
; -----------------------------------------------------------------------------

;þ

; Chybov  hl ¨en¡
                                            ; 1 n povˆda
                                            ; 2 "Ext. mus¡ b˜t EXE nebo COM"
                                            ; 3 ???
                                            ; 4 ???
                                            ; 5 "Chyba z pisu"
                                            ; 6 "Disk pln˜"
                                            ; 7 "Chyba ‡ten¡"
                                            ; 8 ???
                                            ; 9 "Nedostatek pamˆti"
                                            ; 0Ah "Nelze kompr. s m do sebe"
                                            ; 0bh "P©¡li¨ mnoho polo‘ek EXE"
                                            ; 0ch "Nen¡ rozbal. k¢d v souboru"
                                            ; 0dh "Chyba v kompres. datech"
                                            ; 0eh "Kompr. v¡ce soub. do jednoho"
                                            ; 0fh "V˜stup nesm¡ b˜t * a ?"

0000  45 72 72 6F 72 20 2D 20-00 46 69 6C 65 20 65 78  Error - .File ex
0010  74 65 6E 73 69 6F 6E 20-6D 75 73 74 20 62 65 20  tension must be
0020  45 58 45 20 6F 72 20 43-4F 4D 00 57 72 69 74 69  EXE or COM.Writi
0030  6E 67 20 66 69 6C 65 00-44 69 73 6B 20 66 75 6C  ng file.Disk ful
0040  6C 00 52 65 61 64 69 6E-67 20 66 69 6C 65 00 4E  l.Reading file.N
0050  6F 74 20 65 6E 6F 75 67-68 20 6D 65 6D 6F 72 79  ot enough memory
0060  00 43 61 6E 6E 6F 74 20-63 6F 6D 70 72 65 73 73  .Cannot compress
0070  20 66 69 6C 65 20 69 6E-74 6F 20 69 74 73 65 6C   file into itsel
0080  66 00 45 58 45 20 68 65-61 64 65 72 20 68 61 73  f.EXE header has
0090  20 74 6F 6F 20 6D 61 6E-79 20 69 74 65 6D 73 00   too many items.
00A0  4E 6F 20 65 78 74 72 61-63 74 20 63 6F 64 65 20  No extract code
00B0  66 6F 75 6E 64 20 69 6E-20 66 69 6C 65 00 45 72  found in file.Er
00C0  72 6F 72 20 69 6E 20 63-6F 6D 70 72 65 73 73 65  ror in compresse
00D0  64 20 64 61 74 61 00 43-6F 6D 70 72 65 73 73 69  d data.Compressi
00E0  6E 67 20 6D 61 6E 79 20-66 69 6C 65 73 20 69 6E  ng many files in
00F0  74 6F 20 6F 6E 65 20 66-69 6C 65 00 4F 75 74 70  to one file.Outp
0100  75 74 20 70 61 74 68 2F-66 69 6C 65 20 6D 75 73  ut path/file mus
0110  74 20 6E 6F 74 20 63 6F-6E 74 61 69 6E 20 27 2A  t not contain '*
0120  27 20 6F 72 20 27 3F 27-00 00 00 00 00 00 00 00  ' or '?'........
0130  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0140  00 00 00 00 00 00 00 00-00 00 00 00 00 00 4D 5A  ..............MZ

0129                db     0                ; typ souboru 1=COM, 0=EXE
012A
012B                db     0                ; p©¡znak param."/O"-p©epsat v˜stup
012C                db     0                ; p©¡znak param."/U"-syst. datum/‡as
012D                db     0                ; 0=komprese, 1=expanze

012E                db     0                ; p©¡znak param. "/B" - z lohy BAK
012F                db     0                ;
0130                db     0                ; p©¡znak param. "/R" - zru¨it over.
0131                db     0                ; 0=overlay s potvrzen¡m
                                            ; 1="/A" komprese overlay v‘dy
                                            ; 2="/N" komprese overlay nikdy
0132                db     0                ; p©¡znak param. "/X" - rozbalen¡

0134                db     0                ; p©¡znak param. "/L" - zobr.licence
0136                dw     0                ; adresa jm‚na vstup. souboru
0138                dw     0                ; adresa jm‚na v˜stup. souboru

013A                dd     0                ; adresa rota‡n¡ho bufferu (16.5 KB)
013E                dd     0                ; adresa z pisov‚ho (vstup.) bufferu

0142                dd                      ; adresa kruhov‚ho bufferu

0146                dw     0                ; identifik. zdrojov‚ho souboru
0148                dw     0                ; identifik. v˜stupn¡ho souboru

0150  00 00 00 00 01 00 06 00-0F 00 FF FF F0 FF 00 02  ............p...

0156                dw     6

0160  00 00 00 01 F0 FF 52 00-00 00 0C 01 50 4B 4C 49  ....p.R.....PKLI

016b                db     1                ; p©ep¡na‡e souboru EXE
                                            ;  bit 5: 1=velk˜ soubor

0170  54 45 20 43 6F 70 72 2E-20 31 39 39 30 2D 39 31  TE Copr. 1990-91
0180  20 50 4B 57 41 52 45 20-49 6E 63 2E 20 41 6C 6C   PKWARE Inc. All
0190  20 52 69 67 68 74 73 20-52 65 73 65 72 76 65 64   Rights Reserved
01A0  07 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
01B0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
01C0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
01D0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
01E0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
01F0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0200  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0210  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0220  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0230  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0240  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0250  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0260  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0270  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0280  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0290  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
02A0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
02B0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
02C0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
02D0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
02E0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
02F0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0300  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0310  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0320  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0330  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0340  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0350  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0360  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0370  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0380  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0390  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
03A0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
03B0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
03C0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
03D0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
03E0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
03F0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0400  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0410  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0420  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0430  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0440  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0450  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................

046c                db                      ; informace o registraci
0460  00 00 00 00 00 00 00 00-00 00 00 00 0D 0A 49 66  ..............If
0470  20 79 6F 75 20 66 69 6E-64 20 50 4B 4C 49 54 45   you find PKLITE
0480  20 65 61 73 79 20 61 6E-64 20 63 6F 6E 76 65 6E   easy and conven
0490  69 65 6E 74 20 74 6F 20-75 73 65 2C 20 61 20 72  ient to use, a r
04A0  65 67 69 73 74 72 61 74-69 6F 6E 20 6F 66 20 24  egistration of $
04B0  34 36 2E 30 30 0D 0A 77-6F 75 6C 64 20 62 65 20  46.00..would be
04C0  61 70 70 72 65 63 69 61-74 65 64 2E 20 20 52 65  appreciated.  Re
04D0  67 69 73 74 72 61 74 69-6F 6E 20 69 6E 63 6C 75  gistration inclu
04E0  64 65 73 20 6F 6E 65 20-66 72 65 65 20 75 70 67  des one free upg
04F0  72 61 64 65 20 74 6F 20-74 68 65 0D 0A 73 6F 66  rade to the..sof
0500  74 77 61 72 65 20 61 6E-64 20 61 20 70 72 69 6E  tware and a prin
0510  74 65 64 20 6D 61 6E 75-61 6C 2E 20 20 50 6C 65  ted manual.  Ple
0520  61 73 65 20 73 74 61 74-65 20 74 68 65 20 76 65  ase state the ve
0530  72 73 69 6F 6E 20 6F 66-20 74 68 65 20 73 6F 66  rsion of the sof
0540  74 77 61 72 65 0D 0A 74-68 61 74 20 79 6F 75 20  tware..that you
0550  63 75 72 72 65 6E 74 6C-79 20 68 61 76 65 2E 20  currently have.
0560  20 53 65 6E 64 20 63 68-65 63 6B 20 6F 72 20 6D   Send check or m
0570  6F 6E 65 79 20 6F 72 64-65 72 20 74 6F 3A 0D 0A  oney order to:..
0580  20 20 20 20 20 20 20 20-20 20 20 20 20 20 20 20
0590  20 20 20 20 20 20 20 50-4B 57 41 52 45 2C 20 49         PKWARE, I
05A0  6E 63 2E 0D 0A 20 20 20-20 20 20 20 20 20 20 20  nc...
05B0  20 20 20 20 20 20 20 20-20 20 20 20 39 30 32 35              9025
05C0  20 4E 2E 20 44 65 65 72-77 6F 6F 64 20 44 72 69   N. Deerwood Dri
05D0  76 65 0D 0A 20 20 20 20-20 20 20 20 20 20 20 20  ve..
05E0  20 20 20 20 20 20 20 20-20 20 20 42 72 6F 77 6E             Brown
05F0  20 44 65 65 72 2C 20 57-49 20 35 33 32 32 33 00   Deer, WI 53223.

0600                db                      ; text n povˆdy
0600  55 73 61 67 65 3A 20 50-4B 4C 49 54 45 20 5B 6F  Usage: PKLITE [o
0610  70 74 69 6F 6E 73 5D 20-5B 64 3A 5D 5B 2F 70 61  ptions] [d:][/pa
0620  74 68 5D 49 6E 66 69 6C-65 20 5B 5B 64 3A 5D 5B  th]Infile [[d:][
0630  2F 70 61 74 68 5D 4F 75-74 66 69 6C 65 5D 0D 0A  /path]Outfile]..
0640  4F 70 74 69 6F 6E 73 20-61 72 65 3A 0D 0A 20 20  Options are:..
0650  2D 61 20 3D 20 61 6C 77-61 79 73 20 63 6F 6D 70  -a = always comp
0660  72 65 73 73 20 66 69 6C-65 73 20 77 69 74 68 20  ress files with
0670  6F 76 65 72 6C 61 79 73-20 61 6E 64 20 6F 70 74  overlays and opt
0680  69 6D 69 7A 65 20 72 65-6C 6F 63 61 74 69 6F 6E  imize relocation
0690  73 0D 0A 20 20 2D 62 20-3D 20 6D 61 6B 65 20 62  s..  -b = make b
06A0  61 63 6B 75 70 20 2E 42-41 4B 20 66 69 6C 65 20  ackup .BAK file
06B0  6F 66 20 6F 72 69 67 69-6E 61 6C 0D 0A 20 20 2D  of original..  -
06C0  65 20 3D 20 6D 61 6B 65-20 63 6F 6D 70 72 65 73  e = make compres
06D0  73 65 64 20 66 69 6C 65-20 75 6E 65 78 74 72 61  sed file unextra
06E0  63 74 61 62 6C 65 20 28-2A 20 63 6F 6D 6D 65 72  ctable (* commer
06F0  63 69 61 6C 20 76 65 72-73 69 6F 6E 20 6F 6E 6C  cial version onl
0700  79 20 2A 29 0D 0A 20 20-2D 6C 20 3D 20 64 69 73  y *)..  -l = dis
0710  70 6C 61 79 20 73 6F 66-74 77 61 72 65 20 6C 69  play software li
0720  63 65 6E 73 65 20 73 63-72 65 65 6E 0D 0A 20 20  cense screen..
0730  2D 6E 20 3D 20 6E 65 76-65 72 20 63 6F 6D 70 72  -n = never compr
0740  65 73 73 20 66 69 6C 65-73 20 77 69 74 68 20 6F  ess files with o
0750  76 65 72 6C 61 79 73 20-6F 72 20 6F 70 74 69 6D  verlays or optim
0760  69 7A 65 20 72 65 6C 6F-63 61 74 69 6F 6E 73 0D  ize relocations.
0770  0A 20 20 2D 6F 20 3D 20-6F 76 65 72 77 72 69 74  .  -o = overwrit
0780  65 20 6F 75 74 70 75 74-20 66 69 6C 65 20 69 66  e output file if
0790  20 69 74 20 65 78 69 73-74 73 0D 0A 20 20 2D 72   it exists..  -r
07A0  20 3D 20 72 65 6D 6F 76-65 20 6F 76 65 72 6C 61   = remove overla
07B0  79 20 64 61 74 61 0D 0A-20 20 2D 75 20 3D 20 75  y data..  -u = u
07C0  70 64 61 74 65 20 66 69-6C 65 20 74 69 6D 65 2F  pdate file time/
07D0  64 61 74 65 20 74 6F 20-63 75 72 72 65 6E 74 20  date to current
07E0  74 69 6D 65 2F 64 61 74-65 0D 0A 20 20 2D 78 20  time/date..  -x
07F0  3D 20 65 78 70 61 6E 64-20 61 20 63 6F 6D 70 72  = expand a compr
0800  65 73 73 65 64 20 66 69-6C 65 0D 0A 0D 0A 28 2A  essed file....(*
0810  29 20 53 65 65 20 64 6F-63 75 6D 65 6E 74 61 74  ) See documentat
0820  69 6F 6E 20 61 6E 64 20-6C 69 63 65 6E 73 65 20  ion and license
0830  73 63 72 65 65 6E 20 66-6F 72 20 6D 6F 72 65 20  screen for more
0840  69 6E 66 6F 72 6D 61 74-69 6F 6E 00 59 6F 75 20  information.You

084C                db                      ; licen‡n¡ text

0850  61 72 65 20 66 72 65 65-20 74 6F 20 75 73 65 2C  are free to use,
0860  20 63 6F 70 79 20 61 6E-64 20 64 69 73 74 72 69   copy and distri
0870  62 75 74 65 20 50 4B 4C-49 54 45 20 66 6F 72 20  bute PKLITE for
0880  6E 6F 6E 63 6F 6D 6D 65-72 63 69 61 6C 20 75 73  noncommercial us
0890  65 20 49 46 3A 0D 0A 20-20 20 20 20 20 20 20 4E  e IF:..        N
08A0  4F 20 46 45 45 20 49 53-20 43 48 41 52 47 45 44  O FEE IS CHARGED
08B0  20 46 4F 52 20 55 53 45-2C 20 43 4F 50 59 49 4E   FOR USE, COPYIN
08C0  47 20 4F 52 20 44 49 53-54 52 49 42 55 54 49 4F  G OR DISTRIBUTIO
08D0  4E 2E 0D 0A 20 20 20 20-20 20 20 20 49 54 20 49  N...        IT I
08E0  53 20 4E 4F 54 20 4D 4F-44 49 46 49 45 44 20 49  S NOT MODIFIED I
08F0  4E 20 41 4E 59 20 57 41-59 2E 0D 0A 0D 0A 55 73  N ANY WAY.....Us
0900  61 67 65 20 6F 66 20 74-68 65 20 73 6F 66 74 77  age of the softw
0910  61 72 65 20 74 6F 20 63-72 65 61 74 65 20 63 6F  are to create co
0920  6D 70 72 65 73 73 65 64-20 65 78 65 63 75 74 61  mpressed executa
0930  62 6C 65 73 20 66 6F 72-20 63 6F 6D 6D 65 72 63  bles for commerc
0940  69 61 6C 0D 0A 73 6F 66-74 77 61 72 65 20 72 65  ial..software re
0950  71 75 69 72 65 73 20 72-65 67 69 73 74 72 61 74  quires registrat
0960  69 6F 6E 20 6F 66 20 74-68 65 20 50 4B 4C 49 54  ion of the PKLIT
0970  45 20 50 72 6F 66 65 73-73 69 6F 6E 61 6C 20 50  E Professional P
0980  61 63 6B 61 67 65 20 28-74 6D 29 0D 0A 66 6F 72  ackage (tm)..for
0990  20 24 31 34 36 2E 20 20-54 68 69 73 20 76 65 72   $146.  This ver
09A0  73 69 6F 6E 20 69 6E 63-6C 75 64 65 73 20 61 6E  sion includes an
09B0  20 65 78 74 72 61 20 63-6F 6D 70 72 65 73 73 69   extra compressi
09C0  6F 6E 20 6F 70 74 69 6F-6E 20 73 6F 20 74 68 61  on option so tha
09D0  74 0D 0A 63 6F 6D 70 72-65 73 73 65 64 20 65 78  t..compressed ex
09E0  65 63 75 74 61 62 6C 65-73 20 63 61 6E 6E 6F 74  ecutables cannot
09F0  20 62 65 20 75 6E 63 6F-6D 70 72 65 73 73 65 64   be uncompressed
0A00  20 62 79 20 50 4B 4C 49-54 45 2E 0D 0A 0D 0A 50   by PKLITE.....P
0A10  4B 57 41 52 45 20 64 69-73 63 6C 61 69 6D 73 20  KWARE disclaims
0A20  61 6C 6C 20 77 61 72 72-61 6E 74 69 65 73 20 61  all warranties a
0A30  73 20 74 6F 20 74 68 69-73 20 73 6F 66 74 77 61  s to this softwa
0A40  72 65 2C 20 77 68 65 74-68 65 72 20 65 78 70 72  re, whether expr
0A50  65 73 73 20 6F 72 0D 0A-69 6D 70 6C 69 65 64 2C  ess or..implied,
0A60  20 69 6E 63 6C 75 64 69-6E 67 20 77 69 74 68 6F   including witho
0A70  75 74 20 6C 69 6D 69 74-61 74 69 6F 6E 20 61 6E  ut limitation an
0A80  79 20 69 6D 70 6C 69 65-64 20 77 61 72 72 61 6E  y implied warran
0A90  74 69 65 73 20 6F 66 20-6D 65 72 63 68 61 6E 74  ties of merchant
0AA0  2D 0D 0A 61 62 69 6C 69-74 79 2C 20 66 69 74 6E  -..ability, fitn
0AB0  65 73 73 20 66 6F 72 20-61 20 70 61 72 74 69 63  ess for a partic
0AC0  75 6C 61 72 20 70 75 72-70 6F 73 65 2C 20 66 75  ular purpose, fu
0AD0  6E 63 74 69 6F 6E 61 6C-69 74 79 20 6F 72 20 64  nctionality or d
0AE0  61 74 61 20 69 6E 74 65-67 72 69 74 79 0D 0A 6F  ata integrity..o
0AF0  72 20 70 72 6F 74 65 63-74 69 6F 6E 2E 20 20 53  r protection.  S
0B00  65 65 20 64 6F 63 75 6D-65 6E 74 61 74 69 6F 6E  ee documentation
0B10  20 66 6F 72 20 66 75 72-74 68 65 72 20 64 69 73   for further dis
0B20  63 6C 61 69 6D 65 72 73-20 61 6E 64 20 69 6E 66  claimers and inf

0B3A                db     '                ; licen‡n¡ text
0B30  6F 72 6D 61 74 69 6F 6E-2E 00 50 4B 4C 49 54 45  ormation..PKLITE
0B40  20 28 74 6D 29 20 20 20-45 78 65 63 75 74 61 62   (tm)   Executab
0B50  6C 65 20 46 69 6C 65 20-43 6F 6D 70 72 65 73 73  le File Compress
0B60  6F 72 20 20 20 56 65 72-73 69 6F 6E 20 31 2E 31  or   Version 1.1
0B70  32 20 20 20 20 36 2D 31-35 2D 39 31 0D 0A 43 6F  2    6-15-91..Co
0B80  70 79 72 69 67 68 74 20-31 39 39 30 2D 31 39 39  pyright 1990-199
0B90  31 20 50 4B 57 41 52 45-20 49 6E 63 2E 20 20 41  1 PKWARE Inc.  A
0BA0  6C 6C 20 52 69 67 68 74-73 20 52 65 73 65 72 76  ll Rights Reserv
0BB0  65 64 2E 20 20 50 61 74-65 6E 74 20 50 65 6E 64  ed.  Patent Pend
0BC0  69 6E 67 0D 0A 00 42 41-4B 00 2A 3F 00 4E 6F 20  ing...BAK.*?.No



0BD0  66 69 6C 65 73 20 66 6F-75 6E 64 3A 20 00 43 6F  files found: .Co
0BE0  75 6C 64 20 6E 6F 74 20-6F 70 65 6E 20 66 69 6C  uld not open fil
0BF0  65 3A 20 00 2E 45 58 45-00 2E 43 4F 4D 00 2E 45  e: ..EXE..COM..E
0C00  58 45 00 43 4F 4D 00 45-58 45 00 45 58 45 00 43  XE.COM.EXE.EXE.C
0C10  4F 4D 00 43 4F 4D 00 45-58 45 00 43 4F 4D 00 45  OM.COM.EXE.COM.E
0C20  58 45 00 43 4F 3F 00 43-4F 2A 00 43 4F 4D 00 45  XE.CO?.CO*.COM.E
0C30  58 3F 00 45 58 2A 00 45-58 45 00 43 4F 4D 00 45  X?.EX*.EXE.COM.E
0C40  58 45 00 46 69 6C 65 3A-20 00 69 73 20 6E 6F 74  XE.File: .is not
0C50  20 63 6F 6D 70 72 65 73-73 65 64 00 63 6F 75 6C   compressed.coul
0C60  64 20 6E 6F 74 20 62 65-20 63 6F 6D 70 72 65 73  d not be compres
0C70  73 65 64 00 69 73 20 27-52 65 61 64 2D 4F 6E 6C  sed.is 'Read-Onl
0C80  79 27 2C 20 73 6B 69 70-70 69 6E 67 20 66 69 6C  y', skipping fil
0C90  65 00 63 6F 75 6C 64 20-6E 6F 74 20 62 65 20 6F  e.could not be o
0CA0  70 65 6E 65 64 00 69 73-20 61 20 57 69 6E 64 6F  pened.is a Windo
0CB0  77 73 20 6F 72 20 4F 53-2F 32 20 70 72 6F 67 72  ws or OS/2 progr
0CC0  61 6D 20 61 6E 64 20 63-61 6E 6E 6F 74 20 62 65  am and cannot be
0CD0  20 63 6F 6D 70 72 65 73-73 65 64 00 6C 6F 61 64   compressed.load
0CE0  73 20 69 6E 74 6F 20 68-69 67 68 20 6D 65 6D 6F  s into high memo
0CF0  72 79 20 61 6E 64 20 63-61 6E 6E 6F 74 20 62 65  ry and cannot be
0D00  20 63 6F 6D 70 72 65 73-73 65 64 00 6D 61 79 20   compressed.may
0D10  63 6F 6E 74 61 69 6E 20-6F 76 65 72 6C 61 79 73  contain overlays
0D20  2C 20 66 69 6C 65 20 6E-6F 74 20 63 6F 6D 70 72  , file not compr
0D30  65 73 73 65 64 00 46 69-6C 65 3A 20 00 20 6D 61  essed.File: . ma
0D40  79 20 63 6F 6E 74 61 69-6E 20 6F 76 65 72 6C 61  y contain overla
0D50  79 73 2E 20 20 43 6F 6D-70 72 65 73 73 20 28 79  ys.  Compress (y
0D60  2F 6E 29 3F 20 00 63 6F-75 6C 64 20 6E 6F 74 20  /n)? .could not
0D70  62 65 20 63 6F 6D 70 72-65 73 73 65 64 00 69 73  be compressed.is
0D80  20 61 6C 72 65 61 64 79-20 63 6F 6D 70 72 65 73   already compres
0D90  73 65 64 00 69 73 20 6E-6F 74 20 63 6F 6D 70 72  sed.is not compr
0DA0  65 73 73 65 64 00 63 61-6E 6E 6F 74 20 62 65 20  essed.cannot be
0DB0  65 78 70 61 6E 64 65 64-00 63 61 6E 6E 6F 74 20  expanded.cannot
0DC0  62 65 20 65 78 70 61 6E-64 65 64 2C 20 69 6E 63  be expanded, inc
0DD0  6F 72 72 65 63 74 20 76-65 72 73 69 6F 6E 00 2F  orrect version./
0DE0  00 2E 43 4F 4D 00 2E 45-58 45 00 50 4B 54 4D 50  ..COM..EXE.PKTMP
0DF0  24 24 24 2E 24 24 24 00-46 69 6C 65 3A 20 00 20  $$$.$$$.File: .
0E00  61 6C 72 65 61 64 79 20-65 78 69 73 74 73 2E 20  already exists.
0E10  20 4F 76 65 72 77 72 69-74 65 20 28 79 2F 6E 29   Overwrite (y/n)
0E20  3F 20 00 43 6F 75 6C 64-20 6E 6F 74 20 63 72 65  ? .Could not cre
0E30  61 74 65 20 66 69 6C 65-3A 20 00 63 6F 75 6C 64  ate file: .could
0E40  20 6E 6F 74 20 62 65 20-6F 70 65 6E 65 64 00 45   not be opened.E
0E50  78 70 61 6E 64 69 6E 67-3A 20 00 43 6F 6D 70 72  xpanding: .Compr
0E60  65 73 73 69 6E 67 3A 20-00 20 69 6E 74 6F 20 66  essing: . into f
0E70  69 6C 65 20 00 20 20 00-00 00 4F 72 69 67 69 6E  ile .  ...Origin
0E80  61 6C 20 53 69 7A 65 3A-20 00 20 20 45 78 70 61  al Size: .  Expa
0E90  6E 64 65 64 20 53 69 7A-65 3A 20 00 20 20 43 6F  nded Size: .  Co
0EA0  6D 70 72 65 73 73 65 64-20 53 69 7A 65 3A 20 00  mpressed Size: .
0EB0  20 20 52 61 74 69 6F 3A-20 00 52 65 61 72 72 61    Ratio: .Rearra
0EC0  6E 67 69 6E 67 20 72 65-6C 6F 63 61 74 69 6F 6E  nging relocation
0ED0  20 64 61 74 61 20 66 6F-72 20 62 65 74 74 65 72   data for better
0EE0  20 63 6F 6D 70 72 65 73-73 69 6F 6E 00 55 6E 6F   compression.Uno
0EF0  70 74 69 6D 61 6C 20 72-65 6C 6F 63 61 74 69 6F  ptimal relocatio
0F00  6E 20 64 61 74 61 20 64-65 74 65 63 74 65 64 2C  n data detected,
0F10  20 72 65 61 72 72 61 6E-67 65 20 66 6F 72 20 62   rearrange for b
0F20  65 74 74 65 72 20 63 6F-6D 70 72 65 73 73 69 6F  etter compressio
0F30  6E 20 28 79 2F 6E 29 3F-20 00 0D 0A 0D 0A 46 69  n (y/n)? .....Fi
0F40  6C 65 20 63 6F 75 6C 64-20 6E 6F 74 20 62 65 20  le could not be
0F50  63 6F 6D 70 72 65 73 73-65 64 00 00 28 12 03 02  compressed..(...

0F5C                dw     1228h            ; adresa vyrovn vac¡ho bufferu

; ------ tabulky pro vysl n¡ d‚lek ©etˆzce - mal˜ soubor

                                          ;* tabulka d‚lek k¢d–
0F5E                db     3                ; 2
                    db     2                ; 3
                    db     3,3              ; 4,5
                    db     4,4,4,4          ; 6,7,8,9
                    db     3                ; 10 a v¡ce
                    db     0

                                          ;* tabulka dat k¢d–
0f68                dw     2                ; 2
                    dw     0                ; 3
                    dw     1,5              ; 4,5
                    dw     3,0bh,7,0fh      ; 6,7,8,9
                    dw     6                ; 10 a v¡ce
                    dw     0

0F60  03 03 04 04 04 04 03 00-02 00 00 00 01 00 05 00  ................
0F70  03 00 0B 00 07 00 0F 00-06 00 02 02 03 04 04 04  ................

; ------ tabulky pro vysl n¡ d‚lek ©etˆzce - velk˜ soubor

                                          ;* tabulka d‚lek k¢d–
0f7a                db     2,2              ; 2,3
                    db     3                ; 4
                    db     4,4,4            ; 5,6,7
                    db     5,5,5            ; 8,9,10
                    db     6,6              ; 11,12
                    db     7,7,7            ; 13,14,15
                    db     8,8,8            ; 16,17,18
                    db     9,9,9,9,9,9      ; 19,20,21,22,23,24
                    db     6                ; 25 a v¡ce

                                          ;* tabulka dat k¢d–
0f92                dw     1,3              ; 2,3
                    dw     0                ; 4
                    dw     4,0ch,2          ; 5,6,7
                    dw     0ah,1ah,6        ; 8,9,10
                    dw     16h,36h          ; 11,12
                    dw     2eh,6eh,1eh      ; 13,14,15
                    dw     5eh,0deh,3eh     ; 16,17,18
                    dw     0beh,1beh,7eh,17eh,0feh,1feh ; 19,20,21,22,23,24
                    dw     0eh              ; 25 a v¡ce

; ------ tabulky pro vysl n¡ offsetu ©etˆzce

                                          ;* tabulka po‡tu bit– k z pisu
0FC2                db     1                ; 0
                    db     4,4              ; 1,2
                    db     5,5,5,5          ; 3,4,5,6
                    db     6,6,6,6,6,6,6    ; 7,8,9,0ah,0bh,0ch,0dh
                    db     7,7,7,7,7,7      ; 0eh a‘ 1fh
                    db     7,7,7,7,7,7
                    db     7,7,7,7,7,7

                                          ;* tabulka bit– k z pisu
0FE2                db     1                ; 0
                    db     0,8              ; 1,2
                    db     4,14h,0ch,1ch    ; 3,4,5,6
                    db     2,22h,12h,32h,0ah,2ah,1ah ; 7,8,9,0ah,0bh,0ch,0dh
                    db     3ah,7ah,6,46h,26h,66h ; 0eh a‘ 1fh
                    db     16h,56h,36h,76h,0eh,4eh
                    db     2eh,6eh,1eh,5eh,3eh,7eh

0FD0  07 07 07 07 07 07 07 07-07 07 07 07 07 07 07 07  ................
0FE0  07 07 01 00 08 04 14 0C-1C 02 22 12 32 0A 2A 1A  ..........".2.*.
0FF0  3A 7A 06 46 26 66 16 56-36 76 0E 4E 2E 6E 1E 5E  :z.F&f.V6v.N.n.^

1000  3E 7E 01 02 00 00 03 04-05 06 00 00 00 00 00 00  >~..............
1010  00 00 07 08 09 0A 0B 0C-0D 4D 5A 00 04 00 05 06  .........MZ.....

1019                db     'MZ'             ; identifik tor EXE

1020  07 00 00 00 00 00 08 09-0A 00 0B 0C 19 00 00 00  ................
1030  00 00 0D 0E 0F 00 10 11-12 00 00 00 00 00 13 14  ................
1040  15 16 17 18 03 00 02 0A-04 05 00 00 00 00 00 00  ................
1050  06 07 08 09 20 20 20 00-08 08 08 20 20 20 00 00  ....   ....   ..
1060  08 08 08 00 00 25 00 00-00 00 0D 0A 00 00 87 2A  .....%.........*

106A                db     13,10,0          ; od© dkov n¡

1070  00 00 00 00 05 00 00 00-00 00 00 00 00 00 00 00  ................
1080  00 00 00 00 00 00 00 00-00 00 5F 43 5F 46 49 4C  .........._C_FIL

108A                db     '_C_FILE_INFO='  ; parametr v prost©ed¡

1098                dd     0                ; £schova INT 00

1090  45 5F 49 4E 46 4F 3D 00-00 00 00 00 00 00 00 00  E_INFO=.........
10A0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................

10AC                dw     0                ; £schova PSP
10AE                dw     0                ; verze syst‚mu

10B1                db     0                ; k¢d chyby operace se souborem

10B5                db     4 dup(0)         ; buffer parametr– soubor–

10B0  00 00 00 14 00 81 81 81-01 01 00 00 00 00 00 00  ................
10C0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 D3  ...............S
10D0  10 FB 24 00 00 00 00 00-00 00 00 00 FF FF 00 00  .{$.............

10C9                dw     0                ; po‡et parametr– p©¡kaz. © dku

10CF                dd    24fb:10D3         ; adresa jm‚na programu (v prost©ed¡)

10D3                db     0

10D4                db     0

10DE                db     6*4 dup(0)       ; buffer £schovy adres p©eru¨en¡

10E0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
10F0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 16  ................

10FC                dw     0                ; £schova n vratov‚ adresy

1100  02 02 18 0D 09 0C 0C 0C-07 08 16 16 FF 02 0D 12  ................
1110  02 FF 00 00 00 00 00 00-00 00 00 00 00 00 03 00  ................

1114                dw     0

1120  00 20 80 30 80 30 80 30-80 30 80 30 80 30 00 00  . .0.0.0.0.0.0..

112e                dd     0                ; £schova INT 23h

1130  00 00 00 00 00 00 00 00-7F 29 7F 29 7F 29 00 00  .........).).)..

1136                dw     0
1138                dw     297f             ; adresa



1140  00 00 FA 24 00 00 00 00-00 00 00 00 00 00 00 00  ..z$............
1150  00 00 3C 3C 4E 4D 53 47-3E 3E 00 00 52 36 30 30  ..<<NMSG>>..R600

; ------ chybov  hl ¨en¡

115A                dw     0
                    db     'R6000',13,10
                    db     '- stack overflow',13,10,0
1176                dw     3
                    db     'R6003',13,10
                    db     '- integer divide by 0',13,10,0
1197                dw     9
                    db     'R6009',13,10
                    db     '- not enough space for environment',13,10,0
11c5                dw     0fch
                    db     13,10,0
11ca                dw     0ffh
                    db     'run-time error ',0
11dc                dw     2
                    db     'R6002',13,10
                    db     '- floating-point support not loaded',13,10,0
120b                dw     0ffffh
                    db     0ffh

; -----------------------------------------------------------------------------
;    buffery
; -----------------------------------------------------------------------------

120E                dw     0                ;
1210                dw     2                ; po‡et bajt– ve vyrovn vac¡m buff.
1212                db     18h (9)          ; max. d‚lka pro kr tk˜ k¢d
1214                dw     0                ; po‡et zbyl˜ch bajt– ve vstup.buff.
1216                dw     10h              ; ‡¡ta‡ zb˜vaj¡c¡ch bit– k v˜stupu

1218                dw     0f92h (0f68h)    ; adresa tabulky dat k¢d– d‚lky
121A                dw     0f7ah (0f5eh)    ; adresa tabulky d‚lek k¢d– d‚lky

1222                db     0                ; p©¡znak konce souboru
1224                dd                      ; ukl dac¡ adresa v˜stupn¡ho bufferu
1228                db                      ; vyrovn vac¡ buffer v˜stupu souboru

125a                dd                      ; ukl dac¡ adresa v kruhov‚m bufferu

1266                dw     900h dup(?)      ; buffer index– ©etˆzc–


2466
2468                dd     0                ; velikost vstupn¡ho souboru
246C                dw     0115h (0106h)    ; maxim ln¡ d‚lka ©etˆzce

246e                                        ; buffer vstupn¡ho souboru

24e6                dw     4200h dup(?)     ; buffer adres ©etˆzc–

A8E6                db     0f0h dup(?)      ; buffer v˜stupn¡ho souboru

A9D6                dw                      ; offset nalezen‚ho ©etˆzce
A9D8                dw                      ; 6
A9DA                dw                      ; velikost bloku ke ‡ten¡
A9DC                dw     0                ;
A9DE                dw     0                ;

; ------ z hlav¡ EXE v˜stupn¡ho souboru

A9E0                db     'MZ'             ; identifik tor z hlav¡ EXE
                                            ; (nebo d‚lka zavadˆ‡e COM)
A9E2                dw                      ; d‚lka posledn¡ str nky souboru EXE
A9E4                dw                      ; d‚lka souboru ve str nk ch 512 B
A9E6                dw                      ; po‡et polo‘ek relok. tabulky
A9E8                dw                      ; velikost z hlav¡ v odstavc¡ch 16 B
A9EA                dw                      ; minimum pamˆti
A9EC                dw                      ; maximum pamˆti
A9EE                dw                      ; offset SS
A9F0                dw                      ; offset SP
A9F2                dw                      ; kontroln¡ sou‡et
A9F4                dw                      ; offset IP
A9F6                dw                      ; offset CS
A9F8                dw                      ; offset 1. polo‘ky relok. tabulky
A9FA                dw                      ; po‡et OVL

A9FC                dd                      ; p–vodn¡ velikost souboru

AA00                dd                      ; ‡¡ta‡ dat ke ‡ten¡ ze souboru
AA04                db                      ; 0=zmˆnˆno jm‚no souboru
AA05                db                      ; znak oddˆlova‡e parametr–
AA08                dw                      ; velikost z pisov‚ho bufferu

AA10                                        ; konec datov‚ho bufferu

; za SP - buffer parametr–

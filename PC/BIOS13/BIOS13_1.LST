CONTEXT   0  87   0   3  72




                       ûadiá pevnÇho disku AT (NEC uPD765)
                       ÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕ
    ûadiá  pevnÇho  disku AT generuje po kaëdÇ operaci (áten°, z†pis, vystaven°)
p©eru®en°  IRQ 14. IRQ 14 je nastaveno na vektor p©eru®en° INT 76h, pro kterÇ je
akán° bit nastaven na adrese 0040:008eh.


Typy pevnòch diskñ (definovanÇ v CMOS):
ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ
…ÕÕÕÕÕÕÕ—ÕÕÕÕÕÕÕÕÕÕ—ÕÕÕÕÕÕÕ—ÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕ—ÕÕÕÕÕÕÕÕÕÕÕÕÕ—ÕÕÕÕÕÕÕÕÕÕÕª
∫  typ  ≥  v†lcñ   ≥  hlav ≥ p©edkompenzace  ≥ p©ist†vac°  ≥ kapacita  ∫
∫       ≥          ≥       ≥z†pisu (od stopy)≥    z¢na     ≥           ∫
ÃÕÕÕÕÕÕÕÿÕÕÕÕÕÕÕÕÕÕÿÕÕÕÕÕÕÕÿÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÿÕÕÕÕÕÕÕÕÕÕÕÕÕÿÕÕÕÕÕÕÕÕÕÕÕπ
∫   1   ≥   306    ≥    4  ≥      128        ≥    305      ≥   10MB    ∫
∫   2   ≥   615    ≥    4  ≥      300        ≥    615      ≥   21MB    ∫
∫   3   ≥   615    ≥    6  ≥      300        ≥    615      ≥   31MB    ∫
∫   4   ≥   940    ≥    8  ≥      512        ≥    940      ≥   64MB    ∫
∫   5   ≥   940    ≥    6  ≥      512        ≥    940      ≥   48MB    ∫
∫   6   ≥   615    ≥    4  ≥     FFFF        ≥    615      ≥   21MB    ∫
∫   7   ≥   462    ≥    8  ≥      256        ≥    511      ≥   31MB    ∫
∫   8   ≥   733    ≥    5  ≥     FFFF        ≥    733      ≥   31MB    ∫
∫   9   ≥   900    ≥   15  ≥     FFFF        ≥    901      ≥  151MB    ∫
∫  10   ≥   820    ≥    3  ≥     FFFF        ≥    820      ≥   21MB    ∫
∫  11   ≥   855    ≥    5  ≥     FFFF        ≥    855      ≥   36MB    ∫
∫  12   ≥   855    ≥    7  ≥     FFFF        ≥    855      ≥   51MB    ∫
∫  13   ≥   306    ≥    8  ≥      128        ≥    319      ≥   21MB    ∫
∫  14   ≥   733    ≥    7  ≥     FFFF        ≥    733      ≥   44MB    ∫
∫  15   ≥  (000)   ≥   (0) ≥     (000)       ≥   (000)     ≥  (00MB)   ∫
∫  16   ≥   612    ≥    4  ≥        0        ≥    663      ≥   21MB    ∫
∫  17   ≥   977    ≥    5  ≥      300        ≥    977      ≥   42MB    ∫
∫  18   ≥   977    ≥    7  ≥     FFFF        ≥    977      ≥   58MB    ∫
∫  19   ≥  1024    ≥    7  ≥      512        ≥   1023      ≥   61MB    ∫
∫  20   ≥   733    ≥    5  ≥      300        ≥    732      ≥   31MB    ∫
∫  21   ≥   733    ≥    7  ≥      300        ≥    732      ≥   42MB    ∫
∫  22   ≥   733    ≥    5  ≥      300        ≥    733      ≥   31MB    ∫
∫  23   ≥   306    ≥    4  ≥        0        ≥    336      ≥   10MB    ∫
∫  24   ≥   925    ≥    7  ≥        0        ≥    925      ≥   56MB    ∫
∫  25   ≥   925    ≥    9  ≥     FFFF        ≥    925      ≥   72MB    ∫
∫  26   ≥   754    ≥    7  ≥      754        ≥    754      ≥   46MB    ∫
∫  27   ≥   754    ≥   11  ≥     FFFF        ≥    754      ≥   72MB    ∫
∫  28   ≥   699    ≥    7  ≥      256        ≥    699      ≥   42MB    ∫
∫  29   ≥   823    ≥   10  ≥     FFFF        ≥    823      ≥   71MB    ∫
∫  30   ≥   918    ≥    7  ≥      918        ≥    918      ≥   55MB    ∫
∫  31   ≥  1024    ≥   11  ≥     FFFF        ≥   1024      ≥   98MB    ∫
∫  32   ≥  1024    ≥   15  ≥     FFFF        ≥   1024      ≥  133MB    ∫
∫  33   ≥  1024    ≥    5  ≥     1024        ≥   1024      ≥   44MB    ∫
∫  34   ≥   612    ≥    2  ≥      128        ≥    612      ≥   10MB    ∫
∫  35   ≥  1024    ≥    9  ≥     FFFF        ≥   1024      ≥   80MB    ∫
∫  36   ≥  1024    ≥    8  ≥      512        ≥   1024      ≥   71MB    ∫
∫  37   ≥   615    ≥    8  ≥      128        ≥    615      ≥   42MB    ∫
∫  38   ≥   987    ≥    3  ≥      987        ≥    987      ≥   25MB    ∫
∫  39   ≥   987    ≥    7  ≥      987        ≥    987      ≥   60MB    ∫
∫  40   ≥   820    ≥    6  ≥      820        ≥    820      ≥   42MB    ∫
∫  41   ≥   977    ≥    5  ≥      977        ≥    977      ≥   42MB    ∫
∫  42   ≥   981    ≥    5  ≥      981        ≥    981      ≥   42MB    ∫
∫  43   ≥   830    ≥    7  ≥      512        ≥    830      ≥   50MB    ∫
∫  44   ≥   830    ≥   10  ≥     FFFF        ≥    830      ≥   72MB    ∫
∫  45   ≥   917    ≥   15  ≥     FFFF        ≥    918      ≥  115MB    ∫
∫  46   ≥  (000)   ≥   (0) ≥     (000)       ≥   (000)     ≥  (00MB)   ∫
∫  47   ≥  1024    ≥    8  ≥        0        ≥      0      ≥   68MB    ∫
»ÕÕÕÕÕÕÕœÕÕÕÕÕÕÕÕÕÕœÕÕÕÕÕÕÕœÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕœÕÕÕÕÕÕÕÕÕÕÕÕÕœÕÕÕÕÕÕÕÕÕÕÕº
Pozn.:ódaj  FFFF  ve  sloupci p©edkompenzace znamen†, ëe p©edkompenzace se
       nebude pouë°vat od ë†dnÇ stopu.

      ódaj  0 ve sloupci p©edkompenzace znamen†, ëe se p©edkompenzace bude
       pouë°vat pro v®echny stopy (tj. od stopy 0).

      Disk typu 1 je origin†ln° pevnò disk XT (10 MB).

      Disk typu 2 je standardn° pevnò disk AT 20 MB.

      Typy 16-23 jsou p©ipojeny do ROM-BIOSu od data 15.11.1985.

      Pokud  je  typ  disku  15 (0FH) znamen† to, ëe typ disku je uloëen v
       CMOS na adrese 19H (disk C:) nebo na adrese 1AH (disk D:).

      Typ  disku  46  je  rezervov†n  a  nepouë°v†  se.  Disk  á°slo 47 je
       uëivatelsky definovanò disk.



Tabulka parametrñ pevnÇho disku:
ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ
ukazatel disk 0: INT 41H; 0000:0100h
ukazatel disk 1: INT 46H; 0000:0118h

00H  Word  poáet v†lcñ disku
02H  Byte  poáet hlav
03H  Word  poá†teán° v†lec redukovanÇho z†pisu (pouze XT, ostatn° 0)
05H  Word  poá†teán° v†lec p©edkompenzace z†pisu
07H  Byte  maxim†ln° dÇlka ECC DATA BURST
08H  Byte  ©°dic° bajt
               bit 0-2: volba disku (pouze XT, ostatn° 0)
               bit 3:   1=je v°ce neë 8 hlav
               bit 5:   1=na v†lci MAX+1 je tov†rn° defektn° mapa
               bit 6:   1=z†kaz opakov†n° pokusñ ECC
               bit 7:   1=z†kaz opakov†n° pokusñ o p©°stup
09H  Byte  standardn° TIME-OUT (pouze XT, ostatn° 0)
0AH  Byte  TIME-OUT form†tov†n° (pouze XT, ostatn° 0)
0BH  Byte  TIME-OUT pro kontrolu disku (pouze XT, ostatn° 0)
0CH  Word  parkovac° z¢na (pouze AT/PS2)
0EH  Byte  poáet sektorñ na stopu (pouze AT/PS2)
0FH  Byte  0 (rezervov†no)



Obsazen° pamàti dat BIOS:
ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ
0040:0074h     - status posledn° operace na pevnÇm disku (bajt)
                         00H - ë†dn† chyba
                         01H - neplatnò povel
                         02H - adresov† znaáka nenalezena
                         04H - poëadovanò sektor nenalezen
                         05H - chyba resetov†n° disku
                         07H - chyba aktivity diskovòch parametrñ
                         08H - chyba p©eteáen° DMA
                         09H - p©°stup k DMA p©ekroáil hranici 64K
                         0AH - detekov†no vadnÇ n†và®t° sektoru
                         0BH - (nalezena vadn† stopa)
                         10H - chyba dat ECC p©i áten° sektoru
                         11H - provedena korekce chybnòch dat pomoc° ECC
                         20H - chyba ©adiáe
                         40H - chyba vystaven°
                         80H - TIME-OUT
                         AAH - disk nen° p©ipraven
                         BBH - nedefinovateln† chyba
                         CCH - chyba z†pisu
                         E0H - stavov† chyba, registr chyby = 0
                         FFH - smysl operace chybnò

0040:0075h     - poáet nainstalovanòch pevnòch diskñ (bajt)

0040:0076h     -

0040:0070h     -

0040:008Ch     - statut ©adiáe pevnÇho disku (bajt)
                    bit 0: 1=p©edchoz° povel ukonáen s chybou
                    bit 1: nastaven na 1 p©i p©°chodu impulsu indexu
                    bit 2: 1=chyba dat, provedena £spà®n† korekce ECC
                    bit 3: 1=poëadavek dat (buffer áek† na data)
                    bit 4: 1=vystaven° ukonáeno
                    bit 5: 1=chyba z†pisu
                    bit 6: 1=disk p©ipraven na vystaven° (je-li bit 4=1)
                    bit 7: 1=©adiá je zanepr†zdnàn (prov†d° povel)

0040:008Dh     - chybovò statut ©adiáe pevnÇho disku (bajt)
                    bit 0: 1=adresov† znaáka dat nenalezena
                    bit 1: 1=chyba stopy 0 - stopa 0 nenalezena
                    bit 2: 1=p©eru®en° povelu
                    bit 3: (vëdy nastaven na 0)
                    bit 4: 1=nenalezen identifik†tor sektoru
                    bit 5: (vëdy nastaven na 0)
                    bit 6: 1=chyba ECC: neopraviteln† chyba dat
                    bit 7: 1=chybnò blok dat

0040:008Eh     - ©°zen° p©eru®en° pevnÇho disku (bajt)



Porty ©adiáe pevnÇho disku AT:
ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ
(pro ©adiá druhÇho pevnÇho disku se nam°sto adres 01Fx dosad° adresy 017x)

03F6:     ©°dic° registr pevnÇho disku
                    bit 2: 1 = generov†n° sign†lu RESET pro ©adiá diskñ

01F0:     datovò registr pro áten°/z†pis z/do bufferu sektorñ ©adiáe


01F1:     z†pis: registr v†lce p©edkompenzace
          áten°: chybovò registr
                    bit 0: 1=adresov† znaáka dat nenalezena
                    bit 1: 1=chyba stopy 0 - stopa 0 nenalezena
                    bit 2: 1=p©eru®en° povelu
                    bit 3: (vëdy nastaven na 0)
                    bit 4: 1=nenalezen identifik†tor sektoru
                    bit 5: (vëdy nastaven na 0)
                    bit 6: 1=chyba ECC: neopraviteln† chyba dat
                    bit 7: 1=chybnò blok dat

01F2:     á°taá sektorñ; áten°/z†pis poátu sektorñ pro proveden° operace

01F3:     á°slo sektoru; áten°/z†pis bàënÇho/poá†teán°ho á°sla log. sektoru

01F4:     v†lec LOW (bity 0 aë 7 á°sla v†lce)

01F5:     v†lec HIGH (bity 0 aë 3 = bity 8 aë 11 á°sla v†lce)

01F6:     disk a hlava

01F7:     z†pis: p©°kazovò registr
                         x: bit 0: 1=z†kaz opakov†n°
                            bit 1: 1=m¢d s ECC
                            bit 3: 1=m¢d s bufferem
                    1xH = n†vrat na v†lec 0 (nië®° tetr†da = rychlost krokov†n°)
                    2xH = áten° sektoru (nië®° tetr†da indikuje opakov†n° a ECC)
                    3xH = z†pis sektoru (nië®° tetr†da indikuje opakov†n° a ECC)
                    4xH = ovà©ovac° áten° (nië®° tetr†da indikuje opak. a ECC)
                    5xH = form†tov†n° stopy
                    6xH = inicializace ©adiáe
                    7xH = vystaven° na v†lec (nië®° tetr†da=rychlost krokov†n°)
                    90H = diagnostika
                    91H = nastaven° parametrñ (max. poáet hlav, sektorñ) pro
                          zvolenò disk

          áten°: stavovò registr
                    bit 0: 1=p©edchoz° povel ukonáen s chybou
                    bit 1: nastaven na 1 p©i p©°chodu impulsu indexu
                    bit 2: 1=chyba dat, provedena £spà®n† korekce ECC
                    bit 3: 1=poëadavek dat (buffer áek† na data)
                    bit 4: 1=vystaven° ukonáeno
                    bit 5: 1=chyba z†pisu
                    bit 6: 1=disk p©ipraven na vystaven° (je-li bit 4=1)
                    bit 7: 1=©adiá je zanepr†zdnàn (prov†d° povel)



; *****************************************************************************
;                       OBSLUHA DISKOVùCH OPERACã INT 13H
; *****************************************************************************
                                               ;* vstupn° bod INT 13h
F000:A33D 80FA80         CMP    DL,80            ; je pevnò disk ?
F000:A340 FB             STI                     ; povolen° p©eru®en°
F000:A341 FC             CLD                     ; smàr p©enosu dolñ
F000:A342 7253           JB     A397             ; je disketa
F000:A344 0AE4           OR     AH,AH            ; je reset pevnÇho disku ?
F000:A346 7504           JNZ    A34C             ; nen° reset pevnÇho disku
F000:A348 CD40           INT    40               ; reset disket. mechanik
F000:A34A 32E4           XOR    AH,AH            ; funkce 0=reset pevnÇho disku

; *****************************************************************************
;                            OBSLUHA PEVNêHO DISKU
; *****************************************************************************

F000:A34C 50           * PUSH   AX               ; £schova AX (SP+18h) (povel)
F000:A34D 51             PUSH   CX               ; £schova CX (SP+16h)
F000:A34E 52             PUSH   DX               ; £schova DX (SP+14h)
F000:A34F 53             PUSH   BX               ; £schova BX (SP+12h)
F000:A350 56             PUSH   SI               ; £schova SI (SP+10h)
F000:A351 57             PUSH   DI               ; £schova DI (SP+0eh)
F000:A352 1E             PUSH   DS               ; £schova DS (SP+0ch)
F000:A353 06             PUSH   ES               ; £schova ES (SP+0ah)
F000:A354 83EC08         SUB    SP,+08           ; rezerva pro data v pamàti
F000:A357 55             PUSH   BP               ; £schova BP
F000:A358 8BEC           MOV    BP,SP            ; ukazatel dat v z†sobn°ku
F000:A35A 6A40           PUSH   40               ; datovò segment BIOS
F000:A35C 1F             POP    DS               ; DS <- 40h datovò segment BIOS
F000:A35D 50             PUSH   AX               ; £schova AX (á°slo funkce)
F000:A35E 8AC4           MOV    AL,AH            ; AL <- á°slo funkce
F000:A360 98             CBW                     ; AX <- AL á°slo funkce
F000:A361 8BF8           MOV    DI,AX            ; DI <- á°slo funkce
F000:A363 3C19           CMP    AL,19            ; kontrola max. á°sla funkce 25
F000:A365 58             POP    AX               ; n†vrat AX (á°slo funkce)
F000:A366 7725           JA     A38D             ; chybnÇ á°slo funkce (>25)
F000:A368 D1E7           SHL    DI,1             ; DI <- á°slo funkce * 2
F000:A36A 2EFF959CA3     CALL   CS:[DI+A39C]     ; vol†n° obsluhy funkce INT 13h
F000:A36F 894618       * MOV    [BP+18],AX       ; nastaven° registru AX v SP+18
F000:A372 B80102         MOV    AX,0201          ; nastaven° registru F
F000:A375 7206           JB     A37D             ; je chyba operace
F000:A377 81661EFEFF     AND    Word Ptr [BP+1E],FFFE ; zru®en° bitu CF v F
F000:A37C 48             DEC    AX               ; zru®en° bitu CF v AX
F000:A37D 09461E       * OR     [BP+1E],AX       ; nastaven° bitñ IF a CF
F000:A380 5D             POP    BP               ; n†vrat BP
F000:A381 83C408         ADD    SP,+08           ; n†vrat ukazatele z†sobn°ku SP
F000:A384 07             POP    ES               ; n†vrat ES
F000:A385 1F             POP    DS               ; n†vrat DS
F000:A386 5F             POP    DI               ; n†vrat DI
F000:A387 5E             POP    SI               ; n†vrat SI
F000:A388 5B             POP    BX               ; n†vrat BX
F000:A389 5A             POP    DX               ; n†vrat DX
F000:A38A 59             POP    CX               ; n†vrat CX
F000:A38B 58             POP    AX               ; n†vrat AX
F000:A38C CF             IRET                    ; n†vrat z obsluhy INT 13h
                                               ;* chybnÇ á°slo funkce
F000:A38D B80001       * MOV    AX,0100          ; n†vratovò k¢d chyb 1
F000:A390 88267400       MOV    [0074],AH        ; nastaven° statusu operace
F000:A394 F9             STC                     ; p©°znak chyby CY
F000:A395 EBD8           JMP    A36F             ; n†vrat z obsluhy INT 13h

                                               ;* je disketov† mechanika
F000:A397 CD40         * INT    40               ; sluëby disket (F000:AF96)
F000:A399 CA0200         RETF   0002             ; n†vrat bez n†vratu p©°znakñ

                                               ;* adresy sluëeb INT 13h disku
F000:A39C                DW     A3D9             ; sluëba 0 reset pevnÇho disku
F000:A39E                DW     A44F             ; sluëba 1 poskytnut° stavu
F000:A3A0                DW     A45A             ; sluëba 2 áten° sektorñ
F000:A3A2                DW     A46A             ; sluëba 3 z†pis sektorñ
F000:A3A4                DW     A47A             ; sluëba 4 verifikace sektorñ
F000:A3A6                DW     A49B             ; sluëba 5 form†tov†n° stopy
F000:A3A8                DW     A3D0             ; sluëba 6  - - - - - - - -
F000:A3AA                DW     A3D0             ; sluëba 7  - - - - - - - -
F000:A3AC                DW     A3E7             ; sluëba 8 poskytnut° disk.par.
F000:A3AE                DW     A566             ; sluëba 9 inic. tab. disku
F000:A3B0                DW     A5A1             ; sluëba 0ah dlouhÇ áten°
F000:A3B2                DW     A5B1             ; sluëba 0bh dlouhò z†pis
F000:A3B4                DW     A69F             ; sluëba 0ch vystaven° na v†lec
F000:A3B6                DW     A3E1             ; sluëba 0dh alt. reset disku
F000:A3B8                DW     A3D0             ; sluëba 0eh - - - - - - - -
F000:A3BA                DW     A3D0             ; sluëba 0fh - - - - - - - -
F000:A3BC                DW     A6FE             ; sluëba 10h test p©ipravenosti
F000:A3BE                DW     A72C             ; sluëba 11h rekalibrace disku
F000:A3C0                DW     A3D0             ; sluëba 12h - - - - - - - -
F000:A3C2                DW     A3D0             ; sluëba 13h - - - - - - - -
F000:A3C4                DW     A756             ; sluëba 14h diagnostika ©adiáe
F000:A3C6                DW     A3EC             ; sluëba 15h áten° typu DASD
F000:A3C8                DW     A3D0             ; sluëba 16h - - - - - - - -
F000:A3CA                DW     A3D0             ; sluëba 17h - - - - - - - -
F000:A3CC                DW     A3D0             ; sluëba 18h - - - - - - - -
F000:A3CE                DW     A7A8             ; sluëba 19h zaparkov†n° hlav

; -------------------------- neobsluhovan† funkce -----------------------------
                                               ;* chybnÇ á°slo operace
F000:A3D0 B80001         MOV    AX,0100          ; n†vratovò k¢d chyb 1
F000:A3D3 88267400       MOV    [0074],AH        ; nastaven° statusu operace
F000:A3D7 F9             STC                     ; p©°znak chyby CY
F000:A3D8 C3             RET                     ; n†vrat z obsluhy INT 13h
F000:A3E6 C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 00h - reset pevnÇho disku
; -----------------------------------------------------------------------------
                                               ;* sluëba 0 - reset pevnÇho disku
F000:A3D9 80FA81         CMP    DL,81            ; je spr†vnÇ á°slo disku ?
F000:A3DC 7708           JA     A3E6             ; disk >81h nen° obsluhov†n
F000:A3DE EB16         * JMP    A3F6             ; proveden° sluëby resetu disku
F000:A3E0 90             NOP     
F000:A3E6 C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 0Dh - alternativn° reset disku
; -----------------------------------------------------------------------------
F000:A3E1 E81304         CALL   A7F7             ; p©°prava parametrñ operace
F000:A3E4 73F8           JNB    A3DE             ; OK - proveden° resetu disku
F000:A3E6 C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 08h - poskytnut° aktu†ln°ch diskovòch parametrñ
; -----------------------------------------------------------------------------
F000:A3E7 E83C01         CALL   A526             ; poskytnut° parametrñ disku
F000:A3EA EB03           JMP    A3EF             ; n†vrat registrñ DX a CX
; -----------------------------------------------------------------------------
;         FUNKCE 15h - áten° typu DASD
; -----------------------------------------------------------------------------
F000:A3EC E88E03         CALL   A77D             ; áten° typu DASD
F000:A3EF 895614       * MOV    [BP+14],DX       ; poáet sektorñ mÇdia - LOW
F000:A3F2 894E16         MOV    [BP+16],CX       ; poáet sektorñ mÇdia - HIGH
F000:A3F5 C3             RET
; -----------------------------------------------------------------------------
;                          resetov†n° pevnÇho disku
; -----------------------------------------------------------------------------
                                               ;* resetov†n° disku
F000:A3F6 C6068E0000   * MOV    Byte Ptr [008E],00 ; zru®en° p©°znaku p©eru®en°
F000:A3FB BAF603         MOV    DX,03F6          ; registr ©adiáe
F000:A3FE B004           MOV    AL,04            ; funkce resetov†n° ©adiáe
F000:A400 EE             OUT    DX,AL            ; resetov†n° ©adiáe
F000:A401 B92400         MOV    CX,0024          ; doba prodlevy
F000:A404 E8614C         CALL   F068             ; kr†tk† prodleva (4.8 us)
F000:A407 B000           MOV    AL,00            ; klidovò stav
F000:A409 EE             OUT    DX,AL            ; ukonáen° sign†lu RESET
F000:A40A E84D04         CALL   A85A             ; áek†n° na p©ipravenost ©adiáe
F000:A40D 723F           JB     A44E             ; chyba - ©adiá nep©ipraven
F000:A40F BAF101         MOV    DX,01F1          ; registr pevnÇho disku 0
F000:A412 EC             IN     AL,DX            ; áten° stavu RESET ©adiáe
F000:A413 88268D00       MOV    [008D],AH        ; nul. statutu ©adiáe (AH=0)
F000:A417 3C01           CMP    AL,01            ; je spr†vnò stav RESET ?
F000:A419 7405           JZ     A420             ; stav RESET je OK
F000:A41B B405           MOV    AH,05            ; chyba resetov†n° disku
F000:A41D F9             STC                     ; CY=p©°znak chyby operace
F000:A41E EB2A           JMP    A44A             ; chybovò n†vrat z obsluhy
                                               ;* p©ekalibrov†n° pevnòch diskñ
F000:A420 B280         * MOV    DL,80            ; á°slo pevnÇho disku 0
F000:A422 BF2200         MOV    DI,0022          ; offset sluëby 11h v tabulce
F000:A425 E80403         CALL   A72C             ; rekalibrace pevnÇho disku 0
F000:A428 803E750002     CMP    Byte Ptr [0075],02 ; jsou 2 pevnÇ disky ?
F000:A42D 7205           JB     A434             ; je pouze 1 pevnò disk - konec
F000:A42F B281           MOV    DL,81            ; á°slo pevnÇho disku 1
F000:A431 E8F802         CALL   A72C             ; rekalibrace pevnÇho disku 1
                                               ;* inicializace tabulek diskñ
F000:A434 B280         * MOV    DL,80            ; á°slo pevnÇho disku 0
F000:A436 BF1200         MOV    DI,0012          ; offset sluëby 9 v tabulce
F000:A439 E82A01         CALL   A566             ; inicializace tabulky disku 0
F000:A43C 803E750002     CMP    Byte Ptr [0075],02 ; jsou 2 pevnÇ disky ?
F000:A441 7205           JB     A448             ; je pouze 1 pevnò disk
F000:A443 B281           MOV    DL,81            ; á°slo pevnÇho disku 1
F000:A445 E81E01         CALL   A566             ; inicializace tabulky disku 1
F000:A448 32E4           XOR    AH,AH            ; n†vratovò k¢d - operace OK
F000:A44A 88267400     * MOV    [0074],AH        ; nastaven° k¢du operace
F000:A44E C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 01h - poskytnut° stavu pevnÇho disku
; -----------------------------------------------------------------------------
                                               ;* poskytnut° stavu pevnÇho disku
F000:A44F A07400         MOV    AL,[0074]        ; áten° stavu posledn° operace
F000:A452 B400           MOV    AH,00            ; nulov†n°
F000:A454 88267400       MOV    [0074],AH        ; vynulov†n° stavovÇho bajtu
F000:A458 F8             CLC                     ; p©°znak - operace OK
F000:A459 C3             RET
; -----------------------------------------------------------------------------
;         FUNKCE 02h - áten° sektorñ z pevnÇho disku do pamàti
; -----------------------------------------------------------------------------
                                               ;* áten° sektorñ z pevnÇho disku
                                                 ; VSTUP: AH=2
                                                 ;        AL=poáet sektorñ
                                                 ;        CH=á°slo v†lce
                                                 ;        CL=poá†t.á°slo sektoru
                                                 ;           bity 6,7:bity 8,9
                                                 ;                   á°sla v†lce
                                                 ;        DH=á°slo hlavy
                                                 ;           bity 6,7:bity 10,11
                                                 ;                   á°sla v†lce
                                                 ;        ES:BX=adresa bufferu
                                                 ;       (DI=4 identif. funkce)

F000:A45A C746180002     MOV    Word Ptr [BP+18],0200 ; dÇlka datovÇho bufferu
F000:A45F E83705         CALL   A999             ; kontrola adresy DTA
F000:A462 7205           JB     A469             ; chyba adresy DTA
F000:A464 B420           MOV    AH,20            ; povel pro áten° dat
F000:A466 E95801         JMP    A5C1             ; opakovanÇ áten° dat
F000:A469 C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 03h - z†pis sektorñ z pamàti na pevnò disk
; -----------------------------------------------------------------------------
                                               ;* z†pis sektorñ na pevnò disk
                                                 ; VSTUP: AH=2
                                                 ;        AL=poáet sektorñ
                                                 ;        CH=á°slo v†lce
                                                 ;        CL=poá†t.á°slo sektoru
                                                 ;           bity 6,7:bity 8,9
                                                 ;                   á°sla v†lce
                                                 ;        DH=á°slo hlavy
                                                 ;           bity 6,7:bity 10,11
                                                 ;                   á°sla v†lce
                                                 ;        ES:BX=adresa bufferu
                                                 ;       (DI=6 identif. funkce)

F000:A46A C746180002     MOV    Word Ptr [BP+18],0200 ; dÇlka datovÇho bufferu
F000:A46F E82705         CALL   A999             ; kontrola adresy DTA
F000:A472 7205           JB     A479             ; chyba adresy DTA
F000:A474 B430           MOV    AH,30            ; povel pro z†pis dat
F000:A476 E9B501         JMP    A62E             ; proveden° povelu z†pisu
F000:A479 C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 04h - verifikace sektorñ
; -----------------------------------------------------------------------------
F000:A47A E87A03         CALL   A7F7             ; p©°prava parametrñ operace
F000:A47D 721B           JB     A49A             ; neplatnÇ á°slo disku
F000:A47F E80004         CALL   A882             ; vòbàr disku, áek†n° na p©ipr.
F000:A482 7216           JB     A49A             ; je TIME-OUT p©ipravenosti
F000:A484 E84005         CALL   A9C7             ; nastaven° podle ©°d. bajtu
F000:A487 E85F05         CALL   A9E9             ; nastaven° hlavy, v†lce, ...
F000:A48A E8C103         CALL   A84E             ; nastaven° v†lce pro p©edkomp.
F000:A48D B040           MOV    AL,40            ; k¢d pro verifikaci sektorñ
F000:A48F E8D904         CALL   A96B             ; vysl†n° povelu na ©adiá diskñ
F000:A492 E82C04         CALL   A8C1             ; áek†n° na p©eru®en° od ©adiáe
F000:A495 7203           JB     A49A             ; byla chyba p©eru®en°
F000:A497 E86F04         CALL   A909             ; test stavu provedenÇ operace
F000:A49A C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 05h - form†tov†n° stopy
; -----------------------------------------------------------------------------
F000:A49B E85903         CALL   A7F7             ; p©°prava parametrñ operace
F000:A49E 7205           JB     A4A5             ; neplatnÇ á°slo disku
F000:A4A0 E8DF03         CALL   A882             ; vòbàr disku, áek†n° na p©ipr.
F000:A4A3 7303           JNB    A4A8             ; disk je p©ipraven
F000:A4A5 EB7E           JMP    A525             ; chyba TIME-OUT disku
F000:A4A7 90             NOP     
F000:A4A8 8CC7         * MOV    DI,ES            ; segment adresy tabulky znaáek
F000:A4AA 8BF3           MOV    SI,BX            ; offset adresy tablky znaáek
F000:A4AC E82703         CALL   A7D6             ; poskytnut° adresy tab. param.
F000:A4AF E81505         CALL   A9C7             ; nastaven° podle ©°d. bajtu
F000:A4B2 E89903         CALL   A84E             ; nastaven° v†lce pro p©edkomp.
F000:A4B5 268A470E       MOV    AL,ES:[BX+0E]    ; poáet sektorñ na stopu
F000:A4B9 884603         MOV    [BP+03],AL       ; poáet sektorñ k operaci
F000:A4BC BAF201         MOV    DX,01F2          ; registr á°taáe sektorñ
F000:A4BF EE             OUT    DX,AL            ; nastaven° poátu sektorñ
F000:A4C0 EB00           JMP    A4C2             ; mal† prodleva
F000:A4C2 EB00         * JMP    A4C4             ; mal† prodleva
F000:A4C4 8A4605       * MOV    AL,[BP+05]       ; á°slo sektoru
F000:A4C7 243F           AND    AL,3F            ; ponech† bity 0 aë 5
F000:A4C9 BAF301         MOV    DX,01F3          ; registr á°sla sektoru
F000:A4CC EE             OUT    DX,AL            ; nastaven° á°sla 1. sektoru
F000:A4CD EB00           JMP    A4CF             ; mal† prodleva
F000:A4CF EB00           JMP    A4D1             ; mal† prodleva
F000:A4D1 8A4607         MOV    AL,[BP+07]       ; k¢d pro vòbàr disku a hlavy
F000:A4D4 BAF601         MOV    DX,01F6          ; registr volby disku a hlavy
F000:A4D7 EE             OUT    DX,AL            ; vòbàr disku a hlavy
F000:A4D8 EB00           JMP    A4DA             ; mal† prodleva
F000:A4DA EB00           JMP    A4DC             ; mal† prodleva
F000:A4DC 8AC5           MOV    AL,CH            ; á°slo v†lce - LOW
F000:A4DE 884605         MOV    [BP+05],AL       ; uloëen° á°sla v†lce - LOW
F000:A4E1 BAF401         MOV    DX,01F4          ; registr á°sla v†lce - LOW
F000:A4E4 EE             OUT    DX,AL            ; nastaven° á°sla v†lce - LOW
F000:A4E5 EB00           JMP    A4E7             ; mal† prodleva
F000:A4E7 EB00           JMP    A4E9             ; mal† prodleva
F000:A4E9 8AC1           MOV    AL,CL            ; á°slo v†lce - bity 8 a 9
F000:A4EB C0E806         SHR    AL,06            ; rotace na bity 0 a 1
F000:A4EE 8AD0           MOV    DL,AL            ; £schova bitñ 8 a 9 á°sla
F000:A4F0 8A4615         MOV    AL,[BP+15]       ; á°slo hlavy a v†lce - HIGH
F000:A4F3 C0E804         SHR    AL,04            ; rotace bitñ 10 a 11 v†lce
F000:A4F6 240C           AND    AL,0C            ; bity 10 a 11 á°sla v†lce
F000:A4F8 0AC2           OR     AL,DL            ; souáet - á°slo v†lce - HIGH
F000:A4FA 884606         MOV    [BP+06],AL       ; uloëen° á°sla v†lce - HIGH
F000:A4FD BAF501         MOV    DX,01F5          ; registr á°sla v†lce - HIGH
F000:A500 EE             OUT    DX,AL            ; nastaven° á°sla v†lce - HIGH
F000:A501 B050           MOV    AL,50            ; povel pro form†tov†n° disku
F000:A503 E86504         CALL   A96B             ; vysl†n° povelu na ©adiá diskñ
F000:A506 E8DF03         CALL   A8E8             ; áek†n° na poëadavek dat
F000:A509 721A           JB     A525             ; chyba TIME-OUT ©adiáe
F000:A50B 8CD8           MOV    AX,DS            ; £schova segmentu DS
F000:A50D 97             XCHG   AX,DI            ; AX <- segment adresy tabulky
F000:A50E 8ED8           MOV    DS,AX            ; DS <- segment adresy tabulky
F000:A510 B90001         MOV    CX,0100          ; dÇlka jednoho sektoru
F000:A513 BAF001         MOV    DX,01F0          ; datovò registr ©adiáe
F000:A516 FA             CLI                     ; z†kaz p©eru®en°
F000:A517 FC             CLD                     ; smàr nahoru
F000:A518 F36F           REPZ   OUTSW            ; z†pis tabulky n†và®t° sektorñ
F000:A51A FB             STI                     ; povolen° p©eru®en°
F000:A51B 8EDF           MOV    DS,DI            ; n†vrat segmentu DS
F000:A51D E8A103         CALL   A8C1             ; áek†n° na p©eru®en° od ©adiáe
F000:A520 7203           JB     A525             ; chyba TIME-OUT
F000:A522 E8E403         CALL   A909             ; test stavu provedenÇ operace
F000:A525 C3           * RET
; -----------------------------------------------------------------------------
;                   poskytnut° parametrñ pevnÇho disku
; -----------------------------------------------------------------------------
F000:A526 E8AD02         CALL   A7D6             ; poskytnut° adresy tab. param.
F000:A529 730B           JNB    A536             ; zad†n° disku OK
F000:A52B B407           MOV    AH,07            ; k¢d - chyba disk. parametrñ
F000:A52D B90000         MOV    CX,0000          ; max. hodnota pro v†lce, sekt.
F000:A530 BA0000         MOV    DX,0000          ; max. hodnota hlav a diskñ
F000:A533 F9             STC                     ; p©°znak chyby operace
F000:A534 EB2B           JMP    A561             ; n†vrat s chybou
F000:A536 268A7702     * MOV    DH,ES:[BX+02]    ; poáet hlav disku
F000:A53A FECE           DEC    DH               ; maxim†ln° á°slo hlavy
F000:A53C 268B07         MOV    AX,ES:[BX]       ; maxim†ln° poáet v†lcñ
F000:A53F 2D0200         SUB    AX,0002          ; poáet v†lcñ - 2
F000:A542 8AD4           MOV    DL,AH            ; poáet v†lcñ - HIGH
F000:A544 8AE8           MOV    CH,AL            ; poáet v†lcñ - LOW
F000:A546 C0E406         SHL    AH,06            ; bity 8 a 9 --> bity 6 a 7
F000:A549 8ACC           MOV    CL,AH            ; vy®®° 2 bity á°sla v†lce
F000:A54B 8AE2           MOV    AH,DL            ; poáet v†lcñ - HIGH
F000:A54D C0E404         SHL    AH,04            ; bity 10 a 11 --> bity 6 a 7
F000:A550 80E4C0         AND    AH,C0            ; maskov†n° bitñ 6 a 7
F000:A553 0AF4           OR     DH,AH            ; slouáen° s max. á°slem hlavy
F000:A555 268A470E       MOV    AL,ES:[BX+0E]    ; poáet sektorñ na stopu
F000:A559 0AC8           OR     CL,AL            ; slouáen° s bity 8 a 9 v†lce
F000:A55B 8A167500       MOV    DL,[0075]        ; poáet pevnòch diskñ
F000:A55F B400           MOV    AH,00            ; n†vratovò k¢d - OK
F000:A561 88267400     * MOV    [0074],AH        ; uloëen° n†vratovÇho k¢du
F000:A565 C3             RET     
; -----------------------------------------------------------------------------
;         FUNKCE 09h - inicializace tabulky pevnÇho disku
; -----------------------------------------------------------------------------
F000:A566 E88E02         CALL   A7F7             ; p©°prava parametrñ operace
F000:A569 7235           JB     A5A0             ; chyba - neplatnÇ á°slo disku
F000:A56B E86802         CALL   A7D6             ; poskytnut° adresy tab. param.
F000:A56E 7230           JB     A5A0             ; chyba tabulky parametrñ
F000:A570 E80F03         CALL   A882             ; vòbàr disku, áek†n° na p©ipr.
F000:A573 722B           JB     A5A0             ; chyba - TIME-OUT ©adiáe
F000:A575 E84F04         CALL   A9C7             ; nastaven° podle ©°d. bajtu
F000:A578 268A470E       MOV    AL,ES:[BX+0E]    ; poáet sektorñ na stopu
F000:A57C 8AE2           MOV    AH,DL            ; £schova á°sla disku
F000:A57E BAF201         MOV    DX,01F2          ; registr poátu sektorñ
F000:A581 884603         MOV    [BP+03],AL       ; poáet sektorñ k operaci
F000:A584 EE             OUT    DX,AL            ; nastaven° max. poátu sektorñ
F000:A585 EB00           JMP    A587             ; mal† prodleva
F000:A587 EB00         * JMP    A589             ; mal† prodleva
F000:A589 BAF601       * MOV    DX,01F6          ; registr vòbàru diskñ a hlav
F000:A58C 8A4607         MOV    AL,[BP+07]       ; k¢d pro vòbàr disku a hlavy
F000:A58F EE             OUT    DX,AL            ; vòbàr disku a hlav
F000:A590 B091           MOV    AL,91            ; povel pro inicializaci disku
F000:A592 E8B902         CALL   A84E             ; nastaven° v†lce pro p©edkomp.
F000:A595 E8D303         CALL   A96B             ; vysl†n° povelu na ©adiá diskñ
F000:A598 E82603         CALL   A8C1             ; áek†n° na p©eru®en° od ©adiáe
F000:A59B 7203           JB     A5A0             ; chyba TIME-OUT
F000:A59D E86903         CALL   A909             ; test stavu provedenÇ operace
F000:A5A0 C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 0Ah - dkouhÇ áten° dat z disku do pamàti
; -----------------------------------------------------------------------------
F000:A5A1 C746180402     MOV    Word Ptr [BP+18],0204 ; dÇlka datovÇho bufferu
F000:A5A6 E8F003         CALL   A999             ; kontrola adresy DTA
F000:A5A9 7205           JB     A5B0             ; chyba zad†n° adresy DTA
F000:A5AB B422           MOV    AH,22            ; povel pro dlouhÇ áten° dat
F000:A5AD EB12           JMP    A5C1             ; opakovanÇ áten° dat
F000:A5AF 90             NOP     
F000:A5B0 C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 0Bh - dkouhò z†pis dat z pamàti na disk
; -----------------------------------------------------------------------------
F000:A5B1 C746180402     MOV    Word Ptr [BP+18],0204 ; dÇlka datovÇho bufferu
F000:A5B6 E8E003         CALL   A999             ; kontrola adresy DTA
F000:A5B9 7205           JB     A5C0             ; chyba zad†n° adresy DTA
F000:A5BB B432           MOV    AH,32            ; povel pro dlouhò z†pis
F000:A5BD EB6F           JMP    A62E             ; opakovanò z†pis dat
F000:A5BF 90             NOP     
F000:A5C0 C3           * RET
; -----------------------------------------------------------------------------
;                   OpakovanÇ áten° dat zadanÇho poátu sektorñ
; -----------------------------------------------------------------------------
                                               ;* opakovanÇ áten° dat
F000:A5C1 E83302         CALL   A7F7             ; p©°prava parametrñ operace
F000:A5C4 7267           JB     A62D             ; chyba zad†n° parametrñ
F000:A5C6 E8B902         CALL   A882             ; vòbàr disku, áek†n° na p©ipr.
F000:A5C9 7262           JB     A62D             ; chyba - disk nep©ipraven
F000:A5CB 8BFB           MOV    DI,BX            ; offset adresy bufferu DTA
F000:A5CD 8CC6           MOV    SI,ES            ; segment adresy bufferu DTA
F000:A5CF E8F503         CALL   A9C7             ; nastaven° podle ©°d. bajtu
F000:A5D2 F6067600C0     TEST   Byte Ptr [0076],C0 ; je z†kaz opakov†n° ?
F000:A5D7 7402           JZ     A5DB             ; nen° z†kaz opakov†n°
F000:A5D9 FEC4           INC    AH               ; p©°znak z†kazu opakov†n°
F000:A5DB E80B04       * CALL   A9E9             ; nastaven° sektorñ, stopy...
F000:A5DE E86D02         CALL   A84E             ; nastaven° v†lce p©edkompenz.
F000:A5E1 8AC4           MOV    AL,AH            ; povel pro poëadovanou operaci
F000:A5E3 E88503         CALL   A96B             ; vysl†n° povelu na ©adiá diskñ
F000:A5E6 E8D802       * CALL   A8C1             ; áek†n° na p©eru®en° od ©adiáe
F000:A5E9 7242           JB     A62D             ; byla chyba TIME-OUT
F000:A5EB 8EC6           MOV    ES,SI            ; segment adresy bufferu DTA
F000:A5ED B90001         MOV    CX,0100          ; dÇlka sektoru ve slovech
F000:A5F0 BAF001         MOV    DX,01F0          ; adresa datovÇho portu ©adiáe
F000:A5F3 FA             CLI                     ; z†kaz p©eru®en°
F000:A5F4 FC             CLD                     ; smàr nahoru
F000:A5F5 F3             REPZ
F000:A5F6 6D             INSW                    ; p©°jem jednoho slova
F000:A5F7 FB             STI                     ; povolen° p©eru®en°
F000:A5F8 F6460802       TEST   Byte Ptr [BP+08],02 ; povel - norm†ln° vstup ?
                                               ;* je áten° kontroln°ho k¢du ECC
F000:A5FC 7415           JZ     A613             ; je norm†ln° vstup
F000:A5FE E8E702         CALL   A8E8             ; áek†n° na poëadavek dat
F000:A601 722A           JB     A62D             ; chyba TIME-OUT
F000:A603 B90400         MOV    CX,0004          ; poáet bajtñ k¢du ECC
F000:A606 EC           * IN     AL,DX            ; áten° bajtu k¢du ECC
F000:A607 268805         MOV    ES:[DI],AL       ; uloëen° bajtu k¢du ECC
F000:A60A 47             INC    DI               ; zvò®en° ukl†dac° adresy
F000:A60B EB00           JMP    A60D             ; mal† prodleva
F000:A60D EB00         * JMP    A60F             ; mal† prodleva
F000:A60F EB00         * JMP    A611             ; mal† prodleva
F000:A611 E2F3         * LOOP   A606             ; áten° dal®°ho bajtu k¢du ECC

F000:A613 E8F302       * CALL   A909             ; test stavu provedenÇ operace
F000:A616 7307           JNB    A61F             ; operace probàhla OK
F000:A618 803E740011     CMP    Byte Ptr [0074],11 ; byla chyba korekce s ECC ?
F000:A61D 7505           JNZ    A624             ; byla korekce dat s ECC
F000:A61F FE4E03       * DEC    Byte Ptr [BP+03] ; sn°ëen° á°taáe sektorñ
F000:A622 75C2           JNZ    A5E6             ; áten° dal®°ho sektoru
F000:A624 8A267400     * MOV    AH,[0074]        ; n†vratovò k¢d operace
F000:A628 0AE4           OR     AH,AH            ; nastala chyba operace ?
F000:A62A 7401           JZ     A62D             ; nenastala chyba operace
F000:A62C F9             STC                     ; CY - p©°znak chyby operace
F000:A62D C3           * RET
; -----------------------------------------------------------------------------
;              opakovanò z†pis dat zadanÇho poátu sektorñ na disk
; -----------------------------------------------------------------------------
F000:A62E E8C601         CALL   A7F7             ; p©°prava parametrñ operace
F000:A631 7303           JNB    A636             ; parametry zad†ny OK
F000:A633 EB69           JMP    A69E             ; n†vrat p©i chybà parametrñ
F000:A635 90             NOP     
F000:A636 E84902       * CALL   A882             ; vòbàr disku, áek†n° na p©ipr.
F000:A639 7263           JB     A69E             ; chyba TIME-OUT ©adiáe
F000:A63B 8CC7           MOV    DI,ES            ; £schova segmentu adresy buff.
F000:A63D 8BF3           MOV    SI,BX            ; offset adresy bufferu
F000:A63F E88503         CALL   A9C7             ; nastaven° podle ©°d. bajtu
F000:A642 E89101         CALL   A7D6             ; poskytnut° adresy tab. param.
F000:A645 F6067600C0     TEST   Byte Ptr [0076],C0 ; je z†kaz opakov†n° ?
F000:A64A 7402           JZ     A64E             ; nen° povoleno opakov†n°
F000:A64C FEC4           INC    AH               ; p©°znak opakov†n° operace
F000:A64E E89803       * CALL   A9E9             ; nastaven° hlavy, v†lce, ...
F000:A651 E8FA01         CALL   A84E             ; nastaven° v†lce pro p©edkomp.
F000:A654 8AC4           MOV    AL,AH            ; ©°dic° slovo ©adiáe
F000:A656 E81203         CALL   A96B             ; vysl†n° povelu na ©adiá diskñ
F000:A659 E88C02         CALL   A8E8             ; áek†n° na poëadavek dat
F000:A65C 7240           JB     A69E             ; chyba TIME-OUT
F000:A65E 8EDF         * MOV    DS,DI            ; segment bufferu
F000:A660 B90001         MOV    CX,0100          ; dÇlka sektoru ve slovech
F000:A663 BAF001         MOV    DX,01F0          ; vòstupn° datovò port
F000:A666 FA             CLI                     ; z†kaz p©eru®en°
F000:A667 FC             CLD                     ; smàr nahoru
F000:A668 F3             REPZ   
F000:A669 6F             OUTSW                   ; vysl†n° sektoru do ©adiáe
F000:A66A FB             STI                     ; povolen° p©eru®en°
F000:A66B F6460802       TEST   Byte Ptr [BP+08],02 ; je dlouhò z†pis ?
F000:A66F 7419           JZ     A68A             ; nen° dlouhò z†pis
F000:A671 6A40           PUSH   40               ; datovò segment BIOS
F000:A673 1F             POP    DS               ; DS <- 40h dat. segment BIOS
F000:A674 E87102         CALL   A8E8             ; áek†n° na poëadavek dat
F000:A677 7225           JB     A69E             ; chyba TIME-OUT
F000:A679 B90400         MOV    CX,0004          ; dÇlka dat ECC
F000:A67C 8EDF           MOV    DS,DI            ; segment s daty sektoru
F000:A67E 8A04           MOV    AL,[SI]          ; bajt k¢du ECC
F000:A680 46             INC    SI               ; zvò®en° adresy v bufferu
F000:A681 EE             OUT    DX,AL            ; vysl†n bajtu k¢du ECC
F000:A682 EB00           JMP    A684             ; mal† prodleva
F000:A684 EB00         * JMP    A686             ; mal† prodleva
F000:A686 EB00         * JMP    A688             ; mal† prodleva
F000:A688 E2F4         * LOOP   A67E             ; z†pis dal®°ho bajtu k¢du ECC
F000:A68A 6A40         * PUSH   40               ; datovò segment BIOS
F000:A68C 1F             POP    DS               ; DS <- 40h dat. segment BIOS
F000:A68D E83102         CALL   A8C1             ; áek†n° na p©eru®en° od ©adiáe
F000:A690 720C           JB     A69E             ; chyba TIME-OUT
F000:A692 E87402         CALL   A909             ; test stavu provedenÇ operace
F000:A695 7207           JB     A69E             ; nastala chyba operace
F000:A697 F6068C0008     TEST   Byte Ptr [008C],08 ; byl poëadavek dat ?
F000:A69C 75C0           JNZ    A65E             ; byl poëadavek dat
F000:A69E C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 0Ch - vystaven° hlav na v†lec
; -----------------------------------------------------------------------------
F000:A69F E85501         CALL   A7F7             ; p©°prava parametrñ operace
F000:A6A2 7259           JB     A6FD             ; chyba zad†n° parametrñ
F000:A6A4 E8DB01         CALL   A882             ; vòbàr disku, áek†n° na p©ipr.
F000:A6A7 7254           JB     A6FD             ; chyba TIME-OUT disku
F000:A6A9 E81B03         CALL   A9C7             ; nastaven° podle ©°d. bajtu
F000:A6AC 8AC5           MOV    AL,CH            ; á°slo v†lce - LOW
F000:A6AE 8AEA           MOV    CH,DL            ; á°slo v†lce - bity 8 a 9
F000:A6B0 BAF401         MOV    DX,01F4          ; regitr á°sla v†lce - LOW
F000:A6B3 884605         MOV    [BP+05],AL       ; uloëen° á°sla v†lce - LOW
F000:A6B6 EE             OUT    DX,AL            ; nastaven° á°sla v†lce - LOW
F000:A6B7 EB00           JMP    A6B9             ; mal† prodleva
F000:A6B9 EB00         * JMP    A6BB             ; mal† prodleva
F000:A6BB 8AC1         * MOV    AL,CL            ; á°slo v†lce - bity 8 a 9
F000:A6BD C0E806         SHR    AL,06            ; bity 8 a 9 -> bity 0 a 1
F000:A6C0 8A5615         MOV    DL,[BP+15]       ; á°slo hlavy
F000:A6C3 C0EA04         SHR    DL,04            ; á°slo v†lce - bity 10 a 11
F000:A6C6 80E20C         AND    DL,0C            ; ponech† bity 10 a 11 v†lce
F000:A6C9 0AC2           OR     AL,DL            ; á°slo v†lce - HIGH
F000:A6CB BAF501         MOV    DX,01F5          ; registr á°sla v†lce - HIGH
F000:A6CE 884606         MOV    [BP+06],AL       ; £schova á°sla v†lce - HIGH
F000:A6D1 EE             OUT    DX,AL            ; nastaven° á°sla v†lce - HIGH
F000:A6D2 EB00           JMP    A6D4             ; mal† prodleva
F000:A6D4 EB00           JMP    A6D6             ; mal† prodleva
F000:A6D6 8A4607         MOV    AL,[BP+07]       ; k¢d pro vòbàr disku a hlavy
F000:A6D9 BAF601         MOV    DX,01F6          ; registr volby disku a hlavy
F000:A6DC EE             OUT    DX,AL            ; vòbàr disku a hlavy
F000:A6DD E86E01         CALL   A84E             ; nastaven° v†lce pro p©edkomp.
F000:A6E0 B070           MOV    AL,70            ; povel pro vystaven° na v†lec
F000:A6E2 E88602         CALL   A96B             ; vysl†n° povelu na ©adiá diskñ
F000:A6E5 E8D901         CALL   A8C1             ; áek†n° na p©eru®en° od ©adiáe
F000:A6E8 7213           JB     A6FD             ; chyba TIME-OUTY
F000:A6EA E81C02         CALL   A909             ; test stavu provedenÇ operace
F000:A6ED 730E           JNB    A6FD             ; operace probàhla OK
F000:A6EF 803E740040     CMP    Byte Ptr [0074],40 ; byla chyba vystaven° ?
F000:A6F4 F9             STC                     ; p©°znak chyby vystaven°
F000:A6F5 7506           JNZ    A6FD             ; nebyla chyba vystaven°
F000:A6F7 32E4           XOR    AH,AH            ; n†vratovò k¢d - operace OK
F000:A6F9 88267400       MOV    [0074],AH        ; uloëen° n†vratovÇho k¢du
F000:A6FD C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 10h - test p©ipravenosti pevnÇho disku
; -----------------------------------------------------------------------------
F000:A6FE E8F600         CALL   A7F7             ; p©°prava parametrñ operace
F000:A701 7228           JB     A72B             ; chyba á°sla pevnÇho disku
F000:A703 E85401         CALL   A85A             ; áek†n° na p©ipravenost ©adiáe
F000:A706 7223           JB     A72B             ; chyba TIME-OUT ©adiáe
F000:A708 BAF601         MOV    DX,01F6          ; registr vòbàru disku a hlav
F000:A70B 8A4607         MOV    AL,[BP+07]       ; k¢d pro vòbàr disku a hlavy
F000:A70E EE             OUT    DX,AL            ; vòbàr disku a hlavy
F000:A70F BAF701         MOV    DX,01F7          ; stavovò registr ©adiáe
F000:A712 51             PUSH   CX               ; £schova CX
F000:A713 B90200         MOV    CX,0002          ; max. doba prodlevy
F000:A716 E84F49         CALL   F068             ; kr†tk† prodleva
F000:A719 59             POP    CX               ; n†vrat CX
F000:A71A EC             IN     AL,DX            ; áten° stavu ©adiáe
F000:A71B A28C00         MOV    [008C],AL        ; uloëen° statutu ©adiáe disku
F000:A71E B400           MOV    AH,00            ; n†vratovò k¢d - OK
F000:A720 A840           TEST   AL,40            ; je disk p©ipraven ?
F000:A722 7503           JNZ    A727             ; disk je p©ipraven OK
F000:A724 B4AA           MOV    AH,AA            ; n†vratovò k¢d - nep©ipraven
F000:A726 F9             STC                     ; p©°znak chyby operace
F000:A727 88267400       MOV    [0074],AH        ; uloëen° n†vrat. k¢du chyby
F000:A72B C3           * RET
; -----------------------------------------------------------------------------
;         FUNKCE 11h - p©ekalibrov†n° pevnÇho disku
; -----------------------------------------------------------------------------
                                               ;* p©ekalibrov†n° pevnÇho disku
F000:A72C E8C800         CALL   A7F7             ; p©°prava parametrñ operace
F000:A72F 7224           JB     A755             ; chyba zad†n° parametrñ
F000:A731 E84E01         CALL   A882             ; vòbàr disku, áek†n° na p©ipr.
F000:A734 721F           JB     A755             ; chyba TIME-OUT disku
F000:A736 E88E02         CALL   A9C7             ; nastaven° podle ©°d. bajtu
F000:A739 BAF601         MOV    DX,01F6          ; registr vòbàru disku a hlav
F000:A73C 8A4607         MOV    AL,[BP+07]       ; k¢d pro vòbàr disku a hlavy
F000:A73F EE             OUT    DX,AL            ; vòbàr disku a hlav
F000:A740 E80B01         CALL   A84E             ; nastaven° v†lce pro p©edkomp.
F000:A743 B010           MOV    AL,10            ; povel pro p©ekalibrov†n°
F000:A745 E82302         CALL   A96B             ; vysl†n° povelu na ©adiá diskñ
F000:A748 E87601         CALL   A8C1             ; áek†n° na p©eru®en° od ©adiáe
F000:A74B 7305           JNB    A752             ; operace probàhla OK
F000:A74D E87101         CALL   A8C1             ; áek†n° na p©eru®en° od ©adiáe
F000:A750 7203           JB     A755             ; chyba - TIME-OUT
F000:A752 E8B401         CALL   A909             ; test stavu provedenÇ operace
F000:A755 C3           * RET
; -----------------------------------------------------------------------------
;         FUNCKE 14h - diagnostika ©adiáe
; -----------------------------------------------------------------------------
F000:A756 E86E02         CALL   A9C7             ; nastaven° podle ©°d. bajtu
F000:A759 E8FE00         CALL   A85A             ; áek†n° na p©ipravenost ©adiáe
F000:A75C 721E           JB     A77C             ; chyba TIME-OUT - nep©ipraven
F000:A75E B090           MOV    AL,90            ; k¢d povelu pro diagnostiku
F000:A760 E80802         CALL   A96B             ; vysl†n° povelu na ©adiá diskñ
F000:A763 E85B01         CALL   A8C1             ; áek†n° na p©eru®en° od ©adiáe
F000:A766 7214           JB     A77C             ; chyba TIME-OUT
F000:A768 BAF101         MOV    DX,01F1          ; chybovò registr
F000:A76B EC             IN     AL,DX            ; p©eáten° chybovÇho registru
F000:A76C A28D00         MOV    [008D],AL        ; uloëen° k¢du chyby operace
F000:A76F B420           MOV    AH,20            ; n†vrat. k¢d - chyba ©adiáe
F000:A771 3C01           CMP    AL,01            ; je k¢d pro "v®e OK" ?
F000:A773 F9             STC                     ; CY=p©°znak chyby
F000:A774 7502           JNZ    A778             ; nen° k¢d "v®e OK"
F000:A776 32E4           XOR    AH,AH            ; n†vratovò k¢d - v®e OK
F000:A778 88267400     * MOV    [0074],AH        ; uloëen° n†vratovÇho k¢du
F000:A77C C3           * RET
; -----------------------------------------------------------------------------
;                  áten° typu DASD
; -----------------------------------------------------------------------------
F000:A77D E87700         CALL   A7F7             ; p©°prava parametrñ operace
F000:A780 7307           JNB    A789             ; parametry zad†ny OK
F000:A782 32E4           XOR    AH,AH            ; identifikace-disk nep©°tomen
F000:A784 33C9           XOR    CX,CX            ; poáet sektorñ mÇdia - HIGH
F000:A786 33D2           XOR    DX,DX            ; poáet sektorñ mÇdia - LOW
F000:A788 C3             RET


F000:A789 E85700       * CALL   A7E3             ; poskytnut° adresy tab. param.
F000:A78C 268B07         MOV    AX,ES:[BX]       ; maxim†ln° poáet v†lcñ
F000:A78F 48             DEC    AX               ; á°slo posledn°ho v†lce
F000:A790 268A4F0E       MOV    CL,ES:[BX+0E]    ; poáet sektorñ na stopu
F000:A794 B500           MOV    CH,00            ; CH <- 0
F000:A796 F7E1           MUL    CX               ; AX<-poáet sektorñ na povrch
F000:A798 268A4F02       MOV    CL,ES:[BX+02]    ; poáet hlav disku
F000:A79C B500           MOV    CH,00            ; CH <- 0
F000:A79E F7E1           MUL    CX               ; DX:AX<-celkovò poáet sektorñ
F000:A7A0 8BCA           MOV    CX,DX            ; poáet sektorñ mÇdia - HIGH
F000:A7A2 8BD0           MOV    DX,AX            ; poáet sektorñ mÇdia - LOW
F000:A7A4 B403           MOV    AH,03            ; p©°znak - je pevnò disk
F000:A7A6 F8             CLC                     ; p©°znak - operace OK
F000:A7A7 C3             RET
; -----------------------------------------------------------------------------
;         FUNKCE 19h - zaparkov†n° hlav
; -----------------------------------------------------------------------------
F000:A7A8 E82B00         CALL   A7D6             ; poskytnut° adresy tab. param.
F000:A7AB 7307           JNB    A7B4             ; zad†n° parametrñ OK
F000:A7AD B401           MOV    AH,01            ; k¢d chyby - neplatnò povel
F000:A7AF 88267400       MOV    [0074],AH        ; nastaven° k¢du chyby
F000:A7B3 C3             RET

F000:A7B4 8A7615       * MOV    DH,[BP+15]       ; £schova DH
F000:A7B7 52             PUSH   DX               ; £schova DX
F000:A7B8 268B470C       MOV    AX,ES:[BX+0C]    ; parkovac° stopa
F000:A7BC 8AE8           MOV    CH,AL            ; parkovac° stopa - LOW
F000:A7BE 8ACC           MOV    CL,AH            ; parkovac° stopa - HIGH
F000:A7C0 C0E106         SHL    CL,06            ; <<<
F000:A7C3 8AF4           MOV    DH,AH            ; parkovac° stopa - HIGH
F000:A7C5 C0E604         SHL    DH,04            ; <<<
F000:A7C8 80E6C0         AND    DH,C0            ; nejvy®®° 2 bity
F000:A7CB 887615         MOV    [BP+15],DH       ; poëadovanÇ hlavy
F000:A7CE E8CEFE         CALL   A69F             ; vystaven° hlavy na v†lec
F000:A7D1 5A             POP    DX               ; n†vrat DX
F000:A7D2 887615         MOV    [BP+15],DH       ; n†vrat DH
F000:A7D5 C3             RET     

; -----------------------------------------------------------------------------
;              Poskytnut° adresy tabulky parametrñ pevnÇho disku
; -----------------------------------------------------------------------------
F000:A7D6 80FA81         CMP    DL,81            ; kontrola á°sla disku
F000:A7D9 7608           JBE    A7E3             ; poskytnut° adresy tab. param.
F000:A7DB B401           MOV    AH,01            ; n†vrat. k¢d - neplatnò povel
F000:A7DD 88267400       MOV    [0074],AH        ; uloëen° k¢du chyby
F000:A7E1 F9             STC                     ; p©°znak chyby operace
F000:A7E2 C3             RET     
; -----------------------------------------------------------------------------
;                 Poskytnut° adresy tabulky parametrñ pevnÇho disku
; -----------------------------------------------------------------------------
                                               ;* poskytnut° adresy tab. param.
F000:A7E3 33DB         * XOR    BX,BX            ; BX <- 0
F000:A7E5 8EC3           MOV    ES,BX            ; ES <- 0 segment vektorñ p©er.
F000:A7E7 F6C201         TEST   DL,01            ; je disk 1 ?
F000:A7EA BB0401         MOV    BX,0104          ; adresa ukazatele INT 41h
F000:A7ED 7403           JZ     A7F2             ; je pevnò disk 0
F000:A7EF BB1801         MOV    BX,0118          ; adresa ukazatele INT 46h
F000:A7F2 26C41F       * LES    BX,ES:[BX]       ; áten° adresy ukazatele param.
F000:A7F5 F8             CLC                     ; CN=p©°znak OK
F000:A7F6 C3             RET     
; -----------------------------------------------------------------------------
;                           P©°prava parametrñ operace
; -----------------------------------------------------------------------------
                                               ;* kontrola á°sla disku
F000:A7F7 50             PUSH   AX               ; £schova povelu (AL)
F000:A7F8 A07500         MOV    AL,[0075]        ; poáet pevnòch diskñ
F000:A7FB 8AE2           MOV    AH,DL            ; á°slo pevnÇho disku
F000:A7FD 80E47F         AND    AH,7F            ; reset p©°znaku pevnÇho disku
F000:A800 3AC4           CMP    AL,AH            ; je p©ekroáeno á°slo disku ?
F000:A802 58             POP    AX               ; n†vrat povelu (AL)
F000:A803 7641           JBE    A846             ; neplatnÇ á°slo disku
F000:A805 83FF2A         CMP    DI,+2A           ; je funkce 15h ?
F000:A808 743A           JZ     A844             ; je funkce 15h (áten° DASD)
F000:A80A 83FF10         CMP    DI,+10           ; je funkce 8 (parametry) ?
F000:A80D 7435           JZ     A844             ; je funkce 8 (parametry disku)
                                               ;* p©°prava parametrñ operace
F000:A80F 06             PUSH   ES
F000:A810 53             PUSH   BX 
F000:A811 52             PUSH   DX 
F000:A812 51             PUSH   CX 
F000:A813 E8CDFF         CALL   A7E3             ; poskytnut° adresy tab. param.
F000:A816 268B4F05       MOV    CX,ES:[BX+05]    ; poá†t. stopa p©edkompenzace
F000:A81A C1E902         SHR    CX,02            ; stopa p©edkompenazace/2
F000:A81D 884E02         MOV    [BP+02],CL       ; £schova v†lce p©edkompenzace
F000:A820 B1A0           MOV    CL,A0            ; k¢d pro vòbàr disku 0
F000:A822 F6C201         TEST   DL,01            ; je disk 1 ?
F000:A825 7402           JZ     A829             ; je pevnò disk 0
F000:A827 B1B0           MOV    CL,B0            ; k¢d pro vòbàr disku 1
F000:A829 83FF12       * CMP    DI,+12           ; je sluëba 9 (inicial. tab.)
F000:A82C 750A           JNZ    A838             ; nen° sluëba 9 (inicializace)
F000:A82E 268A7702       MOV    DH,ES:[BX+02]    ; poáet hlav disku
F000:A832 FECE           DEC    DH               ; á°slo hlavy - 1
F000:A834 0ACE           OR     CL,DH            ; nastaven° á°sla hlavy
F000:A836 EB05           JMP    A83D 
F000:A838 80E60F       * AND    DH,0F            ; maskov†n° á°sla hlavy
F000:A83B 0ACE           OR     CL,DH            ; nastaven° á°sla hlavy
F000:A83D 884E07       * MOV    [BP+07],CL       ; k¢d pro vòbàr disku a hlavy
F000:A840 59             POP    CX 
F000:A841 5A             POP    DX 
F000:A842 5B             POP    BX 
F000:A843 07             POP    ES 
F000:A844 F8             CLC     
F000:A845 C3             RET
                                               ;* chyba - neplatnò povel
F000:A846 B401         * MOV    AH,01            ; k¢d chyby - neplatnò povel
F000:A848 88267400       MOV    [0074],AH        ; nastaven° k¢du chyby
F000:A84C F9             STC                     ; CY=p©°znak chyby
F000:A84D C3             RET     
; -----------------------------------------------------------------------------
;                    nastaven° v†lce pro p©edkompenzaci
; -----------------------------------------------------------------------------
F000:A84E 52             PUSH   DX
F000:A84F 50             PUSH   AX 
F000:A850 8A4602         MOV    AL,[BP+02]       ; v†lec p©edkompenzace
F000:A853 BAF101         MOV    DX,01F1          ; registr p©edkompenzace
F000:A856 EE             OUT    DX,AL            ; nastaven° v†lce p©edkompenz.
F000:A857 58             POP    AX 
F000:A858 5A             POP    DX 
F000:A859 C3             RET     
; -----------------------------------------------------------------------------
;                        áek†n° na p©ipravenost ©adiáe
; -----------------------------------------------------------------------------
                                               ;* áek†n° na p©ipravenost ©adiáe
F000:A85A FB             STI                     ; povolen° p©eru®en°
F000:A85B 51             PUSH   CX               ; £schova CX
F000:A85C 52             PUSH   DX               ; £schova DX
F000:A85D 50             PUSH   AX               ; £schova AX
F000:A85E B91000         MOV    CX,0010          ; poáet pokusñ p©i áek†n°
F000:A861 BAF701         MOV    DX,01F7          ; stavovò registr pevnÇho disku
F000:A864 B480           MOV    AH,80            ; maska pro áek†n° na p©iprav.
                                               ;* áek†n° na p©ipravenost ©adiáe
F000:A866 51           * PUSH   CX               ; £schova á°taáe pokusñ
F000:A867 33C9           XOR    CX,CX            ; inicializaán° prodleva áek†n°
F000:A869 E8EE46         CALL   EF5A             ; áek†n° na p©ipravenost
F000:A86C 59             POP    CX               ; n†vrat á°taáe pokusñ
F000:A86D 730F           JNB    A87E             ; ©adiá je jië p©ipraven
F000:A86F E2F5           LOOP   A866             ; dal®° pokus o p©ipravenost
                                               ;* chyba - ©adiá nep©ipraven
F000:A871 EC             IN     AL,DX            ; áten° stavovÇho registru
F000:A872 A28C00         MOV    [008C],AL        ; £schova stavu ©adiáe disku
F000:A875 58             POP    AX               ; n†vrat AX
F000:A876 B480           MOV    AH,80            ; chyba operace - TIME-OUT
F000:A878 88267400       MOV    [0074],AH        ; £schova statutu operace
F000:A87C EB01           JMP    A87F             ; n†vrat
F000:A87E 58           * POP    AX               ; n†vrat registru AX
F000:A87F 5A           * POP    DX               ; n†vrat DX
F000:A880 59             POP    CX               ; n†vrat CX
F000:A881 C3             RET     
; -----------------------------------------------------------------------------
;              vòbàr disku a hlavy, áek†n° na p©ipravenost
; -----------------------------------------------------------------------------
                                               ;* vòbàr disku, áek†n° na p©ipr.
F000:A882 52             PUSH   DX               ; £schova DX
F000:A883 51             PUSH   CX               ; £schova CX
F000:A884 50             PUSH   AX               ; £schova AX
F000:A885 B90006         MOV    CX,0600          ; á°taá pokusñ o vystaven°
F000:A888 E8CFFF         CALL   A85A             ; áek†n° na p©ipravenost ©adiáe
F000:A88B 7228           JB     A8B5             ; chyba - ©adiá nen° p©ipraven
F000:A88D BAF601         MOV    DX,01F6          ; registr vòbàru hlav a disku
F000:A890 8A4607         MOV    AL,[BP+07]       ; k¢d pro vòbàr hlav a disku
F000:A893 EE             OUT    DX,AL            ; vòbàr disky a hlavy
F000:A894 51             PUSH   CX               ; £schova CX
F000:A895 B90200         MOV    CX,0002          ; max. doba prodlevy
F000:A898 E8CD47         CALL   F068             ; kr†tk† prodleva
F000:A89B 59             POP    CX               ; n†vrat CX
F000:A89C BAF701         MOV    DX,01F7          ; stavovò registr ©adiáe
F000:A89F EC             IN     AL,DX            ; áten° stavu operace ©adiáe
F000:A8A0 B4AA           MOV    AH,AA            ; k¢d chyby - disk nep©ipraven
F000:A8A2 A840           TEST   AL,40            ; je disk p©ipraven ?
F000:A8A4 7406           JZ     A8AC             ; disk nen° p©ipraven
F000:A8A6 B440           MOV    AH,40            ; k¢d chyby - chyba vystaven°
F000:A8A8 A810           TEST   AL,10            ; je vystaven° provedeno ?
F000:A8AA 7510           JNZ    A8BC             ; vystaven° je provedeno
F000:A8AC E2DA         * LOOP   A888             ; dal®° pokus o vystaven°
F000:A8AE A28C00         MOV    [008C],AL        ; £schova statutu ©adiáe disku
F000:A8B1 88267400       MOV    [0074],AH        ; £schova chybovÇho k¢du
F000:A8B5 59           * POP    CX               ; n†vrat obsahu AX
F000:A8B6 8AC1           MOV    AL,CL            ; n†vrat obsahu registru AL
F000:A8B8 59             POP    CX               ; n†vrat CX
F000:A8B9 5A             POP    DX               ; n†vrat DX
F000:A8BA F9             STC                     ; CY=p©°znak chyby operace
F000:A8BB C3             RET     

F000:A8BC 58           * POP    AX               ; n†vrat registru AX
F000:A8BD 59             POP    CX               ; n†vrat CX
F000:A8BE 5A             POP    DX               ; n†vrat DX
F000:A8BF F8             CLC                     ; CN=p©°znak operace OK
F000:A8C0 C3             RET     
; -----------------------------------------------------------------------------
;        áek†n° na p©eru®en° od ©adiáe pevnòch diskñ po dokonáen° operace
; -----------------------------------------------------------------------------
F000:A8C1 F8             CLC                     ; p©°znak NC
F000:A8C2 B80090         MOV    AX,9000          ; zanepr†zdnàn° pevnÇho disku
F000:A8C5 CD15           INT    15               ; ozn†men° o zanepr†zdnàn°
F000:A8C7 FB             STI                     ; povolen° p©eru®en°
F000:A8C8 7210           JB     A8DA             ; chyba TIME-OUT ©adiáe
F000:A8CA BB8E00         MOV    BX,008E          ; adresa pro test p©eru®en°
F000:A8CD BA1000         MOV    DX,0010          ; á°taá cyklñ áekac° smyáky
F000:A8D0 33C9         * XOR    CX,CX            ; vnit©n° á°taá áekac° smyáky
F000:A8D2 E8CD46         CALL   EFA2             ; test p©°chodu p©eru®en°
F000:A8D5 730B           JNB    A8E2             ; nastalo p©eru®en°
F000:A8D7 4A             DEC    DX               ; á°taá cyklñ áekac° smyáky
F000:A8D8 75F6           JNZ    A8D0             ; dal®° áekac° smyáka
F000:A8DA B480         * MOV    AH,80            ; k¢d chyby TIME-OUT ©adiáe
F000:A8DC 88267400       MOV    [0074],AH        ; nastaven° k¢du chyby ©adiáe
F000:A8E0 EB05           JMP    A8E7             ; byla chyba TIME-OUT
F000:A8E2 C6068E0000   * MOV    Byte Ptr [008E],00 ; zru®en° p©°znaku p©eru®en°
F000:A8E7 C3           * RET
; -----------------------------------------------------------------------------
;                         áek†n° na poëadavek dat
; -----------------------------------------------------------------------------
F000:A8E8 51             PUSH   CX               ; £schova CX
F000:A8E9 52             PUSH   DX               ; £schova DX
F000:A8EA 50             PUSH   AX               ; £schova AX
F000:A8EB B9C800         MOV    CX,00C8          ; max. poáet
F000:A8EE BAF701         MOV    DX,01F7          ; adresa stavovÇho registru
F000:A8F1 B408           MOV    AH,08            ; maska pro test stavu
F000:A8F3 E88846         CALL   EF7E             ; áek†n° na poëadavek dat
F000:A8F6 730D           JNB    A905             ; poëadavek p©i®el OK
F000:A8F8 EC             IN     AL,DX            ; áten° stavovÇho slova ©adiáe
F000:A8F9 A28C00         MOV    [008C],AL        ; uloëen° statutu ©adiáe
F000:A8FC 58             POP    AX               ; n†vrat AX
F000:A8FD B480           MOV    AH,80            ; k¢d chyby - TIME-OUT
F000:A8FF 88267400       MOV    [0074],AH        ; uloëen° k¢du chyby operace
F000:A903 EB01           JMP    A906 
F000:A905 58           * POP    AX               ; n†vrat AX
F000:A906 5A           * POP    DX               ; n†vrat DX
F000:A907 59             POP    CX               ; n†vrat CX
F000:A908 C3             RET
; -----------------------------------------------------------------------------
;                          test stavu provedenÇ operace
; -----------------------------------------------------------------------------
F000:A909 52             PUSH   DX               ; £schova DX
F000:A90A 50             PUSH   AX               ; £schova AX
                                               ;* chyby stavu ©adiáe
F000:A90B BAF701         MOV    DX,01F7          ; stavovò registr ©adiáe diskñ
F000:A90E EC             IN     AL,DX            ; áten° stavovÇho slova ©adiáe
F000:A90F A28C00         MOV    [008C],AL        ; uloëen° stavovÇho slova
F000:A912 B411           MOV    AH,11            ; n†vrat. k¢d - korekce s ECC
F000:A914 A804           TEST   AL,04            ; byla korekce pomoc° ECC ?
F000:A916 7545           JNZ    A95D             ; provedla se korekce s ECC
F000:A918 B4CC           MOV    AH,CC            ; n†vrat. k¢d - chyba z†pisu
F000:A91A A820           TEST   AL,20            ; byla chyba z†pisu ?
F000:A91C 753F           JNZ    A95D             ; nastala chyba z†pisu
F000:A91E B4AA           MOV    AH,AA            ; n†vrat.k¢d - disk nep©ipraven
F000:A920 A840           TEST   AL,40            ; chyba nep©ipravenosti ?
F000:A922 7439           JZ     A95D             ; disk nebyl p©ipraven
F000:A924 B440           MOV    AH,40            ; n†vrat. k¢d - chyba vystaven°
F000:A926 A810           TEST   AL,10            ; nastala chyba vystaven° ?
F000:A928 7433           JZ     A95D             ; nastala chyba vystaven°
F000:A92A B400           MOV    AH,00            ; n†vrat. k¢d - operace OK
F000:A92C A801           TEST   AL,01            ; nastala nàjak† chyba ?
F000:A92E 742D           JZ     A95D             ; nenastala ë†dn† chyba
                                               ;* z†vaënÇ chyby operace
F000:A930 BAF101         MOV    DX,01F1          ; chybovò registr
F000:A933 EC             IN     AL,DX            ; áten° k¢du chyby operace
F000:A934 A28D00         MOV    [008D],AL        ; uloëen° chybovÇho statutu
F000:A937 B402           MOV    AH,02            ; n†vrat. k¢d - znaáka nenalez.
F000:A939 A801           TEST   AL,01            ; nalezena adres. znaáka dat ?
F000:A93B 7520           JNZ    A95D             ; adres. znaáka dat nenalezena
F000:A93D B401           MOV    AH,01            ; n†vrat. k¢d - neplatnò povel
F000:A93F A804           TEST   AL,04            ; byl platnò povel ?
F000:A941 751A           JNZ    A95D             ; byl neplatnò povel
F000:A943 B404           MOV    AH,04            ; n†vrat.k¢d - sektor nenalezen
F000:A945 A810           TEST   AL,10            ; byl sektor nalezen ?
F000:A947 7514           JNZ    A95D             ; sektor nebyl nalezen
F000:A949 B410           MOV    AH,10            ; n†vrat. k¢d - chyba dat ECC
F000:A94B A840           TEST   AL,40            ; byla chyba dat ECC ?
F000:A94D 750E           JNZ    A95D             ; byla chyba dat ECC
F000:A94F B440           MOV    AH,40            ; n†vrat. k¢d - chyba vystaven°
F000:A951 A802           TEST   AL,02            ; byla nalezena stopa 0 ?
F000:A953 7508           JNZ    A95D             ; stopa 0 nenalezena
F000:A955 B40A           MOV    AH,0A            ; n†vrat. k¢d - vadnÇ n†và®t°
F000:A957 A880           TEST   AL,80            ; bylo vadnÇ n†và®t° sektoru ?
F000:A959 7502           JNZ    A95D             ; bylo vadnÇ n†và®t° sektoru
F000:A95B B4BB           MOV    AH,BB            ; n†vrat. k¢d - nedefin. chyba
F000:A95D 88267400     * MOV    [0074],AH        ; uloëen° k¢du chyby
F000:A961 5A             POP    DX               ; n†vrat registru AX
F000:A962 8AC2           MOV    AL,DL            ; pñvodn° obsah registru AL
F000:A964 5A             POP    DX               ; n†vrat registru DX
F000:A965 0AE4           OR     AH,AH            ; nastala chyba operace ?
F000:A967 7401           JZ     A96A             ; operace probàhla OK
F000:A969 F9             STC                     ; CY - p©°znak chyby operace
F000:A96A C3             RET     
; -----------------------------------------------------------------------------
;                 Vysl†n° povelu na ©adiá pevnòch diskñ (AL=povel)
; -----------------------------------------------------------------------------
F000:A96B E8ECFE         CALL   A85A             ; áek†n° na p©ipravenost ©adiáe
                                               ;* povolen° p©eru®en° od ©adiáe
                                               ;* pevnòch diskñ (INT 76h)
F000:A96E FA             CLI                     ; z†kaz p©eru®en°
F000:A96F 50             PUSH   AX               ; £schova AX (povel)
F000:A970 C6068E0000     MOV    Byte Ptr [008E],00 ; p©°znak ©°zen° p©eru®en°
F000:A975 E4A1           IN     AL,A1            ; áten° masky p©eru®en°  #2
F000:A977 EB00           JMP    A979             ; mal† prodleva
F000:A979 EB00         * JMP    A97B             ; mal† prodleva
F000:A97B 24BF         * AND    AL,BF            ; povolen° p©eru®en° od ©adiáe
F000:A97D E6A1           OUT    A1,AL            ; nastaven° novÇ masky
                                               ;* povolen° p©eru®en° od ©adiáe
                                               ;* pruënòch diskñ (INT 0Eh)
F000:A97F E421           IN     AL,21            ; áten° masky p©eru®en° #1
F000:A981 EB00           JMP    A983             ; mal† prodleva
F000:A983 EB00           JMP    A985             ; mal† prodleva
F000:A985 24FB           AND    AL,FB            ; povolen° p©eru®en° od ©adiáe
F000:A987 E621           OUT    21,AL            ; nastaven° novÇ masky
F000:A989 EB00           JMP    A98B             ; mal† prodleva
F000:A98B EB00           JMP    A98D             ; mal† prodleva
F000:A98D 58             POP    AX               ; n†vrat AX (povel)
                                               ;* vysl†n° povelovÇho slova
F000:A98E 52             PUSH   DX               ; £schova DX
F000:A98F BAF701         MOV    DX,01F7          ; povelovò registr disku
F000:A992 884608         MOV    [BP+08],AL       ; £schova povelovÇho bajtu
F000:A995 EE             OUT    DX,AL            ; nastaven° povelu pro ©adiá
F000:A996 5A             POP    DX               ; n†vrat DX
F000:A997 FB             STI                     ; povolen° p©eru®en°
F000:A998 C3             RET     
; -----------------------------------------------------------------------------
;         kontrola adresy DTA bufferu pro diskovou operaci
; -----------------------------------------------------------------------------
F000:A999 52             PUSH   DX               ; £schova DX
F000:A99A 50             PUSH   AX               ; £schova AX
F000:A99B 8BC3           MOV    AX,BX            ; offset ukl†dac° adresy
F000:A99D C1E804         SHR    AX,04            ; p©epoáet offsetu na odstavce
F000:A9A0 8CC2           MOV    DX,ES            ; segment adresy bufferu DTA
F000:A9A2 03C2           ADD    AX,DX            ; absolutn° segment bufferu
F000:A9A4 8EC0           MOV    ES,AX            ; absolutn° segment bufferu
F000:A9A6 81E30F00       AND    BX,000F          ; ponech† offset v odstavci
F000:A9AA B80000         MOV    AX,0000          ; AX <- 0
F000:A9AD BA0100         MOV    DX,0001          ; DX <- 1
F000:A9B0 2BC3           SUB    AX,BX            ;
F000:A9B2 83DA00         SBB    DX,+00           ; negace offsetu
F000:A9B5 F77618         DIV    Word Ptr [BP+18] ; dÇlka datovÇho bufferu
F000:A9B8 8AD0           MOV    DL,AL 
F000:A9BA 58             POP    AX 
F000:A9BB 3AD0           CMP    DL,AL 
F000:A9BD 5A             POP    DX 
F000:A9BE 7306           JNB    A9C6             ;
F000:A9C0 B409           MOV    AH,09            ; n†vrat.k¢d - chyba adresy DTA
F000:A9C2 88267400       MOV    [0074],AH        ; ul¢zen° koÉu chyby DTA
F000:A9C6 C3             RET     

; -----------------------------------------------------------------------------
;               Nastaven° podle ©°dic°ho bajtu z parametrñ
; -----------------------------------------------------------------------------
F000:A9C7 06             PUSH   ES
F000:A9C8 53             PUSH   BX 
F000:A9C9 52             PUSH   DX 
F000:A9CA 50             PUSH   AX 
F000:A9CB E815FE         CALL   A7E3             ; poskytnut° adresy tab. param.
F000:A9CE 268A4708       MOV    AL,ES:[BX+08]    ; ©°dic° bajt ©adiáe disku
F000:A9D2 8AE0           MOV    AH,AL            ; ©°dic° bajt ©adiáe disku
F000:A9D4 2408           AND    AL,08            ; p©°znak - v°ce neë 8 hlav
F000:A9D6 BAF603         MOV    DX,03F6          ; registr volby disku a hlav
F000:A9D9 EE             OUT    DX,AL            ; nastaven° poátu hlav
F000:A9DA A07600         MOV    AL,[0076]        ; ©°dic° bajt vòbàru
F000:A9DD 24C0           AND    AL,C0            ; bity z†kazu opakov†n°
F000:A9DF 0AC4           OR     AL,AH            ; nastaven° bitñ opakov†n°
F000:A9E1 A27600         MOV    [0076],AL        ; ©°dic° bajt
F000:A9E4 58             POP    AX 
F000:A9E5 5A             POP    DX 
F000:A9E6 5B             POP    BX 
F000:A9E7 07             POP    ES 
F000:A9E8 C3             RET     
; -----------------------------------------------------------------------------
;        Nastaven° á°sla sektoru, v†lce, hlavy ... pro p©°stup na disk
; -----------------------------------------------------------------------------
F000:A9E9 50           * PUSH   AX
F000:A9EA 52             PUSH   DX 
F000:A9EB BAF201         MOV    DX,01F2          ; registr poátu sektorñ
F000:A9EE 884603         MOV    [BP+03],AL       ; £schova á°taáe sektorñ
F000:A9F1 EE             OUT    DX,AL            ; nastaven° á°taáe sektorñ
F000:A9F2 EB00           JMP    A9F4             ; kr†tk† prodleva
F000:A9F4 EB00         * JMP    A9F6             ; kr†tk† prodleva
F000:A9F6 8AC1         * MOV    AL,CL            ; á°slo poá†teán°ho sektoru
F000:A9F8 243F           AND    AL,3F            ; odmaskov†n° bitñ á°sla stopy
F000:A9FA BAF301         MOV    DX,01F3          ; registr á°sla sektoru
F000:A9FD 884604         MOV    [BP+04],AL       ; £schova á°sla sektoru
F000:AA00 EE             OUT    DX,AL            ; nastaven° á°sla poá. sektoru
F000:AA01 EB00           JMP    AA03             ; kr†tk† prodleva
F000:AA03 EB00         * JMP    AA05             ; kr†tk† prodleva
F000:AA05 8AC5         * MOV    AL,CH            ; á°slo v†lce
F000:AA07 BAF401         MOV    DX,01F4          ; registr á°sla v†lce - LOW
F000:AA0A 884605         MOV    [BP+05],AL       ; £schova á°sla v†lce - LOW
F000:AA0D EE             OUT    DX,AL            ; nastaven° á°sla v†lce - LOW
F000:AA0E EB00           JMP    AA10             ; kr†tk† prodleva
F000:AA10 EB00         * JMP    AA12             ; kr†tk† prodleva
F000:AA12 8AC1         * MOV    AL,CL            ; á°slo sektoru, á°slo v†lce
F000:AA14 C0E806         SHR    AL,06            ; rotace vy®®°ch 2 bitñ v†lce
F000:AA17 8A5615         MOV    DL,[BP+15]       ; nejvy®®° 2 bity á°sla v†lce
F000:AA1A C0EA04         SHR    DL,04            ; nejvy®®° 2 bity á°sla v†lce
F000:AA1D 80E20C         AND    DL,0C            ; bity 10,11 á°sla v†lce
F000:AA20 0AC2           OR     AL,DL            ; bity 8,9,10,11 á°sla v†lce
F000:AA22 BAF501         MOV    DX,01F5          ; registr á°sla v†lce - HIGH
F000:AA25 884606         MOV    [BP+06],AL       ; £schova á°sla v†lce - HIGH
F000:AA28 EE             OUT    DX,AL            ; nastaven° á°sla v†lce - HIGH
F000:AA29 EB00           JMP    AA2B             ; kr†tk† prodleva
F000:AA2B EB00           JMP    AA2D             ; kr†tk† prodleva
F000:AA2D BAF601         MOV    DX,01F6          ; registr vòbàru disku a hlav
F000:AA30 8A4607         MOV    AL,[BP+07]       ; k¢d pro vòbàr disku a hlavy
F000:AA33 EE             OUT    DX,AL            ; vòbàr disku a hlavy
F000:AA34 5A             POP    DX 
F000:AA35 58             POP    AX 
F000:AA36 C3             RET     


; *****************************************************************************

F000:AA37 FA             CLI
F000:AA38 FC             CLD     
F000:AA39 BE4C00         MOV    SI,004C 
F000:AA3C BF0001         MOV    DI,0100 
F000:AA3F B83DA3         MOV    AX,A33D 
F000:AA42 268704         XCHG   AX,ES:[SI] 
F000:AA45 AB             STOSW   
F000:AA46 8CC8           MOV    AX,CS 
F000:AA48 26874402       XCHG   AX,ES:[SI+02] 
F000:AA4C AB             STOSW   
F000:AA4D B801E4         MOV    AX,E401 
F000:AA50 AB             STOSW   
F000:AA51 268C0D         MOV    ES:[DI],CS 
F000:AA54 BF1801         MOV    DI,0118 
F000:AA57 AB             STOSW   
F000:AA58 268C0D         MOV    ES:[DI],CS 
F000:AA5B B845E8         MOV    AX,E845 
F000:AA5E BFD801         MOV    DI,01D8 
F000:AA61 AB             STOSW   
F000:AA62 268C0D         MOV    ES:[DI],CS 
F000:AA65 FB             STI     
F000:AA66 B90700         MOV    CX,0007 
F000:AA69 BB4200         MOV    BX,0042 
F000:AA6C 33C0           XOR    AX,AX 
F000:AA6E 8807           MOV    [BX],AL
F000:AA70 43             INC    BX 
F000:AA71 E2FB           LOOP   AA6E 
F000:AA73 A27400         MOV    [0074],AL 
F000:AA76 A27500         MOV    [0075],AL 
F000:AA79 A27600         MOV    [0076],AL 
F000:AA7C A28C00         MOV    [008C],AL 
F000:AA7F A28D00         MOV    [008D],AL 
F000:AA82 A28E00         MOV    [008E],AL 
F000:AA85 B092           MOV    AL,92 
F000:AA87 E81844         CALL   EEA2 
F000:AA8A 8AC8           MOV    CL,AL 
F000:AA8C 24F0           AND    AL,F0 
F000:AA8E 7459           JZ     AAE9 
F000:AA90 3CF0           CMP    AL,F0 
F000:AA92 750F           JNZ    AAA3 
F000:AA94 B099           MOV    AL,99 
F000:AA96 E80944         CALL   EEA2 
F000:AA99 0AC0           OR     AL,AL 
F000:AA9B 744C           JZ     AAE9 
F000:AA9D 3C2F           CMP    AL,2F                         ;'/' 
F000:AA9F 7748           JA     AAE9 
F000:AAA1 EB03           JMP    AAA6 
F000:AAA3 C0E804         SHR    AL,04 
F000:AAA6 BB0401         MOV    BX,0104 
F000:AAA9 B400           MOV    AH,00 
F000:AAAB 48             DEC    AX 
F000:AAAC C1E004         SHL    AX,04 
F000:AAAF 260107         ADD    ES:[BX],AX
F000:AAB2 FE067500       INC    Byte Ptr [0075]
F000:AAB6 8AC1           MOV    AL,CL 
F000:AAB8 240F           AND    AL,0F 
F000:AABA 7421           JZ     AADD 
F000:AABC 3C0F           CMP    AL,0F 
F000:AABE 750D           JNZ    AACD 
F000:AAC0 B09A           MOV    AL,9A 
F000:AAC2 E8DD43         CALL   EEA2 
F000:AAC5 0AC0           OR     AL,AL 
F000:AAC7 7414           JZ     AADD 
F000:AAC9 3C2F           CMP    AL,2F                         ;'/' 
F000:AACB 7710           JA     AADD 
F000:AACD BB1801         MOV    BX,0118 
F000:AAD0 B400           MOV    AH,00 
F000:AAD2 48             DEC    AX 
F000:AAD3 C1E004         SHL    AX,04 
F000:AAD6 260107         ADD    ES:[BX],AX
F000:AAD9 FE067500       INC    Byte Ptr [0075] 
F000:AADD B280           MOV    DL,80 
F000:AADF B400           MOV    AH,00 
F000:AAE1 CD13           INT    13 
F000:AAE3 7312           JNB    AAF7 
F000:AAE5 81CD0400       OR     BP,0004 
F000:AAE9 B88E8E         MOV    AX,8E8E 
F000:AAEC E8B343         CALL   EEA2 
F000:AAEF 0C08           OR     AL,08 
F000:AAF1 86C4           XCHG   AL,AH 
F000:AAF3 E8CE43         CALL   EEC4 
F000:AAF6 C3             RET


F000:AAF7 8B366C00       MOV    SI,[006C] 
F000:AAFB 8BFE           MOV    DI,SI 
F000:AAFD 81C7D802       ADD    DI,02D8 
F000:AB01 E88000         CALL   AB84 
F000:AB04 7306           JNB    AB0C 
F000:AB06 81CD2000       OR     BP,0020 
F000:AB0A EB09           JMP    AB15 
F000:AB0C E84100         CALL   AB50 
F000:AB0F 7304           JNB    AB15 
F000:AB11 81CD0800       OR     BP,0008 
F000:AB15 803E750001     CMP    Byte Ptr [0075],01 
F000:AB1A 7420           JZ     AB3C 
F000:AB1C 8B366C00       MOV    SI,[006C] 
F000:AB20 8BFE           MOV    DI,SI 
F000:AB22 81C7D802       ADD    DI,02D8 
F000:AB26 B281           MOV    DL,81 
F000:AB28 E85900         CALL   AB84 
F000:AB2B 7306           JNB    AB33 
F000:AB2D 81CD4000       OR     BP,0040 
F000:AB31 EB09           JMP    AB3C 
F000:AB33 E81A00         CALL   AB50 
F000:AB36 7304           JNB    AB3C 
F000:AB38 81CD1000       OR     BP,0010 
F000:AB3C F7C52000       TEST   BP,0020 
F000:AB40 75A7           JNZ    AAE9 
F000:AB42 B88E8E         MOV    AX,8E8E 
F000:AB45 E85A43         CALL   EEA2 
F000:AB48 24F7           AND    AL,F7 
F000:AB4A 86C4           XCHG   AL,AH 
F000:AB4C E87543         CALL   EEC4 
F000:AB4F C3             RET


F000:AB50 51             PUSH   CX 
F000:AB51 8ADA           MOV    BL,DL 
F000:AB53 B408           MOV    AH,08 
F000:AB55 CD13           INT    13 
F000:AB57 7227           JB     AB80 
F000:AB59 B80104         MOV    AX,0401 
F000:AB5C 8AD3           MOV    DL,BL 
F000:AB5E CD13           INT    13 
F000:AB60 731E           JNB    AB80 
F000:AB62 80FC0A         CMP    AH,0A 
F000:AB65 7419           JZ     AB80 
F000:AB67 80FC10         CMP    AH,10 
F000:AB6A 7414           JZ     AB80 
F000:AB6C 80FC11         CMP    AH,11 
F000:AB6F 740F           JZ     AB80 
F000:AB71 E82700         CALL   AB9B 
F000:AB74 720A           JB     AB80 
F000:AB76 FEC9           DEC    CL 
F000:AB78 8AD1           MOV    DL,CL 
F000:AB7A 80E23F         AND    DL,3F                         ;'?' 
F000:AB7D 75DA           JNZ    AB59 
F000:AB7F F9             STC     
F000:AB80 8AD3           MOV    DL,BL 
F000:AB82 59             POP    CX 
F000:AB83 C3             RET


F000:AB84 B409           MOV    AH,09 
F000:AB86 CD13           INT    13 
F000:AB88 7306           JNB    AB90 
F000:AB8A E80E00         CALL   AB9B 
F000:AB8D 73F5           JNB    AB84 
F000:AB8F C3             RET


F000:AB90 B411           MOV    AH,11 
F000:AB92 CD13           INT    13 
F000:AB94 73F9           JNB    AB8F 
F000:AB96 E80200         CALL   AB9B 
F000:AB99 EBF2           JMP    AB8D 
F000:AB9B 50             PUSH   AX 
F000:AB9C A16C00         MOV    AX,[006C] 
F000:AB9F 3BF7           CMP    SI,DI 
F000:ABA1 720B           JB     ABAE 
F000:ABA3 3BC6           CMP    AX,SI 
F000:ABA5 770F           JA     ABB6 
F000:ABA7 3BC7           CMP    AX,DI 
F000:ABA9 720B           JB     ABB6 
F000:ABAB F9             STC     
F000:ABAC 58             POP    AX 
F000:ABAD C3             RET


F000:ABAE 3BC6           CMP    AX,SI 
F000:ABB0 72F9           JB     ABAB 
F000:ABB2 3BC7           CMP    AX,DI 
F000:ABB4 77F5           JA     ABAB 
F000:ABB6 F8             CLC     
F000:ABB7 58             POP    AX 
F000:ABB8 C3             RET


F000:ABB9 00B88F02       ADD    [BX+SI+028F],BH 
F000:ABBD E8D742         CALL   EE97 
F000:ABC0 B030           MOV    AL,30                         ;'0' 
F000:ABC2 E680           OUT    80,AL 
F000:ABC4 E8CDF6         CALL   A294 
F000:ABC7 BF0006         MOV    DI,0600 
F000:ABCA 57             PUSH   DI 
F000:ABCB BE60E2         MOV    SI,E260 
F000:ABCE B93000         MOV    CX,0030 
F000:ABD1 FA             CLI     
F000:ABD2 FC             CLD     
F000:ABD3 2EF3           REPZ   
F000:ABD5 A5             MOVSW  CS: 
F000:ABD6 33F6           XOR    SI,SI 
F000:ABD8 BF1080         MOV    DI,8010 
F000:ABDB B90003         MOV    CX,0300 
F000:ABDE 26F3           REPZ   
F000:ABE0 A5             MOVSW  ES: 
F000:ABE1 5E             POP    SI 
F000:ABE2 26C7440A0006   MOV    Word Ptr ES:[SI+0A],0600 
F000:ABE8 26C6440C00     MOV    Byte Ptr ES:[SI+0C],00 
F000:ABED BB0008         MOV    BX,0800 
F000:ABF0 B489           MOV    AH,89 
F000:ABF2 B031           MOV    AL,31                         ;'1' 
F000:ABF4 E680           OUT    80,AL 
F000:ABF6 CD15           INT    15 
F000:ABF8 7406           JZ     AC00 
F000:ABFA BE7BD7         MOV    SI,D77B 
F000:ABFD E9EEE1         JMP    8DEE 
F000:AC00 E8F002         CALL   AEF3 
F000:AC03 B84000         MOV    AX,0040 
F000:AC06 8EC0           MOV    ES,AX 
F000:AC08 B032           MOV    AL,32                         ;'2' 
F000:AC0A E680           OUT    80,AL 
F000:AC0C EB27           JMP    AC35 
F000:AC0E B88F01         MOV    AX,018F 
F000:AC11 E88342         CALL   EE97 
F000:AC14 E889E2         CALL   8EA0 
F000:AC17 B04E           MOV    AL,4E                         ;'N' 
F000:AC19 E680           OUT    80,AL 
F000:AC1B E93235         JMP    E150 
F000:AC1E B04F           MOV    AL,4F                         ;'O' 
F000:AC20 E680           OUT    80,AL 
F000:AC22 BE1080         MOV    SI,8010 
F000:AC25 33FF           XOR    DI,DI 
F000:AC27 B90003         MOV    CX,0300 
F000:AC2A FA             CLI     
F000:AC2B FC             CLD     
F000:AC2C 26F3           REPZ   
F000:AC2E A5             MOVSW  ES: 
F000:AC2F BE8FD7         MOV    SI,D78F 
F000:AC32 E9B9E1         JMP    8DEE 
F000:AC35 33DB           XOR    BX,BX 
F000:AC37 33FF           XOR    DI,DI 
F000:AC39 BE4402         MOV    SI,0244 
F000:AC3C B8FD0F         MOV    AX,0FFD 
F000:AC3F 8A17           MOV    DL,[BX]
F000:AC41 E83A01         CALL   AD7E 
F000:AC44 3A17           CMP    DL,[BX]
F000:AC46 75C6           JNZ    AC0E 
F000:AC48 50             PUSH   AX 
F000:AC49 B033           MOV    AL,33                         ;'3' 
F000:AC4B E680           OUT    80,AL 
F000:AC4D B80900         MOV    AX,0009 
F000:AC50 E82B01         CALL   AD7E 
F000:AC53 3A17           CMP    DL,[BX]
F000:AC55 75B7           JNZ    AC0E 
F000:AC57 50             PUSH   AX 
F000:AC58 B034           MOV    AL,34                         ;'4' 
F000:AC5A E680           OUT    80,AL 
F000:AC5C 58             POP    AX 
F000:AC5D 8824           MOV    [SI],AH 
F000:AC5F B40A           MOV    AH,0A 
F000:AC61 33D2           XOR    DX,DX 
F000:AC63 E82F01         CALL   AD95 
F000:AC66 86D6           XCHG   DL,DH 
F000:AC68 B035           MOV    AL,35                         ;'5' 
F000:AC6A E680           OUT    80,AL 
F000:AC6C 58             POP    AX 
F000:AC6D 8824           MOV    [SI],AH 
F000:AC6F B4FE           MOV    AH,FE 
F000:AC71 E82101         CALL   AD95 
F000:AC74 86D6           XCHG   DL,DH 
F000:AC76 B036           MOV    AL,36                         ;'6' 
F000:AC78 E680           OUT    80,AL 
F000:AC7A 6881AC         PUSH   AC81 
F000:AC7D 684EFA         PUSH   FA4E 
F000:AC80 C3             RET


F000:AC81 B037           MOV    AL,37                         ;'7' 
F000:AC83 E680           OUT    80,AL 
F000:AC85 0BED           OR     BP,BP 
F000:AC87 792F           JNS    ACB8 
F000:AC89 52             PUSH   DX 
F000:AC8A 0AD2           OR     DL,DL 
F000:AC8C 740D           JZ     AC9B 
F000:AC8E C60400         MOV    Byte Ptr [SI],00 
F000:AC91 E86C02         CALL   AF00 
F000:AC94 E87002         CALL   AF07 
F000:AC97 FECA           DEC    DL 
F000:AC99 75F6           JNZ    AC91 
F000:AC9B B038           MOV    AL,38                         ;'8' 
F000:AC9D E680           OUT    80,AL 
F000:AC9F 0AF6           OR     DH,DH 
F000:ACA1 740D           JZ     ACB0 
F000:ACA3 C6040F         MOV    Byte Ptr [SI],0F 
F000:ACA6 E85702         CALL   AF00 
F000:ACA9 E85B02         CALL   AF07 
F000:ACAC FECE           DEC    DH 
F000:ACAE 75F6           JNZ    ACA6 
F000:ACB0 B039           MOV    AL,39                         ;'9' 
F000:ACB2 E680           OUT    80,AL 
F000:ACB4 5A             POP    DX 
F000:ACB5 42             INC    DX 
F000:ACB6 EB36           JMP    ACEE 
F000:ACB8 55             PUSH   BP 
F000:ACB9 BD0100         MOV    BP,0001 
F000:ACBC 52             PUSH   DX 
F000:ACBD 33D2           XOR    DX,DX 
F000:ACBF B03A           MOV    AL,3A                         ;':' 
F000:ACC1 E680           OUT    80,AL 
F000:ACC3 E8A801         CALL   AE6E 
F000:ACC6 5A             POP    DX 
F000:ACC7 C60400         MOV    Byte Ptr [SI],00 
F000:ACCA B03B           MOV    AL,3B                         ;';' 
F000:ACCC E680           OUT    80,AL 
F000:ACCE E8F700         CALL   ADC8 
F000:ACD1 42             INC    DX 
F000:ACD2 8BEA           MOV    BP,DX 
F000:ACD4 EB00           JMP    ACD6 
F000:ACD6 90             NOP     
F000:ACD7 81E5FF00       AND    BP,00FF 
F000:ACDB 86D6           XCHG   DL,DH 
F000:ACDD C6040F         MOV    Byte Ptr [SI],0F 
F000:ACE0 B03C           MOV    AL,3C                         ;'<' 
F000:ACE2 E680           OUT    80,AL 
F000:ACE4 E8E100         CALL   ADC8 
F000:ACE7 86D6           XCHG   DL,DH 
F000:ACE9 5D             POP    BP 
F000:ACEA B03D           MOV    AL,3D                         ;'=' 
F000:ACEC E680           OUT    80,AL 
F000:ACEE 89161300       MOV    [0013],DX 
F000:ACF2 60             PUSHA   
F000:ACF3 8BC4           MOV    AX,SP 
F000:ACF5 A36700         MOV    [0067],AX 
F000:ACF8 B88F03         MOV    AX,038F 
F000:ACFB E89941         CALL   EE97 
F000:ACFE E89FE1         CALL   8EA0 
F000:AD01 B03E           MOV    AL,3E                         ;'>' 
F000:AD03 E680           OUT    80,AL 
F000:AD05 E94834         JMP    E150 
F000:AD08 B03F           MOV    AL,3F                         ;'?' 
F000:AD0A E680           OUT    80,AL 
F000:AD0C A16700         MOV    AX,[0067] 
F000:AD0F 8BE0           MOV    SP,AX 
F000:AD11 61             POPA    
F000:AD12 EB00           JMP    AD14 
F000:AD14 90             NOP     
F000:AD15 B040           MOV    AL,40                         ;'@' 
F000:AD17 E680           OUT    80,AL 
F000:AD19 E833E2         CALL   8F4F 
F000:AD1C 7524           JNZ    AD42 
F000:AD1E B041           MOV    AL,41                         ;'A' 
F000:AD20 E680           OUT    80,AL 
F000:AD22 E8ACF5         CALL   A2D1 
F000:AD25 B042           MOV    AL,42                         ;'B' 
F000:AD27 E680           OUT    80,AL 
F000:AD29 E8BAF5         CALL   A2E6 
F000:AD2C B043           MOV    AL,43                         ;'C' 
F000:AD2E E680           OUT    80,AL 
F000:AD30 E81200         CALL   AD45 
F000:AD33 A01200         MOV    AL,[0012] 
F000:AD36 A820           TEST   AL,20                         ;' ' 
F000:AD38 7505           JNZ    AD3F 
F000:AD3A B0FE           MOV    AL,FE 
F000:AD3C E621           OUT    21,AL                         ;'!' 
F000:AD3E FB             STI     
F000:AD3F E9EE26         JMP    D430 
F000:AD42 E9B5FE         JMP    ABFA 
F000:AD45 8B166900       MOV    DX,[0069] 
F000:AD49 B402           MOV    AH,02 
F000:AD4B B700           MOV    BH,00 
F000:AD4D E8AFF4         CALL   A1FF 
F000:AD50 B95000         MOV    CX,0050 
F000:AD53 B8200E         MOV    AX,0E20 
F000:AD56 E8A6F4         CALL   A1FF 
F000:AD59 E2F8           LOOP   AD53 
F000:AD5B B402           MOV    AH,02 
F000:AD5D E89FF4         CALL   A1FF 
F000:AD60 C3             RET


F000:AD61 B90A00         MOV    CX,000A 
F000:AD64 32E4           XOR    AH,AH 
F000:AD66 C1E006         SHL    AX,06 
F000:AD69 33D2           XOR    DX,DX 
F000:AD6B F7F1           DIV    CX 
F000:AD6D 0BC0           OR     AX,AX 
F000:AD6F 7405           JZ     AD76 
F000:AD71 52             PUSH   DX 
F000:AD72 E8F4FF         CALL   AD69 
F000:AD75 5A             POP    DX 
F000:AD76 8AC2           MOV    AL,DL 
F000:AD78 0C30           OR     AL,30                         ;'0' 
F000:AD7A E8B2E0         CALL   8E2F 
F000:AD7D C3             RET


F000:AD7E 8804           MOV    [SI],AL 
F000:AD80 8CC1           MOV    CX,ES 
F000:AD82 8EC1           MOV    ES,CX 
F000:AD84 F9             STC     
F000:AD85 268805         MOV    ES:[DI],AL 
F000:AD88 FEC8           DEC    AL 
F000:AD8A D1DF           RCR    DI,1 
F000:AD8C 73F7           JNB    AD85 
F000:AD8E FE0C           DEC    Byte Ptr [SI] 
F000:AD90 3A24           CMP    AH,[SI] 
F000:AD92 75EC           JNZ    AD80 
F000:AD94 C3             RET


F000:AD95 42             INC    DX 
F000:AD96 FE04           INC    Byte Ptr [SI] 
F000:AD98 3A24           CMP    AH,[SI] 
F000:AD9A 7419           JZ     ADB5 
F000:AD9C 8CC1           MOV    CX,ES 
F000:AD9E 8EC1           MOV    ES,CX 
F000:ADA0 BF0100         MOV    DI,0001 
F000:ADA3 FEC0           INC    AL 
F000:ADA5 263005         XOR    ES:[DI],AL 
F000:ADA8 750B           JNZ    ADB5 
F000:ADAA D1D7           RCL    DI,1 
F000:ADAC 73F5           JNB    ADA3 
F000:ADAE FEC0           INC    AL 
F000:ADB0 263005         XOR    ES:[DI],AL 
F000:ADB3 74E0           JZ     AD95 
F000:ADB5 4A             DEC    DX 
F000:ADB6 C3             RET


F000:ADB7 F7C73FFC       TEST   DI,FC3F 
F000:ADBB 7A01           JPE    ADBE 
F000:ADBD F9             STC     
F000:ADBE D1DF           RCR    DI,1 
F000:ADC0 A8C3           TEST   AL,C3 
F000:ADC2 7A01           JPE    ADC5 
F000:ADC4 F9             STC     
F000:ADC5 D0D8           RCR    AL,1 
F000:ADC7 C3             RET     
F000:ADC8 0AD2           OR     DL,DL 
F000:ADCA 747A           JZ     AE46 
F000:ADCC 52             PUSH   DX 
F000:ADCD 32F6           XOR    DH,DH 
F000:ADCF 813E1300DCFE   CMP    Word Ptr [0013],FEDC 
F000:ADD5 7476           JZ     AE4D 
F000:ADD7 B0AE           MOV    AL,AE 
F000:ADD9 E83FE1         CALL   8F1B 
F000:ADDC E85BE1         CALL   8F3A 
F000:ADDF E460           IN     AL,60                         ;'`' 
F000:ADE1 EB00           JMP    ADE3 
F000:ADE3 EB00           JMP    ADE5 
F000:ADE5 E464           IN     AL,64                         ;'d' 
F000:ADE7 A801           TEST   AL,01 
F000:ADE9 740A           JZ     ADF5 
F000:ADEB EB00           JMP    ADED 
F000:ADED EB00           JMP    ADEF 
F000:ADEF E460           IN     AL,60                         ;'`' 
F000:ADF1 3C01           CMP    AL,01 
F000:ADF3 7452           JZ     AE47 
F000:ADF5 E80801         CALL   AF00 
F000:ADF8 E8A5E0         CALL   8EA0 
F000:ADFB E81301         CALL   AF11 
F000:ADFE 755E           JNZ    AE5E 
F000:AE00 263005         XOR    ES:[DI],AL 
F000:AE03 8BFA           MOV    DI,DX 
F000:AE05 8BC7           MOV    AX,DI 
F000:AE07 B90040         MOV    CX,4000 
F000:AE0A 50             PUSH   AX 
F000:AE0B 51             PUSH   CX 
F000:AE0C E8A8FF         CALL   ADB7 
F000:AE0F 268805         MOV    ES:[DI],AL 
F000:AE12 E2F8           LOOP   AE0C 
F000:AE14 59             POP    CX 
F000:AE15 58             POP    AX 
F000:AE16 8BF8           MOV    DI,AX 
F000:AE18 E89CFF         CALL   ADB7 
F000:AE1B 263005         XOR    ES:[DI],AL 
F000:AE1E E1F8           LOOPZ  AE18 
F000:AE20 753C           JNZ    AE5E 
F000:AE22 E461           IN     AL,61                         ;'a' 
F000:AE24 A8C0           TEST   AL,C0 
F000:AE26 7536           JNZ    AE5E 
F000:AE28 E8DC00         CALL   AF07 
F000:AE2B FEC6           INC    DH 
F000:AE2D E83E00         CALL   AE6E 
F000:AE30 FECA           DEC    DL 
F000:AE32 75B1           JNZ    ADE5 
F000:AE34 8AC6           MOV    AL,DH 
F000:AE36 5A             POP    DX 
F000:AE37 8AD0           MOV    DL,AL 
F000:AE39 E864E0         CALL   8EA0 
F000:AE3C B0AD           MOV    AL,AD 
F000:AE3E E8DAE0         CALL   8F1B 
F000:AE41 E8F6E0         CALL   8F3A 
F000:AE44 E460           IN     AL,60                         ;'`' 
F000:AE46 C3             RET     
F000:AE47 C7061300DCFE   MOV    Word Ptr [0013],FEDC 
F000:AE4D E8B000         CALL   AF00 
F000:AE50 E8B400         CALL   AF07 
F000:AE53 FEC6           INC    DH 
F000:AE55 E81600         CALL   AE6E 
F000:AE58 FECA           DEC    DL 
F000:AE5A 75F1           JNZ    AE4D 
F000:AE5C EBD6           JMP    AE34 
F000:AE5E BB0300         MOV    BX,0003 
F000:AE61 E88BE5         CALL   93EF 
F000:AE64 FA             CLI     
F000:AE65 A01200         MOV    AL,[0012] 
F000:AE68 A820           TEST   AL,20                         ;' ' 
F000:AE6A 74F2           JZ     AE5E 
F000:AE6C EBC6           JMP    AE34 
F000:AE6E 60             PUSHA   
F000:AE6F 8BC4           MOV    AX,SP 
F000:AE71 A36700         MOV    [0067],AX 
F000:AE74 B88F06         MOV    AX,068F 
F000:AE77 E81D40         CALL   EE97 
F000:AE7A E9D332         JMP    E150 
F000:AE7D A16700         MOV    AX,[0067] 
F000:AE80 8BE0           MOV    SP,AX 
F000:AE82 E8D400         CALL   AF59 
F000:AE85 B00D           MOV    AL,0D 
F000:AE87 E8A5DF         CALL   8E2F 
F000:AE8A 61             POPA    
F000:AE8B 60             PUSHA   
F000:AE8C 8AC6           MOV    AL,DH 
F000:AE8E 03C5           ADD    AX,BP 
F000:AE90 50             PUSH   AX 
F000:AE91 3C9D           CMP    AL,9D 
F000:AE93 7316           JNB    AEAB 
F000:AE95 B90100         MOV    CX,0001 
F000:AE98 3C10           CMP    AL,10 
F000:AE9A 7308           JNB    AEA4 
F000:AE9C B102           MOV    CL,02 
F000:AE9E 3C02           CMP    AL,02 
F000:AEA0 7302           JNB    AEA4 
F000:AEA2 B103           MOV    CL,03 
F000:AEA4 B030           MOV    AL,30                         ;'0' 
F000:AEA6 E886DF         CALL   8E2F 
F000:AEA9 E2F9           LOOP   AEA4 
F000:AEAB 58             POP    AX 
F000:AEAC 50             PUSH   AX 
F000:AEAD E8B1FE         CALL   AD61 
F000:AEB0 BEAED7         MOV    SI,D7AE 
F000:AEB3 E85DDF         CALL   8E13 
F000:AEB6 58             POP    AX 
F000:AEB7 3C01           CMP    AL,01 
F000:AEB9 7519           JNZ    AED4 
F000:AEBB 8B166900       MOV    DX,[0069] 
F000:AEBF B700           MOV    BH,00 
F000:AEC1 B402           MOV    AH,02 
F000:AEC3 E839F3         CALL   A1FF 
F000:AEC6 BE82D8         MOV    SI,D882 
F000:AEC9 E847DF         CALL   8E13 
F000:AECC 80EE02         SUB    DH,02 
F000:AECF B402           MOV    AH,02 
F000:AED1 E82BF3         CALL   A1FF 
F000:AED4 B88F02         MOV    AX,028F 
F000:AED7 E8BD3F         CALL   EE97 
F000:AEDA BE0006         MOV    SI,0600 
F000:AEDD BB0008         MOV    BX,0800 
F000:AEE0 B489           MOV    AH,89 
F000:AEE2 CD15           INT    15 
F000:AEE4 750A           JNZ    AEF0 
F000:AEE6 E80A00         CALL   AEF3 
F000:AEE9 B84000         MOV    AX,0040 
F000:AEEC 8EC0           MOV    ES,AX 
F000:AEEE 61             POPA    
F000:AEEF C3             RET     
F000:AEF0 E907FD         JMP    ABFA 
F000:AEF3 A01200         MOV    AL,[0012] 
F000:AEF6 A820           TEST   AL,20                         ;' ' 
F000:AEF8 7505           JNZ    AEFF 
F000:AEFA B0FE           MOV    AL,FE 
F000:AEFC E621           OUT    21,AL                         ;'!' 
F000:AEFE FB             STI     
F000:AEFF C3             RET     
F000:AF00 FE04           INC    Byte Ptr [SI] 
F000:AF02 8CC1           MOV    CX,ES 
F000:AF04 8EC1           MOV    ES,CX 
F000:AF06 C3             RET     
F000:AF07 33C0           XOR    AX,AX 
F000:AF09 33FF           XOR    DI,DI 
F000:AF0B B90080         MOV    CX,8000 
F000:AF0E F3             REPZ   
F000:AF0F AB             STOSW   
F000:AF10 C3             RET     
F000:AF11 BB0080         MOV    BX,8000 
F000:AF14 B88080         MOV    AX,8080 
F000:AF17 8BCB           MOV    CX,BX 
F000:AF19 33FF           XOR    DI,DI 
F000:AF1B F3             REPZ   
F000:AF1C AB             STOSW   
F000:AF1D 8BCB           MOV    CX,BX 
F000:AF1F 33FF           XOR    DI,DI 
F000:AF21 F3             REPZ   
F000:AF22 AF             SCASW   
F000:AF23 7533           JNZ    AF58 
F000:AF25 B85555         MOV    AX,5555 
F000:AF28 8BCB           MOV    CX,BX 
F000:AF2A 33FF           XOR    DI,DI 
F000:AF2C F3             REPZ   
F000:AF2D AB             STOSW   
F000:AF2E 8BCB           MOV    CX,BX 
F000:AF30 33FF           XOR    DI,DI 
F000:AF32 F3             REPZ   
F000:AF33 AF             SCASW   
F000:AF34 7522           JNZ    AF58 
F000:AF36 B83333         MOV    AX,3333 
F000:AF39 8BCB           MOV    CX,BX 
F000:AF3B 33FF           XOR    DI,DI 
F000:AF3D F3             REPZ   
F000:AF3E AB             STOSW   
F000:AF3F 8BCB           MOV    CX,BX 
F000:AF41 33FF           XOR    DI,DI 
F000:AF43 F3             REPZ   
F000:AF44 AF             SCASW   
F000:AF45 7511           JNZ    AF58 
F000:AF47 B80F0F         MOV    AX,0F0F 
F000:AF4A 8BCB           MOV    CX,BX 
F000:AF4C 33FF           XOR    DI,DI 
F000:AF4E F3             REPZ   
F000:AF4F AB             STOSW   
F000:AF50 8BCB           MOV    CX,BX 
F000:AF52 33FF           XOR    DI,DI 
F000:AF54 F3             REPZ   
F000:AF55 AF             SCASW   
F000:AF56 7500           JNZ    AF58 
F000:AF58 C3             RET     
F000:AF59 B0B6           MOV    AL,B6 
F000:AF5B E643           OUT    43,AL                         ;'C' 
F000:AF5D 32C0           XOR    AL,AL 
F000:AF5F EB00           JMP    AF61 
F000:AF61 EB00           JMP    AF63 
F000:AF63 E642           OUT    42,AL                         ;'B' 
F000:AF65 EB00           JMP    AF67 
F000:AF67 EB00           JMP    AF69 
F000:AF69 E642           OUT    42,AL                         ;'B' 
F000:AF6B E461           IN     AL,61                         ;'a' 
F000:AF6D 0C03           OR     AL,03 
F000:AF6F EB00           JMP    AF71 
F000:AF71 EB00           JMP    AF73 
F000:AF73 E661           OUT    61,AL                         ;'a' 
F000:AF75 B9FF00         MOV    CX,00FF 
F000:AF78 E2FE           LOOP   AF78 
F000:AF7A 24FC           AND    AL,FC 
F000:AF7C E661           OUT    61,AL                         ;'a' 
F000:AF7E C3             RET     
F000:AF7F 00F1           ADD    CL,DH 
